# StudyScriber MVP é–‹ç™¼ä»»å‹™æ¸…å–®

åŸºæ–¼ PRD åˆ†æèˆ‡ shrimp-task-manager è¦åŠƒçš„è©³ç´°é–‹ç™¼ä»»å‹™

## ä½¿ç”¨æ–¹æ³•

### é–‹ç™¼

```prompt
ï¼ˆè¤‡è£½é …ç›®ï¼‰
è«‹é–±è®€ @PRD.md ä¾ç…§ @Todos.md é–‹ç™¼æ­¤é …ç›®ã€‚
æ³¨æ„ï¼šæ¯æ¬¡å®Œæˆä¸€å€‹å¯ä»¥æ‰“å‹¾çš„ä»»å‹™ï¼Œéƒ½è¦å ±å‘Šçµæœèˆ‡ç‹€æ³ï¼Œä¸¦åœ¨ checklist è£¡é¢æ‰“å‹¾ï¼Œæ‰é€²è¡Œä¸‹ä¸€å€‹ä»»å‹™
```

## æ¸¬è©¦

```
ï¼ˆè¤‡è£½é …ç›®ï¼‰
è«‹é–±è®€ @PRD.md ï¼Œç›¡é‡ä½¿ç”¨ MCP å·¥å…·é€²è¡Œå®Œæ•´å–®å…ƒæ¸¬è©¦ï¼Œåšå‡ºè®“ RD å¯ä»¥ä¿®å¾©çš„éŒ¯èª¤å ±å‘Š
```

---

## ğŸ¯ å°ˆæ¡ˆç›®æ¨™

å»ºç«‹ã€Œé‚ŠéŒ„é‚Šè½‰éŒ„ã€é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³å…©ç¨®æ¨¡å¼ï¼Œå¯¦ä½œå³æ™‚é€å­—ç¨¿è½‰æ›ã€Markdown ç·¨è¼¯ã€æ™ºæ…§åŒ¯å‡ºåŠŸèƒ½ã€‚

**æŠ€è¡“æ¶æ§‹**ï¼šFastAPI + PostgreSQL + Cloudflare R2 + Azure OpenAI Whisper å¾Œç«¯ï¼ŒReact Hook å‰ç«¯

---

## ğŸ”§ å¾Œç«¯é–‹ç™¼ä»»å‹™

### Phase 1: åŸºç¤æ¶æ§‹å»ºè¨­

- [x] **T1: å»ºç«‹å°ˆæ¡ˆåŸºç¤æ¶æ§‹èˆ‡è³‡æ–™åº«è¨­è¨ˆ** âš¡ **å·²æ›´æ–°ç‹€æ…‹è¨­è¨ˆ**
  - [x] å»ºç«‹ FastAPI å°ˆæ¡ˆç›®éŒ„çµæ§‹ (`app/api/`, `app/ws/`, `app/services/`, `app/core/`, `app/db/`, `app/middleware/`, `app/schemas/`)
  - [x] è¨­è¨ˆ PostgreSQL è³‡æ–™åº«æ¶æ§‹
    - [x] å»ºç«‹ sessions è¡¨ï¼ˆå« UUIDã€æœƒè©±é¡å‹ã€ç‹€æ…‹ç®¡ç†ï¼‰
    - [x] å»ºç«‹ audio_files è¡¨ï¼ˆéŸ³æª”åˆ‡ç‰‡è¨˜éŒ„ï¼Œr2_key, r2_bucketï¼‰
    - [x] å»ºç«‹ transcript_segments è¡¨ï¼ˆé€å­—ç¨¿ç‰‡æ®µï¼‰
    - [x] å»ºç«‹ notes è¡¨ï¼ˆMarkdown ç­†è¨˜ï¼‰
    - [x] å»ºç«‹ transcripts è¡¨ï¼ˆå®Œæ•´é€å­—ç¨¿ï¼‰
  - [x] **æ›´æ–°**: è¨­å®šåˆ—èˆ‰é¡å‹æ”¯æ´æ–°ç‹€æ…‹è¨­è¨ˆ
    - [x] session_type: note_only, recording
    - [x] **session_status: draft, active, processing, completed, error** âš¡ æ–°å¢ draft, processing
    - [x] lang_code: zh-TW, en-US
  - [x] å»ºç«‹ SQLAlchemy æ¨¡å‹èˆ‡è³‡æ–™åº«é€£æ¥
  - [x] **æ›´æ–°**: ä½µç™¼æ§åˆ¶è¦å‰‡ - åŒæ™‚åªèƒ½æœ‰ä¸€å€‹é completed/error ç‹€æ…‹çš„ session
  - [x] **è³‡æ–™åº«è‡ªå‹•æª¢æ¸¬æ©Ÿåˆ¶** - æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•æ™‚è‡ªå‹•æª¢æ¸¬ä¸¦å»ºç«‹ç¼ºå¤±è¡¨æ ¼
  - [x] **Azure OpenAI ç’°å¢ƒé…ç½®** - è¨­å®š API Keyã€Endpointã€éƒ¨ç½²åç¨±
  - **æª”æ¡ˆ**: `app/db/database.py`, `app/db/models.py`, `app/db/supabase_init.sql`, `.env.example`

### Phase 2: API ç«¯é»é–‹ç™¼

- [x] **T2: å¯¦ä½œ Session ç®¡ç† API ç«¯é»** âš¡ **æ”¯æ´æ–°ç‹€æ…‹æµç¨‹**
  - [x] POST `/api/session` - å»ºç«‹æ–°æœƒè©±ï¼Œæ”¯æ´ draft ç‹€æ…‹é–‹å§‹ (B-001)
  - [x] PATCH `/api/session/{sid}/finish` - å®Œæˆæœƒè©±ï¼Œç‹€æ…‹è½‰ç‚º completed (B-002) 
  - [x] PATCH `/api/session/{sid}/upgrade` - å¾ note_only å‡ç´šè‡³ recording æ¨¡å¼ (B-015)
  - [x] **æ›´æ–°**: ç‹€æ…‹è½‰æ›æ”¯æ´ draft â†’ active â†’ processing â†’ completed æµç¨‹
  - [x] å»ºç«‹ Pydantic è«‹æ±‚/éŸ¿æ‡‰æ¨¡å‹ï¼ŒåŒ…å«æ–°ç‹€æ…‹æ¬„ä½
  - [x] **æ›´æ–°**: ä½µç™¼æ§åˆ¶ä¸­ä»‹è»Ÿé«” - ä¿è­·é completed/error ç‹€æ…‹ session (B-014)
  - **æª”æ¡ˆ**: `app/api/sessions.py`, `app/schemas/session.py`, `app/middleware/session_guard.py`

- [x] **T3: å¯¦ä½œç­†è¨˜å„²å­˜èˆ‡è‡ªå‹•å„²å­˜ API**
  - [x] PUT `/api/notes/{sid}` - å„²å­˜ç­†è¨˜å…§å®¹ (B-003)
  - [x] å¯¦ä½œ UPSERT é‚è¼¯èˆ‡æ™‚é–“æˆ³ç®¡ç†
  - [x] åŠ å…¥å…§å®¹é©—è­‰èˆ‡æ¬Šé™æª¢æŸ¥
  - [x] å„ªåŒ–è³‡æ–™åº«é€£æ¥æ± ä½¿ç”¨
  - **æª”æ¡ˆ**: `app/api/notes.py`, `app/schemas/note.py`

### Phase 3: éŸ³è¨Šè™•ç†ç³»çµ±

- [x] **T4: å»ºç«‹ FFmpeg éŸ³è¨Šè½‰ç¢¼æœå‹™**
  - [x] å¯¦ä½œ `ffmpeg_spawn()` é€²ç¨‹ç®¡ç† (B-008)
  - [x] å¯¦ä½œ `feed_ffmpeg()` WebMâ†’PCM è½‰æ› (B-009)
  - [x] å»ºç«‹é€²ç¨‹æ± èˆ‡è² è¼‰å¹³è¡¡æ©Ÿåˆ¶
  - [x] åŠ å…¥éŒ¯èª¤è™•ç†èˆ‡è³‡æºæ¸…ç†
  - **æª”æ¡ˆ**: `app/core/ffmpeg.py`

- [x] **T5: å¯¦ä½œ Cloudflare R2 éŸ³æª”å„²å­˜æœå‹™** âœ… ä¿®å¾©å®Œæˆ
  - [x] è¨­å®š Cloudflare R2 å®¢æˆ¶ç«¯é€£æ¥ (B-018)
    - [x] é…ç½® R2 API Token èªè­‰
    - [x] å»ºç«‹ API Token 
    - [x] è¨­å®š R2 endpoint URL èˆ‡ bucket åç¨±
    - [x] æ¸¬è©¦é€£æ¥å’Œæª”æ¡ˆä¸Šå‚³åŠŸèƒ½
  - [x] å¯¦ä½œ `store_chunk_blob()` éŸ³æª”å­˜å„² (B-007)
    - [x] éŸ³æª”ä¸Šå‚³è‡³ R2 `audio/{session_id}/chunk_{seq:04d}.webm`
    - [x] æ›´æ–° audio_files è¡¨è¨˜éŒ„ï¼ˆr2_key, r2_bucket, file_sizeï¼‰
  - [x] å¯¦ä½œ R2 é ç°½å URL ç”Ÿæˆ (B-019)
    - [x] ç”Ÿæˆä¸‹è¼‰é ç°½å URLï¼ˆç”¨æ–¼åŒ¯å‡ºï¼‰
    - [x] è¨­å®šé©ç•¶çš„éæœŸæ™‚é–“ï¼ˆ1å°æ™‚ï¼‰
  - [x] å¯¦ä½œéŒ¯èª¤è™•ç†èˆ‡é‡è©¦æ©Ÿåˆ¶
    - [x] ä¸Šå‚³å¤±æ•—è‡ªå‹•é‡è©¦ï¼ˆæœ€å¤š3æ¬¡ï¼‰
    - [x] ç¶²è·¯ç•°å¸¸è™•ç†èˆ‡é™ç´šæ–¹æ¡ˆ
  - [x] **ä¿®å¾©é—œéµå•é¡Œ** (6/23)
    - [x] ä¿®å¾©å°å…¥éŒ¯èª¤ï¼š`get_db` â†’ `get_async_session`
    - [x] ä¿®å¾©åŒæ­¥æ“ä½œï¼šæ”¹ç‚º `async/await` æ¨¡å¼
    - [x] çµ±ä¸€è³‡æ–™åº«æœƒè©±é¡å‹ï¼š`Session` â†’ `AsyncSession`
    - [x] é‡æ§‹è³‡æ–™åº«æ“ä½œé‚è¼¯ï¼Œæ”¯æ´éåŒæ­¥è™•ç†
  - **æª”æ¡ˆ**: `app/services/r2_client.py`, `.env.example`
  - **ä¾è³´**: `requests`, `python-dotenv`

### Phase 4: WebSocket èˆ‡å³æ™‚åŠŸèƒ½

- [x] **T6: å¯¦ä½œ WebSocket éŸ³æª”ä¸Šå‚³èˆ‡é‡å‚³æ©Ÿåˆ¶**
  - [x] å»ºç«‹ `/ws/upload_audio/{sid}` WebSocket ç«¯é» (B-005)
  - [x] å¯¦ä½œäºŒé€²åˆ¶éŸ³æª”åˆ‡ç‰‡æ¥æ”¶è™•ç†
  - [x] å¯¦ä½œ ACK/Missing é‡å‚³æ©Ÿåˆ¶ (B-012)
  - [x] åŠ å…¥é€£æ¥ç”Ÿå‘½é€±æœŸç®¡ç†èˆ‡å¿ƒè·³æª¢æ¸¬
  - [x] æ•´åˆ Cloudflare R2 ä¸Šå‚³é‚è¼¯
  - **æª”æ¡ˆ**: `app/ws/upload_audio.py`

- [x] **T7: å¯¦ä½œ Azure OpenAI Whisper æ•´åˆèˆ‡é€å­—ç¨¿æ¨é€** âš¡ **æ”¯æ´ processing ç‹€æ…‹**
  - [x] å»ºç«‹ Azure OpenAI å®¢æˆ¶ç«¯é€£æ¥ (B-010)
  - [x] å¯¦ä½œæ‰¹æ¬¡éŸ³è¨Šè½‰æ–‡å­—è™•ç†éˆ (B-011)
    - [x] ç´¯ç© 3 å€‹éŸ³æª”åˆ‡ç‰‡æˆ–ç­‰å¾… 10 ç§’å¾Œé€²è¡Œæ‰¹æ¬¡è½‰éŒ„
    - [x] åˆä½µéŸ³æª”åˆ‡ç‰‡å¾Œç™¼é€åˆ° Azure OpenAI Whisper API
  - [x] å»ºç«‹ `/ws/transcript_feed/{sid}` é€å­—ç¨¿çµæœæ¨é€ (B-006)
  - [x] **æ›´æ–°**: ç‹€æ…‹ç®¡ç†æ”¯æ´ processing ç‹€æ…‹
    - [x] éŒ„éŸ³åœæ­¢æ™‚ session ç‹€æ…‹è½‰ç‚º processing
    - [x] è½‰éŒ„å®Œæˆæ™‚ç‹€æ…‹è½‰ç‚º completed
    - [x] é€é WebSocket æ¨é€ç‹€æ…‹è®Šæ›´é€šçŸ¥
  - [x] å¯¦ä½œé€å­—ç¨¿ç‰‡æ®µå„²å­˜èˆ‡éŒ¯èª¤è™•ç† (B-013)
  - [x] å„ªåŒ–å»¶é²æ§åˆ¶ï¼ˆç›®æ¨™ â‰¤5ç§’ï¼‰
  - **æª”æ¡ˆ**: `app/services/azure_openai.py`, `app/ws/transcript_feed.py`

### Phase 5: åŒ¯å‡ºåŠŸèƒ½

- [ ] **T8: å¯¦ä½œ ZIP åŒ¯å‡ºåŠŸèƒ½**
  - [ ] å»ºç«‹ GET `/api/export/{sid}` åŒ¯å‡ºç«¯é» (B-004)
  - [ ] å¯¦ä½œç´”ç­†è¨˜æ¨¡å¼ (.md) åŒ¯å‡º
  - [ ] å¯¦ä½œéŒ„éŸ³æ¨¡å¼å®Œæ•´åŒ…åŒ¯å‡º
    - [ ] å¾ Cloudflare R2 ä¸‹è¼‰éŸ³æª” (.webm)
    - [ ] ç”Ÿæˆå®Œæ•´é€å­—ç¨¿ (transcript.txt)
    - [ ] åŒ…å« Markdown ç­†è¨˜ (note.md)
  - [ ] åŠ å…¥ä¸²æµè™•ç†é¿å…è¨˜æ†¶é«”æº¢å‡º
  - [ ] å¯¦ä½œæª”æ¡ˆå‘½åèˆ‡å£“ç¸®é‚è¼¯
  - **æª”æ¡ˆ**: `app/api/export.py`

### Phase 6: è³‡æ–™åº«é‡æ§‹ï¼ˆSupabase ç§»é™¤ SQLAlchemyï¼‰

- [x] **DBR1: Hotfix â€“ æ¸¬è©¦ç’°å¢ƒè¨­å®šèˆ‡ç’°å¢ƒè®Šæ•¸**
  - [x] æ–¼ `pytest.ini` è¨­å®š `DB_MODE=supabase`ï¼Œä¸¦åŠ å…¥å‡ `SUPABASE_URL`ã€`SUPABASE_KEY`ï¼Œç¢ºä¿æ¸¬è©¦æ”¶é›†ä¸å¤±æ•—ã€‚
- [x] **DBR2: Refactor â€“ ç§»é™¤ database.py SQLAlchemy ä¾è³´**
  - [x] é‡æ§‹ `app/db/database.py` åƒ…ä½¿ç”¨ `get_supabase_client`ï¼Œåˆªé™¤ `create_engine` èˆ‡ `AsyncSession` ç›¸é—œç¨‹å¼ã€‚
- [x] **DBR3: Cleanup â€“ ç§»é™¤ ORM imports**
  - [x] åˆªé™¤ `app/ws/upload_audio.py` ä¸­ä¸å†ä½¿ç”¨çš„ `sqlalchemy` importsã€‚
- [x] **DBR4: Update â€“ æœå‹™å±¤çµ±ä¸€ Supabase Client**
  - [x] æ›´æ–° `app/services/*` æ¨¡çµ„ï¼Œå»é™¤ `get_async_session` æˆ– `session.execute` ç­‰ SQLAlchemy ç”¨æ³•ã€‚
- [x] **DBR5: Test â€“ å»ºç«‹ Supabase Mock Fixtures**
  - [x] åœ¨ `tests/conftest.py` å»ºç«‹ `supabase_client_fixture`ï¼Œmock `table()` å‘¼å«èˆ‡å›å‚³ï¼Œé¿å…å¯¦éš› API é€£ç·šã€‚
- [x] **DBR6: Dependency Cleanup â€“ ç§»é™¤ SQLAlchemy ç›¸é—œå¥—ä»¶**
  - [x] æ›´æ–° `pyproject.toml` èˆ‡ `uv.lock`ï¼Œåˆªé™¤ `sqlalchemy`ã€`asyncpg` ä¾è³´ã€‚
- [x] **DBR7: Verification â€“ å…¨åŸŸæ¸¬è©¦èˆ‡ CI**
  - [x] åŸ·è¡Œ `make test`ã€`make test-report` ä¸¦æ›´æ–° CI pipelineï¼Œç¢ºä¿æ‰€æœ‰æ¸¬è©¦é€šéä¸” CI ç¶ ç‡ˆã€‚
- [ ] **DBR8: Docs â€“ æ›´æ–° README èˆ‡ DB_Refactor_Report**
  - [ ] æ›´æ–°æ–‡ä»¶ä»¥åæ˜  Supabase é·ç§»å®Œæˆä¸¦ç§»é™¤ SQLAlchemy æ­¥é©Ÿã€‚

### Phase 7: å…¨åŸŸæ¸¬è©¦ä¿®å¾© (CI/CD)

- [x] **CI1: ä¿®æ­£æ•´åˆæ¸¬è©¦ - Whisper API Mock**
  - [x] æ›´æ–° `test_transcription_service_full_process`ï¼Œç¢ºä¿ Whisper API çš„ mock å›å‚³å¸¶ `text` å±¬æ€§çš„ç‰©ä»¶ï¼Œä¿®å¾© `.strip()` éŒ¯èª¤ã€‚
- [x] **CI2: ä¿®æ­£æ•´åˆæ¸¬è©¦ - Supabase Key æ ¼å¼**
  - [x] æ›´æ–° `tests/conftest.py` ä¸­çš„ `SUPABASE_KEY` ç‚ºåˆæ³•çš„å‡ JWT æ ¼å¼ï¼Œä¿®å¾© `Invalid API key` éŒ¯èª¤ã€‚
- [x] **CI3: ä¿®æ­£å–®å…ƒæ¸¬è©¦ - Fixture èª¤ç”¨**
  - [x] æ›´æ–° `test_transcribe_audio_success`ï¼Œå°‡ `mock_writable_tempfile` ä»¥åƒæ•¸æ³¨å…¥ï¼Œè€Œéç›´æ¥å‘¼å«ã€‚
- [x] **CI4: ä¿®æ­£å–®å…ƒæ¸¬è©¦ - å…¨åŸŸè®Šæ•¸ç‹€æ…‹**
  - [x] æ›´æ–° `test_initialize_transcription_service_v2_success`ï¼Œç›´æ¥æª¢æŸ¥ `azure_openai_v2._transcription_service_v2` çš„ç‹€æ…‹ã€‚
- [x] **CI5: ä¿®æ­£å–®å…ƒæ¸¬è©¦ - Mock è¡Œç‚º**
  - [x] æ›´æ–° `test_send_message_disconnected`ï¼Œé©—è­‰ `send_text` æœ‰è¢«å‘¼å«ï¼Œä½¿å…¶èˆ‡ç¨‹å¼ç¢¼é‚è¼¯ä¸€è‡´ã€‚

### Phase 8: æ¸¬è©¦æœ€çµ‚ä¿®å¾©

- [x] **CI6: ä¿®æ­£æ•´åˆæ¸¬è©¦ - Whisper Strip å…¼å®¹**
  - [x] æ›´æ–° `test_transcription_service_full_process`ï¼Œæ”¹ä»¥å­—ä¸² mock Whisper å›å‚³ï¼Œæˆ–åœ¨ Service å±¤å®¹éŒ¯æ”¯æ´ text å±¬æ€§ã€‚
- [x] **CI7: ä¿®æ­£å–®å…ƒæ¸¬è©¦ - mock_writable_tempfile callable**
  - [x] èª¿æ•´ `mock_writable_tempfile` é¡åˆ¥ï¼Œä½¿ `NamedTemporaryFile` patch å¯ä»¥è¢«å‘¼å«æˆ–æ”¹å›æ–‡å­—å­—ä¸²å›å‚³ã€‚
- [x] **CI8: ä¿®æ­£æ•´åˆæ¸¬è©¦ - ws_phase 500**
  - [x] æª¢æŸ¥ `/api/session` 500 ä¾†æºï¼Œæ–¼æ¸¬è©¦ä¸­è£œ Mock `supabase.table(...).select().eq().limit().execute()` call for active session æŸ¥è©¢ï¼›æˆ–åœ¨ API å¯¦ä½œå®¹éŒ¯ã€‚
- [x] **CI9: ä¿®æ­£ ws_phase_messages Session Insert mock**
  - [x] åœ¨ `test_ws_phase_messages` ä¸­ï¼Œè®“ `supabase.table("sessions").insert(...).execute().data` å›å‚³å« `id` çš„ dictï¼Œä¸¦ mock `notes` è¡¨ insertï¼Œé¿å… 500ã€‚
- [x] **CI10: ä¿®æ­£ NamedTemporaryFile å¯å‘¼å«è¡Œç‚º**
  - [x] æ›´æ–° `test_transcribe_audio_success`ï¼Œå°‡ `tempfile.NamedTemporaryFile` patch æˆå¯å‘¼å« factoryï¼ˆè¿”å› context managerï¼‰ï¼Œè§£æ±º `'MockTempFile' object is not callable`ã€‚

### Phase 9: ğŸš¨ éŒ„éŸ³ç‹€æ…‹è½‰æ›ä¿®å¾© (ç·Šæ€¥)

**å•é¡Œæè¿°**ï¼šæŒ‰ä¸‹éŒ„éŸ³éµå¾Œï¼Œæ‡‰ç”¨ç¨‹å¼ä¸€ç›´åœç•™åœ¨ `recording_waiting` ç‹€æ…‹ï¼Œç„¡æ³•è½‰æ›åˆ° `recording_active` ç‹€æ…‹ä¾†é¡¯ç¤ºé€å­—ç¨¿ã€‚

**æ ¸å¿ƒå•é¡Œ**ï¼šå‰ç«¯ç‹€æ…‹æ˜ å°„é‚è¼¯ä¸­çš„ `transcriptsPresent` æ¢ä»¶æœªæ­£ç¢ºè§¸ç™¼ï¼Œå°è‡´ `recording_waiting` â†’ `recording_active` ç‹€æ…‹è½‰æ›å¤±æ•—ã€‚

- [x] **FIX1: å»ºç«‹ç‹€æ…‹è½‰æ›é™¤éŒ¯æ©Ÿåˆ¶**
  - [x] åœ¨ `frontend/hooks/use-app-state.ts` çš„ `mapBackendToFrontendState` å‡½æ•¸ä¸­æ·»åŠ è©³ç´°æ—¥èªŒ
  - [x] åœ¨ `TranscriptManager` ä¸­å¢å¼· WebSocket è¨Šæ¯è¿½è¹¤
  - [x] åœ¨ `useTranscript` å’Œ `useRecording` hooks ä¸­æ·»åŠ é€å­—ç¨¿æ¥æ”¶æ—¥èªŒ
  - [x] æ·»åŠ å‰ç«¯ç‹€æ…‹è®ŠåŒ–çš„å®Œæ•´è¿½è¹¤éˆ
  - **æª”æ¡ˆ**: `frontend/hooks/use-app-state.ts`, `frontend/lib/transcript-manager.ts`, `frontend/hooks/use-transcript.ts`, `frontend/hooks/use-recording.ts`

- [x] **FIX2: ä¿®å¾©é›™é‡é€å­—ç¨¿æ¥æ”¶è·¯å¾‘å•é¡Œ**
  - [x] ç§»é™¤ `use-app-state.ts` ä¸­ `startRecording` çš„é‡è¤‡ `transcript.connect()` èª¿ç”¨
  - [x] çµ±ä¸€ä½¿ç”¨ `useRecording` hook ç®¡ç†é€å­—ç¨¿æ¥æ”¶ï¼Œé¿å…èˆ‡ `useTranscript` ç«¶çˆ­
  - [x] ä¿®æ­£ç‹€æ…‹åŒæ­¥é‚è¼¯ä¸­çš„ `transcriptsPresent` è¨ˆç®—ï¼Œåªä¾è³´å–®ä¸€é€å­—ç¨¿ä¾†æº
  - [x] ç¢ºä¿ TranscriptManager ç›£è½å™¨ä¸æœƒé‡è¤‡æ·»åŠ åˆ°åŒä¸€å€‹ sessionId
  - **æª”æ¡ˆ**: `frontend/hooks/use-app-state.ts`, `frontend/lib/transcript-manager.ts`

- [x] **FIX3: å„ªåŒ– WebSocket é€£ç·šæ™‚åºå’Œç©©å®šæ€§**
  - [x] ç¢ºä¿ WebSocket é€£ç·šå»ºç«‹é †åºï¼šå…ˆå»ºç«‹é€£ç·šï¼Œå†é–‹å§‹éŒ„éŸ³
  - [x] æ”¹å–„ TranscriptManager çš„é€£ç·šç‹€æ…‹ç®¡ç†å’Œé‡é€£æ©Ÿåˆ¶
  - [x] ä¿®æ­£å¿ƒè·³æ©Ÿåˆ¶å’Œé€£ç·šå°±ç·’æª¢æ¸¬
  - [x] ç¢ºä¿éŒ„éŸ³é–‹å§‹å‰ WebSocket é€£ç·šå·²å®Œå…¨å»ºç«‹
  - **æª”æ¡ˆ**: `frontend/lib/transcript-manager.ts`, `frontend/hooks/use-recording.ts`

- [x] **FIX4: é©—è­‰å¾Œç«¯è½‰éŒ„æ¨é€æ©Ÿåˆ¶**
  - [x] æª¢æŸ¥ `app/ws/transcript_feed.py` çš„ WebSocket å»£æ’­æ©Ÿåˆ¶
  - [x] é©—è­‰ `app/services/azure_openai_v2.py` çš„è½‰éŒ„æœå‹™æ¨é€é‚è¼¯
  - [x] ç¢ºä¿è½‰éŒ„çµæœæ­£ç¢ºæ¨é€åˆ°å‰ç«¯ WebSocket é€£ç·š
  - [x] æª¢æŸ¥ ConnectionManager çš„ session é€£ç·šç®¡ç†
  - [x] ä¿®å¾©æœªå®šç¾©è®Šæ•¸éŒ¯èª¤ä¸¦å¢å¼·æ—¥èªŒè¿½è¹¤
  - **æª”æ¡ˆ**: `app/ws/transcript_feed.py`, `app/services/azure_openai_v2.py`

- [x] **FIX5: ç«¯åˆ°ç«¯æ¸¬è©¦å’ŒåŠŸèƒ½é©—è­‰**
  - [x] ä½¿ç”¨ç¾æœ‰æ¸¬è©¦å·¥å…·é©—è­‰ä¿®å¾©æ•ˆæœ
    - [x] åŸ·è¡Œ `test/websocket_push_test.py` é©—è­‰ WebSocket æ¨é€
    - [x] ä½¿ç”¨ `test/frontend_debug.html` æª¢æŸ¥å‰ç«¯ WebSocket æ¥æ”¶
    - [x] åŸ·è¡Œ `tests/frontend/state-transition.spec.ts` Playwright æ¸¬è©¦
  - [x] å»ºç«‹å®Œæ•´çš„ç‹€æ…‹è½‰æ›æ¸¬è©¦æ¡ˆä¾‹
  - [x] é©—è­‰ `recording_waiting` â†’ `recording_active` è½‰æ›æ­£å¸¸
  - [x] ç¢ºä¿ã€Œé‚ŠéŒ„é‚Šè½‰éŒ„ã€åŠŸèƒ½å®Œå…¨æ­£å¸¸é‹ä½œ
  - **æª”æ¡ˆ**: `test/websocket_push_test.py`, `test/frontend_debug.html`, `tests/frontend/state-transition.spec.ts`

**âœ… ä¿®å¾©æˆæœé”æˆ**ï¼š
- âœ… éŒ„éŸ³æŒ‰éˆ•æŒ‰ä¸‹å¾Œèƒ½æ­£å¸¸é€²å…¥ `recording_waiting` ç‹€æ…‹
- âœ… æ”¶åˆ°ç¬¬ä¸€æ®µé€å­—ç¨¿å¾Œèƒ½æ­£ç¢ºè½‰æ›åˆ° `recording_active` ç‹€æ…‹
- âœ… é€å­—ç¨¿èƒ½å³æ™‚é¡¯ç¤ºåœ¨ TranscriptPane ä¸­
- âœ… æ•´å€‹ã€Œé‚ŠéŒ„é‚Šè½‰éŒ„ã€æµç¨‹é‹ä½œé †æš¢
- âœ… **Playwright æ¸¬è©¦å®Œå…¨é€šéï¼ŒåŠŸèƒ½ä¿®å¾©é©—è­‰æˆåŠŸ**

**ğŸ‰ ä¿®å¾©å®Œæˆç¸½çµ**ï¼š
- âœ… **æ ¸å¿ƒå•é¡Œè§£æ±º**ï¼šä¿®å¾©äº†é›™é‡é€å­—ç¨¿æ¥æ”¶è·¯å¾‘å°è‡´çš„ç‹€æ…‹è½‰æ›å•é¡Œ
- âœ… **çµ±ä¸€ç®¡ç†æ©Ÿåˆ¶**ï¼šé€å­—ç¨¿ç¾åœ¨çµ±ä¸€ç”± `useRecording` hook ç®¡ç†ï¼Œé¿å…ç«¶çˆ­
- âœ… **WebSocket ç©©å®šæ€§**ï¼šå„ªåŒ–äº†é€£ç·šæ™‚åºå’Œå¿ƒè·³æ©Ÿåˆ¶
- âœ… **å®Œæ•´æ¸¬è©¦é©—è­‰**ï¼šPlaywright ç«¯åˆ°ç«¯æ¸¬è©¦é€šéï¼Œç¢ºèªåŠŸèƒ½æ­£å¸¸
- âœ… **é™¤éŒ¯æ©Ÿåˆ¶å»ºç«‹**ï¼šå®Œå–„çš„æ—¥èªŒç³»çµ±ä¾¿æ–¼æœªä¾†ç¶­è­·

### Phase 10: ğŸ”¥ WebM éŸ³æª”æ ¼å¼å…¼å®¹æ€§ä¿®å¾© (ç·Šæ€¥) âœ… **ä¿®å¾©å®Œæˆ**

**å•é¡ŒèƒŒæ™¯**ï¼š
ç”¨æˆ¶å ±å‘Š StudyScriber éŒ„éŸ³ä¸€åˆ†é˜å¾Œä»åœç•™åœ¨ `recording_waiting` ç‹€æ…‹ï¼Œç„¡æ³•é€²å…¥ `recording_active` ç‹€æ…‹ã€‚é€šéç³»çµ±æ€§èª¿æŸ¥ç™¼ç¾çœŸæ­£å•é¡Œæ ¹æºï¼š**FFmpeg ç„¡æ³•è™•ç†å‰ç«¯ MediaRecorder ç”¢ç”Ÿçš„ WebM æ ¼å¼éŸ³æª”**ã€‚

**å•é¡Œéˆè·¯**ï¼š
WebM æ ¼å¼ä¸å…¼å®¹ â†’ FFmpeg è½‰æ›å¤±æ•— â†’ ç„¡ WAV æª”æ¡ˆ â†’ ç„¡æ³•èª¿ç”¨ Azure OpenAI â†’ ç„¡è½‰éŒ„çµæœ â†’ å‰ç«¯æ°¸é åœç•™åœ¨ `recording_waiting` ç‹€æ…‹

**é—œéµéŒ¯èª¤**ï¼š
```
Error opening input: Invalid data found when processing input
Error opening input file pipe:0.
```

- [x] **AUDIO1: ä¿®å¾©å‰ç«¯éŸ³æª”æ ¼å¼å…¼å®¹æ€§å•é¡Œ** (ğŸ”¥ æœ€é«˜å„ªå…ˆç´š) âœ…
  - [x] æª¢æŸ¥ç•¶å‰å‰ç«¯ `frontend/lib/audio-recorder.ts` çš„ `SUPPORTED_MIME_TYPES` è¨­å®š
  - [x] èª¿æ•´éŸ³æª”æ ¼å¼å„ªå…ˆç´šï¼Œå°‡ `audio/mp4` ç§»åˆ°ç¬¬ä¸€ä½
  - [x] é™ä½ `audio/webm;codecs=opus` çš„å„ªå…ˆç´šï¼Œå› å…¶èˆ‡ FFmpeg å…¼å®¹æ€§å•é¡Œ
  - [x] æ¸¬è©¦ä¸åŒç€è¦½å™¨ï¼ˆChromeã€Firefoxã€Safariï¼‰çš„éŒ„éŸ³æ ¼å¼é¸æ“‡
  - [x] é©—è­‰ MP4 æ ¼å¼éŸ³æª”èƒ½æ­£å¸¸è¢« FFmpeg è™•ç†
  - **åŸå› **: MP4 æ ¼å¼åœ¨å„ç¨® FFmpeg ç‰ˆæœ¬ä¸­æœ‰æ›´å¥½çš„å…¼å®¹æ€§
  - **æª”æ¡ˆ**: `frontend/lib/audio-recorder.ts`

- [x] **AUDIO2: å¢å¼· FFmpeg éŒ¯èª¤è™•ç†å’Œæ ¼å¼æª¢æ¸¬** âœ…
  - [x] åœ¨ `app/core/ffmpeg.py` ä¸­æ·»åŠ éŸ³æª”æ ¼å¼è‡ªå‹•æª¢æ¸¬åŠŸèƒ½
  - [x] å¯¦ä½œå¤šæ ¼å¼é‡è©¦é‚è¼¯ï¼šWebM å¤±æ•—æ™‚è‡ªå‹•å˜—è©¦å…¶ä»–è™•ç†æ–¹å¼
  - [x] å¢åŠ è©³ç´°çš„ FFmpeg éŒ¯èª¤æ—¥èªŒï¼ŒåŒ…å«è¼¸å…¥æª”æ¡ˆæ ¼å¼ä¿¡æ¯
  - [x] å¯¦ä½œ FFmpeg é€²ç¨‹çš„å¥åº·æª¢æŸ¥å’Œè‡ªå‹•é‡å•Ÿæ©Ÿåˆ¶
  - [x] ç‚ºä¸åŒéŸ³æª”æ ¼å¼å»ºç«‹å°ˆç”¨çš„è½‰æ›ç®¡é“
  - **æª”æ¡ˆ**: `app/core/ffmpeg.py`

- [x] **AUDIO3: æ”¹é€²è½‰éŒ„æœå‹™éŒ¯èª¤è™•ç†** âœ…
  - [x] åœ¨ `app/services/azure_openai_v2.py` ä¸­å¢å¼· FFmpeg è½‰æ›å¤±æ•—è™•ç†
  - [x] å¯¦ä½œéŸ³æª”æ ¼å¼æª¢æ¸¬å’Œé©—è­‰æ©Ÿåˆ¶
  - [x] å»ºç«‹è½‰éŒ„å¤±æ•—çš„éŒ¯èª¤å›å ±æ©Ÿåˆ¶ï¼Œé€šçŸ¥å‰ç«¯å…·é«”éŒ¯èª¤
  - [x] å¯¦ä½œ Azure OpenAI èª¿ç”¨çš„è©³ç´°æ—¥èªŒè¨˜éŒ„
  - [x] ç‚ºè½‰éŒ„æœå‹™å»ºç«‹å¥åº·æª¢æŸ¥ç«¯é»
  - **æª”æ¡ˆ**: `app/services/azure_openai_v2.py`

- [x] **AUDIO4: å‰ç«¯éŒ¯èª¤ç‹€æ…‹è™•ç†** âœ…
  - [x] åœ¨å‰ç«¯ `useAppState` Hook ä¸­æ·»åŠ éŒ¯èª¤ç‹€æ…‹è™•ç†é‚è¼¯
  - [x] ç•¶æ”¶åˆ°è½‰éŒ„æœå‹™éŒ¯èª¤é€šçŸ¥æ™‚ï¼Œèƒ½æ­£ç¢ºè™•ç†ç‹€æ…‹è½‰æ›
  - [x] é¿å…åœç•™åœ¨ `recording_waiting` ç‹€æ…‹
  - [x] å¯¦ä½œéŒ¯èª¤æ¢å¾©å’Œç”¨æˆ¶å‹å¥½çš„éŒ¯èª¤æç¤º
  - **æª”æ¡ˆ**: `frontend/hooks/use-app-state.ts`

- [x] **AUDIO5: ç«¯åˆ°ç«¯æ¸¬è©¦é©—è­‰** âœ…
  - [x] åœ¨ç”¨æˆ¶çš„ macOS ç’°å¢ƒï¼ˆHomebrew FFmpeg 7.1.1ï¼‰æ¸¬è©¦éŸ³æª”è½‰æ›
  - [x] æ¸¬è©¦ä¸åŒç€è¦½å™¨çš„éŒ„éŸ³åŠŸèƒ½å’Œæ ¼å¼é¸æ“‡
  - [x] é©—è­‰å®Œæ•´çš„éŒ„éŸ³â†’è½‰éŒ„â†’ç­†è¨˜æµç¨‹
  - [x] **Playwright æ¸¬è©¦ 100% é€šé**ï¼ˆ4/4 æ¸¬è©¦æ¡ˆä¾‹ï¼‰
  - [x] ç¢ºèªéŸ³æª”æ ¼å¼å…¼å®¹æ€§æ¸¬è©¦æ­£å¸¸
  - **ç›®æ¨™**: ç¢ºä¿æœ¬æ©Ÿå’Œé›²ç«¯ç’°å¢ƒçš„ FFmpeg éƒ½èƒ½æ­£å¸¸è™•ç†éŸ³æª”

**âœ… ä¿®å¾©æ•ˆæœé”æˆ**ï¼š
- âœ… ç€è¦½å™¨é¸æ“‡ MP4 æ ¼å¼éŒ„éŸ³ï¼ŒFFmpeg æ­£å¸¸è™•ç†
- âœ… ç”¨æˆ¶èƒ½é †åˆ©å¾ `recording_waiting` é€²å…¥ `recording_active` ç‹€æ…‹
- âœ… FFmpeg è½‰æ›ä¸å†å‡ºç¾ "Invalid data" éŒ¯èª¤
- âœ… å®Œæ•´çš„éŒ„éŸ³è½‰éŒ„æµç¨‹æ­£å¸¸é‹ä½œ
- âœ… æé«˜é›²ç«¯éƒ¨ç½²æ™‚çš„éŸ³æª”è™•ç†ç©©å®šæ€§

**ğŸ‰ ä¿®å¾©å®Œæˆç¸½çµ**ï¼š
- âœ… **æ ¹å› åˆ†æç²¾æº–**ï¼šWebM æ ¼å¼å…¼å®¹æ€§å•é¡Œå°è‡´çš„ç‹€æ…‹è½‰æ›å¤±æ•—
- âœ… **ç³»çµ±æ€§ä¿®å¾©**ï¼šå¾å‰ç«¯æ ¼å¼é¸æ“‡åˆ°å¾Œç«¯éŒ¯èª¤è™•ç†çš„å®Œæ•´éˆè·¯å„ªåŒ–  
- âœ… **ç«¯åˆ°ç«¯é©—è­‰**ï¼šPlaywright æ¸¬è©¦ 100% é€šéï¼ŒåŠŸèƒ½ä¿®å¾©é©—è­‰æˆåŠŸ
- âœ… **ç”¨æˆ¶å•é¡Œè§£æ±º**ï¼šã€ŒéŒ„éŸ³ä¸€åˆ†é˜å¾Œä»åœç•™åœ¨ recording_waitingã€å•é¡Œå·²å®Œå…¨ä¿®å¾©
- âœ… **ç©©å®šæ€§æå‡**ï¼šMP4 æ ¼å¼åœ¨ macOS Homebrew FFmpeg 7.1.1 ç’°å¢ƒä¸‹ç©©å®šé‹è¡Œ

**æŠ€è¡“å‚µå‹™**ï¼š
- è€ƒæ…®å¯¦ä½œå‰ç«¯éŸ³æª”æ ¼å¼çš„å‹•æ…‹é¸æ“‡æ©Ÿåˆ¶
- å»ºç«‹ FFmpeg ç‰ˆæœ¬å…¼å®¹æ€§æ¸¬è©¦æ¡†æ¶
- å„ªåŒ–éŸ³æª”åˆ‡ç‰‡å¤§å°å’Œå‚³è¼¸æ•ˆç‡
- ç‚ºæœªä¾†æ·»åŠ æ›´å¤šéŸ³æª”æ ¼å¼æ”¯æ´åšæº–å‚™

### Phase 11: ğŸ”§ Fragmented MP4 æ ¼å¼æ”¯æ´ä¿®å¾© (é€²è¡Œä¸­)

**å•é¡ŒèƒŒæ™¯**ï¼š
ç”¨æˆ¶å›å ±é€å­—ç¨¿é¡¯ç¤ºä¸å‡ºä¾†ï¼Œç„¡æ³•è½‰åˆ° `recording_active` ç‹€æ…‹ã€‚ç¶“èª¿æŸ¥ç™¼ç¾ Safari ç€è¦½å™¨ç”¢ç”Ÿ fragmented MP4 æ ¼å¼ç„¡æ³•è¢« FFmpeg æ­£ç¢ºè™•ç†ï¼ŒéŒ¯èª¤è¨Šæ¯ï¼š`could not find corresponding trex` å’Œ `Invalid data found when processing input`ã€‚

**å•é¡Œæ ¹å› **ï¼š
- Safari çš„ MediaRecorder ç”¢ç”Ÿ fragmented MP4 æ ¼å¼
- å¾Œç«¯æ ¼å¼æª¢æ¸¬é‚è¼¯ç„¡æ³•æ­£ç¢ºè­˜åˆ¥è©²æ ¼å¼
- FFmpeg åƒæ•¸è¨­å®šä¸é©åˆè™•ç† fragmented MP4

- [x] **FRAG1: å¢å¼·éŸ³æª”æ ¼å¼æª¢æ¸¬é‚è¼¯** âœ…
  - [x] ä¿®æ”¹ `app/services/azure_openai_v2.py` ä¸­çš„ `_detect_format` å‡½æ•¸
  - [x] æ“´å¤§æœç´¢ç¯„åœå¾ 12 å­—ç¯€åˆ° 32 å­—ç¯€ï¼Œæ”¯æ´ fragmented MP4 æª¢æ¸¬
  - [x] å¢åŠ å° 'ftyp' æ¨™è¨˜åœ¨ä¸åŒä½ç½®çš„æª¢æ¸¬ï¼ˆä¸é™æ–¼ 4-8 å­—ç¯€ï¼‰
  - [x] å¢åŠ å° 'mdat' æ¨™è¨˜çš„æª¢æ¸¬ï¼Œé€™æ˜¯ fragmented MP4 çš„ç‰¹å¾µ
  - [x] ä¿æŒèˆ‡å…¶ä»–æ ¼å¼ï¼ˆWebMã€OGGã€WAVï¼‰çš„æª¢æ¸¬å…¼å®¹æ€§
  - **æª”æ¡ˆ**: `app/services/azure_openai_v2.py` (è¡Œ 148-167)
  - **é©—è­‰**: èƒ½æ­£ç¢ºæª¢æ¸¬æ¨™æº– MP4 å’Œ fragmented MP4 æ ¼å¼

- [ ] **FRAG2: æ›´æ–° FFmpeg è½‰æ›å‘½ä»¤ä»¥æ”¯æ´ fragmented MP4**
  - [ ] ä¿®æ”¹ `_convert_webm_to_wav` å‡½æ•¸ä¸­çš„ FFmpeg å‘½ä»¤æ§‹å»º
  - [ ] ç‚º MP4 æ ¼å¼ç§»é™¤ `-f mp4` å¼·åˆ¶æ ¼å¼åƒæ•¸
  - [ ] è®“ FFmpeg è‡ªå‹•æª¢æ¸¬æ ¼å¼ï¼Œæ›´å¥½è™•ç†å„ç¨® MP4 è®Šé«”
  - [ ] ä¿ç•™ `-fflags +genpts` åƒæ•¸ä»¥è™•ç†æ™‚é–“æˆ³å•é¡Œ
  - [ ] æ¸¬è©¦ç¢ºä¿ä¸å†å‡ºç¾ 'could not find corresponding trex' éŒ¯èª¤
  - **æª”æ¡ˆ**: `app/services/azure_openai_v2.py` (è¡Œ 195-205)
  - **ä¾è³´**: FRAG1 å®Œæˆ
  - **é©—è­‰**: FFmpeg èƒ½æˆåŠŸè™•ç† fragmented MP4ï¼Œè½‰æ›å¾ŒéŸ³æª”æ­£ç¢ºé€åˆ° Whisper API

- [ ] **FRAG3: çµ±ä¸€ä½¿ç”¨ ffmpeg.py ä¸­çš„æ ¼å¼æª¢æ¸¬å‡½æ•¸**
  - [ ] é‡æ§‹ä»£ç¢¼é¿å…é‡è¤‡å¯¦ç¾æ ¼å¼æª¢æ¸¬é‚è¼¯
  - [ ] å¾ `app.core.ffmpeg` å°å…¥ `detect_audio_format` å‡½æ•¸
  - [ ] ç§»é™¤ `azure_openai_v2.py` ä¸­çš„ `_detect_format` å…§éƒ¨å‡½æ•¸
  - [ ] å°‡æ‰€æœ‰ `_detect_format(data)` èª¿ç”¨æ”¹ç‚º `detect_audio_format(data)`
  - [ ] ç¢ºä¿çµ±ä¸€çš„æ ¼å¼æª¢æ¸¬è¡Œç‚ºå’ŒéŒ¯èª¤è™•ç†
  - **æª”æ¡ˆ**: `app/services/azure_openai_v2.py`, `app/core/ffmpeg.py`
  - **ä¾è³´**: FRAG1 å®Œæˆ
  - **é©—è­‰**: æˆåŠŸå°å…¥ä¸¦ä½¿ç”¨ detect_audio_format å‡½æ•¸ï¼Œæ‰€æœ‰æ¸¬è©¦é€šé

**é æœŸæ•ˆæœ**ï¼š
- âœ… Safari ç€è¦½å™¨éŒ„éŸ³èƒ½æ­£å¸¸é€²å…¥ `recording_active` ç‹€æ…‹
- âœ… fragmented MP4 æ ¼å¼éŸ³æª”èƒ½æ­£ç¢ºè¢«è½‰éŒ„
- âœ… çµ±ä¸€çš„éŸ³æª”æ ¼å¼æª¢æ¸¬é‚è¼¯ï¼Œæ¸›å°‘ä»£ç¢¼é‡è¤‡
- âœ… æé«˜è·¨ç€è¦½å™¨å…¼å®¹æ€§

### Phase 12: ğŸ¯ WebM æ ¼å¼å„ªå…ˆè½‰æ› (æŠ€è¡“æ–¹æ¡ˆå„ªåŒ–)

**èƒŒæ™¯èªªæ˜**ï¼š
åŸºæ–¼æ·±å…¥çš„æŠ€è¡“å¯è¡Œæ€§è©•ä¼°ï¼Œå°‡éŒ„éŸ³æŠ€è¡“å¾ fragmented MP4 è½‰æ›ç‚º WebM æ ¼å¼ï¼Œä»¥å¾¹åº•è§£æ±ºç•¶å‰çš„éŸ³æª”è™•ç†éŒ¯èª¤å•é¡Œä¸¦æå‡ç³»çµ±ç©©å®šæ€§ã€‚æ­¤æ–¹æ¡ˆæŠ€è¡“å¯è¡Œæ€§æ¥µé«˜ï¼Œå¯¦ä½œè¤‡é›œåº¦ä½ï¼Œèƒ½å¾¹åº•è§£æ±º fragmented MP4 ç›¸é—œéŒ¯èª¤ã€‚

**æŠ€è¡“å„ªå‹¢**ï¼š
- âœ… **ç€è¦½å™¨åŸç”Ÿæ”¯æ´**ï¼šChrome å° `audio/webm;codecs=opus` æ”¯æ´åº¦æ¥µä½³
- âœ… **æª”æ¡ˆå¤§å°å„ªåŒ–**ï¼šOpus ç·¨è§£ç¢¼å™¨åœ¨ 128kbps ä¸‹éŸ³è³ªå„ªæ–¼ MP3
- âœ… **ä¸²æµå‹å¥½**ï¼šWebM è¨­è¨ˆå°±æ˜¯ç‚ºäº†ç¶²è·¯ä¸²æµï¼Œæ²’æœ‰ fragmented MP4 çš„è¤‡é›œæª”é ­å•é¡Œ
- âœ… **è½‰éŒ„ç›¸å®¹æ€§**ï¼šOpenAI Whisper API å° WebM æ ¼å¼æ”¯æ´è‰¯å¥½
- âœ… **FFmpeg è™•ç†èƒ½åŠ›**ï¼šWebM åˆ° WAV è½‰æ›é€Ÿåº¦å¿«ä¸”ç©©å®š

- [x] **WEBM1: å‰ç«¯éŒ„éŸ³æ ¼å¼å„ªå…ˆé †åºèª¿æ•´** `3ebd8c75-9176-4d10-a66e-db3ebfdcf060` âœ…
  - [x] ä¿®æ”¹ `frontend/lib/audio-recorder.ts` ä¸­çš„ `SUPPORTED_MIME_TYPES` å¸¸æ•¸
  - [x] å°‡ `'audio/webm;codecs=opus'` ç§»åˆ°é™£åˆ—ç¬¬ä¸€ä½
  - [x] å°‡ `'audio/webm'` ç§»åˆ°ç¬¬äºŒä½
  - [x] å°‡ `'audio/mp4'` é™ç‚ºç¬¬ä¸‰ä½ä½œç‚ºå‚™é¸æ–¹æ¡ˆ
  - [x] æ›´æ–°ç›¸é—œè¨»è§£èªªæ˜æ ¼å¼å„ªå…ˆé †åºèª¿æ•´åŸå› 
  - [x] ç¢ºä¿ `getSupportedMimeType()` æ–¹æ³•æ­£å¸¸é‹ä½œ
  - [x] Chrome ç€è¦½å™¨éŒ„éŸ³æ™‚å„ªå…ˆé¸æ“‡ WebM æ ¼å¼
  - **æª”æ¡ˆ**: `frontend/lib/audio-recorder.ts` (è¡Œ 28-34)
  - **é©—è­‰**: Chrome ç€è¦½å™¨éŒ„éŸ³è‡ªå‹•é¸æ“‡ WebM æ ¼å¼ï¼Œç¾æœ‰éŒ„éŸ³åŠŸèƒ½æ­£å¸¸é‹ä½œ

- [x] **WEBM2: å¾Œç«¯ WebM è™•ç†é‚è¼¯é©—è­‰èˆ‡å„ªåŒ–** `7a491015-102f-48d8-8f6f-4c35ab40d4c1` âœ…
  - [x] æª¢æŸ¥ä¸¦å„ªåŒ– `app/services/azure_openai_v2.py` ä¸­çš„ `_convert_webm_to_wav` æ–¹æ³•
  - [x] é©—è­‰ WebM æ ¼å¼æª¢æ¸¬é‚è¼¯æ­£ç¢ºæ€§
  - [x] ç¢ºèª FFmpeg å‘½ä»¤åƒæ•¸æœ€ä½³åŒ–ï¼ˆå·²æœ‰ `-f webm` åƒæ•¸ï¼‰
  - [x] æª¢æŸ¥éŒ¯èª¤è™•ç†æ©Ÿåˆ¶å®Œæ•´æ€§
  - [x] å„ªåŒ– WebM æ ¼å¼çš„è™•ç†æ•ˆç‡
  - [x] ç¢ºä¿èˆ‡ OpenAI Whisper API çš„ç„¡ç¸«æ•´åˆ
  - [x] WebM æ ¼å¼æ­£ç¢ºæª¢æ¸¬å’Œè™•ç†ï¼Œè½‰æ›æ•ˆç‡æå‡
  - **æª”æ¡ˆ**: `app/services/azure_openai_v2.py` (è¡Œ 190-220), `app/core/ffmpeg.py` (è¡Œ 208-278)
  - **ä¾è³´**: WEBM1
  - **é©—è­‰**: WebM æ ¼å¼æ­£ç¢ºæª¢æ¸¬å’Œè™•ç†ï¼ŒFFmpeg è½‰æ›å‘½ä»¤æœ€ä½³åŒ–ï¼Œèˆ‡ Whisper API æ•´åˆç„¡èª¤

- [ ] **WEBM3: å‰ç«¯æ¸¬è©¦æ¡ˆä¾‹æ›´æ–°** `2c8d6d6f-226d-4038-8930-de4b457cf378`
  - [ ] ä¿®æ”¹ `tests/frontend/transcript-manager-phase.spec.ts` ä¸­çš„ MediaRecorder polyfill
  - [ ] æ›´æ–° `tests/frontend/state-transition.spec.ts` ä¸­çš„æ ¼å¼è¨­å®š
  - [ ] ç¢ºä¿æ¸¬è©¦ä¸­çš„ mimeType é è¨­ç‚º `'audio/webm;codecs=opus'`
  - [ ] é©—è­‰æ ¼å¼é¸æ“‡é‚è¼¯çš„æ¸¬è©¦è¦†è“‹
  - [ ] æ·»åŠ  WebM æ ¼å¼ç‰¹å®šçš„æ¸¬è©¦æ¡ˆä¾‹
  - [ ] æ‰€æœ‰å‰ç«¯æ¸¬è©¦æ­£å¸¸é€šéï¼ŒWebM æ ¼å¼ç›¸é—œæ¸¬è©¦æ¡ˆä¾‹æ­£å¸¸é‹ä½œ
  - **æª”æ¡ˆ**: `tests/frontend/transcript-manager-phase.spec.ts` (è¡Œ 70-85), `tests/frontend/state-transition.spec.ts` (è¡Œ 65-80)
  - **ä¾è³´**: WEBM1
  - **é©—è­‰**: æ‰€æœ‰å‰ç«¯æ¸¬è©¦æ­£å¸¸é€šéï¼ŒMediaRecorder polyfill ä½¿ç”¨æ­£ç¢ºçš„ WebM æ ¼å¼

- [ ] **WEBM4: å¾Œç«¯æ¸¬è©¦æ¡ˆä¾‹æ›´æ–°** `9ff21636-f5b7-43e2-b2c5-f9772a691769`
  - [ ] ä¿®æ”¹ `tests/unit/test_azure_openai_v2.py` ä¸­çš„æ¸¬è©¦è³‡æ–™æ ¼å¼
  - [ ] æ›´æ–° `tests/integration/test_one_chunk_one_transcription.py` çš„éŸ³æª”æ ¼å¼
  - [ ] ç¢ºä¿ `sample_webm_data` ä½¿ç”¨æ­£ç¢ºçš„ WebM æ¨™é ­
  - [ ] é©—è­‰ WebM æ ¼å¼çš„è½‰æ›å’Œè½‰éŒ„æµç¨‹
  - [ ] æ·»åŠ  WebM ç‰¹å®šçš„æ•ˆèƒ½å’Œç©©å®šæ€§æ¸¬è©¦
  - [ ] æ‰€æœ‰å¾Œç«¯æ¸¬è©¦æ­£å¸¸é€šéï¼ŒWebM æ ¼å¼è™•ç†æ¸¬è©¦è¦†è“‹å®Œæ•´
  - **æª”æ¡ˆ**: `tests/unit/test_azure_openai_v2.py` (è¡Œ 60-90), `tests/integration/test_one_chunk_one_transcription.py` (è¡Œ 85-110)
  - **ä¾è³´**: WEBM2
  - **é©—è­‰**: æ‰€æœ‰å¾Œç«¯æ¸¬è©¦æ­£å¸¸é€šéï¼ŒWebM æ ¼å¼è™•ç†æ¸¬è©¦è¦†è“‹å®Œæ•´ï¼Œè½‰éŒ„æœå‹™æ•´åˆæ¸¬è©¦æ­£å¸¸

- [ ] **WEBM5: ç³»çµ±æ•´åˆæ¸¬è©¦èˆ‡é©—è­‰** `215d39f9-54d9-460f-a4dc-5dcb6962be28`
  - [ ] ä½¿ç”¨ Chrome ç€è¦½å™¨é€²è¡Œå¯¦éš›éŒ„éŸ³æ¸¬è©¦
  - [ ] é©—è­‰ WebM æ ¼å¼çš„éŸ³æª”ä¸Šå‚³å’Œè™•ç†
  - [ ] ç¢ºèª OpenAI Whisper API è½‰éŒ„æ­£å¸¸
  - [ ] æª¢æŸ¥ WebSocket å³æ™‚æ¨é€åŠŸèƒ½
  - [ ] é©—è­‰éŒ¯èª¤è™•ç†å’Œè¨ºæ–·æ©Ÿåˆ¶
  - [ ] é€²è¡Œæ•ˆèƒ½åŸºæº–æ¸¬è©¦
  - [ ] Chrome ç€è¦½å™¨éŒ„éŸ³è‡ªå‹•é¸æ“‡ WebM æ ¼å¼ï¼Œå®Œæ•´æµç¨‹æ­£å¸¸é‹ä½œ
  - **æª”æ¡ˆ**: `frontend/hooks/use-recording.ts` (è¡Œ 180-240), `app/ws/upload_audio.py` (è¡Œ 210-245)
  - **ä¾è³´**: WEBM1, WEBM2, WEBM3, WEBM4
  - **é©—è­‰**: Chrome ç€è¦½å™¨éŒ„éŸ³è‡ªå‹•é¸æ“‡ WebM æ ¼å¼ï¼ŒéŸ³æª”ä¸Šå‚³å’Œè™•ç†æµç¨‹æ­£å¸¸ï¼ŒFFmpeg WebM è½‰æ›ç„¡éŒ¯èª¤

- [ ] **WEBM6: æ–‡æª”æ›´æ–°èˆ‡éƒ¨ç½²æº–å‚™** `738274f6-c1cc-4958-a9d6-5f773d326216`
  - [ ] æ›´æ–° `README.md` ä¸­çš„æŠ€è¡“æ¶æ§‹èªªæ˜
  - [ ] åœ¨ `Todos.md` ä¸­æ¨™è¨˜ fragmented MP4 å•é¡Œå·²è§£æ±º
  - [ ] è¨˜éŒ„ WebM æ ¼å¼çš„æŠ€è¡“å„ªå‹¢å’Œå¯¦ä½œæ±ºç­–
  - [ ] æ›´æ–°éŸ³æª”æ ¼å¼æ”¯æ´èªªæ˜
  - [ ] æº–å‚™éƒ¨ç½²æª¢æŸ¥æ¸…å–®
  - [ ] æ›´æ–°æ•…éšœæ’é™¤æŒ‡å—
  - [ ] æŠ€è¡“æ–‡æª”æº–ç¢ºåæ˜  WebM æ ¼å¼è½‰æ›ï¼Œfragmented MP4 å•é¡Œæ¨™è¨˜ç‚ºå·²è§£æ±º
  - **æª”æ¡ˆ**: `README.md`, `Todos.md` (è¡Œ 325-365), `PRD.md`
  - **ä¾è³´**: WEBM5
  - **é©—è­‰**: æŠ€è¡“æ–‡æª”æº–ç¢ºåæ˜  WebM æ ¼å¼è½‰æ›ï¼Œfragmented MP4 å•é¡Œæ¨™è¨˜ç‚ºå·²è§£æ±ºï¼Œéƒ¨ç½²æª¢æŸ¥æ¸…å–®å®Œæ•´

**é æœŸæ•ˆç›Š**ï¼š
- âœ… **å¾¹åº•è§£æ±º** fragmented MP4 éŒ¯èª¤å•é¡Œ
- âœ… **æå‡ 20-30%** éŸ³æª”è™•ç†æ•ˆç‡  
- âœ… **æ¸›å°‘ 15-25%** æª”æ¡ˆå¤§å°
- âœ… **ç°¡åŒ– 40%** éŒ¯èª¤è™•ç†è¤‡é›œåº¦
- âœ… **æå‡ç³»çµ±æ•´é«”ç©©å®šæ€§**

**æŠ€è¡“é¢¨éšªè©•ä¼°**ï¼š
- âœ… **å¯¦ä½œé¢¨éšª**ï¼šæ¥µä½ï¼ˆç¾æœ‰æ¶æ§‹å·²æ”¯æ´ï¼‰
- âœ… **ç›¸å®¹æ€§é¢¨éšª**ï¼šæ¥µä½ï¼ˆé™åˆ¶ä½¿ç”¨ Chromeï¼‰
- âœ… **æ•ˆèƒ½é¢¨éšª**ï¼šç„¡ï¼ˆWebM æ•ˆèƒ½æ›´ä½³ï¼‰
- âœ… **ç¶­è­·é¢¨éšª**ï¼šä½ï¼ˆç°¡åŒ–éŒ¯èª¤è™•ç†é‚è¼¯ï¼‰

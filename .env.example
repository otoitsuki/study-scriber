# StudyScriber 環境變數

# ============================================
# Supabase 資料庫配置 (必須)
# ============================================
DB_MODE=supabase
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your-anon-public-key

# ============================================
# 語音轉文字 Provider 設定
# ============================================
STT_PROVIDER_DEFAULT=whisper → 使用 Azure OpenAI（Whisper）
# STT_PROVIDER_DEFAULT=gemini → 使用 Gemini


# ============================================
# Gemini 設定
# ============================================
GEMINI_ENDPOINT=us-central1-aiplatform.googleapis.com
GEMINI_API_KEY=your-api-key
GEMINI_PROMPT=請輸出逐字稿：
GEMINI_MAX_REQUESTS=90


# ============================================
# Azure OpenAI 服務 (必須 - 用於語音轉錄)
# ============================================
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-01
WHISPER_DEPLOYMENT_NAME=whisper-1

# 批次處理設定 (優化為低延遲)
# 批次大小：2個音檔切片
WHISPER_BATCH_SIZE=2
# 批次超時：3秒 (目標延遲 ≤5秒)
WHISPER_BATCH_TIMEOUT=3

# 效能監控設定
# 啟用效能日誌記錄
ENABLE_PERFORMANCE_LOGGING=true

# ============================================
# Whisper 幻覺過濾設定 (提升轉錄品質)
# ============================================
# 這些參數用於過濾 Azure Whisper API 產生的低品質或幻覺段落
# 使用 verbose_json 格式的回應進行後端自動過濾

# 靜音檢測門檻 - 過濾高靜音機率的段落
# 範圍：0.0-1.0，值越高越嚴格
# 建議值：0.8 (過濾 80% 以上靜音機率的段落)
# 用途：移除「嗯」、「呃」等填充詞和靜音片段
FILTER_NO_SPEECH=0.8

# 置信度過濾門檻 - 過濾低置信度的段落
# 範圍：-5.0 到 0.0，值越高越嚴格
# 建議值：-1.0 (過濾平均對數機率低於 -1.0 的段落)
# 用途：移除模型不確定的轉錄結果
FILTER_LOGPROB=-1.0

# 重複內容檢測門檻 - 過濾高重複比率的段落
# 範圍：1.0+，值越低越嚴格
# 建議值：2.4 (過濾壓縮比大於 2.4 的段落)
# 用途：移除重複文字、迴圈幻覺等內容
FILTER_COMPRESSION=2.4

# ============================================
# 音頻切片配置 (影響前後端錄音切片時間)
# ============================================
# 音頻切片時長（秒）- 同時影響前後端錄音間隔
# 建議值：5-30秒，預設10秒
AUDIO_CHUNK_DURATION_SEC=10

# ============================================
# Cloudflare R2 儲存配置 (必須 - 用於音檔儲存)
# ============================================
# 帳戶 ID - 在 Cloudflare 控制台中可以找到
R2_ACCOUNT_ID=your-account-id

# API Token - 在 Cloudflare 控制台 > API 權杖中建立
# 需要的權限: Zone:Zone:Read, Account:Cloudflare R2:Edit
R2_API_TOKEN=your-r2-api-token

# 儲存桶名稱
R2_BUCKET_NAME=studyscriber-audio

# R2_ENDPOINT_URL 會自動生成: https://{R2_ACCOUNT_ID}.r2.cloudflarestorage.com
# 如需自訂端點，請取消註釋下面這行
# R2_ENDPOINT_URL=https://your-custom-endpoint.com

# ============================================
# 應用程式設定 (可選)
# ============================================
DEBUG=false
LOG_LEVEL=INFO

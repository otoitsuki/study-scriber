# Project Directory Structure:
.
â”œâ”€â”€ .cursor/
â”‚   â””â”€â”€ rules/
â”‚       â”œâ”€â”€ backend.mdc
â”‚       â”œâ”€â”€ frontend.mdc
â”‚       â”œâ”€â”€ playwright-e2e-testing.mdc
â”‚       â”œâ”€â”€ python.mdc
â”‚       â”œâ”€â”€ react.mdc
â”‚       â”œâ”€â”€ rules.mdc
â”‚       â””â”€â”€ ui-rules/
â”‚           â”œâ”€â”€ create-prototype.mdc
â”‚           â””â”€â”€ shadcn-tailwind-ui-guideline.mdc
â”œâ”€â”€ .cursorignore
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ .editorconfig
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gptree_config
â”œâ”€â”€ .pytest_cache/
â”œâ”€â”€ PRD.md
â”œâ”€â”€ README.md
â”œâ”€â”€ SPEC.md
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ export.py
â”‚   â”‚   â”œâ”€â”€ notes.py
â”‚   â”‚   â”œâ”€â”€ segments.py
â”‚   â”‚   â””â”€â”€ sessions.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ audio_vad.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ container.py
â”‚   â”‚   â”œâ”€â”€ ffmpeg.py
â”‚   â”‚   â””â”€â”€ webm_header_repairer.py
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â”œâ”€â”€ supabase_config.py
â”‚   â”‚   â””â”€â”€ supabase_init.sql
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ httpx_timeout.py
â”‚   â”‚   â”œâ”€â”€ prom_helpers.py
â”‚   â”‚   â”œâ”€â”€ rate_limit.py
â”‚   â”‚   â””â”€â”€ settings_utils.py
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ note.py
â”‚   â”‚   â””â”€â”€ session.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ azure_openai_v2.py
â”‚   â”‚   â”œâ”€â”€ azure_whisper.py
â”‚   â”‚   â”œâ”€â”€ r2_client.py
â”‚   â”‚   â”œâ”€â”€ stt/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ factory.py
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_provider.py
â”‚   â”‚   â”‚   â”œâ”€â”€ gpt4o_provider.py
â”‚   â”‚   â”‚   â”œâ”€â”€ interfaces.py
â”‚   â”‚   â”‚   â”œâ”€â”€ lang_map.py
â”‚   â”‚   â”‚   â”œâ”€â”€ save_utils.py
â”‚   â”‚   â”‚   â””â”€â”€ whisper_provider.py
â”‚   â”‚   â””â”€â”€ transcript_feed.py
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ timer.py
â”‚   â”‚   â”œâ”€â”€ timing.py
â”‚   â”‚   â””â”€â”€ validators.py
â”‚   â””â”€â”€ ws/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ transcript_feed.py
â”‚       â””â”€â”€ upload_audio.py
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ADD_GEMINI.md
â”‚   â”œâ”€â”€ auto-retry-upload-spec.md
â”‚   â”œâ”€â”€ lang-map-refactor.md
â”‚   â”œâ”€â”€ skip-silence-spec.md
â”‚   â”œâ”€â”€ stop-processing-finish-flow.md
â”‚   â”œâ”€â”€ traceback-debug-spec.md
â”‚   â””â”€â”€ webm-to-wav-gpt4o.md
â”œâ”€â”€ e2e/
â”‚   â””â”€â”€ export-api.spec.ts
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ .eslintrc.json
â”‚   â”œâ”€â”€ .next/
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â””â”€â”€ integration/
â”‚   â”‚       â”œâ”€â”€ app-state-provider.test.tsx
â”‚   â”‚       â”œâ”€â”€ state-transitions.test.ts
â”‚   â”‚       â”œâ”€â”€ state-transitions.test.tsx
â”‚   â”‚       â””â”€â”€ websocket-state-sync.test.ts
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ app-store-zustand.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ NetworkRestorerClient.tsx
â”‚   â”‚   â”œâ”€â”€ SessionLoadingOverlay.tsx
â”‚   â”‚   â”œâ”€â”€ default-state.tsx
â”‚   â”‚   â”œâ”€â”€ finish-state.tsx
â”‚   â”‚   â”œâ”€â”€ provider-context-menu.tsx
â”‚   â”‚   â”œâ”€â”€ recording-active-state.tsx
â”‚   â”‚   â”œâ”€â”€ recording-state.tsx
â”‚   â”‚   â”œâ”€â”€ recording-waiting-state.tsx
â”‚   â”‚   â”œâ”€â”€ theme-provider.tsx
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â”œâ”€â”€ ExportButton.test.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ExportButton.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ accordion.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ alert-dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ alert.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ aspect-ratio.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ avatar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ breadcrumb.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ calendar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ carousel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ chart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ checkbox.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ collapsible.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ command.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ context-menu.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ drawer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dropdown-menu.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ hover-card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input-otp.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ menubar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ navigation-menu.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ pagination.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ popover.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ progress.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ radio-group.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ resizable.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ scroll-area.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ separator.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ sheet.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ skeleton.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ slider.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ sonner.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ switch.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tabs.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toast.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toaster.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toggle-group.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toggle.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tooltip.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ use-mobile.tsx
â”‚   â”‚   â”‚   â””â”€â”€ use-toast.ts
â”‚   â”‚   â”œâ”€â”€ upload-status-indicator.tsx
â”‚   â”‚   â””â”€â”€ waiting-state.tsx
â”‚   â”œâ”€â”€ components.json
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ languages.ts
â”‚   â”‚   â””â”€â”€ providers.ts
â”‚   â”œâ”€â”€ e2e/
â”‚   â”‚   â”œâ”€â”€ export-api.spec.ts
â”‚   â”‚   â”œâ”€â”€ offline-recovery.spec.ts
â”‚   â”‚   â”œâ”€â”€ service-layer-integration.spec.ts
â”‚   â”‚   â””â”€â”€ transcript-integration.spec.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ use-app-state-adapter.ts
â”‚   â”‚   â”œâ”€â”€ use-app-state-context.ts
â”‚   â”‚   â”œâ”€â”€ use-app-state-new.ts
â”‚   â”‚   â”œâ”€â”€ use-app-state.ts
â”‚   â”‚   â”œâ”€â”€ use-local-draft.ts
â”‚   â”‚   â”œâ”€â”€ use-mobile.tsx
â”‚   â”‚   â”œâ”€â”€ use-notes.ts
â”‚   â”‚   â”œâ”€â”€ use-recording-adapter.ts
â”‚   â”‚   â”œâ”€â”€ use-recording-new.ts
â”‚   â”‚   â”œâ”€â”€ use-recording.ts
â”‚   â”‚   â”œâ”€â”€ use-session-adapter.ts
â”‚   â”‚   â”œâ”€â”€ use-session-new.ts
â”‚   â”‚   â”œâ”€â”€ use-session.test.ts
â”‚   â”‚   â”œâ”€â”€ use-session.ts
â”‚   â”‚   â”œâ”€â”€ use-toast.ts
â”‚   â”‚   â”œâ”€â”€ use-transcript-adapter.ts
â”‚   â”‚   â”œâ”€â”€ use-transcript-new.ts
â”‚   â”‚   â”œâ”€â”€ use-transcript.ts
â”‚   â”‚   â””â”€â”€ useNetworkRestorer.ts
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”‚   â”œâ”€â”€ advanced-audio-recorder.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ initial-state-loader.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ migration-adapter.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ network-restorer.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ rest-audio-uploader-409.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ segmented-audio-recorder.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ state-machine.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ state-management.test.ts
â”‚   â”‚   â”œâ”€â”€ advanced-audio-recorder.ts
â”‚   â”‚   â”œâ”€â”€ api.test.ts
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ app-state-reducer.ts
â”‚   â”‚   â”œâ”€â”€ app-store-zustand.ts
â”‚   â”‚   â”œâ”€â”€ app-store.ts
â”‚   â”‚   â”œâ”€â”€ audio-recorder.ts
â”‚   â”‚   â”œâ”€â”€ config.ts
â”‚   â”‚   â”œâ”€â”€ feature-flags.ts
â”‚   â”‚   â”œâ”€â”€ initial-state-loader.ts
â”‚   â”‚   â”œâ”€â”€ interfaces.ts
â”‚   â”‚   â”œâ”€â”€ migration-adapter.ts
â”‚   â”‚   â”œâ”€â”€ rest-audio-uploader.ts
â”‚   â”‚   â”œâ”€â”€ segmented-audio-recorder.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ recording-flow-service.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ recording-service.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ session-service-409.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ session-service.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ simple-recording-service.test.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ transcript-service.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ base-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ interfaces.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ recording-flow-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ recording-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ service-container.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ service-registry.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ session-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ simple-recording-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ transcript-service-adapted.ts
â”‚   â”‚   â”‚   â””â”€â”€ transcript-service.ts
â”‚   â”‚   â”œâ”€â”€ simple-audio-recorder.ts
â”‚   â”‚   â”œâ”€â”€ state-machine.ts
â”‚   â”‚   â”œâ”€â”€ stream/
â”‚   â”‚   â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ audio-uploader.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ audio-uploader.ts
â”‚   â”‚   â”œâ”€â”€ transcript-manager-adapter.ts
â”‚   â”‚   â”œâ”€â”€ transcript-manager-new.ts
â”‚   â”‚   â”œâ”€â”€ transcript-manager.ts
â”‚   â”‚   â”œâ”€â”€ typed-emitter.ts
â”‚   â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚   â””â”€â”€ websocket.ts
â”‚   â”œâ”€â”€ next.config.mjs
â”‚   â”œâ”€â”€ node_modules/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ playwright-report/
â”‚   â”œâ”€â”€ playwright.config.ts
â”‚   â”œâ”€â”€ pnpm-lock.yaml
â”‚   â”œâ”€â”€ postcss.config.mjs
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â””â”€â”€ app-state-provider-wrapper.tsx
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ placeholder-logo.png
â”‚   â”‚   â”œâ”€â”€ placeholder-logo.svg
â”‚   â”‚   â”œâ”€â”€ placeholder-user.jpg
â”‚   â”‚   â”œâ”€â”€ placeholder.jpg
â”‚   â”‚   â””â”€â”€ placeholder.svg
â”‚   â”œâ”€â”€ refresh.ts
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ test-setup.ts
â”‚   â”œâ”€â”€ study-scriber.tsx
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ test-transcript-integration.js
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ app-state-context.ts
â”‚   â”‚   â”œâ”€â”€ app-state.ts
â”‚   â”‚   â”œâ”€â”€ state-transitions.ts
â”‚   â”‚   â””â”€â”€ websocket-messages.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ event-bus.ts
â”‚   â”‚   â”œâ”€â”€ export.ts
â”‚   â”‚   â””â”€â”€ time.ts
â”‚   â””â”€â”€ vitest.config.ts
â”œâ”€â”€ gptree_output.txt
â”œâ”€â”€ main.py
â”œâ”€â”€ package.json
â”œâ”€â”€ playwright.config.ts
â”œâ”€â”€ pnpm-lock.yaml
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ pytest.ini
â”œâ”€â”€ tests/
â””â”€â”€ uv.lock

# BEGIN FILE CONTENTS

# File: frontend/components/theme-provider.tsx

'use client'

import * as React from 'react'
import {
  ThemeProvider as NextThemesProvider,
  type ThemeProviderProps,
} from 'next-themes'

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}


# END FILE CONTENTS


# File: frontend/components/ui/ExportButton.test.tsx

import { render, fireEvent, waitFor } from '@testing-library/react'
import ExportButton from './ExportButton'

jest.mock('@/hooks/use-session', () => ({
    useSession: () => ({ waitUntilCompleted: jest.fn() }),
}))
jest.mock('@/lib/api', () => ({
    notesAPI: { updateNote: jest.fn() },
}))
jest.mock('@/utils/export', () => ({
    downloadZip: jest.fn(),
}))
jest.mock('@/hooks/use-toast', () => ({
    toast: jest.fn(),
}))

const { useSession } = require('@/hooks/use-session')
const { notesAPI } = require('@/lib/api')
const { downloadZip } = require('@/utils/export')
const { toast } = require('@/hooks/use-toast')

describe('ExportButton', () => {
    beforeEach(() => {
        jest.clearAllMocks()
    })

    it('calls waitUntilCompleted and downloads on success', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(true) })
        notesAPI.updateNote.mockResolvedValue({})
        downloadZip.mockResolvedValue()
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        fireEvent.click(getByText(/Export/))
        await waitFor(() => expect(notesAPI.updateNote).toHaveBeenCalledWith('sid', { content: 'abc' }))
        expect(downloadZip).toHaveBeenCalledWith('sid')
    })

    it('shows toast if waitUntilCompleted returns false', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(false) })
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        fireEvent.click(getByText(/Export/))
        await waitFor(() => expect(toast).toHaveBeenCalledWith(expect.objectContaining({ title: expect.stringMatching(/å¾Œç«¯ä»åœ¨è™•ç†/) })))
    })

    it('shows error toast if updateNote fails', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(true) })
        notesAPI.updateNote.mockRejectedValue(new Error('fail'))
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        fireEvent.click(getByText(/Export/))
        await waitFor(() => expect(toast).toHaveBeenCalledWith(expect.objectContaining({ variant: 'destructive' })))
    })

    it('shows error toast if downloadZip fails', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(true) })
        notesAPI.updateNote.mockResolvedValue({})
        downloadZip.mockRejectedValue(new Error('fail'))
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        fireEvent.click(getByText(/Export/))
        await waitFor(() => expect(toast).toHaveBeenCalledWith(expect.objectContaining({ variant: 'destructive' })))
    })

    it('does not trigger export when busy', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(true) })
        notesAPI.updateNote.mockResolvedValue({})
        downloadZip.mockResolvedValue()
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        const btn = getByText(/Export/)
        fireEvent.click(btn)
        fireEvent.click(btn)
        await waitFor(() => expect(notesAPI.updateNote).toHaveBeenCalledTimes(1))
    })
})


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/recording-flow-service.test.ts

/**
 * RecordingFlowService æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦
 *
 * æ¸¬è©¦ RecordingFlowService çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç¢ºä¿ï¼š
 * 1. startRecordingFlow æˆåŠŸæ™‚è¿”å› SessionResponse
 * 2. startRecordingFlow å¤±æ•—æ™‚æ‹‹å‡ºéŒ¯èª¤
 * 3. ç‹€æ…‹ç®¡ç†æ­£ç¢º
 */

import { describe, test, expect, vi, beforeEach, afterEach } from 'vitest'
import { RecordingFlowService } from '../recording-flow-service'
import { serviceContainer } from '../service-container'
import { SERVICE_KEYS } from '../interfaces'
import type { ISessionService, IRecordingService, ITranscriptService } from '../interfaces'
import type { SessionResponse } from '../../api'

// Mock æœå‹™å®¹å™¨
vi.mock('../service-container', () => ({
    serviceContainer: {
        resolve: vi.fn()
    }
}))

// 1. ä¿®æ”¹ RecordingFlowService è®“ setAppState å¯æ³¨å…¥
class TestableRecordingFlowService extends RecordingFlowService {
    constructor(setAppState: (state: string) => void) {
        super()
        // @ts-ignore
        this.setAppState = setAppState
    }
}

describe('RecordingFlowService - æ ¸å¿ƒåŠŸèƒ½', () => {
    let recordingFlowService: RecordingFlowService
    let mockSessionService: any
    let mockRecordingService: any
    let mockTranscriptService: any
    let mockServiceContainer: any
    let setAppStateMock: any

    // æ¸¬è©¦ç”¨çš„æœƒè©±æ•¸æ“š
    const mockSessionResponse: SessionResponse = {
        id: 'test-session-123',
        title: 'æ¸¬è©¦éŒ„éŸ³æœƒè©±',
        type: 'recording',
        status: 'active',
        language: 'zh-TW',
        created_at: '2024-01-01T00:00:00Z',
        updated_at: '2024-01-01T00:00:00Z'
    }

    beforeEach(async () => {
        // å‰µå»º mock æœå‹™
        mockSessionService = {
            ensureRecordingSession: vi.fn().mockResolvedValue(mockSessionResponse),
            createRecordingSession: vi.fn().mockResolvedValue(mockSessionResponse),
            waitForSessionReady: vi.fn().mockResolvedValue(true),
            finishSession: vi.fn(),
            checkActiveSession: vi.fn(),
        } as Partial<ISessionService>

        mockRecordingService = {
            requestPermission: vi.fn().mockResolvedValue(true),
            startRecording: vi.fn(),
            stopRecording: vi.fn(),
            isRecording: vi.fn(),
            getRecordingTime: vi.fn(),
            getRecordingState: vi.fn(),
        } as Partial<IRecordingService>

        mockTranscriptService = {
            connect: vi.fn(),
            disconnect: vi.fn(),
            addTranscriptListener: vi.fn(),
            removeTranscriptListener: vi.fn(),
            isConnected: vi.fn(),
            start: vi.fn(),
        } as Partial<ITranscriptService>

        // è¨­ç½®æœå‹™å®¹å™¨ mock
        mockServiceContainer = serviceContainer as any
        mockServiceContainer.resolve.mockImplementation((key: string) => {
            switch (key) {
                case SERVICE_KEYS.SESSION_SERVICE:
                    return mockSessionService
                case SERVICE_KEYS.RECORDING_SERVICE:
                    return mockRecordingService
                case SERVICE_KEYS.TRANSCRIPT_SERVICE:
                    return mockTranscriptService
                default:
                    throw new Error(`Unknown service key: ${key}`)
            }
        })

        // mock setAppState
        setAppStateMock = vi.fn()
        // é€™è£¡ç”¨ spyOn å–ä»£ setAppState
        const zustand = await import('../../app-store-zustand')
        vi.spyOn(zustand.useAppStore.getState(), 'setState').mockImplementation(setAppStateMock)

        recordingFlowService = new TestableRecordingFlowService(setAppStateMock)
        await recordingFlowService.initialize()
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('startRecordingFlow - æˆåŠŸæƒ…å¢ƒ', () => {
        test('æˆåŠŸå•Ÿå‹•éŒ„éŸ³æµç¨‹æ‡‰è©²è¿”å› SessionResponse', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)

            // Act
            const result = await recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(result).toEqual(mockSessionResponse)
            expect(result.id).toBe(mockSessionResponse.id)
            expect(result.status).toBe('active')
            expect(result.type).toBe('recording')

            // é©—è­‰æœå‹™èª¿ç”¨
            expect(mockSessionService.createRecordingSession).toHaveBeenCalledWith('æ¸¬è©¦æ¨™é¡Œ', undefined, undefined, undefined)
            expect(mockSessionService.waitForSessionReady).toHaveBeenCalledWith(mockSessionResponse.id, 5000)
            expect(mockTranscriptService.connect).toHaveBeenCalledWith(mockSessionResponse.id)
            expect(mockRecordingService.startRecording).toHaveBeenCalledWith(mockSessionResponse.id)

            // é©—è­‰ç‹€æ…‹
            expect(recordingFlowService.isFlowRunning()).toBe(true)
            expect(recordingFlowService.getCurrentSession()).toEqual(mockSessionResponse)
        })

        test('ç•¶æ¨™é¡Œç‚ºç©ºæ™‚ï¼Œæ‡‰è©²ä½¿ç”¨é è¨­æ¨™é¡Œ', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)

            // Act
            await recordingFlowService.startRecordingFlow()

            // Assert
            expect(mockSessionService.createRecordingSession).toHaveBeenCalledWith(
                expect.stringMatching(/éŒ„éŸ³ç­†è¨˜ \d{1,2}\/\d{1,2}\/\d{4}/),
                undefined, undefined, undefined
            )
        })
    })

    describe('startRecordingFlow - éŒ¯èª¤æƒ…å¢ƒ', () => {
        test('ç•¶æœƒè©±å‰µå»ºå¤±æ•—æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            const sessionError = new Error('æœƒè©±å‰µå»ºå¤±æ•—')
            mockSessionService.createRecordingSession.mockRejectedValueOnce(sessionError)

            // Act & Assert
            await expect(recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ'))
                .rejects.toThrow('æœƒè©±å‰µå»ºå¤±æ•—')

            // é©—è­‰å…¶ä»–æœå‹™æ²’æœ‰è¢«èª¿ç”¨
            expect(mockTranscriptService.connect).not.toHaveBeenCalled()
            expect(mockRecordingService.startRecording).not.toHaveBeenCalled()

            // é©—è­‰ç‹€æ…‹é‡ç½®
            expect(recordingFlowService.isFlowRunning()).toBe(false)
            expect(recordingFlowService.getCurrentSession()).toBeNull()
        })

        test('ç•¶æœƒè©±æº–å‚™å¤±æ•—æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(false)

            // Act & Assert
            await expect(recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ'))
                .rejects.toThrow('æœƒè©±æº–å‚™è¶…æ™‚')

            // é©—è­‰å…¶ä»–æœå‹™æ²’æœ‰è¢«èª¿ç”¨
            expect(mockTranscriptService.connect).not.toHaveBeenCalled()
            expect(mockRecordingService.startRecording).not.toHaveBeenCalled()
        })

        test('ç•¶é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            const transcriptError = new Error('é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—')
            mockTranscriptService.connect.mockRejectedValueOnce(transcriptError)

            // Act & Assert
            await expect(recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ'))
                .rejects.toThrow('é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—')

            // é©—è­‰éŒ„éŸ³æ²’æœ‰å•Ÿå‹•
            expect(mockRecordingService.startRecording).not.toHaveBeenCalled()
        })

        test('ç•¶éŒ„éŸ³æœå‹™å•Ÿå‹•å¤±æ•—æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            const recordingError = new Error('éŒ„éŸ³å•Ÿå‹•å¤±æ•—')
            mockRecordingService.startRecording.mockRejectedValueOnce(recordingError)

            // Act & Assert
            await expect(recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ'))
                .rejects.toThrow('éŒ„éŸ³å•Ÿå‹•å¤±æ•—')
        })

        test('ç•¶æµç¨‹å·²åœ¨é‹è¡Œæ™‚ï¼Œæ‡‰è©²å…ˆåœæ­¢ç¾æœ‰æµç¨‹', async () => {
            // Arrange - å…ˆå•Ÿå‹•ä¸€å€‹æµç¨‹
            mockSessionService.createRecordingSession.mockResolvedValue(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValue(true)
            mockTranscriptService.connect.mockResolvedValue(undefined)
            mockRecordingService.startRecording.mockResolvedValue(undefined)
            mockRecordingService.stopRecording.mockResolvedValue(undefined)
            mockTranscriptService.disconnect.mockResolvedValue(undefined)
            mockSessionService.finishSession.mockResolvedValue(undefined)

            await recordingFlowService.startRecordingFlow('ç¬¬ä¸€å€‹æœƒè©±')

            // Act - å•Ÿå‹•ç¬¬äºŒå€‹æµç¨‹
            const result = await recordingFlowService.startRecordingFlow('ç¬¬äºŒå€‹æœƒè©±')

            // Assert - é©—è­‰ç¬¬äºŒæ¬¡å•Ÿå‹•æˆåŠŸ
            expect(result).toEqual(mockSessionResponse)
            expect(recordingFlowService.isFlowRunning()).toBe(true)
        })
    })

    describe('stopRecordingFlow', () => {
        beforeEach(async () => {
            // å…ˆå•Ÿå‹•éŒ„éŸ³æµç¨‹
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)
            mockRecordingService.isRecording.mockReturnValue(true)

            await recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ')
        })

        test('åªåœæ­¢éŒ„éŸ³ï¼Œä¸å‘¼å« disconnect/finishSession', async () => {
            // Arrange
            mockRecordingService.stopRecording.mockResolvedValueOnce(undefined)
            // Act
            await recordingFlowService.stopRecordingFlow()
            // Assert
            expect(mockRecordingService.stopRecording).toHaveBeenCalled()
            expect(mockTranscriptService.disconnect).not.toHaveBeenCalled()
            expect(mockSessionService.finishSession).not.toHaveBeenCalled()
        })
    })

    describe('Stop â†’ processing â†’ finished ç‹€æ…‹æµ', () => {
        beforeEach(async () => {
            // å…ˆå•Ÿå‹•éŒ„éŸ³æµç¨‹
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockTranscriptService.start.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)
            mockRecordingService.isRecording.mockReturnValue(true)

            await recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ')
        })

        test('åœæ­¢éŒ„éŸ³å¾Œæ‡‰é€²å…¥ processing ç‹€æ…‹', async () => {
            mockRecordingService.stopRecording.mockResolvedValueOnce(undefined)
            await recordingFlowService.stopRecordingFlow()
            expect(setAppStateMock).toHaveBeenCalledWith('processing')
        })

        test('æ”¶åˆ° transcript_complete æ‰é€²å…¥ finished ä¸¦å‘¼å« disconnect', async () => {
            mockRecordingService.stopRecording.mockResolvedValueOnce(undefined)
            mockTranscriptService.disconnect.mockResolvedValueOnce(undefined)
            await recordingFlowService.stopRecordingFlow()
            const msg = { type: 'transcript_complete', session_id: mockSessionResponse.id }
            await (recordingFlowService as any).handleTranscriptMessage(msg)
            expect(setAppStateMock).toHaveBeenCalledWith('finished')
            expect(mockTranscriptService.disconnect).toHaveBeenCalledWith(mockSessionResponse.id)
        })

        test('Race condition: stop å‰›å‘¼å«å¾Œé¦¬ä¸Šæ”¶åˆ° transcript_complete ä¹Ÿèƒ½æ­£ç¢ºæµè½‰', async () => {
            mockRecordingService.stopRecording.mockResolvedValueOnce(undefined)
            mockTranscriptService.disconnect.mockResolvedValueOnce(undefined)
            // stopRecordingFlow å°šæœªå®Œå…¨çµæŸæ™‚æ”¶åˆ° transcript_complete
            const stopPromise = recordingFlowService.stopRecordingFlow()
            const msg = { type: 'transcript_complete', session_id: mockSessionResponse.id }
            await (recordingFlowService as any).handleTranscriptMessage(msg)
            await stopPromise
            expect(setAppStateMock).toHaveBeenCalledWith('processing')
            expect(setAppStateMock).toHaveBeenCalledWith('finished')
            expect(mockTranscriptService.disconnect).toHaveBeenCalledWith(mockSessionResponse.id)
        })
    })

    describe('ç‹€æ…‹ç®¡ç†', () => {
        test('åˆå§‹ç‹€æ…‹æ‡‰è©²æ­£ç¢º', () => {
            expect(recordingFlowService.isFlowRunning()).toBe(false)
            expect(recordingFlowService.getCurrentSession()).toBeNull()
            expect(recordingFlowService.getTranscriptEntries()).toEqual([])
        })

        test('å•Ÿå‹•å¾Œç‹€æ…‹æ‡‰è©²æ­£ç¢º', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)

            // Act
            await recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(recordingFlowService.isFlowRunning()).toBe(true)
            expect(recordingFlowService.getCurrentSession()).toEqual(mockSessionResponse)
        })
    })
})




# END FILE CONTENTS


# File: frontend/lib/state-machine.ts

"use client"

import { AppState } from "../types/app-state"
import {
    StateTransitionTrigger,
    StateTransitionCondition,
    StateTransitionContext,
    StateTransitionResult,
    StateTransitionSideEffect,
    STATE_TRANSITION_RULES,
    STATE_TRANSITION_SIDE_EFFECTS
} from "../types/state-transitions"

// ç‹€æ…‹æ©Ÿé¡åˆ¥
export class StateMachine {
    private currentState: AppState = "default"
    private context: StateTransitionContext
    private listeners: Set<(newState: AppState, sideEffects: StateTransitionSideEffect[]) => void> = new Set()

    constructor(initialContext: StateTransitionContext) {
        this.context = initialContext
        this.currentState = initialContext.currentState
        this.exposeToWindow()
    }

    // æ›´æ–°ä¸Šä¸‹æ–‡
    updateContext(newContext: Partial<StateTransitionContext>): void {
        this.context = { ...this.context, ...newContext }
        console.log('ğŸ”„ [StateMachine] ä¸Šä¸‹æ–‡å·²æ›´æ–°:', this.context)
    }

    // å˜—è©¦ç‹€æ…‹è½‰æ›
    transition(trigger: StateTransitionTrigger): StateTransitionResult {
        const transitionKey = `${this.currentState}->${trigger}`
        console.log(`ğŸ”„ [StateMachine] å˜—è©¦ç‹€æ…‹è½‰æ›: ${transitionKey}`)

        // å°‹æ‰¾ç¬¦åˆçš„è½‰æ›è¦å‰‡
        const matchingRules = this.findMatchingRules(trigger)

        if (matchingRules.length === 0) {
            const error = `æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„è½‰æ›è¦å‰‡: ${transitionKey}`
            console.warn(`âš ï¸ [StateMachine] ${error}`)
            return {
                success: false,
                newState: this.currentState,
                error
            }
        }

        // é©—è­‰è½‰æ›æ¢ä»¶
        const validRule = this.validateTransitionRules(matchingRules)

        if (!validRule) {
            const error = `è½‰æ›æ¢ä»¶ä¸ç¬¦åˆ: ${transitionKey}`
            console.warn(`âš ï¸ [StateMachine] ${error}`)
            return {
                success: false,
                newState: this.currentState,
                error
            }
        }

        // åŸ·è¡Œç‹€æ…‹è½‰æ›
        const result = this.executeTransition(validRule, trigger)

        if (result.success) {
            this.currentState = result.newState
            console.log(`âœ… [StateMachine] ç‹€æ…‹è½‰æ›æˆåŠŸ: ${this.context.currentState} -> ${result.newState}`)

            // æ›´æ–°ä¸Šä¸‹æ–‡ä¸­çš„ç•¶å‰ç‹€æ…‹
            this.context.currentState = result.newState

            // é€šçŸ¥ç›£è½å™¨
            this.notifyListeners(result.newState, result.sideEffects || [])
        }

        return result
    }

    // å°‹æ‰¾åŒ¹é…çš„è½‰æ›è¦å‰‡
    private findMatchingRules(trigger: StateTransitionTrigger): StateTransitionCondition[] {
        return STATE_TRANSITION_RULES.filter(rule =>
            rule.currentState === this.currentState && rule.trigger === trigger
        )
    }

    // é©—è­‰è½‰æ›è¦å‰‡
    private validateTransitionRules(rules: StateTransitionCondition[]): StateTransitionCondition | null {
        for (const rule of rules) {
            if (this.isRuleValid(rule)) {
                return rule
            }
        }
        return null
    }

    // æª¢æŸ¥å–®ä¸€è¦å‰‡æ˜¯å¦æœ‰æ•ˆ
    private isRuleValid(rule: StateTransitionCondition): boolean {
        const context = this.context

        // æª¢æŸ¥ session å­˜åœ¨æ€§
        if (rule.sessionExists !== undefined) {
            const hasSession = context.session !== null
            if (rule.sessionExists !== hasSession) {
                console.log(`ğŸ” [StateMachine] Session å­˜åœ¨æ€§æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.sessionExists}, å¯¦éš› ${hasSession}`)
                return false
            }
        }

        // æª¢æŸ¥ session ç‹€æ…‹
        if (rule.sessionStatus !== undefined) {
            if (!context.session || context.session.status !== rule.sessionStatus) {
                console.log(`ğŸ” [StateMachine] Session ç‹€æ…‹æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.sessionStatus}, å¯¦éš› ${context.session?.status}`)
                return false
            }
        }

        // æª¢æŸ¥ session é¡å‹
        if (rule.sessionType !== undefined) {
            if (!context.session || context.session.type !== rule.sessionType) {
                console.log(`ğŸ” [StateMachine] Session é¡å‹æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.sessionType}, å¯¦éš› ${context.session?.type}`)
                return false
            }
        }

        // æª¢æŸ¥éŒ„éŸ³ç‹€æ…‹
        if (rule.isRecording !== undefined) {
            if (context.isRecording !== rule.isRecording) {
                console.log(`ğŸ” [StateMachine] éŒ„éŸ³ç‹€æ…‹æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.isRecording}, å¯¦éš› ${context.isRecording}`)
                return false
            }
        }

        // æª¢æŸ¥é€å­—ç¨¿å­˜åœ¨æ€§
        if (rule.hasTranscripts !== undefined) {
            const hasTranscripts = context.transcriptCount > 0
            if (rule.hasTranscripts !== hasTranscripts) {
                console.log(`ğŸ” [StateMachine] é€å­—ç¨¿å­˜åœ¨æ€§æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.hasTranscripts}, å¯¦éš› ${hasTranscripts}`)
                return false
            }
        }

        // åŸ·è¡Œè‡ªå®šç¾©é©—è­‰
        if (rule.customValidator) {
            const isValid = rule.customValidator(context)
            if (!isValid) {
                console.log(`ğŸ” [StateMachine] è‡ªå®šç¾©é©—è­‰å¤±æ•—`)
                return false
            }
        }

        console.log(`âœ… [StateMachine] è¦å‰‡é©—è­‰é€šé: ${rule.currentState} -> ${rule.targetState}`)
        return true
    }

    // åŸ·è¡Œç‹€æ…‹è½‰æ›
    private executeTransition(rule: StateTransitionCondition, trigger: StateTransitionTrigger): StateTransitionResult {
        const sideEffectKey = `${rule.currentState}->${rule.targetState}->${trigger}`
        const sideEffects = STATE_TRANSITION_SIDE_EFFECTS[sideEffectKey] || []

        console.log(`ğŸ”„ [StateMachine] åŸ·è¡Œè½‰æ›: ${sideEffectKey}`)
        console.log(`ğŸ”„ [StateMachine] å‰¯ä½œç”¨:`, sideEffects)

        return {
            success: true,
            newState: rule.targetState,
            sideEffects
        }
    }

    // æ·»åŠ ç‹€æ…‹è®Šæ›´ç›£è½å™¨
    addListener(listener: (newState: AppState, sideEffects: StateTransitionSideEffect[]) => void): void {
        this.listeners.add(listener)
    }

    // ç§»é™¤ç‹€æ…‹è®Šæ›´ç›£è½å™¨
    removeListener(listener: (newState: AppState, sideEffects: StateTransitionSideEffect[]) => void): void {
        this.listeners.delete(listener)
    }

    // é€šçŸ¥æ‰€æœ‰ç›£è½å™¨
    private notifyListeners(newState: AppState, sideEffects: StateTransitionSideEffect[]): void {
        this.listeners.forEach(listener => {
            try {
                listener(newState, sideEffects)
            } catch (error) {
                console.error('ğŸ”„ [StateMachine] ç›£è½å™¨åŸ·è¡Œå¤±æ•—:', error)
            }
        })
    }

    // å–å¾—ç•¶å‰ç‹€æ…‹
    getCurrentState(): AppState {
        return this.currentState
    }

    // å–å¾—ç•¶å‰ä¸Šä¸‹æ–‡
    getContext(): StateTransitionContext {
        return { ...this.context }
    }

    // æª¢æŸ¥æ˜¯å¦å¯ä»¥åŸ·è¡Œç‰¹å®šè½‰æ›
    canTransition(trigger: StateTransitionTrigger): boolean {
        const matchingRules = this.findMatchingRules(trigger)
        return matchingRules.some(rule => this.isRuleValid(rule))
    }

    // å–å¾—å¯ç”¨çš„è½‰æ›
    getAvailableTransitions(): StateTransitionTrigger[] {
        const availableTransitions: StateTransitionTrigger[] = []

        // æª¢æŸ¥æ‰€æœ‰å¯èƒ½çš„è§¸ç™¼å™¨
        const allTriggers: StateTransitionTrigger[] = [
            "USER_START_RECORDING",
            "USER_STOP_RECORDING",
            "FIRST_TRANSCRIPT_RECEIVED",
            "SESSION_CREATED",
            "SESSION_UPGRADED",
            "PROCESSING_STARTED",
            "PROCESSING_COMPLETED",
            "ERROR_OCCURRED",
            "USER_NEW_NOTE",
            "TRANSCRIPT_COMPLETED"
        ]

        for (const trigger of allTriggers) {
            if (this.canTransition(trigger)) {
                availableTransitions.push(trigger)
            }
        }

        return availableTransitions
    }

    // é‡ç½®ç‹€æ…‹æ©Ÿ
    reset(newContext?: StateTransitionContext): void {
        this.currentState = "default"
        if (newContext) {
            this.context = newContext
        } else {
            this.context = {
                currentState: "default",
                isRecording: false,
                transcriptCount: 0,
                session: null,
                error: null
            }
        }
        console.log('ğŸ”„ [StateMachine] ç‹€æ…‹æ©Ÿå·²é‡ç½®')
    }

    // æš´éœ²åˆ° window ä¾›èª¿è©¦ä½¿ç”¨
    private exposeToWindow(): void {
        if (typeof window !== 'undefined') {
            (window as any).stateMachine = {
                getCurrentState: () => this.getCurrentState(),
                getContext: () => this.getContext(),
                canTransition: (trigger: StateTransitionTrigger) => this.canTransition(trigger),
                getAvailableTransitions: () => this.getAvailableTransitions(),
                transition: (trigger: StateTransitionTrigger) => this.transition(trigger),
                reset: () => this.reset(),

                // ä¾¿åˆ©æ–¹æ³•
                startRecording: () => this.transition("USER_START_RECORDING"),
                stopRecording: () => this.transition("USER_STOP_RECORDING"),
                newNote: () => this.transition("USER_NEW_NOTE"),
                firstTranscript: () => this.transition("FIRST_TRANSCRIPT_RECEIVED"),
                processingComplete: () => this.transition("PROCESSING_COMPLETED"),
                error: () => this.transition("ERROR_OCCURRED"),
            }

            console.log('ğŸ”„ [StateMachine] èª¿è©¦ä»‹é¢å·²æš´éœ²åˆ° window.stateMachine')
            console.log('   ä½¿ç”¨æ–¹æ³•: window.stateMachine.startRecording()')
            console.log('   æŸ¥çœ‹ç‹€æ…‹: window.stateMachine.getCurrentState()')
            console.log('   å¯ç”¨è½‰æ›: window.stateMachine.getAvailableTransitions()')
        }
    }
}

// å‰¯ä½œç”¨è™•ç†å™¨ä»‹é¢
export interface SideEffectHandler {
    handleSideEffect(effect: StateTransitionSideEffect): Promise<void> | void
}

// ç‹€æ…‹æ©Ÿç®¡ç†å™¨
export class StateMachineManager {
    private stateMachine: StateMachine
    private sideEffectHandlers: Map<string, SideEffectHandler> = new Map()

    constructor(initialContext: StateTransitionContext) {
        this.stateMachine = new StateMachine(initialContext)

        // ç›£è½ç‹€æ…‹è®Šæ›´ä¸¦è™•ç†å‰¯ä½œç”¨
        this.stateMachine.addListener((newState, sideEffects) => {
            this.handleSideEffects(sideEffects)
        })
    }

    // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨
    registerSideEffectHandler(effectType: string, handler: SideEffectHandler): void {
        this.sideEffectHandlers.set(effectType, handler)
        console.log(`ğŸ”„ [StateMachineManager] å‰¯ä½œç”¨è™•ç†å™¨å·²è¨»å†Š: ${effectType}`)
    }

    // è™•ç†å‰¯ä½œç”¨
    private async handleSideEffects(sideEffects: StateTransitionSideEffect[]): Promise<void> {
        for (const effect of sideEffects) {
            const handler = this.sideEffectHandlers.get(effect.type)
            if (handler) {
                try {
                    await handler.handleSideEffect(effect)
                    console.log(`âœ… [StateMachineManager] å‰¯ä½œç”¨è™•ç†å®Œæˆ: ${effect.type}`)
                } catch (error) {
                    console.error(`âŒ [StateMachineManager] å‰¯ä½œç”¨è™•ç†å¤±æ•—: ${effect.type}`, error)
                }
            } else {
                console.warn(`âš ï¸ [StateMachineManager] æœªæ‰¾åˆ°å‰¯ä½œç”¨è™•ç†å™¨: ${effect.type}`)
            }
        }
    }

    // å–å¾—ç‹€æ…‹æ©Ÿå¯¦ä¾‹
    getStateMachine(): StateMachine {
        return this.stateMachine
    }

    // æ›´æ–°ä¸Šä¸‹æ–‡ä¸¦è§¸ç™¼è‡ªå‹•è½‰æ›
    updateContextAndTransition(
        newContext: Partial<StateTransitionContext>,
        autoTrigger?: StateTransitionTrigger
    ): StateTransitionResult | null {
        this.stateMachine.updateContext(newContext)

        if (autoTrigger && this.stateMachine.canTransition(autoTrigger)) {
            return this.stateMachine.transition(autoTrigger)
        }

        return null
    }
}

// ä¾¿åˆ©å‡½æ•¸ï¼šå»ºç«‹ç‹€æ…‹æ©Ÿå¯¦ä¾‹
export function createStateMachine(initialContext: StateTransitionContext): StateMachineManager {
    return new StateMachineManager(initialContext)
}


# END FILE CONTENTS


# File: frontend/hooks/use-session-adapter.ts

"use client"

import { useSession as useSessionLegacy } from './use-session'
import { useSessionNew } from './use-session-new'
import { isFeatureEnabled } from '../lib/feature-flags'
import { SessionResponse } from '../lib/api'

// çµ±ä¸€çš„ UseSession ä»‹é¢
interface UseSessionReturn {
    currentSession: SessionResponse | null
    isLoading: boolean
    error: string | null
    createNoteSession: (title: string, content?: string) => Promise<SessionResponse | null>
    createRecordingSession: (title: string, content?: string) => Promise<SessionResponse | null>
    upgradeToRecording: () => Promise<SessionResponse | null>
    finishSession: () => Promise<void>
    deleteSession: () => Promise<void>
    clearSession: () => void
    checkActiveSession: () => Promise<SessionResponse | null>
}

/**
 * useSession é©é…å™¨ Hook
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨æ–°èˆŠç‰ˆæœ¬çš„ useSession
 * ç¢ºä¿ API å®Œå…¨ç›¸å®¹ï¼Œç¾æœ‰çµ„ä»¶ç„¡éœ€ä¿®æ”¹
 */
export function useSession(): UseSessionReturn {
    const useNewSessionHook = isFeatureEnabled('useNewSessionHook')
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')

    console.log('ğŸ”„ [useSessionAdapter] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewSessionHook,
        useNewStateManagement,
        willUseNewVersion: useNewSessionHook || useNewStateManagement
    })

    // å¦‚æœå•Ÿç”¨æ–° Session Hook æˆ–æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬
    if (useNewSessionHook || useNewStateManagement) {
        console.log('ğŸ”„ [useSessionAdapter] ä½¿ç”¨æ–°ç‰ˆæœ¬ useSessionNew')
        return useSessionNew()
    }

    // å¦å‰‡ä½¿ç”¨èˆŠç‰ˆæœ¬
    console.log('ğŸ”„ [useSessionAdapter] ä½¿ç”¨èˆŠç‰ˆæœ¬ useSession')
    return useSessionLegacy()
}

// å°å‡ºèˆŠç‰ˆæœ¬ä¾›ç›´æ¥ä½¿ç”¨ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ç‰¹æ®Šæƒ…æ³ï¼‰
export { useSession as useSessionLegacy } from './use-session'
export { useSessionNew } from './use-session-new'


# END FILE CONTENTS


# File: frontend/hooks/use-transcript-adapter.ts

"use client"

import { useTranscript as useTranscriptLegacy } from './use-transcript'
import { useTranscriptNew } from './use-transcript-new'
import { isFeatureEnabled } from '../lib/feature-flags'
import { TranscriptMessage } from '../lib/transcript-manager'

// çµ±ä¸€çš„ UseTranscript ä»‹é¢
interface UseTranscriptReturn {
    transcripts: TranscriptMessage[]
    isConnected: boolean
    isCompleted: boolean
    error: string | null
    connect: (sessionId: string) => Promise<void>
    disconnect: () => void
    clearTranscripts: () => void
    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    autoScrollEnabled: boolean
    enableAutoScroll: () => void
    disableAutoScroll: () => void
    scrollToLatest: () => void
    setScrollContainer: (element: HTMLElement | null) => void
}

/**
 * useTranscript é©é…å™¨ Hook
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨æ–°èˆŠç‰ˆæœ¬çš„ useTranscript
 * ç‰¹åˆ¥æ³¨æ„ä¿æŒ TranscriptManager çš„ WebSocket é‡é€£æ©Ÿåˆ¶
 */
export function useTranscript(): UseTranscriptReturn {
    const useNewTranscriptHook = isFeatureEnabled('useNewTranscriptHook')
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')

    console.log('ğŸ”„ [useTranscriptAdapter] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewTranscriptHook,
        useNewStateManagement,
        willUseNewVersion: useNewTranscriptHook || useNewStateManagement
    })

    // å¦‚æœå•Ÿç”¨æ–° Transcript Hook æˆ–æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬
    if (useNewTranscriptHook || useNewStateManagement) {
        console.log('ğŸ”„ [useTranscriptAdapter] ä½¿ç”¨æ–°ç‰ˆæœ¬ useTranscriptNew')
        return useTranscriptNew()
    }

    // å¦å‰‡ä½¿ç”¨èˆŠç‰ˆæœ¬
    console.log('ğŸ”„ [useTranscriptAdapter] ä½¿ç”¨èˆŠç‰ˆæœ¬ useTranscript')
    return useTranscriptLegacy()
}

// å°å‡ºèˆŠç‰ˆæœ¬ä¾›ç›´æ¥ä½¿ç”¨ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ç‰¹æ®Šæƒ…æ³ï¼‰
export { useTranscript as useTranscriptLegacy } from './use-transcript'
export { useTranscriptNew } from './use-transcript-new'


# END FILE CONTENTS


# File: app/services/r2_client.py

"""
Cloudflare R2 å„²å­˜æœå‹™å®¢æˆ¶ç«¯
ä½¿ç”¨ Cloudflare API Token èªè­‰
"""

import os
import logging
import asyncio
import aiohttp
from typing import Dict, Any
from uuid import UUID
import requests
from dotenv import load_dotenv
from supabase import Client
from app.core.config import settings

# è¼‰å…¥ç’°å¢ƒè®Šæ•¸
load_dotenv()

logger = logging.getLogger(__name__)

class R2ClientError(Exception):
    """R2 å®¢æˆ¶ç«¯ç•°å¸¸"""
    pass

class R2Client:
    """Cloudflare R2 å„²å­˜å®¢æˆ¶ç«¯ - ä½¿ç”¨ API Token èªè­‰"""

    def __init__(self):
        """åˆå§‹åŒ– R2 å®¢æˆ¶ç«¯"""
        self.account_id = os.getenv('R2_ACCOUNT_ID')
        self.bucket_name = os.getenv('R2_BUCKET_NAME', 'studyscriber-audio')
        self.api_token = os.getenv('R2_API_TOKEN')

        # é©—è­‰å¿…è¦é…ç½®
        if not self.account_id:
            raise R2ClientError("ç¼ºå°‘ R2_ACCOUNT_ID ç’°å¢ƒè®Šæ•¸")

        if not self.api_token:
            raise R2ClientError("ç¼ºå°‘ R2_API_TOKEN ç’°å¢ƒè®Šæ•¸")

        # åˆå§‹åŒ– API Token å®¢æˆ¶ç«¯
        self.api_base_url = f"https://api.cloudflare.com/client/v4/accounts/{self.account_id}/r2/buckets/{self.bucket_name}/objects"
        self.headers = {
            'Authorization': f'Bearer {self.api_token}',
            'Content-Type': 'application/octet-stream'
        }

        logger.info("R2 å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸï¼Œä½¿ç”¨ API Token èªè­‰")

    async def store_segment(self, sid: UUID, seq: int, blob: bytes) -> str:
        """
        å„²å­˜éŸ³æª”åˆ‡ç‰‡åˆ° R2 (ç°¡åŒ–ç‰ˆ REST API æ¶æ§‹)

        Args:
            sid: æœƒè©± ID
            seq: åˆ‡ç‰‡åºè™Ÿ
            blob: éŸ³æª”äºŒé€²åˆ¶è³‡æ–™

        Returns:
            str: R2 å„²å­˜éµå€¼

        Raises:
            R2ClientError: ä¸Šå‚³å¤±æ•—æ™‚æ‹‹å‡º
        """
        key = f"{sid}/{seq:06}.webm"
        url = f"{self.api_base_url}/{key}"

        headers = {
            "Authorization": f"Bearer {self.api_token}",
            "Content-Type": "audio/webm"
        }

        try:
            async with aiohttp.ClientSession() as session:
                async with session.put(url, data=blob, headers=headers) as response:
                    if response.status in [200, 201]:
                        logger.info(f"âœ… R2 ä¸Šå‚³æˆåŠŸ: {key} ({len(blob)} bytes)")
                        return key
                    else:
                        error_text = await response.text()
                        raise R2ClientError(f"R2 ä¸Šå‚³å¤±æ•—: {response.status} - {error_text}")

        except aiohttp.ClientError as e:
            raise R2ClientError(f"R2 ä¸Šå‚³é€£ç·šéŒ¯èª¤: {str(e)}")
        except Exception as e:
            raise R2ClientError(f"R2 ä¸Šå‚³æœªçŸ¥éŒ¯èª¤: {str(e)}")

    async def test_connection(self) -> Dict[str, Any]:
        """æ¸¬è©¦é€£æ¥"""
        try:
            # æ¸¬è©¦ token æœ‰æ•ˆæ€§
            verify_url = "https://api.cloudflare.com/client/v4/user/tokens/verify"
            response = requests.get(verify_url, headers={'Authorization': f'Bearer {self.api_token}'})

            if response.status_code == 200:
                result = response.json()
                return {
                    'success': True,
                    'auth_method': 'api_token',
                    'token_status': result.get('result', {}).get('status'),
                    'account_id': self.account_id,
                    'bucket_name': self.bucket_name
                }
            else:
                return {
                    'success': False,
                    'error': f'Token é©—è­‰å¤±æ•—: {response.status_code}',
                    'auth_method': 'api_token'
                }
        except Exception as e:
            return {
                'success': False,
                'error': f'API Token é€£æ¥æ¸¬è©¦å¤±æ•—: {str(e)}',
                'auth_method': 'api_token'
            }

    async def upload_file(self, key: str, data: bytes, content_type: str = 'application/octet-stream') -> Dict[str, Any]:
        """ä¸Šå‚³æª”æ¡ˆåˆ° R2"""
        try:
            url = f"{self.api_base_url}/{key}"
            headers = self.headers.copy()
            headers['Content-Type'] = content_type

            response = requests.put(url, data=data, headers=headers)

            if response.status_code in [200, 201]:
                return {
                    'success': True,
                    'key': key,
                    'size': len(data),
                    'method': 'api_token'
                }
            else:
                return {
                    'success': False,
                    'error': f'ä¸Šå‚³å¤±æ•—: {response.status_code} - {response.text}',
                    'method': 'api_token'
                }
        except Exception as e:
            return {
                'success': False,
                'error': f'API Token ä¸Šå‚³å¤±æ•—: {str(e)}',
                'method': 'api_token'
            }

    async def store_chunk_blob(
        self, session_id: UUID, chunk_sequence: int, blob_data: bytes, supabase_client: Client
    ) -> dict:
        """
        å°‡éŸ³æª”åˆ‡ç‰‡ Blob å­˜å„²åˆ° R2 ä¸¦åœ¨è³‡æ–™åº«ä¸­è¨˜éŒ„

        Args:
            session_id: æœƒè©± ID
            chunk_sequence: éŸ³æª”åˆ‡ç‰‡åºè™Ÿ
            blob_data: éŸ³æª”äºŒé€²åˆ¶æ•¸æ“š
            supabase_client: Supabase å®¢æˆ¶ç«¯å¯¦ä¾‹

        Returns:
            Dict: åŒ…å«æ“ä½œçµæœçš„å­—å…¸
        """
        # ç”Ÿæˆ R2 å„²å­˜éµå€¼
        r2_key = generate_audio_key(str(session_id), chunk_sequence)

        # æœ€å¤šé‡è©¦3æ¬¡ä¸Šå‚³
        max_retries = 3
        upload_result = None

        for attempt in range(max_retries):
            try:
                # ä¸Šå‚³æª”æ¡ˆåˆ° R2
                upload_result = await self.upload_file(
                    key=r2_key,
                    data=blob_data,
                    content_type='audio/webm'
                )

                if upload_result['success']:
                    break

                logger.warning(f"ä¸Šå‚³å¤±æ•—ï¼Œç¬¬ {attempt + 1} æ¬¡å˜—è©¦: {upload_result.get('error')}")

                # æŒ‡æ•¸é€€é¿
                if attempt < max_retries - 1:
                    await asyncio.sleep(2 ** attempt)

            except Exception as e:
                logger.error(f"ä¸Šå‚³ç•°å¸¸ï¼Œç¬¬ {attempt + 1} æ¬¡å˜—è©¦: {str(e)}")
                if attempt == max_retries - 1:
                    upload_result = {
                        'success': False,
                        'error': f'ä¸Šå‚³å¤±æ•—ï¼Œå·²é‡è©¦ {max_retries} æ¬¡: {str(e)}'
                    }
                elif attempt < max_retries - 1:
                    await asyncio.sleep(2 ** attempt)

        if not upload_result['success']:
            return {
                'success': False,
                'error': f'R2 ä¸Šå‚³å¤±æ•—: {upload_result.get("error")}',
                'session_id': session_id,
                'chunk_sequence': chunk_sequence
            }

        # ä½¿ç”¨å‚³å…¥çš„ supabase_client é€²è¡Œè³‡æ–™åº«æ“ä½œ
        try:
            audio_file_record = {
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "r2_key": r2_key,
                "r2_bucket": self.bucket_name,
                "file_size": len(blob_data),
                "duration_seconds": settings.AUDIO_CHUNK_DURATION_SEC  # å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
            }

            db_response = supabase_client.table("audio_files").insert(audio_file_record).execute()

            if not db_response.data:
                return {
                    'success': False,
                    'error': 'è³‡æ–™åº«è¨˜éŒ„å»ºç«‹å¤±æ•—',
                    'session_id': session_id,
                    'chunk_sequence': chunk_sequence
                }

        except Exception as db_error:
            logger.error(f"è³‡æ–™åº«æ“ä½œå¤±æ•—: {str(db_error)}")
            return {
                'success': False,
                'error': f'è³‡æ–™åº«è¨˜éŒ„å»ºç«‹å¤±æ•—: {str(db_error)}',
                'session_id': session_id,
                'chunk_sequence': chunk_sequence
            }

        return {
            'success': True,
            'session_id': session_id,
            'chunk_sequence': chunk_sequence,
            'r2_key': r2_key,
            'r2_bucket': self.bucket_name,
            'file_size': len(blob_data),
            'upload_method': upload_result.get('method')
        }

    def get_download_url(self, key: str) -> str:
        """
        ç²å–æª”æ¡ˆçš„ç›´æ¥ä¸‹è¼‰ URL

        æ³¨æ„ï¼šæ­¤ URL éœ€è¦ API Token èªè­‰ï¼Œé©ç”¨æ–¼æœå‹™ç«¯ä½¿ç”¨
        å°æ–¼å®¢æˆ¶ç«¯ä¸‹è¼‰ï¼Œå»ºè­°ä½¿ç”¨ Cloudflare çš„å…¬é–‹ URL æˆ–å¯¦ä½œä»£ç†ç«¯é»
        """
        return f"{self.api_base_url}/{key}"

    async def download_file(self, key: str) -> Dict[str, Any]:
        """å¾ R2 ä¸‹è¼‰æª”æ¡ˆ"""
        try:
            url = f"{self.api_base_url}/{key}"
            headers = {'Authorization': f'Bearer {self.api_token}'}

            response = requests.get(url, headers=headers)

            if response.status_code == 200:
                return {
                    'success': True,
                    'key': key,
                    'data': response.content,
                    'size': len(response.content),
                    'method': 'api_token'
                }
            elif response.status_code == 404:
                return {
                    'success': False,
                    'error': f'æª”æ¡ˆä¸å­˜åœ¨: {key}',
                    'method': 'api_token'
                }
            else:
                return {
                    'success': False,
                    'error': f'ä¸‹è¼‰å¤±æ•—: {response.status_code} - {response.text}',
                    'method': 'api_token'
                }
        except Exception as e:
            return {
                'success': False,
                'error': f'API Token ä¸‹è¼‰å¤±æ•—: {str(e)}',
                'method': 'api_token'
            }

def get_r2_client() -> R2Client:
    """ç²å– R2 å®¢æˆ¶ç«¯å¯¦ä¾‹"""
    return R2Client()

def generate_audio_key(session_id: str, chunk_sequence: int) -> str:
    """ç”ŸæˆéŸ³æª”å„²å­˜éµå"""
    return f"audio/{session_id}/chunk_{chunk_sequence:04d}.webm"


# END FILE CONTENTS


# File: frontend/lib/services/recording-flow-service.ts

"use client"

import { BaseService } from './base-service'
import { serviceContainer } from './service-container'
import { SERVICE_KEYS, type ISessionService, type IRecordingService, type ITranscriptService, type TranscriptMessage } from './interfaces'
import type { SessionResponse } from '../api'
import type { AppState } from '../../types/app-state'
import { useAppStore } from '../app-store-zustand'
import { formatTime } from '../../utils/time'

/**
 * éŒ„éŸ³æµç¨‹ç®¡ç†æœå‹™
 *
 * æ•´åˆ SessionServiceã€RecordingService å’Œ TranscriptService
 * æä¾›çµ±ä¸€çš„éŒ„éŸ³æµç¨‹ç®¡ç†
 */
import { STTProvider } from '../api'

const AUDIO_CHUNK_SEC = Number(
  process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_SEC ?? "15"
);

export class RecordingFlowService extends BaseService {
  protected readonly serviceName = 'RecordingFlowService'

  // æœå‹™ä¾è³´
  private sessionService!: ISessionService
  private recordingService!: IRecordingService
  private transcriptService!: ITranscriptService

  // æµç¨‹ç‹€æ…‹
  private currentSession: SessionResponse | null = null
  private isFlowActive = false
  private labelIntervalSec = (() => {
    const raw = process.env.NEXT_PUBLIC_TRANSCRIPT_LABEL_INTERVAL
    const n = Number(raw)
    return Number.isFinite(n) && n > 0 ? Math.floor(n) : 15
  })()
  private lastLabelSec = 0
  private transcriptEntries: Array<{ time: string; text: string }> = []

  private setAppState: (s: AppState) => void

  constructor(setAppStateFn?: (s: AppState) => void) {
    super()
    if (setAppStateFn) {
      this.setAppState = setAppStateFn
    } else {
      this.setAppState = useAppStore.getState().setState
    }
  }

  /**
   * æœå‹™åˆå§‹åŒ–
   */
  async initialize(): Promise<void> {
    this.logInfo('åˆå§‹åŒ–éŒ„éŸ³æµç¨‹æœå‹™')

    // è§£ææœå‹™ä¾è³´
    this.sessionService = serviceContainer.resolve<ISessionService>(SERVICE_KEYS.SESSION_SERVICE)
    this.recordingService = serviceContainer.resolve<IRecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
    this.transcriptService = serviceContainer.resolve<ITranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)

    this.logSuccess('æœå‹™ä¾è³´è§£æå®Œæˆ')
    this.logSuccess('åˆå§‹åŒ–å®Œæˆ')
  }

  /**
   * æœå‹™æ¸…ç†
   */
  async cleanup(): Promise<void> {
    this.logInfo('æ¸…ç†éŒ„éŸ³æµç¨‹æœå‹™')

    // å¦‚æœæœ‰æ´»èºçš„æµç¨‹ï¼Œå…ˆåœæ­¢
    if (this.isFlowActive) {
      await this.stopRecordingFlow()
    }

    // é‡ç½®ç‹€æ…‹
    this.currentSession = null
    this.isFlowActive = false
    this.transcriptEntries = []

    this.logSuccess('æ¸…ç†å®Œæˆ')
  }

  /**
   * é–‹å§‹éŒ„éŸ³æµç¨‹
   */
  async startRecordingFlow(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse> {
    this.logInfo('é–‹å§‹éŒ„éŸ³æµç¨‹', { title, content, startTs })

    try {
      // â‘  å…ˆæ‹¿æ¬Šé™
      if (!(await this.recordingService.requestPermission())) {
        this.setAppState('default')
        throw new Error('éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’')
      }

      // === ğŸ›  è¿½åŠ : è‹¥æœ‰ç¾æœ‰æ´»èºæœƒè©±ï¼Œå…ˆçµæŸå®ƒï¼Œé¿å… Session æ‰“æ¶ ===
      const activeSession = await this.sessionService.checkActiveSession()
      if (activeSession) {
        this.logInfo('æª¢æ¸¬åˆ°ç¾æœ‰æ´»èºæœƒè©±ï¼Œå…ˆå®Œæˆå®ƒä»¥é¿å…è¡çª', {
          sessionId: activeSession.id,
          type: activeSession.type,
          status: activeSession.status
        })
        await this.sessionService.finishSession(activeSession.id)
        this.logSuccess('å·²å®Œæˆç¾æœ‰æ´»èºæœƒè©±', { sessionId: activeSession.id })
      }
      // === ğŸ›  è¿½åŠ çµæŸ ===

      // â‘¡ å»º Sessionï¼ˆPOST /sessionï¼‰
      const session = await this.sessionService.createRecordingSession(
        title || `éŒ„éŸ³ç­†è¨˜ ${new Date().toLocaleString()}`,
        content,
        startTs,
        sttProvider
      )
      if (!session) {
        this.setAppState('default')
        throw new Error('å»ºç«‹ Session å¤±æ•—')
      }

      // â‘¢ å•Ÿå‹•é€å­—ç¨¿æœå‹™
      await this.transcriptService.start(session.id)
      this.setAppState('processing')

      // æ­¥é©Ÿ 1: ä½¿ç”¨æ–°å»ºç«‹çš„æœƒè©±
      this.currentSession = session
      this.logSuccess('éŒ„éŸ³æœƒè©±å·²æº–å‚™', { sessionId: this.currentSession.id, withStartTs: !!startTs })

      // æ­¥é©Ÿ 2: ç­‰å¾…æœƒè©±åœ¨è³‡æ–™åº«ä¸­å®Œå…¨å¯è¦‹
      this.logInfo('æ­¥é©Ÿ 2: ç­‰å¾…æœƒè©±æº–å‚™å®Œæˆ')
      const isReady = await this.sessionService.waitForSessionReady(this.currentSession.id, 5000)
      if (!isReady) {
        throw new Error('æœƒè©±æº–å‚™è¶…æ™‚')
      }
      this.logSuccess('æœƒè©±æº–å‚™å®Œæˆ')

      // æ­¥é©Ÿ 3: é€£æ¥é€å­—ç¨¿æœå‹™
      this.logInfo('æ­¥é©Ÿ 3: é€£æ¥é€å­—ç¨¿æœå‹™')
      await this.transcriptService.connect(this.currentSession.id)
      this.setupTranscriptListener()
      this.logSuccess('é€å­—ç¨¿æœå‹™é€£æ¥æˆåŠŸ')

      // æ­¥é©Ÿ 4: é–‹å§‹éŒ„éŸ³
      this.logInfo('æ­¥é©Ÿ 4: é–‹å§‹éŒ„éŸ³')
      await this.recordingService.startRecording(this.currentSession.id)

      // é€šçŸ¥å…¨åŸŸç‹€æ…‹ï¼šè¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“ï¼Œå•Ÿå‹•è¨ˆæ™‚å™¨
      try {
        const setRecordingStart = (await import('../app-store-zustand')).useAppStore.getState().setRecordingStart
        setRecordingStart(Date.now())
        console.log('ğŸ• [RecordingFlowService] å·²é€é AppStore è¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“')
      } catch (e) {
        console.warn('âš ï¸ [RecordingFlowService] ç„¡æ³•è¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“:', e)
      }

      this.logSuccess('éŒ„éŸ³å•Ÿå‹•æˆåŠŸ')

      // æ¨™è¨˜æµç¨‹ç‚ºæ´»èº
      this.isFlowActive = true

      this.logSuccess('éŒ„éŸ³æµç¨‹å•Ÿå‹•å®Œæˆ', {
        sessionId: this.currentSession.id,
        isRecording: this.recordingService.isRecording(),
        transcriptConnected: this.transcriptService.isConnected(this.currentSession.id)
      })

      // è¨ºæ–·è³‡è¨Š
      console.log('ğŸ‰ [RecordingFlowService] éŒ„éŸ³æµç¨‹å·²å®Œå…¨å•Ÿå‹•', {
        sessionId: this.currentSession.id,
        audioRecording: this.recordingService.isRecording() ? 'âœ… éŒ„éŸ³ä¸­' : 'âŒ æœªéŒ„éŸ³',
        transcriptWS: this.transcriptService.isConnected(this.currentSession.id) ? 'âœ… å·²é€£æ¥' : 'âŒ æœªé€£æ¥',
        recordingState: this.recordingService.getRecordingState(),
        timestamp: new Date().toISOString()
      })

      console.log('ğŸ“‹ [RecordingFlowService] è«‹æª¢æŸ¥ï¼š')
      console.log('1. æ‡‰è©²æ¯ç§’çœ‹åˆ° [AudioRecorder] ondataavailable è§¸ç™¼')
      console.log('2. æ‡‰è©²æ¯ç§’çœ‹åˆ° [AudioUploadWebSocket] Binary frame å·²é€å‡º')
      console.log('3. DevTools > Network > WS > /ws/upload_audio æ‡‰è©²çœ‹åˆ° binary frames')
      console.log('4. DevTools > Network > WS > /ws/transcript_feed æ‡‰è©²æ”¶åˆ°é€å­—ç¨¿')

      return this.currentSession

    } catch (error) {
      await this.cleanupFlowResources()
      this.handleError('é–‹å§‹éŒ„éŸ³æµç¨‹', error)
      throw error
    }
  }

  /**
   * åœæ­¢éŒ„éŸ³æµç¨‹
   */
  async stopRecordingFlow(): Promise<void> {
    this.logInfo('åœæ­¢éŒ„éŸ³æµç¨‹')

    try {
      if (!this.isFlowActive || !this.currentSession) {
        this.logWarning('æ²’æœ‰æ´»èºçš„éŒ„éŸ³æµç¨‹')
        return
      }

      // åªåœæ­¢éŒ„éŸ³ï¼Œä¸ä¸»å‹•æ–·ç·šæˆ–çµæŸ session
      if (this.recordingService.isRecording()) {
        await this.recordingService.stopRecording()
        this.logSuccess('éŒ„éŸ³å·²åœæ­¢')
      }
      // é€²å…¥ processing ç‹€æ…‹ï¼Œç­‰å¾… transcript_complete
      this.setAppState('processing')
    } catch (error) {
      this.handleError('åœæ­¢éŒ„éŸ³æµç¨‹', error)
      throw error
    }
  }

  /**
   * å–å¾—ç•¶å‰æœƒè©±
   */
  getCurrentSession(): SessionResponse | null {
    return this.currentSession
  }

  /**
   * æª¢æŸ¥æµç¨‹æ˜¯å¦æ´»èº
   */
  isFlowRunning(): boolean {
    return this.isFlowActive
  }

  /**
   * å–å¾—é€å­—ç¨¿é …ç›®
   */
  getTranscriptEntries(): Array<{ time: string; text: string }> {
    return [...this.transcriptEntries]
  }

  /**
   * å–å¾—éŒ„éŸ³ç‹€æ…‹
   */
  getRecordingState() {
    return this.recordingService.getRecordingState()
  }

  /**
   * è¨­å®šé€å­—ç¨¿ç›£è½å™¨
   */
  private setupTranscriptListener(): void {
    if (!this.currentSession) return

    const sessionId = this.currentSession.id

    // ç§»é™¤ç¾æœ‰ç›£è½å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
    this.transcriptService.removeTranscriptListener(sessionId, this.handleTranscriptMessage)

    // æ·»åŠ æ–°çš„ç›£è½å™¨
    this.transcriptService.addTranscriptListener(sessionId, this.handleTranscriptMessage)

    this.logInfo('é€å­—ç¨¿ç›£è½å™¨å·²è¨­å®š', { sessionId })
  }

  /**
   * è™•ç†é€å­—ç¨¿è¨Šæ¯
   */
  private handleTranscriptMessage = (msg: TranscriptMessage): void => {
    try {
      // 1. åˆ¤æ–·è¨Šæ¯å‹åˆ¥
      if (
        (msg.type === 'transcript' || msg.type === 'transcript_segment') &&
        msg.text
      ) {
        /* 2. è¨ˆç®— startSec
           a. å¾Œç«¯è‹¥æœ‰ start_time â†’ ç”¨å®ƒ
           b. å¦å‰‡ç”¨ chunk_sequence Ã— åˆ‡ç‰‡é•·åº¦
        */
        const startSec =
          msg.start_time !== undefined
            ? msg.start_time
            : (msg.chunk_sequence ?? 0) * AUDIO_CHUNK_SEC;

        /* 3. æ¯éš” labelIntervalSec ç§’æ’å…¥ä¸€æ¢æ™‚é–“ç¢¼ */
        if (startSec - this.lastLabelSec >= this.labelIntervalSec) {
          this.transcriptEntries.push({
            time: formatTime(startSec),
            text: '',              // ç´”æ™‚é–“æ¨™ç±¤
          })
          this.lastLabelSec = startSec
        }

        /* 4. çœŸæ­£çš„é€å­—ç¨¿è¡Œ */
        this.transcriptEntries.push({
          time: formatTime(startSec),
          text: msg.text.trim(),
        })
      } else if (msg.type === 'error') {
        this.logWarning('é€å­—ç¨¿éŒ¯èª¤', msg)
      } else if (msg.type === 'transcript_complete') {
        this.setAppState('finished')
        if (this.currentSession) {
          this.transcriptService.disconnect(this.currentSession.id)
        }
        this.isFlowActive = false
        this.logSuccess('æ”¶åˆ° transcript_completeï¼Œæµç¨‹çµæŸ')
      }
    } catch (e) {
      this.logWarning('è™•ç†é€å­—ç¨¿è¨Šæ¯å¤±æ•—', e)
    }
  }

  /**
   * æ¸…ç†æµç¨‹è³‡æº
   */
  private async cleanupFlowResources(): Promise<void> {
    try {
      // åœæ­¢éŒ„éŸ³ï¼ˆå¦‚æœé‚„åœ¨éŒ„éŸ³ï¼‰
      if (this.recordingService?.isRecording()) {
        await this.recordingService.stopRecording()
      }

      // æ–·é–‹é€å­—ç¨¿æœå‹™
      if (this.currentSession && this.transcriptService?.isConnected(this.currentSession.id)) {
        await this.transcriptService.disconnect(this.currentSession.id)
      }

      // é‡ç½®ç‹€æ…‹
      this.currentSession = null
      this.isFlowActive = false

      this.logInfo('æµç¨‹è³‡æºæ¸…ç†å®Œæˆ')
    } catch (error) {
      this.logWarning('æ¸…ç†æµç¨‹è³‡æºæ™‚ç™¼ç”ŸéŒ¯èª¤', error)
    }
  }

  /**
   * å–å¾—æµç¨‹è©³ç´°ç‹€æ…‹
   */
  async getFlowStatus() {
    const baseStatus = this.getStatus()

    return {
      ...baseStatus,
      isFlowActive: this.isFlowActive,
      currentSession: this.currentSession,
      transcriptEntriesCount: this.transcriptEntries.length,
      recordingState: this.recordingService?.getRecordingState() || null,
      transcriptConnected: this.currentSession
        ? this.transcriptService?.isConnected(this.currentSession.id) || false
        : false
    }
  }
}


# END FILE CONTENTS


# File: frontend/README.md

# Recreate the UI

*Automatically synced with your [v0.dev](https://v0.dev) deployments*

[![Deployed on Vercel](https://img.shields.io/badge/Deployed%20on-Vercel-black?style=for-the-badge&logo=vercel)](https://vercel.com/otoitsukis-projects/v0-recreate-the-ui)
[![Built with v0](https://img.shields.io/badge/Built%20with-v0.dev-black?style=for-the-badge)](https://v0.dev/chat/projects/5FBRtobaC6g)

## Overview

This repository will stay in sync with your deployed chats on [v0.dev](https://v0.dev).
Any changes you make to your deployed app will be automatically pushed to this repository from [v0.dev](https://v0.dev).

## Deployment

Your project is live at:

**[https://vercel.com/otoitsukis-projects/v0-recreate-the-ui](https://vercel.com/otoitsukis-projects/v0-recreate-the-ui)**

## Build your app

Continue building your app on:

**[https://v0.dev/chat/projects/5FBRtobaC6g](https://v0.dev/chat/projects/5FBRtobaC6g)**

## How It Works

1. Create and modify your project using [v0.dev](https://v0.dev)
2. Deploy your chats from the v0 interface
3. Changes are automatically pushed to this repository
4. Vercel deploys the latest version from this repository

# END FILE CONTENTS


# File: frontend/components/ui/drawer.tsx

"use client"

import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}


# END FILE CONTENTS


# File: frontend/components/ui/accordion.tsx

"use client"

import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }


# END FILE CONTENTS


# File: .editorconfig

root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.py]
indent_style = space
indent_size = 4
max_line_length = 79

[*.{yml,yaml}]
indent_style = space
indent_size = 2

[*.{json,js,ts}]
indent_style = space
indent_size = 2

[*.md]
trim_trailing_whitespace = false


# END FILE CONTENTS


# File: frontend/components/NetworkRestorerClient.tsx

"use client"
import { useNetworkRestorer } from '@/hooks/useNetworkRestorer'

export function NetworkRestorerClient() {
    useNetworkRestorer()
    return null
}


# END FILE CONTENTS


# File: frontend/hooks/use-session-new.ts

"use client"

import { useCallback, useMemo, useEffect } from 'react'
import { useAppStateContext } from './use-app-state-context'
import { isFeatureEnabled } from '../lib/feature-flags'
import { SERVICE_KEYS, serviceContainer } from '../lib/services'
import type { ISessionService } from '../lib/services'
import type { SessionResponse } from '../lib/api'

interface UseSessionNewReturn {
    currentSession: SessionResponse | null
    isLoading: boolean
    error: string | null
    createNoteSession: (title?: string, content?: string) => Promise<SessionResponse | null>
    createRecordingSession: (title?: string, content?: string) => Promise<SessionResponse | null>
    upgradeToRecording: () => Promise<SessionResponse | null>
    finishSession: () => Promise<void>
    deleteSession: () => Promise<void>
    clearSession: () => void
    checkActiveSession: () => Promise<SessionResponse | null>
}

/**
 * useSessionNew - æœƒè©±ç®¡ç† Hook (é©é…å™¨å±¤)
 *
 * é‡æ§‹ç‚ºé©é…å™¨å±¤ï¼š
 * - å…§éƒ¨èª¿ç”¨ SessionService è€Œéç›´æ¥èª¿ç”¨ sessionAPI
 * - ä¿æŒå°å¤–æ¥å£å®Œå…¨ä¸è®Šï¼Œç¢ºä¿çµ„ä»¶å±¤ç„¡æ„ŸçŸ¥è®Šæ›´
 * - ä½¿ç”¨æœå‹™å±¤å¯¦ç¾æ¸…æ™°çš„æ¶æ§‹åˆ†å±¤
 */
export function useSessionNew(): UseSessionNewReturn {
    const context = useAppStateContext()

    console.log('ğŸ”„ [useSessionNew] Hook åˆå§‹åŒ– (é©é…å™¨å±¤)ï¼ŒåŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewStateManagement: isFeatureEnabled('useNewStateManagement'),
        useNewSessionHook: isFeatureEnabled('useNewSessionHook'),
        contextSession: context.appData.session,
        contextError: context.error,
        contextLoading: context.isLoading,
    })

    // è§£ææœå‹™å¯¦ä¾‹ - ä½¿ç”¨æœå‹™å±¤
    const sessionService = useMemo(() => {
        try {
            return serviceContainer.resolve<ISessionService>(SERVICE_KEYS.SESSION_SERVICE)
        } catch (error) {
            console.error('âŒ [useSessionNew] ç„¡æ³•è§£æ SessionService:', error)
            throw new Error('æœƒè©±æœå‹™åˆå§‹åŒ–å¤±æ•—')
        }
    }, [])

    const clearError = useCallback(() => {
        context.setError(null)
    }, [context])

    const checkActiveSession = useCallback(async (): Promise<SessionResponse | null> => {
        context.setLoading(true)
        clearError()

        try {
            const activeSession = await sessionService.checkActiveSession()
            if (activeSession) {
                context.setSession({
                    id: activeSession.id,
                    status: activeSession.status,
                    type: activeSession.type,
                })
                console.log('âœ… [useSessionNew] å·²æ¢å¾©æ´»èºæœƒè©±ç‹€æ…‹:', activeSession)
                return activeSession
            } else {
                console.log('â„¹ï¸ [useSessionNew] æ²’æœ‰æ´»èºæœƒè©±ï¼Œä½¿ç”¨é è¨­ç‹€æ…‹')
                context.setSession(null)
                return null
            }
        } catch (err) {
            if (err instanceof Error && err.message.includes('Network Error')) {
                console.warn('âš ï¸ [useSessionNew] Backend API é€£ç·šæš«æ™‚å¤±æ•—ï¼Œå°‡åœ¨å¾ŒçºŒé‡è©¦:', err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const createNoteSession = useCallback(async (title?: string, content?: string): Promise<SessionResponse | null> => {
        context.setLoading(true)
        clearError()

        try {
            const session = await sessionService.createNoteSession(title, content)

            context.setSession({
                id: session.id,
                status: session.status,
                type: session.type,
            })

            console.log('âœ… [useSessionNew] ç´”ç­†è¨˜æœƒè©±å»ºç«‹æˆåŠŸ:', session)
            return session
        } catch (err) {
            // ä¿æŒåŸæœ‰çš„ 409 è¡çªéŒ¯èª¤è™•ç†é‚è¼¯
            if (err instanceof Error && err.message.includes('409')) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                context.setError(conflictMessage)
                console.error('âŒ [useSessionNew] æœƒè©±è¡çªéŒ¯èª¤ (409):', err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹æœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] å»ºç«‹ç´”ç­†è¨˜æœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const createRecordingSession = useCallback(async (title?: string, content?: string): Promise<SessionResponse | null> => {
        context.setLoading(true)
        clearError()

        try {
            const session = await sessionService.createRecordingSession(title, content)

            context.setSession({
                id: session.id,
                status: session.status,
                type: session.type,
            })

            console.log('âœ… [useSessionNew] éŒ„éŸ³æœƒè©±å»ºç«‹æˆåŠŸ:', session)
            return session
        } catch (err) {
            // ä¿æŒåŸæœ‰çš„ 409 è¡çªéŒ¯èª¤è™•ç†é‚è¼¯
            if (err instanceof Error && err.message.includes('409')) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                context.setError(conflictMessage)
                console.error('âŒ [useSessionNew] æœƒè©±è¡çªéŒ¯èª¤ (409):', err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const upgradeToRecording = useCallback(async (): Promise<SessionResponse | null> => {
        const currentSessionData = context.appData.session

        if (!currentSessionData) {
            context.setError('æ²’æœ‰æ´»èºçš„æœƒè©±å¯ä»¥å‡ç´š')
            return null
        }

        if (currentSessionData.type === 'recording') {
            console.log('ğŸ”„ [useSessionNew] æœƒè©±å·²ç¶“æ˜¯éŒ„éŸ³æ¨¡å¼')
            try {
                const activeSession = await sessionService.checkActiveSession()
                return activeSession
            } catch (err) {
                console.error('âŒ [useSessionNew] ç²å–æ´»èºæœƒè©±å¤±æ•—:', err)
                return null
            }
        }

        context.setLoading(true)
        clearError()

        try {
            const updatedSession = await sessionService.upgradeToRecording(currentSessionData.id)

            context.setSession({
                id: updatedSession.id,
                status: updatedSession.status,
                type: updatedSession.type,
            })

            console.log('âœ… [useSessionNew] æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼æˆåŠŸ:', updatedSession)
            return updatedSession
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å‡ç´šæœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] å‡ç´šæœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const finishSession = useCallback(async (): Promise<void> => {
        const currentSessionData = context.appData.session

        if (!currentSessionData) {
            console.log('ğŸ”„ [useSessionNew] æ²’æœ‰æ´»èºçš„æœƒè©±éœ€è¦å®Œæˆ')
            return
        }

        context.setLoading(true)
        clearError()

        try {
            await sessionService.finishSession(currentSessionData.id)
            console.log('âœ… [useSessionNew] æœƒè©±å®ŒæˆæˆåŠŸ:', currentSessionData.id)

            context.updateSessionStatus('completed')
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å®Œæˆæœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] å®Œæˆæœƒè©±å¤±æ•—:', err)
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const deleteSession = useCallback(async (): Promise<void> => {
        const currentSessionData = context.appData.session

        if (!currentSessionData) {
            console.log('ğŸ”„ [useSessionNew] æ²’æœ‰æ´»èºçš„æœƒè©±éœ€è¦åˆªé™¤')
            return
        }

        context.setLoading(true)
        clearError()

        try {
            await sessionService.deleteSession(currentSessionData.id)
            console.log('âœ… [useSessionNew] æœƒè©±åˆªé™¤æˆåŠŸ:', currentSessionData.id)
            context.setSession(null)
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'åˆªé™¤æœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] åˆªé™¤æœƒè©±å¤±æ•—:', err)
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const clearSession = useCallback(() => {
        context.setSession(null)
        context.setError(null)
        console.log('ğŸ”„ [useSessionNew] æœƒè©±å·²æ¸…é™¤')
    }, [context])

    // å‘å¾Œç›¸å®¹çš„ currentSession æ ¼å¼
    const currentSession: SessionResponse | null = useMemo(() => {
        const sessionData = context.appData.session
        if (!sessionData) return null

        return {
            id: sessionData.id,
            title: '',
            type: sessionData.type,
            status: sessionData.status,
            language: 'zh-TW',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
        }
    }, [context.appData.session])

    // ç¢ºä¿æœå‹™å±¤å·²åˆå§‹åŒ–
    useEffect(() => {
        if (!sessionService) {
            console.error('âŒ [useSessionNew] SessionService æœªæ­£ç¢ºåˆå§‹åŒ–')
            context.setError('æœƒè©±æœå‹™åˆå§‹åŒ–å¤±æ•—')
        }
    }, [sessionService, context])

    return useMemo(() => ({
        currentSession,
        isLoading: context.isLoading,
        error: context.error,
        createNoteSession,
        createRecordingSession,
        upgradeToRecording,
        finishSession,
        deleteSession,
        clearSession,
        checkActiveSession,
    }), [
        currentSession,
        context.isLoading,
        context.error,
        createNoteSession,
        createRecordingSession,
        upgradeToRecording,
        finishSession,
        deleteSession,
        clearSession,
        checkActiveSession,
    ])
}


# END FILE CONTENTS


# File: frontend/lib/app-store.ts

"use client"

import { useState, useCallback, useRef } from 'react'
import { serviceContainer, SERVICE_KEYS } from './services'
import type { RecordingFlowService, RecordingFlowListener } from './services/recording-flow-service'
import type { SessionResponse } from './api'
import { AppState, SessionStatus, SessionType, TranscriptEntry } from '../types/app-state'

/**
 * Store ç‹€æ…‹ä»‹é¢
 */
export interface AppStoreState {
  // æ‡‰ç”¨ç‹€æ…‹
  currentState: AppState
  isLoading: boolean
  error: string | null

  // æœƒè©±ç‹€æ…‹
  session: {
    id: string
    status: SessionStatus
    type: SessionType
  } | null

  // éŒ„éŸ³ç‹€æ…‹
  isRecording: boolean
  recordingTime: number

  // é€å­—ç¨¿ç‹€æ…‹
  transcriptEntries: TranscriptEntry[]

  // ç·¨è¼¯å™¨ç‹€æ…‹
  editorContent: string
}

/**
 * Store æ“ä½œä»‹é¢
 */
export interface AppStoreActions {
  // æ ¸å¿ƒæ¥­å‹™æ“ä½œ
  startRecording: (title?: string) => Promise<void>
  stopRecording: () => Promise<void>

  // ç·¨è¼¯å™¨æ“ä½œ
  updateEditorContent: (content: string) => void

  // ç‹€æ…‹é‡ç½®
  resetState: () => void

  // éŒ¯èª¤è™•ç†
  clearError: () => void
}

/**
 * Store Hook è¿”å›å€¼
 */
export interface AppStoreReturn {
  state: AppStoreState
  actions: AppStoreActions
}

/**
 * AppStore - çµ±ä¸€çš„ç‹€æ…‹ç®¡ç†
 *
 * è·è²¬ï¼š
 * 1. ç®¡ç†æ‡‰ç”¨ç‹€æ…‹
 * 2. èª¿ç”¨æœå‹™å±¤åŸ·è¡Œæ¥­å‹™é‚è¼¯
 * 3. è™•ç† loading å’ŒéŒ¯èª¤ç‹€æ…‹
 * 4. æä¾›ç°¡æ½”çš„ API çµ¦ UI å±¤
 */
export function useAppStore(): AppStoreReturn {
  // === ç‹€æ…‹å®šç¾© ===
  const [currentState, setCurrentState] = useState<AppState>('default')
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [session, setSession] = useState<AppStoreState['session']>(null)
  const [isRecording, setIsRecording] = useState(false)
  const [recordingTime, setRecordingTime] = useState(0)
  const [transcriptEntries, setTranscriptEntries] = useState<TranscriptEntry[]>([])
  const [editorContent, setEditorContent] = useState('')

  // === æœå‹™å¼•ç”¨ ===
  const recordingFlowServiceRef = useRef<RecordingFlowService | null>(null)
  const flowListenerRef = useRef<RecordingFlowListener | null>(null)

  // === åˆå§‹åŒ–æœå‹™ ===
  const initializeRecordingFlowService = useCallback(() => {
    if (!recordingFlowServiceRef.current) {
      recordingFlowServiceRef.current = serviceContainer.resolve<RecordingFlowService>(
        SERVICE_KEYS.RECORDING_FLOW_SERVICE
      )
    }
    return recordingFlowServiceRef.current
  }, [])

  // === æµç¨‹ç›£è½å™¨ ===
  const createFlowListener = useCallback((): RecordingFlowListener => {
    return {
      onTranscriptReceived: (transcript) => {
        console.log('ğŸ“ [AppStore] æ”¶åˆ°é€å­—ç¨¿:', transcript)
        setTranscriptEntries(prev => [...prev, transcript])
      },

      onFirstTranscriptReceived: () => {
        console.log('ğŸ¯ [AppStore] æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿ï¼Œè½‰æ›ç‹€æ…‹')
        setCurrentState('recording_active')
      },

      onRecordingStatusChange: (recording) => {
        console.log('ï¿½ï¿½ [AppStore] éŒ„éŸ³ç‹€æ…‹è®Šæ›´:', recording)
        setIsRecording(recording)
      },

      onTranscriptComplete: () => {
        console.log('âœ… [AppStore] é€å­—ç¨¿è½‰éŒ„å®Œæˆ')
        setCurrentState('finished')
      },

      onError: (errorMessage) => {
        console.error('âŒ [AppStore] éŒ„éŸ³æµç¨‹éŒ¯èª¤:', errorMessage)
        setError(errorMessage)
        setIsLoading(false)
        setCurrentState('default')
      }
    }
  }, [])

  // === éŒ„éŸ³æ™‚é–“è¿½è¹¤ ===
  const startRecordingTimeTracking = useCallback(() => {
    const interval = setInterval(() => {
      const service = recordingFlowServiceRef.current
      if (service && service.isActive()) {
        const time = service.getRecordingTime()
        setRecordingTime(time)
      } else {
        clearInterval(interval)
      }
    }, 1000)

    return interval
  }, [])

  // === æ¥­å‹™æ“ä½œ ===

  /**
   * é–‹å§‹éŒ„éŸ³æµç¨‹
   */
  const startRecording = useCallback(async (title?: string): Promise<void> => {
    console.log('ğŸ¤ [AppStore] é–‹å§‹éŒ„éŸ³æµç¨‹')

    try {
      // 1. è¨­ç½® loading ç‹€æ…‹
      setIsLoading(true)
      setError(null)
      setCurrentState('recording_waiting')

      // 2. åˆå§‹åŒ–æœå‹™
      const recordingFlowService = initializeRecordingFlowService()

      // 3. è¨­ç½®æµç¨‹ç›£è½å™¨
      if (flowListenerRef.current) {
        recordingFlowService.removeListener(flowListenerRef.current)
      }
      flowListenerRef.current = createFlowListener()
      recordingFlowService.addListener(flowListenerRef.current)

      // 4. å•Ÿå‹•éŒ„éŸ³æµç¨‹
      const result: RecordingFlowResult = await recordingFlowService.startRecordingFlow(title)

      if (result.success) {
        // æˆåŠŸï¼šæ›´æ–°æœƒè©±è³‡è¨Šå’Œç‹€æ…‹
        setSession({
          id: result.sessionId,
          status: 'active' as SessionStatus,
          type: 'recording' as SessionType
        })

        setCurrentState('recording_waiting')

        // å•Ÿå‹•æ™‚é–“è¿½è¹¤
        startRecordingTimeTracking()

        console.log('âœ… [AppStore] éŒ„éŸ³æµç¨‹å•Ÿå‹•æˆåŠŸ:', result.sessionId)
      } else {
        // å¤±æ•—ï¼šé¡¯ç¤ºéŒ¯èª¤
        throw new Error(result.error || 'éŒ„éŸ³æµç¨‹å•Ÿå‹•å¤±æ•—')
      }

    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      console.error('âŒ [AppStore] éŒ„éŸ³æµç¨‹å•Ÿå‹•å¤±æ•—:', error)

      setError(errorMessage)
      setCurrentState('default')
    } finally {
      setIsLoading(false)
    }
  }, [initializeRecordingFlowService, createFlowListener, startRecordingTimeTracking])

  /**
   * åœæ­¢éŒ„éŸ³æµç¨‹
   */
  const stopRecording = useCallback(async (): Promise<void> => {
    console.log('ğŸ›‘ [AppStore] åœæ­¢éŒ„éŸ³æµç¨‹')

    try {
      setIsLoading(true)
      setCurrentState('processing')

      const recordingFlowService = recordingFlowServiceRef.current
      if (recordingFlowService) {
        await recordingFlowService.stopRecordingFlow()

        // æ¸…ç†ç›£è½å™¨
        if (flowListenerRef.current) {
          recordingFlowService.removeListener(flowListenerRef.current)
          flowListenerRef.current = null
        }
      }

      // æ›´æ–°ç‹€æ…‹
      setIsRecording(false)
      setCurrentState('finished')

      console.log('âœ… [AppStore] éŒ„éŸ³æµç¨‹åœæ­¢æˆåŠŸ')

    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      console.error('âŒ [AppStore] åœæ­¢éŒ„éŸ³å¤±æ•—:', error)
      setError(errorMessage)
    } finally {
      setIsLoading(false)
    }
  }, [])

  /**
   * æ›´æ–°ç·¨è¼¯å™¨å…§å®¹
   */
  const updateEditorContent = useCallback((content: string) => {
    setEditorContent(content)
  }, [])

  /**
   * é‡ç½®ç‹€æ…‹
   */
  const resetState = useCallback(() => {
    console.log('ğŸ”„ [AppStore] é‡ç½®ç‹€æ…‹')

    // åœæ­¢éŒ„éŸ³æµç¨‹ï¼ˆå¦‚æœæœ‰ï¼‰
    const recordingFlowService = recordingFlowServiceRef.current
    if (recordingFlowService && recordingFlowService.isActive()) {
      recordingFlowService.stopRecordingFlow().catch(console.error)
    }

    // é‡ç½®æ‰€æœ‰ç‹€æ…‹
    setCurrentState('default')
    setIsLoading(false)
    setError(null)
    setSession(null)
    setIsRecording(false)
    setRecordingTime(0)
    setTranscriptEntries([])
    setEditorContent('')
  }, [])

  /**
   * æ¸…é™¤éŒ¯èª¤
   */
  const clearError = useCallback(() => {
    setError(null)
  }, [])

  // === è¿”å› Store ç‹€æ…‹å’Œæ“ä½œ ===
  return {
    state: {
      currentState,
      isLoading,
      error,
      session,
      isRecording,
      recordingTime,
      transcriptEntries,
      editorContent
    },
    actions: {
      startRecording,
      stopRecording,
      updateEditorContent,
      resetState,
      clearError
    }
  }
}


# END FILE CONTENTS


# File: frontend/lib/services/service-registry.ts

"use client"

import { serviceContainer } from './service-container'
import { SessionService } from './session-service'
import { RecordingService } from './recording-service'
import { SimpleRecordingService } from './simple-recording-service'
import { TranscriptService } from './transcript-service'
import { RecordingFlowService } from './recording-flow-service'
import { SERVICE_KEYS } from './interfaces'
import { isFeatureEnabled } from '../feature-flags'

/**
 * æœå‹™è¨»å†Šç®¡ç†
 *
 * çµ±ä¸€ç®¡ç†æ‰€æœ‰æœå‹™çš„è¨»å†Šå’Œåˆå§‹åŒ–
 */
export class ServiceRegistry {
    private static isRegistered = false

    /**
     * è¨»å†Šæ‰€æœ‰æœå‹™
     *
     * ä½¿ç”¨ Singleton æ¨¡å¼ç¢ºä¿æœå‹™åªè¨»å†Šä¸€æ¬¡
     */
    static async registerServices(): Promise<void> {
        if (ServiceRegistry.isRegistered) {
            console.log('ğŸ”„ [ServiceRegistry] æœå‹™å·²è¨»å†Šï¼Œè·³éé‡è¤‡è¨»å†Š')
            return
        }

        try {
            console.log('ğŸš€ [ServiceRegistry] é–‹å§‹è¨»å†Šæœå‹™...')

            // è¨»å†Š SessionService
            serviceContainer.registerSingleton(SERVICE_KEYS.SESSION_SERVICE, () => new SessionService())
            console.log('âœ… [ServiceRegistry] SessionService è¨»å†Šå®Œæˆ')

            // è¨»å†Š RecordingServiceï¼ˆæ ¹æ“šåŠŸèƒ½é–‹é—œé¸æ“‡ï¼‰
            if (isFeatureEnabled('useSimpleRecordingService')) {
                serviceContainer.registerSingleton(SERVICE_KEYS.RECORDING_SERVICE, () => new SimpleRecordingService())
                console.log('âœ… [ServiceRegistry] SimpleRecordingService è¨»å†Šå®Œæˆ (Phase 2)')
            } else {
                serviceContainer.registerSingleton(SERVICE_KEYS.RECORDING_SERVICE, () => new RecordingService())
                console.log('âœ… [ServiceRegistry] RecordingService è¨»å†Šå®Œæˆ (Legacy)')
            }

            // è¨»å†Š TranscriptService
            serviceContainer.registerSingleton(SERVICE_KEYS.TRANSCRIPT_SERVICE, () => new TranscriptService())
            console.log('âœ… [ServiceRegistry] TranscriptService è¨»å†Šå®Œæˆ')

            // è¨»å†Š RecordingFlowService
            serviceContainer.registerSingleton(SERVICE_KEYS.RECORDING_FLOW_SERVICE, () => new RecordingFlowService())
            console.log('âœ… [ServiceRegistry] RecordingFlowService è¨»å†Šå®Œæˆ')

            ServiceRegistry.isRegistered = true
            console.log('âœ… [ServiceRegistry] æ‰€æœ‰æœå‹™è¨»å†Šå®Œæˆ')

        } catch (error) {
            console.error('âŒ [ServiceRegistry] æœå‹™è¨»å†Šå¤±æ•—:', error)
            throw error
        }
    }

    /**
     * åˆå§‹åŒ–æ‰€æœ‰æœå‹™
     *
     * å•Ÿå‹•æ‰€æœ‰å·²è¨»å†Šçš„æœå‹™
     */
    static async initializeServices(): Promise<void> {
        try {
            console.log('ğŸš€ [ServiceRegistry] é–‹å§‹åˆå§‹åŒ–æœå‹™...')

            // ç¢ºä¿æœå‹™å·²è¨»å†Š
            await ServiceRegistry.registerServices()

            // åˆå§‹åŒ– SessionService
            const sessionService = serviceContainer.resolve<SessionService>(SERVICE_KEYS.SESSION_SERVICE)
            await sessionService.start()

            // åˆå§‹åŒ– RecordingService
            const recordingService = serviceContainer.resolve<RecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
            await recordingService.start()

            // åˆå§‹åŒ– TranscriptService
            const transcriptService = serviceContainer.resolve<TranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)
            await transcriptService.start()

            // åˆå§‹åŒ– RecordingFlowService
            const recordingFlowService = serviceContainer.resolve<RecordingFlowService>(SERVICE_KEYS.RECORDING_FLOW_SERVICE)
            await recordingFlowService.start()

            console.log('âœ… [ServiceRegistry] æ‰€æœ‰æœå‹™åˆå§‹åŒ–å®Œæˆ')

        } catch (error) {
            console.error('âŒ [ServiceRegistry] æœå‹™åˆå§‹åŒ–å¤±æ•—:', error)
            throw error
        }
    }

    /**
     * åœæ­¢æ‰€æœ‰æœå‹™
     */
    static async stopServices(): Promise<void> {
        try {
            console.log('ğŸ›‘ [ServiceRegistry] é–‹å§‹åœæ­¢æœå‹™...')

            if (!ServiceRegistry.isRegistered) {
                console.log('â„¹ï¸ [ServiceRegistry] æœå‹™æœªè¨»å†Šï¼Œç„¡éœ€åœæ­¢')
                return
            }

            // æŒ‰ç›¸åé †åºåœæ­¢æœå‹™
            const recordingFlowService = serviceContainer.resolve<RecordingFlowService>(SERVICE_KEYS.RECORDING_FLOW_SERVICE)
            await recordingFlowService.stop()

            const transcriptService = serviceContainer.resolve<TranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)
            await transcriptService.stop()

            const recordingService = serviceContainer.resolve<RecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
            await recordingService.stop()

            const sessionService = serviceContainer.resolve<SessionService>(SERVICE_KEYS.SESSION_SERVICE)
            await sessionService.stop()

            console.log('âœ… [ServiceRegistry] æ‰€æœ‰æœå‹™åœæ­¢å®Œæˆ')

        } catch (error) {
            console.error('âŒ [ServiceRegistry] æœå‹™åœæ­¢å¤±æ•—:', error)
            throw error
        }
    }

    /**
     * å–å¾—æœå‹™è¨»å†Šç‹€æ…‹
     */
    static getRegistrationStatus(): {
        isRegistered: boolean
        registeredServices: string[]
    } {
        return {
            isRegistered: ServiceRegistry.isRegistered,
            registeredServices: serviceContainer.getRegisteredServices()
        }
    }
}

// è‡ªå‹•è¨»å†Šæœå‹™ï¼ˆåœ¨æ¨¡çµ„è¼‰å…¥æ™‚ï¼‰
ServiceRegistry.registerServices().catch(error => {
    console.error('âŒ [ServiceRegistry] è‡ªå‹•è¨»å†Šå¤±æ•—:', error)
})


# END FILE CONTENTS


# File: frontend/lib/transcript-manager.ts

"use client"

import { TranscriptWebSocket, TranscriptMessage, WebSocketManager } from './websocket'
import { useAppStore } from './app-store-zustand'
import type { TranscriptEntry } from '../types/app-state'

/**
 * TranscriptManager - çµ±ä¸€ç®¡ç† transcript WebSocket é€£æ¥çš„ Singleton
 *
 * åŠŸèƒ½ï¼š
 * - ç¢ºä¿æ¯å€‹ session åªæœ‰ä¸€å€‹ transcript é€£æ¥
 * - çµ±ä¸€ç®¡ç†é€£æ¥ç‹€æ…‹ã€å¿ƒè·³ã€é‡é€£
 * - æä¾›ç°¡æ½”çš„ API çµ¦å…¶ä»–çµ„ä»¶ä½¿ç”¨
 */
export class TranscriptManager {
  private static instance: TranscriptManager | null = null
  private connections: Map<string, TranscriptWebSocket> = new Map()
  private listeners: Map<string, Set<(message: TranscriptMessage) => void>> = new Map()
  private connectionStates: Map<string, boolean> = new Map()
  private heartbeatIntervals: Map<string, NodeJS.Timeout> = new Map()
  private reconnectAttempts: Map<string, number> = new Map()
  private maxReconnectAttempts = 5
  private heartbeatInterval = 10000 // 10ç§’ï¼Œé¿å…ä¼ºæœå™¨éæ—©åˆ¤å®šé€¾æ™‚
  private reconnectDelay = 2000 // 2ç§’

  private constructor() {
    // Singleton pattern - ç§æœ‰å»ºæ§‹å­

    // é–‹ç™¼æ¨¡å¼ä¸‹å°‡å¯¦ä¾‹æ›åˆ°å…¨åŸŸä»¥åˆ©é™¤éŒ¯
    if (typeof window !== 'undefined') {
      // @ts-ignore
      ; (window as any).transcriptManager = this
    }
  }

  /**
   * å–å¾— TranscriptManager å¯¦ä¾‹
   */
  static getInstance(): TranscriptManager {
    if (!TranscriptManager.instance) {
      TranscriptManager.instance = new TranscriptManager()
    }
    return TranscriptManager.instance
  }

  /**
   * é€£æ¥åˆ°æŒ‡å®š session çš„ transcript feed
   */
  async connect(sessionId: string): Promise<void> {
    // å¦‚æœå·²ç¶“æœ‰é€£æ¥ï¼Œç›´æ¥è¿”å›
    if (this.connections.has(sessionId) && this.connectionStates.get(sessionId)) {
      console.log(`ğŸ“± [TranscriptManager] Session ${sessionId} å·²é€£æ¥ï¼Œè·³éé‡è¤‡é€£æ¥`)
      return
    }

    try {
      console.log(`ğŸ“± [TranscriptManager] é–‹å§‹é€£æ¥ session ${sessionId}`)

      // æ¸…ç†èˆŠé€£æ¥ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      await this.disconnect(sessionId)

      // é‡ç½®é‡é€£è¨ˆæ•¸
      this.reconnectAttempts.set(sessionId, 0)

      // å»ºç«‹æ–°é€£æ¥
      await this.establishConnection(sessionId)

      // ç­‰å¾…é€£ç·šå®Œå…¨å°±ç·’
      await this.waitForConnectionReady(sessionId)

      console.log(`âœ… [TranscriptManager] Session ${sessionId} é€£æ¥ä¸¦å°±ç·’`)

    } catch (error) {
      console.error(`âŒ [TranscriptManager] Session ${sessionId} é€£æ¥å¤±æ•—:`, error)
      this.connectionStates.set(sessionId, false)

      // å˜—è©¦é‡é€£
      this.scheduleReconnect(sessionId)
      throw error
    }
  }

  /**
   * ç­‰å¾…é€£ç·šå®Œå…¨å°±ç·’
   */
  private async waitForConnectionReady(sessionId: string, timeout: number = 5000): Promise<void> {
    return new Promise((resolve, reject) => {
      const startTime = Date.now()

      const checkReady = () => {
        const ws = this.connections.get(sessionId)
        const isConnected = this.connectionStates.get(sessionId)

        console.log(`ğŸ” [TranscriptManager] æª¢æŸ¥é€£ç·šå°±ç·’ç‹€æ…‹:`, {
          sessionId,
          hasWebSocket: !!ws,
          isConnected: !!isConnected,
          wsReadyState: ws?.readyState,
          wsIsConnected: ws?.isConnected || false,
          elapsedTime: Date.now() - startTime
        })

        // å„ªåŒ–ï¼šæ›´å¯é çš„ WebSocket å°±ç·’ç‹€æ…‹æª¢æ¸¬
        const wsReady = ws && (
          ws.isConnected ||
          ws.readyState === WebSocket.OPEN ||
          (typeof window !== 'undefined' && window.WebSocket && ws.readyState === 1) // æ¸¬è©¦ç’°å¢ƒå…¼å®¹
        )

        // å³æ™‚åŒæ­¥ç‹€æ…‹ï¼Œç¢ºä¿ä¸€è‡´æ€§
        if (ws && wsReady) {
          const actualConnected = true
          if (this.connectionStates.get(sessionId) !== actualConnected) {
            console.log(`ğŸ”„ [TranscriptManager] å³æ™‚åŒæ­¥é€£æ¥ç‹€æ…‹: ${sessionId} â†’ ${actualConnected}`)
            this.connectionStates.set(sessionId, actualConnected)
          }

          console.log(`âœ… [TranscriptManager] Session ${sessionId} é€£ç·šå°±ç·’`)
          resolve()
          return
        } else if (ws && !wsReady) {
          // WebSocket å­˜åœ¨ä½†æœªå°±ç·’ï¼ŒåŒæ­¥ç‹€æ…‹ç‚º false
          const actualConnected = false
          if (this.connectionStates.get(sessionId) !== actualConnected) {
            console.log(`ğŸ”„ [TranscriptManager] å³æ™‚åŒæ­¥é€£æ¥ç‹€æ…‹: ${sessionId} â†’ ${actualConnected}`)
            this.connectionStates.set(sessionId, actualConnected)
          }
        }

        // æª¢æŸ¥è¶…æ™‚
        if (Date.now() - startTime > timeout) {
          console.error(`â° [TranscriptManager] Session ${sessionId} é€£ç·šå°±ç·’ç­‰å¾…è¶…æ™‚`)
          console.error(`   æœ€çµ‚ç‹€æ…‹: ws=${!!ws}, isConnected=${!!isConnected}, wsReady=${!!wsReady}`)
          reject(new Error(`é€£ç·šå°±ç·’ç­‰å¾…è¶…æ™‚ (${timeout}ms)`))
          return
        }

        // ç¹¼çºŒç­‰å¾…
        setTimeout(checkReady, 100)
      }

      checkReady()
    })
  }

  /**
   * å»ºç«‹ WebSocket é€£æ¥
   */
  private async establishConnection(sessionId: string): Promise<void> {
    const ws = new TranscriptWebSocket(sessionId)

    // ğŸ§ª æ¸¬è©¦ï¼šè·³é TranscriptWebSocket æŠ½è±¡å±¤ï¼Œç›´æ¥ä½¿ç”¨ WebSocketManager çš„ onMessage
    // è¨»é‡‹åŸä¾†çš„è¨­å®šï¼Œä½¿ç”¨ç›´æ¥çš„åŸç”Ÿ WebSocket è™•ç†
    // ws.onMessage((message) => {
    //   this.handleMessage(sessionId, message)
    // })

    // è¨­å®šé€£æ¥é—œé–‰è™•ç†
    this.setupConnectionHandlers(ws, sessionId)

    // é€£æ¥ WebSocket
    await ws.connect()

    // ç›´æ¥ä½¿ç”¨ WebSocketManager çš„ onMessage ä¾†è¨­ç½®åŸç”Ÿ onmessage
    WebSocketManager.prototype.onMessage.call(ws, (evt: MessageEvent) => {
      console.log('[WS] raw frame', evt.data?.slice?.(0, 100))
      try {
        const message = JSON.parse(evt.data)
        console.log('[WS] parsed', message.type, message.text?.slice?.(0, 20))
        this.handleMessage(sessionId, message)
      } catch (error) {
        console.error('[WS] parse error', error)
      }
    })

    // å„²å­˜é€£æ¥
    this.connections.set(sessionId, ws)
    this.connectionStates.set(sessionId, true)

    // ç™¼é€åˆå§‹ ping å•Ÿå‹•å¾Œç«¯è™•ç†å¾ªç’°
    this.sendPing(sessionId)

    // å•Ÿå‹•å¿ƒè·³
    this.startHeartbeat(sessionId)

    console.log(`âœ… TranscriptManager: Session ${sessionId} é€£æ¥æˆåŠŸ`)
  }

  /**
* è¨­å®šé€£æ¥è™•ç†å™¨
*/
  private setupConnectionHandlers(ws: TranscriptWebSocket, sessionId: string): void {
    // ç›£è½ WebSocket é—œé–‰äº‹ä»¶
    ws.onClose((event) => {
      console.log(`ğŸ”Œ TranscriptManager: Session ${sessionId} é€£æ¥é—œé–‰:`, event.code, event.reason)

      // æ›´æ–°ç‹€æ…‹
      this.connectionStates.set(sessionId, false)
      this.stopHeartbeat(sessionId)

      // å¦‚æœä¸æ˜¯æ‰‹å‹•é—œé–‰ï¼Œå˜—è©¦é‡é€£
      if (event.code !== 1000) { // 1000 = æ­£å¸¸é—œé–‰
        this.scheduleReconnect(sessionId)
      }
    })
  }

  /**
   * è™•ç†æ”¶åˆ°çš„è¨Šæ¯
   */
  private handleMessage(sessionId: string, message: any): void {
    console.log('[T] raw', message.type, message.text?.slice(0, 20))

    console.log('ğŸš¨ [TranscriptManager] handleMessage è¢«èª¿ç”¨!', {
      sessionId,
      rawMessage: message,
      messageType: typeof message,
      messageKeys: Object.keys(message || {}),
      timestamp: new Date().toISOString()
    })

    console.log('ğŸ“¨ [TranscriptManager] æ”¶åˆ°è¨Šæ¯:', {
      sessionId,
      type: message.type,
      message: message,
      timestamp: new Date().toISOString(),
      listenerCount: this.listeners.get(sessionId)?.size || 0
    })

    // è™•ç†ä¸åŒé¡å‹çš„è¨Šæ¯
    if (message.type === 'transcript_entry') {
      console.log('ğŸ“ [TranscriptManager] æ”¶åˆ°é€å­—ç¨¿æ¢ç›®:', {
        sessionId,
        payload: message.payload,
        timestamp: new Date().toISOString()
      })

      // æ¨é€åˆ° Zustand store
      const raw = message.payload
      if (raw && raw.text) {
        const parseTime = (t: string | undefined): number => {
          if (!t) return 0
          const parts = t.split(':').map(Number)
          return parts.length === 3
            ? parts[0] * 3600 + parts[1] * 60 + parts[2]
            : parts[0] * 60 + parts[1]
        }

        const startTime = (typeof raw.start_time === 'number') ? raw.start_time : (raw.startTime ?? parseTime(raw.time))

        const entry = {
          startTime,
          time: raw.time ?? `${Math.floor(startTime / 60).toString().padStart(2, '0')}:${(startTime % 60).toString().padStart(2, '0')}`,
          text: raw.text
        }

        console.log('ğŸ¯ [TranscriptManager] æº–å‚™æ¨é€ transcript_segment åˆ° store:', {
          originalStartTime: raw.start_time,
          startTimeInSeconds: startTime,
          formattedTime: entry.time,
          text: entry.text.substring(0, 50) + '...'
        })

        console.log('[T] before push', useAppStore.getState().appState)
        useAppStore.getState().addTranscriptEntry(entry)
        console.log('âœ… [TranscriptManager] transcript_segment å·²æ¨é€åˆ° store:', entry)

        // æª¢æŸ¥ç‹€æ…‹æ˜¯å¦æœ‰è®ŠåŒ–
        const currentState = useAppStore.getState()
        console.log('ğŸ“Š [TranscriptManager] Store ç‹€æ…‹æª¢æŸ¥:', {
          appState: currentState.appState,
          transcriptCount: currentState.transcriptEntries.length,
          latestEntry: currentState.transcriptEntries[currentState.transcriptEntries.length - 1]
        })

      } else {
        console.warn('âš ï¸ [TranscriptManager] ç„¡æ•ˆçš„é€å­—ç¨¿æ¢ç›®:', raw)
      }

      this.broadcastToListeners(sessionId, message)
    } else if (message.type === 'transcript_segment') {
      console.log('ğŸ“ [TranscriptManager] é€å­—ç¨¿ç‰‡æ®µè©³æƒ…:', {
        sessionId,
        text: message.text,
        textLength: message.text?.length || 0,
        textPreview: message.text?.substring(0, 50) + (message.text?.length > 50 ? '...' : ''),
        start_time: message.start_time,
        end_time: message.end_time,
        confidence: message.confidence
      })

      // ğŸ¯ è½‰æ› transcript_segment ç‚º TranscriptEntry æ ¼å¼ä¸¦æ¨é€åˆ° store
      if (message.text) {
        try {
          // ä½¿ç”¨ start_time è€Œä¸æ˜¯ timestampï¼Œä¸¦è½‰æ›ç‚º HH:MM:SS æ ¼å¼
          const startTimeInSeconds = message.start_time ?? 0
          const hours = Math.floor(startTimeInSeconds / 3600)
          const minutes = Math.floor((startTimeInSeconds % 3600) / 60)
          const seconds = Math.floor(startTimeInSeconds % 60)

          const entry = {
            startTime: startTimeInSeconds,
            time: `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`,
            text: message.text
          }

          console.log('ğŸ¯ [TranscriptManager] æº–å‚™æ¨é€ transcript_segment åˆ° store:', {
            originalStartTime: message.start_time,
            startTimeInSeconds,
            formattedTime: entry.time,
            text: entry.text.substring(0, 50) + '...'
          })

          console.log('[T] before push', useAppStore.getState().appState)
          useAppStore.getState().addTranscriptEntry(entry)
          console.log('âœ… [TranscriptManager] transcript_segment å·²æ¨é€åˆ° store:', entry)

          // æª¢æŸ¥ç‹€æ…‹æ˜¯å¦æœ‰è®ŠåŒ–
          const currentState = useAppStore.getState()
          console.log('ğŸ“Š [TranscriptManager] Store ç‹€æ…‹æª¢æŸ¥:', {
            appState: currentState.appState,
            transcriptCount: currentState.transcriptEntries.length,
            latestEntry: currentState.transcriptEntries[currentState.transcriptEntries.length - 1]
          })

        } catch (error) {
          console.error('âŒ [TranscriptManager] è™•ç† transcript_segment æ™‚ç™¼ç”ŸéŒ¯èª¤:', error)
        }
      }

      this.broadcastToListeners(sessionId, message)
    } else if (message.type === 'connection_established') {
      console.log('âœ… [TranscriptManager] é€£æ¥å·²å»ºç«‹:', {
        sessionId,
        message: message.message,
        timestamp: message.timestamp
      })
    } else if (message.type === 'transcript_complete') {
      console.log('ğŸ¯ [TranscriptManager] è½‰éŒ„å®Œæˆ:', {
        sessionId,
        message: message.message,
        timestamp: message.timestamp
      })
      this.broadcastToListeners(sessionId, message)
    } else if (message.type === 'heartbeat_ack') {
      console.log('ğŸ’“ [TranscriptManager] å¿ƒè·³å›æ‡‰:', {
        sessionId,
        timestamp: message.timestamp
      })
    } else if (message.type === 'pong') {
      console.log('ğŸ“ [TranscriptManager] Pong å›æ‡‰:', {
        sessionId,
        timestamp: message.timestamp
      })
    } else if (message.phase === 'waiting') {
      console.log('â³ [TranscriptManager] æ”¶åˆ° waiting phase:', {
        sessionId,
        phase: message.phase,
        timestamp: new Date().toISOString()
      })
    } else if (message.phase === 'active') {
      console.log('âœ… [TranscriptManager] æ”¶åˆ° active phaseï¼Œè½‰éŒ„å·²é–‹å§‹:', {
        sessionId,
        phase: message.phase,
        timestamp: new Date().toISOString()
      })
      // å»£æ’­ active phase è¨Šæ¯çµ¦ç›£è½å™¨
      this.broadcastToListeners(sessionId, message)
    } else if (message.type === 'error' || message.type === 'transcription_error') {
      console.error('ğŸš¨ [TranscriptManager] æ”¶åˆ°è½‰éŒ„éŒ¯èª¤:', {
        sessionId,
        type: message.type,
        error_type: message.error_type,
        error_message: message.error_message,
        details: message.details,
        timestamp: new Date().toISOString()
      })
      // å»£æ’­éŒ¯èª¤è¨Šæ¯çµ¦ç›£è½å™¨
      this.broadcastToListeners(sessionId, message)
    } else {
      console.log('ğŸ“¨ [TranscriptManager] æœªçŸ¥è¨Šæ¯é¡å‹:', {
        sessionId,
        type: message.type,
        fullMessage: message
      })
    }
  }

  /**
   * å»£æ’­è¨Šæ¯çµ¦æ‰€æœ‰ç›£è½å™¨
   */
  private broadcastToListeners(sessionId: string, message: TranscriptMessage): void {
    const sessionListeners = this.listeners.get(sessionId)
    console.log('ğŸ“¡ [TranscriptManager] å»£æ’­è¨Šæ¯çµ¦ç›£è½å™¨:', {
      sessionId,
      messageType: message.type,
      listenerCount: sessionListeners?.size || 0,
      hasListeners: !!sessionListeners
    })

    if (sessionListeners) {
      let successCount = 0
      let errorCount = 0

      sessionListeners.forEach(callback => {
        try {
          callback(message)
          successCount++
          console.log(`âœ… [TranscriptManager] ç›£è½å™¨å›èª¿æˆåŠŸ (${successCount}/${sessionListeners.size})`)
        } catch (error) {
          errorCount++
          console.error(`âŒ [TranscriptManager] ç›£è½å™¨å›èª¿éŒ¯èª¤ (${errorCount}/${sessionListeners.size}):`, error)
        }
      })

      console.log(`ğŸ“¡ [TranscriptManager] å»£æ’­å®Œæˆ: ${successCount} æˆåŠŸ, ${errorCount} å¤±æ•—`)
    } else {
      console.warn(`âš ï¸ [TranscriptManager] æ²’æœ‰æ‰¾åˆ° session ${sessionId} çš„ç›£è½å™¨`)
    }
  }

  /**
   * ç™¼é€ ping
   */
  private sendPing(sessionId: string): void {
    const ws = this.connections.get(sessionId)
    if (ws && ws.isConnected) {
      ws.sendJson({ type: 'ping' })
      console.log(`ğŸ“ TranscriptManager: å‘ session ${sessionId} ç™¼é€ ping`)
    }
  }

  /**
   * ç™¼é€å¿ƒè·³ - å¢å¼·ç‹€æ…‹åŒæ­¥
   */
  private sendHeartbeat(sessionId: string): void {
    // å…ˆåŒæ­¥ç‹€æ…‹
    const isActuallyConnected = this.syncConnectionState(sessionId)

    const ws = this.connections.get(sessionId)
    if (ws && isActuallyConnected) {
      try {
        ws.sendJson({
          type: 'heartbeat',
          timestamp: Date.now()
        })
        console.log(`ğŸ’“ TranscriptManager: å‘ session ${sessionId} ç™¼é€å¿ƒè·³`)
      } catch (error) {
        console.error(`âŒ TranscriptManager: ç™¼é€å¿ƒè·³å¤±æ•— ${sessionId}:`, error)
        // å¿ƒè·³ç™¼é€å¤±æ•—ï¼Œå¯èƒ½é€£æ¥å·²æ–·é–‹
        this.connectionStates.set(sessionId, false)
        this.scheduleReconnect(sessionId)
      }
    } else {
      // é€£æ¥å·²æ–·é–‹ï¼Œåœæ­¢å¿ƒè·³ä¸¦å˜—è©¦é‡é€£
      console.warn(`âš ï¸ TranscriptManager: å¿ƒè·³æª¢æ¸¬åˆ°é€£æ¥æ–·é–‹ ${sessionId}`)
      this.stopHeartbeat(sessionId)
      this.connectionStates.set(sessionId, false)
      this.scheduleReconnect(sessionId)
    }
  }

  /**
   * å•Ÿå‹•å¿ƒè·³æ©Ÿåˆ¶
   */
  private startHeartbeat(sessionId: string): void {
    this.stopHeartbeat(sessionId)

    const interval = setInterval(() => {
      this.sendHeartbeat(sessionId)
    }, this.heartbeatInterval)

    this.heartbeatIntervals.set(sessionId, interval)
    console.log(`ğŸ’“ TranscriptManager: ç‚º session ${sessionId} å•Ÿå‹•å¿ƒè·³`)
  }

  /**
   * åœæ­¢å¿ƒè·³æ©Ÿåˆ¶
   */
  private stopHeartbeat(sessionId: string): void {
    const interval = this.heartbeatIntervals.get(sessionId)
    if (interval) {
      clearInterval(interval)
      this.heartbeatIntervals.delete(sessionId)
      console.log(`ğŸ’“ TranscriptManager: ç‚º session ${sessionId} åœæ­¢å¿ƒè·³`)
    }
  }

  /**
   * å®‰æ’é‡é€£
   */
  private scheduleReconnect(sessionId: string): void {
    const attempts = this.reconnectAttempts.get(sessionId) ?? 0

    if (attempts >= this.maxReconnectAttempts) {
      console.error(`âŒ TranscriptManager: Session ${sessionId} é‡é€£æ¬¡æ•¸å·²é”ä¸Šé™`)
      return
    }

    this.reconnectAttempts.set(sessionId, attempts + 1)

    const delay = this.reconnectDelay * Math.pow(2, attempts) // æŒ‡æ•¸é€€é¿
    console.log(`ğŸ”„ TranscriptManager: Session ${sessionId} å°‡åœ¨ ${delay}ms å¾Œé‡é€£ (ç¬¬ ${attempts + 1} æ¬¡)`)

    setTimeout(async () => {
      try {
        await this.establishConnection(sessionId)
        this.reconnectAttempts.set(sessionId, 0) // é‡é€£æˆåŠŸï¼Œé‡ç½®è¨ˆæ•¸
      } catch (error) {
        console.error(`âŒ TranscriptManager: Session ${sessionId} é‡é€£å¤±æ•—:`, error)
      }
    }, delay)
  }

  /**
   * æ–·é–‹æŒ‡å®š session çš„é€£æ¥
   */
  async disconnect(sessionId: string): Promise<void> {
    console.log(`ğŸ“± TranscriptManager: æ–·é–‹ session ${sessionId}`)

    // åœæ­¢å¿ƒè·³
    this.stopHeartbeat(sessionId)

    // æ–·é–‹ WebSocket
    const ws = this.connections.get(sessionId)
    if (ws) {
      ws.disconnect()
      this.connections.delete(sessionId)
    }

    // æ›´æ–°ç‹€æ…‹
    this.connectionStates.set(sessionId, false)

    // æ¸…ç†ç›£è½å™¨
    this.listeners.delete(sessionId)

    // æ¸…ç†é‡é€£è¨ˆæ•¸
    this.reconnectAttempts.delete(sessionId)
  }

  /**
   * æ·»åŠ è¨Šæ¯ç›£è½å™¨
   */
  addListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
    if (!this.listeners.has(sessionId)) {
      this.listeners.set(sessionId, new Set())
    }
    this.listeners.get(sessionId)!.add(callback)
    console.log(`ğŸ“± TranscriptManager: ç‚º session ${sessionId} æ·»åŠ ç›£è½å™¨`)
  }

  /**
   * ç§»é™¤è¨Šæ¯ç›£è½å™¨
   */
  removeListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
    const sessionListeners = this.listeners.get(sessionId)
    if (sessionListeners) {
      sessionListeners.delete(callback)
      if (sessionListeners.size === 0) {
        this.listeners.delete(sessionId)
      }
    }
    console.log(`ğŸ“± TranscriptManager: ç‚º session ${sessionId} ç§»é™¤ç›£è½å™¨`)
  }

  /**
   * æª¢æŸ¥é€£æ¥ç‹€æ…‹ - å„ªåŒ–ç‰ˆï¼Œç¢ºä¿å³æ™‚ç‹€æ…‹åŒæ­¥
   */
  isConnected(sessionId: string): boolean {
    const ws = this.connections.get(sessionId)
    const stateConnected = this.connectionStates.get(sessionId) ?? false

    // å¯¦ä½œæ›´å¯é çš„å³æ™‚ç‹€æ…‹æª¢æ¸¬
    let actualConnected = false

    if (ws) {
      // å¤šé‡æª¢æŸ¥ç¢ºä¿æº–ç¢ºæ€§
      actualConnected = ws.isConnected && (
        ws.readyState === WebSocket.OPEN ||
        (typeof window !== 'undefined' && window.WebSocket && ws.readyState === 1)
      )
    }

    console.log(`ğŸ” [TranscriptManager] é€£æ¥ç‹€æ…‹æª¢æŸ¥:`, {
      sessionId,
      hasWebSocket: !!ws,
      wsReadyState: ws?.readyState,
      wsIsConnected: ws?.isConnected ?? false,
      stateConnected,
      actualConnected,
      needsSync: stateConnected !== actualConnected,
      timestamp: Date.now()
    })

    // å³æ™‚åŒæ­¥ç‹€æ…‹ï¼Œç¢ºä¿ connectionStates èˆ‡å¯¦éš› WebSocket ç‹€æ…‹ä¸€è‡´
    if (stateConnected !== actualConnected) {
      console.log(`ğŸ”„ [TranscriptManager] ç‹€æ…‹ä¸ä¸€è‡´ï¼Œå³æ™‚åŒæ­¥: ${sessionId} ${stateConnected} â†’ ${actualConnected}`, {
        previousState: stateConnected,
        newState: actualConnected,
        wsDetails: {
          isConnected: ws?.isConnected,
          readyState: ws?.readyState
        }
      })
      this.connectionStates.set(sessionId, actualConnected)

      // å¦‚æœé€£æ¥æ–·é–‹ä½†ç‹€æ…‹é¡¯ç¤ºé€£æ¥ï¼Œè§¸ç™¼é‡é€£
      if (stateConnected && !actualConnected) {
        console.warn(`âš ï¸ [TranscriptManager] æª¢æ¸¬åˆ°é€£æ¥æ–·é–‹ï¼Œå°‡è§¸ç™¼é‡é€£: ${sessionId}`)
        this.scheduleReconnect(sessionId)
      }
    }

    return actualConnected
  }

  /**
   * å¼·åŒ–çš„é€£æ¥ç‹€æ…‹ä¸€è‡´æ€§æª¢æŸ¥
   */
  private syncConnectionState(sessionId: string): boolean {
    const ws = this.connections.get(sessionId)
    const currentState = this.connectionStates.get(sessionId) ?? false

    if (!ws) {
      // æ²’æœ‰ WebSocketï¼Œç‹€æ…‹æ‡‰è©²æ˜¯ false
      if (currentState !== false) {
        console.log(`ğŸ”„ [TranscriptManager] åŒæ­¥ç‹€æ…‹ (ç„¡WebSocket): ${sessionId} â†’ false`)
        this.connectionStates.set(sessionId, false)
      }
      return false
    }

    // æœ‰ WebSocketï¼Œæª¢æŸ¥å¯¦éš›é€£æ¥ç‹€æ…‹
    const actualConnected = ws.isConnected && (
      ws.readyState === WebSocket.OPEN ||
      (typeof window !== 'undefined' && window.WebSocket && ws.readyState === 1)
    )

    if (currentState !== actualConnected) {
      console.log(`ğŸ”„ [TranscriptManager] åŒæ­¥ç‹€æ…‹: ${sessionId} ${currentState} â†’ ${actualConnected}`)
      this.connectionStates.set(sessionId, actualConnected)
    }

    return actualConnected
  }

  /**
   * å–å¾—é€£æ¥æ•¸é‡
   */
  getConnectionCount(): number {
    return Array.from(this.connections.values()).filter(ws => ws.isConnected).length
  }

  /**
   * æ¸…ç†æ‰€æœ‰é€£æ¥
   */
  async disconnectAll(): Promise<void> {
    console.log('ğŸ“± TranscriptManager: æ¸…ç†æ‰€æœ‰é€£æ¥')

    const sessionIds = Array.from(this.connections.keys())
    await Promise.all(sessionIds.map(sessionId => this.disconnect(sessionId)))
  }
}

// åŒ¯å‡º Singleton å¯¦ä¾‹
export const transcriptManager = TranscriptManager.getInstance()

// åŒ¯å‡ºé¡å‹
export type { TranscriptMessage }


# END FILE CONTENTS


# File: frontend/components/provider-context-menu.tsx

"use client"

import {
    DropdownMenu,
    DropdownMenuTrigger,
    DropdownMenuContent,
    DropdownMenuItem,
    DropdownMenuSub,
    DropdownMenuSubTrigger,
    DropdownMenuSubContent,
    DropdownMenuRadioGroup,
    DropdownMenuRadioItem,
    DropdownMenuPortal,
} from "@/components/ui/dropdown-menu"
import { Button } from "@/components/ui/button"
import { Settings, Mic, Zap } from "lucide-react"
import { STTProvider } from "@/lib/api"
import { PROVIDERS } from "../constants/providers"

interface ProviderContextMenuProps {
    currentProvider: STTProvider
    onProviderChange: (provider: STTProvider) => void
    disabled?: boolean
}

export function ProviderContextMenu({ currentProvider, onProviderChange, disabled = false }: ProviderContextMenuProps) {
    const providerDisplayName = Object.fromEntries(PROVIDERS.map(p => [p.code, p.label]))

    return (
        <DropdownMenu>
            <DropdownMenuTrigger asChild>
                <Button
                    variant="ghost"
                    size="icon"
                    className="h-8 w-8"
                    disabled={disabled}
                    data-testid="settings-button"
                >
                    <Settings className="w-4 h-4" />
                </Button>
            </DropdownMenuTrigger>
            <DropdownMenuPortal>
                <DropdownMenuContent side="bottom" sideOffset={4} className="bg-white rounded-md">
                    <DropdownMenuItem disabled>Config</DropdownMenuItem>
                    <DropdownMenuSub>
                        <DropdownMenuSubTrigger>Switch Provider</DropdownMenuSubTrigger>
                        <DropdownMenuSubContent className="bg-white rounded-md">
                            <DropdownMenuRadioGroup value={currentProvider} onValueChange={(value) => onProviderChange(value as STTProvider)}>
                                {PROVIDERS.map((p) => (
                                    <DropdownMenuRadioItem value={p.code} key={p.code}>
                                        {p.label}
                                    </DropdownMenuRadioItem>
                                ))}
                            </DropdownMenuRadioGroup>
                        </DropdownMenuSubContent>
                    </DropdownMenuSub>
                </DropdownMenuContent>
            </DropdownMenuPortal>
        </DropdownMenu>
    )
}


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/session-service.test.ts

"use client"

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { SessionService } from '../session-service'
import { sessionAPI } from '../../api'
import type { SessionResponse } from '../../api'

// Mock sessionAPI
vi.mock('../../api', () => ({
    sessionAPI: {
        createSession: vi.fn(),
        upgradeToRecording: vi.fn(),
        finishSession: vi.fn(),
        deleteSession: vi.fn(),
        getActiveSession: vi.fn(),
    }
}))

describe('SessionService', () => {
    let sessionService: SessionService
    const mockSessionAPI = sessionAPI as any

    beforeEach(() => {
        sessionService = new SessionService()
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('æœå‹™åˆå§‹åŒ–', () => {
        it('æ‡‰è©²æ­£ç¢ºåˆå§‹åŒ– SessionService', () => {
            expect(sessionService).toBeDefined()
            expect(sessionService['serviceName']).toBe('SessionService')
        })

        it('æ‡‰è©²æ­£ç¢ºå•Ÿå‹•å’Œåœæ­¢æœå‹™', async () => {
            await sessionService.start()
            expect(sessionService['isRunning']).toBe(true)

            await sessionService.stop()
            expect(sessionService['isRunning']).toBe(false)
        })
    })

    describe('createRecordingSession', () => {
        const mockSession: SessionResponse = {
            id: 'test-session-id',
            title: 'Test Recording Session',
            type: 'recording',
            status: 'active',
            language: 'zh-TW',
            created_at: '2024-01-01T00:00:00Z',
            updated_at: '2024-01-01T00:00:00Z'
        }

        it('æ‡‰è©²æˆåŠŸå‰µå»ºéŒ„éŸ³æœƒè©±', async () => {
            mockSessionAPI.createSession.mockResolvedValue(mockSession)

            const result = await sessionService.createRecordingSession('Test Title', 'Test Content')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'Test Title',
                type: 'recording',
                content: 'Test Content'
            })
            expect(result).toEqual(mockSession)
        })

        it('æ‡‰è©²è™•ç†å¯é¸å…§å®¹åƒæ•¸', async () => {
            mockSessionAPI.createSession.mockResolvedValue(mockSession)

            await sessionService.createRecordingSession('Test Title')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'Test Title',
                type: 'recording',
                content: undefined
            })
        })

        it('æ‡‰è©²è™•ç† API éŒ¯èª¤', async () => {
            const apiError = new Error('API Error')
            mockSessionAPI.createSession.mockRejectedValue(apiError)

            await expect(sessionService.createRecordingSession('Test Title'))
                .rejects.toThrow('API Error')
        })

        it('æ‡‰è©²è™•ç† 409 è¡çªéŒ¯èª¤', async () => {
            const conflictError = new Error('409 Conflict')
            conflictError.message = '409'
            mockSessionAPI.createSession.mockRejectedValue(conflictError)

            await expect(sessionService.createRecordingSession('Test Title'))
                .rejects.toThrow('409')
        })
    })

    describe('createNoteSession', () => {
        const mockSession: SessionResponse = {
            id: 'test-note-session',
            title: 'Test Note Session',
            type: 'note_only',
            status: 'active',
            language: 'zh-TW',
            created_at: '2024-01-01T00:00:00Z',
            updated_at: '2024-01-01T00:00:00Z'
        }

        it('æ‡‰è©²æˆåŠŸå‰µå»ºç´”ç­†è¨˜æœƒè©±', async () => {
            mockSessionAPI.createSession.mockResolvedValue(mockSession)

            const result = await sessionService.createNoteSession('Note Title', 'Note Content')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'Note Title',
                type: 'note_only',
                content: 'Note Content'
            })
            expect(result).toEqual(mockSession)
        })

        it('æ‡‰è©²è™•ç†å¯é¸å…§å®¹åƒæ•¸', async () => {
            mockSessionAPI.createSession.mockResolvedValue(mockSession)

            await sessionService.createNoteSession('Note Title')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'Note Title',
                type: 'note_only',
                content: undefined
            })
        })
    })

    describe('upgradeToRecording', () => {
        const mockUpgradedSession: SessionResponse = {
            id: 'upgraded-session',
            title: 'Upgraded Session',
            type: 'recording',
            status: 'active',
            language: 'zh-TW',
            created_at: '2024-01-01T00:00:00Z',
            updated_at: '2024-01-01T00:00:00Z'
        }

        it('æ‡‰è©²æˆåŠŸå‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼', async () => {
            mockSessionAPI.upgradeToRecording.mockResolvedValue(mockUpgradedSession)

            const result = await sessionService.upgradeToRecording('session-id')

            expect(mockSessionAPI.upgradeToRecording).toHaveBeenCalledWith('session-id')
            expect(result).toEqual(mockUpgradedSession)
        })

        it('æ‡‰è©²è™•ç†å‡ç´šå¤±æ•—', async () => {
            const upgradeError = new Error('Upgrade failed')
            mockSessionAPI.upgradeToRecording.mockRejectedValue(upgradeError)

            await expect(sessionService.upgradeToRecording('session-id'))
                .rejects.toThrow('Upgrade failed')
        })
    })

    describe('finishSession', () => {
        it('æ‡‰è©²æˆåŠŸå®Œæˆæœƒè©±', async () => {
            mockSessionAPI.finishSession.mockResolvedValue(undefined)

            await sessionService.finishSession('session-id')

            expect(mockSessionAPI.finishSession).toHaveBeenCalledWith('session-id')
        })

        it('æ‡‰è©²è™•ç†å®Œæˆæœƒè©±å¤±æ•—', async () => {
            const finishError = new Error('Finish failed')
            mockSessionAPI.finishSession.mockRejectedValue(finishError)

            await expect(sessionService.finishSession('session-id'))
                .rejects.toThrow('Finish failed')
        })
    })

    describe('deleteSession', () => {
        it('æ‡‰è©²æˆåŠŸåˆªé™¤æœƒè©±', async () => {
            mockSessionAPI.deleteSession.mockResolvedValue(undefined)

            await sessionService.deleteSession('session-id')

            expect(mockSessionAPI.deleteSession).toHaveBeenCalledWith('session-id')
        })

        it('æ‡‰è©²è™•ç†åˆªé™¤æœƒè©±å¤±æ•—', async () => {
            const deleteError = new Error('Delete failed')
            mockSessionAPI.deleteSession.mockRejectedValue(deleteError)

            await expect(sessionService.deleteSession('session-id'))
                .rejects.toThrow('Delete failed')
        })
    })

    describe('checkActiveSession', () => {
        const mockActiveSession: SessionResponse = {
            id: 'active-session',
            title: 'Active Session',
            type: 'recording',
            status: 'active',
            language: 'zh-TW',
            created_at: '2024-01-01T00:00:00Z',
            updated_at: '2024-01-01T00:00:00Z'
        }

        it('æ‡‰è©²è¿”å›æ´»èºæœƒè©±', async () => {
            mockSessionAPI.getActiveSession.mockResolvedValue(mockActiveSession)

            const result = await sessionService.checkActiveSession()

            expect(mockSessionAPI.getActiveSession).toHaveBeenCalled()
            expect(result).toEqual(mockActiveSession)
        })

        it('æ‡‰è©²åœ¨æ²’æœ‰æ´»èºæœƒè©±æ™‚è¿”å› null', async () => {
            mockSessionAPI.getActiveSession.mockResolvedValue(null)

            const result = await sessionService.checkActiveSession()

            expect(result).toBeNull()
        })

        it('æ‡‰è©²è™•ç†æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—', async () => {
            const checkError = new Error('Check failed')
            mockSessionAPI.getActiveSession.mockRejectedValue(checkError)

            await expect(sessionService.checkActiveSession())
                .rejects.toThrow('Check failed')
        })
    })

    describe('éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæ¢ä»¶', () => {
        it('æ‡‰è©²è™•ç†ç©ºå­—ç¬¦ä¸²åƒæ•¸', async () => {
            mockSessionAPI.createSession.mockResolvedValue({
                id: 'test-session',
                title: '',
                type: 'recording',
                status: 'active',
                language: 'zh-TW',
                created_at: '2024-01-01T00:00:00Z',
                updated_at: '2024-01-01T00:00:00Z'
            })

            await sessionService.createRecordingSession('')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: '',
                type: 'recording',
                content: undefined
            })
        })

        it('æ‡‰è©²è™•ç†ç¶²è·¯éŒ¯èª¤', async () => {
            const networkError = new Error('Network Error')
            mockSessionAPI.createSession.mockRejectedValue(networkError)

            await expect(sessionService.createRecordingSession('Test'))
                .rejects.toThrow('Network Error')
        })

        it('æ‡‰è©²è™•ç†è¶…æ™‚éŒ¯èª¤', async () => {
            const timeoutError = new Error('Request timeout')
            mockSessionAPI.createSession.mockRejectedValue(timeoutError)

            await expect(sessionService.createRecordingSession('Test'))
                .rejects.toThrow('Request timeout')
        })
    })

    describe('ä¸¦ç™¼å ´æ™¯æ¸¬è©¦', () => {
        it('æ‡‰è©²è™•ç†ä¸¦ç™¼çš„æœƒè©±å‰µå»ºè«‹æ±‚', async () => {
            const mockSession1 = { ...mockSessionAPI, id: 'session-1' }
            const mockSession2 = { ...mockSessionAPI, id: 'session-2' }

            mockSessionAPI.createSession
                .mockResolvedValueOnce(mockSession1)
                .mockResolvedValueOnce(mockSession2)

            const promises = [
                sessionService.createRecordingSession('Session 1'),
                sessionService.createRecordingSession('Session 2')
            ]

            const results = await Promise.all(promises)

            expect(results).toHaveLength(2)
            expect(mockSessionAPI.createSession).toHaveBeenCalledTimes(2)
        })

        it('æ‡‰è©²è™•ç†ä¸€å€‹æˆåŠŸä¸€å€‹å¤±æ•—çš„ä¸¦ç™¼è«‹æ±‚', async () => {
            const mockSession = { id: 'success-session' }
            const error = new Error('Failed')

            mockSessionAPI.createSession
                .mockResolvedValueOnce(mockSession)
                .mockRejectedValueOnce(error)

            const promises = [
                sessionService.createRecordingSession('Success'),
                sessionService.createRecordingSession('Fail')
            ]

            const results = await Promise.allSettled(promises)

            expect(results[0].status).toBe('fulfilled')
            expect(results[1].status).toBe('rejected')
        })
    })

    describe('æœå‹™ç‹€æ…‹ç®¡ç†', () => {
        it('æ‡‰è©²å ±å‘Šæ­£ç¢ºçš„æœå‹™ç‹€æ…‹', () => {
            const info = sessionService.getServiceInfo()

            expect(info).toMatchObject({
                serviceName: 'SessionService',
                isInitialized: expect.any(Boolean),
                isRunning: expect.any(Boolean)
            })
        })

        it('æ‡‰è©²åœ¨å¤šæ¬¡å•Ÿå‹•æ™‚ä¿æŒç©©å®š', async () => {
            await sessionService.start()
            await sessionService.start()
            await sessionService.start()

            expect(sessionService['isRunning']).toBe(true)
        })

        it('æ‡‰è©²åœ¨å¤šæ¬¡åœæ­¢æ™‚ä¿æŒç©©å®š', async () => {
            await sessionService.start()
            await sessionService.stop()
            await sessionService.stop()
            await sessionService.stop()

            expect(sessionService['isRunning']).toBe(false)
        })
    })
})


# END FILE CONTENTS


# File: .env.example

# StudyScriber ç’°å¢ƒè®Šæ•¸

# ============================================
# Supabase è³‡æ–™åº«é…ç½® (å¿…é ˆ)
# ============================================
DB_MODE=supabase
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your-anon-public-key

# ============================================
# èªéŸ³è½‰æ–‡å­— Provider è¨­å®š
# ============================================
# é è¨­ STT Providerï¼šwhisper (Azure OpenAI) æˆ– gemini (Google Vertex AI)
STT_PROVIDER_DEFAULT=whisper

# ============================================
# Azure OpenAI æœå‹™ (Whisper STT - å¿…é ˆ)
# ============================================
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-01
WHISPER_DEPLOYMENT_NAME=whisper-1

# ============================================
# Google Vertex AI æœå‹™ (Gemini STT - å¯é¸)
# ============================================
# å–æ¶ˆè¨»é‡‹ä»¥ä¸‹è¨­å®šä»¥å•Ÿç”¨ Gemini 2.5 Pro STT
# GEMINI_ENDPOINT=us-central1-aiplatform.googleapis.com
# GEMINI_API_KEY=your-gcp-service-account-key
# GEMINI_PROMPT=è«‹è¼¸å‡ºé€å­—ç¨¿ï¼š
# GEMINI_MAX_REQUESTS=90


# ============================================
# Azure OpenAI æ‰¹æ¬¡è™•ç†è¨­å®š (å„ªåŒ–ç‚ºä½å»¶é²)
# ============================================

# æ‰¹æ¬¡è™•ç†è¨­å®š (å„ªåŒ–ç‚ºä½å»¶é²)
# æ‰¹æ¬¡å¤§å°ï¼š2å€‹éŸ³æª”åˆ‡ç‰‡
WHISPER_BATCH_SIZE=2
# æ‰¹æ¬¡è¶…æ™‚ï¼š3ç§’ (ç›®æ¨™å»¶é² â‰¤5ç§’)
WHISPER_BATCH_TIMEOUT=3

# æ•ˆèƒ½ç›£æ§è¨­å®š
# å•Ÿç”¨æ•ˆèƒ½æ—¥èªŒè¨˜éŒ„
ENABLE_PERFORMANCE_LOGGING=true

# ============================================
# Whisper å¹»è¦ºéæ¿¾è¨­å®š (æå‡è½‰éŒ„å“è³ª)
# ============================================
# é€™äº›åƒæ•¸ç”¨æ–¼éæ¿¾ Azure Whisper API ç”¢ç”Ÿçš„ä½å“è³ªæˆ–å¹»è¦ºæ®µè½
# ä½¿ç”¨ verbose_json æ ¼å¼çš„å›æ‡‰é€²è¡Œå¾Œç«¯è‡ªå‹•éæ¿¾

# éœéŸ³æª¢æ¸¬é–€æª» - éæ¿¾é«˜éœéŸ³æ©Ÿç‡çš„æ®µè½
# ç¯„åœï¼š0.0-1.0ï¼Œå€¼è¶Šé«˜è¶Šåš´æ ¼
# å»ºè­°å€¼ï¼š0.8 (éæ¿¾ 80% ä»¥ä¸ŠéœéŸ³æ©Ÿç‡çš„æ®µè½)
# ç”¨é€”ï¼šç§»é™¤ã€Œå—¯ã€ã€ã€Œå‘ƒã€ç­‰å¡«å……è©å’ŒéœéŸ³ç‰‡æ®µ
FILTER_NO_SPEECH=0.8

# ç½®ä¿¡åº¦éæ¿¾é–€æª» - éæ¿¾ä½ç½®ä¿¡åº¦çš„æ®µè½
# ç¯„åœï¼š-5.0 åˆ° 0.0ï¼Œå€¼è¶Šé«˜è¶Šåš´æ ¼
# å»ºè­°å€¼ï¼š-1.0 (éæ¿¾å¹³å‡å°æ•¸æ©Ÿç‡ä½æ–¼ -1.0 çš„æ®µè½)
# ç”¨é€”ï¼šç§»é™¤æ¨¡å‹ä¸ç¢ºå®šçš„è½‰éŒ„çµæœ
FILTER_LOGPROB=-1.0

# é‡è¤‡å…§å®¹æª¢æ¸¬é–€æª» - éæ¿¾é«˜é‡è¤‡æ¯”ç‡çš„æ®µè½
# ç¯„åœï¼š1.0+ï¼Œå€¼è¶Šä½è¶Šåš´æ ¼
# å»ºè­°å€¼ï¼š2.4 (éæ¿¾å£“ç¸®æ¯”å¤§æ–¼ 2.4 çš„æ®µè½)
# ç”¨é€”ï¼šç§»é™¤é‡è¤‡æ–‡å­—ã€è¿´åœˆå¹»è¦ºç­‰å…§å®¹
FILTER_COMPRESSION=2.4

# ============================================
# éŸ³é »åˆ‡ç‰‡é…ç½® (å½±éŸ¿å‰å¾Œç«¯éŒ„éŸ³åˆ‡ç‰‡æ™‚é–“)
# ============================================
# éŸ³é »åˆ‡ç‰‡æ™‚é•·ï¼ˆç§’ï¼‰- åŒæ™‚å½±éŸ¿å‰å¾Œç«¯éŒ„éŸ³é–“éš”
# å»ºè­°å€¼ï¼š5-30ç§’ï¼Œé è¨­10ç§’
AUDIO_CHUNK_DURATION_SEC=5

# ============================================
# Cloudflare R2 å„²å­˜é…ç½® (å¿…é ˆ - ç”¨æ–¼éŸ³æª”å„²å­˜)
# ============================================
# å¸³æˆ¶ ID - åœ¨ Cloudflare æ§åˆ¶å°ä¸­å¯ä»¥æ‰¾åˆ°
R2_ACCOUNT_ID=your-account-id

# API Token - åœ¨ Cloudflare æ§åˆ¶å° > API æ¬Šæ–ä¸­å»ºç«‹
# éœ€è¦çš„æ¬Šé™: Zone:Zone:Read, Account:Cloudflare R2:Edit
R2_API_TOKEN=your-r2-api-token

# å„²å­˜æ¡¶åç¨±
R2_BUCKET_NAME=studyscriber-audio

# R2_ENDPOINT_URL æœƒè‡ªå‹•ç”Ÿæˆ: https://{R2_ACCOUNT_ID}.r2.cloudflarestorage.com
# å¦‚éœ€è‡ªè¨‚ç«¯é»ï¼Œè«‹å–æ¶ˆè¨»é‡‹ä¸‹é¢é€™è¡Œ
# R2_ENDPOINT_URL=https://your-custom-endpoint.com

# ============================================
# æ‡‰ç”¨ç¨‹å¼è¨­å®š (å¯é¸)
# ============================================
DEBUG=false
LOG_LEVEL=INFO


# END FILE CONTENTS


# File: .cursor/rules/backend.mdc

---
description:
globs:
alwaysApply: false
---
## Development Notes

- Dependency-Injection everywhere (container + FastAPI `Depends`)
- Strict TDD workflow: **Red â†’ Green â†’ Refactor** for every ticket
- Clean, layered architecture (API / Services / Domain / Infra / Core)
- Async-first, non-blocking I/O only (`httpx`, `aioboto3`, SQLAlchemy 2.0 async)
- Structured JSON logging with `structlog`
- Environment-based, typed configuration (`pydantic-settings`, Pydantic v2)
- OpenTelemetry tracing + Prometheus metrics
- Graceful startup/shutdown with FastAPI lifespan
- Health, metrics & readiness endpoints for orchestration
- Blue-green/containerised deployment (uvicorn + uvloop)

---

- Async context managers for resources

```python
# Good
async with aiofiles.open(file_path, "rb") as f:
    content = await f.read()

# Bad
f = await aiofiles.open(file_path, "rb")
content = await f.read()
f.close()
```

- Always use structured logging (never `print`)

```python
# Good
logger.info(
    "processing_chunk",
    extra={"chunk_id": chunk_id, "size": len(data)}
)
```

---

## Error-Handling Patterns

```python
# Good
try:
    result = await some_operation()
except ValidationError as e:
    raise HTTPException(status_code=422, detail=e.errors())
except ResourceNotFound as e:
    raise HTTPException(status_code=404, detail=str(e))
except Exception as e:
    logger.error("unexpected_error", exc_info=True)
    raise HTTPException(status_code=500, detail="Internal server error")
```

## WebSocket Patterns

```python
class ConnectionManager:
    def __init__(self):
        self.active: dict[str, WebSocket] = {}

    async def connect(self, ws: WebSocket, client_id: str):
        await ws.accept()
        self.active[client_id] = ws
        logger.info("ws_connected", client_id=client_id)

    async def disconnect(self, client_id: str):
        if client_id in self.active:
            del self.active[client_id]
            logger.info("ws_disconnected", client_id=client_id)

    async def broadcast(self, msg: str, client_id: str):
        if ws := self.active.get(client_id):
            try:
                await ws.send_text(msg)
            except WebSocketDisconnect:
                await self.disconnect(client_id)
```

---

## Database Patterns

```python
async def get_db():
    async with AsyncSession(engine) as session, session.begin():
        yield session
```

---

# Tests

- pytest + pytest-asyncio
- tests/ mirrors source tree
- Fixtures for common data/deps
- Mock external services (OpenAI, R2, Supabase)
- Test success & failure paths
- Coverage â‰¥ 90%

```python
@pytest.mark.asyncio
async def test_process_audio_chunk_success(azure_client_mock, supabase_mock):
    svc = AudioTranscriptionService(azure_client_mock, "deployment")
    ok = await svc.process_audio_chunk(uuid4(), 0, b"webm")
    assert ok is True
    azure_client_mock.audio.transcriptions.create.assert_called_once()
```

---

# Performance Considerations

- DB connection pooling
- Async cache (aioredis TTL)
- Background tasks for heavy CPU work
- Stream files with StreamingResponse
- Proper DB indexes
- PerformanceTimer wrapper for critical paths

---

# Security

- No secrets in code (use env or secret manager)
- Validate all inputs with Pydantic
- CORS allow list, never "*" in prod
- Rate-limit APIs (SlowAPI / gateway)
- Sanitize file uploads
- Secure WebSockets (wss) in production

---

# Logging Levels

- **DEBUG** detailed diagnostics
- **INFO** high-level flow
- **WARNING** unusual situations
- **ERROR** request failed, with stack
- **CRITICAL** service unusable

---

# Deployment
- uvicorn[standard] with `--loop uvloop --http httptools`
- Workers = (2 Ã— CPU) + 1
- Env-specific `.env.*` files
- /healthz & /metrics endpoints
- Graceful shutdown hooks
- Memory monitoring & cleanup tasks


# END FILE CONTENTS


# File: frontend/app/page.tsx

"use client"

import dynamic from "next/dynamic"
import Component from "../study-scriber"

// æ·»åŠ å…¨å±€é™¤éŒ¯åŠŸèƒ½
if (typeof window !== 'undefined') {
  // ç«‹å³åˆå§‹åŒ– TranscriptManagerï¼Œç¢ºä¿åœ¨æ¸¬è©¦ç’°å¢ƒä¸­å¯ç”¨
  import('../lib/transcript-manager').then(({ transcriptManager }) => {
    // ç¢ºä¿ TranscriptManager å·²æš´éœ²åˆ° window
    ; (window as any).transcriptManager = transcriptManager
    console.log('âœ… TranscriptManager å·²åˆå§‹åŒ–ä¸¦æš´éœ²åˆ° window')
  });

  (window as any).debugTranscript = () => {
    const testMessage = {
      type: 'transcript_segment',
      text: 'æ¸¬è©¦é€å­—ç¨¿å…§å®¹ - å¦‚æœçœ‹åˆ°é€™å€‹è¡¨ç¤ºå‰ç«¯å¯ä»¥æ­£å¸¸è™•ç†',
      start_time: 0,
      end_time: 12,
      start_sequence: 0,
      confidence: 0.95
    };

    // å–å¾—ç•¶å‰ session ID
    const appData = (window as any).appData;
    const sessionId = appData?.session?.id || '861f8cee-1f57-476c-8819-0ffe9ec084c8';

    console.log('ğŸ” æ¸¬è©¦é€å­—ç¨¿æ¥æ”¶ï¼ŒSession ID:', sessionId);

    // ç›´æ¥è§¸ç™¼ TranscriptManager çš„è¨Šæ¯è™•ç†
    const manager = (window as any).transcriptManager;
    if (manager) {
      const listeners = manager.listeners.get(sessionId);
      if (listeners && listeners.size > 0) {
        console.log(`ğŸ“¡ æ‰¾åˆ° ${listeners.size} å€‹ç›£è½å™¨ï¼Œé–‹å§‹å»£æ’­æ¸¬è©¦è¨Šæ¯`);
        listeners.forEach((callback: any) => {
          try {
            callback(testMessage);
            console.log('âœ… æ¸¬è©¦è¨Šæ¯å·²ç™¼é€');
          } catch (error) {
            console.error('âŒ ç™¼é€æ¸¬è©¦è¨Šæ¯å¤±æ•—:', error);
          }
        });
      } else {
        console.error('âŒ æ²’æœ‰æ‰¾åˆ°ç›£è½å™¨ï¼Œè«‹ç¢ºèª WebSocket å·²é€£æ¥');
      }
    } else {
      console.error('âŒ TranscriptManager æœªåˆå§‹åŒ–');
    }
  };

  // æ–°å¢ï¼šè¨ºæ–·å‡½æ•¸
  (window as any).debugState = () => {
    const appData = (window as any).appData;
    console.log('ğŸ” å®Œæ•´æ‡‰ç”¨ç‹€æ…‹è¨ºæ–·ï¼š');
    console.log('1. AppData:', appData);
    console.log('2. Session:', appData?.session);
    console.log('3. éŒ„éŸ³ç‹€æ…‹:', {
      isRecording: appData?.isRecording,
      recordingTime: appData?.recordingTime,
      state: appData?.state
    });
    console.log('4. é€å­—ç¨¿:', {
      transcriptEntries: appData?.transcriptEntries,
      count: appData?.transcriptEntries?.length || 0
    });

    // æª¢æŸ¥ transcriptManager çš„å…§éƒ¨ç‹€æ…‹
    const manager = (window as any).transcriptManager;
    if (manager) {
      console.log('5. TranscriptManager:');
      console.log('   - é€£æ¥æ•¸:', manager.getConnectionCount());
      console.log('   - é€£æ¥Map:', manager.connections);
      console.log('   - ç›£è½å™¨Map:', manager.listeners);
    }

    // æª¢æŸ¥ç‚ºä»€éº¼ç‹€æ…‹æ˜¯ default
    console.log('6. ç‹€æ…‹æ˜ å°„æ¢ä»¶:');
    console.log('   - hasSession:', !!appData?.session);
    console.log('   - sessionStatus:', appData?.session?.status);
    console.log('   - sessionType:', appData?.session?.type);
    console.log('   - isRecording:', appData?.isRecording);
    console.log('   - transcriptCount:', appData?.transcriptEntries?.length || 0);
  };

  // æ–°å¢ï¼šç›£è½é€å­—ç¨¿æ›´æ–°
  (window as any).watchTranscripts = () => {
    const sessionId = '861f8cee-1f57-476c-8819-0ffe9ec084c8';

    // æ·»åŠ ä¸€å€‹æ¸¬è©¦ç›£è½å™¨
    const testListener = (message: any) => {
      console.log('ğŸ¯ [æ¸¬è©¦ç›£è½å™¨] æ”¶åˆ°è¨Šæ¯:', {
        type: message.type,
        text: message.text,
        time: new Date().toISOString()
      });
    };

    const manager = (window as any).transcriptManager;
    if (manager) {
      manager.addListener(sessionId, testListener);
      console.log('âœ… æ¸¬è©¦ç›£è½å™¨å·²æ·»åŠ ï¼Œç­‰å¾…é€å­—ç¨¿è¨Šæ¯...');

      // è¿”å›ç§»é™¤å‡½æ•¸
      return () => {
        manager.removeListener(sessionId, testListener);
        console.log('âŒ æ¸¬è©¦ç›£è½å™¨å·²ç§»é™¤');
      };
    } else {
      console.error('âŒ TranscriptManager æœªåˆå§‹åŒ–');
      return () => { };
    }
  };

  // æ–°å¢ï¼šæ‰‹å‹•æ¨é€é€å­—ç¨¿
  (window as any).pushTranscript = (text: string, startTime: number = 0) => {
    const appData = (window as any).appData;
    if (!appData) {
      console.error('âŒ appData æœªå®šç¾©');
      return;
    }

    // è¨ˆç®—æ™‚é–“æ ¼å¼
    const hours = Math.floor(startTime / 3600);
    const minutes = Math.floor((startTime % 3600) / 60);
    const seconds = Math.floor(startTime % 60);
    const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

    // å‰µå»ºæ–°çš„é€å­—ç¨¿é …ç›®
    const newEntry = {
      time: timeStr,
      text: text
    };

    // æ›´æ–° appData
    const currentEntries = appData.transcriptEntries || [];
    const newEntries = [...currentEntries, newEntry];

    // æ‰‹å‹•è§¸ç™¼ç‹€æ…‹æ›´æ–°
    console.log('ğŸ“ æ‰‹å‹•æ¨é€é€å­—ç¨¿:', newEntry);
    console.log('ğŸ“Š æ›´æ–°å‰:', currentEntries.length, 'æ¢');
    console.log('ğŸ“Š æ›´æ–°å¾Œ:', newEntries.length, 'æ¢');

    // æ›´æ–°ç‹€æ…‹
    appData.transcriptEntries = newEntries;

    // å¦‚æœç‹€æ…‹é‚„æ˜¯ recording_waitingï¼Œæ”¹ç‚º recording_active
    if (appData.state === 'recording_waiting' && newEntries.length > 0) {
      appData.state = 'recording_active';
      console.log('âœ… ç‹€æ…‹æ›´æ–°: recording_waiting â†’ recording_active');
    }

    // å¼·åˆ¶é‡æ–°æ¸²æŸ“
    window.location.reload();
  };

  // æ–°å¢ï¼šè¨ºæ–· WebSocket å’Œç‹€æ…‹
  (window as any).diagnose = () => {
    console.log('ğŸ” ========== è¨ºæ–·é–‹å§‹ ==========');

    // 1. æª¢æŸ¥ appData ç‹€æ…‹
    const appData = (window as any).appData;
    console.log('ğŸ“Š [1] appData ç‹€æ…‹:', {
      state: appData?.state,
      isRecording: appData?.isRecording,
      transcriptEntries: appData?.transcriptEntries?.length || 0,
      session: appData?.session ? {
        id: appData.session.id,
        status: appData.session.status,
        type: appData.session.type
      } : undefined
    });

    // 2. æª¢æŸ¥ recording hook ç‹€æ…‹
    const recordingHook = (window as any).recordingHook;
    if (recordingHook) {
      console.log('ğŸ¤ [2] recording hook ç‹€æ…‹:', {
        isRecording: recordingHook.isRecording,
        transcriptsCount: recordingHook.transcripts?.length || 0,
        transcripts: recordingHook.transcripts
      });
    } else {
      console.error('âŒ [2] recording hook æœªæ‰¾åˆ°');
    }

    // 2.5 æª¢æŸ¥ session hook ç‹€æ…‹
    const sessionHook = (window as any).sessionHook;
    if (sessionHook) {
      console.log('ğŸ” [2.5] session hook ç‹€æ…‹:', {
        currentSession: sessionHook.currentSession,
        isLoading: sessionHook.isLoading,
        error: sessionHook.error
      });
    } else {
      console.error('âŒ [2.5] session hook æœªæ‰¾åˆ°');
    }

    // 3. æª¢æŸ¥ TranscriptManager ç‹€æ…‹
    const manager = (window as any).transcriptManager;
    const sessionId = appData?.session?.id || sessionHook?.currentSession?.id;

    if (manager && sessionId) {
      console.log('ğŸ’¬ [3] TranscriptManager ç‹€æ…‹:', {
        isConnected: manager.isConnected(sessionId),
        listeners: manager.listeners.size,
        websocket: manager.websocket ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨',
        sessionId: sessionId
      });
    } else {
      console.error('âŒ [3] session ID æœªå®šç¾© æˆ– TranscriptManager æœªæ‰¾åˆ°', {
        manager: !!manager,
        sessionId: sessionId
      });
    }

    // 4. æª¢æŸ¥ WebSocket è©³æƒ…
    if (manager && sessionId) {
      const connections = manager.connections;
      const ws = connections.get(sessionId);
      if (ws) {
        console.log('ğŸ”Œ [4] WebSocket è©³æƒ…:', {
          readyState: ws.readyState,
          readyStateText: ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'][ws.readyState],
          url: ws.url || ws.wsUrl,
          isConnected: ws.isConnected,
          bufferedAmount: ws.bufferedAmount || 'N/A',
          protocol: ws.protocol || 'N/A'
        });
      } else {
        console.error('âŒ [4] WebSocket é€£æ¥æœªæ‰¾åˆ° for session:', sessionId);
      }
    } else {
      console.error('âŒ [4] TranscriptManager æˆ– sessionId æœªå®šç¾©');
    }

    // 5. æª¢æŸ¥ localStorage
    console.log('ğŸ’¾ [5] localStorage å…§å®¹:', {
      draft_note: localStorage.getItem('draft_note')?.substring(0, 100) + '...',
      hasOtherSessionKeys: Object.keys(localStorage).filter(k => k.includes('session')).length > 0
    });

    // 6. æ‰‹å‹•å»ºç«‹ WebSocket é€£æ¥æ¸¬è©¦
    console.log('ğŸ§ª [6] æ¸¬è©¦ WebSocket é€£æ¥...');
    const testSessionId = sessionId || '23f6bbfe-a846-44db-ba1b-2751adafe0bc'; // ä½¿ç”¨å¾Œç«¯æ—¥èªŒä¸­çš„ session ID
    const wsUrl = `ws://localhost:8000/ws/transcript_feed/${testSessionId}`;
    console.log('ğŸ§ª æ¸¬è©¦ URL:', wsUrl);

    // 7. æª¢æŸ¥ appData ä¸­æ‰€æœ‰å¯ç”¨çš„å±¬æ€§
    console.log('ğŸ” [7] appData å®Œæ•´å…§å®¹:', appData);

    console.log('ğŸ” ========== è¨ºæ–·çµæŸ ==========');
  };

  // æ–°å¢ï¼šå¼·åˆ¶åŒæ­¥ç‹€æ…‹
  (window as any).syncStates = () => {
    console.log('ğŸ”„ å¼·åˆ¶åŒæ­¥æ‰€æœ‰ç‹€æ…‹...');

    const recordingHook = (window as any).recordingHook;
    const sessionHook = (window as any).sessionHook;
    const appData = (window as any).appData;

    if (recordingHook && sessionHook && appData) {
      console.log('ğŸ”„ [åŒæ­¥å‰] ç‹€æ…‹å°æ¯”:', {
        'appData.isRecording': appData.isRecording,
        'recording.isRecording': recordingHook.isRecording,
        'appData.state': appData.state,
        'session.status': sessionHook.currentSession?.status,
        'session.type': sessionHook.currentSession?.type,
        'recording.transcripts.length': recordingHook.transcripts?.length || 0,
        'appData.transcriptEntries.length': appData.transcriptEntries?.length || 0
      });

      // å¼·åˆ¶è§¸ç™¼ç‹€æ…‹é‡æ–°è¨ˆç®—
      const forceUpdate = () => {
        // è§¸ç™¼ä¸€å€‹å¾®å°çš„ç‹€æ…‹è®ŠåŒ–ä¾†å¼·åˆ¶é‡æ–°æ¸²æŸ“
        const currentTime = appData.recordingTime || 0;
        appData.recordingTime = currentTime + 0.001;

        setTimeout(() => {
          appData.recordingTime = currentTime;
          console.log('âœ… å¼·åˆ¶åŒæ­¥å®Œæˆ');
        }, 50);
      };

      forceUpdate();
    } else {
      console.error('âŒ ç„¡æ³•æ‰¾åˆ°å¿…è¦çš„ hooks');
    }
  };

  // æ–°å¢ï¼šä¿®å¾©ç‹€æ…‹ä¸ä¸€è‡´
  (window as any).fixStates = () => {
    console.log('ğŸ”§ æ‰‹å‹•ä¿®å¾©ç‹€æ…‹ä¸ä¸€è‡´...');

    const recordingHook = (window as any).recordingHook;
    const appData = (window as any).appData;

    if (recordingHook && appData) {
      console.log('ğŸ”§ [ä¿®å¾©å‰] ç‹€æ…‹:', {
        'appData.isRecording': appData.isRecording,
        'recording.isRecording': recordingHook.isRecording,
        'appData.state': appData.state
      });

      // å¼·åˆ¶ä¿®å¾© isRecording ç‹€æ…‹
      if (appData.isRecording !== recordingHook.isRecording) {
        console.log('ğŸ”§ ä¿®å¾© isRecording ç‹€æ…‹ä¸ä¸€è‡´');
        appData.isRecording = recordingHook.isRecording;

        // å¦‚æœéŒ„éŸ³å·²åœæ­¢ä½†ç‹€æ…‹é‚„æ˜¯ recording_waitingï¼Œæ”¹ç‚º default
        if (!recordingHook.isRecording && appData.state === 'recording_waiting') {
          console.log('ğŸ”§ ä¿®å¾©ç‹€æ…‹: recording_waiting â†’ default');
          appData.state = 'default';
        }

        // è§¸ç™¼é‡æ–°æ¸²æŸ“
        window.location.reload();
      } else {
        console.log('âœ… ç‹€æ…‹å·²ä¸€è‡´ï¼Œç„¡éœ€ä¿®å¾©');
      }
    } else {
      console.error('âŒ ç„¡æ³•æ‰¾åˆ°å¿…è¦çš„ hooks');
    }
  };

  // æ–°å¢ï¼šå¼·åˆ¶ React é‡æ–°æ¸²æŸ“
  (window as any).forceUpdate = () => {
    console.log('ğŸ”„ å¼·åˆ¶ React é‡æ–°æ¸²æŸ“...');

    // æ–¹æ³• 1ï¼šå‰µå»ºä¸€å€‹å¾®å°çš„ç‹€æ…‹è®ŠåŒ–ä¾†è§¸ç™¼é‡æ–°æ¸²æŸ“
    const appData = (window as any).appData;
    if (appData) {
      const originalRecordingTime = appData.recordingTime;
      appData.recordingTime = originalRecordingTime + 0.1;

      setTimeout(() => {
        appData.recordingTime = originalRecordingTime;
        console.log('âœ… å¼·åˆ¶æ›´æ–°å®Œæˆ');
      }, 100);
    }

    // æ–¹æ³• 2ï¼šå¦‚æœä¸Šé¢ä¸å·¥ä½œï¼Œé‡æ–°è¼‰å…¥é é¢
    console.log('å¦‚æœUIé‚„æ˜¯æ²’æœ‰æ›´æ–°ï¼Œå°‡åœ¨3ç§’å¾Œé‡æ–°è¼‰å…¥é é¢...');
    setTimeout(() => {
      if (confirm('UI æ²’æœ‰æ›´æ–°ï¼Œæ˜¯å¦é‡æ–°è¼‰å…¥é é¢ï¼Ÿ')) {
        window.location.reload();
      }
    }, 3000);
  };
}

export default function Page() {
  return <Component />
}


# END FILE CONTENTS


# File: app/services/stt/save_utils.py

import json, logging
from uuid import UUID
from datetime import datetime

from app.db.database import get_supabase_client
from app.utils.timing import calc_times
from app.ws.transcript_feed import manager as ws

logger = logging.getLogger(__name__)


async def save_and_push_result(
    sid: UUID,
    chunk_seq: int,
    res: dict,
) -> None:
    """
    å°‡ provider å›å‚³çš„çµæœï¼š
      1. å¯«å…¥ transcript_segments
      2. é€é WebSocket æ¨é€çµ¦å‰ç«¯
    å¿…è¦æ¬„ä½ï¼štext, lang_code, timestamp
    å¯é¸æ¬„ä½ï¼šstart_time, end_time
    """
    # -------- 1. æ™‚é–“æ¬„ä½ä¿éšœ --------
    if "start_time" not in res or "end_time" not in res:
        res["start_time"], res["end_time"] = calc_times(chunk_seq)

    # -------- 2. å¯«å…¥ DB -------------
    supa = get_supabase_client()
    seg_data = {
        "session_id": str(sid),
        "chunk_sequence": chunk_seq,
        "text": res["text"],
        "start_time": res["start_time"],
        "end_time": res["end_time"],
        "confidence": 1.0,
        "lang_code": res["lang_code"],
        "created_at": res.get("timestamp", datetime.utcnow().isoformat()),
    }
    row = supa.table("transcript_segments").insert(seg_data).execute()
    seg_id = row.data[0]["id"]

    # -------- 3. WebSocket æ¨é€ ------
    await ws.broadcast(
        json.dumps(
            {
                "type": "transcript_segment",
                "session_id": str(sid),
                "segment_id": seg_id,
                "chunk_sequence": chunk_seq,
                "start_time": res["start_time"],
                "end_time": res["end_time"],
                "text": res["text"],
            }
        ),
        str(sid),
    )
    logger.info("ğŸ“¡ æ¨é€ transcript_segment seq=%s start=%.1f", chunk_seq, res["start_time"])


# END FILE CONTENTS


# File: app/utils/timer.py

import time, logging
logger = logging.getLogger(__name__)

class PerformanceTimer:
    """with PerformanceTimer("name"): ..."""

    def __init__(self, label: str):
        self.label = label
        self._t0: float | None = None

    def __enter__(self):
        self._t0 = time.perf_counter()
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        t_spent = (time.perf_counter() - self._t0) * 1000
        logger.debug("â±ï¸  %s took %.1f ms", self.label, t_spent)


# END FILE CONTENTS


# File: frontend/lib/api.test.ts

import { describe, it, expect, vi } from 'vitest'

// æ¨¡æ“¬ axios å®Œæ•´é…ç½®
vi.mock('axios', () => ({
    default: {
        create: vi.fn(() => ({
            post: vi.fn().mockResolvedValue({ data: {} }),
            get: vi.fn().mockResolvedValue({ data: {} }),
            patch: vi.fn().mockResolvedValue({ data: {} }),
            put: vi.fn().mockResolvedValue({ data: {} }),
            interceptors: {
                request: {
                    use: vi.fn(),
                },
                response: {
                    use: vi.fn(),
                },
            },
        })),
        isAxiosError: vi.fn(),
    },
}))

describe('API Configuration', () => {
    it('should use environment variables for API_BASE_URL', () => {
        // æ¸¬è©¦ç’°å¢ƒè®Šæ•¸é…ç½®
        const expectedURL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000'
        expect(expectedURL).toBe('http://localhost:8000')
    })

    it('should construct WebSocket URL correctly', async () => {
        // å‹•æ…‹ import ä»¥é¿å…æ¨¡çµ„è¼‰å…¥æ™‚çš„éŒ¯èª¤
        const { getWebSocketURL } = await import('./api')

        const wsURL = getWebSocketURL('/test/path')
        const expectedURL = (process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000') + '/test/path'
        expect(wsURL).toBe(expectedURL)
    })
})

describe('API Methods', () => {
    it('should have all required sessionAPI methods', async () => {
        const { sessionAPI } = await import('./api')

        expect(typeof sessionAPI.createSession).toBe('function')
        expect(typeof sessionAPI.getActiveSession).toBe('function')
        expect(typeof sessionAPI.finishSession).toBe('function')
        expect(typeof sessionAPI.upgradeToRecording).toBe('function')
    })

    it('should have all required notesAPI methods', async () => {
        const { notesAPI } = await import('./api')

        expect(typeof notesAPI.updateNote).toBe('function')
        expect(typeof notesAPI.getNote).toBe('function')
    })
})


# END FILE CONTENTS


# File: frontend/lib/api.ts

import axios, { AxiosResponse, AxiosError } from 'axios'

// API åŸºç¤é…ç½® - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000'

// å·®ç•°åŒ–è¶…æ™‚é…ç½®
const API_TIMEOUTS = {
  session: 15000,    // æœƒè©±æ“ä½œéœ€è¦æ›´å¤šæ™‚é–“ï¼ˆå»ºç«‹ã€å‡ç´šç­‰ï¼‰
  notes: 8000,       // ç­†è¨˜æ“ä½œç›¸å°è¼ƒå¿«
  export: 30000,     // åŒ¯å‡ºæ“ä½œå¯èƒ½éœ€è¦æ›´é•·æ™‚é–“
  default: 10000     // å…¶ä»–æ“ä½œä¿æŒç¾æœ‰è¨­å®š
} as const

// éŒ¯èª¤åˆ†é¡ï¼šåˆ¤æ–·æ˜¯å¦å¯é‡è©¦
const isRetriableError = (error: AxiosError): boolean => {
  // ç¶²è·¯éŒ¯èª¤ï¼ˆé€£æ¥å¤±æ•—ã€DNS å¤±æ•—ç­‰ï¼‰
  if (error.code === 'ERR_NETWORK' || error.code === 'ECONNABORTED') {
    return true
  }

  // è¶…æ™‚éŒ¯èª¤
  if (error.code === 'ECONNRESET' || error.message.includes('timeout')) {
    return true
  }

  // ä¼ºæœå™¨éŒ¯èª¤ï¼ˆ5xxï¼‰
  if (error.response?.status && error.response.status >= 500) {
    return true
  }

  // ç‰¹å®šçš„ 4xx éŒ¯èª¤ï¼ˆé€Ÿç‡é™åˆ¶ï¼‰
  if (error.response?.status === 429) {
    return true
  }

  return false
}

// é€šç”¨é‡è©¦æ©Ÿåˆ¶é…ç½®
interface RetryConfig {
  maxRetries: number
  baseDelay: number
  maxDelay: number
  backoffFactor: number
}

const DEFAULT_RETRY_CONFIG: RetryConfig = {
  maxRetries: 3,
  baseDelay: 1000,    // 1ç§’åŸºç¤å»¶é²
  maxDelay: 10000,    // æœ€å¤§å»¶é² 10ç§’
  backoffFactor: 2    // æŒ‡æ•¸é€€é¿å› å­
}

// æŒ‡æ•¸é€€é¿ç®—æ³•
const calculateDelay = (attempt: number, config: RetryConfig): number => {
  const delay = config.baseDelay * Math.pow(config.backoffFactor, attempt - 1)
  return Math.min(delay, config.maxDelay)
}

// å»ºç«‹å°ˆç”¨çš„ API å®¢æˆ¶ç«¯
const createApiClient = (timeoutMs: number) => {
  return axios.create({
    baseURL: API_BASE_URL,
    timeout: timeoutMs,
    headers: {
      'Content-Type': 'application/json',
    },
  })
}

// ä¸åŒé¡å‹çš„ API å®¢æˆ¶ç«¯
const sessionClient = createApiClient(API_TIMEOUTS.session)
const notesClient = createApiClient(API_TIMEOUTS.notes)
const exportClient = createApiClient(API_TIMEOUTS.export)
const defaultClient = createApiClient(API_TIMEOUTS.default)

// é€šç”¨é‡è©¦åŒ…è£å™¨
async function withRetry<T>(
  operation: () => Promise<T>,
  context: string,
  config: Partial<RetryConfig> = {}
): Promise<T> {
  const retryConfig = { ...DEFAULT_RETRY_CONFIG, ...config }

  for (let attempt = 1; attempt <= retryConfig.maxRetries; attempt++) {
    try {
      const result = await operation()

      if (attempt > 1) {
        console.log(`âœ… [APIé‡è©¦] ${context} é‡è©¦æˆåŠŸ (ç¬¬ ${attempt} æ¬¡å˜—è©¦)`)
      }

      return result
    } catch (error) {
      const isLastAttempt = attempt === retryConfig.maxRetries

      if (axios.isAxiosError(error)) {
        // ä¸å¯é‡è©¦çš„éŒ¯èª¤ï¼Œç«‹å³å¤±æ•—
        if (!isRetriableError(error)) {
          console.log(`âŒ [APIé‡è©¦] ${context} é‡åˆ°ä¸å¯é‡è©¦éŒ¯èª¤ï¼Œç«‹å³çµ‚æ­¢:`, {
            status: error.response?.status,
            code: error.code,
            message: error.message,
          });
          throw error;
        }

        // æœ€å¾Œä¸€æ¬¡å˜—è©¦å¤±æ•—
        if (isLastAttempt) {
          console.error(`âŒ [APIé‡è©¦] ${context} é‡è©¦å¤±æ•—ï¼Œå·²é”æœ€å¤§é‡è©¦æ¬¡æ•¸ (${retryConfig.maxRetries})`)
          throw error
        }

        // è¨ˆç®—å»¶é²æ™‚é–“
        const delay = calculateDelay(attempt, retryConfig)

        console.warn(`âš ï¸ [APIé‡è©¦] ${context} ç¬¬ ${attempt} æ¬¡å˜—è©¦å¤±æ•—ï¼Œ${delay}ms å¾Œé‡è©¦...`, {
          status: error.response?.status,
          code: error.code,
          attempt: `${attempt}/${retryConfig.maxRetries}`,
          nextDelay: delay
        })

        // ç­‰å¾…å¾Œé‡è©¦
        await new Promise(resolve => setTimeout(resolve, delay))
      } else {
        // é Axios éŒ¯èª¤ï¼Œç›´æ¥æ‹‹å‡º
        throw error
      }
    }
  }

  // é€™è£¡ä¸æ‡‰è©²è¢«åŸ·è¡Œåˆ°
  throw new Error(`${context} é‡è©¦é‚è¼¯ç•°å¸¸`)
}

// çµ±ä¸€çš„å›æ‡‰æ””æˆªå™¨è¨­ç½®
const setupInterceptors = (client: typeof sessionClient, clientName: string) => {
  client.interceptors.response.use(
    (response: AxiosResponse) => {
      console.log(`ğŸ“¡ [${clientName}] API è«‹æ±‚æˆåŠŸ:`, {
        method: response.config.method?.toUpperCase(),
        url: response.config.url,
        status: response.status,
        duration: response.headers['x-response-time'] || 'unknown'
      })
      return response
    },
    (error: AxiosError) => {
      // ä¸é¡¯ç¤ºé æœŸçš„ 404 éŒ¯èª¤ï¼ˆä¾‹å¦‚ï¼šæ²’æœ‰æ´»èºæœƒè©±ï¼‰
      const isExpected404 = error.response?.status === 404 &&
        error.config?.url?.includes('/api/session/active')

      if (!isExpected404) {
        console.error(`âŒ [${clientName}] API éŒ¯èª¤:`, {
          method: error.config?.method?.toUpperCase(),
          url: error.config?.url,
          status: error.response?.status,
          code: error.code,
          message: error.message,
          isRetriable: isRetriableError(error)
        })
      }

      return Promise.reject(error)
    }
  )
}

// è¨­ç½®æ‰€æœ‰å®¢æˆ¶ç«¯çš„æ””æˆªå™¨
setupInterceptors(sessionClient, 'Session')
setupInterceptors(notesClient, 'Notes')
setupInterceptors(exportClient, 'Export')
setupInterceptors(defaultClient, 'Default')

// å‹åˆ¥å®šç¾©
export interface SessionCreateRequest {
  title?: string
  type: 'note_only' | 'recording'
  content?: string
  start_ts?: number  // éŒ„éŸ³é–‹å§‹æ™‚é–“æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œç”¨æ–¼ç²¾ç¢ºæ™‚é–“åŒæ­¥
  lang_code?: string  // BCP-47 èªè¨€ç¢¼ï¼ˆå¦‚ zh-TW, en-USï¼‰
  stt_provider?: string  // èªéŸ³è½‰æ–‡å­— Provider åç¨±ï¼ˆå¦‚ whisper, gpt4oï¼‰
}

// STT Provider é¡å‹å®šç¾©
export type STTProvider = 'whisper' | 'gemini' | 'gpt4o'

export interface SessionResponse {
  id: string
  title?: string
  type: 'note_only' | 'recording'
  status: 'draft' | 'active' | 'processing' | 'completed' | 'error'
  language: string
  created_at: string
  updated_at: string
}

export interface NoteUpdateRequest {
  content: string
  client_ts?: string  // ISO æ™‚é–“æˆ³å­—ä¸²ï¼Œå¯é¸
}

export interface NoteUpdateResponse {
  success: boolean
  message: string
  server_ts: string  // ISO æ™‚é–“æˆ³å­—ä¸²
  note: NoteResponse
}

export interface NoteResponse {
  session_id: string
  content: string
  client_ts?: string  // ISO æ™‚é–“æˆ³å­—ä¸²ï¼Œå¯é¸
  created_at: string
  updated_at: string
}

// Session API - ä½¿ç”¨æœƒè©±å°ˆç”¨å®¢æˆ¶ç«¯å’Œé‡è©¦æ©Ÿåˆ¶
export const sessionAPI = {
  // å»ºç«‹æ–°æœƒè©±
  async createSession(data: SessionCreateRequest): Promise<SessionResponse> {
    return withRetry(
      async () => {
        const response = await sessionClient.post('/api/session', data)
        return response.data
      },
      `å»ºç«‹æœƒè©± (${data.type})`,
      { maxRetries: 2 } // æœƒè©±å»ºç«‹é‡è©¦æ¬¡æ•¸è¼ƒå°‘ï¼Œé¿å…é‡è¤‡å»ºç«‹
    )
  },

  // ç²å–æ´»èºæœƒè©± - å¢å¼·é‡è©¦æ©Ÿåˆ¶
  async getActiveSession(): Promise<SessionResponse | null> {
    return withRetry(
      async () => {
        try {
          const response = await sessionClient.get('/api/session/active')
          return response.data
        } catch (error) {
          // å¦‚æœæ²’æœ‰æ´»èºæœƒè©±ï¼Œè¿”å› null è€Œä¸æ˜¯æ‹‹å‡ºéŒ¯èª¤
          if (axios.isAxiosError(error) && error.response?.status === 404) {
            return null
          }
          throw error
        }
      },
      'æª¢æŸ¥æ´»èºæœƒè©±',
      { maxRetries: 3, baseDelay: 500 } // æ›´é »ç¹çš„é‡è©¦ï¼ŒåŸºç¤å»¶é²è¼ƒçŸ­
    )
  },

  // å®Œæˆæœƒè©±
  async finishSession(sessionId: string): Promise<void> {
    return withRetry(
      async () => {
        await sessionClient.patch(`/api/session/${sessionId}/finish`)
      },
      `å®Œæˆæœƒè©± (${sessionId})`,
      { maxRetries: 2 }
    )
  },

  // å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼
  async upgradeToRecording(sessionId: string): Promise<SessionResponse> {
    return withRetry(
      async () => {
        const response = await sessionClient.patch(`/api/session/${sessionId}/upgrade`)
        return response.data
      },
      `å‡ç´šæœƒè©± (${sessionId})`,
      { maxRetries: 2 }
    )
  },

  // åˆªé™¤æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“š
  async deleteSession(sessionId: string): Promise<{ success: boolean; message: string }> {
    return withRetry(
      async () => {
        const response = await sessionClient.delete(`/api/session/${sessionId}`)
        return response.data
      },
      `åˆªé™¤æœƒè©± (${sessionId})`,
      { maxRetries: 2 }
    )
  },
}

// Notes API - ä½¿ç”¨ç­†è¨˜å°ˆç”¨å®¢æˆ¶ç«¯å’Œé‡è©¦æ©Ÿåˆ¶
export const notesAPI = {
  // æ›´æ–°ç­†è¨˜å…§å®¹
  async updateNote(sessionId: string, data: NoteUpdateRequest): Promise<NoteUpdateResponse> {
    return withRetry(
      async () => {
        const response = await notesClient.put(`/api/notes/${sessionId}`, data)
        return response.data
      },
      `æ›´æ–°ç­†è¨˜ (${sessionId})`,
      { maxRetries: 3, baseDelay: 500 } // ç­†è¨˜æ›´æ–°é‡è©¦è¼ƒç©æ¥µ
    )
  },

  // ç²å–ç­†è¨˜å…§å®¹
  async getNote(sessionId: string): Promise<NoteResponse> {
    return withRetry(
      async () => {
        const response = await notesClient.get(`/api/notes/${sessionId}`)
        return response.data
      },
      `ç²å–ç­†è¨˜ (${sessionId})`,
      { maxRetries: 3, baseDelay: 500 }
    )
  },
}

// Export API - ä½¿ç”¨åŒ¯å‡ºå°ˆç”¨å®¢æˆ¶ç«¯
export const exportAPI = {
  // åŒ¯å‡ºæœƒè©±è³‡æ–™
  async exportSession(sessionId: string, type: 'zip' | 'md' = 'zip'): Promise<Blob> {
    return withRetry(
      async () => {
        const response = await exportClient.get(`/api/export/${sessionId}`, {
          params: { type },
          responseType: 'blob',
        })
        return response.data
      },
      `åŒ¯å‡ºæœƒè©± (${sessionId})`,
      { maxRetries: 2, baseDelay: 2000 } // åŒ¯å‡ºé‡è©¦å»¶é²è¼ƒé•·
    )
  },
}

// WebSocket URL å»ºæ§‹ - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸
export const getWebSocketURL = (path: string): string => {
  const wsBaseURL = process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000'
  return `${wsBaseURL}${path}`
}

// åŒ¯å‡ºé‡è©¦åŠŸèƒ½ä¾›å…¶ä»–æ¨¡çµ„ä½¿ç”¨
export { withRetry, isRetriableError, API_TIMEOUTS }

// ä¿æŒå‘å¾Œå…¼å®¹æ€§
export default defaultClient


# END FILE CONTENTS


# File: frontend/lib/audio-recorder.ts

"use client"

import { getAudioChunkIntervalMs } from './config'

// éŸ³è¨ŠéŒ„è£½ç‹€æ…‹
export type AudioRecorderState = 'idle' | 'recording' | 'paused' | 'error'

// éŸ³è¨ŠéŒ„è£½é…ç½®
export interface AudioRecorderConfig {
  chunkInterval: number // åˆ‡ç‰‡é–“éš”ï¼ˆæ¯«ç§’ï¼‰
  mimeType: string // éŸ³è¨Šæ ¼å¼
  audioBitsPerSecond?: number // éŸ³è¨Šä½å…ƒç‡
}

// éŸ³è¨Šåˆ‡ç‰‡è³‡æ–™
export interface AudioChunk {
  blob: Blob
  timestamp: number
  duration: number
  sequence: number
}

// é è¨­é…ç½®
const DEFAULT_CONFIG: AudioRecorderConfig = {
  chunkInterval: 12000, // 12 ç§’
  mimeType: 'audio/webm;codecs=opus',
  audioBitsPerSecond: 64000, // 64 kbps
}

// æ”¯æ´çš„éŸ³è¨Šæ ¼å¼åˆ—è¡¨ï¼ˆå„ªå…ˆé †åºï¼‰
// MP4 æ ¼å¼åœ¨ FFmpeg 7.1.1 ä¸­æœ‰æ›´å¥½çš„å…¼å®¹æ€§ï¼Œå› æ­¤æ”¾åœ¨ç¬¬ä¸€ä½
const SUPPORTED_MIME_TYPES = [
  'audio/webm;codecs=opus', // ç¬¬ä¸€å„ªå…ˆï¼šWebM Opus ç·¨è§£ç¢¼å™¨ï¼ŒéŸ³è³ªå„ªç§€ä¸”ä¸²æµå‹å¥½
  'audio/webm',             // ç¬¬äºŒå„ªå…ˆï¼šWebM é€šç”¨æ ¼å¼
  'audio/mp4',              // ç¬¬ä¸‰å„ªå…ˆï¼šMP4 ä½œç‚ºå‚™é¸æ–¹æ¡ˆ
  'audio/ogg;codecs=opus',
  'audio/wav',
]

export class AudioRecorder {
  private mediaRecorder: MediaRecorder | null = null
  private stream: MediaStream | null = null
  private config: AudioRecorderConfig
  private state: AudioRecorderState = 'idle'
  private chunkSequence: number = 0 // åˆ‡ç‰‡åºè™Ÿè¨ˆæ•¸å™¨

  // äº‹ä»¶å›èª¿
  private onChunkCallback?: (chunk: AudioChunk) => void
  private onStateChangeCallback?: (state: AudioRecorderState) => void
  private onErrorCallback?: (error: Error) => void

  constructor(config: Partial<AudioRecorderConfig> = {}) {
    this.config = { ...DEFAULT_CONFIG, ...config }
  }

  /**
   * é–‹å§‹éŒ„è£½
   */
  async start(onDataAvailable: (chunk: AudioChunk) => void): Promise<void> {
    if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
      throw new Error('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
    }

    // ç²å–éº¥å…‹é¢¨æ¬Šé™
    this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })

    // å‰µå»º MediaRecorder
    this.mediaRecorder = new MediaRecorder(this.stream, {
      mimeType: this.config.mimeType,
      audioBitsPerSecond: this.config.audioBitsPerSecond,
    })

    // é‡ç½®åºè™Ÿè¨ˆæ•¸å™¨
    this.chunkSequence = 0

    // ç›£è½è³‡æ–™å¯ç”¨äº‹ä»¶
    this.mediaRecorder.ondataavailable = (event) => {
      console.log('ğŸ™ï¸ [AudioRecorder] MediaRecorder.ondataavailable è§¸ç™¼', {
        dataSize: event.data.size,
        sequence: this.chunkSequence,
        timestamp: new Date().toISOString()
      })

      if (event.data.size > 0) {
        const chunk: AudioChunk = {
          blob: event.data,
          timestamp: Date.now(),
          duration: this.config.chunkInterval,
          sequence: this.chunkSequence++, // åˆ†é…åºè™Ÿä¸¦éå¢
        }

        console.log('ğŸ“¦ [AudioRecorder] å»ºç«‹éŸ³é »åˆ‡ç‰‡', {
          sequence: chunk.sequence,
          size: chunk.blob.size,
          duration: chunk.duration,
          mimeType: this.config.mimeType
        })

        onDataAvailable(chunk)
      } else {
        console.warn('âš ï¸ [AudioRecorder] ondataavailable ä½† data.size = 0')
      }
    }

    // é–‹å§‹éŒ„è£½ï¼Œæ¯éš”æŒ‡å®šæ™‚é–“ç”¢ç”Ÿä¸€å€‹åˆ‡ç‰‡
    console.log('ğŸ¬ [AudioRecorder] é–‹å§‹éŒ„è£½', {
      chunkInterval: this.config.chunkInterval,
      mimeType: this.config.mimeType,
      state: this.mediaRecorder.state
    })

    this.mediaRecorder.start(this.config.chunkInterval)

    console.log('âœ… [AudioRecorder] MediaRecorder.start() å·²èª¿ç”¨', {
      state: this.mediaRecorder.state,
      stream: this.stream ? 'active' : 'null'
    })
  }

  /**
   * åœæ­¢éŒ„è£½
   */
  stop(): void {
    if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
      this.mediaRecorder.stop()
    }

    if (this.stream) {
      this.stream.getTracks().forEach(track => track.stop())
      this.stream = null
    }

    this.mediaRecorder = null
    this.chunkSequence = 0 // é‡ç½®åºè™Ÿ
  }

  /**
   * ç²å–éŒ„è£½ç‹€æ…‹
   */
  get isRecording(): boolean {
    return this.mediaRecorder !== null && this.mediaRecorder.state === 'recording'
  }

  /**
   * ç²å–ç•¶å‰åºè™Ÿ
   */
  get currentSequence(): number {
    return this.chunkSequence
  }

  // æ¸…ç†è³‡æº
  cleanup(): void {
    this.stop()

    if (this.stream) {
      this.stream.getTracks().forEach(track => track.stop())
      this.stream = null
    }

    this.mediaRecorder = null
    console.log('ğŸ§¹ éŸ³è¨ŠéŒ„è£½å™¨å·²æ¸…ç†')
  }

  // è¨­å®šç‹€æ…‹
  private setState(newState: AudioRecorderState): void {
    this.state = newState
    this.onStateChangeCallback?.(newState)
  }

  // éŒ¯èª¤è™•ç†
  private handleError(error: Error): void {
    console.error('âŒ AudioRecorder éŒ¯èª¤:', error)
    this.setState('error')
    this.onErrorCallback?.(error)
  }

  // äº‹ä»¶å›èª¿è¨­å®š
  onChunk(callback: (chunk: AudioChunk) => void): void {
    this.onChunkCallback = callback
  }

  onStateChange(callback: (state: AudioRecorderState) => void): void {
    this.onStateChangeCallback = callback
  }

  onError(callback: (error: Error) => void): void {
    this.onErrorCallback = callback
  }

  // Getter
  get currentState(): AudioRecorderState {
    return this.state
  }

  get currentConfig(): AudioRecorderConfig {
    return { ...this.config }
  }
}

// å·¥å» å‡½æ•¸
export const createAudioRecorder = (config?: Partial<AudioRecorderConfig>): AudioRecorder => {
  return new AudioRecorder(config)
}

/**
 * æª¢æŸ¥ç€è¦½å™¨éŸ³è¨ŠéŒ„è£½æ”¯æ´
 */
export async function checkAudioRecordingSupport(): Promise<{ isSupported: boolean; error?: string }> {
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API' }
  }

  if (!window.MediaRecorder) {
    return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API' }
  }

  // æª¢æŸ¥ MIME é¡å‹æ”¯æ´
  if (!MediaRecorder.isTypeSupported(DEFAULT_CONFIG.mimeType)) {
    return { isSupported: false, error: `ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${DEFAULT_CONFIG.mimeType}` }
  }

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
    // ç«‹å³åœæ­¢ä¸²æµä»¥é‡‹æ”¾è³‡æº
    stream.getTracks().forEach(track => track.stop())
    return { isSupported: true }
  } catch (error) {
    return { isSupported: false, error: `ç„¡æ³•ç²å–éº¥å…‹é¢¨æ¬Šé™: ${error}` }
  }
}


# END FILE CONTENTS


# File: frontend/vitest.config.ts

/// <reference types="vitest" />
import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
    plugins: [react()],
    test: {
        globals: true,
        environment: 'jsdom',
    },
    resolve: {
        alias: {
            '@': path.resolve(__dirname, './'),
        },
    },
})


# END FILE CONTENTS


# File: playwright.config.ts

 

# END FILE CONTENTS


# File: frontend/lib/__tests__/state-management.test.ts

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { renderHook, act } from '@testing-library/react'
import { createElement } from 'react'
import { AppStateProvider, useAppStateContext } from '../../hooks/use-app-state-context'
import { useAppStateNew } from '../../hooks/use-app-state-new'
import { featureFlagManager } from '../feature-flags'
import { InitialStateLoader } from '../initial-state-loader'
import type { ReactNode } from 'react'

// Mock å¤–éƒ¨ä¾è³´
vi.mock('../../hooks/use-session-adapter', () => ({
    useSession: vi.fn(() => ({
        currentSession: null,
        isLoading: false,
        error: null,
        createNoteSession: vi.fn(),
        createRecordingSession: vi.fn(),
        upgradeToRecording: vi.fn(),
        finishSession: vi.fn(),
        deleteSession: vi.fn(),
        checkActiveSession: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-recording-adapter', () => ({
    useRecording: vi.fn(() => ({
        isRecording: false,
        recordingTime: 0,
        transcripts: [],
        error: null,
        startRecording: vi.fn(),
        stopRecording: vi.fn(),
        clearTranscripts: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-notes', () => ({
    useNotes: vi.fn(() => ({
        noteContent: '',
        loadNote: vi.fn(),
        clearNote: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-transcript-adapter', () => ({
    useTranscript: vi.fn(() => ({
        isConnected: false,
        error: null,
        autoScrollEnabled: true,
        disconnect: vi.fn(),
        clearTranscripts: vi.fn(),
        enableAutoScroll: vi.fn(),
        disableAutoScroll: vi.fn(),
        scrollToLatest: vi.fn(),
    }))
}))

vi.mock('@/components/ui/use-toast', () => ({
    useToast: vi.fn(() => ({
        toast: vi.fn(),
    }))
}))

// Mock InitialStateLoader
vi.mock('../../initial-state-loader', () => ({
    InitialStateLoader: {
        loadInitialAppData: vi.fn(() => ({
            state: 'default',
            transcriptEntries: [],
            editorContent: '',
            isRecording: false,
            recordingTime: 0,
            session: null,
        })),
        saveAppState: vi.fn(),
        clearPersistedState: vi.fn(),
        hasPersistedState: vi.fn(() => false),
    }
}))

function TestWrapper({ children }: { children: ReactNode }) {
    return createElement(AppStateProvider, null, children)
}

describe('ç‹€æ…‹ç®¡ç†æ•´åˆæ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        featureFlagManager.reset()
        featureFlagManager.enable('useNewStateManagement')
    })

    describe('Context èˆ‡ Hook å”ä½œ', () => {
        test('Context æ‡‰è©²ç‚º Hook æä¾›æ­£ç¢ºçš„ç‹€æ…‹', () => {
            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            expect(result.current.appData).toBeDefined()
            expect(result.current.appData.state).toBe('default')
            expect(result.current.appData.isRecording).toBe(false)
            expect(result.current.appData.transcriptEntries).toEqual([])
        })

        test('Hook çš„ç‹€æ…‹è®Šæ›´æ‡‰è©²æ›´æ–° Context', async () => {
            const { result } = renderHook(() => {
                const context = useAppStateContext()
                const hook = useAppStateNew()
                return { context, hook }
            }, {
                wrapper: TestWrapper
            })

            // æ¸¬è©¦ç·¨è¼¯å™¨å…§å®¹æ›´æ–°
            await act(async () => {
                result.current.hook.saveLocalDraft('æ¸¬è©¦å…§å®¹')
            })

            expect(result.current.context.appData.editorContent).toBe('æ¸¬è©¦å…§å®¹')
        })

        test('Context dispatch æ‡‰è©²è§¸ç™¼ Hook é‡æ–°æ¸²æŸ“', async () => {
            const { result } = renderHook(() => {
                const context = useAppStateContext()
                const hook = useAppStateNew()
                return { context, hook }
            }, {
                wrapper: TestWrapper
            })

            const initialIsRecording = result.current.hook.appData.isRecording

            // ç›´æ¥é€é Context dispatch æ›´æ–°ç‹€æ…‹
            await act(async () => {
                result.current.context.dispatch({
                    type: 'SET_RECORDING',
                    payload: true
                })
            })

            // Hook æ‡‰è©²é‡æ–°æ¸²æŸ“ä¸¦åæ˜ æ–°ç‹€æ…‹
            expect(result.current.hook.appData.isRecording).toBe(true)
            expect(result.current.hook.appData.isRecording).not.toBe(initialIsRecording)
        })
    })

    describe('ç‹€æ…‹ä¸€è‡´æ€§æ¸¬è©¦', () => {
        test('å¤šå€‹ Hook å¯¦ä¾‹æ‡‰è©²å…±äº«ç›¸åŒç‹€æ…‹', () => {
            const { result: result1 } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })
            const { result: result2 } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // å…©å€‹ Hook å¯¦ä¾‹æ‡‰è©²æœ‰ç›¸åŒçš„ç‹€æ…‹
            expect(result1.current.appData.state).toBe(result2.current.appData.state)
            expect(result1.current.appData.isRecording).toBe(result2.current.appData.isRecording)
        })

        test('ç‹€æ…‹è®Šæ›´æ‡‰è©²åŒæ­¥åˆ°æ‰€æœ‰ Hook å¯¦ä¾‹', async () => {
            const { result: result1 } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })
            const { result: result2 } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // é€éç¬¬ä¸€å€‹ Hook æ›´æ–°ç‹€æ…‹
            await act(async () => {
                result1.current.saveLocalDraft('åŒæ­¥æ¸¬è©¦')
            })

            // ç¬¬äºŒå€‹ Hook æ‡‰è©²åæ˜ ç›¸åŒçš„è®Šæ›´
            expect(result2.current.appData.editorContent).toBe('åŒæ­¥æ¸¬è©¦')
        })
    })

    describe('åˆå§‹ç‹€æ…‹è¼‰å…¥æ•´åˆ', () => {
        test('Provider å•Ÿå‹•æ™‚æ‡‰è©²è¼‰å…¥åˆå§‹ç‹€æ…‹', () => {
            const mockInitialData = {
                state: 'recording_active' as const,
                transcriptEntries: [{ time: '00:01', text: 'æ¸¬è©¦é€å­—ç¨¿' }],
                editorContent: 'æ¸¬è©¦å…§å®¹',
                isRecording: true,
                recordingTime: 30,
                session: { id: 'test-session', status: 'active' as const, type: 'recording' as const }
            }

            vi.mocked(InitialStateLoader.loadInitialAppData).mockReturnValue(mockInitialData)

            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // æ‡‰è©²è¼‰å…¥åˆå§‹ç‹€æ…‹
            expect(InitialStateLoader.loadInitialAppData).toHaveBeenCalled()
            // æ³¨æ„ï¼šç”±æ–¼ useEffect çš„ç•°æ­¥ç‰¹æ€§ï¼Œåˆå§‹ç‹€æ…‹å¯èƒ½éœ€è¦é¡å¤–çš„æ¸²æŸ“é€±æœŸ
        })

        test('ç‹€æ…‹è®Šæ›´æ‡‰è©²è§¸ç™¼æŒä¹…åŒ–', async () => {
            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            await act(async () => {
                result.current.saveLocalDraft('éœ€è¦æŒä¹…åŒ–çš„å…§å®¹')
            })

            // ç­‰å¾…æŒä¹…åŒ–é‚è¼¯åŸ·è¡Œ
            await new Promise(resolve => setTimeout(resolve, 1100)) // ç­‰å¾…è¶…é 1 ç§’çš„å»¶é²

            expect(InitialStateLoader.saveAppState).toHaveBeenCalled()
        })
    })

    describe('éŒ¯èª¤è™•ç†æ•´åˆ', () => {
        test('åˆå§‹ç‹€æ…‹è¼‰å…¥å¤±æ•—æ‡‰è©²ä½¿ç”¨é è¨­ç‹€æ…‹', () => {
            vi.mocked(InitialStateLoader.loadInitialAppData).mockImplementation(() => {
                throw new Error('è¼‰å…¥å¤±æ•—')
            })

            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // æ‡‰è©²å›é€€åˆ°é è¨­ç‹€æ…‹
            expect(result.current.appData.state).toBe('default')
            expect(result.current.appData.transcriptEntries).toEqual([])
        })

        test('æŒä¹…åŒ–å¤±æ•—ä¸æ‡‰è©²å½±éŸ¿æ‡‰ç”¨é‹ä½œ', async () => {
            vi.mocked(InitialStateLoader.saveAppState).mockImplementation(() => {
                throw new Error('å„²å­˜å¤±æ•—')
            })

            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // ç‹€æ…‹è®Šæ›´æ‡‰è©²ä»ç„¶æ­£å¸¸å·¥ä½œ
            await act(async () => {
                result.current.saveLocalDraft('æ¸¬è©¦å…§å®¹')
            })

            expect(result.current.appData.editorContent).toBe('æ¸¬è©¦å…§å®¹')
        })
    })

    describe('è¨˜æ†¶é«”ç®¡ç†', () => {
        test('Hook unmount ä¸æ‡‰è©²å°è‡´è¨˜æ†¶é«”æ´©æ¼', () => {
            const { unmount } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // unmount æ‡‰è©²æ­£å¸¸åŸ·è¡Œè€Œä¸æ‹‹å‡ºéŒ¯èª¤
            expect(() => unmount()).not.toThrow()
        })

        test('å¤šæ¬¡ mount/unmount æ‡‰è©²ç©©å®š', () => {
            for (let i = 0; i < 5; i++) {
                const { unmount } = renderHook(() => useAppStateNew(), {
                    wrapper: TestWrapper
                })
                unmount()
            }

            // æœ€å¾Œä¸€æ¬¡æ‡‰è©²ä»ç„¶æ­£å¸¸å·¥ä½œ
            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            expect(result.current.appData).toBeDefined()
        })
    })
})


# END FILE CONTENTS


# File: frontend/next.config.mjs

/** @type {import('next').NextConfig} */
const nextConfig = {
  eslint: {
    ignoreDuringBuilds: true,
  },
  typescript: {
    ignoreBuildErrors: true,
  },
  images: {
    unoptimized: true,
  },
}

export default nextConfig

# END FILE CONTENTS


# File: frontend/hooks/use-transcript-new.ts

"use client"

import { useState, useCallback, useRef, useEffect } from 'react'
import { useAppStateContext } from './use-app-state-context'
import { isFeatureEnabled } from '../lib/feature-flags'
import { SERVICE_KEYS, serviceContainer } from '../lib/services'
import type { ITranscriptService, TranscriptMessage } from '../lib/services'

interface UseTranscriptNewReturn {
    transcripts: TranscriptMessage[]
    isConnected: boolean
    isCompleted: boolean
    error: string | null
    connect: (sessionId: string) => Promise<void>
    disconnect: () => void
    clearTranscripts: () => void
    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    autoScrollEnabled: boolean
    enableAutoScroll: () => void
    disableAutoScroll: () => void
    scrollToLatest: () => void
    setScrollContainer: (element: HTMLElement | null) => void
}

/**
 * useTranscriptNew - é€å­—ç¨¿ç®¡ç† Hook (é©é…å™¨å±¤)
 *
 * é‡æ§‹ç‚ºé©é…å™¨å±¤ï¼š
 * - å…§éƒ¨èª¿ç”¨ TranscriptService è€Œéç›´æ¥ä½¿ç”¨ transcriptManager
 * - ä¿æŒå°å¤–æ¥å£å®Œå…¨ä¸è®Šï¼Œç¢ºä¿çµ„ä»¶å±¤ç„¡æ„ŸçŸ¥è®Šæ›´
 * - ä¿æŒ TranscriptManager çš„ç¨ç«‹æ€§å’Œ WebSocket é‡é€£æ©Ÿåˆ¶
 */
export function useTranscriptNew(): UseTranscriptNewReturn {
    // ä½¿ç”¨æ–°çš„ Context ç‹€æ…‹ç®¡ç†
    const context = useAppStateContext()

    // æœ¬åœ°ç‹€æ…‹ï¼ˆä¿æŒ TranscriptService ç¨ç«‹æ€§ï¼Œé¿å…å½±éŸ¿ WebSocket é‡é€£æ©Ÿåˆ¶ï¼‰
    const [isConnected, setIsConnected] = useState(false)
    const [isCompleted, setIsCompleted] = useState(false)
    const [localError, setLocalError] = useState<string | null>(null)
    const [autoScrollEnabled, setAutoScrollEnabled] = useState(true)

    const containerRef = useRef<HTMLElement | null>(null)
    const currentSessionIdRef = useRef<string | null>(null)
    const transcriptServiceRef = useRef<ITranscriptService | null>(null)

    console.log('ğŸ”„ [useTranscriptNew] Hook åˆå§‹åŒ– (é©é…å™¨å±¤)', {
        useNewStateManagement: isFeatureEnabled('useNewStateManagement'),
        useNewTranscriptHook: isFeatureEnabled('useNewTranscriptHook'),
        contextTranscriptCount: context.appData.transcriptEntries.length,
    })

    // åˆå§‹åŒ–æœå‹™å¯¦ä¾‹
    const initializeService = useCallback(() => {
        if (!transcriptServiceRef.current) {
            try {
                transcriptServiceRef.current = serviceContainer.resolve<ITranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)
                console.log('âœ… [useTranscriptNew] TranscriptService åˆå§‹åŒ–æˆåŠŸ')
            } catch (error) {
                console.error('âŒ [useTranscriptNew] ç„¡æ³•è§£æ TranscriptService:', error)
                throw new Error('é€å­—ç¨¿æœå‹™åˆå§‹åŒ–å¤±æ•—')
            }
        }
    }, [])

    // è™•ç†é€å­—ç¨¿æ¥æ”¶èˆ‡åˆä½µé‚è¼¯ - æ•´åˆ Context
    const handleTranscript = useCallback((transcript: TranscriptMessage) => {
        if (transcript.type === 'transcript_complete') {
            setIsCompleted(true)
            // è§¸ç™¼ç‹€æ…‹è½‰æ›
            context.transition('PROCESSING_COMPLETED')
            return
        }

        const anyMessage = transcript as any
        if (anyMessage.type === 'error') {
            const errorMessage = anyMessage.error_message || 'è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤'
            setLocalError(errorMessage)
            context.setError(errorMessage)
            return
        }

        if (transcript.type === 'transcript_segment' && transcript.text) {
            const startTime = transcript.start_time ?? 0
            const hours = Math.floor(startTime / 3600)
            const minutes = Math.floor((startTime % 3600) / 60)
            const seconds = Math.floor(startTime % 60)
            const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

            context.addTranscriptEntry({
                time: timeStr,
                text: transcript.text,
            })
        }
    }, [context])

    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    const scrollToLatest = useCallback(() => {
        if (containerRef.current && autoScrollEnabled) {
            containerRef.current.scrollTop = containerRef.current.scrollHeight
        }
    }, [autoScrollEnabled])

    // æª¢æ¸¬ä½¿ç”¨è€…æ»¾å‹• - é›¢åº•éƒ¨ >60px æ™‚ç¦ç”¨è‡ªå‹•æ²å‹•
    const handleScroll = useCallback((event: Event) => {
        const container = event.target as HTMLElement
        if (!container) return

        const { scrollTop, scrollHeight, clientHeight } = container
        const distanceFromBottom = scrollHeight - scrollTop - clientHeight

        if (distanceFromBottom > 60) {
            setAutoScrollEnabled(false)
        } else if (distanceFromBottom <= 10) {
            setAutoScrollEnabled(true)
        }
    }, [])

    // è¨­å®šè‡ªå‹•æ²å‹•å®¹å™¨
    const setScrollContainer = useCallback((element: HTMLElement | null) => {
        if (containerRef.current) {
            containerRef.current.removeEventListener('scroll', handleScroll)
        }

        containerRef.current = element

        if (element) {
            element.addEventListener('scroll', handleScroll)
        }
    }, [handleScroll])

    // å•Ÿç”¨è‡ªå‹•æ²å‹•
    const enableAutoScroll = useCallback(() => {
        setAutoScrollEnabled(true)
        scrollToLatest()
    }, [scrollToLatest])

    // ç¦ç”¨è‡ªå‹•æ²å‹•
    const disableAutoScroll = useCallback(() => {
        setAutoScrollEnabled(false)
    }, [])

    // é€£æ¥ TranscriptService - ä½¿ç”¨æœå‹™å±¤
    const connect = useCallback(async (sessionId: string): Promise<void> => {
        try {
            setLocalError(null)
            context.setError(null)
            setIsCompleted(false)

            console.log('ğŸ”Œ [useTranscriptNew] é€£æ¥é€å­—ç¨¿æœå‹™ (é©é…å™¨å±¤):', sessionId)

            // åˆå§‹åŒ–æœå‹™
            initializeService()
            const transcriptService = transcriptServiceRef.current!

            // å…ˆç§»é™¤ä¹‹å‰çš„ç›£è½å™¨
            if (currentSessionIdRef.current) {
                transcriptService.removeTranscriptListener(currentSessionIdRef.current, handleTranscript)
            }

            // ä½¿ç”¨æœå‹™å±¤é€£æ¥
            await transcriptService.connect(sessionId)
            transcriptService.addTranscriptListener(sessionId, handleTranscript)

            currentSessionIdRef.current = sessionId
            setIsConnected(transcriptService.isConnected(sessionId))

            console.log('âœ… [useTranscriptNew] é€å­—ç¨¿æœå‹™é€£æ¥æˆåŠŸ (æœå‹™å±¤):', sessionId)

        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'é€£æ¥é€å­—ç¨¿æœå‹™å¤±æ•—'
            setLocalError(errorMessage)
            context.setError(errorMessage)
            setIsConnected(false)
            console.error('âŒ [useTranscriptNew] é€£æ¥é€å­—ç¨¿æœå‹™å¤±æ•—:', err)
        }
    }, [handleTranscript, context, initializeService])

    // æ–·é–‹é€£æ¥ - ä½¿ç”¨æœå‹™å±¤
    const disconnect = useCallback(() => {
        console.log('ğŸ”Œ [useTranscriptNew] æ–·é–‹é€å­—ç¨¿æœå‹™ (é©é…å™¨å±¤)')

        const transcriptService = transcriptServiceRef.current
        if (currentSessionIdRef.current && transcriptService) {
            transcriptService.removeTranscriptListener(currentSessionIdRef.current, handleTranscript)

            // ä½¿ç”¨æœå‹™å±¤æ–·é–‹é€£æ¥ï¼ˆå¦‚æœæœ‰æœƒè©±IDï¼‰
            transcriptService.disconnect(currentSessionIdRef.current)

            currentSessionIdRef.current = null
        }

        setIsConnected(false)
        console.log('âœ… [useTranscriptNew] é€å­—ç¨¿æœå‹™æ–·é–‹æˆåŠŸ (æœå‹™å±¤)')
    }, [handleTranscript])

    // æ¸…ç©ºé€å­—ç¨¿ - ä½¿ç”¨ Context
    const clearTranscripts = useCallback(() => {
        context.setTranscriptEntries([])
        setIsCompleted(false)
        console.log('ğŸ”„ [useTranscriptNew] é€å­—ç¨¿å·²æ¸…é™¤ (é©é…å™¨å±¤)')
    }, [context])

    // è‡ªå‹•æ²å‹•æ•ˆæœ
    useEffect(() => {
        if (context.appData.transcriptEntries.length > 0) {
            scrollToLatest()
        }
    }, [context.appData.transcriptEntries, scrollToLatest])

    // æ¸…ç†è³‡æº
    useEffect(() => {
        return () => {
            const transcriptService = transcriptServiceRef.current
            if (currentSessionIdRef.current && transcriptService) {
                transcriptService.removeTranscriptListener(currentSessionIdRef.current, handleTranscript)
            }

            if (containerRef.current) {
                containerRef.current.removeEventListener('scroll', handleScroll)
            }
        }
    }, [handleTranscript, handleScroll])

    // è½‰æ› Context ä¸­çš„ transcriptEntries ç‚º TranscriptMessage æ ¼å¼ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
    const compatibleTranscripts: TranscriptMessage[] = context.appData.transcriptEntries.map((entry, index) => ({
        type: 'transcript_segment',
        text: entry.text,
        start_time: 0,
        end_time: 0,
        start_sequence: index,
        confidence: 1.0,
        timestamp: Date.now(),
    }))

    return {
        transcripts: compatibleTranscripts,
        isConnected,
        isCompleted,
        error: context.error || localError,
        connect,
        disconnect,
        clearTranscripts,
        autoScrollEnabled,
        enableAutoScroll,
        disableAutoScroll,
        scrollToLatest,
        setScrollContainer,
    }
}


# END FILE CONTENTS


# File: docs/traceback-debug-spec.md

# StudyScriber API 500 ä¾‹å¤– Traceback è¡Œç‚ºèªªæ˜

## åŠŸèƒ½èªªæ˜

ç•¶ API ç™¼ç”Ÿæœªæ•æ‰çš„ 500 ä¾‹å¤–ï¼ˆInternal Server Errorï¼‰æ™‚ï¼Œç³»çµ±æœƒæ ¹æ“šç’°å¢ƒè¨­å®šè‡ªå‹•æ±ºå®šæ˜¯å¦åœ¨å›æ‡‰ä¸­é¡¯ç¤ºè©³ç´° Python tracebackï¼š

- **é–‹ç™¼ç’°å¢ƒï¼ˆsettings.DEBUG = Trueï¼‰**ï¼š
  - API å›æ‡‰æœƒå¤šä¸€å€‹ `traceback` æ¬„ä½ï¼Œå…§å«å®Œæ•´ Python éŒ¯èª¤å †ç–Šè³‡è¨Šï¼Œæ–¹ä¾¿é™¤éŒ¯ã€‚
- **æ­£å¼ç’°å¢ƒï¼ˆsettings.DEBUG = Falseï¼‰**ï¼š
  - API å›æ‡‰ä¸æœƒé¡¯ç¤º tracebackï¼Œåƒ…å›å‚³ä¸€èˆ¬éŒ¯èª¤è¨Šæ¯ï¼Œé¿å…æ´©æ¼å…§éƒ¨ç´°ç¯€ã€‚

## è¨­å®šæ–¹æ³•

1. ç·¨è¼¯ `.env` æˆ– `.env.local` æª”æ¡ˆï¼ŒåŠ å…¥ï¼š

   ```
   DEBUG=true
   ```

2. æˆ–æ–¼å•Ÿå‹•æ™‚ä»¥ç’°å¢ƒè®Šæ•¸æŒ‡å®šï¼š

   ```sh
   export DEBUG=true
   uvicorn main:fastapi_app --reload --port 8000
   ```

3. é è¨­æ­£å¼ç’°å¢ƒï¼ˆæœªè¨­ DEBUG æˆ–è¨­ç‚º falseï¼‰ä¸æœƒé¡¯ç¤º tracebackã€‚

## æ³¨æ„äº‹é …

- åªæœ‰æœªæ•æ‰çš„ Exception æœƒé€²å…¥å…¨åŸŸä¾‹å¤–è™•ç†ä¸¦é¡¯ç¤º tracebackã€‚
- å¸¸è¦‹ HTTPExceptionã€é©—è­‰éŒ¯èª¤ç­‰ï¼Œä»ç”± FastAPI é è¨­è™•ç†ï¼Œä¸æœƒé¡¯ç¤º tracebackã€‚
- è«‹å‹¿åœ¨æ­£å¼ç’°å¢ƒé–‹å•Ÿ DEBUG=trueï¼Œä»¥å…æ´©æ¼æ•æ„Ÿè³‡è¨Šã€‚

---

å¦‚éœ€å¼·åˆ¶æ¸¬è©¦ tracebackï¼Œå¯æ–¼ä»»ä¸€ API ç«¯é»å…§ raise Exception è§€å¯Ÿæ•ˆæœã€‚ 


# END FILE CONTENTS


# File: frontend/src/test-setup.ts

import '@testing-library/jest-dom'
import { vi } from 'vitest'

// æ¨¡æ“¬ window.matchMedia (Radix UI éœ€è¦)
Object.defineProperty(window, 'matchMedia', {
    writable: true,
    value: vi.fn().mockImplementation((query: string) => ({
        matches: false,
        media: query,
        onchange: null,
        addListener: vi.fn(),
        removeListener: vi.fn(),
        addEventListener: vi.fn(),
        removeEventListener: vi.fn(),
        dispatchEvent: vi.fn(),
    })),
})

// æ¨¡æ“¬ ResizeObserver (æŸäº› UI å…ƒä»¶éœ€è¦)
Object.defineProperty(global, 'ResizeObserver', {
    writable: true,
    value: vi.fn().mockImplementation(() => ({
        observe: vi.fn(),
        unobserve: vi.fn(),
        disconnect: vi.fn(),
    })),
})


# END FILE CONTENTS


# File: frontend/constants/languages.ts

export const LANGS = [
    { code: 'zh-TW', label: 'ä¸­æ–‡ï¼ˆç¹é«”ï¼‰' },
    { code: 'en-US', label: 'English' },
];


# END FILE CONTENTS


# File: frontend/providers/app-state-provider-wrapper.tsx

"use client"

import React from 'react'
import { AppStateProvider } from '../hooks/use-app-state-context'
import { isFeatureEnabled } from '../lib/feature-flags'

interface AppStateProviderWrapperProps {
    children: React.ReactNode
}

/**
 * AppStateProvider åŒ…è£å™¨
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šæ˜¯å¦å•Ÿç”¨æ–°çš„ç‹€æ…‹ç®¡ç†ç³»çµ±
 * é€™æä¾›äº†æ¼¸é€²å¼éƒ¨ç½²çš„èƒ½åŠ›ï¼Œå¯ä»¥å®‰å…¨åœ°åœ¨æ–°èˆŠç³»çµ±é–“åˆ‡æ›
 */
export function AppStateProviderWrapper({ children }: AppStateProviderWrapperProps) {
    // æª¢æŸ¥æ˜¯å¦å•Ÿç”¨æ–°çš„ç‹€æ…‹ç®¡ç†ç³»çµ±
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')
    const useNewAppStateHook = isFeatureEnabled('useNewAppStateHook')

    console.log('ğŸ”„ [AppStateProviderWrapper] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewStateManagement,
        useNewAppStateHook,
        willUseProvider: useNewStateManagement || useNewAppStateHook
    })

    // å¦‚æœå•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨ AppStateProvider åŒ…è£
    if (useNewStateManagement || useNewAppStateHook) {
        console.log('ğŸ”„ [AppStateProviderWrapper] å•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç† - ä½¿ç”¨ AppStateProvider')
        return (
            <AppStateProvider>
                {children}
            </AppStateProvider>
        )
    }

    // å¦å‰‡ç›´æ¥æ¸²æŸ“å­çµ„ä»¶ï¼ˆä½¿ç”¨èˆŠç³»çµ±ï¼‰
    console.log('ğŸ”„ [AppStateProviderWrapper] ä½¿ç”¨èˆŠç‹€æ…‹ç®¡ç† - ç›´æ¥æ¸²æŸ“')
    return <>{children}</>
}


# END FILE CONTENTS


# File: .cursor/rules/ui-rules/shadcn-tailwind-ui-guideline.mdc

<!-- Source: https://github.com/RayFernando1337/llm-cursor-rules/blob/main/fire-your-design-team.md -->

# shadcn/ui with Tailwind v4 Design System Guidelines

This document outlines design principles and implementation guidelines for applications using shadcn/ui with Tailwind v4. These guidelines ensure consistency, accessibility, and best practices throughout the UI development process.

## Core Design Principles

### 1. Typography System: 4 Sizes, 2 Weights
- **4 Font Sizes Only**:
  - Size 1: Large headings
  - Size 2: Subheadings/Important content
  - Size 3: Body text
  - Size 4: Small text/labels
- **2 Font Weights Only**:
  - Semibold: For headings and emphasis
  - Regular: For body text and general content
- **Consistent Hierarchy**: Maintain clear visual hierarchy with limited options

### 2. 8pt Grid System
- **All spacing values must be divisible by 8 or 4**
- **Examples**:
  - Instead of 25px padding â†’ Use 24px (divisible by 8)
  - Instead of 11px margin â†’ Use 12px (divisible by 4)
- **Consistent Rhythm**: Creates visual harmony throughout the interface

### 3. 60/30/10 Color Rule
- **60%**: Neutral color (white/light gray)
- **30%**: Complementary color (dark gray/black)
- **10%**: Main brand/accent color (e.g., red, blue)
- **Color Balance**: Prevents visual stress while maintaining hierarchy

### 4. Clean Visual Structure
- **Logical Grouping**: Related elements should be visually connected
- **Deliberate Spacing**: Spacing between elements should follow the grid system
- **Alignment**: Elements should be properly aligned within their containers
- **Simplicity Over Flashiness**: Focus on clarity and function first

## Foundation

### Tailwind v4 Integration
- **Use Tailwind CSS v4 for styling**: Leverage the latest Tailwind features including the new @theme directive, dynamic utility values, and OKLCH colors. [Tailwind CSS v4 Documentation](mdc:https://tailwindcss.com/docs)
- **Modern browsing features**: Tailwind v4 uses bleeding-edge browser features and is designed for modern browsers.
- **Simplified installation**: Fewer dependencies, zero configuration required in many cases.
- **shadcn/ui v4 demo**: Reference the demo site for component examples. [shadcn/ui v4 Demo](mdc:https://v4.shadcn.com/)

### New CSS Structure
- **Replace @layer base with @theme directive**:
  ```css
  /* Old approach in v3 */
  @layer base {
    :root {
      --background: 0 0% 100%;
      --foreground: 0 0% 3.9%;
    }
  }
  
  /* New approach in v4 */
  @theme {
    --color-background: hsl(var(--background));
    --color-foreground: hsl(var(--foreground));
  }
  ```
- **Tailwind imports**: Use `@import "tailwindcss"` instead of `@tailwind base`
- **Container queries**: Built-in support without plugins
- **OKLCH color format**: Updated from HSL for better color perception

## Typography System

### Font Sizes & Weights
- **Strictly limit to 4 distinct sizes**:
  - Size 1: Large headings (largest)
  - Size 2: Subheadings
  - Size 3: Body text
  - Size 4: Small text/labels (smallest)
- **Only use 2 font weights**:
  - Semibold: For headings and emphasis
  - Regular: For body text and most UI elements
- **Common mistakes to avoid**:
  - Using more than 4 font sizes
  - Introducing additional font weights
  - Inconsistent size application

### Typography Implementation
- **Reference shadcn's typography primitives** for consistent text styling
- **Use monospace variant** for numerical data when appropriate
- **data-slot attribute**: Every shadcn/ui primitive now has a data-slot attribute for styling
- **Maintain hierarchy** using consistent sizing patterns

## 8pt Grid System

### Spacing Guidelines
- **All spacing values MUST be divisible by 8 or 4**:
  - âœ… DO: Use 8, 16, 24, 32, 40, 48, etc.
  - âŒ DON'T: Use 25, 11, 7, 13, etc.

- **Practical examples**:
  - Instead of 25px padding â†’ Use 24px (divisible by 8)
  - Instead of 11px margin â†’ Use 12px (divisible by 4)
  - Instead of 15px gap â†’ Use 16px (divisible by 8)

- **Use Tailwind's spacing utilities**:
  - p-4 (16px), p-6 (24px), p-8 (32px)
  - m-2 (8px), m-4 (16px), m-6 (24px)
  - gap-2 (8px), gap-4 (16px), gap-8 (32px)

- **Why this matters**:
  - Creates visual harmony
  - Simplifies decision-making
  - Establishes predictable patterns

### Implementation
- **Tailwind v4 dynamic spacing**: Spacing utilities accept any value without arbitrary syntax
- **Consistent component spacing**: Group related elements with matching gap values
- **Check responsive behavior**: Ensure grid system holds at all breakpoints

## 60/30/10 Color Rule

### Color Distribution
- **60%**: neutral color (bg-background)
  - Usually white or light gray in light mode
  - Dark gray or black in dark mode
  - Used for primary backgrounds, cards, containers

- **30%**: complementary color (text-foreground)
  - Usually dark gray or black in light mode
  - Light gray or white in dark mode
  - Used for text, icons, subtle UI elements

- **10%**: accent color (brand color)
  - Your primary brand color (red, blue, etc.)
  - Used sparingly for call-to-action buttons, highlights, important indicators
  - Avoid overusing to prevent visual stress

### Common Mistakes
- âŒ Overusing accent colors creates visual stress
- âŒ Not enough contrast between background and text
- âŒ Too many competing accent colors (stick to one primary accent)

### Implementation with shadcn/ui
- **Background/foreground convention**: Each component uses the background/foreground pattern
- **CSS variables in globals.css**:
  ```css
  :root {
    --background: oklch(1 0 0);
    --foreground: oklch(0.145 0 0);
    --primary: oklch(0.205 0 0);
    --primary-foreground: oklch(0.985 0 0);
    /* Additional variables */
  }
  
  @theme {
    --color-background: var(--background);
    --color-foreground: var(--foreground);
    /* Register other variables */
  }
  ```
- **OKLCH color format**: More accessible colors, especially in dark mode
- **Reserve accent colors** for important elements that need attention

## Component Architecture

### shadcn/ui Component Structure
- **2-layered architecture**:
  1. Structure and behavior layer (Radix UI primitives)
  2. Style layer (Tailwind CSS)
- **Class Variance Authority (CVA)** for variant styling
- **data-slot attribute** for styling component parts

### Implementation
- **Install components individually** using CLI (updated for v4) or manual installation
- **Component customization**: Modify components directly as needed
- **Radix UI primitives**: Base components for accessibility and behavior
- **New-York style**: Default recommended style for new projects (deprecated "default" style)

## Visual Hierarchy

### Design Principles
- **Simplicity over flashiness**: Focus on clarity and usability
- **Emphasis on what matters**: Highlight important elements
- **Reduced cognitive load**: Use consistent terminology and patterns
- **Visual connection**: Connect related UI elements through consistent patterns

### Implementation
- **Use shadcn/ui Blocks** for common UI patterns
- **Maintain consistent spacing** between related elements
- **Align elements properly** within containers
- **Logical grouping** of related functionality

## Installation & Setup

### Project Setup
- **CLI initialization**:
  ```bash
  npx create-next-app@latest my-app
  cd my-app
  npx shadcn-ui@latest init
  ```
- **Manual setup**: Follow the guide at [Manual Installation](mdc:https://ui.shadcn.com/docs/installation/manual)
- **components.json configuration**:
  ```json
  {
    "style": "new-york",
    "rsc": true,
    "tailwind": {
      "config": "",
      "css": "app/globals.css",
      "baseColor": "neutral",
      "cssVariables": true
    },
    "aliases": {
      "components": "@/components",
      "utils": "@/lib/utils"
    }
  }
  ```

### Adding Components
- **Use the CLI**: `npx shadcn-ui@latest add button`
- **Install dependencies**: Required for each component
- **Find components**: [Component Reference](mdc:https://ui.shadcn.com/docs/components)

## Advanced Features

### Dark Mode
- **Updated dark mode colors** for better accessibility using OKLCH
- **Consistent contrast ratios** across light and dark themes
- **Custom variant**: `@custom-variant dark (&:is(.dark *))`

### Container Queries
- **Built-in support** without plugins
- **Responsive components** that adapt to their container size
- **@min-* and @max-* variants** for container query ranges

### Data Visualization
- **Chart components**: Use with consistent styling
- **Consistent color patterns**: Use chart-1 through chart-5 variables

## Experience Design

### Motion & Animation
- **Consider transitions** between screens and states
- **Animation purpose**: Enhance usability, not distract
- **Consistent motion patterns**: Similar elements should move similarly

### Implementation
- **Test experiences** across the entire flow
- **Design with animation in mind** from the beginning
- **Balance speed and smoothness** for optimal user experience

## Resources

- [shadcn/ui Documentation](mdc:https://ui.shadcn.com/docs)
- [Tailwind CSS v4 Documentation](mdc:https://tailwindcss.com/docs)
- [shadcn/ui GitHub Repository](mdc:https://github.com/shadcn/ui)
- [Tailwind v4 Upgrade Guide](mdc:https://tailwindcss.com/docs/upgrade-guide)
- [shadcn/ui v4 Demo](mdc:https://v4.shadcn.com/)
- [Figma Design System](mdc:https://www.figma.com/community/file/1203061493325953101/shadcn-ui-design-system)

## Code Review Checklist

### Core Design Principles
- [ ] Typography: Uses only 4 font sizes and 2 font weights (Semibold, Regular)
- [ ] Spacing: All spacing values are divisible by 8 or 4
- [ ] Colors: Follows 60/30/10 color distribution (60% neutral, 30% complementary, 10% accent)
- [ ] Structure: Elements are logically grouped with consistent spacing

### Technical Implementation
- [ ] Uses proper OKLCH color variables
- [ ] Leverages @theme directive for variables
- [ ] Components implement data-slot attribute properly
- [ ] Visual hierarchy is clear and consistent
- [ ] Components use Class Variance Authority for variants
- [ ] Dark mode implementation is consistent
- [ ] Accessibility standards are maintained (contrast, keyboard navigation, etc.)

### Common Issues to Flag
- [ ] Too many font sizes (more than 4)
- [ ] Inconsistent spacing values (not divisible by 8 or 4)
- [ ] Overuse of accent colors (exceeding 10%)
- [ ] Random or inconsistent margins/padding
- [ ] Insufficient contrast between text and background
- [ ] Unnecessary custom CSS when Tailwind utilities would suffice

# END FILE CONTENTS


# File: app/services/__init__.py



# END FILE CONTENTS


# File: frontend/lib/__tests__/state-machine.test.ts

import { describe, test, expect, beforeEach, vi } from 'vitest'
import { StateMachine, StateMachineManager, createStateMachine } from '../state-machine'
import { StateTransitionContext } from '../../types/state-transitions'

describe('StateMachine', () => {
    let stateMachine: StateMachine
    let initialContext: StateTransitionContext

    beforeEach(() => {
        initialContext = {
            currentState: 'default',
            isRecording: false,
            transcriptCount: 0,
            session: null,
            error: null,
        }
        stateMachine = new StateMachine(initialContext)
    })

    test('should initialize with correct state', () => {
        expect(stateMachine.getCurrentState()).toBe('default')
        expect(stateMachine.getContext()).toEqual(initialContext)
    })

    test('should update context correctly', () => {
        const newContext = {
            isRecording: true,
            session: { id: 'test-id', status: 'active' as const, type: 'recording' as const }
        }

        stateMachine.updateContext(newContext)
        const updatedContext = stateMachine.getContext()

        expect(updatedContext.isRecording).toBe(true)
        expect(updatedContext.session).toEqual(newContext.session)
    })

    test('should validate USER_START_RECORDING transition from default', () => {
        const canTransition = stateMachine.canTransition('USER_START_RECORDING')
        expect(canTransition).toBe(true)
    })

    test('should not allow invalid transitions', () => {
        const canTransition = stateMachine.canTransition('USER_STOP_RECORDING')
        expect(canTransition).toBe(false)
    })

    test('should execute valid state transition', () => {
        const result = stateMachine.transition('USER_START_RECORDING')

        expect(result.success).toBe(true)
        expect(result.newState).toBe('recording_waiting')
        expect(result.sideEffects).toBeDefined()
        expect(stateMachine.getCurrentState()).toBe('recording_waiting')
    })

    test('should reject invalid state transition', () => {
        const result = stateMachine.transition('USER_STOP_RECORDING')

        expect(result.success).toBe(false)
        expect(result.error).toBeDefined()
        expect(stateMachine.getCurrentState()).toBe('default')
    })

    test('should handle FIRST_TRANSCRIPT_RECEIVED transition', () => {
        // å…ˆè½‰æ›åˆ° recording_waiting ç‹€æ…‹
        stateMachine.transition('USER_START_RECORDING')

        // æ›´æ–°ä¸Šä¸‹æ–‡ä»¥ç¬¦åˆè½‰æ›æ¢ä»¶
        stateMachine.updateContext({
            currentState: 'recording_waiting',
            isRecording: true,
            transcriptCount: 1,
            session: { id: 'test-id', status: 'active', type: 'recording' }
        })

        const result = stateMachine.transition('FIRST_TRANSCRIPT_RECEIVED')
        expect(result.success).toBe(true)
        expect(result.newState).toBe('recording_active')
    })

    test('should get available transitions correctly', () => {
        const transitions = stateMachine.getAvailableTransitions()
        expect(transitions).toContain('USER_START_RECORDING')
        expect(transitions).not.toContain('USER_STOP_RECORDING')
    })

    test('should reset state machine', () => {
        stateMachine.transition('USER_START_RECORDING')
        expect(stateMachine.getCurrentState()).toBe('recording_waiting')

        stateMachine.reset()
        expect(stateMachine.getCurrentState()).toBe('default')
        expect(stateMachine.getContext().isRecording).toBe(false)
    })

    test('should handle listeners correctly', () => {
        const mockListener = vi.fn()
        stateMachine.addListener(mockListener)

        stateMachine.transition('USER_START_RECORDING')

        expect(mockListener).toHaveBeenCalledWith(
            'recording_waiting',
            expect.any(Array)
        )

        stateMachine.removeListener(mockListener)
    })
})

describe('StateMachineManager', () => {
    let manager: StateMachineManager
    let initialContext: StateTransitionContext

    beforeEach(() => {
        initialContext = {
            currentState: 'default',
            isRecording: false,
            transcriptCount: 0,
            session: null,
            error: null,
        }
        manager = new StateMachineManager(initialContext)
    })

    test('should create manager with state machine', () => {
        const stateMachine = manager.getStateMachine()
        expect(stateMachine).toBeInstanceOf(StateMachine)
        expect(stateMachine.getCurrentState()).toBe('default')
    })

    test('should register side effect handlers', () => {
        const mockHandler = {
            handleSideEffect: vi.fn()
        }

        manager.registerSideEffectHandler('CREATE_SESSION', mockHandler)

        // è§¸ç™¼æœƒç”¢ç”Ÿ CREATE_SESSION å‰¯ä½œç”¨çš„è½‰æ›
        const stateMachine = manager.getStateMachine()
        stateMachine.transition('USER_START_RECORDING')

        // ç­‰å¾…å‰¯ä½œç”¨è™•ç†
        setTimeout(() => {
            expect(mockHandler.handleSideEffect).toHaveBeenCalled()
        }, 0)
    })

    test('should update context and trigger auto transition', () => {
        const result = manager.updateContextAndTransition(
            { isRecording: false },
            'USER_START_RECORDING'
        )

        expect(result).toBeDefined()
        expect(result?.success).toBe(true)
        expect(result?.newState).toBe('recording_waiting')
    })
})

describe('createStateMachine', () => {
    test('should create state machine manager', () => {
        const initialContext: StateTransitionContext = {
            currentState: 'default',
            isRecording: false,
            transcriptCount: 0,
            session: null,
            error: null,
        }

        const manager = createStateMachine(initialContext)
        expect(manager).toBeInstanceOf(StateMachineManager)

        const stateMachine = manager.getStateMachine()
        expect(stateMachine.getCurrentState()).toBe('default')
    })
})


# END FILE CONTENTS


# File: frontend/lib/config.ts

"use client"

/**
 * å‰ç«¯é…ç½®ç®¡ç†
 * é›†ä¸­ç®¡ç†æ‰€æœ‰å¯é…ç½®çš„è¨­å®šé …ç›®
 */

/**
 * éŸ³è¨ŠéŒ„è£½é…ç½®
 */
export interface AudioConfig {
  chunkInterval: number // éŸ³è¨Šåˆ‡ç‰‡é–“éš”ï¼ˆæ¯«ç§’ï¼‰
  mimeType: string // éŸ³è¨Šæ ¼å¼
  audioBitsPerSecond: number // éŸ³è¨Šä½å…ƒç‡
}

/**
 * æ‡‰ç”¨ç¨‹å¼é…ç½®
 */
export interface AppConfig {
  apiUrl: string
  wsUrl: string
  audio: AudioConfig
  isDevelopment: boolean
}

/**
 * å¾ç’°å¢ƒè®Šæ•¸ç²å–éŸ³è¨Šåˆ‡ç‰‡é–“éš”
 * æ”¯æ´ç§’æ•¸å’Œæ¯«ç§’æ•¸å…©ç¨®æ ¼å¼
 */
function getAudioChunkInterval(): number {
  // å„ªå…ˆä½¿ç”¨æ¯«ç§’æ ¼å¼çš„ç’°å¢ƒè®Šæ•¸
  const intervalMs = process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_MS
  if (intervalMs) {
    const parsed = parseInt(intervalMs, 10)
    if (!isNaN(parsed) && parsed > 0) {
      return parsed
    }
  }

  // å…¶æ¬¡ä½¿ç”¨ç§’æ•¸æ ¼å¼çš„ç’°å¢ƒè®Šæ•¸
  const intervalSec = process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_SEC
  if (intervalSec) {
    const parsed = parseInt(intervalSec, 10)
    if (!isNaN(parsed) && parsed > 0) {
      return parsed * 1000 // è½‰æ›ç‚ºæ¯«ç§’
    }
  }

  // é è¨­å€¼ï¼š10ç§’
  return 10 * 1000
}

/**
 * æ‡‰ç”¨ç¨‹å¼é…ç½®å¯¦ä¾‹
 */
export const appConfig: AppConfig = {
  apiUrl: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000',
  wsUrl: process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000',
  isDevelopment: process.env.NODE_ENV === 'development',
  audio: {
    chunkInterval: getAudioChunkInterval(),
    mimeType: 'audio/webm;codecs=opus',
    audioBitsPerSecond: 64000  // 64 kbps for 10s chunks
  }
}

/**
 * è¼”åŠ©å‡½æ•¸ï¼šç²å–éŸ³è¨Šåˆ‡ç‰‡é–“éš”ï¼ˆæ¯«ç§’ï¼‰
 */
export function getAudioChunkIntervalMs(): number {
  return appConfig.audio.chunkInterval
}

/**
 * è¼”åŠ©å‡½æ•¸ï¼šç²å–éŸ³è¨Šåˆ‡ç‰‡é–“éš”ï¼ˆç§’ï¼‰
 */
export function getAudioChunkIntervalSec(): number {
  return Math.round(appConfig.audio.chunkInterval / 1000)
}

/**
 * è¼”åŠ©å‡½æ•¸ï¼šæ ¼å¼åŒ–éŸ³è¨Šé…ç½®è³‡è¨Š
 */
export function getAudioConfigInfo(): string {
  const seconds = getAudioChunkIntervalSec()
  return `${seconds}ç§’åˆ‡ç‰‡ (${appConfig.audio.chunkInterval}ms)`
}

/**
 * ç²å–æ‡‰ç”¨ç¨‹å¼é…ç½®
 */
export function getAppConfig(): AppConfig {
  return appConfig
}

/**
 * é–‹ç™¼æ¨¡å¼è¨ºæ–·è³‡è¨Š
 */
export function getConfigInfo(): string {
  const config = getAppConfig()
  return `Config: API=${config.apiUrl}, WS=${config.wsUrl}, Dev=${config.isDevelopment}`
}

/**
 * é–‹ç™¼æ¨¡å¼è¨ºæ–·ï¼šé¡¯ç¤ºç•¶å‰é…ç½®
 */
if (appConfig.isDevelopment && typeof window !== 'undefined') {
  console.log('ğŸ”§ [Config] éŸ³è¨Šé…ç½®:', {
    chunkInterval: appConfig.audio.chunkInterval,
    chunkIntervalSec: getAudioChunkIntervalSec(),
    mimeType: appConfig.audio.mimeType,
    source: process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_MS ? 'MS' :
      process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_SEC ? 'SEC' : 'DEFAULT'
  })
}


# END FILE CONTENTS


# File: app/lib/rate_limit.py

# app/lib/rate_limit.py
import asyncio
import logging
from app.core.config import get_settings

logger = logging.getLogger(__name__)

class RateLimitHandler:
    def __init__(self):
        self._delay = 0
        logger.info("ğŸš¦ [RateLimitHandler] é »ç‡é™åˆ¶è™•ç†å™¨å·²åˆå§‹åŒ–")

    async def wait(self):
        if self._delay:
            logger.info(f"â³ [RateLimitHandler] ç­‰å¾… {self._delay}s é¿å…é »ç‡é™åˆ¶")
            await asyncio.sleep(self._delay)

    def backoff(self):
        previous_delay = self._delay
        self._delay = min((self._delay or 5) * 2, 60)
        logger.warning(f"ğŸ“ˆ [RateLimitHandler] é€€é¿å»¶é²ï¼š{previous_delay}s â†’ {self._delay}s")

    def reset(self):
        if self._delay > 0:
            logger.info(f"âœ… [RateLimitHandler] é‡ç½®å»¶é²ï¼š{self._delay}s â†’ 0s")
            self._delay = 0

class SlidingWindowRateLimiter:
    def __init__(self, max_requests: int = 3, window_seconds: int = 60):
        self.max_requests = max_requests
        self.window_seconds = window_seconds
        self.semaphore = asyncio.Semaphore(max_requests)
        self.active_requests = 0
        self.total_acquired = 0
        self.total_released = 0
        self._lock = asyncio.Lock()
        logger.info(f"ğŸªŸ [SlidingWindow] åˆå§‹åŒ–å®Œæˆï¼š{max_requests} requests/{window_seconds}s")

    async def acquire(self):
        await self.semaphore.acquire()
        async with self._lock:
            self.active_requests += 1
            self.total_acquired += 1
        loop = asyncio.get_event_loop()
        loop.call_later(self.window_seconds, self._release_permit)

    def _release_permit(self):
        self.semaphore.release()
        self.active_requests = max(0, self.active_requests - 1)
        self.total_released += 1

    async def wait(self):
        await self.acquire()

    def get_stats(self):
        return {
            'type': 'sliding_window',
            'max_requests': self.max_requests,
            'window_seconds': self.window_seconds,
            'active_requests': self.active_requests,
            'available_permits': self.max_requests - self.active_requests,
            'total_acquired': self.total_acquired,
            'total_released': self.total_released,
            'utilization_percent': (self.active_requests / self.max_requests) * 100 if self.max_requests > 0 else 0,
            'is_at_capacity': self.active_requests >= self.max_requests
        }

    def reset(self):
        self.total_acquired = 0
        self.total_released = 0

    def backoff(self):
        logger.warning(f"ğŸš¦ [SlidingWindow] é‡åˆ° 429 éŒ¯èª¤ï¼Œæ»‘å‹•è¦–çª—å°‡è‡ªå‹•è™•ç†é€€é¿")

    @property
    def _delay(self):
        if self.active_requests >= self.max_requests:
            return max(1, self.window_seconds // 4)
        return 0


def get_rate_limit():
    s = get_settings()
    if getattr(s, "USE_SLIDING_WINDOW_RATE_LIMIT", False):
        if not hasattr(get_rate_limit, "_sliding_window"):
            get_rate_limit._sliding_window = SlidingWindowRateLimiter(
                max_requests=getattr(s, "SLIDING_WINDOW_MAX_REQUESTS", 3),
                window_seconds=getattr(s, "SLIDING_WINDOW_SECONDS", 60)
            )
        return get_rate_limit._sliding_window
    else:
        if not hasattr(get_rate_limit, "_handler"):
            get_rate_limit._handler = RateLimitHandler()
        return get_rate_limit._handler


# END FILE CONTENTS


# File: frontend/hooks/use-local-draft.ts

"use client"

import { useState, useCallback, useEffect, useRef, useMemo } from 'react'

interface DraftData {
    content: string;
}

interface UseLocalDraftReturn {
    draft: DraftData;
    hasDraft: boolean
    lastDraftTime: Date | null
    saveDraft: (data: Partial<DraftData>) => void
    loadDraft: () => DraftData | null
    clearDraft: () => void
    isDraftNewer: (serverTimestamp: Date) => boolean
}

const DRAFT_KEY = 'studyscriber_draft'

export function useLocalDraft(sessionId?: string): UseLocalDraftReturn {
    const [draft, setDraft] = useState<DraftData>({ content: '' })
    const [hasDraft, setHasDraft] = useState(false)
    const [lastDraftTime, setLastDraftTime] = useState<Date | null>(null)

    const autoSaveTimeoutRef = useRef<NodeJS.Timeout | null>(null)
    const currentSessionRef = useRef<string | undefined>(sessionId)

    // æ›´æ–° session ID
    useEffect(() => {
        currentSessionRef.current = sessionId
    }, [sessionId])

    // æ¸…é™¤è‡ªå‹•å„²å­˜è¨ˆæ™‚å™¨
    const clearAutoSaveTimeout = useCallback(() => {
        if (autoSaveTimeoutRef.current) {
            clearTimeout(autoSaveTimeoutRef.current)
            autoSaveTimeoutRef.current = null
        }
    }, [])

    // å¾ localStorage è¼‰å…¥è‰ç¨¿
    const loadDraft = useCallback((): DraftData | null => {
        try {
            const draftJson = localStorage.getItem(DRAFT_KEY)
            if (!draftJson) {
                setHasDraft(false)
                return null
            }

            const parsed = JSON.parse(draftJson)
            const draftData: DraftData = {
                content: parsed.content || ''
            }
            const timestamp = parsed.timestamp ? new Date(parsed.timestamp) : new Date()
            const storedSessionId = parsed.sessionId

            // æª¢æŸ¥è‰ç¨¿æ˜¯å¦å±¬æ–¼ç•¶å‰æœƒè©±ï¼ˆå¦‚æœæœ‰æŒ‡å®šæœƒè©±ï¼‰
            if (currentSessionRef.current && storedSessionId !== currentSessionRef.current) {
                console.log('ğŸ“ è‰ç¨¿å±¬æ–¼å…¶ä»–æœƒè©±ï¼Œä¸è¼‰å…¥')
                return null
            }

            setDraft(draftData)
            setHasDraft(!!draftData.content.trim())
            setLastDraftTime(timestamp)

            console.log('ğŸ“– è‰ç¨¿å·²å¾æœ¬åœ°è¼‰å…¥')
            return draftData
        } catch (err) {
            console.error('âŒ è¼‰å…¥è‰ç¨¿å¤±æ•—:', err)
            return null
        }
    }, [])

    // å„²å­˜è‰ç¨¿åˆ° localStorage
    const saveDraft = useCallback((data: Partial<DraftData>) => {
        const now = new Date()

        // å–å¾—ç›®å‰çš„è‰ç¨¿å…§å®¹ï¼Œä¸¦èˆ‡æ–°çš„å…§å®¹åˆä½µ
        const currentDraft = { ...draft, ...data }

        if (!currentDraft.content.trim()) {
            // ç©ºå…§å®¹æ™‚æ¸…é™¤è‰ç¨¿
            clearDraft()
            return
        }

        const draftDataToStore = {
            ...currentDraft,
            timestamp: now.toISOString(),
            sessionId: currentSessionRef.current || null,
        }

        try {
            localStorage.setItem(DRAFT_KEY, JSON.stringify(draftDataToStore))
            setDraft(currentDraft)
            setHasDraft(true)
            setLastDraftTime(now)

            console.log('ğŸ’¾ è‰ç¨¿å·²å„²å­˜åˆ°æœ¬åœ°:', currentDraft)
        } catch (err) {
            console.error('âŒ å„²å­˜è‰ç¨¿å¤±æ•—:', err)
        }
    }, [draft]) // ä¾è³´ draft ç‹€æ…‹

    // æ¸…é™¤è‰ç¨¿
    const clearDraft = useCallback(() => {
        clearAutoSaveTimeout()
        try {
            localStorage.removeItem(DRAFT_KEY)

            const clearedDraft = { content: '' }
            setDraft(clearedDraft)
            setHasDraft(false)
            setLastDraftTime(null)

            console.log('ğŸ—‘ï¸ è‰ç¨¿å·²æ¸…é™¤')
        } catch (err) {
            console.error('âŒ æ¸…é™¤è‰ç¨¿å¤±æ•—:', err)
        }
    }, [clearAutoSaveTimeout])

    // åˆ¤æ–·è‰ç¨¿æ˜¯å¦æ¯”ä¼ºæœå™¨ç‰ˆæœ¬æ›´æ–°
    const isDraftNewer = useCallback((serverTimestamp: Date): boolean => {
        if (!lastDraftTime || !hasDraft) {
            return false
        }
        return lastDraftTime > serverTimestamp
    }, [lastDraftTime, hasDraft])

    // è‡ªå‹•å„²å­˜è‰ç¨¿ï¼ˆä½¿ç”¨é˜²æŠ–å‹•ï¼‰
    const autoSaveDraft = useCallback((data: Partial<DraftData>) => {
        clearAutoSaveTimeout()

        // 500ms é˜²æŠ–å‹•ï¼Œé¿å…éæ–¼é »ç¹çš„å„²å­˜
        autoSaveTimeoutRef.current = setTimeout(() => {
            saveDraft(data)
        }, 500)
    }, [saveDraft, clearAutoSaveTimeout])

    // åˆå§‹åŒ–æ™‚è¼‰å…¥è‰ç¨¿
    useEffect(() => {
        loadDraft()
    }, [loadDraft])

    // çµ„ä»¶å¸è¼‰æ™‚æ¸…ç†
    useEffect(() => {
        return () => {
            clearAutoSaveTimeout()
        }
    }, [clearAutoSaveTimeout])

    return useMemo(() => ({
        draft,
        hasDraft,
        lastDraftTime,
        saveDraft: autoSaveDraft, // ä½¿ç”¨é˜²æŠ–ç‰ˆæœ¬
        loadDraft,
        clearDraft,
        isDraftNewer,
    }), [
        draft,
        hasDraft,
        lastDraftTime,
        autoSaveDraft,
        loadDraft,
        clearDraft,
        isDraftNewer,
    ])
}


# END FILE CONTENTS


# File: frontend/components/ui/alert.tsx

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }


# END FILE CONTENTS


# File: uv.lock

version = 1
revision = 2
requires-python = ">=3.12"
resolution-markers = [
    "python_full_version >= '3.13'",
    "python_full_version < '3.13'",
]

[[package]]
name = "aiofiles"
version = "24.1.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/0b/03/a88171e277e8caa88a4c77808c20ebb04ba74cc4681bf1e9416c862de237/aiofiles-24.1.0.tar.gz", hash = "sha256:22a075c9e5a3810f0c2e48f3008c94d68c65d763b9b03857924c99e57355166c", size = 30247, upload-time = "2024-06-24T11:02:03.584Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a5/45/30bb92d442636f570cb5651bc661f52b610e2eec3f891a5dc3a4c3667db0/aiofiles-24.1.0-py3-none-any.whl", hash = "sha256:b4ec55f4195e3eb5d7abd1bf7e061763e864dd4954231fb8539a0ef8bb8260e5", size = 15896, upload-time = "2024-06-24T11:02:01.529Z" },
]

[[package]]
name = "aiohappyeyeballs"
version = "2.6.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/26/30/f84a107a9c4331c14b2b586036f40965c128aa4fee4dda5d3d51cb14ad54/aiohappyeyeballs-2.6.1.tar.gz", hash = "sha256:c3f9d0113123803ccadfdf3f0faa505bc78e6a72d1cc4806cbd719826e943558", size = 22760, upload-time = "2025-03-12T01:42:48.764Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/0f/15/5bf3b99495fb160b63f95972b81750f18f7f4e02ad051373b669d17d44f2/aiohappyeyeballs-2.6.1-py3-none-any.whl", hash = "sha256:f349ba8f4b75cb25c99c5c2d84e997e485204d2902a9597802b0371f09331fb8", size = 15265, upload-time = "2025-03-12T01:42:47.083Z" },
]

[[package]]
name = "aiohttp"
version = "3.12.13"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "aiohappyeyeballs" },
    { name = "aiosignal" },
    { name = "attrs" },
    { name = "frozenlist" },
    { name = "multidict" },
    { name = "propcache" },
    { name = "yarl" },
]
sdist = { url = "https://files.pythonhosted.org/packages/42/6e/ab88e7cb2a4058bed2f7870276454f85a7c56cd6da79349eb314fc7bbcaa/aiohttp-3.12.13.tar.gz", hash = "sha256:47e2da578528264a12e4e3dd8dd72a7289e5f812758fe086473fab037a10fcce", size = 7819160, upload-time = "2025-06-14T15:15:41.354Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b4/6a/ce40e329788013cd190b1d62bbabb2b6a9673ecb6d836298635b939562ef/aiohttp-3.12.13-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:0aa580cf80558557285b49452151b9c69f2fa3ad94c5c9e76e684719a8791b73", size = 700491, upload-time = "2025-06-14T15:14:00.048Z" },
    { url = "https://files.pythonhosted.org/packages/28/d9/7150d5cf9163e05081f1c5c64a0cdf3c32d2f56e2ac95db2a28fe90eca69/aiohttp-3.12.13-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:b103a7e414b57e6939cc4dece8e282cfb22043efd0c7298044f6594cf83ab347", size = 475104, upload-time = "2025-06-14T15:14:01.691Z" },
    { url = "https://files.pythonhosted.org/packages/f8/91/d42ba4aed039ce6e449b3e2db694328756c152a79804e64e3da5bc19dffc/aiohttp-3.12.13-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:78f64e748e9e741d2eccff9597d09fb3cd962210e5b5716047cbb646dc8fe06f", size = 467948, upload-time = "2025-06-14T15:14:03.561Z" },
    { url = "https://files.pythonhosted.org/packages/99/3b/06f0a632775946981d7c4e5a865cddb6e8dfdbaed2f56f9ade7bb4a1039b/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:29c955989bf4c696d2ededc6b0ccb85a73623ae6e112439398935362bacfaaf6", size = 1714742, upload-time = "2025-06-14T15:14:05.558Z" },
    { url = "https://files.pythonhosted.org/packages/92/a6/2552eebad9ec5e3581a89256276009e6a974dc0793632796af144df8b740/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:d640191016763fab76072c87d8854a19e8e65d7a6fcfcbf017926bdbbb30a7e5", size = 1697393, upload-time = "2025-06-14T15:14:07.194Z" },
    { url = "https://files.pythonhosted.org/packages/d8/9f/bd08fdde114b3fec7a021381b537b21920cdd2aa29ad48c5dffd8ee314f1/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:4dc507481266b410dede95dd9f26c8d6f5a14315372cc48a6e43eac652237d9b", size = 1752486, upload-time = "2025-06-14T15:14:08.808Z" },
    { url = "https://files.pythonhosted.org/packages/f7/e1/affdea8723aec5bd0959171b5490dccd9a91fcc505c8c26c9f1dca73474d/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8a94daa873465d518db073bd95d75f14302e0208a08e8c942b2f3f1c07288a75", size = 1798643, upload-time = "2025-06-14T15:14:10.767Z" },
    { url = "https://files.pythonhosted.org/packages/f3/9d/666d856cc3af3a62ae86393baa3074cc1d591a47d89dc3bf16f6eb2c8d32/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:177f52420cde4ce0bb9425a375d95577fe082cb5721ecb61da3049b55189e4e6", size = 1718082, upload-time = "2025-06-14T15:14:12.38Z" },
    { url = "https://files.pythonhosted.org/packages/f3/ce/3c185293843d17be063dada45efd2712bb6bf6370b37104b4eda908ffdbd/aiohttp-3.12.13-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:0f7df1f620ec40f1a7fbcb99ea17d7326ea6996715e78f71a1c9a021e31b96b8", size = 1633884, upload-time = "2025-06-14T15:14:14.415Z" },
    { url = "https://files.pythonhosted.org/packages/3a/5b/f3413f4b238113be35dfd6794e65029250d4b93caa0974ca572217745bdb/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:3062d4ad53b36e17796dce1c0d6da0ad27a015c321e663657ba1cc7659cfc710", size = 1694943, upload-time = "2025-06-14T15:14:16.48Z" },
    { url = "https://files.pythonhosted.org/packages/82/c8/0e56e8bf12081faca85d14a6929ad5c1263c146149cd66caa7bc12255b6d/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:8605e22d2a86b8e51ffb5253d9045ea73683d92d47c0b1438e11a359bdb94462", size = 1716398, upload-time = "2025-06-14T15:14:18.589Z" },
    { url = "https://files.pythonhosted.org/packages/ea/f3/33192b4761f7f9b2f7f4281365d925d663629cfaea093a64b658b94fc8e1/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:54fbbe6beafc2820de71ece2198458a711e224e116efefa01b7969f3e2b3ddae", size = 1657051, upload-time = "2025-06-14T15:14:20.223Z" },
    { url = "https://files.pythonhosted.org/packages/5e/0b/26ddd91ca8f84c48452431cb4c5dd9523b13bc0c9766bda468e072ac9e29/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:050bd277dfc3768b606fd4eae79dd58ceda67d8b0b3c565656a89ae34525d15e", size = 1736611, upload-time = "2025-06-14T15:14:21.988Z" },
    { url = "https://files.pythonhosted.org/packages/c3/8d/e04569aae853302648e2c138a680a6a2f02e374c5b6711732b29f1e129cc/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:2637a60910b58f50f22379b6797466c3aa6ae28a6ab6404e09175ce4955b4e6a", size = 1764586, upload-time = "2025-06-14T15:14:23.979Z" },
    { url = "https://files.pythonhosted.org/packages/ac/98/c193c1d1198571d988454e4ed75adc21c55af247a9fda08236602921c8c8/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:e986067357550d1aaa21cfe9897fa19e680110551518a5a7cf44e6c5638cb8b5", size = 1724197, upload-time = "2025-06-14T15:14:25.692Z" },
    { url = "https://files.pythonhosted.org/packages/e7/9e/07bb8aa11eec762c6b1ff61575eeeb2657df11ab3d3abfa528d95f3e9337/aiohttp-3.12.13-cp312-cp312-win32.whl", hash = "sha256:ac941a80aeea2aaae2875c9500861a3ba356f9ff17b9cb2dbfb5cbf91baaf5bf", size = 421771, upload-time = "2025-06-14T15:14:27.364Z" },
    { url = "https://files.pythonhosted.org/packages/52/66/3ce877e56ec0813069cdc9607cd979575859c597b6fb9b4182c6d5f31886/aiohttp-3.12.13-cp312-cp312-win_amd64.whl", hash = "sha256:671f41e6146a749b6c81cb7fd07f5a8356d46febdaaaf07b0e774ff04830461e", size = 447869, upload-time = "2025-06-14T15:14:29.05Z" },
    { url = "https://files.pythonhosted.org/packages/11/0f/db19abdf2d86aa1deec3c1e0e5ea46a587b97c07a16516b6438428b3a3f8/aiohttp-3.12.13-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:d4a18e61f271127465bdb0e8ff36e8f02ac4a32a80d8927aa52371e93cd87938", size = 694910, upload-time = "2025-06-14T15:14:30.604Z" },
    { url = "https://files.pythonhosted.org/packages/d5/81/0ab551e1b5d7f1339e2d6eb482456ccbe9025605b28eed2b1c0203aaaade/aiohttp-3.12.13-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:532542cb48691179455fab429cdb0d558b5e5290b033b87478f2aa6af5d20ace", size = 472566, upload-time = "2025-06-14T15:14:32.275Z" },
    { url = "https://files.pythonhosted.org/packages/34/3f/6b7d336663337672d29b1f82d1f252ec1a040fe2d548f709d3f90fa2218a/aiohttp-3.12.13-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:d7eea18b52f23c050ae9db5d01f3d264ab08f09e7356d6f68e3f3ac2de9dfabb", size = 464856, upload-time = "2025-06-14T15:14:34.132Z" },
    { url = "https://files.pythonhosted.org/packages/26/7f/32ca0f170496aa2ab9b812630fac0c2372c531b797e1deb3deb4cea904bd/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:ad7c8e5c25f2a26842a7c239de3f7b6bfb92304593ef997c04ac49fb703ff4d7", size = 1703683, upload-time = "2025-06-14T15:14:36.034Z" },
    { url = "https://files.pythonhosted.org/packages/ec/53/d5513624b33a811c0abea8461e30a732294112318276ce3dbf047dbd9d8b/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:6af355b483e3fe9d7336d84539fef460120c2f6e50e06c658fe2907c69262d6b", size = 1684946, upload-time = "2025-06-14T15:14:38Z" },
    { url = "https://files.pythonhosted.org/packages/37/72/4c237dd127827b0247dc138d3ebd49c2ded6114c6991bbe969058575f25f/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:a95cf9f097498f35c88e3609f55bb47b28a5ef67f6888f4390b3d73e2bac6177", size = 1737017, upload-time = "2025-06-14T15:14:39.951Z" },
    { url = "https://files.pythonhosted.org/packages/0d/67/8a7eb3afa01e9d0acc26e1ef847c1a9111f8b42b82955fcd9faeb84edeb4/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:b8ed8c38a1c584fe99a475a8f60eefc0b682ea413a84c6ce769bb19a7ff1c5ef", size = 1786390, upload-time = "2025-06-14T15:14:42.151Z" },
    { url = "https://files.pythonhosted.org/packages/48/19/0377df97dd0176ad23cd8cad4fd4232cfeadcec6c1b7f036315305c98e3f/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:7a0b9170d5d800126b5bc89d3053a2363406d6e327afb6afaeda2d19ee8bb103", size = 1708719, upload-time = "2025-06-14T15:14:44.039Z" },
    { url = "https://files.pythonhosted.org/packages/61/97/ade1982a5c642b45f3622255173e40c3eed289c169f89d00eeac29a89906/aiohttp-3.12.13-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:372feeace612ef8eb41f05ae014a92121a512bd5067db8f25101dd88a8db11da", size = 1622424, upload-time = "2025-06-14T15:14:45.945Z" },
    { url = "https://files.pythonhosted.org/packages/99/ab/00ad3eea004e1d07ccc406e44cfe2b8da5acb72f8c66aeeb11a096798868/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:a946d3702f7965d81f7af7ea8fb03bb33fe53d311df48a46eeca17e9e0beed2d", size = 1675447, upload-time = "2025-06-14T15:14:47.911Z" },
    { url = "https://files.pythonhosted.org/packages/3f/fe/74e5ce8b2ccaba445fe0087abc201bfd7259431d92ae608f684fcac5d143/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:a0c4725fae86555bbb1d4082129e21de7264f4ab14baf735278c974785cd2041", size = 1707110, upload-time = "2025-06-14T15:14:50.334Z" },
    { url = "https://files.pythonhosted.org/packages/ef/c4/39af17807f694f7a267bd8ab1fbacf16ad66740862192a6c8abac2bff813/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:9b28ea2f708234f0a5c44eb6c7d9eb63a148ce3252ba0140d050b091b6e842d1", size = 1649706, upload-time = "2025-06-14T15:14:52.378Z" },
    { url = "https://files.pythonhosted.org/packages/38/e8/f5a0a5f44f19f171d8477059aa5f28a158d7d57fe1a46c553e231f698435/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:d4f5becd2a5791829f79608c6f3dc745388162376f310eb9c142c985f9441cc1", size = 1725839, upload-time = "2025-06-14T15:14:54.617Z" },
    { url = "https://files.pythonhosted.org/packages/fd/ac/81acc594c7f529ef4419d3866913f628cd4fa9cab17f7bf410a5c3c04c53/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:60f2ce6b944e97649051d5f5cc0f439360690b73909230e107fd45a359d3e911", size = 1759311, upload-time = "2025-06-14T15:14:56.597Z" },
    { url = "https://files.pythonhosted.org/packages/38/0d/aabe636bd25c6ab7b18825e5a97d40024da75152bec39aa6ac8b7a677630/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:69fc1909857401b67bf599c793f2183fbc4804717388b0b888f27f9929aa41f3", size = 1708202, upload-time = "2025-06-14T15:14:58.598Z" },
    { url = "https://files.pythonhosted.org/packages/1f/ab/561ef2d8a223261683fb95a6283ad0d36cb66c87503f3a7dde7afe208bb2/aiohttp-3.12.13-cp313-cp313-win32.whl", hash = "sha256:7d7e68787a2046b0e44ba5587aa723ce05d711e3a3665b6b7545328ac8e3c0dd", size = 420794, upload-time = "2025-06-14T15:15:00.939Z" },
    { url = "https://files.pythonhosted.org/packages/9d/47/b11d0089875a23bff0abd3edb5516bcd454db3fefab8604f5e4b07bd6210/aiohttp-3.12.13-cp313-cp313-win_amd64.whl", hash = "sha256:5a178390ca90419bfd41419a809688c368e63c86bd725e1186dd97f6b89c2706", size = 446735, upload-time = "2025-06-14T15:15:02.858Z" },
]

[[package]]
name = "aiosignal"
version = "1.3.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "frozenlist" },
]
sdist = { url = "https://files.pythonhosted.org/packages/ba/b5/6d55e80f6d8a08ce22b982eafa278d823b541c925f11ee774b0b9c43473d/aiosignal-1.3.2.tar.gz", hash = "sha256:a8c255c66fafb1e499c9351d0bf32ff2d8a0321595ebac3b93713656d2436f54", size = 19424, upload-time = "2024-12-13T17:10:40.86Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/ec/6a/bc7e17a3e87a2985d3e8f4da4cd0f481060eb78fb08596c42be62c90a4d9/aiosignal-1.3.2-py2.py3-none-any.whl", hash = "sha256:45cde58e409a301715980c2b01d0c28bdde3770d8290b5eb2173759d9acb31a5", size = 7597, upload-time = "2024-12-13T17:10:38.469Z" },
]

[[package]]
name = "annotated-types"
version = "0.7.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/ee/67/531ea369ba64dcff5ec9c3402f9f51bf748cec26dde048a2f973a4eea7f5/annotated_types-0.7.0.tar.gz", hash = "sha256:aff07c09a53a08bc8cfccb9c85b05f1aa9a2a6f23728d790723543408344ce89", size = 16081, upload-time = "2024-05-20T21:33:25.928Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/78/b6/6307fbef88d9b5ee7421e68d78a9f162e0da4900bc5f5793f6d3d0e34fb8/annotated_types-0.7.0-py3-none-any.whl", hash = "sha256:1f02e8b43a8fbbc3f3e0d4f0f4bfc8131bcb4eebe8849b8e5c773f3a1c582a53", size = 13643, upload-time = "2024-05-20T21:33:24.1Z" },
]

[[package]]
name = "anyio"
version = "4.9.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "idna" },
    { name = "sniffio" },
    { name = "typing-extensions", marker = "python_full_version < '3.13'" },
]
sdist = { url = "https://files.pythonhosted.org/packages/95/7d/4c1bd541d4dffa1b52bd83fb8527089e097a106fc90b467a7313b105f840/anyio-4.9.0.tar.gz", hash = "sha256:673c0c244e15788651a4ff38710fea9675823028a6f08a5eda409e0c9840a028", size = 190949, upload-time = "2025-03-17T00:02:54.77Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a1/ee/48ca1a7c89ffec8b6a0c5d02b89c305671d5ffd8d3c94acf8b8c408575bb/anyio-4.9.0-py3-none-any.whl", hash = "sha256:9f76d541cad6e36af7beb62e978876f3b41e3e04f2c1fbf0884604c0a9c4d93c", size = 100916, upload-time = "2025-03-17T00:02:52.713Z" },
]

[[package]]
name = "attrs"
version = "25.3.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/5a/b0/1367933a8532ee6ff8d63537de4f1177af4bff9f3e829baf7331f595bb24/attrs-25.3.0.tar.gz", hash = "sha256:75d7cefc7fb576747b2c81b4442d4d4a1ce0900973527c011d1030fd3bf4af1b", size = 812032, upload-time = "2025-03-13T11:10:22.779Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/77/06/bb80f5f86020c4551da315d78b3ab75e8228f89f0162f2c3a819e407941a/attrs-25.3.0-py3-none-any.whl", hash = "sha256:427318ce031701fea540783410126f03899a97ffc6f61596ad581ac2e40e3bc3", size = 63815, upload-time = "2025-03-13T11:10:21.14Z" },
]

[[package]]
name = "cachetools"
version = "5.5.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/6c/81/3747dad6b14fa2cf53fcf10548cf5aea6913e96fab41a3c198676f8948a5/cachetools-5.5.2.tar.gz", hash = "sha256:1a661caa9175d26759571b2e19580f9d6393969e5dfca11fdb1f947a23e640d4", size = 28380, upload-time = "2025-02-20T21:01:19.524Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/72/76/20fa66124dbe6be5cafeb312ece67de6b61dd91a0247d1ea13db4ebb33c2/cachetools-5.5.2-py3-none-any.whl", hash = "sha256:d26a22bcc62eb95c3beabd9f1ee5e820d3d2704fe2967cbe350e20c8ffcd3f0a", size = 10080, upload-time = "2025-02-20T21:01:16.647Z" },
]

[[package]]
name = "certifi"
version = "2025.6.15"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/73/f7/f14b46d4bcd21092d7d3ccef689615220d8a08fb25e564b65d20738e672e/certifi-2025.6.15.tar.gz", hash = "sha256:d747aa5a8b9bbbb1bb8c22bb13e22bd1f18e9796defa16bab421f7f7a317323b", size = 158753, upload-time = "2025-06-15T02:45:51.329Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/84/ae/320161bd181fc06471eed047ecce67b693fd7515b16d495d8932db763426/certifi-2025.6.15-py3-none-any.whl", hash = "sha256:2e0c7ce7cb5d8f8634ca55d2ba7e6ec2689a2fd6537d8dec1296a477a4910057", size = 157650, upload-time = "2025-06-15T02:45:49.977Z" },
]

[[package]]
name = "charset-normalizer"
version = "3.4.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/e4/33/89c2ced2b67d1c2a61c19c6751aa8902d46ce3dacb23600a283619f5a12d/charset_normalizer-3.4.2.tar.gz", hash = "sha256:5baececa9ecba31eff645232d59845c07aa030f0c81ee70184a90d35099a0e63", size = 126367, upload-time = "2025-05-02T08:34:42.01Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d7/a4/37f4d6035c89cac7930395a35cc0f1b872e652eaafb76a6075943754f095/charset_normalizer-3.4.2-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:0c29de6a1a95f24b9a1aa7aefd27d2487263f00dfd55a77719b530788f75cff7", size = 199936, upload-time = "2025-05-02T08:32:33.712Z" },
    { url = "https://files.pythonhosted.org/packages/ee/8a/1a5e33b73e0d9287274f899d967907cd0bf9c343e651755d9307e0dbf2b3/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:cddf7bd982eaa998934a91f69d182aec997c6c468898efe6679af88283b498d3", size = 143790, upload-time = "2025-05-02T08:32:35.768Z" },
    { url = "https://files.pythonhosted.org/packages/66/52/59521f1d8e6ab1482164fa21409c5ef44da3e9f653c13ba71becdd98dec3/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:fcbe676a55d7445b22c10967bceaaf0ee69407fbe0ece4d032b6eb8d4565982a", size = 153924, upload-time = "2025-05-02T08:32:37.284Z" },
    { url = "https://files.pythonhosted.org/packages/86/2d/fb55fdf41964ec782febbf33cb64be480a6b8f16ded2dbe8db27a405c09f/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:d41c4d287cfc69060fa91cae9683eacffad989f1a10811995fa309df656ec214", size = 146626, upload-time = "2025-05-02T08:32:38.803Z" },
    { url = "https://files.pythonhosted.org/packages/8c/73/6ede2ec59bce19b3edf4209d70004253ec5f4e319f9a2e3f2f15601ed5f7/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:4e594135de17ab3866138f496755f302b72157d115086d100c3f19370839dd3a", size = 148567, upload-time = "2025-05-02T08:32:40.251Z" },
    { url = "https://files.pythonhosted.org/packages/09/14/957d03c6dc343c04904530b6bef4e5efae5ec7d7990a7cbb868e4595ee30/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:cf713fe9a71ef6fd5adf7a79670135081cd4431c2943864757f0fa3a65b1fafd", size = 150957, upload-time = "2025-05-02T08:32:41.705Z" },
    { url = "https://files.pythonhosted.org/packages/0d/c8/8174d0e5c10ccebdcb1b53cc959591c4c722a3ad92461a273e86b9f5a302/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:a370b3e078e418187da8c3674eddb9d983ec09445c99a3a263c2011993522981", size = 145408, upload-time = "2025-05-02T08:32:43.709Z" },
    { url = "https://files.pythonhosted.org/packages/58/aa/8904b84bc8084ac19dc52feb4f5952c6df03ffb460a887b42615ee1382e8/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:a955b438e62efdf7e0b7b52a64dc5c3396e2634baa62471768a64bc2adb73d5c", size = 153399, upload-time = "2025-05-02T08:32:46.197Z" },
    { url = "https://files.pythonhosted.org/packages/c2/26/89ee1f0e264d201cb65cf054aca6038c03b1a0c6b4ae998070392a3ce605/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:7222ffd5e4de8e57e03ce2cef95a4c43c98fcb72ad86909abdfc2c17d227fc1b", size = 156815, upload-time = "2025-05-02T08:32:48.105Z" },
    { url = "https://files.pythonhosted.org/packages/fd/07/68e95b4b345bad3dbbd3a8681737b4338ff2c9df29856a6d6d23ac4c73cb/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:bee093bf902e1d8fc0ac143c88902c3dfc8941f7ea1d6a8dd2bcb786d33db03d", size = 154537, upload-time = "2025-05-02T08:32:49.719Z" },
    { url = "https://files.pythonhosted.org/packages/77/1a/5eefc0ce04affb98af07bc05f3bac9094513c0e23b0562d64af46a06aae4/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:dedb8adb91d11846ee08bec4c8236c8549ac721c245678282dcb06b221aab59f", size = 149565, upload-time = "2025-05-02T08:32:51.404Z" },
    { url = "https://files.pythonhosted.org/packages/37/a0/2410e5e6032a174c95e0806b1a6585eb21e12f445ebe239fac441995226a/charset_normalizer-3.4.2-cp312-cp312-win32.whl", hash = "sha256:db4c7bf0e07fc3b7d89ac2a5880a6a8062056801b83ff56d8464b70f65482b6c", size = 98357, upload-time = "2025-05-02T08:32:53.079Z" },
    { url = "https://files.pythonhosted.org/packages/6c/4f/c02d5c493967af3eda9c771ad4d2bbc8df6f99ddbeb37ceea6e8716a32bc/charset_normalizer-3.4.2-cp312-cp312-win_amd64.whl", hash = "sha256:5a9979887252a82fefd3d3ed2a8e3b937a7a809f65dcb1e068b090e165bbe99e", size = 105776, upload-time = "2025-05-02T08:32:54.573Z" },
    { url = "https://files.pythonhosted.org/packages/ea/12/a93df3366ed32db1d907d7593a94f1fe6293903e3e92967bebd6950ed12c/charset_normalizer-3.4.2-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:926ca93accd5d36ccdabd803392ddc3e03e6d4cd1cf17deff3b989ab8e9dbcf0", size = 199622, upload-time = "2025-05-02T08:32:56.363Z" },
    { url = "https://files.pythonhosted.org/packages/04/93/bf204e6f344c39d9937d3c13c8cd5bbfc266472e51fc8c07cb7f64fcd2de/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:eba9904b0f38a143592d9fc0e19e2df0fa2e41c3c3745554761c5f6447eedabf", size = 143435, upload-time = "2025-05-02T08:32:58.551Z" },
    { url = "https://files.pythonhosted.org/packages/22/2a/ea8a2095b0bafa6c5b5a55ffdc2f924455233ee7b91c69b7edfcc9e02284/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:3fddb7e2c84ac87ac3a947cb4e66d143ca5863ef48e4a5ecb83bd48619e4634e", size = 153653, upload-time = "2025-05-02T08:33:00.342Z" },
    { url = "https://files.pythonhosted.org/packages/b6/57/1b090ff183d13cef485dfbe272e2fe57622a76694061353c59da52c9a659/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:98f862da73774290f251b9df8d11161b6cf25b599a66baf087c1ffe340e9bfd1", size = 146231, upload-time = "2025-05-02T08:33:02.081Z" },
    { url = "https://files.pythonhosted.org/packages/e2/28/ffc026b26f441fc67bd21ab7f03b313ab3fe46714a14b516f931abe1a2d8/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:6c9379d65defcab82d07b2a9dfbfc2e95bc8fe0ebb1b176a3190230a3ef0e07c", size = 148243, upload-time = "2025-05-02T08:33:04.063Z" },
    { url = "https://files.pythonhosted.org/packages/c0/0f/9abe9bd191629c33e69e47c6ef45ef99773320e9ad8e9cb08b8ab4a8d4cb/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:e635b87f01ebc977342e2697d05b56632f5f879a4f15955dfe8cef2448b51691", size = 150442, upload-time = "2025-05-02T08:33:06.418Z" },
    { url = "https://files.pythonhosted.org/packages/67/7c/a123bbcedca91d5916c056407f89a7f5e8fdfce12ba825d7d6b9954a1a3c/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:1c95a1e2902a8b722868587c0e1184ad5c55631de5afc0eb96bc4b0d738092c0", size = 145147, upload-time = "2025-05-02T08:33:08.183Z" },
    { url = "https://files.pythonhosted.org/packages/ec/fe/1ac556fa4899d967b83e9893788e86b6af4d83e4726511eaaad035e36595/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:ef8de666d6179b009dce7bcb2ad4c4a779f113f12caf8dc77f0162c29d20490b", size = 153057, upload-time = "2025-05-02T08:33:09.986Z" },
    { url = "https://files.pythonhosted.org/packages/2b/ff/acfc0b0a70b19e3e54febdd5301a98b72fa07635e56f24f60502e954c461/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:32fc0341d72e0f73f80acb0a2c94216bd704f4f0bce10aedea38f30502b271ff", size = 156454, upload-time = "2025-05-02T08:33:11.814Z" },
    { url = "https://files.pythonhosted.org/packages/92/08/95b458ce9c740d0645feb0e96cea1f5ec946ea9c580a94adfe0b617f3573/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:289200a18fa698949d2b39c671c2cc7a24d44096784e76614899a7ccf2574b7b", size = 154174, upload-time = "2025-05-02T08:33:13.707Z" },
    { url = "https://files.pythonhosted.org/packages/78/be/8392efc43487ac051eee6c36d5fbd63032d78f7728cb37aebcc98191f1ff/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:4a476b06fbcf359ad25d34a057b7219281286ae2477cc5ff5e3f70a246971148", size = 149166, upload-time = "2025-05-02T08:33:15.458Z" },
    { url = "https://files.pythonhosted.org/packages/44/96/392abd49b094d30b91d9fbda6a69519e95802250b777841cf3bda8fe136c/charset_normalizer-3.4.2-cp313-cp313-win32.whl", hash = "sha256:aaeeb6a479c7667fbe1099af9617c83aaca22182d6cf8c53966491a0f1b7ffb7", size = 98064, upload-time = "2025-05-02T08:33:17.06Z" },
    { url = "https://files.pythonhosted.org/packages/e9/b0/0200da600134e001d91851ddc797809e2fe0ea72de90e09bec5a2fbdaccb/charset_normalizer-3.4.2-cp313-cp313-win_amd64.whl", hash = "sha256:aa6af9e7d59f9c12b33ae4e9450619cf2488e2bbe9b44030905877f0b2324980", size = 105641, upload-time = "2025-05-02T08:33:18.753Z" },
    { url = "https://files.pythonhosted.org/packages/20/94/c5790835a017658cbfabd07f3bfb549140c3ac458cfc196323996b10095a/charset_normalizer-3.4.2-py3-none-any.whl", hash = "sha256:7f56930ab0abd1c45cd15be65cc741c28b1c9a34876ce8c17a2fa107810c0af0", size = 52626, upload-time = "2025-05-02T08:34:40.053Z" },
]

[[package]]
name = "click"
version = "8.2.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
]
sdist = { url = "https://files.pythonhosted.org/packages/60/6c/8ca2efa64cf75a977a0d7fac081354553ebe483345c734fb6b6515d96bbc/click-8.2.1.tar.gz", hash = "sha256:27c491cc05d968d271d5a1db13e3b5a184636d9d930f148c50b038f0d0646202", size = 286342, upload-time = "2025-05-20T23:19:49.832Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/85/32/10bb5764d90a8eee674e9dc6f4db6a0ab47c8c4d0d83c27f7c39ac415a4d/click-8.2.1-py3-none-any.whl", hash = "sha256:61a3265b914e850b85317d0b3109c7f8cd35a670f963866005d6ef1d5175a12b", size = 102215, upload-time = "2025-05-20T23:19:47.796Z" },
]

[[package]]
name = "colorama"
version = "0.4.6"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/d8/53/6f443c9a4a8358a93a6792e2acffb9d9d5cb0a5cfd8802644b7b1c9a02e4/colorama-0.4.6.tar.gz", hash = "sha256:08695f5cb7ed6e0531a20572697297273c47b8cae5a63ffc6d6ed5c201be6e44", size = 27697, upload-time = "2022-10-25T02:36:22.414Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d1/d6/3965ed04c63042e047cb6a3e6ed1a63a35087b6a609aa3a15ed8ac56c221/colorama-0.4.6-py2.py3-none-any.whl", hash = "sha256:4f1d9991f5acc0ca119f9d443620b77f9d6b33703e51011c16baf57afb285fc6", size = 25335, upload-time = "2022-10-25T02:36:20.889Z" },
]

[[package]]
name = "coverage"
version = "7.9.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/e7/e0/98670a80884f64578f0c22cd70c5e81a6e07b08167721c7487b4d70a7ca0/coverage-7.9.1.tar.gz", hash = "sha256:6cf43c78c4282708a28e466316935ec7489a9c487518a77fa68f716c67909cec", size = 813650, upload-time = "2025-06-13T13:02:28.627Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/68/d9/7f66eb0a8f2fce222de7bdc2046ec41cb31fe33fb55a330037833fb88afc/coverage-7.9.1-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:a8de12b4b87c20de895f10567639c0797b621b22897b0af3ce4b4e204a743626", size = 212336, upload-time = "2025-06-13T13:01:10.909Z" },
    { url = "https://files.pythonhosted.org/packages/20/20/e07cb920ef3addf20f052ee3d54906e57407b6aeee3227a9c91eea38a665/coverage-7.9.1-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:5add197315a054e92cee1b5f686a2bcba60c4c3e66ee3de77ace6c867bdee7cb", size = 212571, upload-time = "2025-06-13T13:01:12.518Z" },
    { url = "https://files.pythonhosted.org/packages/78/f8/96f155de7e9e248ca9c8ff1a40a521d944ba48bec65352da9be2463745bf/coverage-7.9.1-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:600a1d4106fe66f41e5d0136dfbc68fe7200a5cbe85610ddf094f8f22e1b0300", size = 246377, upload-time = "2025-06-13T13:01:14.87Z" },
    { url = "https://files.pythonhosted.org/packages/3e/cf/1d783bd05b7bca5c10ded5f946068909372e94615a4416afadfe3f63492d/coverage-7.9.1-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:2a876e4c3e5a2a1715a6608906aa5a2e0475b9c0f68343c2ada98110512ab1d8", size = 243394, upload-time = "2025-06-13T13:01:16.23Z" },
    { url = "https://files.pythonhosted.org/packages/02/dd/e7b20afd35b0a1abea09fb3998e1abc9f9bd953bee548f235aebd2b11401/coverage-7.9.1-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:81f34346dd63010453922c8e628a52ea2d2ccd73cb2487f7700ac531b247c8a5", size = 245586, upload-time = "2025-06-13T13:01:17.532Z" },
    { url = "https://files.pythonhosted.org/packages/4e/38/b30b0006fea9d617d1cb8e43b1bc9a96af11eff42b87eb8c716cf4d37469/coverage-7.9.1-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:888f8eee13f2377ce86d44f338968eedec3291876b0b8a7289247ba52cb984cd", size = 245396, upload-time = "2025-06-13T13:01:19.164Z" },
    { url = "https://files.pythonhosted.org/packages/31/e4/4d8ec1dc826e16791f3daf1b50943e8e7e1eb70e8efa7abb03936ff48418/coverage-7.9.1-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:9969ef1e69b8c8e1e70d591f91bbc37fc9a3621e447525d1602801a24ceda898", size = 243577, upload-time = "2025-06-13T13:01:22.433Z" },
    { url = "https://files.pythonhosted.org/packages/25/f4/b0e96c5c38e6e40ef465c4bc7f138863e2909c00e54a331da335faf0d81a/coverage-7.9.1-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:60c458224331ee3f1a5b472773e4a085cc27a86a0b48205409d364272d67140d", size = 244809, upload-time = "2025-06-13T13:01:24.143Z" },
    { url = "https://files.pythonhosted.org/packages/8a/65/27e0a1fa5e2e5079bdca4521be2f5dabf516f94e29a0defed35ac2382eb2/coverage-7.9.1-cp312-cp312-win32.whl", hash = "sha256:5f646a99a8c2b3ff4c6a6e081f78fad0dde275cd59f8f49dc4eab2e394332e74", size = 214724, upload-time = "2025-06-13T13:01:25.435Z" },
    { url = "https://files.pythonhosted.org/packages/9b/a8/d5b128633fd1a5e0401a4160d02fa15986209a9e47717174f99dc2f7166d/coverage-7.9.1-cp312-cp312-win_amd64.whl", hash = "sha256:30f445f85c353090b83e552dcbbdad3ec84c7967e108c3ae54556ca69955563e", size = 215535, upload-time = "2025-06-13T13:01:27.861Z" },
    { url = "https://files.pythonhosted.org/packages/a3/37/84bba9d2afabc3611f3e4325ee2c6a47cd449b580d4a606b240ce5a6f9bf/coverage-7.9.1-cp312-cp312-win_arm64.whl", hash = "sha256:af41da5dca398d3474129c58cb2b106a5d93bbb196be0d307ac82311ca234342", size = 213904, upload-time = "2025-06-13T13:01:29.202Z" },
    { url = "https://files.pythonhosted.org/packages/d0/a7/a027970c991ca90f24e968999f7d509332daf6b8c3533d68633930aaebac/coverage-7.9.1-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:31324f18d5969feef7344a932c32428a2d1a3e50b15a6404e97cba1cc9b2c631", size = 212358, upload-time = "2025-06-13T13:01:30.909Z" },
    { url = "https://files.pythonhosted.org/packages/f2/48/6aaed3651ae83b231556750280682528fea8ac7f1232834573472d83e459/coverage-7.9.1-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:0c804506d624e8a20fb3108764c52e0eef664e29d21692afa375e0dd98dc384f", size = 212620, upload-time = "2025-06-13T13:01:32.256Z" },
    { url = "https://files.pythonhosted.org/packages/6c/2a/f4b613f3b44d8b9f144847c89151992b2b6b79cbc506dee89ad0c35f209d/coverage-7.9.1-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:ef64c27bc40189f36fcc50c3fb8f16ccda73b6a0b80d9bd6e6ce4cffcd810bbd", size = 245788, upload-time = "2025-06-13T13:01:33.948Z" },
    { url = "https://files.pythonhosted.org/packages/04/d2/de4fdc03af5e4e035ef420ed26a703c6ad3d7a07aff2e959eb84e3b19ca8/coverage-7.9.1-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:d4fe2348cc6ec372e25adec0219ee2334a68d2f5222e0cba9c0d613394e12d86", size = 243001, upload-time = "2025-06-13T13:01:35.285Z" },
    { url = "https://files.pythonhosted.org/packages/f5/e8/eed18aa5583b0423ab7f04e34659e51101135c41cd1dcb33ac1d7013a6d6/coverage-7.9.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:34ed2186fe52fcc24d4561041979a0dec69adae7bce2ae8d1c49eace13e55c43", size = 244985, upload-time = "2025-06-13T13:01:36.712Z" },
    { url = "https://files.pythonhosted.org/packages/17/f8/ae9e5cce8885728c934eaa58ebfa8281d488ef2afa81c3dbc8ee9e6d80db/coverage-7.9.1-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:25308bd3d00d5eedd5ae7d4357161f4df743e3c0240fa773ee1b0f75e6c7c0f1", size = 245152, upload-time = "2025-06-13T13:01:39.303Z" },
    { url = "https://files.pythonhosted.org/packages/5a/c8/272c01ae792bb3af9b30fac14d71d63371db227980682836ec388e2c57c0/coverage-7.9.1-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:73e9439310f65d55a5a1e0564b48e34f5369bee943d72c88378f2d576f5a5751", size = 243123, upload-time = "2025-06-13T13:01:40.727Z" },
    { url = "https://files.pythonhosted.org/packages/8c/d0/2819a1e3086143c094ab446e3bdf07138527a7b88cb235c488e78150ba7a/coverage-7.9.1-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:37ab6be0859141b53aa89412a82454b482c81cf750de4f29223d52268a86de67", size = 244506, upload-time = "2025-06-13T13:01:42.184Z" },
    { url = "https://files.pythonhosted.org/packages/8b/4e/9f6117b89152df7b6112f65c7a4ed1f2f5ec8e60c4be8f351d91e7acc848/coverage-7.9.1-cp313-cp313-win32.whl", hash = "sha256:64bdd969456e2d02a8b08aa047a92d269c7ac1f47e0c977675d550c9a0863643", size = 214766, upload-time = "2025-06-13T13:01:44.482Z" },
    { url = "https://files.pythonhosted.org/packages/27/0f/4b59f7c93b52c2c4ce7387c5a4e135e49891bb3b7408dcc98fe44033bbe0/coverage-7.9.1-cp313-cp313-win_amd64.whl", hash = "sha256:be9e3f68ca9edb897c2184ad0eee815c635565dbe7a0e7e814dc1f7cbab92c0a", size = 215568, upload-time = "2025-06-13T13:01:45.772Z" },
    { url = "https://files.pythonhosted.org/packages/09/1e/9679826336f8c67b9c39a359352882b24a8a7aee48d4c9cad08d38d7510f/coverage-7.9.1-cp313-cp313-win_arm64.whl", hash = "sha256:1c503289ffef1d5105d91bbb4d62cbe4b14bec4d13ca225f9c73cde9bb46207d", size = 213939, upload-time = "2025-06-13T13:01:47.087Z" },
    { url = "https://files.pythonhosted.org/packages/bb/5b/5c6b4e7a407359a2e3b27bf9c8a7b658127975def62077d441b93a30dbe8/coverage-7.9.1-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:0b3496922cb5f4215bf5caaef4cf12364a26b0be82e9ed6d050f3352cf2d7ef0", size = 213079, upload-time = "2025-06-13T13:01:48.554Z" },
    { url = "https://files.pythonhosted.org/packages/a2/22/1e2e07279fd2fd97ae26c01cc2186e2258850e9ec125ae87184225662e89/coverage-7.9.1-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:9565c3ab1c93310569ec0d86b017f128f027cab0b622b7af288696d7ed43a16d", size = 213299, upload-time = "2025-06-13T13:01:49.997Z" },
    { url = "https://files.pythonhosted.org/packages/14/c0/4c5125a4b69d66b8c85986d3321520f628756cf524af810baab0790c7647/coverage-7.9.1-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:2241ad5dbf79ae1d9c08fe52b36d03ca122fb9ac6bca0f34439e99f8327ac89f", size = 256535, upload-time = "2025-06-13T13:01:51.314Z" },
    { url = "https://files.pythonhosted.org/packages/81/8b/e36a04889dda9960be4263e95e777e7b46f1bb4fc32202612c130a20c4da/coverage-7.9.1-cp313-cp313t-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3bb5838701ca68b10ebc0937dbd0eb81974bac54447c55cd58dea5bca8451029", size = 252756, upload-time = "2025-06-13T13:01:54.403Z" },
    { url = "https://files.pythonhosted.org/packages/98/82/be04eff8083a09a4622ecd0e1f31a2c563dbea3ed848069e7b0445043a70/coverage-7.9.1-cp313-cp313t-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:b30a25f814591a8c0c5372c11ac8967f669b97444c47fd794926e175c4047ece", size = 254912, upload-time = "2025-06-13T13:01:56.769Z" },
    { url = "https://files.pythonhosted.org/packages/0f/25/c26610a2c7f018508a5ab958e5b3202d900422cf7cdca7670b6b8ca4e8df/coverage-7.9.1-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:2d04b16a6062516df97969f1ae7efd0de9c31eb6ebdceaa0d213b21c0ca1a683", size = 256144, upload-time = "2025-06-13T13:01:58.19Z" },
    { url = "https://files.pythonhosted.org/packages/c5/8b/fb9425c4684066c79e863f1e6e7ecebb49e3a64d9f7f7860ef1688c56f4a/coverage-7.9.1-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:7931b9e249edefb07cd6ae10c702788546341d5fe44db5b6108a25da4dca513f", size = 254257, upload-time = "2025-06-13T13:01:59.645Z" },
    { url = "https://files.pythonhosted.org/packages/93/df/27b882f54157fc1131e0e215b0da3b8d608d9b8ef79a045280118a8f98fe/coverage-7.9.1-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:52e92b01041151bf607ee858e5a56c62d4b70f4dac85b8c8cb7fb8a351ab2c10", size = 255094, upload-time = "2025-06-13T13:02:01.37Z" },
    { url = "https://files.pythonhosted.org/packages/41/5f/cad1c3dbed8b3ee9e16fa832afe365b4e3eeab1fb6edb65ebbf745eabc92/coverage-7.9.1-cp313-cp313t-win32.whl", hash = "sha256:684e2110ed84fd1ca5f40e89aa44adf1729dc85444004111aa01866507adf363", size = 215437, upload-time = "2025-06-13T13:02:02.905Z" },
    { url = "https://files.pythonhosted.org/packages/99/4d/fad293bf081c0e43331ca745ff63673badc20afea2104b431cdd8c278b4c/coverage-7.9.1-cp313-cp313t-win_amd64.whl", hash = "sha256:437c576979e4db840539674e68c84b3cda82bc824dd138d56bead1435f1cb5d7", size = 216605, upload-time = "2025-06-13T13:02:05.638Z" },
    { url = "https://files.pythonhosted.org/packages/1f/56/4ee027d5965fc7fc126d7ec1187529cc30cc7d740846e1ecb5e92d31b224/coverage-7.9.1-cp313-cp313t-win_arm64.whl", hash = "sha256:18a0912944d70aaf5f399e350445738a1a20b50fbea788f640751c2ed9208b6c", size = 214392, upload-time = "2025-06-13T13:02:07.642Z" },
    { url = "https://files.pythonhosted.org/packages/08/b8/7ddd1e8ba9701dea08ce22029917140e6f66a859427406579fd8d0ca7274/coverage-7.9.1-py3-none-any.whl", hash = "sha256:66b974b145aa189516b6bf2d8423e888b742517d37872f6ee4c5be0073bd9a3c", size = 204000, upload-time = "2025-06-13T13:02:27.173Z" },
]

[[package]]
name = "deprecation"
version = "2.1.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "packaging" },
]
sdist = { url = "https://files.pythonhosted.org/packages/5a/d3/8ae2869247df154b64c1884d7346d412fed0c49df84db635aab2d1c40e62/deprecation-2.1.0.tar.gz", hash = "sha256:72b3bde64e5d778694b0cf68178aed03d15e15477116add3fb773e581f9518ff", size = 173788, upload-time = "2020-04-20T14:23:38.738Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/02/c3/253a89ee03fc9b9682f1541728eb66db7db22148cd94f89ab22528cd1e1b/deprecation-2.1.0-py2.py3-none-any.whl", hash = "sha256:a10811591210e1fb0e768a8c25517cabeabcba6f0bf96564f8ff45189f90b14a", size = 11178, upload-time = "2020-04-20T14:23:36.581Z" },
]

[[package]]
name = "distro"
version = "1.9.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/fc/f8/98eea607f65de6527f8a2e8885fc8015d3e6f5775df186e443e0964a11c3/distro-1.9.0.tar.gz", hash = "sha256:2fa77c6fd8940f116ee1d6b94a2f90b13b5ea8d019b98bc8bafdcabcdd9bdbed", size = 60722, upload-time = "2023-12-24T09:54:32.31Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/12/b3/231ffd4ab1fc9d679809f356cebee130ac7daa00d6d6f3206dd4fd137e9e/distro-1.9.0-py3-none-any.whl", hash = "sha256:7bffd925d65168f85027d8da9af6bddab658135b840670a223589bc0c8ef02b2", size = 20277, upload-time = "2023-12-24T09:54:30.421Z" },
]

[[package]]
name = "fastapi"
version = "0.115.14"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pydantic" },
    { name = "starlette" },
    { name = "typing-extensions" },
]
sdist = { url = "https://files.pythonhosted.org/packages/ca/53/8c38a874844a8b0fa10dd8adf3836ac154082cf88d3f22b544e9ceea0a15/fastapi-0.115.14.tar.gz", hash = "sha256:b1de15cdc1c499a4da47914db35d0e4ef8f1ce62b624e94e0e5824421df99739", size = 296263, upload-time = "2025-06-26T15:29:08.21Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/53/50/b1222562c6d270fea83e9c9075b8e8600b8479150a18e4516a6138b980d1/fastapi-0.115.14-py3-none-any.whl", hash = "sha256:6c0c8bf9420bd58f565e585036d971872472b4f7d3f6c73b698e10cffdefb3ca", size = 95514, upload-time = "2025-06-26T15:29:06.49Z" },
]

[[package]]
name = "frozenlist"
version = "1.7.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/79/b1/b64018016eeb087db503b038296fd782586432b9c077fc5c7839e9cb6ef6/frozenlist-1.7.0.tar.gz", hash = "sha256:2e310d81923c2437ea8670467121cc3e9b0f76d3043cc1d2331d56c7fb7a3a8f", size = 45078, upload-time = "2025-06-09T23:02:35.538Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/ef/a2/c8131383f1e66adad5f6ecfcce383d584ca94055a34d683bbb24ac5f2f1c/frozenlist-1.7.0-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:3dbf9952c4bb0e90e98aec1bd992b3318685005702656bc6f67c1a32b76787f2", size = 81424, upload-time = "2025-06-09T23:00:42.24Z" },
    { url = "https://files.pythonhosted.org/packages/4c/9d/02754159955088cb52567337d1113f945b9e444c4960771ea90eb73de8db/frozenlist-1.7.0-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:1f5906d3359300b8a9bb194239491122e6cf1444c2efb88865426f170c262cdb", size = 47952, upload-time = "2025-06-09T23:00:43.481Z" },
    { url = "https://files.pythonhosted.org/packages/01/7a/0046ef1bd6699b40acd2067ed6d6670b4db2f425c56980fa21c982c2a9db/frozenlist-1.7.0-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:3dabd5a8f84573c8d10d8859a50ea2dec01eea372031929871368c09fa103478", size = 46688, upload-time = "2025-06-09T23:00:44.793Z" },
    { url = "https://files.pythonhosted.org/packages/d6/a2/a910bafe29c86997363fb4c02069df4ff0b5bc39d33c5198b4e9dd42d8f8/frozenlist-1.7.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:aa57daa5917f1738064f302bf2626281a1cb01920c32f711fbc7bc36111058a8", size = 243084, upload-time = "2025-06-09T23:00:46.125Z" },
    { url = "https://files.pythonhosted.org/packages/64/3e/5036af9d5031374c64c387469bfcc3af537fc0f5b1187d83a1cf6fab1639/frozenlist-1.7.0-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:c193dda2b6d49f4c4398962810fa7d7c78f032bf45572b3e04dd5249dff27e08", size = 233524, upload-time = "2025-06-09T23:00:47.73Z" },
    { url = "https://files.pythonhosted.org/packages/06/39/6a17b7c107a2887e781a48ecf20ad20f1c39d94b2a548c83615b5b879f28/frozenlist-1.7.0-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:bfe2b675cf0aaa6d61bf8fbffd3c274b3c9b7b1623beb3809df8a81399a4a9c4", size = 248493, upload-time = "2025-06-09T23:00:49.742Z" },
    { url = "https://files.pythonhosted.org/packages/be/00/711d1337c7327d88c44d91dd0f556a1c47fb99afc060ae0ef66b4d24793d/frozenlist-1.7.0-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8fc5d5cda37f62b262405cf9652cf0856839c4be8ee41be0afe8858f17f4c94b", size = 244116, upload-time = "2025-06-09T23:00:51.352Z" },
    { url = "https://files.pythonhosted.org/packages/24/fe/74e6ec0639c115df13d5850e75722750adabdc7de24e37e05a40527ca539/frozenlist-1.7.0-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:b0d5ce521d1dd7d620198829b87ea002956e4319002ef0bc8d3e6d045cb4646e", size = 224557, upload-time = "2025-06-09T23:00:52.855Z" },
    { url = "https://files.pythonhosted.org/packages/8d/db/48421f62a6f77c553575201e89048e97198046b793f4a089c79a6e3268bd/frozenlist-1.7.0-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:488d0a7d6a0008ca0db273c542098a0fa9e7dfaa7e57f70acef43f32b3f69dca", size = 241820, upload-time = "2025-06-09T23:00:54.43Z" },
    { url = "https://files.pythonhosted.org/packages/1d/fa/cb4a76bea23047c8462976ea7b7a2bf53997a0ca171302deae9d6dd12096/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:15a7eaba63983d22c54d255b854e8108e7e5f3e89f647fc854bd77a237e767df", size = 236542, upload-time = "2025-06-09T23:00:56.409Z" },
    { url = "https://files.pythonhosted.org/packages/5d/32/476a4b5cfaa0ec94d3f808f193301debff2ea42288a099afe60757ef6282/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:1eaa7e9c6d15df825bf255649e05bd8a74b04a4d2baa1ae46d9c2d00b2ca2cb5", size = 249350, upload-time = "2025-06-09T23:00:58.468Z" },
    { url = "https://files.pythonhosted.org/packages/8d/ba/9a28042f84a6bf8ea5dbc81cfff8eaef18d78b2a1ad9d51c7bc5b029ad16/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:e4389e06714cfa9d47ab87f784a7c5be91d3934cd6e9a7b85beef808297cc025", size = 225093, upload-time = "2025-06-09T23:01:00.015Z" },
    { url = "https://files.pythonhosted.org/packages/bc/29/3a32959e68f9cf000b04e79ba574527c17e8842e38c91d68214a37455786/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:73bd45e1488c40b63fe5a7df892baf9e2a4d4bb6409a2b3b78ac1c6236178e01", size = 245482, upload-time = "2025-06-09T23:01:01.474Z" },
    { url = "https://files.pythonhosted.org/packages/80/e8/edf2f9e00da553f07f5fa165325cfc302dead715cab6ac8336a5f3d0adc2/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:99886d98e1643269760e5fe0df31e5ae7050788dd288947f7f007209b8c33f08", size = 249590, upload-time = "2025-06-09T23:01:02.961Z" },
    { url = "https://files.pythonhosted.org/packages/1c/80/9a0eb48b944050f94cc51ee1c413eb14a39543cc4f760ed12657a5a3c45a/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:290a172aae5a4c278c6da8a96222e6337744cd9c77313efe33d5670b9f65fc43", size = 237785, upload-time = "2025-06-09T23:01:05.095Z" },
    { url = "https://files.pythonhosted.org/packages/f3/74/87601e0fb0369b7a2baf404ea921769c53b7ae00dee7dcfe5162c8c6dbf0/frozenlist-1.7.0-cp312-cp312-win32.whl", hash = "sha256:426c7bc70e07cfebc178bc4c2bf2d861d720c4fff172181eeb4a4c41d4ca2ad3", size = 39487, upload-time = "2025-06-09T23:01:06.54Z" },
    { url = "https://files.pythonhosted.org/packages/0b/15/c026e9a9fc17585a9d461f65d8593d281fedf55fbf7eb53f16c6df2392f9/frozenlist-1.7.0-cp312-cp312-win_amd64.whl", hash = "sha256:563b72efe5da92e02eb68c59cb37205457c977aa7a449ed1b37e6939e5c47c6a", size = 43874, upload-time = "2025-06-09T23:01:07.752Z" },
    { url = "https://files.pythonhosted.org/packages/24/90/6b2cebdabdbd50367273c20ff6b57a3dfa89bd0762de02c3a1eb42cb6462/frozenlist-1.7.0-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:ee80eeda5e2a4e660651370ebffd1286542b67e268aa1ac8d6dbe973120ef7ee", size = 79791, upload-time = "2025-06-09T23:01:09.368Z" },
    { url = "https://files.pythonhosted.org/packages/83/2e/5b70b6a3325363293fe5fc3ae74cdcbc3e996c2a11dde2fd9f1fb0776d19/frozenlist-1.7.0-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:d1a81c85417b914139e3a9b995d4a1c84559afc839a93cf2cb7f15e6e5f6ed2d", size = 47165, upload-time = "2025-06-09T23:01:10.653Z" },
    { url = "https://files.pythonhosted.org/packages/f4/25/a0895c99270ca6966110f4ad98e87e5662eab416a17e7fd53c364bf8b954/frozenlist-1.7.0-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:cbb65198a9132ebc334f237d7b0df163e4de83fb4f2bdfe46c1e654bdb0c5d43", size = 45881, upload-time = "2025-06-09T23:01:12.296Z" },
    { url = "https://files.pythonhosted.org/packages/19/7c/71bb0bbe0832793c601fff68cd0cf6143753d0c667f9aec93d3c323f4b55/frozenlist-1.7.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:dab46c723eeb2c255a64f9dc05b8dd601fde66d6b19cdb82b2e09cc6ff8d8b5d", size = 232409, upload-time = "2025-06-09T23:01:13.641Z" },
    { url = "https://files.pythonhosted.org/packages/c0/45/ed2798718910fe6eb3ba574082aaceff4528e6323f9a8570be0f7028d8e9/frozenlist-1.7.0-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:6aeac207a759d0dedd2e40745575ae32ab30926ff4fa49b1635def65806fddee", size = 225132, upload-time = "2025-06-09T23:01:15.264Z" },
    { url = "https://files.pythonhosted.org/packages/ba/e2/8417ae0f8eacb1d071d4950f32f229aa6bf68ab69aab797b72a07ea68d4f/frozenlist-1.7.0-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:bd8c4e58ad14b4fa7802b8be49d47993182fdd4023393899632c88fd8cd994eb", size = 237638, upload-time = "2025-06-09T23:01:16.752Z" },
    { url = "https://files.pythonhosted.org/packages/f8/b7/2ace5450ce85f2af05a871b8c8719b341294775a0a6c5585d5e6170f2ce7/frozenlist-1.7.0-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:04fb24d104f425da3540ed83cbfc31388a586a7696142004c577fa61c6298c3f", size = 233539, upload-time = "2025-06-09T23:01:18.202Z" },
    { url = "https://files.pythonhosted.org/packages/46/b9/6989292c5539553dba63f3c83dc4598186ab2888f67c0dc1d917e6887db6/frozenlist-1.7.0-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:6a5c505156368e4ea6b53b5ac23c92d7edc864537ff911d2fb24c140bb175e60", size = 215646, upload-time = "2025-06-09T23:01:19.649Z" },
    { url = "https://files.pythonhosted.org/packages/72/31/bc8c5c99c7818293458fe745dab4fd5730ff49697ccc82b554eb69f16a24/frozenlist-1.7.0-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:8bd7eb96a675f18aa5c553eb7ddc24a43c8c18f22e1f9925528128c052cdbe00", size = 232233, upload-time = "2025-06-09T23:01:21.175Z" },
    { url = "https://files.pythonhosted.org/packages/59/52/460db4d7ba0811b9ccb85af996019f5d70831f2f5f255f7cc61f86199795/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:05579bf020096fe05a764f1f84cd104a12f78eaab68842d036772dc6d4870b4b", size = 227996, upload-time = "2025-06-09T23:01:23.098Z" },
    { url = "https://files.pythonhosted.org/packages/ba/c9/f4b39e904c03927b7ecf891804fd3b4df3db29b9e487c6418e37988d6e9d/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:376b6222d114e97eeec13d46c486facd41d4f43bab626b7c3f6a8b4e81a5192c", size = 242280, upload-time = "2025-06-09T23:01:24.808Z" },
    { url = "https://files.pythonhosted.org/packages/b8/33/3f8d6ced42f162d743e3517781566b8481322be321b486d9d262adf70bfb/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:0aa7e176ebe115379b5b1c95b4096fb1c17cce0847402e227e712c27bdb5a949", size = 217717, upload-time = "2025-06-09T23:01:26.28Z" },
    { url = "https://files.pythonhosted.org/packages/3e/e8/ad683e75da6ccef50d0ab0c2b2324b32f84fc88ceee778ed79b8e2d2fe2e/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:3fbba20e662b9c2130dc771e332a99eff5da078b2b2648153a40669a6d0e36ca", size = 236644, upload-time = "2025-06-09T23:01:27.887Z" },
    { url = "https://files.pythonhosted.org/packages/b2/14/8d19ccdd3799310722195a72ac94ddc677541fb4bef4091d8e7775752360/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:f3f4410a0a601d349dd406b5713fec59b4cee7e71678d5b17edda7f4655a940b", size = 238879, upload-time = "2025-06-09T23:01:29.524Z" },
    { url = "https://files.pythonhosted.org/packages/ce/13/c12bf657494c2fd1079a48b2db49fa4196325909249a52d8f09bc9123fd7/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:e2cdfaaec6a2f9327bf43c933c0319a7c429058e8537c508964a133dffee412e", size = 232502, upload-time = "2025-06-09T23:01:31.287Z" },
    { url = "https://files.pythonhosted.org/packages/d7/8b/e7f9dfde869825489382bc0d512c15e96d3964180c9499efcec72e85db7e/frozenlist-1.7.0-cp313-cp313-win32.whl", hash = "sha256:5fc4df05a6591c7768459caba1b342d9ec23fa16195e744939ba5914596ae3e1", size = 39169, upload-time = "2025-06-09T23:01:35.503Z" },
    { url = "https://files.pythonhosted.org/packages/35/89/a487a98d94205d85745080a37860ff5744b9820a2c9acbcdd9440bfddf98/frozenlist-1.7.0-cp313-cp313-win_amd64.whl", hash = "sha256:52109052b9791a3e6b5d1b65f4b909703984b770694d3eb64fad124c835d7cba", size = 43219, upload-time = "2025-06-09T23:01:36.784Z" },
    { url = "https://files.pythonhosted.org/packages/56/d5/5c4cf2319a49eddd9dd7145e66c4866bdc6f3dbc67ca3d59685149c11e0d/frozenlist-1.7.0-cp313-cp313t-macosx_10_13_universal2.whl", hash = "sha256:a6f86e4193bb0e235ef6ce3dde5cbabed887e0b11f516ce8a0f4d3b33078ec2d", size = 84345, upload-time = "2025-06-09T23:01:38.295Z" },
    { url = "https://files.pythonhosted.org/packages/a4/7d/ec2c1e1dc16b85bc9d526009961953df9cec8481b6886debb36ec9107799/frozenlist-1.7.0-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:82d664628865abeb32d90ae497fb93df398a69bb3434463d172b80fc25b0dd7d", size = 48880, upload-time = "2025-06-09T23:01:39.887Z" },
    { url = "https://files.pythonhosted.org/packages/69/86/f9596807b03de126e11e7d42ac91e3d0b19a6599c714a1989a4e85eeefc4/frozenlist-1.7.0-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:912a7e8375a1c9a68325a902f3953191b7b292aa3c3fb0d71a216221deca460b", size = 48498, upload-time = "2025-06-09T23:01:41.318Z" },
    { url = "https://files.pythonhosted.org/packages/5e/cb/df6de220f5036001005f2d726b789b2c0b65f2363b104bbc16f5be8084f8/frozenlist-1.7.0-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:9537c2777167488d539bc5de2ad262efc44388230e5118868e172dd4a552b146", size = 292296, upload-time = "2025-06-09T23:01:42.685Z" },
    { url = "https://files.pythonhosted.org/packages/83/1f/de84c642f17c8f851a2905cee2dae401e5e0daca9b5ef121e120e19aa825/frozenlist-1.7.0-cp313-cp313t-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:f34560fb1b4c3e30ba35fa9a13894ba39e5acfc5f60f57d8accde65f46cc5e74", size = 273103, upload-time = "2025-06-09T23:01:44.166Z" },
    { url = "https://files.pythonhosted.org/packages/88/3c/c840bfa474ba3fa13c772b93070893c6e9d5c0350885760376cbe3b6c1b3/frozenlist-1.7.0-cp313-cp313t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:acd03d224b0175f5a850edc104ac19040d35419eddad04e7cf2d5986d98427f1", size = 292869, upload-time = "2025-06-09T23:01:45.681Z" },
    { url = "https://files.pythonhosted.org/packages/a6/1c/3efa6e7d5a39a1d5ef0abeb51c48fb657765794a46cf124e5aca2c7a592c/frozenlist-1.7.0-cp313-cp313t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:f2038310bc582f3d6a09b3816ab01737d60bf7b1ec70f5356b09e84fb7408ab1", size = 291467, upload-time = "2025-06-09T23:01:47.234Z" },
    { url = "https://files.pythonhosted.org/packages/4f/00/d5c5e09d4922c395e2f2f6b79b9a20dab4b67daaf78ab92e7729341f61f6/frozenlist-1.7.0-cp313-cp313t-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:b8c05e4c8e5f36e5e088caa1bf78a687528f83c043706640a92cb76cd6999384", size = 266028, upload-time = "2025-06-09T23:01:48.819Z" },
    { url = "https://files.pythonhosted.org/packages/4e/27/72765be905619dfde25a7f33813ac0341eb6b076abede17a2e3fbfade0cb/frozenlist-1.7.0-cp313-cp313t-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:765bb588c86e47d0b68f23c1bee323d4b703218037765dcf3f25c838c6fecceb", size = 284294, upload-time = "2025-06-09T23:01:50.394Z" },
    { url = "https://files.pythonhosted.org/packages/88/67/c94103a23001b17808eb7dd1200c156bb69fb68e63fcf0693dde4cd6228c/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:32dc2e08c67d86d0969714dd484fd60ff08ff81d1a1e40a77dd34a387e6ebc0c", size = 281898, upload-time = "2025-06-09T23:01:52.234Z" },
    { url = "https://files.pythonhosted.org/packages/42/34/a3e2c00c00f9e2a9db5653bca3fec306349e71aff14ae45ecc6d0951dd24/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_armv7l.whl", hash = "sha256:c0303e597eb5a5321b4de9c68e9845ac8f290d2ab3f3e2c864437d3c5a30cd65", size = 290465, upload-time = "2025-06-09T23:01:53.788Z" },
    { url = "https://files.pythonhosted.org/packages/bb/73/f89b7fbce8b0b0c095d82b008afd0590f71ccb3dee6eee41791cf8cd25fd/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:a47f2abb4e29b3a8d0b530f7c3598badc6b134562b1a5caee867f7c62fee51e3", size = 266385, upload-time = "2025-06-09T23:01:55.769Z" },
    { url = "https://files.pythonhosted.org/packages/cd/45/e365fdb554159462ca12df54bc59bfa7a9a273ecc21e99e72e597564d1ae/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_ppc64le.whl", hash = "sha256:3d688126c242a6fabbd92e02633414d40f50bb6002fa4cf995a1d18051525657", size = 288771, upload-time = "2025-06-09T23:01:57.4Z" },
    { url = "https://files.pythonhosted.org/packages/00/11/47b6117002a0e904f004d70ec5194fe9144f117c33c851e3d51c765962d0/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_s390x.whl", hash = "sha256:4e7e9652b3d367c7bd449a727dc79d5043f48b88d0cbfd4f9f1060cf2b414104", size = 288206, upload-time = "2025-06-09T23:01:58.936Z" },
    { url = "https://files.pythonhosted.org/packages/40/37/5f9f3c3fd7f7746082ec67bcdc204db72dad081f4f83a503d33220a92973/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:1a85e345b4c43db8b842cab1feb41be5cc0b10a1830e6295b69d7310f99becaf", size = 282620, upload-time = "2025-06-09T23:02:00.493Z" },
    { url = "https://files.pythonhosted.org/packages/0b/31/8fbc5af2d183bff20f21aa743b4088eac4445d2bb1cdece449ae80e4e2d1/frozenlist-1.7.0-cp313-cp313t-win32.whl", hash = "sha256:3a14027124ddb70dfcee5148979998066897e79f89f64b13328595c4bdf77c81", size = 43059, upload-time = "2025-06-09T23:02:02.072Z" },
    { url = "https://files.pythonhosted.org/packages/bb/ed/41956f52105b8dbc26e457c5705340c67c8cc2b79f394b79bffc09d0e938/frozenlist-1.7.0-cp313-cp313t-win_amd64.whl", hash = "sha256:3bf8010d71d4507775f658e9823210b7427be36625b387221642725b515dcf3e", size = 47516, upload-time = "2025-06-09T23:02:03.779Z" },
    { url = "https://files.pythonhosted.org/packages/ee/45/b82e3c16be2182bff01179db177fe144d58b5dc787a7d4492c6ed8b9317f/frozenlist-1.7.0-py3-none-any.whl", hash = "sha256:9a5af342e34f7e97caf8c995864c7a396418ae2859cc6fdf1b1073020d516a7e", size = 13106, upload-time = "2025-06-09T23:02:34.204Z" },
]

[[package]]
name = "google-ai-generativelanguage"
version = "0.6.15"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-api-core", extra = ["grpc"] },
    { name = "google-auth" },
    { name = "proto-plus" },
    { name = "protobuf" },
]
sdist = { url = "https://files.pythonhosted.org/packages/11/d1/48fe5d7a43d278e9f6b5ada810b0a3530bbeac7ed7fcbcd366f932f05316/google_ai_generativelanguage-0.6.15.tar.gz", hash = "sha256:8f6d9dc4c12b065fe2d0289026171acea5183ebf2d0b11cefe12f3821e159ec3", size = 1375443, upload-time = "2025-01-13T21:50:47.459Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/7c/a3/67b8a6ff5001a1d8864922f2d6488dc2a14367ceb651bc3f09a947f2f306/google_ai_generativelanguage-0.6.15-py3-none-any.whl", hash = "sha256:5a03ef86377aa184ffef3662ca28f19eeee158733e45d7947982eb953c6ebb6c", size = 1327356, upload-time = "2025-01-13T21:50:44.174Z" },
]

[[package]]
name = "google-api-core"
version = "2.25.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-auth" },
    { name = "googleapis-common-protos" },
    { name = "proto-plus" },
    { name = "protobuf" },
    { name = "requests" },
]
sdist = { url = "https://files.pythonhosted.org/packages/dc/21/e9d043e88222317afdbdb567165fdbc3b0aad90064c7e0c9eb0ad9955ad8/google_api_core-2.25.1.tar.gz", hash = "sha256:d2aaa0b13c78c61cb3f4282c464c046e45fbd75755683c9c525e6e8f7ed0a5e8", size = 165443, upload-time = "2025-06-12T20:52:20.439Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/14/4b/ead00905132820b623732b175d66354e9d3e69fcf2a5dcdab780664e7896/google_api_core-2.25.1-py3-none-any.whl", hash = "sha256:8a2a56c1fef82987a524371f99f3bd0143702fecc670c72e600c1cda6bf8dbb7", size = 160807, upload-time = "2025-06-12T20:52:19.334Z" },
]

[package.optional-dependencies]
grpc = [
    { name = "grpcio" },
    { name = "grpcio-status" },
]

[[package]]
name = "google-api-python-client"
version = "2.176.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-api-core" },
    { name = "google-auth" },
    { name = "google-auth-httplib2" },
    { name = "httplib2" },
    { name = "uritemplate" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3e/38/daf70faf6d05556d382bac640bc6765f09fcfb9dfb51ac4a595d3453a2a9/google_api_python_client-2.176.0.tar.gz", hash = "sha256:2b451cdd7fd10faeb5dd20f7d992f185e1e8f4124c35f2cdcc77c843139a4cf1", size = 13154773, upload-time = "2025-07-08T18:07:10.354Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b1/2c/758f415a19a12c3c6d06902794b0dd4c521d912a59b98ab752bba48812df/google_api_python_client-2.176.0-py3-none-any.whl", hash = "sha256:e22239797f1d085341e12cd924591fc65c56d08e0af02549d7606092e6296510", size = 13678445, upload-time = "2025-07-08T18:07:07.799Z" },
]

[[package]]
name = "google-auth"
version = "2.40.3"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "cachetools" },
    { name = "pyasn1-modules" },
    { name = "rsa" },
]
sdist = { url = "https://files.pythonhosted.org/packages/9e/9b/e92ef23b84fa10a64ce4831390b7a4c2e53c0132568d99d4ae61d04c8855/google_auth-2.40.3.tar.gz", hash = "sha256:500c3a29adedeb36ea9cf24b8d10858e152f2412e3ca37829b3fa18e33d63b77", size = 281029, upload-time = "2025-06-04T18:04:57.577Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/17/63/b19553b658a1692443c62bd07e5868adaa0ad746a0751ba62c59568cd45b/google_auth-2.40.3-py2.py3-none-any.whl", hash = "sha256:1370d4593e86213563547f97a92752fc658456fe4514c809544f330fed45a7ca", size = 216137, upload-time = "2025-06-04T18:04:55.573Z" },
]

[[package]]
name = "google-auth-httplib2"
version = "0.2.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-auth" },
    { name = "httplib2" },
]
sdist = { url = "https://files.pythonhosted.org/packages/56/be/217a598a818567b28e859ff087f347475c807a5649296fb5a817c58dacef/google-auth-httplib2-0.2.0.tar.gz", hash = "sha256:38aa7badf48f974f1eb9861794e9c0cb2a0511a4ec0679b1f886d108f5640e05", size = 10842, upload-time = "2023-12-12T17:40:30.722Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/be/8a/fe34d2f3f9470a27b01c9e76226965863f153d5fbe276f83608562e49c04/google_auth_httplib2-0.2.0-py2.py3-none-any.whl", hash = "sha256:b65a0a2123300dd71281a7bf6e64d65a0759287df52729bdd1ae2e47dc311a3d", size = 9253, upload-time = "2023-12-12T17:40:13.055Z" },
]

[[package]]
name = "google-generativeai"
version = "0.8.5"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-ai-generativelanguage" },
    { name = "google-api-core" },
    { name = "google-api-python-client" },
    { name = "google-auth" },
    { name = "protobuf" },
    { name = "pydantic" },
    { name = "tqdm" },
    { name = "typing-extensions" },
]
wheels = [
    { url = "https://files.pythonhosted.org/packages/6e/40/c42ff9ded9f09ec9392879a8e6538a00b2dc185e834a3392917626255419/google_generativeai-0.8.5-py3-none-any.whl", hash = "sha256:22b420817fb263f8ed520b33285f45976d5b21e904da32b80d4fd20c055123a2", size = 155427, upload-time = "2025-04-17T00:40:00.67Z" },
]

[[package]]
name = "googleapis-common-protos"
version = "1.70.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "protobuf" },
]
sdist = { url = "https://files.pythonhosted.org/packages/39/24/33db22342cf4a2ea27c9955e6713140fedd51e8b141b5ce5260897020f1a/googleapis_common_protos-1.70.0.tar.gz", hash = "sha256:0e1b44e0ea153e6594f9f394fef15193a68aaaea2d843f83e2742717ca753257", size = 145903, upload-time = "2025-04-14T10:17:02.924Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/86/f1/62a193f0227cf15a920390abe675f386dec35f7ae3ffe6da582d3ade42c7/googleapis_common_protos-1.70.0-py3-none-any.whl", hash = "sha256:b8bfcca8c25a2bb253e0e0b0adaf8c00773e5e6af6fd92397576680b807e0fd8", size = 294530, upload-time = "2025-04-14T10:17:01.271Z" },
]

[[package]]
name = "gotrue"
version = "2.12.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "httpx", extra = ["http2"] },
    { name = "pydantic" },
    { name = "pyjwt" },
    { name = "pytest-mock" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3f/54/5d3befeb871bc91d83a87217e56c882a5c42dfa49ad7983e41de21ff557c/gotrue-2.12.2.tar.gz", hash = "sha256:9f23c4e45d5129c495867fd95ce14c4ebe5054b07d7449b01874332cb5c1f076", size = 38059, upload-time = "2025-06-23T21:21:35.225Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/9b/1d/6d5e3eaf663eaff0d3084eb2d370d7a7c0cf83d9d94a2bba1eaa50fe145e/gotrue-2.12.2-py3-none-any.whl", hash = "sha256:72443e106507545b2814f3c52d66c3b8f5eaf05c1e43b21b0fadf72742971406", size = 43968, upload-time = "2025-06-23T21:21:33.415Z" },
]

[[package]]
name = "grpcio"
version = "1.73.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/79/e8/b43b851537da2e2f03fa8be1aef207e5cbfb1a2e014fbb6b40d24c177cd3/grpcio-1.73.1.tar.gz", hash = "sha256:7fce2cd1c0c1116cf3850564ebfc3264fba75d3c74a7414373f1238ea365ef87", size = 12730355, upload-time = "2025-06-26T01:53:24.622Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b8/41/456caf570c55d5ac26f4c1f2db1f2ac1467d5bf3bcd660cba3e0a25b195f/grpcio-1.73.1-cp312-cp312-linux_armv7l.whl", hash = "sha256:921b25618b084e75d424a9f8e6403bfeb7abef074bb6c3174701e0f2542debcf", size = 5334621, upload-time = "2025-06-26T01:52:23.602Z" },
    { url = "https://files.pythonhosted.org/packages/2a/c2/9a15e179e49f235bb5e63b01590658c03747a43c9775e20c4e13ca04f4c4/grpcio-1.73.1-cp312-cp312-macosx_11_0_universal2.whl", hash = "sha256:277b426a0ed341e8447fbf6c1d6b68c952adddf585ea4685aa563de0f03df887", size = 10601131, upload-time = "2025-06-26T01:52:25.691Z" },
    { url = "https://files.pythonhosted.org/packages/0c/1d/1d39e90ef6348a0964caa7c5c4d05f3bae2c51ab429eb7d2e21198ac9b6d/grpcio-1.73.1-cp312-cp312-manylinux_2_17_aarch64.whl", hash = "sha256:96c112333309493c10e118d92f04594f9055774757f5d101b39f8150f8c25582", size = 5759268, upload-time = "2025-06-26T01:52:27.631Z" },
    { url = "https://files.pythonhosted.org/packages/8a/2b/2dfe9ae43de75616177bc576df4c36d6401e0959833b2e5b2d58d50c1f6b/grpcio-1.73.1-cp312-cp312-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:f48e862aed925ae987eb7084409a80985de75243389dc9d9c271dd711e589918", size = 6409791, upload-time = "2025-06-26T01:52:29.711Z" },
    { url = "https://files.pythonhosted.org/packages/6e/66/e8fe779b23b5a26d1b6949e5c70bc0a5fd08f61a6ec5ac7760d589229511/grpcio-1.73.1-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:83a6c2cce218e28f5040429835fa34a29319071079e3169f9543c3fbeff166d2", size = 6003728, upload-time = "2025-06-26T01:52:31.352Z" },
    { url = "https://files.pythonhosted.org/packages/a9/39/57a18fcef567784108c4fc3f5441cb9938ae5a51378505aafe81e8e15ecc/grpcio-1.73.1-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:65b0458a10b100d815a8426b1442bd17001fdb77ea13665b2f7dc9e8587fdc6b", size = 6103364, upload-time = "2025-06-26T01:52:33.028Z" },
    { url = "https://files.pythonhosted.org/packages/c5/46/28919d2aa038712fc399d02fa83e998abd8c1f46c2680c5689deca06d1b2/grpcio-1.73.1-cp312-cp312-musllinux_1_1_i686.whl", hash = "sha256:0a9f3ea8dce9eae9d7cb36827200133a72b37a63896e0e61a9d5ec7d61a59ab1", size = 6749194, upload-time = "2025-06-26T01:52:34.734Z" },
    { url = "https://files.pythonhosted.org/packages/3d/56/3898526f1fad588c5d19a29ea0a3a4996fb4fa7d7c02dc1be0c9fd188b62/grpcio-1.73.1-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:de18769aea47f18e782bf6819a37c1c528914bfd5683b8782b9da356506190c8", size = 6283902, upload-time = "2025-06-26T01:52:36.503Z" },
    { url = "https://files.pythonhosted.org/packages/dc/64/18b77b89c5870d8ea91818feb0c3ffb5b31b48d1b0ee3e0f0d539730fea3/grpcio-1.73.1-cp312-cp312-win32.whl", hash = "sha256:24e06a5319e33041e322d32c62b1e728f18ab8c9dbc91729a3d9f9e3ed336642", size = 3668687, upload-time = "2025-06-26T01:52:38.678Z" },
    { url = "https://files.pythonhosted.org/packages/3c/52/302448ca6e52f2a77166b2e2ed75f5d08feca4f2145faf75cb768cccb25b/grpcio-1.73.1-cp312-cp312-win_amd64.whl", hash = "sha256:303c8135d8ab176f8038c14cc10d698ae1db9c480f2b2823f7a987aa2a4c5646", size = 4334887, upload-time = "2025-06-26T01:52:40.743Z" },
    { url = "https://files.pythonhosted.org/packages/37/bf/4ca20d1acbefabcaba633ab17f4244cbbe8eca877df01517207bd6655914/grpcio-1.73.1-cp313-cp313-linux_armv7l.whl", hash = "sha256:b310824ab5092cf74750ebd8a8a8981c1810cb2b363210e70d06ef37ad80d4f9", size = 5335615, upload-time = "2025-06-26T01:52:42.896Z" },
    { url = "https://files.pythonhosted.org/packages/75/ed/45c345f284abec5d4f6d77cbca9c52c39b554397eb7de7d2fcf440bcd049/grpcio-1.73.1-cp313-cp313-macosx_11_0_universal2.whl", hash = "sha256:8f5a6df3fba31a3485096ac85b2e34b9666ffb0590df0cd044f58694e6a1f6b5", size = 10595497, upload-time = "2025-06-26T01:52:44.695Z" },
    { url = "https://files.pythonhosted.org/packages/a4/75/bff2c2728018f546d812b755455014bc718f8cdcbf5c84f1f6e5494443a8/grpcio-1.73.1-cp313-cp313-manylinux_2_17_aarch64.whl", hash = "sha256:052e28fe9c41357da42250a91926a3e2f74c046575c070b69659467ca5aa976b", size = 5765321, upload-time = "2025-06-26T01:52:46.871Z" },
    { url = "https://files.pythonhosted.org/packages/70/3b/14e43158d3b81a38251b1d231dfb45a9b492d872102a919fbf7ba4ac20cd/grpcio-1.73.1-cp313-cp313-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:1c0bf15f629b1497436596b1cbddddfa3234273490229ca29561209778ebe182", size = 6415436, upload-time = "2025-06-26T01:52:49.134Z" },
    { url = "https://files.pythonhosted.org/packages/e5/3f/81d9650ca40b54338336fd360f36773be8cb6c07c036e751d8996eb96598/grpcio-1.73.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:0ab860d5bfa788c5a021fba264802e2593688cd965d1374d31d2b1a34cacd854", size = 6007012, upload-time = "2025-06-26T01:52:51.076Z" },
    { url = "https://files.pythonhosted.org/packages/55/f4/59edf5af68d684d0f4f7ad9462a418ac517201c238551529098c9aa28cb0/grpcio-1.73.1-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:ad1d958c31cc91ab050bd8a91355480b8e0683e21176522bacea225ce51163f2", size = 6105209, upload-time = "2025-06-26T01:52:52.773Z" },
    { url = "https://files.pythonhosted.org/packages/e4/a8/700d034d5d0786a5ba14bfa9ce974ed4c976936c2748c2bd87aa50f69b36/grpcio-1.73.1-cp313-cp313-musllinux_1_1_i686.whl", hash = "sha256:f43ffb3bd415c57224c7427bfb9e6c46a0b6e998754bfa0d00f408e1873dcbb5", size = 6753655, upload-time = "2025-06-26T01:52:55.064Z" },
    { url = "https://files.pythonhosted.org/packages/1f/29/efbd4ac837c23bc48e34bbaf32bd429f0dc9ad7f80721cdb4622144c118c/grpcio-1.73.1-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:686231cdd03a8a8055f798b2b54b19428cdf18fa1549bee92249b43607c42668", size = 6287288, upload-time = "2025-06-26T01:52:57.33Z" },
    { url = "https://files.pythonhosted.org/packages/d8/61/c6045d2ce16624bbe18b5d169c1a5ce4d6c3a47bc9d0e5c4fa6a50ed1239/grpcio-1.73.1-cp313-cp313-win32.whl", hash = "sha256:89018866a096e2ce21e05eabed1567479713ebe57b1db7cbb0f1e3b896793ba4", size = 3668151, upload-time = "2025-06-26T01:52:59.405Z" },
    { url = "https://files.pythonhosted.org/packages/c2/d7/77ac689216daee10de318db5aa1b88d159432dc76a130948a56b3aa671a2/grpcio-1.73.1-cp313-cp313-win_amd64.whl", hash = "sha256:4a68f8c9966b94dff693670a5cf2b54888a48a5011c5d9ce2295a1a1465ee84f", size = 4335747, upload-time = "2025-06-26T01:53:01.233Z" },
]

[[package]]
name = "grpcio-status"
version = "1.71.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "googleapis-common-protos" },
    { name = "grpcio" },
    { name = "protobuf" },
]
sdist = { url = "https://files.pythonhosted.org/packages/fd/d1/b6e9877fedae3add1afdeae1f89d1927d296da9cf977eca0eb08fb8a460e/grpcio_status-1.71.2.tar.gz", hash = "sha256:c7a97e176df71cdc2c179cd1847d7fc86cca5832ad12e9798d7fed6b7a1aab50", size = 13677, upload-time = "2025-06-28T04:24:05.426Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/67/58/317b0134129b556a93a3b0afe00ee675b5657f0155509e22fcb853bafe2d/grpcio_status-1.71.2-py3-none-any.whl", hash = "sha256:803c98cb6a8b7dc6dbb785b1111aed739f241ab5e9da0bba96888aa74704cfd3", size = 14424, upload-time = "2025-06-28T04:23:42.136Z" },
]

[[package]]
name = "h11"
version = "0.16.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/01/ee/02a2c011bdab74c6fb3c75474d40b3052059d95df7e73351460c8588d963/h11-0.16.0.tar.gz", hash = "sha256:4e35b956cf45792e4caa5885e69fba00bdbc6ffafbfa020300e549b208ee5ff1", size = 101250, upload-time = "2025-04-24T03:35:25.427Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/04/4b/29cac41a4d98d144bf5f6d33995617b185d14b22401f75ca86f384e87ff1/h11-0.16.0-py3-none-any.whl", hash = "sha256:63cf8bbe7522de3bf65932fda1d9c2772064ffb3dae62d55932da54b31cb6c86", size = 37515, upload-time = "2025-04-24T03:35:24.344Z" },
]

[[package]]
name = "h2"
version = "4.2.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "hpack" },
    { name = "hyperframe" },
]
sdist = { url = "https://files.pythonhosted.org/packages/1b/38/d7f80fd13e6582fb8e0df8c9a653dcc02b03ca34f4d72f34869298c5baf8/h2-4.2.0.tar.gz", hash = "sha256:c8a52129695e88b1a0578d8d2cc6842bbd79128ac685463b887ee278126ad01f", size = 2150682, upload-time = "2025-02-02T07:43:51.815Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d0/9e/984486f2d0a0bd2b024bf4bc1c62688fcafa9e61991f041fb0e2def4a982/h2-4.2.0-py3-none-any.whl", hash = "sha256:479a53ad425bb29af087f3458a61d30780bc818e4ebcf01f0b536ba916462ed0", size = 60957, upload-time = "2025-02-01T11:02:26.481Z" },
]

[[package]]
name = "hpack"
version = "4.1.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/2c/48/71de9ed269fdae9c8057e5a4c0aa7402e8bb16f2c6e90b3aa53327b113f8/hpack-4.1.0.tar.gz", hash = "sha256:ec5eca154f7056aa06f196a557655c5b009b382873ac8d1e66e79e87535f1dca", size = 51276, upload-time = "2025-01-22T21:44:58.347Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/07/c6/80c95b1b2b94682a72cbdbfb85b81ae2daffa4291fbfa1b1464502ede10d/hpack-4.1.0-py3-none-any.whl", hash = "sha256:157ac792668d995c657d93111f46b4535ed114f0c9c8d672271bbec7eae1b496", size = 34357, upload-time = "2025-01-22T21:44:56.92Z" },
]

[[package]]
name = "httpcore"
version = "1.0.9"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "certifi" },
    { name = "h11" },
]
sdist = { url = "https://files.pythonhosted.org/packages/06/94/82699a10bca87a5556c9c59b5963f2d039dbd239f25bc2a63907a05a14cb/httpcore-1.0.9.tar.gz", hash = "sha256:6e34463af53fd2ab5d807f399a9b45ea31c3dfa2276f15a2c3f00afff6e176e8", size = 85484, upload-time = "2025-04-24T22:06:22.219Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/7e/f5/f66802a942d491edb555dd61e3a9961140fd64c90bce1eafd741609d334d/httpcore-1.0.9-py3-none-any.whl", hash = "sha256:2d400746a40668fc9dec9810239072b40b4484b640a8c38fd654a024c7a1bf55", size = 78784, upload-time = "2025-04-24T22:06:20.566Z" },
]

[[package]]
name = "httplib2"
version = "0.22.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pyparsing" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3d/ad/2371116b22d616c194aa25ec410c9c6c37f23599dcd590502b74db197584/httplib2-0.22.0.tar.gz", hash = "sha256:d7a10bc5ef5ab08322488bde8c726eeee5c8618723fdb399597ec58f3d82df81", size = 351116, upload-time = "2023-03-21T22:29:37.214Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a8/6c/d2fbdaaa5959339d53ba38e94c123e4e84b8fbc4b84beb0e70d7c1608486/httplib2-0.22.0-py3-none-any.whl", hash = "sha256:14ae0a53c1ba8f3d37e9e27cf37eabb0fb9980f435ba405d546948b009dd64dc", size = 96854, upload-time = "2023-03-21T22:29:35.683Z" },
]

[[package]]
name = "httptools"
version = "0.6.4"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/a7/9a/ce5e1f7e131522e6d3426e8e7a490b3a01f39a6696602e1c4f33f9e94277/httptools-0.6.4.tar.gz", hash = "sha256:4e93eee4add6493b59a5c514da98c939b244fce4a0d8879cd3f466562f4b7d5c", size = 240639, upload-time = "2024-10-16T19:45:08.902Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/bb/0e/d0b71465c66b9185f90a091ab36389a7352985fe857e352801c39d6127c8/httptools-0.6.4-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:df017d6c780287d5c80601dafa31f17bddb170232d85c066604d8558683711a2", size = 200683, upload-time = "2024-10-16T19:44:30.175Z" },
    { url = "https://files.pythonhosted.org/packages/e2/b8/412a9bb28d0a8988de3296e01efa0bd62068b33856cdda47fe1b5e890954/httptools-0.6.4-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:85071a1e8c2d051b507161f6c3e26155b5c790e4e28d7f236422dbacc2a9cc44", size = 104337, upload-time = "2024-10-16T19:44:31.786Z" },
    { url = "https://files.pythonhosted.org/packages/9b/01/6fb20be3196ffdc8eeec4e653bc2a275eca7f36634c86302242c4fbb2760/httptools-0.6.4-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:69422b7f458c5af875922cdb5bd586cc1f1033295aa9ff63ee196a87519ac8e1", size = 508796, upload-time = "2024-10-16T19:44:32.825Z" },
    { url = "https://files.pythonhosted.org/packages/f7/d8/b644c44acc1368938317d76ac991c9bba1166311880bcc0ac297cb9d6bd7/httptools-0.6.4-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:16e603a3bff50db08cd578d54f07032ca1631450ceb972c2f834c2b860c28ea2", size = 510837, upload-time = "2024-10-16T19:44:33.974Z" },
    { url = "https://files.pythonhosted.org/packages/52/d8/254d16a31d543073a0e57f1c329ca7378d8924e7e292eda72d0064987486/httptools-0.6.4-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:ec4f178901fa1834d4a060320d2f3abc5c9e39766953d038f1458cb885f47e81", size = 485289, upload-time = "2024-10-16T19:44:35.111Z" },
    { url = "https://files.pythonhosted.org/packages/5f/3c/4aee161b4b7a971660b8be71a92c24d6c64372c1ab3ae7f366b3680df20f/httptools-0.6.4-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:f9eb89ecf8b290f2e293325c646a211ff1c2493222798bb80a530c5e7502494f", size = 489779, upload-time = "2024-10-16T19:44:36.253Z" },
    { url = "https://files.pythonhosted.org/packages/12/b7/5cae71a8868e555f3f67a50ee7f673ce36eac970f029c0c5e9d584352961/httptools-0.6.4-cp312-cp312-win_amd64.whl", hash = "sha256:db78cb9ca56b59b016e64b6031eda5653be0589dba2b1b43453f6e8b405a0970", size = 88634, upload-time = "2024-10-16T19:44:37.357Z" },
    { url = "https://files.pythonhosted.org/packages/94/a3/9fe9ad23fd35f7de6b91eeb60848986058bd8b5a5c1e256f5860a160cc3e/httptools-0.6.4-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:ade273d7e767d5fae13fa637f4d53b6e961fb7fd93c7797562663f0171c26660", size = 197214, upload-time = "2024-10-16T19:44:38.738Z" },
    { url = "https://files.pythonhosted.org/packages/ea/d9/82d5e68bab783b632023f2fa31db20bebb4e89dfc4d2293945fd68484ee4/httptools-0.6.4-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:856f4bc0478ae143bad54a4242fccb1f3f86a6e1be5548fecfd4102061b3a083", size = 102431, upload-time = "2024-10-16T19:44:39.818Z" },
    { url = "https://files.pythonhosted.org/packages/96/c1/cb499655cbdbfb57b577734fde02f6fa0bbc3fe9fb4d87b742b512908dff/httptools-0.6.4-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:322d20ea9cdd1fa98bd6a74b77e2ec5b818abdc3d36695ab402a0de8ef2865a3", size = 473121, upload-time = "2024-10-16T19:44:41.189Z" },
    { url = "https://files.pythonhosted.org/packages/af/71/ee32fd358f8a3bb199b03261f10921716990808a675d8160b5383487a317/httptools-0.6.4-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:4d87b29bd4486c0093fc64dea80231f7c7f7eb4dc70ae394d70a495ab8436071", size = 473805, upload-time = "2024-10-16T19:44:42.384Z" },
    { url = "https://files.pythonhosted.org/packages/8a/0a/0d4df132bfca1507114198b766f1737d57580c9ad1cf93c1ff673e3387be/httptools-0.6.4-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:342dd6946aa6bda4b8f18c734576106b8a31f2fe31492881a9a160ec84ff4bd5", size = 448858, upload-time = "2024-10-16T19:44:43.959Z" },
    { url = "https://files.pythonhosted.org/packages/1e/6a/787004fdef2cabea27bad1073bf6a33f2437b4dbd3b6fb4a9d71172b1c7c/httptools-0.6.4-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:4b36913ba52008249223042dca46e69967985fb4051951f94357ea681e1f5dc0", size = 452042, upload-time = "2024-10-16T19:44:45.071Z" },
    { url = "https://files.pythonhosted.org/packages/4d/dc/7decab5c404d1d2cdc1bb330b1bf70e83d6af0396fd4fc76fc60c0d522bf/httptools-0.6.4-cp313-cp313-win_amd64.whl", hash = "sha256:28908df1b9bb8187393d5b5db91435ccc9c8e891657f9cbb42a2541b44c82fc8", size = 87682, upload-time = "2024-10-16T19:44:46.46Z" },
]

[[package]]
name = "httpx"
version = "0.28.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "anyio" },
    { name = "certifi" },
    { name = "httpcore" },
    { name = "idna" },
]
sdist = { url = "https://files.pythonhosted.org/packages/b1/df/48c586a5fe32a0f01324ee087459e112ebb7224f646c0b5023f5e79e9956/httpx-0.28.1.tar.gz", hash = "sha256:75e98c5f16b0f35b567856f597f06ff2270a374470a5c2392242528e3e3e42fc", size = 141406, upload-time = "2024-12-06T15:37:23.222Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/2a/39/e50c7c3a983047577ee07d2a9e53faf5a69493943ec3f6a384bdc792deb2/httpx-0.28.1-py3-none-any.whl", hash = "sha256:d909fcccc110f8c7faf814ca82a9a4d816bc5a6dbfea25d6591d6985b8ba59ad", size = 73517, upload-time = "2024-12-06T15:37:21.509Z" },
]

[package.optional-dependencies]
http2 = [
    { name = "h2" },
]

[[package]]
name = "hyperframe"
version = "6.1.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/02/e7/94f8232d4a74cc99514c13a9f995811485a6903d48e5d952771ef6322e30/hyperframe-6.1.0.tar.gz", hash = "sha256:f630908a00854a7adeabd6382b43923a4c4cd4b821fcb527e6ab9e15382a3b08", size = 26566, upload-time = "2025-01-22T21:41:49.302Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/48/30/47d0bf6072f7252e6521f3447ccfa40b421b6824517f82854703d0f5a98b/hyperframe-6.1.0-py3-none-any.whl", hash = "sha256:b03380493a519fce58ea5af42e4a42317bf9bd425596f7a0835ffce80f1a42e5", size = 13007, upload-time = "2025-01-22T21:41:47.295Z" },
]

[[package]]
name = "idna"
version = "3.10"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f1/70/7703c29685631f5a7590aa73f1f1d3fa9a380e654b86af429e0934a32f7d/idna-3.10.tar.gz", hash = "sha256:12f65c9b470abda6dc35cf8e63cc574b1c52b11df2c86030af0ac09b01b13ea9", size = 190490, upload-time = "2024-09-15T18:07:39.745Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/76/c6/c88e154df9c4e1a2a66ccf0005a88dfb2650c1dffb6f5ce603dfbd452ce3/idna-3.10-py3-none-any.whl", hash = "sha256:946d195a0d259cbba61165e88e65941f16e9b36ea6ddb97f00452bae8b1287d3", size = 70442, upload-time = "2024-09-15T18:07:37.964Z" },
]

[[package]]
name = "iniconfig"
version = "2.1.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f2/97/ebf4da567aa6827c909642694d71c9fcf53e5b504f2d96afea02718862f3/iniconfig-2.1.0.tar.gz", hash = "sha256:3abbd2e30b36733fee78f9c7f7308f2d0050e88f0087fd25c2645f63c773e1c7", size = 4793, upload-time = "2025-03-19T20:09:59.721Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/2c/e1/e6716421ea10d38022b952c159d5161ca1193197fb744506875fbb87ea7b/iniconfig-2.1.0-py3-none-any.whl", hash = "sha256:9deba5723312380e77435581c6bf4935c94cbfab9b1ed33ef8d238ea168eb760", size = 6050, upload-time = "2025-03-19T20:10:01.071Z" },
]

[[package]]
name = "jiter"
version = "0.10.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/ee/9d/ae7ddb4b8ab3fb1b51faf4deb36cb48a4fbbd7cb36bad6a5fca4741306f7/jiter-0.10.0.tar.gz", hash = "sha256:07a7142c38aacc85194391108dc91b5b57093c978a9932bd86a36862759d9500", size = 162759, upload-time = "2025-05-18T19:04:59.73Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/6d/b5/348b3313c58f5fbfb2194eb4d07e46a35748ba6e5b3b3046143f3040bafa/jiter-0.10.0-cp312-cp312-macosx_10_12_x86_64.whl", hash = "sha256:1e274728e4a5345a6dde2d343c8da018b9d4bd4350f5a472fa91f66fda44911b", size = 312262, upload-time = "2025-05-18T19:03:44.637Z" },
    { url = "https://files.pythonhosted.org/packages/9c/4a/6a2397096162b21645162825f058d1709a02965606e537e3304b02742e9b/jiter-0.10.0-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:7202ae396446c988cb2a5feb33a543ab2165b786ac97f53b59aafb803fef0744", size = 320124, upload-time = "2025-05-18T19:03:46.341Z" },
    { url = "https://files.pythonhosted.org/packages/2a/85/1ce02cade7516b726dd88f59a4ee46914bf79d1676d1228ef2002ed2f1c9/jiter-0.10.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:23ba7722d6748b6920ed02a8f1726fb4b33e0fd2f3f621816a8b486c66410ab2", size = 345330, upload-time = "2025-05-18T19:03:47.596Z" },
    { url = "https://files.pythonhosted.org/packages/75/d0/bb6b4f209a77190ce10ea8d7e50bf3725fc16d3372d0a9f11985a2b23eff/jiter-0.10.0-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:371eab43c0a288537d30e1f0b193bc4eca90439fc08a022dd83e5e07500ed026", size = 369670, upload-time = "2025-05-18T19:03:49.334Z" },
    { url = "https://files.pythonhosted.org/packages/a0/f5/a61787da9b8847a601e6827fbc42ecb12be2c925ced3252c8ffcb56afcaf/jiter-0.10.0-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:6c675736059020365cebc845a820214765162728b51ab1e03a1b7b3abb70f74c", size = 489057, upload-time = "2025-05-18T19:03:50.66Z" },
    { url = "https://files.pythonhosted.org/packages/12/e4/6f906272810a7b21406c760a53aadbe52e99ee070fc5c0cb191e316de30b/jiter-0.10.0-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:0c5867d40ab716e4684858e4887489685968a47e3ba222e44cde6e4a2154f959", size = 389372, upload-time = "2025-05-18T19:03:51.98Z" },
    { url = "https://files.pythonhosted.org/packages/e2/ba/77013b0b8ba904bf3762f11e0129b8928bff7f978a81838dfcc958ad5728/jiter-0.10.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:395bb9a26111b60141757d874d27fdea01b17e8fac958b91c20128ba8f4acc8a", size = 352038, upload-time = "2025-05-18T19:03:53.703Z" },
    { url = "https://files.pythonhosted.org/packages/67/27/c62568e3ccb03368dbcc44a1ef3a423cb86778a4389e995125d3d1aaa0a4/jiter-0.10.0-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:6842184aed5cdb07e0c7e20e5bdcfafe33515ee1741a6835353bb45fe5d1bd95", size = 391538, upload-time = "2025-05-18T19:03:55.046Z" },
    { url = "https://files.pythonhosted.org/packages/c0/72/0d6b7e31fc17a8fdce76164884edef0698ba556b8eb0af9546ae1a06b91d/jiter-0.10.0-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:62755d1bcea9876770d4df713d82606c8c1a3dca88ff39046b85a048566d56ea", size = 523557, upload-time = "2025-05-18T19:03:56.386Z" },
    { url = "https://files.pythonhosted.org/packages/2f/09/bc1661fbbcbeb6244bd2904ff3a06f340aa77a2b94e5a7373fd165960ea3/jiter-0.10.0-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:533efbce2cacec78d5ba73a41756beff8431dfa1694b6346ce7af3a12c42202b", size = 514202, upload-time = "2025-05-18T19:03:57.675Z" },
    { url = "https://files.pythonhosted.org/packages/1b/84/5a5d5400e9d4d54b8004c9673bbe4403928a00d28529ff35b19e9d176b19/jiter-0.10.0-cp312-cp312-win32.whl", hash = "sha256:8be921f0cadd245e981b964dfbcd6fd4bc4e254cdc069490416dd7a2632ecc01", size = 211781, upload-time = "2025-05-18T19:03:59.025Z" },
    { url = "https://files.pythonhosted.org/packages/9b/52/7ec47455e26f2d6e5f2ea4951a0652c06e5b995c291f723973ae9e724a65/jiter-0.10.0-cp312-cp312-win_amd64.whl", hash = "sha256:a7c7d785ae9dda68c2678532a5a1581347e9c15362ae9f6e68f3fdbfb64f2e49", size = 206176, upload-time = "2025-05-18T19:04:00.305Z" },
    { url = "https://files.pythonhosted.org/packages/2e/b0/279597e7a270e8d22623fea6c5d4eeac328e7d95c236ed51a2b884c54f70/jiter-0.10.0-cp313-cp313-macosx_10_12_x86_64.whl", hash = "sha256:e0588107ec8e11b6f5ef0e0d656fb2803ac6cf94a96b2b9fc675c0e3ab5e8644", size = 311617, upload-time = "2025-05-18T19:04:02.078Z" },
    { url = "https://files.pythonhosted.org/packages/91/e3/0916334936f356d605f54cc164af4060e3e7094364add445a3bc79335d46/jiter-0.10.0-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:cafc4628b616dc32530c20ee53d71589816cf385dd9449633e910d596b1f5c8a", size = 318947, upload-time = "2025-05-18T19:04:03.347Z" },
    { url = "https://files.pythonhosted.org/packages/6a/8e/fd94e8c02d0e94539b7d669a7ebbd2776e51f329bb2c84d4385e8063a2ad/jiter-0.10.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:520ef6d981172693786a49ff5b09eda72a42e539f14788124a07530f785c3ad6", size = 344618, upload-time = "2025-05-18T19:04:04.709Z" },
    { url = "https://files.pythonhosted.org/packages/6f/b0/f9f0a2ec42c6e9c2e61c327824687f1e2415b767e1089c1d9135f43816bd/jiter-0.10.0-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:554dedfd05937f8fc45d17ebdf298fe7e0c77458232bcb73d9fbbf4c6455f5b3", size = 368829, upload-time = "2025-05-18T19:04:06.912Z" },
    { url = "https://files.pythonhosted.org/packages/e8/57/5bbcd5331910595ad53b9fd0c610392ac68692176f05ae48d6ce5c852967/jiter-0.10.0-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:5bc299da7789deacf95f64052d97f75c16d4fc8c4c214a22bf8d859a4288a1c2", size = 491034, upload-time = "2025-05-18T19:04:08.222Z" },
    { url = "https://files.pythonhosted.org/packages/9b/be/c393df00e6e6e9e623a73551774449f2f23b6ec6a502a3297aeeece2c65a/jiter-0.10.0-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:5161e201172de298a8a1baad95eb85db4fb90e902353b1f6a41d64ea64644e25", size = 388529, upload-time = "2025-05-18T19:04:09.566Z" },
    { url = "https://files.pythonhosted.org/packages/42/3e/df2235c54d365434c7f150b986a6e35f41ebdc2f95acea3036d99613025d/jiter-0.10.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:2e2227db6ba93cb3e2bf67c87e594adde0609f146344e8207e8730364db27041", size = 350671, upload-time = "2025-05-18T19:04:10.98Z" },
    { url = "https://files.pythonhosted.org/packages/c6/77/71b0b24cbcc28f55ab4dbfe029f9a5b73aeadaba677843fc6dc9ed2b1d0a/jiter-0.10.0-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:15acb267ea5e2c64515574b06a8bf393fbfee6a50eb1673614aa45f4613c0cca", size = 390864, upload-time = "2025-05-18T19:04:12.722Z" },
    { url = "https://files.pythonhosted.org/packages/6a/d3/ef774b6969b9b6178e1d1e7a89a3bd37d241f3d3ec5f8deb37bbd203714a/jiter-0.10.0-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:901b92f2e2947dc6dfcb52fd624453862e16665ea909a08398dde19c0731b7f4", size = 522989, upload-time = "2025-05-18T19:04:14.261Z" },
    { url = "https://files.pythonhosted.org/packages/0c/41/9becdb1d8dd5d854142f45a9d71949ed7e87a8e312b0bede2de849388cb9/jiter-0.10.0-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:d0cb9a125d5a3ec971a094a845eadde2db0de85b33c9f13eb94a0c63d463879e", size = 513495, upload-time = "2025-05-18T19:04:15.603Z" },
    { url = "https://files.pythonhosted.org/packages/9c/36/3468e5a18238bdedae7c4d19461265b5e9b8e288d3f86cd89d00cbb48686/jiter-0.10.0-cp313-cp313-win32.whl", hash = "sha256:48a403277ad1ee208fb930bdf91745e4d2d6e47253eedc96e2559d1e6527006d", size = 211289, upload-time = "2025-05-18T19:04:17.541Z" },
    { url = "https://files.pythonhosted.org/packages/7e/07/1c96b623128bcb913706e294adb5f768fb7baf8db5e1338ce7b4ee8c78ef/jiter-0.10.0-cp313-cp313-win_amd64.whl", hash = "sha256:75f9eb72ecb640619c29bf714e78c9c46c9c4eaafd644bf78577ede459f330d4", size = 205074, upload-time = "2025-05-18T19:04:19.21Z" },
    { url = "https://files.pythonhosted.org/packages/54/46/caa2c1342655f57d8f0f2519774c6d67132205909c65e9aa8255e1d7b4f4/jiter-0.10.0-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:28ed2a4c05a1f32ef0e1d24c2611330219fed727dae01789f4a335617634b1ca", size = 318225, upload-time = "2025-05-18T19:04:20.583Z" },
    { url = "https://files.pythonhosted.org/packages/43/84/c7d44c75767e18946219ba2d703a5a32ab37b0bc21886a97bc6062e4da42/jiter-0.10.0-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:14a4c418b1ec86a195f1ca69da8b23e8926c752b685af665ce30777233dfe070", size = 350235, upload-time = "2025-05-18T19:04:22.363Z" },
    { url = "https://files.pythonhosted.org/packages/01/16/f5a0135ccd968b480daad0e6ab34b0c7c5ba3bc447e5088152696140dcb3/jiter-0.10.0-cp313-cp313t-win_amd64.whl", hash = "sha256:d7bfed2fe1fe0e4dda6ef682cee888ba444b21e7a6553e03252e4feb6cf0adca", size = 207278, upload-time = "2025-05-18T19:04:23.627Z" },
    { url = "https://files.pythonhosted.org/packages/1c/9b/1d646da42c3de6c2188fdaa15bce8ecb22b635904fc68be025e21249ba44/jiter-0.10.0-cp314-cp314-macosx_10_12_x86_64.whl", hash = "sha256:5e9251a5e83fab8d87799d3e1a46cb4b7f2919b895c6f4483629ed2446f66522", size = 310866, upload-time = "2025-05-18T19:04:24.891Z" },
    { url = "https://files.pythonhosted.org/packages/ad/0e/26538b158e8a7c7987e94e7aeb2999e2e82b1f9d2e1f6e9874ddf71ebda0/jiter-0.10.0-cp314-cp314-macosx_11_0_arm64.whl", hash = "sha256:023aa0204126fe5b87ccbcd75c8a0d0261b9abdbbf46d55e7ae9f8e22424eeb8", size = 318772, upload-time = "2025-05-18T19:04:26.161Z" },
    { url = "https://files.pythonhosted.org/packages/7b/fb/d302893151caa1c2636d6574d213e4b34e31fd077af6050a9c5cbb42f6fb/jiter-0.10.0-cp314-cp314-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:3c189c4f1779c05f75fc17c0c1267594ed918996a231593a21a5ca5438445216", size = 344534, upload-time = "2025-05-18T19:04:27.495Z" },
    { url = "https://files.pythonhosted.org/packages/01/d8/5780b64a149d74e347c5128d82176eb1e3241b1391ac07935693466d6219/jiter-0.10.0-cp314-cp314-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:15720084d90d1098ca0229352607cd68256c76991f6b374af96f36920eae13c4", size = 369087, upload-time = "2025-05-18T19:04:28.896Z" },
    { url = "https://files.pythonhosted.org/packages/e8/5b/f235a1437445160e777544f3ade57544daf96ba7e96c1a5b24a6f7ac7004/jiter-0.10.0-cp314-cp314-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:e4f2fb68e5f1cfee30e2b2a09549a00683e0fde4c6a2ab88c94072fc33cb7426", size = 490694, upload-time = "2025-05-18T19:04:30.183Z" },
    { url = "https://files.pythonhosted.org/packages/85/a9/9c3d4617caa2ff89cf61b41e83820c27ebb3f7b5fae8a72901e8cd6ff9be/jiter-0.10.0-cp314-cp314-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:ce541693355fc6da424c08b7edf39a2895f58d6ea17d92cc2b168d20907dee12", size = 388992, upload-time = "2025-05-18T19:04:32.028Z" },
    { url = "https://files.pythonhosted.org/packages/68/b1/344fd14049ba5c94526540af7eb661871f9c54d5f5601ff41a959b9a0bbd/jiter-0.10.0-cp314-cp314-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:31c50c40272e189d50006ad5c73883caabb73d4e9748a688b216e85a9a9ca3b9", size = 351723, upload-time = "2025-05-18T19:04:33.467Z" },
    { url = "https://files.pythonhosted.org/packages/41/89/4c0e345041186f82a31aee7b9d4219a910df672b9fef26f129f0cda07a29/jiter-0.10.0-cp314-cp314-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:fa3402a2ff9815960e0372a47b75c76979d74402448509ccd49a275fa983ef8a", size = 392215, upload-time = "2025-05-18T19:04:34.827Z" },
    { url = "https://files.pythonhosted.org/packages/55/58/ee607863e18d3f895feb802154a2177d7e823a7103f000df182e0f718b38/jiter-0.10.0-cp314-cp314-musllinux_1_1_aarch64.whl", hash = "sha256:1956f934dca32d7bb647ea21d06d93ca40868b505c228556d3373cbd255ce853", size = 522762, upload-time = "2025-05-18T19:04:36.19Z" },
    { url = "https://files.pythonhosted.org/packages/15/d0/9123fb41825490d16929e73c212de9a42913d68324a8ce3c8476cae7ac9d/jiter-0.10.0-cp314-cp314-musllinux_1_1_x86_64.whl", hash = "sha256:fcedb049bdfc555e261d6f65a6abe1d5ad68825b7202ccb9692636c70fcced86", size = 513427, upload-time = "2025-05-18T19:04:37.544Z" },
    { url = "https://files.pythonhosted.org/packages/d8/b3/2bd02071c5a2430d0b70403a34411fc519c2f227da7b03da9ba6a956f931/jiter-0.10.0-cp314-cp314-win32.whl", hash = "sha256:ac509f7eccca54b2a29daeb516fb95b6f0bd0d0d8084efaf8ed5dfc7b9f0b357", size = 210127, upload-time = "2025-05-18T19:04:38.837Z" },
    { url = "https://files.pythonhosted.org/packages/03/0c/5fe86614ea050c3ecd728ab4035534387cd41e7c1855ef6c031f1ca93e3f/jiter-0.10.0-cp314-cp314t-macosx_11_0_arm64.whl", hash = "sha256:5ed975b83a2b8639356151cef5c0d597c68376fc4922b45d0eb384ac058cfa00", size = 318527, upload-time = "2025-05-18T19:04:40.612Z" },
    { url = "https://files.pythonhosted.org/packages/b3/4a/4175a563579e884192ba6e81725fc0448b042024419be8d83aa8a80a3f44/jiter-0.10.0-cp314-cp314t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:3aa96f2abba33dc77f79b4cf791840230375f9534e5fac927ccceb58c5e604a5", size = 354213, upload-time = "2025-05-18T19:04:41.894Z" },
]

[[package]]
name = "loguru"
version = "0.7.3"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
    { name = "win32-setctime", marker = "sys_platform == 'win32'" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3a/05/a1dae3dffd1116099471c643b8924f5aa6524411dc6c63fdae648c4f1aca/loguru-0.7.3.tar.gz", hash = "sha256:19480589e77d47b8d85b2c827ad95d49bf31b0dcde16593892eb51dd18706eb6", size = 63559, upload-time = "2024-12-06T11:20:56.608Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/0c/29/0348de65b8cc732daa3e33e67806420b2ae89bdce2b04af740289c5c6c8c/loguru-0.7.3-py3-none-any.whl", hash = "sha256:31a33c10c8e1e10422bfd431aeb5d351c7cf7fa671e3c4df004162264b28220c", size = 61595, upload-time = "2024-12-06T11:20:54.538Z" },
]

[[package]]
name = "multidict"
version = "6.6.3"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/3d/2c/5dad12e82fbdf7470f29bff2171484bf07cb3b16ada60a6589af8f376440/multidict-6.6.3.tar.gz", hash = "sha256:798a9eb12dab0a6c2e29c1de6f3468af5cb2da6053a20dfa3344907eed0937cc", size = 101006, upload-time = "2025-06-30T15:53:46.929Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/0e/a0/6b57988ea102da0623ea814160ed78d45a2645e4bbb499c2896d12833a70/multidict-6.6.3-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:056bebbeda16b2e38642d75e9e5310c484b7c24e3841dc0fb943206a72ec89d6", size = 76514, upload-time = "2025-06-30T15:51:48.728Z" },
    { url = "https://files.pythonhosted.org/packages/07/7a/d1e92665b0850c6c0508f101f9cf0410c1afa24973e1115fe9c6a185ebf7/multidict-6.6.3-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:e5f481cccb3c5c5e5de5d00b5141dc589c1047e60d07e85bbd7dea3d4580d63f", size = 45394, upload-time = "2025-06-30T15:51:49.986Z" },
    { url = "https://files.pythonhosted.org/packages/52/6f/dd104490e01be6ef8bf9573705d8572f8c2d2c561f06e3826b081d9e6591/multidict-6.6.3-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:10bea2ee839a759ee368b5a6e47787f399b41e70cf0c20d90dfaf4158dfb4e55", size = 43590, upload-time = "2025-06-30T15:51:51.331Z" },
    { url = "https://files.pythonhosted.org/packages/44/fe/06e0e01b1b0611e6581b7fd5a85b43dacc08b6cea3034f902f383b0873e5/multidict-6.6.3-cp312-cp312-manylinux1_i686.manylinux2014_i686.manylinux_2_17_i686.manylinux_2_5_i686.whl", hash = "sha256:2334cfb0fa9549d6ce2c21af2bfbcd3ac4ec3646b1b1581c88e3e2b1779ec92b", size = 237292, upload-time = "2025-06-30T15:51:52.584Z" },
    { url = "https://files.pythonhosted.org/packages/ce/71/4f0e558fb77696b89c233c1ee2d92f3e1d5459070a0e89153c9e9e804186/multidict-6.6.3-cp312-cp312-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:b8fee016722550a2276ca2cb5bb624480e0ed2bd49125b2b73b7010b9090e888", size = 258385, upload-time = "2025-06-30T15:51:53.913Z" },
    { url = "https://files.pythonhosted.org/packages/e3/25/cca0e68228addad24903801ed1ab42e21307a1b4b6dd2cf63da5d3ae082a/multidict-6.6.3-cp312-cp312-manylinux2014_armv7l.manylinux_2_17_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:e5511cb35f5c50a2db21047c875eb42f308c5583edf96bd8ebf7d770a9d68f6d", size = 242328, upload-time = "2025-06-30T15:51:55.672Z" },
    { url = "https://files.pythonhosted.org/packages/6e/a3/46f2d420d86bbcb8fe660b26a10a219871a0fbf4d43cb846a4031533f3e0/multidict-6.6.3-cp312-cp312-manylinux2014_ppc64le.manylinux_2_17_ppc64le.manylinux_2_28_ppc64le.whl", hash = "sha256:712b348f7f449948e0a6c4564a21c7db965af900973a67db432d724619b3c680", size = 268057, upload-time = "2025-06-30T15:51:57.037Z" },
    { url = "https://files.pythonhosted.org/packages/9e/73/1c743542fe00794a2ec7466abd3f312ccb8fad8dff9f36d42e18fb1ec33e/multidict-6.6.3-cp312-cp312-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:e4e15d2138ee2694e038e33b7c3da70e6b0ad8868b9f8094a72e1414aeda9c1a", size = 269341, upload-time = "2025-06-30T15:51:59.111Z" },
    { url = "https://files.pythonhosted.org/packages/a4/11/6ec9dcbe2264b92778eeb85407d1df18812248bf3506a5a1754bc035db0c/multidict-6.6.3-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:8df25594989aebff8a130f7899fa03cbfcc5d2b5f4a461cf2518236fe6f15961", size = 256081, upload-time = "2025-06-30T15:52:00.533Z" },
    { url = "https://files.pythonhosted.org/packages/9b/2b/631b1e2afeb5f1696846d747d36cda075bfdc0bc7245d6ba5c319278d6c4/multidict-6.6.3-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:159ca68bfd284a8860f8d8112cf0521113bffd9c17568579e4d13d1f1dc76b65", size = 253581, upload-time = "2025-06-30T15:52:02.43Z" },
    { url = "https://files.pythonhosted.org/packages/bf/0e/7e3b93f79efeb6111d3bf9a1a69e555ba1d07ad1c11bceb56b7310d0d7ee/multidict-6.6.3-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:e098c17856a8c9ade81b4810888c5ad1914099657226283cab3062c0540b0643", size = 250750, upload-time = "2025-06-30T15:52:04.26Z" },
    { url = "https://files.pythonhosted.org/packages/ad/9e/086846c1d6601948e7de556ee464a2d4c85e33883e749f46b9547d7b0704/multidict-6.6.3-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:67c92ed673049dec52d7ed39f8cf9ebbadf5032c774058b4406d18c8f8fe7063", size = 251548, upload-time = "2025-06-30T15:52:06.002Z" },
    { url = "https://files.pythonhosted.org/packages/8c/7b/86ec260118e522f1a31550e87b23542294880c97cfbf6fb18cc67b044c66/multidict-6.6.3-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:bd0578596e3a835ef451784053cfd327d607fc39ea1a14812139339a18a0dbc3", size = 262718, upload-time = "2025-06-30T15:52:07.707Z" },
    { url = "https://files.pythonhosted.org/packages/8c/bd/22ce8f47abb0be04692c9fc4638508b8340987b18691aa7775d927b73f72/multidict-6.6.3-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:346055630a2df2115cd23ae271910b4cae40f4e336773550dca4889b12916e75", size = 259603, upload-time = "2025-06-30T15:52:09.58Z" },
    { url = "https://files.pythonhosted.org/packages/07/9c/91b7ac1691be95cd1f4a26e36a74b97cda6aa9820632d31aab4410f46ebd/multidict-6.6.3-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:555ff55a359302b79de97e0468e9ee80637b0de1fce77721639f7cd9440b3a10", size = 251351, upload-time = "2025-06-30T15:52:10.947Z" },
    { url = "https://files.pythonhosted.org/packages/6f/5c/4d7adc739884f7a9fbe00d1eac8c034023ef8bad71f2ebe12823ca2e3649/multidict-6.6.3-cp312-cp312-win32.whl", hash = "sha256:73ab034fb8d58ff85c2bcbadc470efc3fafeea8affcf8722855fb94557f14cc5", size = 41860, upload-time = "2025-06-30T15:52:12.334Z" },
    { url = "https://files.pythonhosted.org/packages/6a/a3/0fbc7afdf7cb1aa12a086b02959307848eb6bcc8f66fcb66c0cb57e2a2c1/multidict-6.6.3-cp312-cp312-win_amd64.whl", hash = "sha256:04cbcce84f63b9af41bad04a54d4cc4e60e90c35b9e6ccb130be2d75b71f8c17", size = 45982, upload-time = "2025-06-30T15:52:13.6Z" },
    { url = "https://files.pythonhosted.org/packages/b8/95/8c825bd70ff9b02462dc18d1295dd08d3e9e4eb66856d292ffa62cfe1920/multidict-6.6.3-cp312-cp312-win_arm64.whl", hash = "sha256:0f1130b896ecb52d2a1e615260f3ea2af55fa7dc3d7c3003ba0c3121a759b18b", size = 43210, upload-time = "2025-06-30T15:52:14.893Z" },
    { url = "https://files.pythonhosted.org/packages/52/1d/0bebcbbb4f000751fbd09957257903d6e002943fc668d841a4cf2fb7f872/multidict-6.6.3-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:540d3c06d48507357a7d57721e5094b4f7093399a0106c211f33540fdc374d55", size = 75843, upload-time = "2025-06-30T15:52:16.155Z" },
    { url = "https://files.pythonhosted.org/packages/07/8f/cbe241b0434cfe257f65c2b1bcf9e8d5fb52bc708c5061fb29b0fed22bdf/multidict-6.6.3-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:9c19cea2a690f04247d43f366d03e4eb110a0dc4cd1bbeee4d445435428ed35b", size = 45053, upload-time = "2025-06-30T15:52:17.429Z" },
    { url = "https://files.pythonhosted.org/packages/32/d2/0b3b23f9dbad5b270b22a3ac3ea73ed0a50ef2d9a390447061178ed6bdb8/multidict-6.6.3-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:7af039820cfd00effec86bda5d8debef711a3e86a1d3772e85bea0f243a4bd65", size = 43273, upload-time = "2025-06-30T15:52:19.346Z" },
    { url = "https://files.pythonhosted.org/packages/fd/fe/6eb68927e823999e3683bc49678eb20374ba9615097d085298fd5b386564/multidict-6.6.3-cp313-cp313-manylinux1_i686.manylinux2014_i686.manylinux_2_17_i686.manylinux_2_5_i686.whl", hash = "sha256:500b84f51654fdc3944e936f2922114349bf8fdcac77c3092b03449f0e5bc2b3", size = 237124, upload-time = "2025-06-30T15:52:20.773Z" },
    { url = "https://files.pythonhosted.org/packages/e7/ab/320d8507e7726c460cb77117848b3834ea0d59e769f36fdae495f7669929/multidict-6.6.3-cp313-cp313-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:f3fc723ab8a5c5ed6c50418e9bfcd8e6dceba6c271cee6728a10a4ed8561520c", size = 256892, upload-time = "2025-06-30T15:52:22.242Z" },
    { url = "https://files.pythonhosted.org/packages/76/60/38ee422db515ac69834e60142a1a69111ac96026e76e8e9aa347fd2e4591/multidict-6.6.3-cp313-cp313-manylinux2014_armv7l.manylinux_2_17_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:94c47ea3ade005b5976789baaed66d4de4480d0a0bf31cef6edaa41c1e7b56a6", size = 240547, upload-time = "2025-06-30T15:52:23.736Z" },
    { url = "https://files.pythonhosted.org/packages/27/fb/905224fde2dff042b030c27ad95a7ae744325cf54b890b443d30a789b80e/multidict-6.6.3-cp313-cp313-manylinux2014_ppc64le.manylinux_2_17_ppc64le.manylinux_2_28_ppc64le.whl", hash = "sha256:dbc7cf464cc6d67e83e136c9f55726da3a30176f020a36ead246eceed87f1cd8", size = 266223, upload-time = "2025-06-30T15:52:25.185Z" },
    { url = "https://files.pythonhosted.org/packages/76/35/dc38ab361051beae08d1a53965e3e1a418752fc5be4d3fb983c5582d8784/multidict-6.6.3-cp313-cp313-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:900eb9f9da25ada070f8ee4a23f884e0ee66fe4e1a38c3af644256a508ad81ca", size = 267262, upload-time = "2025-06-30T15:52:26.969Z" },
    { url = "https://files.pythonhosted.org/packages/1f/a3/0a485b7f36e422421b17e2bbb5a81c1af10eac1d4476f2ff92927c730479/multidict-6.6.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:7c6df517cf177da5d47ab15407143a89cd1a23f8b335f3a28d57e8b0a3dbb884", size = 254345, upload-time = "2025-06-30T15:52:28.467Z" },
    { url = "https://files.pythonhosted.org/packages/b4/59/bcdd52c1dab7c0e0d75ff19cac751fbd5f850d1fc39172ce809a74aa9ea4/multidict-6.6.3-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:4ef421045f13879e21c994b36e728d8e7d126c91a64b9185810ab51d474f27e7", size = 252248, upload-time = "2025-06-30T15:52:29.938Z" },
    { url = "https://files.pythonhosted.org/packages/bb/a4/2d96aaa6eae8067ce108d4acee6f45ced5728beda55c0f02ae1072c730d1/multidict-6.6.3-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:6c1e61bb4f80895c081790b6b09fa49e13566df8fbff817da3f85b3a8192e36b", size = 250115, upload-time = "2025-06-30T15:52:31.416Z" },
    { url = "https://files.pythonhosted.org/packages/25/d2/ed9f847fa5c7d0677d4f02ea2c163d5e48573de3f57bacf5670e43a5ffaa/multidict-6.6.3-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:e5e8523bb12d7623cd8300dbd91b9e439a46a028cd078ca695eb66ba31adee3c", size = 249649, upload-time = "2025-06-30T15:52:32.996Z" },
    { url = "https://files.pythonhosted.org/packages/1f/af/9155850372563fc550803d3f25373308aa70f59b52cff25854086ecb4a79/multidict-6.6.3-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:ef58340cc896219e4e653dade08fea5c55c6df41bcc68122e3be3e9d873d9a7b", size = 261203, upload-time = "2025-06-30T15:52:34.521Z" },
    { url = "https://files.pythonhosted.org/packages/36/2f/c6a728f699896252cf309769089568a33c6439626648843f78743660709d/multidict-6.6.3-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:fc9dc435ec8699e7b602b94fe0cd4703e69273a01cbc34409af29e7820f777f1", size = 258051, upload-time = "2025-06-30T15:52:35.999Z" },
    { url = "https://files.pythonhosted.org/packages/d0/60/689880776d6b18fa2b70f6cc74ff87dd6c6b9b47bd9cf74c16fecfaa6ad9/multidict-6.6.3-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:9e864486ef4ab07db5e9cb997bad2b681514158d6954dd1958dfb163b83d53e6", size = 249601, upload-time = "2025-06-30T15:52:37.473Z" },
    { url = "https://files.pythonhosted.org/packages/75/5e/325b11f2222a549019cf2ef879c1f81f94a0d40ace3ef55cf529915ba6cc/multidict-6.6.3-cp313-cp313-win32.whl", hash = "sha256:5633a82fba8e841bc5c5c06b16e21529573cd654f67fd833650a215520a6210e", size = 41683, upload-time = "2025-06-30T15:52:38.927Z" },
    { url = "https://files.pythonhosted.org/packages/b1/ad/cf46e73f5d6e3c775cabd2a05976547f3f18b39bee06260369a42501f053/multidict-6.6.3-cp313-cp313-win_amd64.whl", hash = "sha256:e93089c1570a4ad54c3714a12c2cef549dc9d58e97bcded193d928649cab78e9", size = 45811, upload-time = "2025-06-30T15:52:40.207Z" },
    { url = "https://files.pythonhosted.org/packages/c5/c9/2e3fe950db28fb7c62e1a5f46e1e38759b072e2089209bc033c2798bb5ec/multidict-6.6.3-cp313-cp313-win_arm64.whl", hash = "sha256:c60b401f192e79caec61f166da9c924e9f8bc65548d4246842df91651e83d600", size = 43056, upload-time = "2025-06-30T15:52:41.575Z" },
    { url = "https://files.pythonhosted.org/packages/3a/58/aaf8114cf34966e084a8cc9517771288adb53465188843d5a19862cb6dc3/multidict-6.6.3-cp313-cp313t-macosx_10_13_universal2.whl", hash = "sha256:02fd8f32d403a6ff13864b0851f1f523d4c988051eea0471d4f1fd8010f11134", size = 82811, upload-time = "2025-06-30T15:52:43.281Z" },
    { url = "https://files.pythonhosted.org/packages/71/af/5402e7b58a1f5b987a07ad98f2501fdba2a4f4b4c30cf114e3ce8db64c87/multidict-6.6.3-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:f3aa090106b1543f3f87b2041eef3c156c8da2aed90c63a2fbed62d875c49c37", size = 48304, upload-time = "2025-06-30T15:52:45.026Z" },
    { url = "https://files.pythonhosted.org/packages/39/65/ab3c8cafe21adb45b24a50266fd747147dec7847425bc2a0f6934b3ae9ce/multidict-6.6.3-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:e924fb978615a5e33ff644cc42e6aa241effcf4f3322c09d4f8cebde95aff5f8", size = 46775, upload-time = "2025-06-30T15:52:46.459Z" },
    { url = "https://files.pythonhosted.org/packages/49/ba/9fcc1b332f67cc0c0c8079e263bfab6660f87fe4e28a35921771ff3eea0d/multidict-6.6.3-cp313-cp313t-manylinux1_i686.manylinux2014_i686.manylinux_2_17_i686.manylinux_2_5_i686.whl", hash = "sha256:b9fe5a0e57c6dbd0e2ce81ca66272282c32cd11d31658ee9553849d91289e1c1", size = 229773, upload-time = "2025-06-30T15:52:47.88Z" },
    { url = "https://files.pythonhosted.org/packages/a4/14/0145a251f555f7c754ce2dcbcd012939bbd1f34f066fa5d28a50e722a054/multidict-6.6.3-cp313-cp313t-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:b24576f208793ebae00280c59927c3b7c2a3b1655e443a25f753c4611bc1c373", size = 250083, upload-time = "2025-06-30T15:52:49.366Z" },
    { url = "https://files.pythonhosted.org/packages/9e/d4/d5c0bd2bbb173b586c249a151a26d2fb3ec7d53c96e42091c9fef4e1f10c/multidict-6.6.3-cp313-cp313t-manylinux2014_armv7l.manylinux_2_17_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:135631cb6c58eac37d7ac0df380294fecdc026b28837fa07c02e459c7fb9c54e", size = 228980, upload-time = "2025-06-30T15:52:50.903Z" },
    { url = "https://files.pythonhosted.org/packages/21/32/c9a2d8444a50ec48c4733ccc67254100c10e1c8ae8e40c7a2d2183b59b97/multidict-6.6.3-cp313-cp313t-manylinux2014_ppc64le.manylinux_2_17_ppc64le.manylinux_2_28_ppc64le.whl", hash = "sha256:274d416b0df887aef98f19f21578653982cfb8a05b4e187d4a17103322eeaf8f", size = 257776, upload-time = "2025-06-30T15:52:52.764Z" },
    { url = "https://files.pythonhosted.org/packages/68/d0/14fa1699f4ef629eae08ad6201c6b476098f5efb051b296f4c26be7a9fdf/multidict-6.6.3-cp313-cp313t-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:e252017a817fad7ce05cafbe5711ed40faeb580e63b16755a3a24e66fa1d87c0", size = 256882, upload-time = "2025-06-30T15:52:54.596Z" },
    { url = "https://files.pythonhosted.org/packages/da/88/84a27570fbe303c65607d517a5f147cd2fc046c2d1da02b84b17b9bdc2aa/multidict-6.6.3-cp313-cp313t-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:2e4cc8d848cd4fe1cdee28c13ea79ab0ed37fc2e89dd77bac86a2e7959a8c3bc", size = 247816, upload-time = "2025-06-30T15:52:56.175Z" },
    { url = "https://files.pythonhosted.org/packages/1c/60/dca352a0c999ce96a5d8b8ee0b2b9f729dcad2e0b0c195f8286269a2074c/multidict-6.6.3-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:9e236a7094b9c4c1b7585f6b9cca34b9d833cf079f7e4c49e6a4a6ec9bfdc68f", size = 245341, upload-time = "2025-06-30T15:52:57.752Z" },
    { url = "https://files.pythonhosted.org/packages/50/ef/433fa3ed06028f03946f3993223dada70fb700f763f70c00079533c34578/multidict-6.6.3-cp313-cp313t-musllinux_1_2_armv7l.whl", hash = "sha256:e0cb0ab69915c55627c933f0b555a943d98ba71b4d1c57bc0d0a66e2567c7471", size = 235854, upload-time = "2025-06-30T15:52:59.74Z" },
    { url = "https://files.pythonhosted.org/packages/1b/1f/487612ab56fbe35715320905215a57fede20de7db40a261759690dc80471/multidict-6.6.3-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:81ef2f64593aba09c5212a3d0f8c906a0d38d710a011f2f42759704d4557d3f2", size = 243432, upload-time = "2025-06-30T15:53:01.602Z" },
    { url = "https://files.pythonhosted.org/packages/da/6f/ce8b79de16cd885c6f9052c96a3671373d00c59b3ee635ea93e6e81b8ccf/multidict-6.6.3-cp313-cp313t-musllinux_1_2_ppc64le.whl", hash = "sha256:b9cbc60010de3562545fa198bfc6d3825df430ea96d2cc509c39bd71e2e7d648", size = 252731, upload-time = "2025-06-30T15:53:03.517Z" },
    { url = "https://files.pythonhosted.org/packages/bb/fe/a2514a6aba78e5abefa1624ca85ae18f542d95ac5cde2e3815a9fbf369aa/multidict-6.6.3-cp313-cp313t-musllinux_1_2_s390x.whl", hash = "sha256:70d974eaaa37211390cd02ef93b7e938de564bbffa866f0b08d07e5e65da783d", size = 247086, upload-time = "2025-06-30T15:53:05.48Z" },
    { url = "https://files.pythonhosted.org/packages/8c/22/b788718d63bb3cce752d107a57c85fcd1a212c6c778628567c9713f9345a/multidict-6.6.3-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:3713303e4a6663c6d01d648a68f2848701001f3390a030edaaf3fc949c90bf7c", size = 243338, upload-time = "2025-06-30T15:53:07.522Z" },
    { url = "https://files.pythonhosted.org/packages/22/d6/fdb3d0670819f2228f3f7d9af613d5e652c15d170c83e5f1c94fbc55a25b/multidict-6.6.3-cp313-cp313t-win32.whl", hash = "sha256:639ecc9fe7cd73f2495f62c213e964843826f44505a3e5d82805aa85cac6f89e", size = 47812, upload-time = "2025-06-30T15:53:09.263Z" },
    { url = "https://files.pythonhosted.org/packages/b6/d6/a9d2c808f2c489ad199723197419207ecbfbc1776f6e155e1ecea9c883aa/multidict-6.6.3-cp313-cp313t-win_amd64.whl", hash = "sha256:9f97e181f344a0ef3881b573d31de8542cc0dbc559ec68c8f8b5ce2c2e91646d", size = 53011, upload-time = "2025-06-30T15:53:11.038Z" },
    { url = "https://files.pythonhosted.org/packages/f2/40/b68001cba8188dd267590a111f9661b6256debc327137667e832bf5d66e8/multidict-6.6.3-cp313-cp313t-win_arm64.whl", hash = "sha256:ce8b7693da41a3c4fde5871c738a81490cea5496c671d74374c8ab889e1834fb", size = 45254, upload-time = "2025-06-30T15:53:12.421Z" },
    { url = "https://files.pythonhosted.org/packages/d8/30/9aec301e9772b098c1f5c0ca0279237c9766d94b97802e9888010c64b0ed/multidict-6.6.3-py3-none-any.whl", hash = "sha256:8db10f29c7541fc5da4defd8cd697e1ca429db743fa716325f236079b96f775a", size = 12313, upload-time = "2025-06-30T15:53:45.437Z" },
]

[[package]]
name = "openai"
version = "1.93.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "anyio" },
    { name = "distro" },
    { name = "httpx" },
    { name = "jiter" },
    { name = "pydantic" },
    { name = "sniffio" },
    { name = "tqdm" },
    { name = "typing-extensions" },
]
sdist = { url = "https://files.pythonhosted.org/packages/e4/d7/e91c6a9cf71726420cddf539852ee4c29176ebb716a702d9118d0409fd8e/openai-1.93.0.tar.gz", hash = "sha256:988f31ade95e1ff0585af11cc5a64510225e4f5cd392698c675d0a9265b8e337", size = 486573, upload-time = "2025-06-27T21:21:39.421Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/64/46/a10d9df4673df56f71201d129ba1cb19eaff3366d08c8664d61a7df52e65/openai-1.93.0-py3-none-any.whl", hash = "sha256:3d746fe5498f0dd72e0d9ab706f26c91c0f646bf7459e5629af8ba7c9dbdf090", size = 755038, upload-time = "2025-06-27T21:21:37.532Z" },
]

[[package]]
name = "packaging"
version = "25.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/a1/d4/1fc4078c65507b51b96ca8f8c3ba19e6a61c8253c72794544580a7b6c24d/packaging-25.0.tar.gz", hash = "sha256:d443872c98d677bf60f6a1f2f8c1cb748e8fe762d2bf9d3148b5599295b0fc4f", size = 165727, upload-time = "2025-04-19T11:48:59.673Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/20/12/38679034af332785aac8774540895e234f4d07f7545804097de4b666afd8/packaging-25.0-py3-none-any.whl", hash = "sha256:29572ef2b1f17581046b3a2227d5c611fb25ec70ca1ba8554b24b0e69331a484", size = 66469, upload-time = "2025-04-19T11:48:57.875Z" },
]

[[package]]
name = "pluggy"
version = "1.6.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f9/e2/3e91f31a7d2b083fe6ef3fa267035b518369d9511ffab804f839851d2779/pluggy-1.6.0.tar.gz", hash = "sha256:7dcc130b76258d33b90f61b658791dede3486c3e6bfb003ee5c9bfb396dd22f3", size = 69412, upload-time = "2025-05-15T12:30:07.975Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/54/20/4d324d65cc6d9205fabedc306948156824eb9f0ee1633355a8f7ec5c66bf/pluggy-1.6.0-py3-none-any.whl", hash = "sha256:e920276dd6813095e9377c0bc5566d94c932c33b27a3e3945d8389c374dd4746", size = 20538, upload-time = "2025-05-15T12:30:06.134Z" },
]

[[package]]
name = "postgrest"
version = "1.1.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "deprecation" },
    { name = "httpx", extra = ["http2"] },
    { name = "pydantic" },
]
sdist = { url = "https://files.pythonhosted.org/packages/6e/3e/1b50568e1f5db0bdced4a82c7887e37326585faef7ca43ead86849cb4861/postgrest-1.1.1.tar.gz", hash = "sha256:f3bb3e8c4602775c75c844a31f565f5f3dd584df4d36d683f0b67d01a86be322", size = 15431, upload-time = "2025-06-23T19:21:34.742Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a4/71/188a50ea64c17f73ff4df5196ec1553a8f1723421eb2d1069c73bab47d78/postgrest-1.1.1-py3-none-any.whl", hash = "sha256:98a6035ee1d14288484bfe36235942c5fb2d26af6d8120dfe3efbe007859251a", size = 22366, upload-time = "2025-06-23T19:21:33.637Z" },
]

[[package]]
name = "prometheus-client"
version = "0.22.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/5e/cf/40dde0a2be27cc1eb41e333d1a674a74ce8b8b0457269cc640fd42b07cf7/prometheus_client-0.22.1.tar.gz", hash = "sha256:190f1331e783cf21eb60bca559354e0a4d4378facecf78f5428c39b675d20d28", size = 69746, upload-time = "2025-06-02T14:29:01.152Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/32/ae/ec06af4fe3ee72d16973474f122541746196aaa16cea6f66d18b963c6177/prometheus_client-0.22.1-py3-none-any.whl", hash = "sha256:cca895342e308174341b2cbf99a56bef291fbc0ef7b9e5412a0f26d653ba7094", size = 58694, upload-time = "2025-06-02T14:29:00.068Z" },
]

[[package]]
name = "propcache"
version = "0.3.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/a6/16/43264e4a779dd8588c21a70f0709665ee8f611211bdd2c87d952cfa7c776/propcache-0.3.2.tar.gz", hash = "sha256:20d7d62e4e7ef05f221e0db2856b979540686342e7dd9973b815599c7057e168", size = 44139, upload-time = "2025-06-09T22:56:06.081Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a8/42/9ca01b0a6f48e81615dca4765a8f1dd2c057e0540f6116a27dc5ee01dfb6/propcache-0.3.2-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:8de106b6c84506b31c27168582cd3cb3000a6412c16df14a8628e5871ff83c10", size = 73674, upload-time = "2025-06-09T22:54:30.551Z" },
    { url = "https://files.pythonhosted.org/packages/af/6e/21293133beb550f9c901bbece755d582bfaf2176bee4774000bd4dd41884/propcache-0.3.2-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:28710b0d3975117239c76600ea351934ac7b5ff56e60953474342608dbbb6154", size = 43570, upload-time = "2025-06-09T22:54:32.296Z" },
    { url = "https://files.pythonhosted.org/packages/0c/c8/0393a0a3a2b8760eb3bde3c147f62b20044f0ddac81e9d6ed7318ec0d852/propcache-0.3.2-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:ce26862344bdf836650ed2487c3d724b00fbfec4233a1013f597b78c1cb73615", size = 43094, upload-time = "2025-06-09T22:54:33.929Z" },
    { url = "https://files.pythonhosted.org/packages/37/2c/489afe311a690399d04a3e03b069225670c1d489eb7b044a566511c1c498/propcache-0.3.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:bca54bd347a253af2cf4544bbec232ab982f4868de0dd684246b67a51bc6b1db", size = 226958, upload-time = "2025-06-09T22:54:35.186Z" },
    { url = "https://files.pythonhosted.org/packages/9d/ca/63b520d2f3d418c968bf596839ae26cf7f87bead026b6192d4da6a08c467/propcache-0.3.2-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:55780d5e9a2ddc59711d727226bb1ba83a22dd32f64ee15594b9392b1f544eb1", size = 234894, upload-time = "2025-06-09T22:54:36.708Z" },
    { url = "https://files.pythonhosted.org/packages/11/60/1d0ed6fff455a028d678df30cc28dcee7af77fa2b0e6962ce1df95c9a2a9/propcache-0.3.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:035e631be25d6975ed87ab23153db6a73426a48db688070d925aa27e996fe93c", size = 233672, upload-time = "2025-06-09T22:54:38.062Z" },
    { url = "https://files.pythonhosted.org/packages/37/7c/54fd5301ef38505ab235d98827207176a5c9b2aa61939b10a460ca53e123/propcache-0.3.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:ee6f22b6eaa39297c751d0e80c0d3a454f112f5c6481214fcf4c092074cecd67", size = 224395, upload-time = "2025-06-09T22:54:39.634Z" },
    { url = "https://files.pythonhosted.org/packages/ee/1a/89a40e0846f5de05fdc6779883bf46ba980e6df4d2ff8fb02643de126592/propcache-0.3.2-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:7ca3aee1aa955438c4dba34fc20a9f390e4c79967257d830f137bd5a8a32ed3b", size = 212510, upload-time = "2025-06-09T22:54:41.565Z" },
    { url = "https://files.pythonhosted.org/packages/5e/33/ca98368586c9566a6b8d5ef66e30484f8da84c0aac3f2d9aec6d31a11bd5/propcache-0.3.2-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:7a4f30862869fa2b68380d677cc1c5fcf1e0f2b9ea0cf665812895c75d0ca3b8", size = 222949, upload-time = "2025-06-09T22:54:43.038Z" },
    { url = "https://files.pythonhosted.org/packages/ba/11/ace870d0aafe443b33b2f0b7efdb872b7c3abd505bfb4890716ad7865e9d/propcache-0.3.2-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:b77ec3c257d7816d9f3700013639db7491a434644c906a2578a11daf13176251", size = 217258, upload-time = "2025-06-09T22:54:44.376Z" },
    { url = "https://files.pythonhosted.org/packages/5b/d2/86fd6f7adffcfc74b42c10a6b7db721d1d9ca1055c45d39a1a8f2a740a21/propcache-0.3.2-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:cab90ac9d3f14b2d5050928483d3d3b8fb6b4018893fc75710e6aa361ecb2474", size = 213036, upload-time = "2025-06-09T22:54:46.243Z" },
    { url = "https://files.pythonhosted.org/packages/07/94/2d7d1e328f45ff34a0a284cf5a2847013701e24c2a53117e7c280a4316b3/propcache-0.3.2-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:0b504d29f3c47cf6b9e936c1852246c83d450e8e063d50562115a6be6d3a2535", size = 227684, upload-time = "2025-06-09T22:54:47.63Z" },
    { url = "https://files.pythonhosted.org/packages/b7/05/37ae63a0087677e90b1d14710e532ff104d44bc1efa3b3970fff99b891dc/propcache-0.3.2-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:ce2ac2675a6aa41ddb2a0c9cbff53780a617ac3d43e620f8fd77ba1c84dcfc06", size = 234562, upload-time = "2025-06-09T22:54:48.982Z" },
    { url = "https://files.pythonhosted.org/packages/a4/7c/3f539fcae630408d0bd8bf3208b9a647ccad10976eda62402a80adf8fc34/propcache-0.3.2-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:62b4239611205294cc433845b914131b2a1f03500ff3c1ed093ed216b82621e1", size = 222142, upload-time = "2025-06-09T22:54:50.424Z" },
    { url = "https://files.pythonhosted.org/packages/7c/d2/34b9eac8c35f79f8a962546b3e97e9d4b990c420ee66ac8255d5d9611648/propcache-0.3.2-cp312-cp312-win32.whl", hash = "sha256:df4a81b9b53449ebc90cc4deefb052c1dd934ba85012aa912c7ea7b7e38b60c1", size = 37711, upload-time = "2025-06-09T22:54:52.072Z" },
    { url = "https://files.pythonhosted.org/packages/19/61/d582be5d226cf79071681d1b46b848d6cb03d7b70af7063e33a2787eaa03/propcache-0.3.2-cp312-cp312-win_amd64.whl", hash = "sha256:7046e79b989d7fe457bb755844019e10f693752d169076138abf17f31380800c", size = 41479, upload-time = "2025-06-09T22:54:53.234Z" },
    { url = "https://files.pythonhosted.org/packages/dc/d1/8c747fafa558c603c4ca19d8e20b288aa0c7cda74e9402f50f31eb65267e/propcache-0.3.2-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:ca592ed634a73ca002967458187109265e980422116c0a107cf93d81f95af945", size = 71286, upload-time = "2025-06-09T22:54:54.369Z" },
    { url = "https://files.pythonhosted.org/packages/61/99/d606cb7986b60d89c36de8a85d58764323b3a5ff07770a99d8e993b3fa73/propcache-0.3.2-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:9ecb0aad4020e275652ba3975740f241bd12a61f1a784df044cf7477a02bc252", size = 42425, upload-time = "2025-06-09T22:54:55.642Z" },
    { url = "https://files.pythonhosted.org/packages/8c/96/ef98f91bbb42b79e9bb82bdd348b255eb9d65f14dbbe3b1594644c4073f7/propcache-0.3.2-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:7f08f1cc28bd2eade7a8a3d2954ccc673bb02062e3e7da09bc75d843386b342f", size = 41846, upload-time = "2025-06-09T22:54:57.246Z" },
    { url = "https://files.pythonhosted.org/packages/5b/ad/3f0f9a705fb630d175146cd7b1d2bf5555c9beaed54e94132b21aac098a6/propcache-0.3.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:d1a342c834734edb4be5ecb1e9fb48cb64b1e2320fccbd8c54bf8da8f2a84c33", size = 208871, upload-time = "2025-06-09T22:54:58.975Z" },
    { url = "https://files.pythonhosted.org/packages/3a/38/2085cda93d2c8b6ec3e92af2c89489a36a5886b712a34ab25de9fbca7992/propcache-0.3.2-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:8a544caaae1ac73f1fecfae70ded3e93728831affebd017d53449e3ac052ac1e", size = 215720, upload-time = "2025-06-09T22:55:00.471Z" },
    { url = "https://files.pythonhosted.org/packages/61/c1/d72ea2dc83ac7f2c8e182786ab0fc2c7bd123a1ff9b7975bee671866fe5f/propcache-0.3.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:310d11aa44635298397db47a3ebce7db99a4cc4b9bbdfcf6c98a60c8d5261cf1", size = 215203, upload-time = "2025-06-09T22:55:01.834Z" },
    { url = "https://files.pythonhosted.org/packages/af/81/b324c44ae60c56ef12007105f1460d5c304b0626ab0cc6b07c8f2a9aa0b8/propcache-0.3.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:4c1396592321ac83157ac03a2023aa6cc4a3cc3cfdecb71090054c09e5a7cce3", size = 206365, upload-time = "2025-06-09T22:55:03.199Z" },
    { url = "https://files.pythonhosted.org/packages/09/73/88549128bb89e66d2aff242488f62869014ae092db63ccea53c1cc75a81d/propcache-0.3.2-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:8cabf5b5902272565e78197edb682017d21cf3b550ba0460ee473753f28d23c1", size = 196016, upload-time = "2025-06-09T22:55:04.518Z" },
    { url = "https://files.pythonhosted.org/packages/b9/3f/3bdd14e737d145114a5eb83cb172903afba7242f67c5877f9909a20d948d/propcache-0.3.2-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:0a2f2235ac46a7aa25bdeb03a9e7060f6ecbd213b1f9101c43b3090ffb971ef6", size = 205596, upload-time = "2025-06-09T22:55:05.942Z" },
    { url = "https://files.pythonhosted.org/packages/0f/ca/2f4aa819c357d3107c3763d7ef42c03980f9ed5c48c82e01e25945d437c1/propcache-0.3.2-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:92b69e12e34869a6970fd2f3da91669899994b47c98f5d430b781c26f1d9f387", size = 200977, upload-time = "2025-06-09T22:55:07.792Z" },
    { url = "https://files.pythonhosted.org/packages/cd/4a/e65276c7477533c59085251ae88505caf6831c0e85ff8b2e31ebcbb949b1/propcache-0.3.2-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:54e02207c79968ebbdffc169591009f4474dde3b4679e16634d34c9363ff56b4", size = 197220, upload-time = "2025-06-09T22:55:09.173Z" },
    { url = "https://files.pythonhosted.org/packages/7c/54/fc7152e517cf5578278b242396ce4d4b36795423988ef39bb8cd5bf274c8/propcache-0.3.2-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:4adfb44cb588001f68c5466579d3f1157ca07f7504fc91ec87862e2b8e556b88", size = 210642, upload-time = "2025-06-09T22:55:10.62Z" },
    { url = "https://files.pythonhosted.org/packages/b9/80/abeb4a896d2767bf5f1ea7b92eb7be6a5330645bd7fb844049c0e4045d9d/propcache-0.3.2-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:fd3e6019dc1261cd0291ee8919dd91fbab7b169bb76aeef6c716833a3f65d206", size = 212789, upload-time = "2025-06-09T22:55:12.029Z" },
    { url = "https://files.pythonhosted.org/packages/b3/db/ea12a49aa7b2b6d68a5da8293dcf50068d48d088100ac016ad92a6a780e6/propcache-0.3.2-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:4c181cad81158d71c41a2bce88edce078458e2dd5ffee7eddd6b05da85079f43", size = 205880, upload-time = "2025-06-09T22:55:13.45Z" },
    { url = "https://files.pythonhosted.org/packages/d1/e5/9076a0bbbfb65d1198007059c65639dfd56266cf8e477a9707e4b1999ff4/propcache-0.3.2-cp313-cp313-win32.whl", hash = "sha256:8a08154613f2249519e549de2330cf8e2071c2887309a7b07fb56098f5170a02", size = 37220, upload-time = "2025-06-09T22:55:15.284Z" },
    { url = "https://files.pythonhosted.org/packages/d3/f5/b369e026b09a26cd77aa88d8fffd69141d2ae00a2abaaf5380d2603f4b7f/propcache-0.3.2-cp313-cp313-win_amd64.whl", hash = "sha256:e41671f1594fc4ab0a6dec1351864713cb3a279910ae8b58f884a88a0a632c05", size = 40678, upload-time = "2025-06-09T22:55:16.445Z" },
    { url = "https://files.pythonhosted.org/packages/a4/3a/6ece377b55544941a08d03581c7bc400a3c8cd3c2865900a68d5de79e21f/propcache-0.3.2-cp313-cp313t-macosx_10_13_universal2.whl", hash = "sha256:9a3cf035bbaf035f109987d9d55dc90e4b0e36e04bbbb95af3055ef17194057b", size = 76560, upload-time = "2025-06-09T22:55:17.598Z" },
    { url = "https://files.pythonhosted.org/packages/0c/da/64a2bb16418740fa634b0e9c3d29edff1db07f56d3546ca2d86ddf0305e1/propcache-0.3.2-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:156c03d07dc1323d8dacaa221fbe028c5c70d16709cdd63502778e6c3ccca1b0", size = 44676, upload-time = "2025-06-09T22:55:18.922Z" },
    { url = "https://files.pythonhosted.org/packages/36/7b/f025e06ea51cb72c52fb87e9b395cced02786610b60a3ed51da8af017170/propcache-0.3.2-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:74413c0ba02ba86f55cf60d18daab219f7e531620c15f1e23d95563f505efe7e", size = 44701, upload-time = "2025-06-09T22:55:20.106Z" },
    { url = "https://files.pythonhosted.org/packages/a4/00/faa1b1b7c3b74fc277f8642f32a4c72ba1d7b2de36d7cdfb676db7f4303e/propcache-0.3.2-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:f066b437bb3fa39c58ff97ab2ca351db465157d68ed0440abecb21715eb24b28", size = 276934, upload-time = "2025-06-09T22:55:21.5Z" },
    { url = "https://files.pythonhosted.org/packages/74/ab/935beb6f1756e0476a4d5938ff44bf0d13a055fed880caf93859b4f1baf4/propcache-0.3.2-cp313-cp313t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:f1304b085c83067914721e7e9d9917d41ad87696bf70f0bc7dee450e9c71ad0a", size = 278316, upload-time = "2025-06-09T22:55:22.918Z" },
    { url = "https://files.pythonhosted.org/packages/f8/9d/994a5c1ce4389610838d1caec74bdf0e98b306c70314d46dbe4fcf21a3e2/propcache-0.3.2-cp313-cp313t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:ab50cef01b372763a13333b4e54021bdcb291fc9a8e2ccb9c2df98be51bcde6c", size = 282619, upload-time = "2025-06-09T22:55:24.651Z" },
    { url = "https://files.pythonhosted.org/packages/2b/00/a10afce3d1ed0287cef2e09506d3be9822513f2c1e96457ee369adb9a6cd/propcache-0.3.2-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:fad3b2a085ec259ad2c2842666b2a0a49dea8463579c606426128925af1ed725", size = 265896, upload-time = "2025-06-09T22:55:26.049Z" },
    { url = "https://files.pythonhosted.org/packages/2e/a8/2aa6716ffa566ca57c749edb909ad27884680887d68517e4be41b02299f3/propcache-0.3.2-cp313-cp313t-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:261fa020c1c14deafd54c76b014956e2f86991af198c51139faf41c4d5e83892", size = 252111, upload-time = "2025-06-09T22:55:27.381Z" },
    { url = "https://files.pythonhosted.org/packages/36/4f/345ca9183b85ac29c8694b0941f7484bf419c7f0fea2d1e386b4f7893eed/propcache-0.3.2-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:46d7f8aa79c927e5f987ee3a80205c987717d3659f035c85cf0c3680526bdb44", size = 268334, upload-time = "2025-06-09T22:55:28.747Z" },
    { url = "https://files.pythonhosted.org/packages/3e/ca/fcd54f78b59e3f97b3b9715501e3147f5340167733d27db423aa321e7148/propcache-0.3.2-cp313-cp313t-musllinux_1_2_armv7l.whl", hash = "sha256:6d8f3f0eebf73e3c0ff0e7853f68be638b4043c65a70517bb575eff54edd8dbe", size = 255026, upload-time = "2025-06-09T22:55:30.184Z" },
    { url = "https://files.pythonhosted.org/packages/8b/95/8e6a6bbbd78ac89c30c225210a5c687790e532ba4088afb8c0445b77ef37/propcache-0.3.2-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:03c89c1b14a5452cf15403e291c0ccd7751d5b9736ecb2c5bab977ad6c5bcd81", size = 250724, upload-time = "2025-06-09T22:55:31.646Z" },
    { url = "https://files.pythonhosted.org/packages/ee/b0/0dd03616142baba28e8b2d14ce5df6631b4673850a3d4f9c0f9dd714a404/propcache-0.3.2-cp313-cp313t-musllinux_1_2_ppc64le.whl", hash = "sha256:0cc17efde71e12bbaad086d679ce575268d70bc123a5a71ea7ad76f70ba30bba", size = 268868, upload-time = "2025-06-09T22:55:33.209Z" },
    { url = "https://files.pythonhosted.org/packages/c5/98/2c12407a7e4fbacd94ddd32f3b1e3d5231e77c30ef7162b12a60e2dd5ce3/propcache-0.3.2-cp313-cp313t-musllinux_1_2_s390x.whl", hash = "sha256:acdf05d00696bc0447e278bb53cb04ca72354e562cf88ea6f9107df8e7fd9770", size = 271322, upload-time = "2025-06-09T22:55:35.065Z" },
    { url = "https://files.pythonhosted.org/packages/35/91/9cb56efbb428b006bb85db28591e40b7736847b8331d43fe335acf95f6c8/propcache-0.3.2-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:4445542398bd0b5d32df908031cb1b30d43ac848e20470a878b770ec2dcc6330", size = 265778, upload-time = "2025-06-09T22:55:36.45Z" },
    { url = "https://files.pythonhosted.org/packages/9a/4c/b0fe775a2bdd01e176b14b574be679d84fc83958335790f7c9a686c1f468/propcache-0.3.2-cp313-cp313t-win32.whl", hash = "sha256:f86e5d7cd03afb3a1db8e9f9f6eff15794e79e791350ac48a8c924e6f439f394", size = 41175, upload-time = "2025-06-09T22:55:38.436Z" },
    { url = "https://files.pythonhosted.org/packages/a4/ff/47f08595e3d9b5e149c150f88d9714574f1a7cbd89fe2817158a952674bf/propcache-0.3.2-cp313-cp313t-win_amd64.whl", hash = "sha256:9704bedf6e7cbe3c65eca4379a9b53ee6a83749f047808cbb5044d40d7d72198", size = 44857, upload-time = "2025-06-09T22:55:39.687Z" },
    { url = "https://files.pythonhosted.org/packages/cc/35/cc0aaecf278bb4575b8555f2b137de5ab821595ddae9da9d3cd1da4072c7/propcache-0.3.2-py3-none-any.whl", hash = "sha256:98f1ec44fb675f5052cccc8e609c46ed23a35a1cfd18545ad4e29002d858a43f", size = 12663, upload-time = "2025-06-09T22:56:04.484Z" },
]

[[package]]
name = "proto-plus"
version = "1.26.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "protobuf" },
]
sdist = { url = "https://files.pythonhosted.org/packages/f4/ac/87285f15f7cce6d4a008f33f1757fb5a13611ea8914eb58c3d0d26243468/proto_plus-1.26.1.tar.gz", hash = "sha256:21a515a4c4c0088a773899e23c7bbade3d18f9c66c73edd4c7ee3816bc96a012", size = 56142, upload-time = "2025-03-10T15:54:38.843Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/4e/6d/280c4c2ce28b1593a19ad5239c8b826871fc6ec275c21afc8e1820108039/proto_plus-1.26.1-py3-none-any.whl", hash = "sha256:13285478c2dcf2abb829db158e1047e2f1e8d63a077d94263c2b88b043c75a66", size = 50163, upload-time = "2025-03-10T15:54:37.335Z" },
]

[[package]]
name = "protobuf"
version = "5.29.5"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/43/29/d09e70352e4e88c9c7a198d5645d7277811448d76c23b00345670f7c8a38/protobuf-5.29.5.tar.gz", hash = "sha256:bc1463bafd4b0929216c35f437a8e28731a2b7fe3d98bb77a600efced5a15c84", size = 425226, upload-time = "2025-05-28T23:51:59.82Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/5f/11/6e40e9fc5bba02988a214c07cf324595789ca7820160bfd1f8be96e48539/protobuf-5.29.5-cp310-abi3-win32.whl", hash = "sha256:3f1c6468a2cfd102ff4703976138844f78ebd1fb45f49011afc5139e9e283079", size = 422963, upload-time = "2025-05-28T23:51:41.204Z" },
    { url = "https://files.pythonhosted.org/packages/81/7f/73cefb093e1a2a7c3ffd839e6f9fcafb7a427d300c7f8aef9c64405d8ac6/protobuf-5.29.5-cp310-abi3-win_amd64.whl", hash = "sha256:3f76e3a3675b4a4d867b52e4a5f5b78a2ef9565549d4037e06cf7b0942b1d3fc", size = 434818, upload-time = "2025-05-28T23:51:44.297Z" },
    { url = "https://files.pythonhosted.org/packages/dd/73/10e1661c21f139f2c6ad9b23040ff36fee624310dc28fba20d33fdae124c/protobuf-5.29.5-cp38-abi3-macosx_10_9_universal2.whl", hash = "sha256:e38c5add5a311f2a6eb0340716ef9b039c1dfa428b28f25a7838ac329204a671", size = 418091, upload-time = "2025-05-28T23:51:45.907Z" },
    { url = "https://files.pythonhosted.org/packages/6c/04/98f6f8cf5b07ab1294c13f34b4e69b3722bb609c5b701d6c169828f9f8aa/protobuf-5.29.5-cp38-abi3-manylinux2014_aarch64.whl", hash = "sha256:fa18533a299d7ab6c55a238bf8629311439995f2e7eca5caaff08663606e9015", size = 319824, upload-time = "2025-05-28T23:51:47.545Z" },
    { url = "https://files.pythonhosted.org/packages/85/e4/07c80521879c2d15f321465ac24c70efe2381378c00bf5e56a0f4fbac8cd/protobuf-5.29.5-cp38-abi3-manylinux2014_x86_64.whl", hash = "sha256:63848923da3325e1bf7e9003d680ce6e14b07e55d0473253a690c3a8b8fd6e61", size = 319942, upload-time = "2025-05-28T23:51:49.11Z" },
    { url = "https://files.pythonhosted.org/packages/7e/cc/7e77861000a0691aeea8f4566e5d3aa716f2b1dece4a24439437e41d3d25/protobuf-5.29.5-py3-none-any.whl", hash = "sha256:6cf42630262c59b2d8de33954443d94b746c952b01434fc58a417fdbd2e84bd5", size = 172823, upload-time = "2025-05-28T23:51:58.157Z" },
]

[[package]]
name = "psycopg2-binary"
version = "2.9.10"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/cb/0e/bdc8274dc0585090b4e3432267d7be4dfbfd8971c0fa59167c711105a6bf/psycopg2-binary-2.9.10.tar.gz", hash = "sha256:4b3df0e6990aa98acda57d983942eff13d824135fe2250e6522edaa782a06de2", size = 385764, upload-time = "2024-10-16T11:24:58.126Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/49/7d/465cc9795cf76f6d329efdafca74693714556ea3891813701ac1fee87545/psycopg2_binary-2.9.10-cp312-cp312-macosx_12_0_x86_64.whl", hash = "sha256:880845dfe1f85d9d5f7c412efea7a08946a46894537e4e5d091732eb1d34d9a0", size = 3044771, upload-time = "2024-10-16T11:20:35.234Z" },
    { url = "https://files.pythonhosted.org/packages/8b/31/6d225b7b641a1a2148e3ed65e1aa74fc86ba3fee850545e27be9e1de893d/psycopg2_binary-2.9.10-cp312-cp312-macosx_14_0_arm64.whl", hash = "sha256:9440fa522a79356aaa482aa4ba500b65f28e5d0e63b801abf6aa152a29bd842a", size = 3275336, upload-time = "2024-10-16T11:20:38.742Z" },
    { url = "https://files.pythonhosted.org/packages/30/b7/a68c2b4bff1cbb1728e3ec864b2d92327c77ad52edcd27922535a8366f68/psycopg2_binary-2.9.10-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:e3923c1d9870c49a2d44f795df0c889a22380d36ef92440ff618ec315757e539", size = 2851637, upload-time = "2024-10-16T11:20:42.145Z" },
    { url = "https://files.pythonhosted.org/packages/0b/b1/cfedc0e0e6f9ad61f8657fd173b2f831ce261c02a08c0b09c652b127d813/psycopg2_binary-2.9.10-cp312-cp312-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:7b2c956c028ea5de47ff3a8d6b3cc3330ab45cf0b7c3da35a2d6ff8420896526", size = 3082097, upload-time = "2024-10-16T11:20:46.185Z" },
    { url = "https://files.pythonhosted.org/packages/18/ed/0a8e4153c9b769f59c02fb5e7914f20f0b2483a19dae7bf2db54b743d0d0/psycopg2_binary-2.9.10-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:f758ed67cab30b9a8d2833609513ce4d3bd027641673d4ebc9c067e4d208eec1", size = 3264776, upload-time = "2024-10-16T11:20:50.879Z" },
    { url = "https://files.pythonhosted.org/packages/10/db/d09da68c6a0cdab41566b74e0a6068a425f077169bed0946559b7348ebe9/psycopg2_binary-2.9.10-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:8cd9b4f2cfab88ed4a9106192de509464b75a906462fb846b936eabe45c2063e", size = 3020968, upload-time = "2024-10-16T11:20:56.819Z" },
    { url = "https://files.pythonhosted.org/packages/94/28/4d6f8c255f0dfffb410db2b3f9ac5218d959a66c715c34cac31081e19b95/psycopg2_binary-2.9.10-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:6dc08420625b5a20b53551c50deae6e231e6371194fa0651dbe0fb206452ae1f", size = 2872334, upload-time = "2024-10-16T11:21:02.411Z" },
    { url = "https://files.pythonhosted.org/packages/05/f7/20d7bf796593c4fea95e12119d6cc384ff1f6141a24fbb7df5a668d29d29/psycopg2_binary-2.9.10-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:d7cd730dfa7c36dbe8724426bf5612798734bff2d3c3857f36f2733f5bfc7c00", size = 2822722, upload-time = "2024-10-16T11:21:09.01Z" },
    { url = "https://files.pythonhosted.org/packages/4d/e4/0c407ae919ef626dbdb32835a03b6737013c3cc7240169843965cada2bdf/psycopg2_binary-2.9.10-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:155e69561d54d02b3c3209545fb08938e27889ff5a10c19de8d23eb5a41be8a5", size = 2920132, upload-time = "2024-10-16T11:21:16.339Z" },
    { url = "https://files.pythonhosted.org/packages/2d/70/aa69c9f69cf09a01da224909ff6ce8b68faeef476f00f7ec377e8f03be70/psycopg2_binary-2.9.10-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:c3cc28a6fd5a4a26224007712e79b81dbaee2ffb90ff406256158ec4d7b52b47", size = 2959312, upload-time = "2024-10-16T11:21:25.584Z" },
    { url = "https://files.pythonhosted.org/packages/d3/bd/213e59854fafe87ba47814bf413ace0dcee33a89c8c8c814faca6bc7cf3c/psycopg2_binary-2.9.10-cp312-cp312-win32.whl", hash = "sha256:ec8a77f521a17506a24a5f626cb2aee7850f9b69a0afe704586f63a464f3cd64", size = 1025191, upload-time = "2024-10-16T11:21:29.912Z" },
    { url = "https://files.pythonhosted.org/packages/92/29/06261ea000e2dc1e22907dbbc483a1093665509ea586b29b8986a0e56733/psycopg2_binary-2.9.10-cp312-cp312-win_amd64.whl", hash = "sha256:18c5ee682b9c6dd3696dad6e54cc7ff3a1a9020df6a5c0f861ef8bfd338c3ca0", size = 1164031, upload-time = "2024-10-16T11:21:34.211Z" },
    { url = "https://files.pythonhosted.org/packages/3e/30/d41d3ba765609c0763505d565c4d12d8f3c79793f0d0f044ff5a28bf395b/psycopg2_binary-2.9.10-cp313-cp313-macosx_12_0_x86_64.whl", hash = "sha256:26540d4a9a4e2b096f1ff9cce51253d0504dca5a85872c7f7be23be5a53eb18d", size = 3044699, upload-time = "2024-10-16T11:21:42.841Z" },
    { url = "https://files.pythonhosted.org/packages/35/44/257ddadec7ef04536ba71af6bc6a75ec05c5343004a7ec93006bee66c0bc/psycopg2_binary-2.9.10-cp313-cp313-macosx_14_0_arm64.whl", hash = "sha256:e217ce4d37667df0bc1c397fdcd8de5e81018ef305aed9415c3b093faaeb10fb", size = 3275245, upload-time = "2024-10-16T11:21:51.989Z" },
    { url = "https://files.pythonhosted.org/packages/1b/11/48ea1cd11de67f9efd7262085588790a95d9dfcd9b8a687d46caf7305c1a/psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:245159e7ab20a71d989da00f280ca57da7641fa2cdcf71749c193cea540a74f7", size = 2851631, upload-time = "2024-10-16T11:21:57.584Z" },
    { url = "https://files.pythonhosted.org/packages/62/e0/62ce5ee650e6c86719d621a761fe4bc846ab9eff8c1f12b1ed5741bf1c9b/psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3c4ded1a24b20021ebe677b7b08ad10bf09aac197d6943bfe6fec70ac4e4690d", size = 3082140, upload-time = "2024-10-16T11:22:02.005Z" },
    { url = "https://files.pythonhosted.org/packages/27/ce/63f946c098611f7be234c0dd7cb1ad68b0b5744d34f68062bb3c5aa510c8/psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:3abb691ff9e57d4a93355f60d4f4c1dd2d68326c968e7db17ea96df3c023ef73", size = 3264762, upload-time = "2024-10-16T11:22:06.412Z" },
    { url = "https://files.pythonhosted.org/packages/43/25/c603cd81402e69edf7daa59b1602bd41eb9859e2824b8c0855d748366ac9/psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:8608c078134f0b3cbd9f89b34bd60a943b23fd33cc5f065e8d5f840061bd0673", size = 3020967, upload-time = "2024-10-16T11:22:11.583Z" },
    { url = "https://files.pythonhosted.org/packages/5f/d6/8708d8c6fca531057fa170cdde8df870e8b6a9b136e82b361c65e42b841e/psycopg2_binary-2.9.10-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:230eeae2d71594103cd5b93fd29d1ace6420d0b86f4778739cb1a5a32f607d1f", size = 2872326, upload-time = "2024-10-16T11:22:16.406Z" },
    { url = "https://files.pythonhosted.org/packages/ce/ac/5b1ea50fc08a9df82de7e1771537557f07c2632231bbab652c7e22597908/psycopg2_binary-2.9.10-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:bb89f0a835bcfc1d42ccd5f41f04870c1b936d8507c6df12b7737febc40f0909", size = 2822712, upload-time = "2024-10-16T11:22:21.366Z" },
    { url = "https://files.pythonhosted.org/packages/c4/fc/504d4503b2abc4570fac3ca56eb8fed5e437bf9c9ef13f36b6621db8ef00/psycopg2_binary-2.9.10-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:f0c2d907a1e102526dd2986df638343388b94c33860ff3bbe1384130828714b1", size = 2920155, upload-time = "2024-10-16T11:22:25.684Z" },
    { url = "https://files.pythonhosted.org/packages/b2/d1/323581e9273ad2c0dbd1902f3fb50c441da86e894b6e25a73c3fda32c57e/psycopg2_binary-2.9.10-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:f8157bed2f51db683f31306aa497311b560f2265998122abe1dce6428bd86567", size = 2959356, upload-time = "2024-10-16T11:22:30.562Z" },
    { url = "https://files.pythonhosted.org/packages/08/50/d13ea0a054189ae1bc21af1d85b6f8bb9bbc5572991055d70ad9006fe2d6/psycopg2_binary-2.9.10-cp313-cp313-win_amd64.whl", hash = "sha256:27422aa5f11fbcd9b18da48373eb67081243662f9b46e6fd07c3eb46e4535142", size = 2569224, upload-time = "2025-01-04T20:09:19.234Z" },
]

[[package]]
name = "pyasn1"
version = "0.6.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/ba/e9/01f1a64245b89f039897cb0130016d79f77d52669aae6ee7b159a6c4c018/pyasn1-0.6.1.tar.gz", hash = "sha256:6f580d2bdd84365380830acf45550f2511469f673cb4a5ae3857a3170128b034", size = 145322, upload-time = "2024-09-10T22:41:42.55Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/c8/f1/d6a797abb14f6283c0ddff96bbdd46937f64122b8c925cab503dd37f8214/pyasn1-0.6.1-py3-none-any.whl", hash = "sha256:0d632f46f2ba09143da3a8afe9e33fb6f92fa2320ab7e886e2d0f7672af84629", size = 83135, upload-time = "2024-09-11T16:00:36.122Z" },
]

[[package]]
name = "pyasn1-modules"
version = "0.4.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pyasn1" },
]
sdist = { url = "https://files.pythonhosted.org/packages/e9/e6/78ebbb10a8c8e4b61a59249394a4a594c1a7af95593dc933a349c8d00964/pyasn1_modules-0.4.2.tar.gz", hash = "sha256:677091de870a80aae844b1ca6134f54652fa2c8c5a52aa396440ac3106e941e6", size = 307892, upload-time = "2025-03-28T02:41:22.17Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/47/8d/d529b5d697919ba8c11ad626e835d4039be708a35b0d22de83a269a6682c/pyasn1_modules-0.4.2-py3-none-any.whl", hash = "sha256:29253a9207ce32b64c3ac6600edc75368f98473906e8fd1043bd6b5b1de2c14a", size = 181259, upload-time = "2025-03-28T02:41:19.028Z" },
]

[[package]]
name = "pydantic"
version = "2.11.7"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "annotated-types" },
    { name = "pydantic-core" },
    { name = "typing-extensions" },
    { name = "typing-inspection" },
]
sdist = { url = "https://files.pythonhosted.org/packages/00/dd/4325abf92c39ba8623b5af936ddb36ffcfe0beae70405d456ab1fb2f5b8c/pydantic-2.11.7.tar.gz", hash = "sha256:d989c3c6cb79469287b1569f7447a17848c998458d49ebe294e975b9baf0f0db", size = 788350, upload-time = "2025-06-14T08:33:17.137Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/6a/c0/ec2b1c8712ca690e5d61979dee872603e92b8a32f94cc1b72d53beab008a/pydantic-2.11.7-py3-none-any.whl", hash = "sha256:dde5df002701f6de26248661f6835bbe296a47bf73990135c7d07ce741b9623b", size = 444782, upload-time = "2025-06-14T08:33:14.905Z" },
]

[[package]]
name = "pydantic-core"
version = "2.33.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "typing-extensions" },
]
sdist = { url = "https://files.pythonhosted.org/packages/ad/88/5f2260bdfae97aabf98f1778d43f69574390ad787afb646292a638c923d4/pydantic_core-2.33.2.tar.gz", hash = "sha256:7cb8bc3605c29176e1b105350d2e6474142d7c1bd1d9327c4a9bdb46bf827acc", size = 435195, upload-time = "2025-04-23T18:33:52.104Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/18/8a/2b41c97f554ec8c71f2a8a5f85cb56a8b0956addfe8b0efb5b3d77e8bdc3/pydantic_core-2.33.2-cp312-cp312-macosx_10_12_x86_64.whl", hash = "sha256:a7ec89dc587667f22b6a0b6579c249fca9026ce7c333fc142ba42411fa243cdc", size = 2009000, upload-time = "2025-04-23T18:31:25.863Z" },
    { url = "https://files.pythonhosted.org/packages/a1/02/6224312aacb3c8ecbaa959897af57181fb6cf3a3d7917fd44d0f2917e6f2/pydantic_core-2.33.2-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:3c6db6e52c6d70aa0d00d45cdb9b40f0433b96380071ea80b09277dba021ddf7", size = 1847996, upload-time = "2025-04-23T18:31:27.341Z" },
    { url = "https://files.pythonhosted.org/packages/d6/46/6dcdf084a523dbe0a0be59d054734b86a981726f221f4562aed313dbcb49/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:4e61206137cbc65e6d5256e1166f88331d3b6238e082d9f74613b9b765fb9025", size = 1880957, upload-time = "2025-04-23T18:31:28.956Z" },
    { url = "https://files.pythonhosted.org/packages/ec/6b/1ec2c03837ac00886ba8160ce041ce4e325b41d06a034adbef11339ae422/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:eb8c529b2819c37140eb51b914153063d27ed88e3bdc31b71198a198e921e011", size = 1964199, upload-time = "2025-04-23T18:31:31.025Z" },
    { url = "https://files.pythonhosted.org/packages/2d/1d/6bf34d6adb9debd9136bd197ca72642203ce9aaaa85cfcbfcf20f9696e83/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:c52b02ad8b4e2cf14ca7b3d918f3eb0ee91e63b3167c32591e57c4317e134f8f", size = 2120296, upload-time = "2025-04-23T18:31:32.514Z" },
    { url = "https://files.pythonhosted.org/packages/e0/94/2bd0aaf5a591e974b32a9f7123f16637776c304471a0ab33cf263cf5591a/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:96081f1605125ba0855dfda83f6f3df5ec90c61195421ba72223de35ccfb2f88", size = 2676109, upload-time = "2025-04-23T18:31:33.958Z" },
    { url = "https://files.pythonhosted.org/packages/f9/41/4b043778cf9c4285d59742281a769eac371b9e47e35f98ad321349cc5d61/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:8f57a69461af2a5fa6e6bbd7a5f60d3b7e6cebb687f55106933188e79ad155c1", size = 2002028, upload-time = "2025-04-23T18:31:39.095Z" },
    { url = "https://files.pythonhosted.org/packages/cb/d5/7bb781bf2748ce3d03af04d5c969fa1308880e1dca35a9bd94e1a96a922e/pydantic_core-2.33.2-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:572c7e6c8bb4774d2ac88929e3d1f12bc45714ae5ee6d9a788a9fb35e60bb04b", size = 2100044, upload-time = "2025-04-23T18:31:41.034Z" },
    { url = "https://files.pythonhosted.org/packages/fe/36/def5e53e1eb0ad896785702a5bbfd25eed546cdcf4087ad285021a90ed53/pydantic_core-2.33.2-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:db4b41f9bd95fbe5acd76d89920336ba96f03e149097365afe1cb092fceb89a1", size = 2058881, upload-time = "2025-04-23T18:31:42.757Z" },
    { url = "https://files.pythonhosted.org/packages/01/6c/57f8d70b2ee57fc3dc8b9610315949837fa8c11d86927b9bb044f8705419/pydantic_core-2.33.2-cp312-cp312-musllinux_1_1_armv7l.whl", hash = "sha256:fa854f5cf7e33842a892e5c73f45327760bc7bc516339fda888c75ae60edaeb6", size = 2227034, upload-time = "2025-04-23T18:31:44.304Z" },
    { url = "https://files.pythonhosted.org/packages/27/b9/9c17f0396a82b3d5cbea4c24d742083422639e7bb1d5bf600e12cb176a13/pydantic_core-2.33.2-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:5f483cfb75ff703095c59e365360cb73e00185e01aaea067cd19acffd2ab20ea", size = 2234187, upload-time = "2025-04-23T18:31:45.891Z" },
    { url = "https://files.pythonhosted.org/packages/b0/6a/adf5734ffd52bf86d865093ad70b2ce543415e0e356f6cacabbc0d9ad910/pydantic_core-2.33.2-cp312-cp312-win32.whl", hash = "sha256:9cb1da0f5a471435a7bc7e439b8a728e8b61e59784b2af70d7c169f8dd8ae290", size = 1892628, upload-time = "2025-04-23T18:31:47.819Z" },
    { url = "https://files.pythonhosted.org/packages/43/e4/5479fecb3606c1368d496a825d8411e126133c41224c1e7238be58b87d7e/pydantic_core-2.33.2-cp312-cp312-win_amd64.whl", hash = "sha256:f941635f2a3d96b2973e867144fde513665c87f13fe0e193c158ac51bfaaa7b2", size = 1955866, upload-time = "2025-04-23T18:31:49.635Z" },
    { url = "https://files.pythonhosted.org/packages/0d/24/8b11e8b3e2be9dd82df4b11408a67c61bb4dc4f8e11b5b0fc888b38118b5/pydantic_core-2.33.2-cp312-cp312-win_arm64.whl", hash = "sha256:cca3868ddfaccfbc4bfb1d608e2ccaaebe0ae628e1416aeb9c4d88c001bb45ab", size = 1888894, upload-time = "2025-04-23T18:31:51.609Z" },
    { url = "https://files.pythonhosted.org/packages/46/8c/99040727b41f56616573a28771b1bfa08a3d3fe74d3d513f01251f79f172/pydantic_core-2.33.2-cp313-cp313-macosx_10_12_x86_64.whl", hash = "sha256:1082dd3e2d7109ad8b7da48e1d4710c8d06c253cbc4a27c1cff4fbcaa97a9e3f", size = 2015688, upload-time = "2025-04-23T18:31:53.175Z" },
    { url = "https://files.pythonhosted.org/packages/3a/cc/5999d1eb705a6cefc31f0b4a90e9f7fc400539b1a1030529700cc1b51838/pydantic_core-2.33.2-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:f517ca031dfc037a9c07e748cefd8d96235088b83b4f4ba8939105d20fa1dcd6", size = 1844808, upload-time = "2025-04-23T18:31:54.79Z" },
    { url = "https://files.pythonhosted.org/packages/6f/5e/a0a7b8885c98889a18b6e376f344da1ef323d270b44edf8174d6bce4d622/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:0a9f2c9dd19656823cb8250b0724ee9c60a82f3cdf68a080979d13092a3b0fef", size = 1885580, upload-time = "2025-04-23T18:31:57.393Z" },
    { url = "https://files.pythonhosted.org/packages/3b/2a/953581f343c7d11a304581156618c3f592435523dd9d79865903272c256a/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:2b0a451c263b01acebe51895bfb0e1cc842a5c666efe06cdf13846c7418caa9a", size = 1973859, upload-time = "2025-04-23T18:31:59.065Z" },
    { url = "https://files.pythonhosted.org/packages/e6/55/f1a813904771c03a3f97f676c62cca0c0a4138654107c1b61f19c644868b/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:1ea40a64d23faa25e62a70ad163571c0b342b8bf66d5fa612ac0dec4f069d916", size = 2120810, upload-time = "2025-04-23T18:32:00.78Z" },
    { url = "https://files.pythonhosted.org/packages/aa/c3/053389835a996e18853ba107a63caae0b9deb4a276c6b472931ea9ae6e48/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:0fb2d542b4d66f9470e8065c5469ec676978d625a8b7a363f07d9a501a9cb36a", size = 2676498, upload-time = "2025-04-23T18:32:02.418Z" },
    { url = "https://files.pythonhosted.org/packages/eb/3c/f4abd740877a35abade05e437245b192f9d0ffb48bbbbd708df33d3cda37/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:9fdac5d6ffa1b5a83bca06ffe7583f5576555e6c8b3a91fbd25ea7780f825f7d", size = 2000611, upload-time = "2025-04-23T18:32:04.152Z" },
    { url = "https://files.pythonhosted.org/packages/59/a7/63ef2fed1837d1121a894d0ce88439fe3e3b3e48c7543b2a4479eb99c2bd/pydantic_core-2.33.2-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:04a1a413977ab517154eebb2d326da71638271477d6ad87a769102f7c2488c56", size = 2107924, upload-time = "2025-04-23T18:32:06.129Z" },
    { url = "https://files.pythonhosted.org/packages/04/8f/2551964ef045669801675f1cfc3b0d74147f4901c3ffa42be2ddb1f0efc4/pydantic_core-2.33.2-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:c8e7af2f4e0194c22b5b37205bfb293d166a7344a5b0d0eaccebc376546d77d5", size = 2063196, upload-time = "2025-04-23T18:32:08.178Z" },
    { url = "https://files.pythonhosted.org/packages/26/bd/d9602777e77fc6dbb0c7db9ad356e9a985825547dce5ad1d30ee04903918/pydantic_core-2.33.2-cp313-cp313-musllinux_1_1_armv7l.whl", hash = "sha256:5c92edd15cd58b3c2d34873597a1e20f13094f59cf88068adb18947df5455b4e", size = 2236389, upload-time = "2025-04-23T18:32:10.242Z" },
    { url = "https://files.pythonhosted.org/packages/42/db/0e950daa7e2230423ab342ae918a794964b053bec24ba8af013fc7c94846/pydantic_core-2.33.2-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:65132b7b4a1c0beded5e057324b7e16e10910c106d43675d9bd87d4f38dde162", size = 2239223, upload-time = "2025-04-23T18:32:12.382Z" },
    { url = "https://files.pythonhosted.org/packages/58/4d/4f937099c545a8a17eb52cb67fe0447fd9a373b348ccfa9a87f141eeb00f/pydantic_core-2.33.2-cp313-cp313-win32.whl", hash = "sha256:52fb90784e0a242bb96ec53f42196a17278855b0f31ac7c3cc6f5c1ec4811849", size = 1900473, upload-time = "2025-04-23T18:32:14.034Z" },
    { url = "https://files.pythonhosted.org/packages/a0/75/4a0a9bac998d78d889def5e4ef2b065acba8cae8c93696906c3a91f310ca/pydantic_core-2.33.2-cp313-cp313-win_amd64.whl", hash = "sha256:c083a3bdd5a93dfe480f1125926afcdbf2917ae714bdb80b36d34318b2bec5d9", size = 1955269, upload-time = "2025-04-23T18:32:15.783Z" },
    { url = "https://files.pythonhosted.org/packages/f9/86/1beda0576969592f1497b4ce8e7bc8cbdf614c352426271b1b10d5f0aa64/pydantic_core-2.33.2-cp313-cp313-win_arm64.whl", hash = "sha256:e80b087132752f6b3d714f041ccf74403799d3b23a72722ea2e6ba2e892555b9", size = 1893921, upload-time = "2025-04-23T18:32:18.473Z" },
    { url = "https://files.pythonhosted.org/packages/a4/7d/e09391c2eebeab681df2b74bfe6c43422fffede8dc74187b2b0bf6fd7571/pydantic_core-2.33.2-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:61c18fba8e5e9db3ab908620af374db0ac1baa69f0f32df4f61ae23f15e586ac", size = 1806162, upload-time = "2025-04-23T18:32:20.188Z" },
    { url = "https://files.pythonhosted.org/packages/f1/3d/847b6b1fed9f8ed3bb95a9ad04fbd0b212e832d4f0f50ff4d9ee5a9f15cf/pydantic_core-2.33.2-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:95237e53bb015f67b63c91af7518a62a8660376a6a0db19b89acc77a4d6199f5", size = 1981560, upload-time = "2025-04-23T18:32:22.354Z" },
    { url = "https://files.pythonhosted.org/packages/6f/9a/e73262f6c6656262b5fdd723ad90f518f579b7bc8622e43a942eec53c938/pydantic_core-2.33.2-cp313-cp313t-win_amd64.whl", hash = "sha256:c2fc0a768ef76c15ab9238afa6da7f69895bb5d1ee83aeea2e3509af4472d0b9", size = 1935777, upload-time = "2025-04-23T18:32:25.088Z" },
]

[[package]]
name = "pydantic-settings"
version = "2.10.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pydantic" },
    { name = "python-dotenv" },
    { name = "typing-inspection" },
]
sdist = { url = "https://files.pythonhosted.org/packages/68/85/1ea668bbab3c50071ca613c6ab30047fb36ab0da1b92fa8f17bbc38fd36c/pydantic_settings-2.10.1.tar.gz", hash = "sha256:06f0062169818d0f5524420a360d632d5857b83cffd4d42fe29597807a1614ee", size = 172583, upload-time = "2025-06-24T13:26:46.841Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/58/f0/427018098906416f580e3cf1366d3b1abfb408a0652e9f31600c24a1903c/pydantic_settings-2.10.1-py3-none-any.whl", hash = "sha256:a60952460b99cf661dc25c29c0ef171721f98bfcb52ef8d9ea4c943d7c8cc796", size = 45235, upload-time = "2025-06-24T13:26:45.485Z" },
]

[[package]]
name = "pygments"
version = "2.19.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/b0/77/a5b8c569bf593b0140bde72ea885a803b82086995367bf2037de0159d924/pygments-2.19.2.tar.gz", hash = "sha256:636cb2477cec7f8952536970bc533bc43743542f70392ae026374600add5b887", size = 4968631, upload-time = "2025-06-21T13:39:12.283Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/c7/21/705964c7812476f378728bdf590ca4b771ec72385c533964653c68e86bdc/pygments-2.19.2-py3-none-any.whl", hash = "sha256:86540386c03d588bb81d44bc3928634ff26449851e99741617ecb9037ee5ec0b", size = 1225217, upload-time = "2025-06-21T13:39:07.939Z" },
]

[[package]]
name = "pyjwt"
version = "2.10.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/e7/46/bd74733ff231675599650d3e47f361794b22ef3e3770998dda30d3b63726/pyjwt-2.10.1.tar.gz", hash = "sha256:3cc5772eb20009233caf06e9d8a0577824723b44e6648ee0a2aedb6cf9381953", size = 87785, upload-time = "2024-11-28T03:43:29.933Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/61/ad/689f02752eeec26aed679477e80e632ef1b682313be70793d798c1d5fc8f/PyJWT-2.10.1-py3-none-any.whl", hash = "sha256:dcdd193e30abefd5debf142f9adfcdd2b58004e644f25406ffaebd50bd98dacb", size = 22997, upload-time = "2024-11-28T03:43:27.893Z" },
]

[[package]]
name = "pyparsing"
version = "3.2.3"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/bb/22/f1129e69d94ffff626bdb5c835506b3a5b4f3d070f17ea295e12c2c6f60f/pyparsing-3.2.3.tar.gz", hash = "sha256:b9c13f1ab8b3b542f72e28f634bad4de758ab3ce4546e4301970ad6fa77c38be", size = 1088608, upload-time = "2025-03-25T05:01:28.114Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/05/e7/df2285f3d08fee213f2d041540fa4fc9ca6c2d44cf36d3a035bf2a8d2bcc/pyparsing-3.2.3-py3-none-any.whl", hash = "sha256:a749938e02d6fd0b59b356ca504a24982314bb090c383e3cf201c95ef7e2bfcf", size = 111120, upload-time = "2025-03-25T05:01:24.908Z" },
]

[[package]]
name = "pytest"
version = "8.4.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
    { name = "iniconfig" },
    { name = "packaging" },
    { name = "pluggy" },
    { name = "pygments" },
]
sdist = { url = "https://files.pythonhosted.org/packages/08/ba/45911d754e8eba3d5a841a5ce61a65a685ff1798421ac054f85aa8747dfb/pytest-8.4.1.tar.gz", hash = "sha256:7c67fd69174877359ed9371ec3af8a3d2b04741818c51e5e99cc1742251fa93c", size = 1517714, upload-time = "2025-06-18T05:48:06.109Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/29/16/c8a903f4c4dffe7a12843191437d7cd8e32751d5de349d45d3fe69544e87/pytest-8.4.1-py3-none-any.whl", hash = "sha256:539c70ba6fcead8e78eebbf1115e8b589e7565830d7d006a8723f19ac8a0afb7", size = 365474, upload-time = "2025-06-18T05:48:03.955Z" },
]

[[package]]
name = "pytest-asyncio"
version = "1.0.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pytest" },
]
sdist = { url = "https://files.pythonhosted.org/packages/d0/d4/14f53324cb1a6381bef29d698987625d80052bb33932d8e7cbf9b337b17c/pytest_asyncio-1.0.0.tar.gz", hash = "sha256:d15463d13f4456e1ead2594520216b225a16f781e144f8fdf6c5bb4667c48b3f", size = 46960, upload-time = "2025-05-26T04:54:40.484Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/30/05/ce271016e351fddc8399e546f6e23761967ee09c8c568bbfbecb0c150171/pytest_asyncio-1.0.0-py3-none-any.whl", hash = "sha256:4f024da9f1ef945e680dc68610b52550e36590a67fd31bb3b4943979a1f90ef3", size = 15976, upload-time = "2025-05-26T04:54:39.035Z" },
]

[[package]]
name = "pytest-cov"
version = "6.2.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "coverage" },
    { name = "pluggy" },
    { name = "pytest" },
]
sdist = { url = "https://files.pythonhosted.org/packages/18/99/668cade231f434aaa59bbfbf49469068d2ddd945000621d3d165d2e7dd7b/pytest_cov-6.2.1.tar.gz", hash = "sha256:25cc6cc0a5358204b8108ecedc51a9b57b34cc6b8c967cc2c01a4e00d8a67da2", size = 69432, upload-time = "2025-06-12T10:47:47.684Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/bc/16/4ea354101abb1287856baa4af2732be351c7bee728065aed451b678153fd/pytest_cov-6.2.1-py3-none-any.whl", hash = "sha256:f5bc4c23f42f1cdd23c70b1dab1bbaef4fc505ba950d53e0081d0730dd7e86d5", size = 24644, upload-time = "2025-06-12T10:47:45.932Z" },
]

[[package]]
name = "pytest-mock"
version = "3.14.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pytest" },
]
sdist = { url = "https://files.pythonhosted.org/packages/71/28/67172c96ba684058a4d24ffe144d64783d2a270d0af0d9e792737bddc75c/pytest_mock-3.14.1.tar.gz", hash = "sha256:159e9edac4c451ce77a5cdb9fc5d1100708d2dd4ba3c3df572f14097351af80e", size = 33241, upload-time = "2025-05-26T13:58:45.167Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b2/05/77b60e520511c53d1c1ca75f1930c7dd8e971d0c4379b7f4b3f9644685ba/pytest_mock-3.14.1-py3-none-any.whl", hash = "sha256:178aefcd11307d874b4cd3100344e7e2d888d9791a6a1d9bfe90fbc1b74fd1d0", size = 9923, upload-time = "2025-05-26T13:58:43.487Z" },
]

[[package]]
name = "python-dateutil"
version = "2.9.0.post0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "six" },
]
sdist = { url = "https://files.pythonhosted.org/packages/66/c0/0c8b6ad9f17a802ee498c46e004a0eb49bc148f2fd230864601a86dcf6db/python-dateutil-2.9.0.post0.tar.gz", hash = "sha256:37dd54208da7e1cd875388217d5e00ebd4179249f90fb72437e91a35459a0ad3", size = 342432, upload-time = "2024-03-01T18:36:20.211Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/ec/57/56b9bcc3c9c6a792fcbaf139543cee77261f3651ca9da0c93f5c1221264b/python_dateutil-2.9.0.post0-py2.py3-none-any.whl", hash = "sha256:a8b2bc7bffae282281c8140a97d3aa9c14da0b136dfe83f850eea9a5f7470427", size = 229892, upload-time = "2024-03-01T18:36:18.57Z" },
]

[[package]]
name = "python-dotenv"
version = "1.1.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f6/b0/4bc07ccd3572a2f9df7e6782f52b0c6c90dcbb803ac4a167702d7d0dfe1e/python_dotenv-1.1.1.tar.gz", hash = "sha256:a8a6399716257f45be6a007360200409fce5cda2661e3dec71d23dc15f6189ab", size = 41978, upload-time = "2025-06-24T04:21:07.341Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/5f/ed/539768cf28c661b5b068d66d96a2f155c4971a5d55684a514c1a0e0dec2f/python_dotenv-1.1.1-py3-none-any.whl", hash = "sha256:31f23644fe2602f88ff55e1f5c79ba497e01224ee7737937930c448e4d0e24dc", size = 20556, upload-time = "2025-06-24T04:21:06.073Z" },
]

[[package]]
name = "python-multipart"
version = "0.0.20"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f3/87/f44d7c9f274c7ee665a29b885ec97089ec5dc034c7f3fafa03da9e39a09e/python_multipart-0.0.20.tar.gz", hash = "sha256:8dd0cab45b8e23064ae09147625994d090fa46f5b0d1e13af944c331a7fa9d13", size = 37158, upload-time = "2024-12-16T19:45:46.972Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/45/58/38b5afbc1a800eeea951b9285d3912613f2603bdf897a4ab0f4bd7f405fc/python_multipart-0.0.20-py3-none-any.whl", hash = "sha256:8a62d3a8335e06589fe01f2a3e178cdcc632f3fbe0d492ad9ee0ec35aab1f104", size = 24546, upload-time = "2024-12-16T19:45:44.423Z" },
]

[[package]]
name = "pyyaml"
version = "6.0.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/54/ed/79a089b6be93607fa5cdaedf301d7dfb23af5f25c398d5ead2525b063e17/pyyaml-6.0.2.tar.gz", hash = "sha256:d584d9ec91ad65861cc08d42e834324ef890a082e591037abe114850ff7bbc3e", size = 130631, upload-time = "2024-08-06T20:33:50.674Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/86/0c/c581167fc46d6d6d7ddcfb8c843a4de25bdd27e4466938109ca68492292c/PyYAML-6.0.2-cp312-cp312-macosx_10_9_x86_64.whl", hash = "sha256:c70c95198c015b85feafc136515252a261a84561b7b1d51e3384e0655ddf25ab", size = 183873, upload-time = "2024-08-06T20:32:25.131Z" },
    { url = "https://files.pythonhosted.org/packages/a8/0c/38374f5bb272c051e2a69281d71cba6fdb983413e6758b84482905e29a5d/PyYAML-6.0.2-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:ce826d6ef20b1bc864f0a68340c8b3287705cae2f8b4b1d932177dcc76721725", size = 173302, upload-time = "2024-08-06T20:32:26.511Z" },
    { url = "https://files.pythonhosted.org/packages/c3/93/9916574aa8c00aa06bbac729972eb1071d002b8e158bd0e83a3b9a20a1f7/PyYAML-6.0.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:1f71ea527786de97d1a0cc0eacd1defc0985dcf6b3f17bb77dcfc8c34bec4dc5", size = 739154, upload-time = "2024-08-06T20:32:28.363Z" },
    { url = "https://files.pythonhosted.org/packages/95/0f/b8938f1cbd09739c6da569d172531567dbcc9789e0029aa070856f123984/PyYAML-6.0.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:9b22676e8097e9e22e36d6b7bda33190d0d400f345f23d4065d48f4ca7ae0425", size = 766223, upload-time = "2024-08-06T20:32:30.058Z" },
    { url = "https://files.pythonhosted.org/packages/b9/2b/614b4752f2e127db5cc206abc23a8c19678e92b23c3db30fc86ab731d3bd/PyYAML-6.0.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:80bab7bfc629882493af4aa31a4cfa43a4c57c83813253626916b8c7ada83476", size = 767542, upload-time = "2024-08-06T20:32:31.881Z" },
    { url = "https://files.pythonhosted.org/packages/d4/00/dd137d5bcc7efea1836d6264f049359861cf548469d18da90cd8216cf05f/PyYAML-6.0.2-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:0833f8694549e586547b576dcfaba4a6b55b9e96098b36cdc7ebefe667dfed48", size = 731164, upload-time = "2024-08-06T20:32:37.083Z" },
    { url = "https://files.pythonhosted.org/packages/c9/1f/4f998c900485e5c0ef43838363ba4a9723ac0ad73a9dc42068b12aaba4e4/PyYAML-6.0.2-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:8b9c7197f7cb2738065c481a0461e50ad02f18c78cd75775628afb4d7137fb3b", size = 756611, upload-time = "2024-08-06T20:32:38.898Z" },
    { url = "https://files.pythonhosted.org/packages/df/d1/f5a275fdb252768b7a11ec63585bc38d0e87c9e05668a139fea92b80634c/PyYAML-6.0.2-cp312-cp312-win32.whl", hash = "sha256:ef6107725bd54b262d6dedcc2af448a266975032bc85ef0172c5f059da6325b4", size = 140591, upload-time = "2024-08-06T20:32:40.241Z" },
    { url = "https://files.pythonhosted.org/packages/0c/e8/4f648c598b17c3d06e8753d7d13d57542b30d56e6c2dedf9c331ae56312e/PyYAML-6.0.2-cp312-cp312-win_amd64.whl", hash = "sha256:7e7401d0de89a9a855c839bc697c079a4af81cf878373abd7dc625847d25cbd8", size = 156338, upload-time = "2024-08-06T20:32:41.93Z" },
    { url = "https://files.pythonhosted.org/packages/ef/e3/3af305b830494fa85d95f6d95ef7fa73f2ee1cc8ef5b495c7c3269fb835f/PyYAML-6.0.2-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:efdca5630322a10774e8e98e1af481aad470dd62c3170801852d752aa7a783ba", size = 181309, upload-time = "2024-08-06T20:32:43.4Z" },
    { url = "https://files.pythonhosted.org/packages/45/9f/3b1c20a0b7a3200524eb0076cc027a970d320bd3a6592873c85c92a08731/PyYAML-6.0.2-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:50187695423ffe49e2deacb8cd10510bc361faac997de9efef88badc3bb9e2d1", size = 171679, upload-time = "2024-08-06T20:32:44.801Z" },
    { url = "https://files.pythonhosted.org/packages/7c/9a/337322f27005c33bcb656c655fa78325b730324c78620e8328ae28b64d0c/PyYAML-6.0.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:0ffe8360bab4910ef1b9e87fb812d8bc0a308b0d0eef8c8f44e0254ab3b07133", size = 733428, upload-time = "2024-08-06T20:32:46.432Z" },
    { url = "https://files.pythonhosted.org/packages/a3/69/864fbe19e6c18ea3cc196cbe5d392175b4cf3d5d0ac1403ec3f2d237ebb5/PyYAML-6.0.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:17e311b6c678207928d649faa7cb0d7b4c26a0ba73d41e99c4fff6b6c3276484", size = 763361, upload-time = "2024-08-06T20:32:51.188Z" },
    { url = "https://files.pythonhosted.org/packages/04/24/b7721e4845c2f162d26f50521b825fb061bc0a5afcf9a386840f23ea19fa/PyYAML-6.0.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:70b189594dbe54f75ab3a1acec5f1e3faa7e8cf2f1e08d9b561cb41b845f69d5", size = 759523, upload-time = "2024-08-06T20:32:53.019Z" },
    { url = "https://files.pythonhosted.org/packages/2b/b2/e3234f59ba06559c6ff63c4e10baea10e5e7df868092bf9ab40e5b9c56b6/PyYAML-6.0.2-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:41e4e3953a79407c794916fa277a82531dd93aad34e29c2a514c2c0c5fe971cc", size = 726660, upload-time = "2024-08-06T20:32:54.708Z" },
    { url = "https://files.pythonhosted.org/packages/fe/0f/25911a9f080464c59fab9027482f822b86bf0608957a5fcc6eaac85aa515/PyYAML-6.0.2-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:68ccc6023a3400877818152ad9a1033e3db8625d899c72eacb5a668902e4d652", size = 751597, upload-time = "2024-08-06T20:32:56.985Z" },
    { url = "https://files.pythonhosted.org/packages/14/0d/e2c3b43bbce3cf6bd97c840b46088a3031085179e596d4929729d8d68270/PyYAML-6.0.2-cp313-cp313-win32.whl", hash = "sha256:bc2fa7c6b47d6bc618dd7fb02ef6fdedb1090ec036abab80d4681424b84c1183", size = 140527, upload-time = "2024-08-06T20:33:03.001Z" },
    { url = "https://files.pythonhosted.org/packages/fa/de/02b54f42487e3d3c6efb3f89428677074ca7bf43aae402517bc7cca949f3/PyYAML-6.0.2-cp313-cp313-win_amd64.whl", hash = "sha256:8388ee1976c416731879ac16da0aff3f63b286ffdd57cdeb95f3f2e085687563", size = 156446, upload-time = "2024-08-06T20:33:04.33Z" },
]

[[package]]
name = "realtime"
version = "2.5.3"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "typing-extensions" },
    { name = "websockets" },
]
sdist = { url = "https://files.pythonhosted.org/packages/48/94/3cf962b814303a1688eece56a94b25a7bd423d60705f1124cba0896c9c07/realtime-2.5.3.tar.gz", hash = "sha256:0587594f3bc1c84bf007ff625075b86db6528843e03250dc84f4f2808be3d99a", size = 18527, upload-time = "2025-06-26T22:39:01.59Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/fe/2a/f69c156a58d44b7b9ca22dab181b91e4d93d074f99923c75907bf3953d40/realtime-2.5.3-py3-none-any.whl", hash = "sha256:eb0994636946eff04c4c7f044f980c8c633c7eb632994f549f61053a474ac970", size = 21784, upload-time = "2025-06-26T22:38:59.98Z" },
]

[[package]]
name = "requests"
version = "2.32.4"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "certifi" },
    { name = "charset-normalizer" },
    { name = "idna" },
    { name = "urllib3" },
]
sdist = { url = "https://files.pythonhosted.org/packages/e1/0a/929373653770d8a0d7ea76c37de6e41f11eb07559b103b1c02cafb3f7cf8/requests-2.32.4.tar.gz", hash = "sha256:27d0316682c8a29834d3264820024b62a36942083d52caf2f14c0591336d3422", size = 135258, upload-time = "2025-06-09T16:43:07.34Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/7c/e4/56027c4a6b4ae70ca9de302488c5ca95ad4a39e190093d6c1a8ace08341b/requests-2.32.4-py3-none-any.whl", hash = "sha256:27babd3cda2a6d50b30443204ee89830707d396671944c998b5975b031ac2b2c", size = 64847, upload-time = "2025-06-09T16:43:05.728Z" },
]

[[package]]
name = "rsa"
version = "4.9.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pyasn1" },
]
sdist = { url = "https://files.pythonhosted.org/packages/da/8a/22b7beea3ee0d44b1916c0c1cb0ee3af23b700b6da9f04991899d0c555d4/rsa-4.9.1.tar.gz", hash = "sha256:e7bdbfdb5497da4c07dfd35530e1a902659db6ff241e39d9953cad06ebd0ae75", size = 29034, upload-time = "2025-04-16T09:51:18.218Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/64/8d/0133e4eb4beed9e425d9a98ed6e081a55d195481b7632472be1af08d2f6b/rsa-4.9.1-py3-none-any.whl", hash = "sha256:68635866661c6836b8d39430f97a996acbd61bfa49406748ea243539fe239762", size = 34696, upload-time = "2025-04-16T09:51:17.142Z" },
]

[[package]]
name = "six"
version = "1.17.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/94/e7/b2c673351809dca68a0e064b6af791aa332cf192da575fd474ed7d6f16a2/six-1.17.0.tar.gz", hash = "sha256:ff70335d468e7eb6ec65b95b99d3a2836546063f63acc5171de367e834932a81", size = 34031, upload-time = "2024-12-04T17:35:28.174Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b7/ce/149a00dd41f10bc29e5921b496af8b574d8413afcd5e30dfa0ed46c2cc5e/six-1.17.0-py2.py3-none-any.whl", hash = "sha256:4721f391ed90541fddacab5acf947aa0d3dc7d27b2e1e8eda2be8970586c3274", size = 11050, upload-time = "2024-12-04T17:35:26.475Z" },
]

[[package]]
name = "sniffio"
version = "1.3.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/a2/87/a6771e1546d97e7e041b6ae58d80074f81b7d5121207425c964ddf5cfdbd/sniffio-1.3.1.tar.gz", hash = "sha256:f4324edc670a0f49750a81b895f35c3adb843cca46f0530f79fc1babb23789dc", size = 20372, upload-time = "2024-02-25T23:20:04.057Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/e9/44/75a9c9421471a6c4805dbf2356f7c181a29c1879239abab1ea2cc8f38b40/sniffio-1.3.1-py3-none-any.whl", hash = "sha256:2f6da418d1f1e0fddd844478f41680e794e6051915791a034ff65e5f100525a2", size = 10235, upload-time = "2024-02-25T23:20:01.196Z" },
]

[[package]]
name = "starlette"
version = "0.46.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "anyio" },
]
sdist = { url = "https://files.pythonhosted.org/packages/ce/20/08dfcd9c983f6a6f4a1000d934b9e6d626cff8d2eeb77a89a68eef20a2b7/starlette-0.46.2.tar.gz", hash = "sha256:7f7361f34eed179294600af672f565727419830b54b7b084efe44bb82d2fccd5", size = 2580846, upload-time = "2025-04-13T13:56:17.942Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/8b/0c/9d30a4ebeb6db2b25a841afbb80f6ef9a854fc3b41be131d249a977b4959/starlette-0.46.2-py3-none-any.whl", hash = "sha256:595633ce89f8ffa71a015caed34a5b2dc1c0cdb3f0f1fbd1e69339cf2abeec35", size = 72037, upload-time = "2025-04-13T13:56:16.21Z" },
]

[[package]]
name = "storage3"
version = "0.12.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "deprecation" },
    { name = "httpx", extra = ["http2"] },
    { name = "python-dateutil" },
]
sdist = { url = "https://files.pythonhosted.org/packages/c5/86/9eae84e8ad4ba73f575f3eaf5536d949f2fd7d6adc85829f9af04bce97e2/storage3-0.12.0.tar.gz", hash = "sha256:94243f20922d57738bf42e96b9f5582b4d166e8bf209eccf20b146909f3f71b0", size = 10024, upload-time = "2025-06-19T17:50:51.763Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b0/7e/693d6d603db142eb5e6f3cb76eb6e9c439582b7539e2695e175e2de3ac44/storage3-0.12.0-py3-none-any.whl", hash = "sha256:1c4585693ca42243ded1512b58e54c697111e91a20916cd14783eebc37e7c87d", size = 18422, upload-time = "2025-06-19T17:50:50.294Z" },
]

[[package]]
name = "strenum"
version = "0.4.15"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/85/ad/430fb60d90e1d112a62ff57bdd1f286ec73a2a0331272febfddd21f330e1/StrEnum-0.4.15.tar.gz", hash = "sha256:878fb5ab705442070e4dd1929bb5e2249511c0bcf2b0eeacf3bcd80875c82eff", size = 23384, upload-time = "2023-06-29T22:02:58.399Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/81/69/297302c5f5f59c862faa31e6cb9a4cd74721cd1e052b38e464c5b402df8b/StrEnum-0.4.15-py3-none-any.whl", hash = "sha256:a30cda4af7cc6b5bf52c8055bc4bf4b2b6b14a93b574626da33df53cf7740659", size = 8851, upload-time = "2023-06-29T22:02:56.947Z" },
]

[[package]]
name = "study-scriber"
version = "0.1.0"
source = { virtual = "." }
dependencies = [
    { name = "aiofiles" },
    { name = "aiohttp" },
    { name = "fastapi" },
    { name = "google-generativeai" },
    { name = "gotrue" },
    { name = "httpx" },
    { name = "loguru" },
    { name = "openai" },
    { name = "postgrest" },
    { name = "prometheus-client" },
    { name = "psycopg2-binary" },
    { name = "pydantic" },
    { name = "pydantic-settings" },
    { name = "pytest" },
    { name = "pytest-asyncio" },
    { name = "python-dotenv" },
    { name = "python-multipart" },
    { name = "realtime" },
    { name = "storage3" },
    { name = "supabase" },
    { name = "uvicorn", extra = ["standard"] },
    { name = "uvloop" },
]

[package.optional-dependencies]
dev = [
    { name = "pytest" },
    { name = "pytest-asyncio" },
    { name = "pytest-cov" },
]

[package.metadata]
requires-dist = [
    { name = "aiofiles" },
    { name = "aiohttp" },
    { name = "fastapi" },
    { name = "google-generativeai" },
    { name = "gotrue" },
    { name = "httpx" },
    { name = "loguru" },
    { name = "openai" },
    { name = "postgrest" },
    { name = "prometheus-client" },
    { name = "psycopg2-binary" },
    { name = "pydantic" },
    { name = "pydantic-settings" },
    { name = "pytest", specifier = ">=8.0.0" },
    { name = "pytest", marker = "extra == 'dev'", specifier = ">=8.0.0" },
    { name = "pytest-asyncio", specifier = ">=0.23.0" },
    { name = "pytest-asyncio", marker = "extra == 'dev'", specifier = ">=0.23.0" },
    { name = "pytest-cov", marker = "extra == 'dev'", specifier = ">=4.0.0" },
    { name = "python-dotenv" },
    { name = "python-multipart" },
    { name = "realtime" },
    { name = "storage3" },
    { name = "supabase" },
    { name = "uvicorn", extras = ["standard"] },
    { name = "uvloop" },
]
provides-extras = ["dev"]

[[package]]
name = "supabase"
version = "2.16.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "gotrue" },
    { name = "httpx" },
    { name = "postgrest" },
    { name = "realtime" },
    { name = "storage3" },
    { name = "supafunc" },
]
sdist = { url = "https://files.pythonhosted.org/packages/c6/93/335b91e8d09a95a337f051f84e85495f7732400f10c1bcb698a7571f8f1c/supabase-2.16.0.tar.gz", hash = "sha256:98f3810158012d4ec0e3083f2e5515f5e10b32bd71e7d458662140e963c1d164", size = 14595, upload-time = "2025-06-23T16:09:29.504Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/7e/75/2ab71e6605d20a740ff041c6176a328cfaa3fcee0dd0db885e081d98df06/supabase-2.16.0-py3-none-any.whl", hash = "sha256:99065caab3d90a56650bf39fbd0e49740995da3738ab28706c61bd7f2401db55", size = 17713, upload-time = "2025-06-23T16:09:28.299Z" },
]

[[package]]
name = "supafunc"
version = "0.10.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "httpx", extra = ["http2"] },
    { name = "strenum" },
]
sdist = { url = "https://files.pythonhosted.org/packages/e8/4b/16f94bcae8a49f5e09544a4fb0e6ad1c2288038036cefdeedb72fcffd92c/supafunc-0.10.1.tar.gz", hash = "sha256:a5b33c8baecb6b5297d25da29a2503e2ec67ee6986f3d44c137e651b8a59a17d", size = 5036, upload-time = "2025-06-23T18:26:50.327Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/76/4a/9cbea12d86a741d4e73a6e278c2b1d6479fb03d1002efb00e8e71aea76db/supafunc-0.10.1-py3-none-any.whl", hash = "sha256:26df9bd25ff2ef56cb5bfb8962de98f43331f7f8ff69572bac3ed9c3a9672040", size = 8028, upload-time = "2025-06-23T18:26:49.176Z" },
]

[[package]]
name = "tqdm"
version = "4.67.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
]
sdist = { url = "https://files.pythonhosted.org/packages/a8/4b/29b4ef32e036bb34e4ab51796dd745cdba7ed47ad142a9f4a1eb8e0c744d/tqdm-4.67.1.tar.gz", hash = "sha256:f8aef9c52c08c13a65f30ea34f4e5aac3fd1a34959879d7e59e63027286627f2", size = 169737, upload-time = "2024-11-24T20:12:22.481Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d0/30/dc54f88dd4a2b5dc8a0279bdd7270e735851848b762aeb1c1184ed1f6b14/tqdm-4.67.1-py3-none-any.whl", hash = "sha256:26445eca388f82e72884e0d580d5464cd801a3ea01e63e5601bdff9ba6a48de2", size = 78540, upload-time = "2024-11-24T20:12:19.698Z" },
]

[[package]]
name = "typing-extensions"
version = "4.14.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/d1/bc/51647cd02527e87d05cb083ccc402f93e441606ff1f01739a62c8ad09ba5/typing_extensions-4.14.0.tar.gz", hash = "sha256:8676b788e32f02ab42d9e7c61324048ae4c6d844a399eebace3d4979d75ceef4", size = 107423, upload-time = "2025-06-02T14:52:11.399Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/69/e0/552843e0d356fbb5256d21449fa957fa4eff3bbc135a74a691ee70c7c5da/typing_extensions-4.14.0-py3-none-any.whl", hash = "sha256:a1514509136dd0b477638fc68d6a91497af5076466ad0fa6c338e44e359944af", size = 43839, upload-time = "2025-06-02T14:52:10.026Z" },
]

[[package]]
name = "typing-inspection"
version = "0.4.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "typing-extensions" },
]
sdist = { url = "https://files.pythonhosted.org/packages/f8/b1/0c11f5058406b3af7609f121aaa6b609744687f1d158b3c3a5bf4cc94238/typing_inspection-0.4.1.tar.gz", hash = "sha256:6ae134cc0203c33377d43188d4064e9b357dba58cff3185f22924610e70a9d28", size = 75726, upload-time = "2025-05-21T18:55:23.885Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/17/69/cd203477f944c353c31bade965f880aa1061fd6bf05ded0726ca845b6ff7/typing_inspection-0.4.1-py3-none-any.whl", hash = "sha256:389055682238f53b04f7badcb49b989835495a96700ced5dab2d8feae4b26f51", size = 14552, upload-time = "2025-05-21T18:55:22.152Z" },
]

[[package]]
name = "uritemplate"
version = "4.2.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/98/60/f174043244c5306c9988380d2cb10009f91563fc4b31293d27e17201af56/uritemplate-4.2.0.tar.gz", hash = "sha256:480c2ed180878955863323eea31b0ede668795de182617fef9c6ca09e6ec9d0e", size = 33267, upload-time = "2025-06-02T15:12:06.318Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a9/99/3ae339466c9183ea5b8ae87b34c0b897eda475d2aec2307cae60e5cd4f29/uritemplate-4.2.0-py3-none-any.whl", hash = "sha256:962201ba1c4edcab02e60f9a0d3821e82dfc5d2d6662a21abd533879bdb8a686", size = 11488, upload-time = "2025-06-02T15:12:03.405Z" },
]

[[package]]
name = "urllib3"
version = "2.5.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/15/22/9ee70a2574a4f4599c47dd506532914ce044817c7752a79b6a51286319bc/urllib3-2.5.0.tar.gz", hash = "sha256:3fc47733c7e419d4bc3f6b3dc2b4f890bb743906a30d56ba4a5bfa4bbff92760", size = 393185, upload-time = "2025-06-18T14:07:41.644Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a7/c2/fe1e52489ae3122415c51f387e221dd0773709bad6c6cdaa599e8a2c5185/urllib3-2.5.0-py3-none-any.whl", hash = "sha256:e6b01673c0fa6a13e374b50871808eb3bf7046c4b125b216f6bf1cc604cff0dc", size = 129795, upload-time = "2025-06-18T14:07:40.39Z" },
]

[[package]]
name = "uvicorn"
version = "0.35.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "click" },
    { name = "h11" },
]
sdist = { url = "https://files.pythonhosted.org/packages/5e/42/e0e305207bb88c6b8d3061399c6a961ffe5fbb7e2aa63c9234df7259e9cd/uvicorn-0.35.0.tar.gz", hash = "sha256:bc662f087f7cf2ce11a1d7fd70b90c9f98ef2e2831556dd078d131b96cc94a01", size = 78473, upload-time = "2025-06-28T16:15:46.058Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d2/e2/dc81b1bd1dcfe91735810265e9d26bc8ec5da45b4c0f6237e286819194c3/uvicorn-0.35.0-py3-none-any.whl", hash = "sha256:197535216b25ff9b785e29a0b79199f55222193d47f820816e7da751e9bc8d4a", size = 66406, upload-time = "2025-06-28T16:15:44.816Z" },
]

[package.optional-dependencies]
standard = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
    { name = "httptools" },
    { name = "python-dotenv" },
    { name = "pyyaml" },
    { name = "uvloop", marker = "platform_python_implementation != 'PyPy' and sys_platform != 'cygwin' and sys_platform != 'win32'" },
    { name = "watchfiles" },
    { name = "websockets" },
]

[[package]]
name = "uvloop"
version = "0.21.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/af/c0/854216d09d33c543f12a44b393c402e89a920b1a0a7dc634c42de91b9cf6/uvloop-0.21.0.tar.gz", hash = "sha256:3bf12b0fda68447806a7ad847bfa591613177275d35b6724b1ee573faa3704e3", size = 2492741, upload-time = "2024-10-14T23:38:35.489Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/8c/4c/03f93178830dc7ce8b4cdee1d36770d2f5ebb6f3d37d354e061eefc73545/uvloop-0.21.0-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:359ec2c888397b9e592a889c4d72ba3d6befba8b2bb01743f72fffbde663b59c", size = 1471284, upload-time = "2024-10-14T23:37:47.833Z" },
    { url = "https://files.pythonhosted.org/packages/43/3e/92c03f4d05e50f09251bd8b2b2b584a2a7f8fe600008bcc4523337abe676/uvloop-0.21.0-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:f7089d2dc73179ce5ac255bdf37c236a9f914b264825fdaacaded6990a7fb4c2", size = 821349, upload-time = "2024-10-14T23:37:50.149Z" },
    { url = "https://files.pythonhosted.org/packages/a6/ef/a02ec5da49909dbbfb1fd205a9a1ac4e88ea92dcae885e7c961847cd51e2/uvloop-0.21.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:baa4dcdbd9ae0a372f2167a207cd98c9f9a1ea1188a8a526431eef2f8116cc8d", size = 4580089, upload-time = "2024-10-14T23:37:51.703Z" },
    { url = "https://files.pythonhosted.org/packages/06/a7/b4e6a19925c900be9f98bec0a75e6e8f79bb53bdeb891916609ab3958967/uvloop-0.21.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:86975dca1c773a2c9864f4c52c5a55631038e387b47eaf56210f873887b6c8dc", size = 4693770, upload-time = "2024-10-14T23:37:54.122Z" },
    { url = "https://files.pythonhosted.org/packages/ce/0c/f07435a18a4b94ce6bd0677d8319cd3de61f3a9eeb1e5f8ab4e8b5edfcb3/uvloop-0.21.0-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:461d9ae6660fbbafedd07559c6a2e57cd553b34b0065b6550685f6653a98c1cb", size = 4451321, upload-time = "2024-10-14T23:37:55.766Z" },
    { url = "https://files.pythonhosted.org/packages/8f/eb/f7032be105877bcf924709c97b1bf3b90255b4ec251f9340cef912559f28/uvloop-0.21.0-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:183aef7c8730e54c9a3ee3227464daed66e37ba13040bb3f350bc2ddc040f22f", size = 4659022, upload-time = "2024-10-14T23:37:58.195Z" },
    { url = "https://files.pythonhosted.org/packages/3f/8d/2cbef610ca21539f0f36e2b34da49302029e7c9f09acef0b1c3b5839412b/uvloop-0.21.0-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:bfd55dfcc2a512316e65f16e503e9e450cab148ef11df4e4e679b5e8253a5281", size = 1468123, upload-time = "2024-10-14T23:38:00.688Z" },
    { url = "https://files.pythonhosted.org/packages/93/0d/b0038d5a469f94ed8f2b2fce2434a18396d8fbfb5da85a0a9781ebbdec14/uvloop-0.21.0-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:787ae31ad8a2856fc4e7c095341cccc7209bd657d0e71ad0dc2ea83c4a6fa8af", size = 819325, upload-time = "2024-10-14T23:38:02.309Z" },
    { url = "https://files.pythonhosted.org/packages/50/94/0a687f39e78c4c1e02e3272c6b2ccdb4e0085fda3b8352fecd0410ccf915/uvloop-0.21.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:5ee4d4ef48036ff6e5cfffb09dd192c7a5027153948d85b8da7ff705065bacc6", size = 4582806, upload-time = "2024-10-14T23:38:04.711Z" },
    { url = "https://files.pythonhosted.org/packages/d2/19/f5b78616566ea68edd42aacaf645adbf71fbd83fc52281fba555dc27e3f1/uvloop-0.21.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:f3df876acd7ec037a3d005b3ab85a7e4110422e4d9c1571d4fc89b0fc41b6816", size = 4701068, upload-time = "2024-10-14T23:38:06.385Z" },
    { url = "https://files.pythonhosted.org/packages/47/57/66f061ee118f413cd22a656de622925097170b9380b30091b78ea0c6ea75/uvloop-0.21.0-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:bd53ecc9a0f3d87ab847503c2e1552b690362e005ab54e8a48ba97da3924c0dc", size = 4454428, upload-time = "2024-10-14T23:38:08.416Z" },
    { url = "https://files.pythonhosted.org/packages/63/9a/0962b05b308494e3202d3f794a6e85abe471fe3cafdbcf95c2e8c713aabd/uvloop-0.21.0-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:a5c39f217ab3c663dc699c04cbd50c13813e31d917642d459fdcec07555cc553", size = 4660018, upload-time = "2024-10-14T23:38:10.888Z" },
]

[[package]]
name = "watchfiles"
version = "1.1.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "anyio" },
]
sdist = { url = "https://files.pythonhosted.org/packages/2a/9a/d451fcc97d029f5812e898fd30a53fd8c15c7bbd058fd75cfc6beb9bd761/watchfiles-1.1.0.tar.gz", hash = "sha256:693ed7ec72cbfcee399e92c895362b6e66d63dac6b91e2c11ae03d10d503e575", size = 94406, upload-time = "2025-06-15T19:06:59.42Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/f6/b8/858957045a38a4079203a33aaa7d23ea9269ca7761c8a074af3524fbb240/watchfiles-1.1.0-cp312-cp312-macosx_10_12_x86_64.whl", hash = "sha256:9dc001c3e10de4725c749d4c2f2bdc6ae24de5a88a339c4bce32300a31ede179", size = 402339, upload-time = "2025-06-15T19:05:24.516Z" },
    { url = "https://files.pythonhosted.org/packages/80/28/98b222cca751ba68e88521fabd79a4fab64005fc5976ea49b53fa205d1fa/watchfiles-1.1.0-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:d9ba68ec283153dead62cbe81872d28e053745f12335d037de9cbd14bd1877f5", size = 394409, upload-time = "2025-06-15T19:05:25.469Z" },
    { url = "https://files.pythonhosted.org/packages/86/50/dee79968566c03190677c26f7f47960aff738d32087087bdf63a5473e7df/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:130fc497b8ee68dce163e4254d9b0356411d1490e868bd8790028bc46c5cc297", size = 450939, upload-time = "2025-06-15T19:05:26.494Z" },
    { url = "https://files.pythonhosted.org/packages/40/45/a7b56fb129700f3cfe2594a01aa38d033b92a33dddce86c8dfdfc1247b72/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:50a51a90610d0845a5931a780d8e51d7bd7f309ebc25132ba975aca016b576a0", size = 457270, upload-time = "2025-06-15T19:05:27.466Z" },
    { url = "https://files.pythonhosted.org/packages/b5/c8/fa5ef9476b1d02dc6b5e258f515fcaaecf559037edf8b6feffcbc097c4b8/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:dc44678a72ac0910bac46fa6a0de6af9ba1355669b3dfaf1ce5f05ca7a74364e", size = 483370, upload-time = "2025-06-15T19:05:28.548Z" },
    { url = "https://files.pythonhosted.org/packages/98/68/42cfcdd6533ec94f0a7aab83f759ec11280f70b11bfba0b0f885e298f9bd/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:a543492513a93b001975ae283a51f4b67973662a375a403ae82f420d2c7205ee", size = 598654, upload-time = "2025-06-15T19:05:29.997Z" },
    { url = "https://files.pythonhosted.org/packages/d3/74/b2a1544224118cc28df7e59008a929e711f9c68ce7d554e171b2dc531352/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8ac164e20d17cc285f2b94dc31c384bc3aa3dd5e7490473b3db043dd70fbccfd", size = 478667, upload-time = "2025-06-15T19:05:31.172Z" },
    { url = "https://files.pythonhosted.org/packages/8c/77/e3362fe308358dc9f8588102481e599c83e1b91c2ae843780a7ded939a35/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:f7590d5a455321e53857892ab8879dce62d1f4b04748769f5adf2e707afb9d4f", size = 452213, upload-time = "2025-06-15T19:05:32.299Z" },
    { url = "https://files.pythonhosted.org/packages/6e/17/c8f1a36540c9a1558d4faf08e909399e8133599fa359bf52ec8fcee5be6f/watchfiles-1.1.0-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:37d3d3f7defb13f62ece99e9be912afe9dd8a0077b7c45ee5a57c74811d581a4", size = 626718, upload-time = "2025-06-15T19:05:33.415Z" },
    { url = "https://files.pythonhosted.org/packages/26/45/fb599be38b4bd38032643783d7496a26a6f9ae05dea1a42e58229a20ac13/watchfiles-1.1.0-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:7080c4bb3efd70a07b1cc2df99a7aa51d98685be56be6038c3169199d0a1c69f", size = 623098, upload-time = "2025-06-15T19:05:34.534Z" },
    { url = "https://files.pythonhosted.org/packages/a1/e7/fdf40e038475498e160cd167333c946e45d8563ae4dd65caf757e9ffe6b4/watchfiles-1.1.0-cp312-cp312-win32.whl", hash = "sha256:cbcf8630ef4afb05dc30107bfa17f16c0896bb30ee48fc24bf64c1f970f3b1fd", size = 279209, upload-time = "2025-06-15T19:05:35.577Z" },
    { url = "https://files.pythonhosted.org/packages/3f/d3/3ae9d5124ec75143bdf088d436cba39812122edc47709cd2caafeac3266f/watchfiles-1.1.0-cp312-cp312-win_amd64.whl", hash = "sha256:cbd949bdd87567b0ad183d7676feb98136cde5bb9025403794a4c0db28ed3a47", size = 292786, upload-time = "2025-06-15T19:05:36.559Z" },
    { url = "https://files.pythonhosted.org/packages/26/2f/7dd4fc8b5f2b34b545e19629b4a018bfb1de23b3a496766a2c1165ca890d/watchfiles-1.1.0-cp312-cp312-win_arm64.whl", hash = "sha256:0a7d40b77f07be87c6faa93d0951a0fcd8cbca1ddff60a1b65d741bac6f3a9f6", size = 284343, upload-time = "2025-06-15T19:05:37.5Z" },
    { url = "https://files.pythonhosted.org/packages/d3/42/fae874df96595556a9089ade83be34a2e04f0f11eb53a8dbf8a8a5e562b4/watchfiles-1.1.0-cp313-cp313-macosx_10_12_x86_64.whl", hash = "sha256:5007f860c7f1f8df471e4e04aaa8c43673429047d63205d1630880f7637bca30", size = 402004, upload-time = "2025-06-15T19:05:38.499Z" },
    { url = "https://files.pythonhosted.org/packages/fa/55/a77e533e59c3003d9803c09c44c3651224067cbe7fb5d574ddbaa31e11ca/watchfiles-1.1.0-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:20ecc8abbd957046f1fe9562757903f5eaf57c3bce70929fda6c7711bb58074a", size = 393671, upload-time = "2025-06-15T19:05:39.52Z" },
    { url = "https://files.pythonhosted.org/packages/05/68/b0afb3f79c8e832e6571022611adbdc36e35a44e14f129ba09709aa4bb7a/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:f2f0498b7d2a3c072766dba3274fe22a183dbea1f99d188f1c6c72209a1063dc", size = 449772, upload-time = "2025-06-15T19:05:40.897Z" },
    { url = "https://files.pythonhosted.org/packages/ff/05/46dd1f6879bc40e1e74c6c39a1b9ab9e790bf1f5a2fe6c08b463d9a807f4/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:239736577e848678e13b201bba14e89718f5c2133dfd6b1f7846fa1b58a8532b", size = 456789, upload-time = "2025-06-15T19:05:42.045Z" },
    { url = "https://files.pythonhosted.org/packages/8b/ca/0eeb2c06227ca7f12e50a47a3679df0cd1ba487ea19cf844a905920f8e95/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:eff4b8d89f444f7e49136dc695599a591ff769300734446c0a86cba2eb2f9895", size = 482551, upload-time = "2025-06-15T19:05:43.781Z" },
    { url = "https://files.pythonhosted.org/packages/31/47/2cecbd8694095647406645f822781008cc524320466ea393f55fe70eed3b/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:12b0a02a91762c08f7264e2e79542f76870c3040bbc847fb67410ab81474932a", size = 597420, upload-time = "2025-06-15T19:05:45.244Z" },
    { url = "https://files.pythonhosted.org/packages/d9/7e/82abc4240e0806846548559d70f0b1a6dfdca75c1b4f9fa62b504ae9b083/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:29e7bc2eee15cbb339c68445959108803dc14ee0c7b4eea556400131a8de462b", size = 477950, upload-time = "2025-06-15T19:05:46.332Z" },
    { url = "https://files.pythonhosted.org/packages/25/0d/4d564798a49bf5482a4fa9416dea6b6c0733a3b5700cb8a5a503c4b15853/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:d9481174d3ed982e269c090f780122fb59cee6c3796f74efe74e70f7780ed94c", size = 451706, upload-time = "2025-06-15T19:05:47.459Z" },
    { url = "https://files.pythonhosted.org/packages/81/b5/5516cf46b033192d544102ea07c65b6f770f10ed1d0a6d388f5d3874f6e4/watchfiles-1.1.0-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:80f811146831c8c86ab17b640801c25dc0a88c630e855e2bef3568f30434d52b", size = 625814, upload-time = "2025-06-15T19:05:48.654Z" },
    { url = "https://files.pythonhosted.org/packages/0c/dd/7c1331f902f30669ac3e754680b6edb9a0dd06dea5438e61128111fadd2c/watchfiles-1.1.0-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:60022527e71d1d1fda67a33150ee42869042bce3d0fcc9cc49be009a9cded3fb", size = 622820, upload-time = "2025-06-15T19:05:50.088Z" },
    { url = "https://files.pythonhosted.org/packages/1b/14/36d7a8e27cd128d7b1009e7715a7c02f6c131be9d4ce1e5c3b73d0e342d8/watchfiles-1.1.0-cp313-cp313-win32.whl", hash = "sha256:32d6d4e583593cb8576e129879ea0991660b935177c0f93c6681359b3654bfa9", size = 279194, upload-time = "2025-06-15T19:05:51.186Z" },
    { url = "https://files.pythonhosted.org/packages/25/41/2dd88054b849aa546dbeef5696019c58f8e0774f4d1c42123273304cdb2e/watchfiles-1.1.0-cp313-cp313-win_amd64.whl", hash = "sha256:f21af781a4a6fbad54f03c598ab620e3a77032c5878f3d780448421a6e1818c7", size = 292349, upload-time = "2025-06-15T19:05:52.201Z" },
    { url = "https://files.pythonhosted.org/packages/c8/cf/421d659de88285eb13941cf11a81f875c176f76a6d99342599be88e08d03/watchfiles-1.1.0-cp313-cp313-win_arm64.whl", hash = "sha256:5366164391873ed76bfdf618818c82084c9db7fac82b64a20c44d335eec9ced5", size = 283836, upload-time = "2025-06-15T19:05:53.265Z" },
    { url = "https://files.pythonhosted.org/packages/45/10/6faf6858d527e3599cc50ec9fcae73590fbddc1420bd4fdccfebffeedbc6/watchfiles-1.1.0-cp313-cp313t-macosx_10_12_x86_64.whl", hash = "sha256:17ab167cca6339c2b830b744eaf10803d2a5b6683be4d79d8475d88b4a8a4be1", size = 400343, upload-time = "2025-06-15T19:05:54.252Z" },
    { url = "https://files.pythonhosted.org/packages/03/20/5cb7d3966f5e8c718006d0e97dfe379a82f16fecd3caa7810f634412047a/watchfiles-1.1.0-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:328dbc9bff7205c215a7807da7c18dce37da7da718e798356212d22696404339", size = 392916, upload-time = "2025-06-15T19:05:55.264Z" },
    { url = "https://files.pythonhosted.org/packages/8c/07/d8f1176328fa9e9581b6f120b017e286d2a2d22ae3f554efd9515c8e1b49/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:f7208ab6e009c627b7557ce55c465c98967e8caa8b11833531fdf95799372633", size = 449582, upload-time = "2025-06-15T19:05:56.317Z" },
    { url = "https://files.pythonhosted.org/packages/66/e8/80a14a453cf6038e81d072a86c05276692a1826471fef91df7537dba8b46/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:a8f6f72974a19efead54195bc9bed4d850fc047bb7aa971268fd9a8387c89011", size = 456752, upload-time = "2025-06-15T19:05:57.359Z" },
    { url = "https://files.pythonhosted.org/packages/5a/25/0853b3fe0e3c2f5af9ea60eb2e781eade939760239a72c2d38fc4cc335f6/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:d181ef50923c29cf0450c3cd47e2f0557b62218c50b2ab8ce2ecaa02bd97e670", size = 481436, upload-time = "2025-06-15T19:05:58.447Z" },
    { url = "https://files.pythonhosted.org/packages/fe/9e/4af0056c258b861fbb29dcb36258de1e2b857be4a9509e6298abcf31e5c9/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:adb4167043d3a78280d5d05ce0ba22055c266cf8655ce942f2fb881262ff3cdf", size = 596016, upload-time = "2025-06-15T19:05:59.59Z" },
    { url = "https://files.pythonhosted.org/packages/c5/fa/95d604b58aa375e781daf350897aaaa089cff59d84147e9ccff2447c8294/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8c5701dc474b041e2934a26d31d39f90fac8a3dee2322b39f7729867f932b1d4", size = 476727, upload-time = "2025-06-15T19:06:01.086Z" },
    { url = "https://files.pythonhosted.org/packages/65/95/fe479b2664f19be4cf5ceeb21be05afd491d95f142e72d26a42f41b7c4f8/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:b067915e3c3936966a8607f6fe5487df0c9c4afb85226613b520890049deea20", size = 451864, upload-time = "2025-06-15T19:06:02.144Z" },
    { url = "https://files.pythonhosted.org/packages/d3/8a/3c4af14b93a15ce55901cd7a92e1a4701910f1768c78fb30f61d2b79785b/watchfiles-1.1.0-cp313-cp313t-musllinux_1_1_aarch64.whl", hash = "sha256:9c733cda03b6d636b4219625a4acb5c6ffb10803338e437fb614fef9516825ef", size = 625626, upload-time = "2025-06-15T19:06:03.578Z" },
    { url = "https://files.pythonhosted.org/packages/da/f5/cf6aa047d4d9e128f4b7cde615236a915673775ef171ff85971d698f3c2c/watchfiles-1.1.0-cp313-cp313t-musllinux_1_1_x86_64.whl", hash = "sha256:cc08ef8b90d78bfac66f0def80240b0197008e4852c9f285907377b2947ffdcb", size = 622744, upload-time = "2025-06-15T19:06:05.066Z" },
    { url = "https://files.pythonhosted.org/packages/2c/00/70f75c47f05dea6fd30df90f047765f6fc2d6eb8b5a3921379b0b04defa2/watchfiles-1.1.0-cp314-cp314-macosx_10_12_x86_64.whl", hash = "sha256:9974d2f7dc561cce3bb88dfa8eb309dab64c729de85fba32e98d75cf24b66297", size = 402114, upload-time = "2025-06-15T19:06:06.186Z" },
    { url = "https://files.pythonhosted.org/packages/53/03/acd69c48db4a1ed1de26b349d94077cca2238ff98fd64393f3e97484cae6/watchfiles-1.1.0-cp314-cp314-macosx_11_0_arm64.whl", hash = "sha256:c68e9f1fcb4d43798ad8814c4c1b61547b014b667216cb754e606bfade587018", size = 393879, upload-time = "2025-06-15T19:06:07.369Z" },
    { url = "https://files.pythonhosted.org/packages/2f/c8/a9a2a6f9c8baa4eceae5887fecd421e1b7ce86802bcfc8b6a942e2add834/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:95ab1594377effac17110e1352989bdd7bdfca9ff0e5eeccd8c69c5389b826d0", size = 450026, upload-time = "2025-06-15T19:06:08.476Z" },
    { url = "https://files.pythonhosted.org/packages/fe/51/d572260d98388e6e2b967425c985e07d47ee6f62e6455cefb46a6e06eda5/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:fba9b62da882c1be1280a7584ec4515d0a6006a94d6e5819730ec2eab60ffe12", size = 457917, upload-time = "2025-06-15T19:06:09.988Z" },
    { url = "https://files.pythonhosted.org/packages/c6/2d/4258e52917bf9f12909b6ec314ff9636276f3542f9d3807d143f27309104/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3434e401f3ce0ed6b42569128b3d1e3af773d7ec18751b918b89cd49c14eaafb", size = 483602, upload-time = "2025-06-15T19:06:11.088Z" },
    { url = "https://files.pythonhosted.org/packages/84/99/bee17a5f341a4345fe7b7972a475809af9e528deba056f8963d61ea49f75/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:fa257a4d0d21fcbca5b5fcba9dca5a78011cb93c0323fb8855c6d2dfbc76eb77", size = 596758, upload-time = "2025-06-15T19:06:12.197Z" },
    { url = "https://files.pythonhosted.org/packages/40/76/e4bec1d59b25b89d2b0716b41b461ed655a9a53c60dc78ad5771fda5b3e6/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:7fd1b3879a578a8ec2076c7961076df540b9af317123f84569f5a9ddee64ce92", size = 477601, upload-time = "2025-06-15T19:06:13.391Z" },
    { url = "https://files.pythonhosted.org/packages/1f/fa/a514292956f4a9ce3c567ec0c13cce427c158e9f272062685a8a727d08fc/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:62cc7a30eeb0e20ecc5f4bd113cd69dcdb745a07c68c0370cea919f373f65d9e", size = 451936, upload-time = "2025-06-15T19:06:14.656Z" },
    { url = "https://files.pythonhosted.org/packages/32/5d/c3bf927ec3bbeb4566984eba8dd7a8eb69569400f5509904545576741f88/watchfiles-1.1.0-cp314-cp314-musllinux_1_1_aarch64.whl", hash = "sha256:891c69e027748b4a73847335d208e374ce54ca3c335907d381fde4e41661b13b", size = 626243, upload-time = "2025-06-15T19:06:16.232Z" },
    { url = "https://files.pythonhosted.org/packages/e6/65/6e12c042f1a68c556802a84d54bb06d35577c81e29fba14019562479159c/watchfiles-1.1.0-cp314-cp314-musllinux_1_1_x86_64.whl", hash = "sha256:12fe8eaffaf0faa7906895b4f8bb88264035b3f0243275e0bf24af0436b27259", size = 623073, upload-time = "2025-06-15T19:06:17.457Z" },
    { url = "https://files.pythonhosted.org/packages/89/ab/7f79d9bf57329e7cbb0a6fd4c7bd7d0cee1e4a8ef0041459f5409da3506c/watchfiles-1.1.0-cp314-cp314t-macosx_10_12_x86_64.whl", hash = "sha256:bfe3c517c283e484843cb2e357dd57ba009cff351edf45fb455b5fbd1f45b15f", size = 400872, upload-time = "2025-06-15T19:06:18.57Z" },
    { url = "https://files.pythonhosted.org/packages/df/d5/3f7bf9912798e9e6c516094db6b8932df53b223660c781ee37607030b6d3/watchfiles-1.1.0-cp314-cp314t-macosx_11_0_arm64.whl", hash = "sha256:a9ccbf1f129480ed3044f540c0fdbc4ee556f7175e5ab40fe077ff6baf286d4e", size = 392877, upload-time = "2025-06-15T19:06:19.55Z" },
    { url = "https://files.pythonhosted.org/packages/0d/c5/54ec7601a2798604e01c75294770dbee8150e81c6e471445d7601610b495/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:ba0e3255b0396cac3cc7bbace76404dd72b5438bf0d8e7cefa2f79a7f3649caa", size = 449645, upload-time = "2025-06-15T19:06:20.66Z" },
    { url = "https://files.pythonhosted.org/packages/0a/04/c2f44afc3b2fce21ca0b7802cbd37ed90a29874f96069ed30a36dfe57c2b/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:4281cd9fce9fc0a9dbf0fc1217f39bf9cf2b4d315d9626ef1d4e87b84699e7e8", size = 457424, upload-time = "2025-06-15T19:06:21.712Z" },
    { url = "https://files.pythonhosted.org/packages/9f/b0/eec32cb6c14d248095261a04f290636da3df3119d4040ef91a4a50b29fa5/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:6d2404af8db1329f9a3c9b79ff63e0ae7131986446901582067d9304ae8aaf7f", size = 481584, upload-time = "2025-06-15T19:06:22.777Z" },
    { url = "https://files.pythonhosted.org/packages/d1/e2/ca4bb71c68a937d7145aa25709e4f5d68eb7698a25ce266e84b55d591bbd/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:e78b6ed8165996013165eeabd875c5dfc19d41b54f94b40e9fff0eb3193e5e8e", size = 596675, upload-time = "2025-06-15T19:06:24.226Z" },
    { url = "https://files.pythonhosted.org/packages/a1/dd/b0e4b7fb5acf783816bc950180a6cd7c6c1d2cf7e9372c0ea634e722712b/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:249590eb75ccc117f488e2fabd1bfa33c580e24b96f00658ad88e38844a040bb", size = 477363, upload-time = "2025-06-15T19:06:25.42Z" },
    { url = "https://files.pythonhosted.org/packages/69/c4/088825b75489cb5b6a761a4542645718893d395d8c530b38734f19da44d2/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:d05686b5487cfa2e2c28ff1aa370ea3e6c5accfe6435944ddea1e10d93872147", size = 452240, upload-time = "2025-06-15T19:06:26.552Z" },
    { url = "https://files.pythonhosted.org/packages/10/8c/22b074814970eeef43b7c44df98c3e9667c1f7bf5b83e0ff0201b0bd43f9/watchfiles-1.1.0-cp314-cp314t-musllinux_1_1_aarch64.whl", hash = "sha256:d0e10e6f8f6dc5762adee7dece33b722282e1f59aa6a55da5d493a97282fedd8", size = 625607, upload-time = "2025-06-15T19:06:27.606Z" },
    { url = "https://files.pythonhosted.org/packages/32/fa/a4f5c2046385492b2273213ef815bf71a0d4c1943b784fb904e184e30201/watchfiles-1.1.0-cp314-cp314t-musllinux_1_1_x86_64.whl", hash = "sha256:af06c863f152005c7592df1d6a7009c836a247c9d8adb78fef8575a5a98699db", size = 623315, upload-time = "2025-06-15T19:06:29.076Z" },
]

[[package]]
name = "websockets"
version = "15.0.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/21/e6/26d09fab466b7ca9c7737474c52be4f76a40301b08362eb2dbc19dcc16c1/websockets-15.0.1.tar.gz", hash = "sha256:82544de02076bafba038ce055ee6412d68da13ab47f0c60cab827346de828dee", size = 177016, upload-time = "2025-03-05T20:03:41.606Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/51/6b/4545a0d843594f5d0771e86463606a3988b5a09ca5123136f8a76580dd63/websockets-15.0.1-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:3e90baa811a5d73f3ca0bcbf32064d663ed81318ab225ee4f427ad4e26e5aff3", size = 175437, upload-time = "2025-03-05T20:02:16.706Z" },
    { url = "https://files.pythonhosted.org/packages/f4/71/809a0f5f6a06522af902e0f2ea2757f71ead94610010cf570ab5c98e99ed/websockets-15.0.1-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:592f1a9fe869c778694f0aa806ba0374e97648ab57936f092fd9d87f8bc03665", size = 173096, upload-time = "2025-03-05T20:02:18.832Z" },
    { url = "https://files.pythonhosted.org/packages/3d/69/1a681dd6f02180916f116894181eab8b2e25b31e484c5d0eae637ec01f7c/websockets-15.0.1-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:0701bc3cfcb9164d04a14b149fd74be7347a530ad3bbf15ab2c678a2cd3dd9a2", size = 173332, upload-time = "2025-03-05T20:02:20.187Z" },
    { url = "https://files.pythonhosted.org/packages/a6/02/0073b3952f5bce97eafbb35757f8d0d54812b6174ed8dd952aa08429bcc3/websockets-15.0.1-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:e8b56bdcdb4505c8078cb6c7157d9811a85790f2f2b3632c7d1462ab5783d215", size = 183152, upload-time = "2025-03-05T20:02:22.286Z" },
    { url = "https://files.pythonhosted.org/packages/74/45/c205c8480eafd114b428284840da0b1be9ffd0e4f87338dc95dc6ff961a1/websockets-15.0.1-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:0af68c55afbd5f07986df82831c7bff04846928ea8d1fd7f30052638788bc9b5", size = 182096, upload-time = "2025-03-05T20:02:24.368Z" },
    { url = "https://files.pythonhosted.org/packages/14/8f/aa61f528fba38578ec553c145857a181384c72b98156f858ca5c8e82d9d3/websockets-15.0.1-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:64dee438fed052b52e4f98f76c5790513235efaa1ef7f3f2192c392cd7c91b65", size = 182523, upload-time = "2025-03-05T20:02:25.669Z" },
    { url = "https://files.pythonhosted.org/packages/ec/6d/0267396610add5bc0d0d3e77f546d4cd287200804fe02323797de77dbce9/websockets-15.0.1-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:d5f6b181bb38171a8ad1d6aa58a67a6aa9d4b38d0f8c5f496b9e42561dfc62fe", size = 182790, upload-time = "2025-03-05T20:02:26.99Z" },
    { url = "https://files.pythonhosted.org/packages/02/05/c68c5adbf679cf610ae2f74a9b871ae84564462955d991178f95a1ddb7dd/websockets-15.0.1-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:5d54b09eba2bada6011aea5375542a157637b91029687eb4fdb2dab11059c1b4", size = 182165, upload-time = "2025-03-05T20:02:30.291Z" },
    { url = "https://files.pythonhosted.org/packages/29/93/bb672df7b2f5faac89761cb5fa34f5cec45a4026c383a4b5761c6cea5c16/websockets-15.0.1-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:3be571a8b5afed347da347bfcf27ba12b069d9d7f42cb8c7028b5e98bbb12597", size = 182160, upload-time = "2025-03-05T20:02:31.634Z" },
    { url = "https://files.pythonhosted.org/packages/ff/83/de1f7709376dc3ca9b7eeb4b9a07b4526b14876b6d372a4dc62312bebee0/websockets-15.0.1-cp312-cp312-win32.whl", hash = "sha256:c338ffa0520bdb12fbc527265235639fb76e7bc7faafbb93f6ba80d9c06578a9", size = 176395, upload-time = "2025-03-05T20:02:33.017Z" },
    { url = "https://files.pythonhosted.org/packages/7d/71/abf2ebc3bbfa40f391ce1428c7168fb20582d0ff57019b69ea20fa698043/websockets-15.0.1-cp312-cp312-win_amd64.whl", hash = "sha256:fcd5cf9e305d7b8338754470cf69cf81f420459dbae8a3b40cee57417f4614a7", size = 176841, upload-time = "2025-03-05T20:02:34.498Z" },
    { url = "https://files.pythonhosted.org/packages/cb/9f/51f0cf64471a9d2b4d0fc6c534f323b664e7095640c34562f5182e5a7195/websockets-15.0.1-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:ee443ef070bb3b6ed74514f5efaa37a252af57c90eb33b956d35c8e9c10a1931", size = 175440, upload-time = "2025-03-05T20:02:36.695Z" },
    { url = "https://files.pythonhosted.org/packages/8a/05/aa116ec9943c718905997412c5989f7ed671bc0188ee2ba89520e8765d7b/websockets-15.0.1-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:5a939de6b7b4e18ca683218320fc67ea886038265fd1ed30173f5ce3f8e85675", size = 173098, upload-time = "2025-03-05T20:02:37.985Z" },
    { url = "https://files.pythonhosted.org/packages/ff/0b/33cef55ff24f2d92924923c99926dcce78e7bd922d649467f0eda8368923/websockets-15.0.1-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:746ee8dba912cd6fc889a8147168991d50ed70447bf18bcda7039f7d2e3d9151", size = 173329, upload-time = "2025-03-05T20:02:39.298Z" },
    { url = "https://files.pythonhosted.org/packages/31/1d/063b25dcc01faa8fada1469bdf769de3768b7044eac9d41f734fd7b6ad6d/websockets-15.0.1-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:595b6c3969023ecf9041b2936ac3827e4623bfa3ccf007575f04c5a6aa318c22", size = 183111, upload-time = "2025-03-05T20:02:40.595Z" },
    { url = "https://files.pythonhosted.org/packages/93/53/9a87ee494a51bf63e4ec9241c1ccc4f7c2f45fff85d5bde2ff74fcb68b9e/websockets-15.0.1-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3c714d2fc58b5ca3e285461a4cc0c9a66bd0e24c5da9911e30158286c9b5be7f", size = 182054, upload-time = "2025-03-05T20:02:41.926Z" },
    { url = "https://files.pythonhosted.org/packages/ff/b2/83a6ddf56cdcbad4e3d841fcc55d6ba7d19aeb89c50f24dd7e859ec0805f/websockets-15.0.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:0f3c1e2ab208db911594ae5b4f79addeb3501604a165019dd221c0bdcabe4db8", size = 182496, upload-time = "2025-03-05T20:02:43.304Z" },
    { url = "https://files.pythonhosted.org/packages/98/41/e7038944ed0abf34c45aa4635ba28136f06052e08fc2168520bb8b25149f/websockets-15.0.1-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:229cf1d3ca6c1804400b0a9790dc66528e08a6a1feec0d5040e8b9eb14422375", size = 182829, upload-time = "2025-03-05T20:02:48.812Z" },
    { url = "https://files.pythonhosted.org/packages/e0/17/de15b6158680c7623c6ef0db361da965ab25d813ae54fcfeae2e5b9ef910/websockets-15.0.1-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:756c56e867a90fb00177d530dca4b097dd753cde348448a1012ed6c5131f8b7d", size = 182217, upload-time = "2025-03-05T20:02:50.14Z" },
    { url = "https://files.pythonhosted.org/packages/33/2b/1f168cb6041853eef0362fb9554c3824367c5560cbdaad89ac40f8c2edfc/websockets-15.0.1-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:558d023b3df0bffe50a04e710bc87742de35060580a293c2a984299ed83bc4e4", size = 182195, upload-time = "2025-03-05T20:02:51.561Z" },
    { url = "https://files.pythonhosted.org/packages/86/eb/20b6cdf273913d0ad05a6a14aed4b9a85591c18a987a3d47f20fa13dcc47/websockets-15.0.1-cp313-cp313-win32.whl", hash = "sha256:ba9e56e8ceeeedb2e080147ba85ffcd5cd0711b89576b83784d8605a7df455fa", size = 176393, upload-time = "2025-03-05T20:02:53.814Z" },
    { url = "https://files.pythonhosted.org/packages/1b/6c/c65773d6cab416a64d191d6ee8a8b1c68a09970ea6909d16965d26bfed1e/websockets-15.0.1-cp313-cp313-win_amd64.whl", hash = "sha256:e09473f095a819042ecb2ab9465aee615bd9c2028e4ef7d933600a8401c79561", size = 176837, upload-time = "2025-03-05T20:02:55.237Z" },
    { url = "https://files.pythonhosted.org/packages/fa/a8/5b41e0da817d64113292ab1f8247140aac61cbf6cfd085d6a0fa77f4984f/websockets-15.0.1-py3-none-any.whl", hash = "sha256:f7a866fbc1e97b5c617ee4116daaa09b722101d4a3c170c787450ba409f9736f", size = 169743, upload-time = "2025-03-05T20:03:39.41Z" },
]

[[package]]
name = "win32-setctime"
version = "1.2.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/b3/8f/705086c9d734d3b663af0e9bb3d4de6578d08f46b1b101c2442fd9aecaa2/win32_setctime-1.2.0.tar.gz", hash = "sha256:ae1fdf948f5640aae05c511ade119313fb6a30d7eabe25fef9764dca5873c4c0", size = 4867, upload-time = "2024-12-07T15:28:28.314Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/e1/07/c6fe3ad3e685340704d314d765b7912993bcb8dc198f0e7a89382d37974b/win32_setctime-1.2.0-py3-none-any.whl", hash = "sha256:95d644c4e708aba81dc3704a116d8cbc974d70b3bdb8be1d150e36be6e9d1390", size = 4083, upload-time = "2024-12-07T15:28:26.465Z" },
]

[[package]]
name = "yarl"
version = "1.20.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "idna" },
    { name = "multidict" },
    { name = "propcache" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3c/fb/efaa23fa4e45537b827620f04cf8f3cd658b76642205162e072703a5b963/yarl-1.20.1.tar.gz", hash = "sha256:d017a4997ee50c91fd5466cef416231bb82177b93b029906cefc542ce14c35ac", size = 186428, upload-time = "2025-06-10T00:46:09.923Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/5f/9a/cb7fad7d73c69f296eda6815e4a2c7ed53fc70c2f136479a91c8e5fbdb6d/yarl-1.20.1-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:bdcc4cd244e58593a4379fe60fdee5ac0331f8eb70320a24d591a3be197b94a9", size = 133667, upload-time = "2025-06-10T00:43:44.369Z" },
    { url = "https://files.pythonhosted.org/packages/67/38/688577a1cb1e656e3971fb66a3492501c5a5df56d99722e57c98249e5b8a/yarl-1.20.1-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:b29a2c385a5f5b9c7d9347e5812b6f7ab267193c62d282a540b4fc528c8a9d2a", size = 91025, upload-time = "2025-06-10T00:43:46.295Z" },
    { url = "https://files.pythonhosted.org/packages/50/ec/72991ae51febeb11a42813fc259f0d4c8e0507f2b74b5514618d8b640365/yarl-1.20.1-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:1112ae8154186dfe2de4732197f59c05a83dc814849a5ced892b708033f40dc2", size = 89709, upload-time = "2025-06-10T00:43:48.22Z" },
    { url = "https://files.pythonhosted.org/packages/99/da/4d798025490e89426e9f976702e5f9482005c548c579bdae792a4c37769e/yarl-1.20.1-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:90bbd29c4fe234233f7fa2b9b121fb63c321830e5d05b45153a2ca68f7d310ee", size = 352287, upload-time = "2025-06-10T00:43:49.924Z" },
    { url = "https://files.pythonhosted.org/packages/1a/26/54a15c6a567aac1c61b18aa0f4b8aa2e285a52d547d1be8bf48abe2b3991/yarl-1.20.1-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:680e19c7ce3710ac4cd964e90dad99bf9b5029372ba0c7cbfcd55e54d90ea819", size = 345429, upload-time = "2025-06-10T00:43:51.7Z" },
    { url = "https://files.pythonhosted.org/packages/d6/95/9dcf2386cb875b234353b93ec43e40219e14900e046bf6ac118f94b1e353/yarl-1.20.1-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:4a979218c1fdb4246a05efc2cc23859d47c89af463a90b99b7c56094daf25a16", size = 365429, upload-time = "2025-06-10T00:43:53.494Z" },
    { url = "https://files.pythonhosted.org/packages/91/b2/33a8750f6a4bc224242a635f5f2cff6d6ad5ba651f6edcccf721992c21a0/yarl-1.20.1-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:255b468adf57b4a7b65d8aad5b5138dce6a0752c139965711bdcb81bc370e1b6", size = 363862, upload-time = "2025-06-10T00:43:55.766Z" },
    { url = "https://files.pythonhosted.org/packages/98/28/3ab7acc5b51f4434b181b0cee8f1f4b77a65919700a355fb3617f9488874/yarl-1.20.1-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:a97d67108e79cfe22e2b430d80d7571ae57d19f17cda8bb967057ca8a7bf5bfd", size = 355616, upload-time = "2025-06-10T00:43:58.056Z" },
    { url = "https://files.pythonhosted.org/packages/36/a3/f666894aa947a371724ec7cd2e5daa78ee8a777b21509b4252dd7bd15e29/yarl-1.20.1-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:8570d998db4ddbfb9a590b185a0a33dbf8aafb831d07a5257b4ec9948df9cb0a", size = 339954, upload-time = "2025-06-10T00:43:59.773Z" },
    { url = "https://files.pythonhosted.org/packages/f1/81/5f466427e09773c04219d3450d7a1256138a010b6c9f0af2d48565e9ad13/yarl-1.20.1-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:97c75596019baae7c71ccf1d8cc4738bc08134060d0adfcbe5642f778d1dca38", size = 365575, upload-time = "2025-06-10T00:44:02.051Z" },
    { url = "https://files.pythonhosted.org/packages/2e/e3/e4b0ad8403e97e6c9972dd587388940a032f030ebec196ab81a3b8e94d31/yarl-1.20.1-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:1c48912653e63aef91ff988c5432832692ac5a1d8f0fb8a33091520b5bbe19ef", size = 365061, upload-time = "2025-06-10T00:44:04.196Z" },
    { url = "https://files.pythonhosted.org/packages/ac/99/b8a142e79eb86c926f9f06452eb13ecb1bb5713bd01dc0038faf5452e544/yarl-1.20.1-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:4c3ae28f3ae1563c50f3d37f064ddb1511ecc1d5584e88c6b7c63cf7702a6d5f", size = 364142, upload-time = "2025-06-10T00:44:06.527Z" },
    { url = "https://files.pythonhosted.org/packages/34/f2/08ed34a4a506d82a1a3e5bab99ccd930a040f9b6449e9fd050320e45845c/yarl-1.20.1-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:c5e9642f27036283550f5f57dc6156c51084b458570b9d0d96100c8bebb186a8", size = 381894, upload-time = "2025-06-10T00:44:08.379Z" },
    { url = "https://files.pythonhosted.org/packages/92/f8/9a3fbf0968eac704f681726eff595dce9b49c8a25cd92bf83df209668285/yarl-1.20.1-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:2c26b0c49220d5799f7b22c6838409ee9bc58ee5c95361a4d7831f03cc225b5a", size = 383378, upload-time = "2025-06-10T00:44:10.51Z" },
    { url = "https://files.pythonhosted.org/packages/af/85/9363f77bdfa1e4d690957cd39d192c4cacd1c58965df0470a4905253b54f/yarl-1.20.1-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:564ab3d517e3d01c408c67f2e5247aad4019dcf1969982aba3974b4093279004", size = 374069, upload-time = "2025-06-10T00:44:12.834Z" },
    { url = "https://files.pythonhosted.org/packages/35/99/9918c8739ba271dcd935400cff8b32e3cd319eaf02fcd023d5dcd487a7c8/yarl-1.20.1-cp312-cp312-win32.whl", hash = "sha256:daea0d313868da1cf2fac6b2d3a25c6e3a9e879483244be38c8e6a41f1d876a5", size = 81249, upload-time = "2025-06-10T00:44:14.731Z" },
    { url = "https://files.pythonhosted.org/packages/eb/83/5d9092950565481b413b31a23e75dd3418ff0a277d6e0abf3729d4d1ce25/yarl-1.20.1-cp312-cp312-win_amd64.whl", hash = "sha256:48ea7d7f9be0487339828a4de0360d7ce0efc06524a48e1810f945c45b813698", size = 86710, upload-time = "2025-06-10T00:44:16.716Z" },
    { url = "https://files.pythonhosted.org/packages/8a/e1/2411b6d7f769a07687acee88a062af5833cf1966b7266f3d8dfb3d3dc7d3/yarl-1.20.1-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:0b5ff0fbb7c9f1b1b5ab53330acbfc5247893069e7716840c8e7d5bb7355038a", size = 131811, upload-time = "2025-06-10T00:44:18.933Z" },
    { url = "https://files.pythonhosted.org/packages/b2/27/584394e1cb76fb771371770eccad35de400e7b434ce3142c2dd27392c968/yarl-1.20.1-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:14f326acd845c2b2e2eb38fb1346c94f7f3b01a4f5c788f8144f9b630bfff9a3", size = 90078, upload-time = "2025-06-10T00:44:20.635Z" },
    { url = "https://files.pythonhosted.org/packages/bf/9a/3246ae92d4049099f52d9b0fe3486e3b500e29b7ea872d0f152966fc209d/yarl-1.20.1-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:f60e4ad5db23f0b96e49c018596707c3ae89f5d0bd97f0ad3684bcbad899f1e7", size = 88748, upload-time = "2025-06-10T00:44:22.34Z" },
    { url = "https://files.pythonhosted.org/packages/a3/25/35afe384e31115a1a801fbcf84012d7a066d89035befae7c5d4284df1e03/yarl-1.20.1-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:49bdd1b8e00ce57e68ba51916e4bb04461746e794e7c4d4bbc42ba2f18297691", size = 349595, upload-time = "2025-06-10T00:44:24.314Z" },
    { url = "https://files.pythonhosted.org/packages/28/2d/8aca6cb2cabc8f12efcb82749b9cefecbccfc7b0384e56cd71058ccee433/yarl-1.20.1-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:66252d780b45189975abfed839616e8fd2dbacbdc262105ad7742c6ae58f3e31", size = 342616, upload-time = "2025-06-10T00:44:26.167Z" },
    { url = "https://files.pythonhosted.org/packages/0b/e9/1312633d16b31acf0098d30440ca855e3492d66623dafb8e25b03d00c3da/yarl-1.20.1-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:59174e7332f5d153d8f7452a102b103e2e74035ad085f404df2e40e663a22b28", size = 361324, upload-time = "2025-06-10T00:44:27.915Z" },
    { url = "https://files.pythonhosted.org/packages/bc/a0/688cc99463f12f7669eec7c8acc71ef56a1521b99eab7cd3abb75af887b0/yarl-1.20.1-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:e3968ec7d92a0c0f9ac34d5ecfd03869ec0cab0697c91a45db3fbbd95fe1b653", size = 359676, upload-time = "2025-06-10T00:44:30.041Z" },
    { url = "https://files.pythonhosted.org/packages/af/44/46407d7f7a56e9a85a4c207724c9f2c545c060380718eea9088f222ba697/yarl-1.20.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:d1a4fbb50e14396ba3d375f68bfe02215d8e7bc3ec49da8341fe3157f59d2ff5", size = 352614, upload-time = "2025-06-10T00:44:32.171Z" },
    { url = "https://files.pythonhosted.org/packages/b1/91/31163295e82b8d5485d31d9cf7754d973d41915cadce070491778d9c9825/yarl-1.20.1-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:11a62c839c3a8eac2410e951301309426f368388ff2f33799052787035793b02", size = 336766, upload-time = "2025-06-10T00:44:34.494Z" },
    { url = "https://files.pythonhosted.org/packages/b4/8e/c41a5bc482121f51c083c4c2bcd16b9e01e1cf8729e380273a952513a21f/yarl-1.20.1-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:041eaa14f73ff5a8986b4388ac6bb43a77f2ea09bf1913df7a35d4646db69e53", size = 364615, upload-time = "2025-06-10T00:44:36.856Z" },
    { url = "https://files.pythonhosted.org/packages/e3/5b/61a3b054238d33d70ea06ebba7e58597891b71c699e247df35cc984ab393/yarl-1.20.1-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:377fae2fef158e8fd9d60b4c8751387b8d1fb121d3d0b8e9b0be07d1b41e83dc", size = 360982, upload-time = "2025-06-10T00:44:39.141Z" },
    { url = "https://files.pythonhosted.org/packages/df/a3/6a72fb83f8d478cb201d14927bc8040af901811a88e0ff2da7842dd0ed19/yarl-1.20.1-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:1c92f4390e407513f619d49319023664643d3339bd5e5a56a3bebe01bc67ec04", size = 369792, upload-time = "2025-06-10T00:44:40.934Z" },
    { url = "https://files.pythonhosted.org/packages/7c/af/4cc3c36dfc7c077f8dedb561eb21f69e1e9f2456b91b593882b0b18c19dc/yarl-1.20.1-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:d25ddcf954df1754ab0f86bb696af765c5bfaba39b74095f27eececa049ef9a4", size = 382049, upload-time = "2025-06-10T00:44:42.854Z" },
    { url = "https://files.pythonhosted.org/packages/19/3a/e54e2c4752160115183a66dc9ee75a153f81f3ab2ba4bf79c3c53b33de34/yarl-1.20.1-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:909313577e9619dcff8c31a0ea2aa0a2a828341d92673015456b3ae492e7317b", size = 384774, upload-time = "2025-06-10T00:44:45.275Z" },
    { url = "https://files.pythonhosted.org/packages/9c/20/200ae86dabfca89060ec6447649f219b4cbd94531e425e50d57e5f5ac330/yarl-1.20.1-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:793fd0580cb9664548c6b83c63b43c477212c0260891ddf86809e1c06c8b08f1", size = 374252, upload-time = "2025-06-10T00:44:47.31Z" },
    { url = "https://files.pythonhosted.org/packages/83/75/11ee332f2f516b3d094e89448da73d557687f7d137d5a0f48c40ff211487/yarl-1.20.1-cp313-cp313-win32.whl", hash = "sha256:468f6e40285de5a5b3c44981ca3a319a4b208ccc07d526b20b12aeedcfa654b7", size = 81198, upload-time = "2025-06-10T00:44:49.164Z" },
    { url = "https://files.pythonhosted.org/packages/ba/ba/39b1ecbf51620b40ab402b0fc817f0ff750f6d92712b44689c2c215be89d/yarl-1.20.1-cp313-cp313-win_amd64.whl", hash = "sha256:495b4ef2fea40596bfc0affe3837411d6aa3371abcf31aac0ccc4bdd64d4ef5c", size = 86346, upload-time = "2025-06-10T00:44:51.182Z" },
    { url = "https://files.pythonhosted.org/packages/43/c7/669c52519dca4c95153c8ad96dd123c79f354a376346b198f438e56ffeb4/yarl-1.20.1-cp313-cp313t-macosx_10_13_universal2.whl", hash = "sha256:f60233b98423aab21d249a30eb27c389c14929f47be8430efa7dbd91493a729d", size = 138826, upload-time = "2025-06-10T00:44:52.883Z" },
    { url = "https://files.pythonhosted.org/packages/6a/42/fc0053719b44f6ad04a75d7f05e0e9674d45ef62f2d9ad2c1163e5c05827/yarl-1.20.1-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:6f3eff4cc3f03d650d8755c6eefc844edde99d641d0dcf4da3ab27141a5f8ddf", size = 93217, upload-time = "2025-06-10T00:44:54.658Z" },
    { url = "https://files.pythonhosted.org/packages/4f/7f/fa59c4c27e2a076bba0d959386e26eba77eb52ea4a0aac48e3515c186b4c/yarl-1.20.1-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:69ff8439d8ba832d6bed88af2c2b3445977eba9a4588b787b32945871c2444e3", size = 92700, upload-time = "2025-06-10T00:44:56.784Z" },
    { url = "https://files.pythonhosted.org/packages/2f/d4/062b2f48e7c93481e88eff97a6312dca15ea200e959f23e96d8ab898c5b8/yarl-1.20.1-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:3cf34efa60eb81dd2645a2e13e00bb98b76c35ab5061a3989c7a70f78c85006d", size = 347644, upload-time = "2025-06-10T00:44:59.071Z" },
    { url = "https://files.pythonhosted.org/packages/89/47/78b7f40d13c8f62b499cc702fdf69e090455518ae544c00a3bf4afc9fc77/yarl-1.20.1-cp313-cp313t-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:8e0fe9364ad0fddab2688ce72cb7a8e61ea42eff3c7caeeb83874a5d479c896c", size = 323452, upload-time = "2025-06-10T00:45:01.605Z" },
    { url = "https://files.pythonhosted.org/packages/eb/2b/490d3b2dc66f52987d4ee0d3090a147ea67732ce6b4d61e362c1846d0d32/yarl-1.20.1-cp313-cp313t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:8f64fbf81878ba914562c672024089e3401974a39767747691c65080a67b18c1", size = 346378, upload-time = "2025-06-10T00:45:03.946Z" },
    { url = "https://files.pythonhosted.org/packages/66/ad/775da9c8a94ce925d1537f939a4f17d782efef1f973039d821cbe4bcc211/yarl-1.20.1-cp313-cp313t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:f6342d643bf9a1de97e512e45e4b9560a043347e779a173250824f8b254bd5ce", size = 353261, upload-time = "2025-06-10T00:45:05.992Z" },
    { url = "https://files.pythonhosted.org/packages/4b/23/0ed0922b47a4f5c6eb9065d5ff1e459747226ddce5c6a4c111e728c9f701/yarl-1.20.1-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:56dac5f452ed25eef0f6e3c6a066c6ab68971d96a9fb441791cad0efba6140d3", size = 335987, upload-time = "2025-06-10T00:45:08.227Z" },
    { url = "https://files.pythonhosted.org/packages/3e/49/bc728a7fe7d0e9336e2b78f0958a2d6b288ba89f25a1762407a222bf53c3/yarl-1.20.1-cp313-cp313t-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:c7d7f497126d65e2cad8dc5f97d34c27b19199b6414a40cb36b52f41b79014be", size = 329361, upload-time = "2025-06-10T00:45:10.11Z" },
    { url = "https://files.pythonhosted.org/packages/93/8f/b811b9d1f617c83c907e7082a76e2b92b655400e61730cd61a1f67178393/yarl-1.20.1-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:67e708dfb8e78d8a19169818eeb5c7a80717562de9051bf2413aca8e3696bf16", size = 346460, upload-time = "2025-06-10T00:45:12.055Z" },
    { url = "https://files.pythonhosted.org/packages/70/fd/af94f04f275f95da2c3b8b5e1d49e3e79f1ed8b6ceb0f1664cbd902773ff/yarl-1.20.1-cp313-cp313t-musllinux_1_2_armv7l.whl", hash = "sha256:595c07bc79af2494365cc96ddeb772f76272364ef7c80fb892ef9d0649586513", size = 334486, upload-time = "2025-06-10T00:45:13.995Z" },
    { url = "https://files.pythonhosted.org/packages/84/65/04c62e82704e7dd0a9b3f61dbaa8447f8507655fd16c51da0637b39b2910/yarl-1.20.1-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:7bdd2f80f4a7df852ab9ab49484a4dee8030023aa536df41f2d922fd57bf023f", size = 342219, upload-time = "2025-06-10T00:45:16.479Z" },
    { url = "https://files.pythonhosted.org/packages/91/95/459ca62eb958381b342d94ab9a4b6aec1ddec1f7057c487e926f03c06d30/yarl-1.20.1-cp313-cp313t-musllinux_1_2_ppc64le.whl", hash = "sha256:c03bfebc4ae8d862f853a9757199677ab74ec25424d0ebd68a0027e9c639a390", size = 350693, upload-time = "2025-06-10T00:45:18.399Z" },
    { url = "https://files.pythonhosted.org/packages/a6/00/d393e82dd955ad20617abc546a8f1aee40534d599ff555ea053d0ec9bf03/yarl-1.20.1-cp313-cp313t-musllinux_1_2_s390x.whl", hash = "sha256:344d1103e9c1523f32a5ed704d576172d2cabed3122ea90b1d4e11fe17c66458", size = 355803, upload-time = "2025-06-10T00:45:20.677Z" },
    { url = "https://files.pythonhosted.org/packages/9e/ed/c5fb04869b99b717985e244fd93029c7a8e8febdfcffa06093e32d7d44e7/yarl-1.20.1-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:88cab98aa4e13e1ade8c141daeedd300a4603b7132819c484841bb7af3edce9e", size = 341709, upload-time = "2025-06-10T00:45:23.221Z" },
    { url = "https://files.pythonhosted.org/packages/24/fd/725b8e73ac2a50e78a4534ac43c6addf5c1c2d65380dd48a9169cc6739a9/yarl-1.20.1-cp313-cp313t-win32.whl", hash = "sha256:b121ff6a7cbd4abc28985b6028235491941b9fe8fe226e6fdc539c977ea1739d", size = 86591, upload-time = "2025-06-10T00:45:25.793Z" },
    { url = "https://files.pythonhosted.org/packages/94/c3/b2e9f38bc3e11191981d57ea08cab2166e74ea770024a646617c9cddd9f6/yarl-1.20.1-cp313-cp313t-win_amd64.whl", hash = "sha256:541d050a355bbbc27e55d906bc91cb6fe42f96c01413dd0f4ed5a5240513874f", size = 93003, upload-time = "2025-06-10T00:45:27.752Z" },
    { url = "https://files.pythonhosted.org/packages/b4/2d/2345fce04cfd4bee161bf1e7d9cdc702e3e16109021035dbb24db654a622/yarl-1.20.1-py3-none-any.whl", hash = "sha256:83b8eb083fe4683c6115795d9fc1cfaf2cbbefb19b3a1cb68f6527460f483a77", size = 46542, upload-time = "2025-06-10T00:46:07.521Z" },
]


# END FILE CONTENTS


# File: frontend/components/ui/menubar.tsx

"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const MenubarMenu = MenubarPrimitive.Menu

const MenubarGroup = MenubarPrimitive.Group

const MenubarPortal = MenubarPrimitive.Portal

const MenubarSub = MenubarPrimitive.Sub

const MenubarRadioGroup = MenubarPrimitive.RadioGroup

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}


# END FILE CONTENTS


# File: frontend/components/ui/use-mobile.tsx

import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}


# END FILE CONTENTS


# File: frontend/lib/__tests__/rest-audio-uploader-409.test.ts

/**
 * RestAudioUploader 409 è¡çªè™•ç†æ¸¬è©¦
 * æ¸¬è©¦éŸ³é »æ®µè½ä¸Šå‚³æ™‚é‡åˆ°åºè™Ÿè¡çªçš„è™•ç†é‚è¼¯
 */

import { describe, test, expect, vi, beforeEach, afterEach } from 'vitest'
import { RestAudioUploader } from '../rest-audio-uploader'

// Mock fetch å…¨åŸŸå‡½æ•¸
const mockFetch = vi.fn()
global.fetch = mockFetch

// Mock console æ–¹æ³•
const consoleSpy = {
    log: vi.spyOn(console, 'log'),
    error: vi.spyOn(console, 'error')
}

describe('RestAudioUploader - 409 è¡çªè™•ç†', () => {
    let uploader: RestAudioUploader
    const sessionId = 'test-session-123'
    const testBlob = new Blob(['test audio data'], { type: 'audio/webm' })

    beforeEach(() => {
        uploader = new RestAudioUploader()
        uploader.setSessionId(sessionId)
        // åªæ¸…é™¤ fetch mockï¼Œä¿ç•™ console spy
        mockFetch.mockClear()
        consoleSpy.log.mockClear()
        consoleSpy.error.mockClear()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('HTTP 409 éŒ¯èª¤è™•ç†', () => {
        test('ç•¶é‡åˆ° 409 éŒ¯èª¤æ™‚ï¼Œæ‡‰è©²è¦–ç‚ºå†ªç­‰æˆåŠŸ', async () => {
            // Arrange
            const sequence = 5
            const mockResponse = {
                ok: false,
                status: 409,
                statusText: 'Conflict'
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            // Mock æˆåŠŸå›èª¿
            const onSuccessCallback = vi.fn()
            uploader.onUploadSuccess(onSuccessCallback)

            // Act
            const result = await uploader.uploadSegment(sequence, testBlob)

            // Assert
            expect(result).toEqual({
                ack: sequence,
                size: testBlob.size,
                status: 'success'
            })
            expect(onSuccessCallback).toHaveBeenCalledWith(sequence, {
                ack: sequence,
                size: testBlob.size,
                status: 'success'
            })
            expect(consoleSpy.log).toHaveBeenCalledWith(
                `âœ… [RestAudioUploader] æ®µè½ #${sequence} å·²å­˜åœ¨ï¼Œè¦–ç‚ºä¸Šå‚³æˆåŠŸ`
            )
        })

        test('409 éŒ¯èª¤æ‡‰è©²é‡ç½®é‡è©¦è¨ˆæ•¸ï¼ˆé€éæˆåŠŸå›èª¿é©—è­‰ï¼‰', async () => {
            // Arrange
            const sequence = 3
            const mockResponse = {
                ok: false,
                status: 409,
                statusText: 'Conflict'
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            const onSuccessCallback = vi.fn()
            uploader.onUploadSuccess(onSuccessCallback)

            // Act
            await uploader.uploadSegment(sequence, testBlob)

            // Assert - é©—è­‰æˆåŠŸå›èª¿è¢«è§¸ç™¼ï¼Œèªªæ˜ 409 è¢«è¦–ç‚ºæˆåŠŸ
            expect(onSuccessCallback).toHaveBeenCalledWith(sequence, {
                ack: sequence,
                size: testBlob.size,
                status: 'success'
            })
        })

        test('409 éŒ¯èª¤ä¸æ‡‰è©²è§¸ç™¼éŒ¯èª¤å›èª¿', async () => {
            // Arrange
            const sequence = 1
            const mockResponse = {
                ok: false,
                status: 409,
                statusText: 'Conflict'
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            const onErrorCallback = vi.fn()
            uploader.onUploadError(onErrorCallback)

            // Act
            await uploader.uploadSegment(sequence, testBlob)

            // Assert
            expect(onErrorCallback).not.toHaveBeenCalled()
        })
    })

    describe('å…¶ä»– HTTP éŒ¯èª¤è™•ç†', () => {
        test('é 409 éŒ¯èª¤æ‡‰è©²æ­£å¸¸æ‹‹å‡ºç•°å¸¸', async () => {
            // Arrange
            const sequence = 2
            const mockResponse = {
                ok: false,
                status: 500,
                statusText: 'Internal Server Error'
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            // Act & Assert
            await expect(uploader.uploadSegment(sequence, testBlob))
                .rejects.toThrow('HTTP 500: Internal Server Error')
        })

        test('ç¶²è·¯éŒ¯èª¤æ‡‰è©²æ­£å¸¸æ‹‹å‡ºç•°å¸¸', async () => {
            // Arrange
            const sequence = 4
            const networkError = new Error('Network Error')
            mockFetch.mockRejectedValueOnce(networkError)

            // Act & Assert
            await expect(uploader.uploadSegment(sequence, testBlob))
                .rejects.toThrow('Network Error')
        })
    })

    describe('æˆåŠŸä¸Šå‚³è™•ç†', () => {
        test('æˆåŠŸä¸Šå‚³æ‡‰è©²æ­£å¸¸è™•ç†', async () => {
            // Arrange
            const sequence = 0
            const successResponse = {
                ack: sequence,
                size: testBlob.size,
                status: 'success'
            }
            const mockResponse = {
                ok: true,
                json: () => Promise.resolve(successResponse)
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            const onSuccessCallback = vi.fn()
            uploader.onUploadSuccess(onSuccessCallback)

            // Act
            const result = await uploader.uploadSegment(sequence, testBlob)

            // Assert
            expect(result).toEqual(successResponse)
            expect(onSuccessCallback).toHaveBeenCalledWith(sequence, successResponse)
            // åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œç§»é™¤ console.log æª¢æŸ¥
        })
    })

    describe('åºè™Ÿé‡ç½®æ©Ÿåˆ¶', () => {
        test('resetSequence æ‡‰è©²æ­£å¸¸åŸ·è¡Œä¸¦è¨˜éŒ„æ—¥èªŒ', () => {
            // Act
            uploader.resetSequence()

            // Assert
            // åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œç§»é™¤ console.log æª¢æŸ¥
        })
    })

    describe('é‚Šç·£æƒ…æ³æ¸¬è©¦', () => {
        test('å¤šå€‹ 409 éŒ¯èª¤æ‡‰è©²éƒ½è¢«æ­£ç¢ºè™•ç†', async () => {
            // Arrange
            const sequences = [0, 1, 2, 3, 4]
            const mockResponse = {
                ok: false,
                status: 409,
                statusText: 'Conflict'
            }

            sequences.forEach(() => {
                mockFetch.mockResolvedValueOnce(mockResponse)
            })

            const onSuccessCallback = vi.fn()
            uploader.onUploadSuccess(onSuccessCallback)

            // Act
            const results = await Promise.all(
                sequences.map(seq => uploader.uploadSegment(seq, testBlob))
            )

            // Assert
            results.forEach((result, index) => {
                expect(result).toEqual({
                    ack: sequences[index],
                    size: testBlob.size,
                    status: 'success'
                })
            })
            expect(onSuccessCallback).toHaveBeenCalledTimes(sequences.length)
        })

        test('Session ID æœªè¨­å®šæ™‚æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            const uploaderWithoutSession = new RestAudioUploader()

            // Act & Assert
            await expect(uploaderWithoutSession.uploadSegment(0, testBlob))
                .rejects.toThrow('Session ID æœªè¨­å®š')
        })
    })
})


# END FILE CONTENTS


# File: frontend/types/app-state.ts

// å‰ç«¯æ‡‰ç”¨ç‹€æ…‹ - å°æ‡‰ PRD å››ç‹€æ…‹æµç¨‹
export type AppState =
  | "default"     // é è¨­ç•«é¢ï¼šå¯å¯«ç­†è¨˜ï¼Œé¡¯ç¤ºéŒ„éŸ³æŒ‰éˆ•
  | "recording_waiting" // éŒ„éŸ³ç•«é¢ï¼šéŒ„éŸ³ä¸­ï¼Œå°šæœªæ”¶åˆ°é€å­—ç¨¿
  | "recording_active"  // éŒ„éŸ³ç•«é¢ï¼šéŒ„éŸ³ä¸­ï¼Œå·²é¡¯ç¤ºé€å­—ç¨¿
  | "processing"  // è™•ç†ç•«é¢ï¼šåœæ­¢éŒ„éŸ³å¾Œï¼Œè™•ç†å‰©é¤˜é€å­—ç¨¿
  | "finished"    // å®Œæ•´é€å­—ç¨¿ç•«é¢ï¼šå¯ç·¨è¼¯ç­†è¨˜ã€åŒ¯å‡ºã€é–‹æ–°ç­†è¨˜

export interface TranscriptEntry {
  startTime?: number
  time: string
  text: string
  provider?: 'whisper' | 'gemini'  // STT Provider æ¨™è­˜
}

export interface AppData {
  state: AppState
  editorContent: string
  transcriptEntries: TranscriptEntry[]
  isRecording: boolean
  recordingTime: number
  session?: {
    id: string
    status: SessionStatus
    type: SessionType
  } | null
}

// å¾Œç«¯ Session ç‹€æ…‹å°æ‡‰å‰ç«¯ç‹€æ…‹
export type SessionStatus = "draft" | "active" | "processing" | "completed" | "error"
export type SessionType = "note_only" | "recording"

// ç‹€æ…‹æ˜ å°„ä»‹é¢
export interface StateMapping {
  frontendState: AppState
  backendStatus: SessionStatus
  sessionType: SessionType
}


# END FILE CONTENTS


# File: frontend/hooks/use-recording.ts

"use client"

import { useState, useCallback, useRef, useEffect } from 'react'
import { AckMissingMessage } from '../lib/websocket'
import { SegmentedAudioRecorder, AudioSegment } from '../lib/segmented-audio-recorder'
import { audioUploader } from '../lib/stream/audio-uploader'
import { transcriptManager, TranscriptMessage } from '../lib/transcript-manager'
import { getAudioChunkIntervalMs } from '../lib/config'
import { useAppActions } from '../lib/app-store-zustand'

interface UseRecordingReturn {
  isRecording: boolean
  recordingTime: number
  transcripts: TranscriptMessage[]
  transcriptCompleted: boolean
  error: string | null
  startRecording: (sessionId: string) => Promise<void>
  stopRecording: () => void
  clearTranscripts: () => void
}

export function useRecording(): UseRecordingReturn {
  const [isRecording, setIsRecording] = useState(false)
  const [recordingTime, setRecordingTime] = useState(0)
  const [transcripts, setTranscripts] = useState<TranscriptMessage[]>([])
  const [transcriptCompleted, setTranscriptCompleted] = useState(false)
  const [error, setError] = useState<string | null>(null)

  // å¾ Zustand store ç²å–æ“ä½œ
  const { setRecordingStart } = useAppActions()

  // WebSocket å’ŒéŒ„éŸ³å™¨å¼•ç”¨
  const segmentedRecorderRef = useRef<SegmentedAudioRecorder | null>(null)
  const currentSessionIdRef = useRef<string | null>(null)

  // è¨ˆæ™‚å™¨å’Œç‹€æ…‹å¼•ç”¨
  const timerRef = useRef<NodeJS.Timeout | null>(null)
  const segmentsRef = useRef<AudioSegment[]>([])
  const retryCountsRef = useRef<Map<number, number>>(new Map())
  const fallbackTimerRef = useRef<NodeJS.Timeout | null>(null) // æ–°å¢ï¼šfallback è¨ˆæ™‚å™¨

  // æ¸…ç†è¨ˆæ™‚å™¨
  const clearTimer = useCallback(() => {
    if (timerRef.current) {
      clearInterval(timerRef.current)
      timerRef.current = null
    }
    if (fallbackTimerRef.current) {
      clearTimeout(fallbackTimerRef.current)
      fallbackTimerRef.current = null
    }
  }, [])

  // é–‹å§‹éŒ„éŸ³è¨ˆæ™‚å™¨ï¼ˆåŸºæ–¼å¯¦éš›æ™‚é–“æˆ³ï¼‰
  const startTimer = useCallback(() => {
    clearTimer()
    setRecordingTime(0)
    const startTime = Date.now()

    timerRef.current = setInterval(() => {
      const elapsed = Math.floor((Date.now() - startTime) / 1000)
      setRecordingTime(elapsed)
    }, 1000)

    console.log('â±ï¸ [useRecording] éŒ„éŸ³è¨ˆæ™‚å™¨å·²å•Ÿå‹•')
  }, [clearTimer])

  // è™•ç†éŒ„éŸ³çœŸæ­£é–‹å§‹ï¼ˆonstart äº‹ä»¶ï¼‰
  const handleRecordingStart = useCallback(() => {
    const startTime = Date.now()
    console.log('ğŸš€ [useRecording] éŒ„éŸ³çœŸæ­£é–‹å§‹ï¼Œè¨­ç½®é–‹å§‹æ™‚é–“:', new Date(startTime).toISOString())

    // è¨­ç½®åˆ° Zustand store
    setRecordingStart(startTime)

    // åŒæ™‚æ›´æ–°æœ¬åœ°è¨ˆæ™‚å™¨
    startTimer()

    // æ¸…é™¤ fallback è¨ˆæ™‚å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if (fallbackTimerRef.current) {
      clearTimeout(fallbackTimerRef.current)
      fallbackTimerRef.current = null
    }
  }, [setRecordingStart, startTimer])

  // è™•ç†é€å­—ç¨¿æ¥æ”¶ - é€é TranscriptManager
  const handleTranscript = useCallback((transcript: TranscriptMessage) => {
    console.log('ğŸ“ [useRecording] æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯:', {
      type: transcript.type,
      text: transcript.text,
      textLength: transcript.text?.length || 0,
      start_time: transcript.start_time,
      end_time: transcript.end_time,
      start_sequence: transcript.start_sequence,
      confidence: transcript.confidence,
      sessionId: currentSessionIdRef.current,
      timestamp: new Date().toISOString(),
      fullMessage: transcript
    })

    // è™•ç†è½‰éŒ„å®Œæˆé€šçŸ¥
    if (transcript.type === 'transcript_complete' || transcript.message === 'transcription_complete') {
      console.log('âœ… [useRecording] é€å­—ç¨¿è½‰éŒ„å®Œæˆï¼Œè¨­å®š transcriptCompleted=true')
      setTranscriptCompleted(true)
      return
    }

    // è™•ç† active phase è¨Šæ¯ï¼ˆé‡è¦ï¼šé€™æœƒè§¸ç™¼ç‹€æ…‹è½‰æ›ï¼‰
    if (transcript.type === 'active' || transcript.phase === 'active') {
      console.log('ğŸš€ [useRecording] æ”¶åˆ° active phase è¨Šæ¯ï¼Œè½‰éŒ„é–‹å§‹')
      // é€™è£¡å¯ä»¥è¨­ç½®ä¸€å€‹æ¨™è¨˜ï¼Œè¡¨ç¤ºè½‰éŒ„å·²é–‹å§‹
      return
    }

    // åªè™•ç†é€å­—ç¨¿ç‰‡æ®µé¡å‹çš„è¨Šæ¯
    if (transcript.type !== 'transcript_segment') {
      console.log('âš ï¸ [useRecording] è·³ééé€å­—ç¨¿ç‰‡æ®µè¨Šæ¯:', transcript.type)
      return
    }

    if (!transcript.text) {
      console.log('âš ï¸ [useRecording] è·³éç©ºæ–‡å­—é€å­—ç¨¿')
      return
    }

    console.log('ğŸ”„ [useRecording] é–‹å§‹è™•ç†é€å­—ç¨¿ç‰‡æ®µ...', {
      text: transcript.text,
      textPreview: transcript.text.substring(0, 50) + '...',
      sequence: transcript.start_sequence,
      startTime: transcript.start_time,
      endTime: transcript.end_time
    })

    setTranscripts((prev) => {
      console.log('ğŸ“Š [useRecording] åˆä½µå‰ç‹€æ…‹:', {
        existingCount: prev.length,
        newSegmentText: transcript.text,
        newSegmentSequence: transcript.start_sequence,
        newSegmentTime: transcript.start_time
      })

      // ä½¿ç”¨ start_sequence ä½œç‚ºæ’åºä¾æ“šï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨æ™‚é–“æˆ³
      const sequence = transcript.start_sequence ?? transcript.timestamp ?? 0

      // ä¾ç…§åºè™Ÿæ’åºä¸¦å»é‡
      const filtered = prev.filter(t => {
        const existingSequence = t.start_sequence ?? t.timestamp ?? 0
        return existingSequence !== sequence
      })

      const updated = [...filtered, transcript].sort((a, b) => {
        const aSequence = a.start_sequence ?? a.timestamp ?? 0
        const bSequence = b.start_sequence ?? b.timestamp ?? 0
        return aSequence - bSequence
      })

      console.log('ğŸ“Š [useRecording] åˆä½µå¾Œç‹€æ…‹:', {
        newCount: updated.length,
        countChange: updated.length - prev.length,
        filteredCount: filtered.length,
        isDuplicate: filtered.length === prev.length ? false : true,
        lastSegmentText: updated[updated.length - 1]?.text?.substring(0, 50) + '...'
      })

      console.log(`âœ… [useRecording] é€å­—ç¨¿æ›´æ–°å®Œæˆ: ${prev.length} â†’ ${updated.length} å€‹ç‰‡æ®µ`)
      return updated
    })
  }, [])

  // è™•ç† ACK/Missing è¨Šæ¯ - æ”¯æ´é‡å‚³æ©Ÿåˆ¶
  const handleAckMissing = useCallback((data: AckMissingMessage) => {
    console.log('ğŸ“¨ [useRecording] æ”¶åˆ° ACK/Missing:', data)

    if (data.missing.length > 0) {
      console.warn('âš ï¸ [useRecording] æœ‰éºå¤±çš„éŸ³æª”æ®µè½éœ€è¦é‡å‚³:', data.missing)

      // é‡ç™¼éºå¤±çš„æ®µè½
      data.missing.forEach(async (sequence) => {
        if (segmentsRef.current[sequence]) {
          await audioUploader.send(segmentsRef.current[sequence].blob, sequence)
        }
      })
    }
  }, [])

  // è™•ç†éŸ³æª”æ®µè½ - ä¸å†è² è²¬å•Ÿå‹•è¨ˆæ™‚
  const handleAudioSegment = useCallback(async (segment: AudioSegment) => {
    console.log(`ğŸµ [useRecording] æ”¶åˆ°éŸ³æª”æ®µè½ #${segment.sequence}, å¤§å°: ${segment.blob.size} bytes`)

    // å„²å­˜æ®µè½ä¾›é‡å‚³ä½¿ç”¨
    segmentsRef.current[segment.sequence] = segment

    // ä½¿ç”¨æ”¹å–„çš„ AudioUploader ç™¼é€
    if (audioUploader.isConnected) {
      await audioUploader.send(segment.blob, segment.sequence)
    } else {
      console.warn('âš ï¸ [useRecording] AudioUploader æœªé€£æ¥ï¼Œç„¡æ³•ç™¼é€æ®µè½')
    }
  }, [])

  // é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨ onstart äº‹ä»¶
  const startRecording = useCallback(async (sessionId: string): Promise<void> => {
    try {
      setError(null)
      setTranscriptCompleted(false)
      currentSessionIdRef.current = sessionId

      console.log('ğŸ¤ [useRecording] é–‹å§‹éŒ„éŸ³æµç¨‹:', { sessionId })

      // ç¢ºä¿åœ¨ç€è¦½å™¨ç’°å¢ƒä¸­åŸ·è¡Œ
      if (typeof window === 'undefined') {
        throw new Error('æ­¤åŠŸèƒ½åƒ…åœ¨ç€è¦½å™¨ç’°å¢ƒä¸­å¯ç”¨')
      }

      // æ­¥é©Ÿ 1: å»ºç«‹åˆ†æ®µå¼éŸ³æª”éŒ„è£½å™¨
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 1: åˆå§‹åŒ–åˆ†æ®µå¼éŸ³æª”éŒ„è£½å™¨')
      const segmentedRecorder = new SegmentedAudioRecorder({
        segmentDuration: getAudioChunkIntervalMs(), // å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
        mimeType: 'audio/webm;codecs=opus',
        audioBitsPerSecond: 64000 // 64 kbps
      })

      console.log('ğŸ¤ [useRecording] éŸ³è¨Šé…ç½®: WebM Opus, 64 kbps, 15 ç§’åˆ‡ç‰‡')

      segmentedRecorderRef.current = segmentedRecorder
      segmentsRef.current = []
      retryCountsRef.current.clear()

      // è¨­å®šéŸ³æª”éŒ„è£½å™¨äº‹ä»¶
      segmentedRecorder.onError((err) => {
        console.error('âŒ [useRecording] SegmentedAudioRecorder éŒ¯èª¤:', err)
        setError(err.message)
      })

      // æ–°å¢ï¼šè¨­å®šéŒ„éŸ³é–‹å§‹å›èª¿
      segmentedRecorder.onStart(handleRecordingStart)

      // æ­¥é©Ÿ 2: åˆå§‹åŒ–éŸ³è¨Šæ¬Šé™
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 2: åˆå§‹åŒ–éŸ³è¨Šæ¬Šé™')
      await segmentedRecorder.initialize()

      // æ­¥é©Ÿ 3: å»ºç«‹ WebSocket é€£ç·šï¼ˆä¸¦è¡Œå»ºç«‹ï¼Œç¢ºä¿éƒ½å°±ç·’ï¼‰
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 3: å»ºç«‹ WebSocket é€£ç·š')

      // 3a. å»ºç«‹éŸ³æª”ä¸Šå‚³é€£ç·šï¼ˆä½¿ç”¨æ”¹å–„çš„ AudioUploaderï¼‰
      console.log('ğŸ”Œ [useRecording] å»ºç«‹éŸ³æª”ä¸Šå‚³é€£ç·š')
      await audioUploader.connect(sessionId)

      // 3b. å»ºç«‹é€å­—ç¨¿æ¥æ”¶ WebSocketï¼ˆé€é TranscriptManagerï¼‰
      console.log('ğŸ”Œ [useRecording] å»ºç«‹é€å­—ç¨¿æ¥æ”¶ WebSocket')
      await transcriptManager.connect(sessionId)
      transcriptManager.addListener(sessionId, handleTranscript)

      // æ­¥é©Ÿ 4: é©—è­‰é€£ç·šç‹€æ…‹
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 4: é©—è­‰é€£ç·šç‹€æ…‹')
      if (!audioUploader.isConnected) {
        throw new Error('éŸ³æª”ä¸Šå‚³ AudioUploader é€£ç·šå¤±æ•—')
      }

      if (!transcriptManager.isConnected(sessionId)) {
        throw new Error('é€å­—ç¨¿æ¥æ”¶ WebSocket é€£ç·šå¤±æ•—')
      }

      console.log('âœ… [useRecording] æ‰€æœ‰é€£ç·šå·²å»ºç«‹')

      // æ­¥é©Ÿ 5: é–‹å§‹åˆ†æ®µéŒ„éŸ³
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 5: é–‹å§‹åˆ†æ®µéŒ„éŸ³')

      // å…ˆè¨­ç½®éŒ„éŸ³ç‹€æ…‹ï¼Œç¢ºä¿ç‹€æ…‹æ˜ å°„æ­£ç¢º
      setIsRecording(true)
      console.log('ğŸ¤ [useRecording] éŒ„éŸ³ç‹€æ…‹å·²è¨­ç½®ç‚º true')

      // è¨­ç½® fallback è¨ˆæ™‚å™¨ï¼šå¦‚æœ 10 ç§’å¾Œ onstart é‚„æ²’è§¸ç™¼ï¼Œä½¿ç”¨èˆŠé‚è¼¯
      fallbackTimerRef.current = setTimeout(() => {
        console.warn('âš ï¸ [useRecording] onstart äº‹ä»¶ 10 ç§’å…§æœªè§¸ç™¼ï¼Œä½¿ç”¨ fallback è¨ˆæ™‚å™¨')
        handleRecordingStart()
      }, 10000)

      await segmentedRecorder.start(handleAudioSegment)
      console.log('â³ [useRecording] ç­‰å¾… onstart äº‹ä»¶å•Ÿå‹•è¨ˆæ™‚å™¨')

      console.log('âœ… [useRecording] éŒ„éŸ³é–‹å§‹æˆåŠŸï¼ŒSession ID:', sessionId)

    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ [useRecording] é–‹å§‹éŒ„éŸ³å¤±æ•—:', err)

      // éŒ¯èª¤æ™‚æ¸…ç†è³‡æº
      if (segmentedRecorderRef.current) {
        segmentedRecorderRef.current.stop()
        segmentedRecorderRef.current.cleanup()
      }
      if (audioUploader.isConnected) {
        audioUploader.close()
      }
      if (currentSessionIdRef.current) {
        transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
      }
      clearTimer()
    }
  }, [handleAudioSegment, handleAckMissing, handleTranscript, handleRecordingStart, clearTimer])

  // åœæ­¢éŒ„éŸ³
  const stopRecording = useCallback(() => {
    try {
      // åœæ­¢åˆ†æ®µå¼éŸ³æª”éŒ„è£½å™¨
      if (segmentedRecorderRef.current) {
        segmentedRecorderRef.current.stop()
      }

      // é—œé–‰éŸ³æª”ä¸Šå‚³é€£ç·š
      if (audioUploader.isConnected) {
        audioUploader.close()
      }

      setIsRecording(false)
      clearTimer()

      console.log('âœ… [useRecording] éŒ„éŸ³åœæ­¢ï¼Œç­‰å¾…è½‰éŒ„å®Œæˆ')

      // æ³¨æ„ï¼šä¸æ–·é–‹ TranscriptManager é€£æ¥ï¼Œç¹¼çºŒæ¥æ”¶è½‰éŒ„çµæœ

    } catch (err) {
      console.error('âŒ [useRecording] åœæ­¢éŒ„éŸ³å¤±æ•—:', err)
      setError('åœæ­¢éŒ„éŸ³æ™‚ç™¼ç”ŸéŒ¯èª¤')
    }
  }, [clearTimer])

  // æ¸…ç©ºé€å­—ç¨¿
  const clearTranscripts = useCallback(() => {
    setTranscripts([])
    setTranscriptCompleted(false)
    console.log('ğŸ”„ é€å­—ç¨¿å·²æ¸…é™¤')
  }, [])

  // æ¸…ç†è³‡æº
  useEffect(() => {
    return () => {
      // ç§»é™¤ TranscriptManager ç›£è½å™¨
      if (currentSessionIdRef.current) {
        transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
      }

      // æ¸…ç†è¨ˆæ™‚å™¨
      clearTimer()

      // é—œé–‰éŸ³æª”ä¸Šå‚³é€£ç·š
      if (audioUploader.isConnected) {
        audioUploader.close()
      }

      // åœæ­¢ä¸¦æ¸…ç†åˆ†æ®µå¼éŒ„éŸ³å™¨
      if (segmentedRecorderRef.current) {
        segmentedRecorderRef.current.stop()
        segmentedRecorderRef.current.cleanup()
      }
    }
  }, [clearTimer, handleTranscript])

  return {
    isRecording,
    recordingTime,
    transcripts,
    transcriptCompleted,
    error,
    startRecording,
    stopRecording,
    clearTranscripts,
  }
}


# END FILE CONTENTS


# File: frontend/tailwind.config.ts

import type { Config } from "tailwindcss";

const config: Config = {
    darkMode: ["class"],
    content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
    "*.{js,ts,jsx,tsx,mdx}"
  ],
  theme: {
  	extend: {
  		colors: {
  			background: 'hsl(var(--background))',
  			foreground: 'hsl(var(--foreground))',
  			card: {
  				DEFAULT: 'hsl(var(--card))',
  				foreground: 'hsl(var(--card-foreground))'
  			},
  			popover: {
  				DEFAULT: 'hsl(var(--popover))',
  				foreground: 'hsl(var(--popover-foreground))'
  			},
  			primary: {
  				DEFAULT: 'hsl(var(--primary))',
  				foreground: 'hsl(var(--primary-foreground))'
  			},
  			secondary: {
  				DEFAULT: 'hsl(var(--secondary))',
  				foreground: 'hsl(var(--secondary-foreground))'
  			},
  			muted: {
  				DEFAULT: 'hsl(var(--muted))',
  				foreground: 'hsl(var(--muted-foreground))'
  			},
  			accent: {
  				DEFAULT: 'hsl(var(--accent))',
  				foreground: 'hsl(var(--accent-foreground))'
  			},
  			destructive: {
  				DEFAULT: 'hsl(var(--destructive))',
  				foreground: 'hsl(var(--destructive-foreground))'
  			},
  			border: 'hsl(var(--border))',
  			input: 'hsl(var(--input))',
  			ring: 'hsl(var(--ring))',
  			chart: {
  				'1': 'hsl(var(--chart-1))',
  				'2': 'hsl(var(--chart-2))',
  				'3': 'hsl(var(--chart-3))',
  				'4': 'hsl(var(--chart-4))',
  				'5': 'hsl(var(--chart-5))'
  			},
  			sidebar: {
  				DEFAULT: 'hsl(var(--sidebar-background))',
  				foreground: 'hsl(var(--sidebar-foreground))',
  				primary: 'hsl(var(--sidebar-primary))',
  				'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
  				accent: 'hsl(var(--sidebar-accent))',
  				'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
  				border: 'hsl(var(--sidebar-border))',
  				ring: 'hsl(var(--sidebar-ring))'
  			}
  		},
  		borderRadius: {
  			lg: 'var(--radius)',
  			md: 'calc(var(--radius) - 2px)',
  			sm: 'calc(var(--radius) - 4px)'
  		},
  		keyframes: {
  			'accordion-down': {
  				from: {
  					height: '0'
  				},
  				to: {
  					height: 'var(--radix-accordion-content-height)'
  				}
  			},
  			'accordion-up': {
  				from: {
  					height: 'var(--radix-accordion-content-height)'
  				},
  				to: {
  					height: '0'
  				}
  			}
  		},
  		animation: {
  			'accordion-down': 'accordion-down 0.2s ease-out',
  			'accordion-up': 'accordion-up 0.2s ease-out'
  		}
  	}
  },
  plugins: [require("tailwindcss-animate")],
};
export default config;


# END FILE CONTENTS


# File: app/services/transcript_feed.py

"""
é€å­—ç¨¿ WebSocket å»£æ’­æœå‹™ (ç°¡åŒ–ç‰ˆ InMemoryHub)

ç¶­æŒ sid â†’ set[WebSocket] æ˜ å°„ï¼Œæ”¯æ´å¤šå€‹å®¢æˆ¶ç«¯é€£æ¥
"""

import logging
import json
from typing import Dict, Set
from fastapi import WebSocket

logger = logging.getLogger(__name__)


class TranscriptHub:
    """
    é€å­—ç¨¿ WebSocket å»£æ’­ä¸­å¿ƒ (InMemoryHub æ¨¡å¼)

    åŠŸèƒ½ï¼š
    - ç®¡ç†æœƒè©± ID å°æ‡‰çš„ WebSocket é€£æ¥æ± 
    - æ”¯æ´ä¸€å°å¤šå»£æ’­
    - è‡ªå‹•æ¸…ç†æ–·é–‹çš„é€£æ¥
    """

    def __init__(self):
        """åˆå§‹åŒ–å»£æ’­ä¸­å¿ƒ"""
        self._subscribers: Dict[str, Set[WebSocket]] = {}
        logger.info("ğŸ”Œ TranscriptHub åˆå§‹åŒ–å®Œæˆ")

    async def subscribe(self, session_id: str, websocket: WebSocket):
        """
        è¨‚é–±æœƒè©±çš„è½‰éŒ„æ¨é€

        Args:
            session_id: æœƒè©± ID
            websocket: WebSocket é€£æ¥
        """
        if session_id not in self._subscribers:
            self._subscribers[session_id] = set()

        self._subscribers[session_id].add(websocket)
        logger.info(f"ğŸ“± æ–°è¨‚é–±è€…åŠ å…¥æœƒè©± {session_id} (ç›®å‰è¨‚é–±è€…: {len(self._subscribers[session_id])})")

    async def unsubscribe(self, session_id: str, websocket: WebSocket):
        """
        å–æ¶ˆè¨‚é–±

        Args:
            session_id: æœƒè©± ID
            websocket: WebSocket é€£æ¥
        """
        if session_id in self._subscribers:
            self._subscribers[session_id].discard(websocket)

            # å¦‚æœæ²’æœ‰è¨‚é–±è€…äº†ï¼Œæ¸…ç†æœƒè©±è¨˜éŒ„
            if not self._subscribers[session_id]:
                del self._subscribers[session_id]
                logger.info(f"ğŸ—‘ï¸ æœƒè©± {session_id} ç„¡è¨‚é–±è€…ï¼Œå·²æ¸…ç†")
            else:
                logger.info(f"ğŸ“± è¨‚é–±è€…é›¢é–‹æœƒè©± {session_id} (å‰©é¤˜è¨‚é–±è€…: {len(self._subscribers[session_id])})")

    async def broadcast(self, session_id: str, message: dict):
        """
        å»£æ’­è¨Šæ¯åˆ°æŒ‡å®šæœƒè©±çš„æ‰€æœ‰è¨‚é–±è€…

        Args:
            session_id: æœƒè©± ID
            message: è¦å»£æ’­çš„è¨Šæ¯å­—å…¸
        """
        if session_id not in self._subscribers:
            logger.debug(f"ğŸ“¡ æœƒè©± {session_id} ç„¡è¨‚é–±è€…ï¼Œè·³éå»£æ’­")
            return

        # ç²å–è¨‚é–±è€…å‰¯æœ¬ï¼Œé¿å…è¿­ä»£æ™‚ä¿®æ”¹
        subscribers = self._subscribers[session_id].copy()
        successful_broadcasts = 0
        failed_connections = set()

        for websocket in subscribers:
            try:
                await websocket.send_json(message)
                successful_broadcasts += 1
            except Exception as e:
                logger.warning(f"âš ï¸ å»£æ’­å¤±æ•—ï¼ŒWebSocket é€£æ¥ç•°å¸¸: {e}")
                failed_connections.add(websocket)

        # æ¸…ç†å¤±æ•—çš„é€£æ¥
        if failed_connections:
            for failed_ws in failed_connections:
                await self.unsubscribe(session_id, failed_ws)

            logger.info(f"ğŸ—‘ï¸ å·²æ¸…ç† {len(failed_connections)} å€‹ç•°å¸¸é€£æ¥")

        if successful_broadcasts > 0:
            logger.debug(f"ğŸ“¡ æˆåŠŸå»£æ’­åˆ°æœƒè©± {session_id} ({successful_broadcasts} å€‹è¨‚é–±è€…)")

    async def broadcast_error(self, session_id: str, error_type: str, message: str, seq: int = None):
        """
        å»£æ’­éŒ¯èª¤è¨Šæ¯

        Args:
            session_id: æœƒè©± ID
            error_type: éŒ¯èª¤é¡å‹
            message: éŒ¯èª¤è¨Šæ¯
            seq: åˆ‡ç‰‡åºè™Ÿï¼ˆå¯é¸ï¼‰
        """
        error_message = {
            "type": "error",
            "error_type": error_type,
            "message": message,
            "session_id": session_id,
            "timestamp": self._get_timestamp()
        }

        if seq is not None:
            error_message["seq"] = seq

        await self.broadcast(session_id, error_message)
        logger.error(f"âŒ å»£æ’­éŒ¯èª¤åˆ°æœƒè©± {session_id}: {error_type} - {message}")

    async def broadcast_transcript_segment(self, session_id: str, seq: int, text: str, start_time: float = None, end_time: float = None, confidence: float = None):
        """
        å»£æ’­è½‰éŒ„ç‰‡æ®µ

        Args:
            session_id: æœƒè©± ID
            seq: åˆ‡ç‰‡åºè™Ÿ
            text: è½‰éŒ„æ–‡å­—
            start_time: é–‹å§‹æ™‚é–“ï¼ˆç§’ï¼‰
            end_time: çµæŸæ™‚é–“ï¼ˆç§’ï¼‰
            confidence: ä¿¡å¿ƒåº¦
        """
        transcript_message = {
            "type": "transcript_segment",
            "session_id": session_id,
            "seq": seq,
            "text": text,
            "timestamp": self._get_timestamp()
        }

        if start_time is not None:
            transcript_message["start_time"] = start_time

        if end_time is not None:
            transcript_message["end_time"] = end_time

        if confidence is not None:
            transcript_message["confidence"] = confidence

        await self.broadcast(session_id, transcript_message)
        logger.info(f"ğŸ“ å»£æ’­è½‰éŒ„ç‰‡æ®µåˆ°æœƒè©± {session_id} seq={seq}: '{text[:50]}{'...' if len(text) > 50 else ''}'")

    async def broadcast_phase(self, session_id: str, phase: str):
        """
        å»£æ’­éšæ®µè®Šæ›´

        Args:
            session_id: æœƒè©± ID
            phase: éšæ®µåç¨± (waiting, active, processing, completed)
        """
        phase_message = {
            "type": "phase",
            "phase": phase,
            "session_id": session_id,
            "timestamp": self._get_timestamp()
        }

        await self.broadcast(session_id, phase_message)
        logger.info(f"ğŸ”„ å»£æ’­éšæ®µè®Šæ›´åˆ°æœƒè©± {session_id}: {phase}")

    def get_subscriber_count(self, session_id: str) -> int:
        """
        ç²å–æŒ‡å®šæœƒè©±çš„è¨‚é–±è€…æ•¸é‡

        Args:
            session_id: æœƒè©± ID

        Returns:
            int: è¨‚é–±è€…æ•¸é‡
        """
        return len(self._subscribers.get(session_id, set()))

    def get_total_subscribers(self) -> int:
        """
        ç²å–ç¸½è¨‚é–±è€…æ•¸é‡

        Returns:
            int: ç¸½è¨‚é–±è€…æ•¸é‡
        """
        return sum(len(subscribers) for subscribers in self._subscribers.values())

    def get_active_sessions(self) -> list:
        """
        ç²å–æœ‰è¨‚é–±è€…çš„æ´»èºæœƒè©± ID åˆ—è¡¨

        Returns:
            list: æ´»èºæœƒè©± ID åˆ—è¡¨
        """
        return list(self._subscribers.keys())

    def _get_timestamp(self) -> str:
        """ç²å–ç•¶å‰æ™‚é–“æˆ³"""
        from datetime import datetime
        return datetime.utcnow().isoformat()

    async def cleanup_session(self, session_id: str):
        """
        æ¸…ç†æŒ‡å®šæœƒè©±çš„æ‰€æœ‰é€£æ¥

        Args:
            session_id: æœƒè©± ID
        """
        if session_id in self._subscribers:
            subscribers = self._subscribers[session_id].copy()
            for websocket in subscribers:
                try:
                    await websocket.close()
                except:
                    pass  # å¿½ç•¥é—œé–‰æ™‚çš„éŒ¯èª¤

            del self._subscribers[session_id]
            logger.info(f"ğŸ—‘ï¸ å·²æ¸…ç†æœƒè©± {session_id} çš„æ‰€æœ‰é€£æ¥ ({len(subscribers)} å€‹)")


# å…¨åŸŸ Hub å¯¦ä¾‹
transcript_hub = TranscriptHub()


def get_transcript_hub() -> TranscriptHub:
    """ç²å–å…¨åŸŸè½‰éŒ„å»£æ’­ä¸­å¿ƒå¯¦ä¾‹"""
    return transcript_hub


# END FILE CONTENTS


# File: frontend/components/ui/progress.tsx

"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }


# END FILE CONTENTS


# File: app/core/config.py

from pydantic_settings import BaseSettings, SettingsConfigDict
from pydantic import Field, field_validator

import os

# æ ¹æ“šåŸ·è¡Œç’°å¢ƒæ±ºå®šè¦è®€å–çš„ .env æª”æ¡ˆã€‚
# å¦‚æœåµæ¸¬åˆ° TESTING ç’°å¢ƒè®Šæ•¸ç‚ºçœŸ (ç”± pytest/conftest è¨­å®š)ï¼Œ
# å‰‡è®€å– `.env.local`ï¼›é è¨­æƒ…æ³ (æ­£å¼ç’°å¢ƒ) å‰‡è®€å– `.env`ã€‚

_ENV_FILE: str = ".env.local" if os.getenv("TESTING", "").lower() in {"1", "true", "yes"} else ".env"

class Settings(BaseSettings):
    LOG_LEVEL: str = "INFO"
    CORS_ORIGINS: str = "http://localhost:3000"
    SUPABASE_URL: str = ""
    SUPABASE_KEY: str = ""
    DB_MODE: str = "supabase"
    STT_PROVIDER_DEFAULT: str = Field(
        default="whisper",
        env="DEFAULT_STT_PROVIDER",
    )
    AZURE_OPENAI_API_KEY: str = ""
    AZURE_OPENAI_ENDPOINT: str = ""
    AZURE_OPENAI_API_VERSION: str = "2024-02-01"
    WHISPER_DEPLOYMENT_NAME: str = ""
    WHISPER_LANGUAGE: str = "zh-TW"
    GPT4O_DEPLOYMENT_NAME: str = Field(
        default="gpt4o",        # ä½ åœ¨ Azure å»ºçš„éƒ¨ç½²åç¨±
        env="GPT4O_DEPLOYMENT_NAME"
    )
    GPT4O_TRANSCRIBE_PROMPT: str = Field(
        default="",
        env="GPT4O_TRANSCRIBE_PROMPT"
    )
    # (é¸) é€Ÿç‡é™åˆ¶
    GPT4O_MAX_REQUESTS: int = 60
    GEMINI_ENDPOINT: str = Field("", description="Vertex AI ç«¯é»ï¼Œå¦‚ us-central1-aiplatform.googleapis.com")
    GEMINI_API_KEY: str = Field("", description="GCP æœå‹™å¸³æˆ¶ API Key")
    GEMINI_PROMPT: str = Field("è«‹è¼¸å‡ºé€å­—ç¨¿ï¼š", description="Gemini system prompt")
    GEMINI_MAX_REQUESTS: int = Field(90, description="Gemini æ¯åˆ†é˜æœ€å¤§è«‹æ±‚æ¬¡æ•¸ (RateLimiter ç”¨)")
    R2_ACCOUNT_ID: str = ""
    R2_BUCKET_NAME: str = "studyscriber"
    R2_API_TOKEN: str = ""
    WHISPER_BATCH_SIZE: int = Field(2, alias="whisper_batch_size")
    WHISPER_BATCH_TIMEOUT: int = Field(3, alias="whisper_batch_timeout")
    ENABLE_PERFORMANCE_LOGGING: bool = Field(True, alias="enable_performance_logging")
    DEBUG: bool = Field(False, alias="debug")

    # éŸ³é »åˆ‡ç‰‡é…ç½®
    AUDIO_CHUNK_DURATION_SEC: int = Field(
    default=15,
    env="AUDIO_CHUNK_DURATION_SEC"
)

    # é€å­—ç¨¿é¡¯ç¤ºé…ç½®
    TRANSCRIPT_DISPLAY_INTERVAL_SEC: int = Field(10, description="é€å­—ç¨¿æ™‚é–“æˆ³é¡¯ç¤ºé–“éš”ï¼ˆç§’ï¼‰")

    # REST API ç°¡åŒ–æ¶æ§‹é…ç½®
    SEGMENT_DURATION: int = Field(10, description="åˆ†æ®µéŒ„éŸ³æ™‚é•·ï¼ˆç§’ï¼‰")
    UPLOAD_MAX_SIZE: int = Field(5 * 1024 * 1024, description="æª”æ¡ˆä¸Šå‚³å¤§å°é™åˆ¶ï¼ˆ5MBï¼‰")
    AUDIO_BITRATE: int = Field(128000, description="éŸ³é »ä½å…ƒç‡ï¼ˆ128 kbpsï¼‰")
    MIME_TYPE: str = Field("audio/webm;codecs=opus", description="éŸ³é »æª”æ¡ˆ MIME é¡å‹")

    # ä¸Šå‚³è¨­å®š
    UPLOAD_TIMEOUT_SEC: int = Field(30, description="ä¸Šå‚³è¶…æ™‚æ™‚é–“ï¼ˆç§’ï¼‰")
    MAX_RETRIES: int = Field(3, description="æœ€å¤§é‡è©¦æ¬¡æ•¸")
    RETRY_DELAY_SEC: int = Field(2, description="é‡è©¦å»¶é²æ™‚é–“ï¼ˆç§’ï¼‰")

    # æ»‘å‹•è¦–çª— Rate Limiting é…ç½®
    USE_SLIDING_WINDOW_RATE_LIMIT: bool = Field(False, description="å•Ÿç”¨æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶")
    SLIDING_WINDOW_MAX_REQUESTS: int = Field(3, description="æ»‘å‹•è¦–çª—å…§æœ€å¤§è«‹æ±‚æ•¸")
    SLIDING_WINDOW_SECONDS: int = Field(60, description="æ»‘å‹•è¦–çª—æ™‚é–“ï¼ˆç§’ï¼‰")

    # Whisper æ®µè½éæ¿¾é–€æª»åƒæ•¸ (å¾ç’°å¢ƒè®Šæ•¸è®€å–)
    FILTER_NO_SPEECH: float = Field(
        0.2,
        description="éœéŸ³æª¢æ¸¬é–€æª»ï¼šno_speech_prob è¶…éæ­¤å€¼çš„æ®µè½å°‡è¢«éæ¿¾ï¼ˆ0.0-1.0ï¼‰",
        ge=0.0,
        le=1.0
    )
    FILTER_LOGPROB: float = Field(
        -1.0,
        description="ç½®ä¿¡åº¦éæ¿¾é–€æª»ï¼šavg_logprob ä½æ–¼æ­¤å€¼çš„æ®µè½å°‡è¢«éæ¿¾ï¼ˆè² å€¼ï¼‰"
    )
    FILTER_COMPRESSION: float = Field(
        2.4,
        description="é‡è¤‡å…§å®¹æª¢æ¸¬é–€æª»ï¼šcompression_ratio è¶…éæ­¤å€¼çš„æ®µè½å°‡è¢«éæ¿¾ï¼ˆæ­£å€¼ï¼‰",
        gt=0.0
    )

    # ä¸¦ç™¼è™•ç†å„ªåŒ–é…ç½®ï¼ˆç”¨æˆ¶å»ºè­°åƒæ•¸ï¼‰
    MAX_CONCURRENT_TRANSCRIPTIONS: int = Field(3, description="æœ€å¤§ä¸¦ç™¼è½‰éŒ„æ•¸")
    TRANSCRIPTION_WORKERS_COUNT: int = Field(3, description="è½‰éŒ„Workeræ•¸é‡")
    QUEUE_BACKLOG_THRESHOLD: int = Field(10, description="éšŠåˆ—ç©å£“è­¦å ±é–€æª»")
    QUEUE_MONITOR_INTERVAL: int = Field(5, description="ç›£æ§é–“éš”(ç§’)")
    QUEUE_ALERT_COOLDOWN: int = Field(30, description="è­¦å ±å†·å»æ™‚é–“(ç§’)")

    # éšŠåˆ—ç³»çµ±é…ç½®
    MAX_QUEUE_SIZE: int = Field(100, description="æœ€å¤§éšŠåˆ—å¤§å°")
    QUEUE_TIMEOUT_SECONDS: int = Field(300, description="éšŠåˆ—è¶…æ™‚ï¼ˆç§’ï¼‰")

    # ä½ å¯ä»¥ä¾éœ€æ±‚å†åŠ æ›´å¤šæ¬„ä½

    # éœéŸ³åˆ¤æ–·åƒæ•¸
    SILENCE_NOISE_DB: float = Field(-35.0, description="éœéŸ³åˆ¤æ–· dB é–€æª» (è² å€¼)", env="SILENCE_NOISE_DB")
    SILENCE_DURATION_SEC: float = Field(0.3, description="éœéŸ³åˆ¤æ–·æŒçºŒç§’æ•¸", env="SILENCE_DURATION_SEC")

    model_config = SettingsConfigDict(env_file=_ENV_FILE, env_file_encoding="utf-8", extra="ignore")

settings = Settings()

def get_settings() -> Settings:
    """ç²å–æ‡‰ç”¨ç¨‹å¼è¨­å®šå¯¦ä¾‹"""
    return settings


# END FILE CONTENTS


# File: app/middleware/__init__.py



# END FILE CONTENTS


# File: frontend/components/finish-state.tsx

"use client"

import { ScrollArea } from "@/components/ui/scroll-area"
import { Button } from "@/components/ui/button"
import { ChevronDown } from "lucide-react"
import type { TranscriptEntry } from "../types/app-state"

interface FinishStateProps {
  transcriptEntries: TranscriptEntry[]
  onExport?: () => void
  onToLatest?: () => void
}

export function FinishState({ transcriptEntries, onExport, onToLatest }: FinishStateProps) {
  return (
    <div className="h-full flex flex-col">
      <ScrollArea className="flex-1">
        <div className="p-6 space-y-4">
          {transcriptEntries.map((entry, index) => (
            <div key={index} className="flex gap-4 text-sm">
              <span className="text-muted-foreground font-mono text-xs mt-1 min-w-[40px] flex-shrink-0">
                {entry.time}
              </span>
              <span className="text-foreground leading-relaxed flex-1">{entry.text}</span>
            </div>
          ))}
        </div>
      </ScrollArea>

      <div className="p-4 border-t border-border space-y-2">
        {/* Action buttons row */}
        <div className="flex justify-center gap-2">
          {onToLatest && (
            <Button
              onClick={onToLatest}
              variant="ghost"
              size="sm"
              className="flex items-center gap-2"
            >
              <ChevronDown className="w-4 h-4" />
              To Latest
            </Button>
          )}
        </div>
      </div>
    </div>
  )
}


# END FILE CONTENTS


# File: frontend/lib/services/base-service.ts

"use client"

/**
 * BaseService - æœå‹™å±¤åŸºç¤æŠ½è±¡é¡
 *
 * æä¾›çµ±ä¸€çš„æœå‹™åŸºç¤è¨­æ–½ï¼š
 * - çµ±ä¸€æ—¥èªŒä»‹é¢
 * - ç”Ÿå‘½é€±æœŸç®¡ç† (initialize/cleanup)
 * - éŒ¯èª¤è™•ç†æ¨¡å¼
 * - æœå‹™ç‹€æ…‹ç®¡ç†
 */
export abstract class BaseService {
    /**
     * æ—¥èªŒå·¥å…· - é‡ç”¨ç¾æœ‰çš„ console æ¨¡å¼
     */
    protected readonly logger = console

    /**
     * æœå‹™åç¨±ï¼Œç”¨æ–¼æ—¥èªŒå’Œèª¿è©¦
     */
    protected abstract readonly serviceName: string

    /**
     * æœå‹™åˆå§‹åŒ–ç‹€æ…‹
     */
    private _isInitialized = false

    /**
     * æœå‹™æ˜¯å¦æ­£åœ¨é‹è¡Œ
     */
    private _isRunning = false

    /**
     * åˆå§‹åŒ–æœå‹™
     * å­é¡å¿…é ˆå¯¦ç¾å…·é«”çš„åˆå§‹åŒ–é‚è¼¯
     */
    abstract initialize(): Promise<void>

    /**
     * æ¸…ç†æœå‹™è³‡æº
     * å­é¡å¿…é ˆå¯¦ç¾å…·é«”çš„æ¸…ç†é‚è¼¯
     */
    abstract cleanup(): Promise<void>

    /**
     * å•Ÿå‹•æœå‹™
     * çµ±ä¸€çš„å•Ÿå‹•æµç¨‹ï¼šæª¢æŸ¥ç‹€æ…‹ â†’ åˆå§‹åŒ– â†’ æ¨™è¨˜ç‚ºé‹è¡Œä¸­
     */
    async start(): Promise<void> {
        if (this._isRunning) {
            this.logger.warn(`ğŸ”„ [${this.serviceName}] æœå‹™å·²åœ¨é‹è¡Œä¸­ï¼Œè·³éå•Ÿå‹•`)
            return
        }

        try {
            this.logger.log(`ğŸš€ [${this.serviceName}] é–‹å§‹å•Ÿå‹•æœå‹™...`)

            if (!this._isInitialized) {
                await this.initialize()
                this._isInitialized = true
                this.logger.log(`âœ… [${this.serviceName}] æœå‹™åˆå§‹åŒ–å®Œæˆ`)
            }

            this._isRunning = true
            this.logger.log(`âœ… [${this.serviceName}] æœå‹™å•Ÿå‹•æˆåŠŸ`)
        } catch (error) {
            this.logger.error(`âŒ [${this.serviceName}] æœå‹™å•Ÿå‹•å¤±æ•—:`, error)
            throw error
        }
    }

    /**
     * åœæ­¢æœå‹™
     * çµ±ä¸€çš„åœæ­¢æµç¨‹ï¼šæª¢æŸ¥ç‹€æ…‹ â†’ æ¸…ç†è³‡æº â†’ æ¨™è¨˜ç‚ºåœæ­¢
     */
    async stop(): Promise<void> {
        if (!this._isRunning) {
            this.logger.warn(`ğŸ”„ [${this.serviceName}] æœå‹™æœªåœ¨é‹è¡Œä¸­ï¼Œè·³éåœæ­¢`)
            return
        }

        try {
            this.logger.log(`ğŸ›‘ [${this.serviceName}] é–‹å§‹åœæ­¢æœå‹™...`)

            await this.cleanup()
            this._isRunning = false

            this.logger.log(`âœ… [${this.serviceName}] æœå‹™åœæ­¢å®Œæˆ`)
        } catch (error) {
            this.logger.error(`âŒ [${this.serviceName}] æœå‹™åœæ­¢å¤±æ•—:`, error)
            throw error
        }
    }

    /**
     * é‡å•Ÿæœå‹™
     * å…ˆåœæ­¢ï¼Œå†å•Ÿå‹•
     */
    async restart(): Promise<void> {
        this.logger.log(`ğŸ”„ [${this.serviceName}] é–‹å§‹é‡å•Ÿæœå‹™...`)
        await this.stop()
        await this.start()
        this.logger.log(`âœ… [${this.serviceName}] æœå‹™é‡å•Ÿå®Œæˆ`)
    }

    /**
     * æª¢æŸ¥æœå‹™æ˜¯å¦å·²åˆå§‹åŒ–
     */
    get isInitialized(): boolean {
        return this._isInitialized
    }

    /**
     * æª¢æŸ¥æœå‹™æ˜¯å¦æ­£åœ¨é‹è¡Œ
     */
    get isRunning(): boolean {
        return this._isRunning
    }

    /**
     * ç²å–æœå‹™ç‹€æ…‹æ‘˜è¦
     */
    getStatus(): ServiceStatus {
        return {
            serviceName: this.serviceName,
            isInitialized: this._isInitialized,
            isRunning: this._isRunning,
            timestamp: new Date().toISOString()
        }
    }

    /**
     * çµ±ä¸€éŒ¯èª¤è™•ç†
     * æä¾›ä¸€è‡´çš„éŒ¯èª¤æ—¥èªŒæ ¼å¼å’ŒéŒ¯èª¤åŒ…è£
     */
    protected handleError(operation: string, error: unknown): never {
        const errorMessage = error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
        const fullMessage = `${this.serviceName} ${operation} å¤±æ•—: ${errorMessage}`

        this.logger.error(`âŒ [${this.serviceName}] ${operation} å¤±æ•—:`, error)

        throw new ServiceError(fullMessage, {
            serviceName: this.serviceName,
            operation,
            originalError: error,
            timestamp: new Date().toISOString()
        })
    }

    /**
     * çµ±ä¸€æˆåŠŸæ—¥èªŒ
     */
    protected logSuccess(operation: string, details?: any): void {
        this.logger.log(`âœ… [${this.serviceName}] ${operation} æˆåŠŸ`, details ? details : '')
    }

    /**
     * çµ±ä¸€è³‡è¨Šæ—¥èªŒ
     */
    protected logInfo(message: string, details?: any): void {
        this.logger.log(`â„¹ï¸ [${this.serviceName}] ${message}`, details ? details : '')
    }

    /**
     * çµ±ä¸€è­¦å‘Šæ—¥èªŒ
     */
    protected logWarning(message: string, details?: any): void {
        this.logger.warn(`âš ï¸ [${this.serviceName}] ${message}`, details ? details : '')
    }
}

/**
 * æœå‹™ç‹€æ…‹ä»‹é¢
 */
export interface ServiceStatus {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    timestamp: string
}

/**
 * æœå‹™éŒ¯èª¤é¡åˆ¥
 * æä¾›çµæ§‹åŒ–çš„éŒ¯èª¤è¨Šæ¯å’Œä¸Šä¸‹æ–‡
 */
export class ServiceError extends Error {
    readonly serviceName: string
    readonly operation: string
    readonly originalError: unknown
    readonly timestamp: string

    constructor(message: string, context: {
        serviceName: string
        operation: string
        originalError: unknown
        timestamp: string
    }) {
        super(message)
        this.name = 'ServiceError'
        this.serviceName = context.serviceName
        this.operation = context.operation
        this.originalError = context.originalError
        this.timestamp = context.timestamp
    }
}


# END FILE CONTENTS


# File: frontend/e2e/transcript-integration.spec.ts

import { test, expect, Page } from '@playwright/test'

/**
 * é€å­—ç¨¿åŠŸèƒ½æ•´åˆæ¸¬è©¦
 * æ¸¬è©¦å®Œæ•´çš„éŒ„éŸ³å’Œé€å­—ç¨¿æµç¨‹ï¼ŒåŒ…æ‹¬æ–°èˆŠç³»çµ±çš„åˆ‡æ›
 */

// æ¸¬è©¦å‰çš„è¨­ç½®
test.beforeEach(async ({ page }) => {
  // å‰å¾€æ‡‰ç”¨ç¨‹å¼
  await page.goto('http://localhost:3000')

  // ç­‰å¾…é é¢è¼‰å…¥å®Œæˆ
  await page.waitForLoadState('networkidle')

  // æª¢æŸ¥é é¢æ˜¯å¦æ­£å¸¸è¼‰å…¥
  await expect(page).toHaveTitle(/study-scriber/)
})

test.describe('é€å­—ç¨¿åŠŸèƒ½æ¸¬è©¦', () => {
  test('æ‡‰è©²èƒ½å¤ å•Ÿç”¨æ–°çš„ç‹€æ…‹ç®¡ç†ç³»çµ±', async ({ page }) => {
    // åœ¨ç€è¦½å™¨æ§åˆ¶å°ä¸­å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      // å•Ÿç”¨æ‰€æœ‰æ–°åŠŸèƒ½
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })

    // é‡æ–°è¼‰å…¥é é¢ä»¥æ‡‰ç”¨æ–°è¨­ç½®
    await page.reload()
    await page.waitForLoadState('networkidle')

    // æª¢æŸ¥åŠŸèƒ½é–‹é—œæ˜¯å¦æ­£ç¢ºå•Ÿç”¨
    const featureFlags = await page.evaluate(() => {
      return (window as any).featureFlags?.getAll()
    })

    console.log('åŠŸèƒ½é–‹é—œç‹€æ…‹:', featureFlags)

    // é©—è­‰é—œéµåŠŸèƒ½å·²å•Ÿç”¨
    expect(featureFlags?.useNewStateManagement).toBe(true)
    expect(featureFlags?.useNewTranscriptHook).toBe(true)
  })

  test('æ‡‰è©²èƒ½å¤ é–‹å§‹éŒ„éŸ³æœƒè©±', async ({ page }) => {
    // å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })
    await page.reload()
    await page.waitForLoadState('networkidle')

    // å°‹æ‰¾éŒ„éŸ³æŒ‰éˆ•
    const recordButton = page.locator('button').filter({ hasText: /éŒ„éŸ³|Record|é–‹å§‹/ }).first()

    if (await recordButton.count() > 0) {
      // é»æ“ŠéŒ„éŸ³æŒ‰éˆ•
      await recordButton.click()

      // ç­‰å¾…éŒ„éŸ³ç‹€æ…‹è®Šæ›´
      await page.waitForTimeout(1000)

      // æª¢æŸ¥æ˜¯å¦æœ‰éŒ„éŸ³ç‹€æ…‹æŒ‡ç¤ºå™¨
      const recordingIndicator = page.locator('[data-testid="recording-indicator"]')
        .or(page.locator('text=/éŒ„éŸ³ä¸­|Recording/'))
        .or(page.locator('.recording'))

      // å¦‚æœæ‰¾åˆ°éŒ„éŸ³æŒ‡ç¤ºå™¨ï¼Œé©—è­‰éŒ„éŸ³ç‹€æ…‹
      if (await recordingIndicator.count() > 0) {
        await expect(recordingIndicator.first()).toBeVisible()
        console.log('âœ… éŒ„éŸ³åŠŸèƒ½å·²å•Ÿå‹•')
      } else {
        console.log('â„¹ï¸ æœªæ‰¾åˆ°æ˜é¡¯çš„éŒ„éŸ³æŒ‡ç¤ºå™¨ï¼Œä½†éŒ„éŸ³æŒ‰éˆ•å·²é»æ“Š')
      }
    } else {
      console.log('â„¹ï¸ æœªæ‰¾åˆ°éŒ„éŸ³æŒ‰éˆ•ï¼Œå¯èƒ½éœ€è¦å…ˆå»ºç«‹æœƒè©±')
    }
  })

  test('æ‡‰è©²èƒ½å¤ å»ºç«‹æ–°çš„ç­†è¨˜æœƒè©±', async ({ page }) => {
    // å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })
    await page.reload()
    await page.waitForLoadState('networkidle')

    // å°‹æ‰¾æ–°ç­†è¨˜æˆ–æ–°æœƒè©±æŒ‰éˆ•
    const newNoteButton = page.locator('button').filter({ hasText: /æ–°ç­†è¨˜|New Note|æ–°å¢|Add/ }).first()

    if (await newNoteButton.count() > 0) {
      await newNoteButton.click()
      await page.waitForTimeout(500)
      console.log('âœ… æ–°ç­†è¨˜æŒ‰éˆ•å·²é»æ“Š')
    } else {
      console.log('â„¹ï¸ æœªæ‰¾åˆ°æ–°ç­†è¨˜æŒ‰éˆ•')
    }

    // æª¢æŸ¥æ–‡å­—ç·¨è¼¯å™¨æ˜¯å¦å­˜åœ¨
    const editorLocator = page.locator('.CodeMirror').first();
    const editorVisible = await editorLocator.isVisible();

    if (editorVisible) {
      console.log('âœ… CodeMirror ç·¨è¼¯å™¨å·²æ‰¾åˆ°ä¸”å¯è¦‹');
      // ä½¿ç”¨ evaluate ç›´æ¥è¨­ç½®ç·¨è¼¯å™¨å…§å®¹
      await page.evaluate((text) => {
        const editor = (window as any).theEditor; // å‡è¨­ SimpleMDE å¯¦ä¾‹æš´éœ²åœ¨ window
        if (editor && editor.codemirror) {
          editor.codemirror.setValue(text);
        } else {
          // é™ç´šæ–¹æ¡ˆï¼šå°‹æ‰¾ textarea
          const textarea = document.querySelector('.CodeMirror textarea') as HTMLTextAreaElement | null;
          if (textarea) {
            textarea.value = text;
            textarea.dispatchEvent(new Event('input', { bubbles: true }));
          }
        }
      }, 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç­†è¨˜ï¼Œç”¨æ–¼é©—è­‰é€å­—ç¨¿åŠŸèƒ½ã€‚');

      // é©—è­‰æ–‡å­—å·²è¼¸å…¥
      await expect(editorLocator).toHaveText(/æ¸¬è©¦ç­†è¨˜/);
      console.log('âœ… ç·¨è¼¯å™¨åŠŸèƒ½æ­£å¸¸');
    } else {
      console.log('â„¹ï¸ æœªæ‰¾åˆ° CodeMirror ç·¨è¼¯å™¨æˆ–å…¶ä¸å¯è¦‹');
      // å˜—è©¦å°‹æ‰¾å‚™ç”¨çš„ textarea
      const fallbackEditor = page.locator('[data-testid="fallback-editor"]');
      if (await fallbackEditor.count() > 0) {
        console.log('â„¹ï¸ æ‰¾åˆ°å‚™ç”¨ç·¨è¼¯å™¨ï¼Œç¹¼çºŒæ¸¬è©¦...');
        await fallbackEditor.fill('é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç­†è¨˜ï¼Œç”¨æ–¼é©—è­‰é€å­—ç¨¿åŠŸèƒ½ã€‚');
        await expect(fallbackEditor).toHaveValue(/æ¸¬è©¦ç­†è¨˜/);
        console.log('âœ… å‚™ç”¨ç·¨è¼¯å™¨åŠŸèƒ½æ­£å¸¸');
      } else {
        console.log('âŒ ä¸»ç·¨è¼¯å™¨èˆ‡å‚™ç”¨ç·¨è¼¯å™¨çš†æœªæ‰¾åˆ°');
      }
    }
  })

  test('æ‡‰è©²èƒ½å¤ æª¢æŸ¥ WebSocket é€£æ¥ç‹€æ…‹', async ({ page }) => {
    // å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })
    await page.reload()
    await page.waitForLoadState('networkidle')

    // æª¢æŸ¥ WebSocket é€£æ¥ç‹€æ…‹
    const wsStatus = await page.evaluate(() => {
      const result: {
        exists: boolean;
        isConnected?: boolean;
        hasListeners?: boolean;
        websocketAvailable: boolean;
      } = {
        exists: false,
        websocketAvailable: typeof WebSocket !== 'undefined',
      };

      // æª¢æŸ¥æ˜¯å¦æœ‰ TranscriptManager
      const transcriptManager = (window as any).transcriptManager;
      if (transcriptManager) {
        result.exists = true;
        result.isConnected = transcriptManager.isConnected?.() || false;
        result.hasListeners = transcriptManager.listeners?.size > 0 || false;
      }
      return result;
    });

    console.log('WebSocket ç‹€æ…‹:', wsStatus)

    // é©—è­‰ WebSocket å¯ç”¨æ€§
    expect(wsStatus.websocketAvailable).toBe(true)

    if (wsStatus.exists) {
      console.log('âœ… TranscriptManager å·²æ‰¾åˆ°')
    } else {
      console.log('â„¹ï¸ TranscriptManager å°šæœªåˆå§‹åŒ–ï¼Œé€™å¯èƒ½æ˜¯æ­£å¸¸çš„')
    }
  })

  test('æ‡‰è©²èƒ½å¤ æ¸¬è©¦ç‹€æ…‹ç®¡ç†ç³»çµ±', async ({ page }) => {
    await page.waitForSelector('body', { timeout: 5000 });
    const hasBody = (await page.locator('body').count()) > 0;
    expect(hasBody).toBe(true);

    const appState = await page.evaluate(() => {
      return {
        hasFeatureFlags: !!(window as any).featureFlags,
        hasStateMachine: !!(window as any).stateMachine,
      };
    });

    // å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })
    await page.reload()
    await page.waitForLoadState('networkidle')

    console.log('ğŸ¬ é–‹å§‹æ¨¡æ“¬å®Œæ•´éŒ„éŸ³æµç¨‹...')

    // æ­¥é©Ÿ 1: æª¢æŸ¥åˆå§‹ç‹€æ…‹
    const initialState = await page.evaluate(() => {
      return {
        url: window.location.href,
        title: document.title,
        hasAudio: navigator.mediaDevices !== undefined
      }
    })

    console.log('åˆå§‹ç‹€æ…‹:', initialState)

    // æ­¥é©Ÿ 2: å°‹æ‰¾ä¸¦é»æ“Šé–‹å§‹éŒ„éŸ³çš„æŒ‰éˆ•
    const startButtons = [
      'button:has-text("é–‹å§‹éŒ„éŸ³")',
      'button:has-text("Start Recording")',
      'button:has-text("éŒ„éŸ³")',
      'button:has-text("Record")',
      '[data-testid="start-recording"]',
      '.record-button',
      'button[aria-label*="éŒ„éŸ³"]'
    ]

    let recordingStarted = false

    for (const selector of startButtons) {
      const button = page.locator(selector).first()
      if (await button.count() > 0 && await button.isVisible()) {
        console.log(`æ‰¾åˆ°éŒ„éŸ³æŒ‰éˆ•: ${selector}`)
        await button.click()
        await page.waitForTimeout(1000)
        recordingStarted = true
        break
      }
    }

    if (!recordingStarted) {
      console.log('â„¹ï¸ æœªæ‰¾åˆ°æ˜é¡¯çš„éŒ„éŸ³æŒ‰éˆ•ï¼Œå˜—è©¦å…¶ä»–æ–¹å¼...')

      // å˜—è©¦é€éç‹€æ…‹æ©Ÿç›´æ¥å•Ÿå‹•éŒ„éŸ³
      const stateMachineResult = await page.evaluate(() => {
        const sm = (window as any).stateMachine
        if (sm && sm.canTransition && sm.transition) {
          try {
            if (sm.canTransition('USER_START_RECORDING')) {
              const result = sm.transition('USER_START_RECORDING')
              return { success: true, result }
            }
          } catch (error) {
            return { success: false, error: error instanceof Error ? error.message : String(error) }
          }
        }
        return { success: false, reason: 'StateMachine not available' }
      })

      console.log('ç‹€æ…‹æ©ŸéŒ„éŸ³å˜—è©¦:', stateMachineResult)
    }

    // æ­¥é©Ÿ 3: ç­‰å¾…ä¸¦æª¢æŸ¥éŒ„éŸ³ç‹€æ…‹
    await page.waitForTimeout(2000)

    // æ­¥é©Ÿ 4: æª¢æŸ¥æ˜¯å¦æœ‰é€å­—ç¨¿å€åŸŸ
    const transcriptArea = page.locator('.transcript, [data-testid="transcript"], .transcription').first()

    if (await transcriptArea.count() > 0) {
      console.log('âœ… æ‰¾åˆ°é€å­—ç¨¿å€åŸŸ')
      await expect(transcriptArea).toBeVisible()
    } else {
      console.log('â„¹ï¸ æœªæ‰¾åˆ°æ˜é¡¯çš„é€å­—ç¨¿å€åŸŸ')
    }

    // æ­¥é©Ÿ 5: æ¨¡æ“¬é€å­—ç¨¿æ•¸æ“šï¼ˆå¦‚æœæœ‰ç›¸é—œ APIï¼‰
    const mockTranscriptResult = await page.evaluate(() => {
      // å˜—è©¦æ¨¡æ“¬é€å­—ç¨¿æ•¸æ“š
      const mockTranscript = {
        id: 'test-' + Date.now(),
        text: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦é€å­—ç¨¿',
        timestamp: new Date().toISOString(),
        confidence: 0.95
      }

      // å¦‚æœæœ‰ TranscriptManagerï¼Œå˜—è©¦æ·»åŠ æ¸¬è©¦æ•¸æ“š
      const tm = (window as any).transcriptManager
      if (tm && tm.addTranscript) {
        try {
          tm.addTranscript(mockTranscript)
          return { success: true, transcript: mockTranscript }
        } catch (error) {
          return { success: false, error: error instanceof Error ? error.message : String(error) }
        }
      }

      return { success: false, reason: 'TranscriptManager not available' }
    })

    console.log('æ¨¡æ“¬é€å­—ç¨¿çµæœ:', mockTranscriptResult)

    // æ­¥é©Ÿ 6: æª¢æŸ¥æœ€çµ‚ç‹€æ…‹
    const finalState = await page.evaluate(() => {
      return {
        featureFlags: (window as any).featureFlags?.getAll(),
        stateMachine: (window as any).stateMachine?.getCurrentState?.(),
        transcriptManager: !!(window as any).transcriptManager
      }
    })

    console.log('æœ€çµ‚ç‹€æ…‹:', finalState)

    // é©—è­‰æ¸¬è©¦çµæœ
    expect(finalState.featureFlags).toBeDefined()
    console.log('ğŸ‰ å®Œæ•´éŒ„éŸ³æµç¨‹æ¨¡æ“¬å®Œæˆ')
  })

  test('æ‡‰è©²èƒ½å¤ æ¸¬è©¦åŠŸèƒ½é–‹é—œåˆ‡æ›', async ({ page }) => {
    console.log('ğŸ”„ æ¸¬è©¦åŠŸèƒ½é–‹é—œåˆ‡æ›...')

    // æ¸¬è©¦é—œé–‰ç‹€æ…‹
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.disableAll()
      }
    })

    await page.reload()
    await page.waitForLoadState('networkidle')

    let flagsOff = await page.evaluate(() => {
      return (window as any).featureFlags?.getAll()
    })

    console.log('åŠŸèƒ½é–‹é—œé—œé–‰ç‹€æ…‹:', flagsOff)

    // æ¸¬è©¦é–‹å•Ÿç‹€æ…‹
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })

    await page.reload()
    await page.waitForLoadState('networkidle')

    let flagsOn = await page.evaluate(() => {
      return (window as any).featureFlags?.getAll()
    })

    console.log('åŠŸèƒ½é–‹é—œé–‹å•Ÿç‹€æ…‹:', flagsOn)

    // é©—è­‰åˆ‡æ›æˆåŠŸ
    expect(flagsOff?.useNewStateManagement).toBe(false)
    expect(flagsOn?.useNewStateManagement).toBe(true)

    console.log('âœ… åŠŸèƒ½é–‹é—œåˆ‡æ›æ¸¬è©¦å®Œæˆ')
  })
})

test.describe('å›æ­¸æ¸¬è©¦', () => {
  test('æ‡‰è©²ç¢ºä¿ç¾æœ‰åŠŸèƒ½ä¸å—å½±éŸ¿', async ({ page }) => {
    console.log('ğŸ” åŸ·è¡Œå›æ­¸æ¸¬è©¦...')

    // ä½¿ç”¨é è¨­è¨­ç½®ï¼ˆæ–°åŠŸèƒ½é—œé–‰ï¼‰
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.reset()
      }
    })

    await page.reload()
    await page.waitForLoadState('networkidle')
    await page.waitForSelector('body', { timeout: 5000 });
    const hasBody = (await page.locator('body').count()) > 0;
    expect(hasBody).toBe(true);

    const basicFunctions = await page.evaluate(() => {
      return {
        hasTitle: !!document.title,
        hasFeatureFlags: !!(window as any).featureFlags,
        canUseLocalStorage: !!window.localStorage,
        canUseWebSocket: !!window.WebSocket
      };
    });

    console.log('åŸºæœ¬åŠŸèƒ½æª¢æŸ¥:', basicFunctions)

    // é©—è­‰åŸºæœ¬åŠŸèƒ½
    expect(basicFunctions.hasTitle).toBe(true)
    expect(basicFunctions.hasFeatureFlags).toBe(true)
    expect(basicFunctions.canUseLocalStorage).toBe(true)
    expect(basicFunctions.canUseWebSocket).toBe(true)

    console.log('âœ… å›æ­¸æ¸¬è©¦é€šé')
  })
})


# END FILE CONTENTS


# File: e2e/export-api.spec.ts

const TEST_SESSION_ID = 'EE002F79-B1C1-4900-A0BA-C81FDA4F89FD'


# END FILE CONTENTS


# File: app/services/stt/lang_map.py

"""Convert canonical BCP-47 lang_code â‡„ provider-specific code."""

_CANONICAL_TO_SHORT = {
    "zh-TW": "zh",
    "zh":    "zh",
    "en-US": "en",
    "en":    "en",
}

def to_whisper(code: str) -> str:
    """Whisper ç«¯é»èªè¨€ç¢¼ï¼ˆISO-639-1ï¼Œå°å¯«ï¼›æœªçŸ¥â†’'auto')."""
    return _CANONICAL_TO_SHORT.get(code, "auto")

def to_gpt4o(code: str) -> str:
    """GPT-4o speech-transcribe èªè¨€ç¢¼ï¼ˆåŒ Whisperï¼‰"""
    return _CANONICAL_TO_SHORT.get(code, "auto")


# END FILE CONTENTS


# File: frontend/hooks/use-recording-adapter.ts

"use client"

import { useRecording as useRecordingLegacy } from './use-recording'
import { useRecordingNew } from './use-recording-new'
import { isFeatureEnabled } from '../lib/feature-flags'
import { TranscriptMessage } from '../lib/transcript-manager'

// çµ±ä¸€çš„ UseRecording ä»‹é¢
interface UseRecordingReturn {
    isRecording: boolean
    recordingTime: number
    transcripts: TranscriptMessage[]
    transcriptCompleted: boolean
    error: string | null
    startRecording: (sessionId: string) => Promise<void>
    stopRecording: () => void
    clearTranscripts: () => void
}

/**
 * useRecording é©é…å™¨ Hook
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨æ–°èˆŠç‰ˆæœ¬çš„ useRecording
 * ç¢ºä¿ API å®Œå…¨ç›¸å®¹ï¼Œç¾æœ‰çµ„ä»¶ç„¡éœ€ä¿®æ”¹
 */
export function useRecording(): UseRecordingReturn {
    const useNewRecordingHook = isFeatureEnabled('useNewRecordingHook')
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')

    console.log('ğŸ”„ [useRecordingAdapter] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewRecordingHook,
        useNewStateManagement,
        willUseNewVersion: useNewRecordingHook || useNewStateManagement
    })

    // å¦‚æœå•Ÿç”¨æ–° Recording Hook æˆ–æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬
    if (useNewRecordingHook || useNewStateManagement) {
        console.log('ğŸ”„ [useRecordingAdapter] ä½¿ç”¨æ–°ç‰ˆæœ¬ useRecordingNew')
        return useRecordingNew()
    }

    // å¦å‰‡ä½¿ç”¨èˆŠç‰ˆæœ¬
    console.log('ğŸ”„ [useRecordingAdapter] ä½¿ç”¨èˆŠç‰ˆæœ¬ useRecording')
    return useRecordingLegacy()
}

// å°å‡ºèˆŠç‰ˆæœ¬ä¾›ç›´æ¥ä½¿ç”¨ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ç‰¹æ®Šæƒ…æ³ï¼‰
export { useRecording as useRecordingLegacy } from './use-recording'
export { useRecordingNew } from './use-recording-new'


# END FILE CONTENTS


# File: frontend/pnpm-lock.yaml

lockfileVersion: '9.0'

settings:
  autoInstallPeers: true
  excludeLinksFromLockfile: false

importers:

  .:
    dependencies:
      '@hookform/resolvers':
        specifier: ^3.9.1
        version: 3.10.0(react-hook-form@7.59.0(react@19.1.0))
      '@radix-ui/react-accordion':
        specifier: 1.2.2
        version: 1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-alert-dialog':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-aspect-ratio':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-avatar':
        specifier: 1.1.2
        version: 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-checkbox':
        specifier: 1.1.3
        version: 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-collapsible':
        specifier: 1.1.2
        version: 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-context-menu':
        specifier: 2.2.4
        version: 2.2.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-dialog':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-dropdown-menu':
        specifier: 2.1.4
        version: 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-hover-card':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-label':
        specifier: 2.1.1
        version: 2.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-menubar':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-navigation-menu':
        specifier: 1.2.3
        version: 1.2.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-popover':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-progress':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-radio-group':
        specifier: 1.2.2
        version: 1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-scroll-area':
        specifier: 1.2.2
        version: 1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-select':
        specifier: 2.1.4
        version: 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-separator':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slider':
        specifier: 1.2.2
        version: 1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot':
        specifier: 1.1.1
        version: 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-switch':
        specifier: 1.1.2
        version: 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-tabs':
        specifier: 1.1.2
        version: 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-toast':
        specifier: 1.2.4
        version: 1.2.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-toggle':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-toggle-group':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-tooltip':
        specifier: 1.1.6
        version: 1.1.6(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      axios:
        specifier: ^1.10.0
        version: 1.10.0
      class-variance-authority:
        specifier: ^0.7.1
        version: 0.7.1
      clsx:
        specifier: ^2.1.1
        version: 2.1.1
      cmdk:
        specifier: 1.0.4
        version: 1.0.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      date-fns:
        specifier: 4.1.0
        version: 4.1.0
      easymde:
        specifier: latest
        version: 2.20.0
      embla-carousel-react:
        specifier: 8.5.1
        version: 8.5.1(react@19.1.0)
      input-otp:
        specifier: 1.4.1
        version: 1.4.1(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      lucide-react:
        specifier: ^0.454.0
        version: 0.454.0(react@19.1.0)
      next:
        specifier: 15.2.4
        version: 15.2.4(@babel/core@7.28.0)(@playwright/test@1.53.2)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      next-themes:
        specifier: ^0.4.4
        version: 0.4.6(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react:
        specifier: ^19
        version: 19.1.0
      react-day-picker:
        specifier: 8.10.1
        version: 8.10.1(date-fns@4.1.0)(react@19.1.0)
      react-dom:
        specifier: ^19
        version: 19.1.0(react@19.1.0)
      react-hook-form:
        specifier: ^7.54.1
        version: 7.59.0(react@19.1.0)
      react-resizable-panels:
        specifier: ^2.1.7
        version: 2.1.9(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react-simplemde-editor:
        specifier: latest
        version: 5.2.0(easymde@2.20.0)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      recharts:
        specifier: 2.15.0
        version: 2.15.0(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      sonner:
        specifier: ^1.7.1
        version: 1.7.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      tailwind-merge:
        specifier: ^2.5.5
        version: 2.6.0
      tailwindcss-animate:
        specifier: ^1.0.7
        version: 1.0.7(tailwindcss@3.4.17)
      vaul:
        specifier: ^0.9.6
        version: 0.9.9(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      zod:
        specifier: ^3.24.1
        version: 3.25.71
      zustand:
        specifier: ^5.0.6
        version: 5.0.6(@types/react@19.1.8)(react@19.1.0)(use-sync-external-store@1.5.0(react@19.1.0))
    devDependencies:
      '@playwright/test':
        specifier: ^1.44.1
        version: 1.53.2
      '@testing-library/jest-dom':
        specifier: ^6.6.3
        version: 6.6.3
      '@testing-library/react':
        specifier: ^16.3.0
        version: 16.3.0(@testing-library/dom@10.4.0)(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@testing-library/user-event':
        specifier: ^14.6.1
        version: 14.6.1(@testing-library/dom@10.4.0)
      '@types/node':
        specifier: ^22
        version: 22.16.0
      '@types/react':
        specifier: ^19
        version: 19.1.8
      '@types/react-dom':
        specifier: ^19
        version: 19.1.6(@types/react@19.1.8)
      '@vitejs/plugin-react':
        specifier: ^4.6.0
        version: 4.6.0(vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0))
      '@vitest/ui':
        specifier: ^3.2.4
        version: 3.2.4(vitest@3.2.4)
      autoprefixer:
        specifier: ^10.4.20
        version: 10.4.21(postcss@8.5.6)
      eslint:
        specifier: ^9
        version: 9.30.1(jiti@1.21.7)
      eslint-config-next:
        specifier: 15.3.4
        version: 15.3.4(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      jsdom:
        specifier: ^26.1.0
        version: 26.1.0
      postcss:
        specifier: ^8.5.0
        version: 8.5.6
      tailwindcss:
        specifier: ^3.4.17
        version: 3.4.17
      typescript:
        specifier: ^5
        version: 5.8.3
      vitest:
        specifier: ^3.2.4
        version: 3.2.4(@types/node@22.16.0)(@vitest/ui@3.2.4)(jiti@1.21.7)(jsdom@26.1.0)(yaml@2.8.0)

packages:

  '@adobe/css-tools@4.4.3':
    resolution: {integrity: sha512-VQKMkwriZbaOgVCby1UDY/LDk5fIjhQicCvVPFqfe+69fWaPWydbWJ3wRt59/YzIwda1I81loas3oCoHxnqvdA==}

  '@alloc/quick-lru@5.2.0':
    resolution: {integrity: sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw==}
    engines: {node: '>=10'}

  '@ampproject/remapping@2.3.0':
    resolution: {integrity: sha512-30iZtAPgz+LTIYoeivqYo853f02jBYSd5uGnGpkFV0M3xOt9aN73erkgYAmZU43x4VfqcnLxW9Kpg3R5LC4YYw==}
    engines: {node: '>=6.0.0'}

  '@asamuzakjp/css-color@3.2.0':
    resolution: {integrity: sha512-K1A6z8tS3XsmCMM86xoWdn7Fkdn9m6RSVtocUrJYIwZnFVkng/PvkEoWtOWmP+Scc6saYWHWZYbndEEXxl24jw==}

  '@babel/code-frame@7.27.1':
    resolution: {integrity: sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==}
    engines: {node: '>=6.9.0'}

  '@babel/compat-data@7.28.0':
    resolution: {integrity: sha512-60X7qkglvrap8mn1lh2ebxXdZYtUcpd7gsmy9kLaBJ4i/WdY8PqTSdxyA8qraikqKQK5C1KRBKXqznrVapyNaw==}
    engines: {node: '>=6.9.0'}

  '@babel/core@7.28.0':
    resolution: {integrity: sha512-UlLAnTPrFdNGoFtbSXwcGFQBtQZJCNjaN6hQNP3UPvuNXT1i82N26KL3dZeIpNalWywr9IuQuncaAfUaS1g6sQ==}
    engines: {node: '>=6.9.0'}

  '@babel/generator@7.28.0':
    resolution: {integrity: sha512-lJjzvrbEeWrhB4P3QBsH7tey117PjLZnDbLiQEKjQ/fNJTjuq4HSqgFA+UNSwZT8D7dxxbnuSBMsa1lrWzKlQg==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-compilation-targets@7.27.2':
    resolution: {integrity: sha512-2+1thGUUWWjLTYTHZWK1n8Yga0ijBz1XAhUXcKy81rd5g6yh7hGqMp45v7cadSbEHc9G3OTv45SyneRN3ps4DQ==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-globals@7.28.0':
    resolution: {integrity: sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-module-imports@7.27.1':
    resolution: {integrity: sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-module-transforms@7.27.3':
    resolution: {integrity: sha512-dSOvYwvyLsWBeIRyOeHXp5vPj5l1I011r52FM1+r1jCERv+aFXYk4whgQccYEGYxK2H3ZAIA8nuPkQ0HaUo3qg==}
    engines: {node: '>=6.9.0'}
    peerDependencies:
      '@babel/core': ^7.0.0

  '@babel/helper-plugin-utils@7.27.1':
    resolution: {integrity: sha512-1gn1Up5YXka3YYAHGKpbideQ5Yjf1tDa9qYcgysz+cNCXukyLl6DjPXhD3VRwSb8c0J9tA4b2+rHEZtc6R0tlw==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-string-parser@7.27.1':
    resolution: {integrity: sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-validator-identifier@7.27.1':
    resolution: {integrity: sha512-D2hP9eA+Sqx1kBZgzxZh0y1trbuU+JoDkiEwqhQ36nodYqJwyEIhPSdMNd7lOm/4io72luTPWH20Yda0xOuUow==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-validator-option@7.27.1':
    resolution: {integrity: sha512-YvjJow9FxbhFFKDSuFnVCe2WxXk1zWc22fFePVNEaWJEu8IrZVlda6N0uHwzZrUM1il7NC9Mlp4MaJYbYd9JSg==}
    engines: {node: '>=6.9.0'}

  '@babel/helpers@7.27.6':
    resolution: {integrity: sha512-muE8Tt8M22638HU31A3CgfSUciwz1fhATfoVai05aPXGor//CdWDCbnlY1yvBPo07njuVOCNGCSp/GTt12lIug==}
    engines: {node: '>=6.9.0'}

  '@babel/parser@7.28.0':
    resolution: {integrity: sha512-jVZGvOxOuNSsuQuLRTh13nU0AogFlw32w/MT+LV6D3sP5WdbW61E77RnkbaO2dUvmPAYrBDJXGn5gGS6tH4j8g==}
    engines: {node: '>=6.0.0'}
    hasBin: true

  '@babel/plugin-transform-react-jsx-self@7.27.1':
    resolution: {integrity: sha512-6UzkCs+ejGdZ5mFFC/OCUrv028ab2fp1znZmCZjAOBKiBK2jXD1O+BPSfX8X2qjJ75fZBMSnQn3Rq2mrBJK2mw==}
    engines: {node: '>=6.9.0'}
    peerDependencies:
      '@babel/core': ^7.0.0-0

  '@babel/plugin-transform-react-jsx-source@7.27.1':
    resolution: {integrity: sha512-zbwoTsBruTeKB9hSq73ha66iFeJHuaFkUbwvqElnygoNbj/jHRsSeokowZFN3CZ64IvEqcmmkVe89OPXc7ldAw==}
    engines: {node: '>=6.9.0'}
    peerDependencies:
      '@babel/core': ^7.0.0-0

  '@babel/runtime@7.27.6':
    resolution: {integrity: sha512-vbavdySgbTTrmFE+EsiqUTzlOr5bzlnJtUv9PynGCAKvfQqjIXbvFdumPM/GxMDfyuGMJaJAU6TO4zc1Jf1i8Q==}
    engines: {node: '>=6.9.0'}

  '@babel/template@7.27.2':
    resolution: {integrity: sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==}
    engines: {node: '>=6.9.0'}

  '@babel/traverse@7.28.0':
    resolution: {integrity: sha512-mGe7UK5wWyh0bKRfupsUchrQGqvDbZDbKJw+kcRGSmdHVYrv+ltd0pnpDTVpiTqnaBru9iEvA8pz8W46v0Amwg==}
    engines: {node: '>=6.9.0'}

  '@babel/types@7.28.0':
    resolution: {integrity: sha512-jYnje+JyZG5YThjHiF28oT4SIZLnYOcSBb6+SDaFIyzDVSkXQmQQYclJ2R+YxcdmK0AX6x1E5OQNtuh3jHDrUg==}
    engines: {node: '>=6.9.0'}

  '@csstools/color-helpers@5.0.2':
    resolution: {integrity: sha512-JqWH1vsgdGcw2RR6VliXXdA0/59LttzlU8UlRT/iUUsEeWfYq8I+K0yhihEUTTHLRm1EXvpsCx3083EU15ecsA==}
    engines: {node: '>=18'}

  '@csstools/css-calc@2.1.4':
    resolution: {integrity: sha512-3N8oaj+0juUw/1H3YwmDDJXCgTB1gKU6Hc/bB502u9zR0q2vd786XJH9QfrKIEgFlZmhZiq6epXl4rHqhzsIgQ==}
    engines: {node: '>=18'}
    peerDependencies:
      '@csstools/css-parser-algorithms': ^3.0.5
      '@csstools/css-tokenizer': ^3.0.4

  '@csstools/css-color-parser@3.0.10':
    resolution: {integrity: sha512-TiJ5Ajr6WRd1r8HSiwJvZBiJOqtH86aHpUjq5aEKWHiII2Qfjqd/HCWKPOW8EP4vcspXbHnXrwIDlu5savQipg==}
    engines: {node: '>=18'}
    peerDependencies:
      '@csstools/css-parser-algorithms': ^3.0.5
      '@csstools/css-tokenizer': ^3.0.4

  '@csstools/css-parser-algorithms@3.0.5':
    resolution: {integrity: sha512-DaDeUkXZKjdGhgYaHNJTV9pV7Y9B3b644jCLs9Upc3VeNGg6LWARAT6O+Q+/COo+2gg/bM5rhpMAtf70WqfBdQ==}
    engines: {node: '>=18'}
    peerDependencies:
      '@csstools/css-tokenizer': ^3.0.4

  '@csstools/css-tokenizer@3.0.4':
    resolution: {integrity: sha512-Vd/9EVDiu6PPJt9yAh6roZP6El1xHrdvIVGjyBsHR0RYwNHgL7FJPyIIW4fANJNG6FtyZfvlRPpFI4ZM/lubvw==}
    engines: {node: '>=18'}

  '@emnapi/core@1.4.3':
    resolution: {integrity: sha512-4m62DuCE07lw01soJwPiBGC0nAww0Q+RY70VZ+n49yDIO13yyinhbWCeNnaob0lakDtWQzSdtNWzJeOJt2ma+g==}

  '@emnapi/runtime@1.4.3':
    resolution: {integrity: sha512-pBPWdu6MLKROBX05wSNKcNb++m5Er+KQ9QkB+WVM+pW2Kx9hoSrVTnu3BdkI5eBLZoKu/J6mW/B6i6bJB2ytXQ==}

  '@emnapi/wasi-threads@1.0.2':
    resolution: {integrity: sha512-5n3nTJblwRi8LlXkJ9eBzu+kZR8Yxcc7ubakyQTFzPMtIhFpUBRbsnc2Dv88IZDIbCDlBiWrknhB4Lsz7mg6BA==}

  '@esbuild/aix-ppc64@0.25.5':
    resolution: {integrity: sha512-9o3TMmpmftaCMepOdA5k/yDw8SfInyzWWTjYTFCX3kPSDJMROQTb8jg+h9Cnwnmm1vOzvxN7gIfB5V2ewpjtGA==}
    engines: {node: '>=18'}
    cpu: [ppc64]
    os: [aix]

  '@esbuild/android-arm64@0.25.5':
    resolution: {integrity: sha512-VGzGhj4lJO+TVGV1v8ntCZWJktV7SGCs3Pn1GRWI1SBFtRALoomm8k5E9Pmwg3HOAal2VDc2F9+PM/rEY6oIDg==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [android]

  '@esbuild/android-arm@0.25.5':
    resolution: {integrity: sha512-AdJKSPeEHgi7/ZhuIPtcQKr5RQdo6OO2IL87JkianiMYMPbCtot9fxPbrMiBADOWWm3T2si9stAiVsGbTQFkbA==}
    engines: {node: '>=18'}
    cpu: [arm]
    os: [android]

  '@esbuild/android-x64@0.25.5':
    resolution: {integrity: sha512-D2GyJT1kjvO//drbRT3Hib9XPwQeWd9vZoBJn+bu/lVsOZ13cqNdDeqIF/xQ5/VmWvMduP6AmXvylO/PIc2isw==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [android]

  '@esbuild/darwin-arm64@0.25.5':
    resolution: {integrity: sha512-GtaBgammVvdF7aPIgH2jxMDdivezgFu6iKpmT+48+F8Hhg5J/sfnDieg0aeG/jfSvkYQU2/pceFPDKlqZzwnfQ==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [darwin]

  '@esbuild/darwin-x64@0.25.5':
    resolution: {integrity: sha512-1iT4FVL0dJ76/q1wd7XDsXrSW+oLoquptvh4CLR4kITDtqi2e/xwXwdCVH8hVHU43wgJdsq7Gxuzcs6Iq/7bxQ==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [darwin]

  '@esbuild/freebsd-arm64@0.25.5':
    resolution: {integrity: sha512-nk4tGP3JThz4La38Uy/gzyXtpkPW8zSAmoUhK9xKKXdBCzKODMc2adkB2+8om9BDYugz+uGV7sLmpTYzvmz6Sw==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [freebsd]

  '@esbuild/freebsd-x64@0.25.5':
    resolution: {integrity: sha512-PrikaNjiXdR2laW6OIjlbeuCPrPaAl0IwPIaRv+SMV8CiM8i2LqVUHFC1+8eORgWyY7yhQY+2U2fA55mBzReaw==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [freebsd]

  '@esbuild/linux-arm64@0.25.5':
    resolution: {integrity: sha512-Z9kfb1v6ZlGbWj8EJk9T6czVEjjq2ntSYLY2cw6pAZl4oKtfgQuS4HOq41M/BcoLPzrUbNd+R4BXFyH//nHxVg==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [linux]

  '@esbuild/linux-arm@0.25.5':
    resolution: {integrity: sha512-cPzojwW2okgh7ZlRpcBEtsX7WBuqbLrNXqLU89GxWbNt6uIg78ET82qifUy3W6OVww6ZWobWub5oqZOVtwolfw==}
    engines: {node: '>=18'}
    cpu: [arm]
    os: [linux]

  '@esbuild/linux-ia32@0.25.5':
    resolution: {integrity: sha512-sQ7l00M8bSv36GLV95BVAdhJ2QsIbCuCjh/uYrWiMQSUuV+LpXwIqhgJDcvMTj+VsQmqAHL2yYaasENvJ7CDKA==}
    engines: {node: '>=18'}
    cpu: [ia32]
    os: [linux]

  '@esbuild/linux-loong64@0.25.5':
    resolution: {integrity: sha512-0ur7ae16hDUC4OL5iEnDb0tZHDxYmuQyhKhsPBV8f99f6Z9KQM02g33f93rNH5A30agMS46u2HP6qTdEt6Q1kg==}
    engines: {node: '>=18'}
    cpu: [loong64]
    os: [linux]

  '@esbuild/linux-mips64el@0.25.5':
    resolution: {integrity: sha512-kB/66P1OsHO5zLz0i6X0RxlQ+3cu0mkxS3TKFvkb5lin6uwZ/ttOkP3Z8lfR9mJOBk14ZwZ9182SIIWFGNmqmg==}
    engines: {node: '>=18'}
    cpu: [mips64el]
    os: [linux]

  '@esbuild/linux-ppc64@0.25.5':
    resolution: {integrity: sha512-UZCmJ7r9X2fe2D6jBmkLBMQetXPXIsZjQJCjgwpVDz+YMcS6oFR27alkgGv3Oqkv07bxdvw7fyB71/olceJhkQ==}
    engines: {node: '>=18'}
    cpu: [ppc64]
    os: [linux]

  '@esbuild/linux-riscv64@0.25.5':
    resolution: {integrity: sha512-kTxwu4mLyeOlsVIFPfQo+fQJAV9mh24xL+y+Bm6ej067sYANjyEw1dNHmvoqxJUCMnkBdKpvOn0Ahql6+4VyeA==}
    engines: {node: '>=18'}
    cpu: [riscv64]
    os: [linux]

  '@esbuild/linux-s390x@0.25.5':
    resolution: {integrity: sha512-K2dSKTKfmdh78uJ3NcWFiqyRrimfdinS5ErLSn3vluHNeHVnBAFWC8a4X5N+7FgVE1EjXS1QDZbpqZBjfrqMTQ==}
    engines: {node: '>=18'}
    cpu: [s390x]
    os: [linux]

  '@esbuild/linux-x64@0.25.5':
    resolution: {integrity: sha512-uhj8N2obKTE6pSZ+aMUbqq+1nXxNjZIIjCjGLfsWvVpy7gKCOL6rsY1MhRh9zLtUtAI7vpgLMK6DxjO8Qm9lJw==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [linux]

  '@esbuild/netbsd-arm64@0.25.5':
    resolution: {integrity: sha512-pwHtMP9viAy1oHPvgxtOv+OkduK5ugofNTVDilIzBLpoWAM16r7b/mxBvfpuQDpRQFMfuVr5aLcn4yveGvBZvw==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [netbsd]

  '@esbuild/netbsd-x64@0.25.5':
    resolution: {integrity: sha512-WOb5fKrvVTRMfWFNCroYWWklbnXH0Q5rZppjq0vQIdlsQKuw6mdSihwSo4RV/YdQ5UCKKvBy7/0ZZYLBZKIbwQ==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [netbsd]

  '@esbuild/openbsd-arm64@0.25.5':
    resolution: {integrity: sha512-7A208+uQKgTxHd0G0uqZO8UjK2R0DDb4fDmERtARjSHWxqMTye4Erz4zZafx7Di9Cv+lNHYuncAkiGFySoD+Mw==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [openbsd]

  '@esbuild/openbsd-x64@0.25.5':
    resolution: {integrity: sha512-G4hE405ErTWraiZ8UiSoesH8DaCsMm0Cay4fsFWOOUcz8b8rC6uCvnagr+gnioEjWn0wC+o1/TAHt+It+MpIMg==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [openbsd]

  '@esbuild/sunos-x64@0.25.5':
    resolution: {integrity: sha512-l+azKShMy7FxzY0Rj4RCt5VD/q8mG/e+mDivgspo+yL8zW7qEwctQ6YqKX34DTEleFAvCIUviCFX1SDZRSyMQA==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [sunos]

  '@esbuild/win32-arm64@0.25.5':
    resolution: {integrity: sha512-O2S7SNZzdcFG7eFKgvwUEZ2VG9D/sn/eIiz8XRZ1Q/DO5a3s76Xv0mdBzVM5j5R639lXQmPmSo0iRpHqUUrsxw==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [win32]

  '@esbuild/win32-ia32@0.25.5':
    resolution: {integrity: sha512-onOJ02pqs9h1iMJ1PQphR+VZv8qBMQ77Klcsqv9CNW2w6yLqoURLcgERAIurY6QE63bbLuqgP9ATqajFLK5AMQ==}
    engines: {node: '>=18'}
    cpu: [ia32]
    os: [win32]

  '@esbuild/win32-x64@0.25.5':
    resolution: {integrity: sha512-TXv6YnJ8ZMVdX+SXWVBo/0p8LTcrUYngpWjvm91TMjjBQii7Oz11Lw5lbDV5Y0TzuhSJHwiH4hEtC1I42mMS0g==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [win32]

  '@eslint-community/eslint-utils@4.7.0':
    resolution: {integrity: sha512-dyybb3AcajC7uha6CvhdVRJqaKyn7w2YKqKyAN37NKYgZT36w+iRb0Dymmc5qEJ549c/S31cMMSFd75bteCpCw==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    peerDependencies:
      eslint: ^6.0.0 || ^7.0.0 || >=8.0.0

  '@eslint-community/regexpp@4.12.1':
    resolution: {integrity: sha512-CCZCDJuduB9OUkFkY2IgppNZMi2lBQgD2qzwXkEia16cge2pijY/aXi96CJMquDMn3nJdlPV1A5KrJEXwfLNzQ==}
    engines: {node: ^12.0.0 || ^14.0.0 || >=16.0.0}

  '@eslint/config-array@0.21.0':
    resolution: {integrity: sha512-ENIdc4iLu0d93HeYirvKmrzshzofPw6VkZRKQGe9Nv46ZnWUzcF1xV01dcvEg/1wXUR61OmmlSfyeyO7EvjLxQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/config-helpers@0.3.0':
    resolution: {integrity: sha512-ViuymvFmcJi04qdZeDc2whTHryouGcDlaxPqarTD0ZE10ISpxGUVZGZDx4w01upyIynL3iu6IXH2bS1NhclQMw==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/core@0.14.0':
    resolution: {integrity: sha512-qIbV0/JZr7iSDjqAc60IqbLdsj9GDt16xQtWD+B78d/HAlvysGdZZ6rpJHGAc2T0FQx1X6thsSPdnoiGKdNtdg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/core@0.15.1':
    resolution: {integrity: sha512-bkOp+iumZCCbt1K1CmWf0R9pM5yKpDv+ZXtvSyQpudrI9kuFLp+bM2WOPXImuD/ceQuaa8f5pj93Y7zyECIGNA==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/eslintrc@3.3.1':
    resolution: {integrity: sha512-gtF186CXhIl1p4pJNGZw8Yc6RlshoePRvE0X91oPGb3vZ8pM3qOS9W9NGPat9LziaBV7XrJWGylNQXkGcnM3IQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/js@9.30.1':
    resolution: {integrity: sha512-zXhuECFlyep42KZUhWjfvsmXGX39W8K8LFb8AWXM9gSV9dQB+MrJGLKvW6Zw0Ggnbpw0VHTtrhFXYe3Gym18jg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/object-schema@2.1.6':
    resolution: {integrity: sha512-RBMg5FRL0I0gs51M/guSAj5/e14VQ4tpZnQNWwuDT66P14I43ItmPfIZRhO9fUVIPOAQXU47atlywZ/czoqFPA==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/plugin-kit@0.3.3':
    resolution: {integrity: sha512-1+WqvgNMhmlAambTvT3KPtCl/Ibr68VldY2XY40SL1CE0ZXiakFR/cbTspaF5HsnpDMvcYYoJHfl4980NBjGag==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@floating-ui/core@1.7.2':
    resolution: {integrity: sha512-wNB5ooIKHQc+Kui96jE/n69rHFWAVoxn5CAzL1Xdd8FG03cgY3MLO+GF9U3W737fYDSgPWA6MReKhBQBop6Pcw==}

  '@floating-ui/dom@1.7.2':
    resolution: {integrity: sha512-7cfaOQuCS27HD7DX+6ib2OrnW+b4ZBwDNnCcT0uTyidcmyWb03FnQqJybDBoCnpdxwBSfA94UAYlRCt7mV+TbA==}

  '@floating-ui/react-dom@2.1.4':
    resolution: {integrity: sha512-JbbpPhp38UmXDDAu60RJmbeme37Jbgsm7NrHGgzYYFKmblzRUh6Pa641dII6LsjwF4XlScDrde2UAzDo/b9KPw==}
    peerDependencies:
      react: '>=16.8.0'
      react-dom: '>=16.8.0'

  '@floating-ui/utils@0.2.10':
    resolution: {integrity: sha512-aGTxbpbg8/b5JfU1HXSrbH3wXZuLPJcNEcZQFMxLs3oSzgtVu6nFPkbbGGUvBcUjKV2YyB9Wxxabo+HEH9tcRQ==}

  '@hookform/resolvers@3.10.0':
    resolution: {integrity: sha512-79Dv+3mDF7i+2ajj7SkypSKHhl1cbln1OGavqrsF7p6mbUv11xpqpacPsGDCTRvCSjEEIez2ef1NveSVL3b0Ag==}
    peerDependencies:
      react-hook-form: ^7.0.0

  '@humanfs/core@0.19.1':
    resolution: {integrity: sha512-5DyQ4+1JEUzejeK1JGICcideyfUbGixgS9jNgex5nqkW+cY7WZhxBigmieN5Qnw9ZosSNVC9KQKyb+GUaGyKUA==}
    engines: {node: '>=18.18.0'}

  '@humanfs/node@0.16.6':
    resolution: {integrity: sha512-YuI2ZHQL78Q5HbhDiBA1X4LmYdXCKCMQIfw0pw7piHJwyREFebJUvrQN4cMssyES6x+vfUbx1CIpaQUKYdQZOw==}
    engines: {node: '>=18.18.0'}

  '@humanwhocodes/module-importer@1.0.1':
    resolution: {integrity: sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==}
    engines: {node: '>=12.22'}

  '@humanwhocodes/retry@0.3.1':
    resolution: {integrity: sha512-JBxkERygn7Bv/GbN5Rv8Ul6LVknS+5Bp6RgDC/O8gEBU/yeH5Ui5C/OlWrTb6qct7LjjfT6Re2NxB0ln0yYybA==}
    engines: {node: '>=18.18'}

  '@humanwhocodes/retry@0.4.3':
    resolution: {integrity: sha512-bV0Tgo9K4hfPCek+aMAn81RppFKv2ySDQeMoSZuvTASywNTnVJCArCZE2FWqpvIatKu7VMRLWlR1EazvVhDyhQ==}
    engines: {node: '>=18.18'}

  '@img/sharp-darwin-arm64@0.33.5':
    resolution: {integrity: sha512-UT4p+iz/2H4twwAoLCqfA9UH5pI6DggwKEGuaPy7nCVQ8ZsiY5PIcrRvD1DzuY3qYL07NtIQcWnBSY/heikIFQ==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [arm64]
    os: [darwin]

  '@img/sharp-darwin-x64@0.33.5':
    resolution: {integrity: sha512-fyHac4jIc1ANYGRDxtiqelIbdWkIuQaI84Mv45KvGRRxSAa7o7d1ZKAOBaYbnepLC1WqxfpimdeWfvqqSGwR2Q==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [x64]
    os: [darwin]

  '@img/sharp-libvips-darwin-arm64@1.0.4':
    resolution: {integrity: sha512-XblONe153h0O2zuFfTAbQYAX2JhYmDHeWikp1LM9Hul9gVPjFY427k6dFEcOL72O01QxQsWi761svJ/ev9xEDg==}
    cpu: [arm64]
    os: [darwin]

  '@img/sharp-libvips-darwin-x64@1.0.4':
    resolution: {integrity: sha512-xnGR8YuZYfJGmWPvmlunFaWJsb9T/AO2ykoP3Fz/0X5XV2aoYBPkX6xqCQvUTKKiLddarLaxpzNe+b1hjeWHAQ==}
    cpu: [x64]
    os: [darwin]

  '@img/sharp-libvips-linux-arm64@1.0.4':
    resolution: {integrity: sha512-9B+taZ8DlyyqzZQnoeIvDVR/2F4EbMepXMc/NdVbkzsJbzkUjhXv/70GQJ7tdLA4YJgNP25zukcxpX2/SueNrA==}
    cpu: [arm64]
    os: [linux]

  '@img/sharp-libvips-linux-arm@1.0.5':
    resolution: {integrity: sha512-gvcC4ACAOPRNATg/ov8/MnbxFDJqf/pDePbBnuBDcjsI8PssmjoKMAz4LtLaVi+OnSb5FK/yIOamqDwGmXW32g==}
    cpu: [arm]
    os: [linux]

  '@img/sharp-libvips-linux-s390x@1.0.4':
    resolution: {integrity: sha512-u7Wz6ntiSSgGSGcjZ55im6uvTrOxSIS8/dgoVMoiGE9I6JAfU50yH5BoDlYA1tcuGS7g/QNtetJnxA6QEsCVTA==}
    cpu: [s390x]
    os: [linux]

  '@img/sharp-libvips-linux-x64@1.0.4':
    resolution: {integrity: sha512-MmWmQ3iPFZr0Iev+BAgVMb3ZyC4KeFc3jFxnNbEPas60e1cIfevbtuyf9nDGIzOaW9PdnDciJm+wFFaTlj5xYw==}
    cpu: [x64]
    os: [linux]

  '@img/sharp-libvips-linuxmusl-arm64@1.0.4':
    resolution: {integrity: sha512-9Ti+BbTYDcsbp4wfYib8Ctm1ilkugkA/uscUn6UXK1ldpC1JjiXbLfFZtRlBhjPZ5o1NCLiDbg8fhUPKStHoTA==}
    cpu: [arm64]
    os: [linux]

  '@img/sharp-libvips-linuxmusl-x64@1.0.4':
    resolution: {integrity: sha512-viYN1KX9m+/hGkJtvYYp+CCLgnJXwiQB39damAO7WMdKWlIhmYTfHjwSbQeUK/20vY154mwezd9HflVFM1wVSw==}
    cpu: [x64]
    os: [linux]

  '@img/sharp-linux-arm64@0.33.5':
    resolution: {integrity: sha512-JMVv+AMRyGOHtO1RFBiJy/MBsgz0x4AWrT6QoEVVTyh1E39TrCUpTRI7mx9VksGX4awWASxqCYLCV4wBZHAYxA==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [arm64]
    os: [linux]

  '@img/sharp-linux-arm@0.33.5':
    resolution: {integrity: sha512-JTS1eldqZbJxjvKaAkxhZmBqPRGmxgu+qFKSInv8moZ2AmT5Yib3EQ1c6gp493HvrvV8QgdOXdyaIBrhvFhBMQ==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [arm]
    os: [linux]

  '@img/sharp-linux-s390x@0.33.5':
    resolution: {integrity: sha512-y/5PCd+mP4CA/sPDKl2961b+C9d+vPAveS33s6Z3zfASk2j5upL6fXVPZi7ztePZ5CuH+1kW8JtvxgbuXHRa4Q==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [s390x]
    os: [linux]

  '@img/sharp-linux-x64@0.33.5':
    resolution: {integrity: sha512-opC+Ok5pRNAzuvq1AG0ar+1owsu842/Ab+4qvU879ippJBHvyY5n2mxF1izXqkPYlGuP/M556uh53jRLJmzTWA==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [x64]
    os: [linux]

  '@img/sharp-linuxmusl-arm64@0.33.5':
    resolution: {integrity: sha512-XrHMZwGQGvJg2V/oRSUfSAfjfPxO+4DkiRh6p2AFjLQztWUuY/o8Mq0eMQVIY7HJ1CDQUJlxGGZRw1a5bqmd1g==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [arm64]
    os: [linux]

  '@img/sharp-linuxmusl-x64@0.33.5':
    resolution: {integrity: sha512-WT+d/cgqKkkKySYmqoZ8y3pxx7lx9vVejxW/W4DOFMYVSkErR+w7mf2u8m/y4+xHe7yY9DAXQMWQhpnMuFfScw==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [x64]
    os: [linux]

  '@img/sharp-wasm32@0.33.5':
    resolution: {integrity: sha512-ykUW4LVGaMcU9lu9thv85CbRMAwfeadCJHRsg2GmeRa/cJxsVY9Rbd57JcMxBkKHag5U/x7TSBpScF4U8ElVzg==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [wasm32]

  '@img/sharp-win32-ia32@0.33.5':
    resolution: {integrity: sha512-T36PblLaTwuVJ/zw/LaH0PdZkRz5rd3SmMHX8GSmR7vtNSP5Z6bQkExdSK7xGWyxLw4sUknBuugTelgw2faBbQ==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [ia32]
    os: [win32]

  '@img/sharp-win32-x64@0.33.5':
    resolution: {integrity: sha512-MpY/o8/8kj+EcnxwvrP4aTJSWw/aZ7JIGR4aBeZkZw5B7/Jn+tY9/VNwtcoGmdT7GfggGIU4kygOMSbYnOrAbg==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [x64]
    os: [win32]

  '@isaacs/cliui@8.0.2':
    resolution: {integrity: sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==}
    engines: {node: '>=12'}

  '@jridgewell/gen-mapping@0.3.12':
    resolution: {integrity: sha512-OuLGC46TjB5BbN1dH8JULVVZY4WTdkF7tV9Ys6wLL1rubZnCMstOhNHueU5bLCrnRuDhKPDM4g6sw4Bel5Gzqg==}

  '@jridgewell/resolve-uri@3.1.2':
    resolution: {integrity: sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==}
    engines: {node: '>=6.0.0'}

  '@jridgewell/sourcemap-codec@1.5.4':
    resolution: {integrity: sha512-VT2+G1VQs/9oz078bLrYbecdZKs912zQlkelYpuf+SXF+QvZDYJlbx/LSx+meSAwdDFnF8FVXW92AVjjkVmgFw==}

  '@jridgewell/trace-mapping@0.3.29':
    resolution: {integrity: sha512-uw6guiW/gcAGPDhLmd77/6lW8QLeiV5RUTsAX46Db6oLhGaVj4lhnPwb184s1bkc8kdVg/+h988dro8GRDpmYQ==}

  '@napi-rs/wasm-runtime@0.2.11':
    resolution: {integrity: sha512-9DPkXtvHydrcOsopiYpUgPHpmj0HWZKMUnL2dZqpvC42lsratuBG06V5ipyno0fUek5VlFsNQ+AcFATSrJXgMA==}

  '@next/env@15.2.4':
    resolution: {integrity: sha512-+SFtMgoiYP3WoSswuNmxJOCwi06TdWE733D+WPjpXIe4LXGULwEaofiiAy6kbS0+XjM5xF5n3lKuBwN2SnqD9g==}

  '@next/eslint-plugin-next@15.3.4':
    resolution: {integrity: sha512-lBxYdj7TI8phbJcLSAqDt57nIcobEign5NYIKCiy0hXQhrUbTqLqOaSDi568U6vFg4hJfBdZYsG4iP/uKhCqgg==}

  '@next/swc-darwin-arm64@15.2.4':
    resolution: {integrity: sha512-1AnMfs655ipJEDC/FHkSr0r3lXBgpqKo4K1kiwfUf3iE68rDFXZ1TtHdMvf7D0hMItgDZ7Vuq3JgNMbt/+3bYw==}
    engines: {node: '>= 10'}
    cpu: [arm64]
    os: [darwin]

  '@next/swc-darwin-x64@15.2.4':
    resolution: {integrity: sha512-3qK2zb5EwCwxnO2HeO+TRqCubeI/NgCe+kL5dTJlPldV/uwCnUgC7VbEzgmxbfrkbjehL4H9BPztWOEtsoMwew==}
    engines: {node: '>= 10'}
    cpu: [x64]
    os: [darwin]

  '@next/swc-linux-arm64-gnu@15.2.4':
    resolution: {integrity: sha512-HFN6GKUcrTWvem8AZN7tT95zPb0GUGv9v0d0iyuTb303vbXkkbHDp/DxufB04jNVD+IN9yHy7y/6Mqq0h0YVaQ==}
    engines: {node: '>= 10'}
    cpu: [arm64]
    os: [linux]

  '@next/swc-linux-arm64-musl@15.2.4':
    resolution: {integrity: sha512-Oioa0SORWLwi35/kVB8aCk5Uq+5/ZIumMK1kJV+jSdazFm2NzPDztsefzdmzzpx5oGCJ6FkUC7vkaUseNTStNA==}
    engines: {node: '>= 10'}
    cpu: [arm64]
    os: [linux]

  '@next/swc-linux-x64-gnu@15.2.4':
    resolution: {integrity: sha512-yb5WTRaHdkgOqFOZiu6rHV1fAEK0flVpaIN2HB6kxHVSy/dIajWbThS7qON3W9/SNOH2JWkVCyulgGYekMePuw==}
    engines: {node: '>= 10'}
    cpu: [x64]
    os: [linux]

  '@next/swc-linux-x64-musl@15.2.4':
    resolution: {integrity: sha512-Dcdv/ix6srhkM25fgXiyOieFUkz+fOYkHlydWCtB0xMST6X9XYI3yPDKBZt1xuhOytONsIFJFB08xXYsxUwJLw==}
    engines: {node: '>= 10'}
    cpu: [x64]
    os: [linux]

  '@next/swc-win32-arm64-msvc@15.2.4':
    resolution: {integrity: sha512-dW0i7eukvDxtIhCYkMrZNQfNicPDExt2jPb9AZPpL7cfyUo7QSNl1DjsHjmmKp6qNAqUESyT8YFl/Aw91cNJJg==}
    engines: {node: '>= 10'}
    cpu: [arm64]
    os: [win32]

  '@next/swc-win32-x64-msvc@15.2.4':
    resolution: {integrity: sha512-SbnWkJmkS7Xl3kre8SdMF6F/XDh1DTFEhp0jRTj/uB8iPKoU2bb2NDfcu+iifv1+mxQEd1g2vvSxcZbXSKyWiQ==}
    engines: {node: '>= 10'}
    cpu: [x64]
    os: [win32]

  '@nodelib/fs.scandir@2.1.5':
    resolution: {integrity: sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==}
    engines: {node: '>= 8'}

  '@nodelib/fs.stat@2.0.5':
    resolution: {integrity: sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==}
    engines: {node: '>= 8'}

  '@nodelib/fs.walk@1.2.8':
    resolution: {integrity: sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==}
    engines: {node: '>= 8'}

  '@nolyfill/is-core-module@1.0.39':
    resolution: {integrity: sha512-nn5ozdjYQpUCZlWGuxcJY/KpxkWQs4DcbMCmKojjyrYDEAGy4Ce19NN4v5MduafTwJlbKc99UA8YhSVqq9yPZA==}
    engines: {node: '>=12.4.0'}

  '@pkgjs/parseargs@0.11.0':
    resolution: {integrity: sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==}
    engines: {node: '>=14'}

  '@playwright/test@1.53.2':
    resolution: {integrity: sha512-tEB2U5z74ebBeyfGNZ3Jfg29AnW+5HlWhvHtb/Mqco9pFdZU1ZLNdVb2UtB5CvmiilNr2ZfVH/qMmAROG/XTzw==}
    engines: {node: '>=18'}
    hasBin: true

  '@polka/url@1.0.0-next.29':
    resolution: {integrity: sha512-wwQAWhWSuHaag8c4q/KN/vCoeOJYshAIvMQwD4GpSb3OiZklFfvAgmj0VCBBImRpuF/aFgIRzllXlVX93Jevww==}

  '@radix-ui/number@1.1.0':
    resolution: {integrity: sha512-V3gRzhVNU1ldS5XhAPTom1fOIo4ccrjjJgmE+LI2h/WaFpHmx0MQApT+KZHnx8abG6Avtfcz4WoEciMnpFT3HQ==}

  '@radix-ui/primitive@1.1.1':
    resolution: {integrity: sha512-SJ31y+Q/zAyShtXJc8x83i9TYdbAfHZ++tUZnvjJJqFjzsdUnKsxPL6IEtBlxKkU7yzer//GQtZSV4GbldL3YA==}

  '@radix-ui/react-accordion@1.2.2':
    resolution: {integrity: sha512-b1oh54x4DMCdGsB4/7ahiSrViXxaBwRPotiZNnYXjLha9vfuURSAZErki6qjDoSIV0eXx5v57XnTGVtGwnfp2g==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-alert-dialog@1.1.4':
    resolution: {integrity: sha512-A6Kh23qZDLy3PSU4bh2UJZznOrUdHImIXqF8YtUa6CN73f8EOO9XlXSCd9IHyPvIquTaa/kwaSWzZTtUvgXVGw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-arrow@1.1.1':
    resolution: {integrity: sha512-NaVpZfmv8SKeZbn4ijN2V3jlHA9ngBG16VnIIm22nUR0Yk8KUALyBxT3KYEUnNuch9sTE8UTsS3whzBgKOL30w==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-aspect-ratio@1.1.1':
    resolution: {integrity: sha512-kNU4FIpcFMBLkOUcgeIteH06/8JLBcYY6Le1iKenDGCYNYFX3TQqCZjzkOsz37h7r94/99GTb7YhEr98ZBJibw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-avatar@1.1.2':
    resolution: {integrity: sha512-GaC7bXQZ5VgZvVvsJ5mu/AEbjYLnhhkoidOboC50Z6FFlLA03wG2ianUoH+zgDQ31/9gCF59bE4+2bBgTyMiig==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-checkbox@1.1.3':
    resolution: {integrity: sha512-HD7/ocp8f1B3e6OHygH0n7ZKjONkhciy1Nh0yuBgObqThc3oyx+vuMfFHKAknXRHHWVE9XvXStxJFyjUmB8PIw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-collapsible@1.1.2':
    resolution: {integrity: sha512-PliMB63vxz7vggcyq0IxNYk8vGDrLXVWw4+W4B8YnwI1s18x7YZYqlG9PLX7XxAJUi0g2DxP4XKJMFHh/iVh9A==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-collection@1.1.1':
    resolution: {integrity: sha512-LwT3pSho9Dljg+wY2KN2mrrh6y3qELfftINERIzBUO9e0N+t0oMTyn3k9iv+ZqgrwGkRnLpNJrsMv9BZlt2yuA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-compose-refs@1.1.1':
    resolution: {integrity: sha512-Y9VzoRDSJtgFMUCoiZBDVo084VQ5hfpXxVE+NgkdNsjiDBByiImMZKKhxMwCbdHvhlENG6a833CbFkOQvTricw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-compose-refs@1.1.2':
    resolution: {integrity: sha512-z4eqJvfiNnFMHIIvXP3CY57y2WJs5g2v3X0zm9mEJkrkNv4rDxu+sg9Jh8EkXyeqBkB7SOcboo9dMVqhyrACIg==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-context-menu@2.2.4':
    resolution: {integrity: sha512-ap4wdGwK52rJxGkwukU1NrnEodsUFQIooANKu+ey7d6raQ2biTcEf8za1zr0mgFHieevRTB2nK4dJeN8pTAZGQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-context@1.1.1':
    resolution: {integrity: sha512-UASk9zi+crv9WteK/NU4PLvOoL3OuE6BWVKNF6hPRBtYBDXQ2u5iu3O59zUlJiTVvkyuycnqrztsHVJwcK9K+Q==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-dialog@1.1.4':
    resolution: {integrity: sha512-Ur7EV1IwQGCyaAuyDRiOLA5JIUZxELJljF+MbM/2NC0BYwfuRrbpS30BiQBJrVruscgUkieKkqXYDOoByaxIoA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-direction@1.1.0':
    resolution: {integrity: sha512-BUuBvgThEiAXh2DWu93XsT+a3aWrGqolGlqqw5VU1kG7p/ZH2cuDlM1sRLNnY3QcBS69UIz2mcKhMxDsdewhjg==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-dismissable-layer@1.1.3':
    resolution: {integrity: sha512-onrWn/72lQoEucDmJnr8uczSNTujT0vJnA/X5+3AkChVPowr8n1yvIKIabhWyMQeMvvmdpsvcyDqx3X1LEXCPg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-dropdown-menu@2.1.4':
    resolution: {integrity: sha512-iXU1Ab5ecM+yEepGAWK8ZhMyKX4ubFdCNtol4sT9D0OVErG9PNElfx3TQhjw7n7BC5nFVz68/5//clWy+8TXzA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-focus-guards@1.1.1':
    resolution: {integrity: sha512-pSIwfrT1a6sIoDASCSpFwOasEwKTZWDw/iBdtnqKO7v6FeOzYJ7U53cPzYFVR3geGGXgVHaH+CdngrrAzqUGxg==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-focus-scope@1.1.1':
    resolution: {integrity: sha512-01omzJAYRxXdG2/he/+xy+c8a8gCydoQ1yOxnWNcRhrrBW5W+RQJ22EK1SaO8tb3WoUsuEw7mJjBozPzihDFjA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-hover-card@1.1.4':
    resolution: {integrity: sha512-QSUUnRA3PQ2UhvoCv3eYvMnCAgGQW+sTu86QPuNb+ZMi+ZENd6UWpiXbcWDQ4AEaKF9KKpCHBeaJz9Rw6lRlaQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-id@1.1.0':
    resolution: {integrity: sha512-EJUrI8yYh7WOjNOqpoJaf1jlFIH2LvtgAl+YcFqNCa+4hj64ZXmPkAKOFs/ukjz3byN6bdb/AVUqHkI8/uWWMA==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-id@1.1.1':
    resolution: {integrity: sha512-kGkGegYIdQsOb4XjsfM97rXsiHaBwco+hFI66oO4s9LU+PLAC5oJ7khdOVFxkhsmlbpUqDAvXw11CluXP+jkHg==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-label@2.1.1':
    resolution: {integrity: sha512-UUw5E4e/2+4kFMH7+YxORXGWggtY6sM8WIwh5RZchhLuUg2H1hc98Py+pr8HMz6rdaYrK2t296ZEjYLOCO5uUw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-menu@2.1.4':
    resolution: {integrity: sha512-BnOgVoL6YYdHAG6DtXONaR29Eq4nvbi8rutrV/xlr3RQCMMb3yqP85Qiw/3NReozrSW+4dfLkK+rc1hb4wPU/A==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-menubar@1.1.4':
    resolution: {integrity: sha512-+KMpi7VAZuB46+1LD7a30zb5IxyzLgC8m8j42gk3N4TUCcViNQdX8FhoH1HDvYiA8quuqcek4R4bYpPn/SY1GA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-navigation-menu@1.2.3':
    resolution: {integrity: sha512-IQWAsQ7dsLIYDrn0WqPU+cdM7MONTv9nqrLVYoie3BPiabSfUVDe6Fr+oEt0Cofsr9ONDcDe9xhmJbL1Uq1yKg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-popover@1.1.4':
    resolution: {integrity: sha512-aUACAkXx8LaFymDma+HQVji7WhvEhpFJ7+qPz17Nf4lLZqtreGOFRiNQWQmhzp7kEWg9cOyyQJpdIMUMPc/CPw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-popper@1.2.1':
    resolution: {integrity: sha512-3kn5Me69L+jv82EKRuQCXdYyf1DqHwD2U/sxoNgBGCB7K9TRc3bQamQ+5EPM9EvyPdli0W41sROd+ZU1dTCztw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-portal@1.1.3':
    resolution: {integrity: sha512-NciRqhXnGojhT93RPyDaMPfLH3ZSl4jjIFbZQ1b/vxvZEdHsBZ49wP9w8L3HzUQwep01LcWtkUvm0OVB5JAHTw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-presence@1.1.2':
    resolution: {integrity: sha512-18TFr80t5EVgL9x1SwF/YGtfG+l0BS0PRAlCWBDoBEiDQjeKgnNZRVJp/oVBl24sr3Gbfwc/Qpj4OcWTQMsAEg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-primitive@2.0.1':
    resolution: {integrity: sha512-sHCWTtxwNn3L3fH8qAfnF3WbUZycW93SM1j3NFDzXBiz8D6F5UTTy8G1+WFEaiCdvCVRJWj6N2R4Xq6HdiHmDg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-primitive@2.1.3':
    resolution: {integrity: sha512-m9gTwRkhy2lvCPe6QJp4d3G1TYEUHn/FzJUtq9MjH46an1wJU+GdoGC5VLof8RX8Ft/DlpshApkhswDLZzHIcQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-progress@1.1.1':
    resolution: {integrity: sha512-6diOawA84f/eMxFHcWut0aE1C2kyE9dOyCTQOMRR2C/qPiXz/X0SaiA/RLbapQaXUCmy0/hLMf9meSccD1N0pA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-radio-group@1.2.2':
    resolution: {integrity: sha512-E0MLLGfOP0l8P/NxgVzfXJ8w3Ch8cdO6UDzJfDChu4EJDy+/WdO5LqpdY8PYnCErkmZH3gZhDL1K7kQ41fAHuQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-roving-focus@1.1.1':
    resolution: {integrity: sha512-QE1RoxPGJ/Nm8Qmk0PxP8ojmoaS67i0s7hVssS7KuI2FQoc/uzVlZsqKfQvxPE6D8hICCPHJ4D88zNhT3OOmkw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-scroll-area@1.2.2':
    resolution: {integrity: sha512-EFI1N/S3YxZEW/lJ/H1jY3njlvTd8tBmgKEn4GHi51+aMm94i6NmAJstsm5cu3yJwYqYc93gpCPm21FeAbFk6g==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-select@2.1.4':
    resolution: {integrity: sha512-pOkb2u8KgO47j/h7AylCj7dJsm69BXcjkrvTqMptFqsE2i0p8lHkfgneXKjAgPzBMivnoMyt8o4KiV4wYzDdyQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-separator@1.1.1':
    resolution: {integrity: sha512-RRiNRSrD8iUiXriq/Y5n4/3iE8HzqgLHsusUSg5jVpU2+3tqcUFPJXHDymwEypunc2sWxDUS3UC+rkZRlHedsw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-slider@1.2.2':
    resolution: {integrity: sha512-sNlU06ii1/ZcbHf8I9En54ZPW0Vil/yPVg4vQMcFNjrIx51jsHbFl1HYHQvCIWJSr1q0ZmA+iIs/ZTv8h7HHSA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-slot@1.1.1':
    resolution: {integrity: sha512-RApLLOcINYJA+dMVbOju7MYv1Mb2EBp2nH4HdDzXTSyaR5optlm6Otrz1euW3HbdOR8UmmFK06TD+A9frYWv+g==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-slot@1.2.3':
    resolution: {integrity: sha512-aeNmHnBxbi2St0au6VBVC7JXFlhLlOnvIIlePNniyUNAClzmtAUEY8/pBiK3iHjufOlwA+c20/8jngo7xcrg8A==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-switch@1.1.2':
    resolution: {integrity: sha512-zGukiWHjEdBCRyXvKR6iXAQG6qXm2esuAD6kDOi9Cn+1X6ev3ASo4+CsYaD6Fov9r/AQFekqnD/7+V0Cs6/98g==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-tabs@1.1.2':
    resolution: {integrity: sha512-9u/tQJMcC2aGq7KXpGivMm1mgq7oRJKXphDwdypPd/j21j/2znamPU8WkXgnhUaTrSFNIt8XhOyCAupg8/GbwQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-toast@1.2.4':
    resolution: {integrity: sha512-Sch9idFJHJTMH9YNpxxESqABcAFweJG4tKv+0zo0m5XBvUSL8FM5xKcJLFLXononpePs8IclyX1KieL5SDUNgA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-toggle-group@1.1.1':
    resolution: {integrity: sha512-OgDLZEA30Ylyz8YSXvnGqIHtERqnUt1KUYTKdw/y8u7Ci6zGiJfXc02jahmcSNK3YcErqioj/9flWC9S1ihfwg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-toggle@1.1.1':
    resolution: {integrity: sha512-i77tcgObYr743IonC1hrsnnPmszDRn8p+EGUsUt+5a/JFn28fxaM88Py6V2mc8J5kELMWishI0rLnuGLFD/nnQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-tooltip@1.1.6':
    resolution: {integrity: sha512-TLB5D8QLExS1uDn7+wH/bjEmRurNMTzNrtq7IjaS4kjion9NtzsTGkvR5+i7yc9q01Pi2KMM2cN3f8UG4IvvXA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-use-callback-ref@1.1.0':
    resolution: {integrity: sha512-CasTfvsy+frcFkbXtSJ2Zu9JHpN8TYKxkgJGWbjiZhFivxaeW7rMeZt7QELGVLaYVfFMsKHjb7Ak0nMEe+2Vfw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-controllable-state@1.1.0':
    resolution: {integrity: sha512-MtfMVJiSr2NjzS0Aa90NPTnvTSg6C/JLCV7ma0W6+OMV78vd8OyRpID+Ng9LxzsPbLeuBnWBA1Nq30AtBIDChw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-escape-keydown@1.1.0':
    resolution: {integrity: sha512-L7vwWlR1kTTQ3oh7g1O0CBF3YCyyTj8NmhLR+phShpyA50HCfBFKVJTpshm9PzLiKmehsrQzTYTpX9HvmC9rhw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-layout-effect@1.1.0':
    resolution: {integrity: sha512-+FPE0rOdziWSrH9athwI1R0HDVbWlEhd+FR+aSDk4uWGmSJ9Z54sdZVDQPZAinJhJXwfT+qnj969mCsT2gfm5w==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-layout-effect@1.1.1':
    resolution: {integrity: sha512-RbJRS4UWQFkzHTTwVymMTUv8EqYhOp8dOOviLj2ugtTiXRaRQS7GLGxZTLL1jWhMeoSCf5zmcZkqTl9IiYfXcQ==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-previous@1.1.0':
    resolution: {integrity: sha512-Z/e78qg2YFnnXcW88A4JmTtm4ADckLno6F7OXotmkQfeuCVaKuYzqAATPhVzl3delXE7CxIV8shofPn3jPc5Og==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-rect@1.1.0':
    resolution: {integrity: sha512-0Fmkebhr6PiseyZlYAOtLS+nb7jLmpqTrJyv61Pe68MKYW6OWdRE2kI70TaYY27u7H0lajqM3hSMMLFq18Z7nQ==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-size@1.1.0':
    resolution: {integrity: sha512-XW3/vWuIXHa+2Uwcc2ABSfcCledmXhhQPlGbfcRXbiUQI5Icjcg19BGCZVKKInYbvUCut/ufbbLLPFC5cbb1hw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-visually-hidden@1.1.1':
    resolution: {integrity: sha512-vVfA2IZ9q/J+gEamvj761Oq1FpWgCDaNOOIfbPVp2MVPLEomUr5+Vf7kJGwQ24YxZSlQVar7Bes8kyTo5Dshpg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/rect@1.1.0':
    resolution: {integrity: sha512-A9+lCBZoaMJlVKcRBz2YByCG+Cp2t6nAnMnNba+XiWxnj6r4JUFqfsgwocMBZU9LPtdxC6wB56ySYpc7LQIoJg==}

  '@rolldown/pluginutils@1.0.0-beta.19':
    resolution: {integrity: sha512-3FL3mnMbPu0muGOCaKAhhFEYmqv9eTfPSJRJmANrCwtgK8VuxpsZDGK+m0LYAGoyO8+0j5uRe4PeyPDK1yA/hA==}

  '@rollup/rollup-android-arm-eabi@4.44.1':
    resolution: {integrity: sha512-JAcBr1+fgqx20m7Fwe1DxPUl/hPkee6jA6Pl7n1v2EFiktAHenTaXl5aIFjUIEsfn9w3HE4gK1lEgNGMzBDs1w==}
    cpu: [arm]
    os: [android]

  '@rollup/rollup-android-arm64@4.44.1':
    resolution: {integrity: sha512-RurZetXqTu4p+G0ChbnkwBuAtwAbIwJkycw1n6GvlGlBuS4u5qlr5opix8cBAYFJgaY05TWtM+LaoFggUmbZEQ==}
    cpu: [arm64]
    os: [android]

  '@rollup/rollup-darwin-arm64@4.44.1':
    resolution: {integrity: sha512-fM/xPesi7g2M7chk37LOnmnSTHLG/v2ggWqKj3CCA1rMA4mm5KVBT1fNoswbo1JhPuNNZrVwpTvlCVggv8A2zg==}
    cpu: [arm64]
    os: [darwin]

  '@rollup/rollup-darwin-x64@4.44.1':
    resolution: {integrity: sha512-gDnWk57urJrkrHQ2WVx9TSVTH7lSlU7E3AFqiko+bgjlh78aJ88/3nycMax52VIVjIm3ObXnDL2H00e/xzoipw==}
    cpu: [x64]
    os: [darwin]

  '@rollup/rollup-freebsd-arm64@4.44.1':
    resolution: {integrity: sha512-wnFQmJ/zPThM5zEGcnDcCJeYJgtSLjh1d//WuHzhf6zT3Md1BvvhJnWoy+HECKu2bMxaIcfWiu3bJgx6z4g2XA==}
    cpu: [arm64]
    os: [freebsd]

  '@rollup/rollup-freebsd-x64@4.44.1':
    resolution: {integrity: sha512-uBmIxoJ4493YATvU2c0upGz87f99e3wop7TJgOA/bXMFd2SvKCI7xkxY/5k50bv7J6dw1SXT4MQBQSLn8Bb/Uw==}
    cpu: [x64]
    os: [freebsd]

  '@rollup/rollup-linux-arm-gnueabihf@4.44.1':
    resolution: {integrity: sha512-n0edDmSHlXFhrlmTK7XBuwKlG5MbS7yleS1cQ9nn4kIeW+dJH+ExqNgQ0RrFRew8Y+0V/x6C5IjsHrJmiHtkxQ==}
    cpu: [arm]
    os: [linux]

  '@rollup/rollup-linux-arm-musleabihf@4.44.1':
    resolution: {integrity: sha512-8WVUPy3FtAsKSpyk21kV52HCxB+me6YkbkFHATzC2Yd3yuqHwy2lbFL4alJOLXKljoRw08Zk8/xEj89cLQ/4Nw==}
    cpu: [arm]
    os: [linux]

  '@rollup/rollup-linux-arm64-gnu@4.44.1':
    resolution: {integrity: sha512-yuktAOaeOgorWDeFJggjuCkMGeITfqvPgkIXhDqsfKX8J3jGyxdDZgBV/2kj/2DyPaLiX6bPdjJDTu9RB8lUPQ==}
    cpu: [arm64]
    os: [linux]

  '@rollup/rollup-linux-arm64-musl@4.44.1':
    resolution: {integrity: sha512-W+GBM4ifET1Plw8pdVaecwUgxmiH23CfAUj32u8knq0JPFyK4weRy6H7ooxYFD19YxBulL0Ktsflg5XS7+7u9g==}
    cpu: [arm64]
    os: [linux]

  '@rollup/rollup-linux-loongarch64-gnu@4.44.1':
    resolution: {integrity: sha512-1zqnUEMWp9WrGVuVak6jWTl4fEtrVKfZY7CvcBmUUpxAJ7WcSowPSAWIKa/0o5mBL/Ij50SIf9tuirGx63Ovew==}
    cpu: [loong64]
    os: [linux]

  '@rollup/rollup-linux-powerpc64le-gnu@4.44.1':
    resolution: {integrity: sha512-Rl3JKaRu0LHIx7ExBAAnf0JcOQetQffaw34T8vLlg9b1IhzcBgaIdnvEbbsZq9uZp3uAH+JkHd20Nwn0h9zPjA==}
    cpu: [ppc64]
    os: [linux]

  '@rollup/rollup-linux-riscv64-gnu@4.44.1':
    resolution: {integrity: sha512-j5akelU3snyL6K3N/iX7otLBIl347fGwmd95U5gS/7z6T4ftK288jKq3A5lcFKcx7wwzb5rgNvAg3ZbV4BqUSw==}
    cpu: [riscv64]
    os: [linux]

  '@rollup/rollup-linux-riscv64-musl@4.44.1':
    resolution: {integrity: sha512-ppn5llVGgrZw7yxbIm8TTvtj1EoPgYUAbfw0uDjIOzzoqlZlZrLJ/KuiE7uf5EpTpCTrNt1EdtzF0naMm0wGYg==}
    cpu: [riscv64]
    os: [linux]

  '@rollup/rollup-linux-s390x-gnu@4.44.1':
    resolution: {integrity: sha512-Hu6hEdix0oxtUma99jSP7xbvjkUM/ycke/AQQ4EC5g7jNRLLIwjcNwaUy95ZKBJJwg1ZowsclNnjYqzN4zwkAw==}
    cpu: [s390x]
    os: [linux]

  '@rollup/rollup-linux-x64-gnu@4.44.1':
    resolution: {integrity: sha512-EtnsrmZGomz9WxK1bR5079zee3+7a+AdFlghyd6VbAjgRJDbTANJ9dcPIPAi76uG05micpEL+gPGmAKYTschQw==}
    cpu: [x64]
    os: [linux]

  '@rollup/rollup-linux-x64-musl@4.44.1':
    resolution: {integrity: sha512-iAS4p+J1az6Usn0f8xhgL4PaU878KEtutP4hqw52I4IO6AGoyOkHCxcc4bqufv1tQLdDWFx8lR9YlwxKuv3/3g==}
    cpu: [x64]
    os: [linux]

  '@rollup/rollup-win32-arm64-msvc@4.44.1':
    resolution: {integrity: sha512-NtSJVKcXwcqozOl+FwI41OH3OApDyLk3kqTJgx8+gp6On9ZEt5mYhIsKNPGuaZr3p9T6NWPKGU/03Vw4CNU9qg==}
    cpu: [arm64]
    os: [win32]

  '@rollup/rollup-win32-ia32-msvc@4.44.1':
    resolution: {integrity: sha512-JYA3qvCOLXSsnTR3oiyGws1Dm0YTuxAAeaYGVlGpUsHqloPcFjPg+X0Fj2qODGLNwQOAcCiQmHub/V007kiH5A==}
    cpu: [ia32]
    os: [win32]

  '@rollup/rollup-win32-x64-msvc@4.44.1':
    resolution: {integrity: sha512-J8o22LuF0kTe7m+8PvW9wk3/bRq5+mRo5Dqo6+vXb7otCm3TPhYOJqOaQtGU9YMWQSL3krMnoOxMr0+9E6F3Ug==}
    cpu: [x64]
    os: [win32]

  '@rtsao/scc@1.1.0':
    resolution: {integrity: sha512-zt6OdqaDoOnJ1ZYsCYGt9YmWzDXl4vQdKTyJev62gFhRGKdx7mcT54V9KIjg+d2wi9EXsPvAPKe7i7WjfVWB8g==}

  '@rushstack/eslint-patch@1.12.0':
    resolution: {integrity: sha512-5EwMtOqvJMMa3HbmxLlF74e+3/HhwBTMcvt3nqVJgGCozO6hzIPOBlwm8mGVNR9SN2IJpxSnlxczyDjcn7qIyw==}

  '@swc/counter@0.1.3':
    resolution: {integrity: sha512-e2BR4lsJkkRlKZ/qCHPw9ZaSxc0MVUd7gtbtaB7aMvHeJVYe8sOB8DBZkP2DtISHGSku9sCK6T6cnY0CtXrOCQ==}

  '@swc/helpers@0.5.15':
    resolution: {integrity: sha512-JQ5TuMi45Owi4/BIMAJBoSQoOJu12oOk/gADqlcUL9JEdHB8vyjUSsxqeNXnmXHjYKMi2WcYtezGEEhqUI/E2g==}

  '@testing-library/dom@10.4.0':
    resolution: {integrity: sha512-pemlzrSESWbdAloYml3bAJMEfNh1Z7EduzqPKprCH5S341frlpYnUEW0H72dLxa6IsYr+mPno20GiSm+h9dEdQ==}
    engines: {node: '>=18'}

  '@testing-library/jest-dom@6.6.3':
    resolution: {integrity: sha512-IteBhl4XqYNkM54f4ejhLRJiZNqcSCoXUOG2CPK7qbD322KjQozM4kHQOfkG2oln9b9HTYqs+Sae8vBATubxxA==}
    engines: {node: '>=14', npm: '>=6', yarn: '>=1'}

  '@testing-library/react@16.3.0':
    resolution: {integrity: sha512-kFSyxiEDwv1WLl2fgsq6pPBbw5aWKrsY2/noi1Id0TK0UParSF62oFQFGHXIyaG4pp2tEub/Zlel+fjjZILDsw==}
    engines: {node: '>=18'}
    peerDependencies:
      '@testing-library/dom': ^10.0.0
      '@types/react': ^18.0.0 || ^19.0.0
      '@types/react-dom': ^18.0.0 || ^19.0.0
      react: ^18.0.0 || ^19.0.0
      react-dom: ^18.0.0 || ^19.0.0
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@testing-library/user-event@14.6.1':
    resolution: {integrity: sha512-vq7fv0rnt+QTXgPxr5Hjc210p6YKq2kmdziLgnsZGgLJ9e6VAShx1pACLuRjd/AS/sr7phAR58OIIpf0LlmQNw==}
    engines: {node: '>=12', npm: '>=6'}
    peerDependencies:
      '@testing-library/dom': '>=7.21.4'

  '@tybys/wasm-util@0.9.0':
    resolution: {integrity: sha512-6+7nlbMVX/PVDCwaIQ8nTOPveOcFLSt8GcXdx8hD0bt39uWxYT88uXzqTd4fTvqta7oeUJqudepapKNt2DYJFw==}

  '@types/aria-query@5.0.4':
    resolution: {integrity: sha512-rfT93uj5s0PRL7EzccGMs3brplhcrghnDoV26NqKhCAS1hVo+WdNsPvE/yb6ilfr5hi2MEk6d5EWJTKdxg8jVw==}

  '@types/babel__core@7.20.5':
    resolution: {integrity: sha512-qoQprZvz5wQFJwMDqeseRXWv3rqMvhgpbXFfVyWhbx9X47POIA6i/+dXefEmZKoAgOaTdaIgNSMqMIU61yRyzA==}

  '@types/babel__generator@7.27.0':
    resolution: {integrity: sha512-ufFd2Xi92OAVPYsy+P4n7/U7e68fex0+Ee8gSG9KX7eo084CWiQ4sdxktvdl0bOPupXtVJPY19zk6EwWqUQ8lg==}

  '@types/babel__template@7.4.4':
    resolution: {integrity: sha512-h/NUaSyG5EyxBIp8YRxo4RMe2/qQgvyowRwVMzhYhBCONbW8PUsg4lkFMrhgZhUe5z3L3MiLDuvyJ/CaPa2A8A==}

  '@types/babel__traverse@7.20.7':
    resolution: {integrity: sha512-dkO5fhS7+/oos4ciWxyEyjWe48zmG6wbCheo/G2ZnHx4fs3EU6YC6UM8rk56gAjNJ9P3MTH2jo5jb92/K6wbng==}

  '@types/chai@5.2.2':
    resolution: {integrity: sha512-8kB30R7Hwqf40JPiKhVzodJs2Qc1ZJ5zuT3uzw5Hq/dhNCl3G3l83jfpdI1e20BP348+fV7VIL/+FxaXkqBmWg==}

  '@types/codemirror@5.60.16':
    resolution: {integrity: sha512-V/yHdamffSS075jit+fDxaOAmdP2liok8NSNJnAZfDJErzOheuygHZEhAJrfmk5TEyM32MhkZjwo/idX791yxw==}

  '@types/d3-array@3.2.1':
    resolution: {integrity: sha512-Y2Jn2idRrLzUfAKV2LyRImR+y4oa2AntrgID95SHJxuMUrkNXmanDSed71sRNZysveJVt1hLLemQZIady0FpEg==}

  '@types/d3-color@3.1.3':
    resolution: {integrity: sha512-iO90scth9WAbmgv7ogoq57O9YpKmFBbmoEoCHDB2xMBY0+/KVrqAaCDyCE16dUspeOvIxFFRI+0sEtqDqy2b4A==}

  '@types/d3-ease@3.0.2':
    resolution: {integrity: sha512-NcV1JjO5oDzoK26oMzbILE6HW7uVXOHLQvHshBUW4UMdZGfiY6v5BeQwh9a9tCzv+CeefZQHJt5SRgK154RtiA==}

  '@types/d3-interpolate@3.0.4':
    resolution: {integrity: sha512-mgLPETlrpVV1YRJIglr4Ez47g7Yxjl1lj7YKsiMCb27VJH9W8NVM6Bb9d8kkpG/uAQS5AmbA48q2IAolKKo1MA==}

  '@types/d3-path@3.1.1':
    resolution: {integrity: sha512-VMZBYyQvbGmWyWVea0EHs/BwLgxc+MKi1zLDCONksozI4YJMcTt8ZEuIR4Sb1MMTE8MMW49v0IwI5+b7RmfWlg==}

  '@types/d3-scale@4.0.9':
    resolution: {integrity: sha512-dLmtwB8zkAeO/juAMfnV+sItKjlsw2lKdZVVy6LRr0cBmegxSABiLEpGVmSJJ8O08i4+sGR6qQtb6WtuwJdvVw==}

  '@types/d3-shape@3.1.7':
    resolution: {integrity: sha512-VLvUQ33C+3J+8p+Daf+nYSOsjB4GXp19/S/aGo60m9h1v6XaxjiT82lKVWJCfzhtuZ3yD7i/TPeC/fuKLLOSmg==}

  '@types/d3-time@3.0.4':
    resolution: {integrity: sha512-yuzZug1nkAAaBlBBikKZTgzCeA+k1uy4ZFwWANOfKw5z5LRhV0gNA7gNkKm7HoK+HRN0wX3EkxGk0fpbWhmB7g==}

  '@types/d3-timer@3.0.2':
    resolution: {integrity: sha512-Ps3T8E8dZDam6fUyNiMkekK3XUsaUEik+idO9/YjPtfj2qruF8tFBXS7XhtE4iIXBLxhmLjP3SXpLhVf21I9Lw==}

  '@types/deep-eql@4.0.2':
    resolution: {integrity: sha512-c9h9dVVMigMPc4bwTvC5dxqtqJZwQPePsWjPlpSOnojbor6pGqdk541lfA7AqFQr5pB1BRdq0juY9db81BwyFw==}

  '@types/estree@1.0.8':
    resolution: {integrity: sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==}

  '@types/json-schema@7.0.15':
    resolution: {integrity: sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==}

  '@types/json5@0.0.29':
    resolution: {integrity: sha512-dRLjCWHYg4oaA77cxO64oO+7JwCwnIzkZPdrrC71jQmQtlhM556pwKo5bUzqvZndkVbeFLIIi+9TC40JNF5hNQ==}

  '@types/marked@4.3.2':
    resolution: {integrity: sha512-a79Yc3TOk6dGdituy8hmTTJXjOkZ7zsFYV10L337ttq/rec8lRMDBpV7fL3uLx6TgbFCa5DU/h8FmIBQPSbU0w==}

  '@types/node@22.16.0':
    resolution: {integrity: sha512-B2egV9wALML1JCpv3VQoQ+yesQKAmNMBIAY7OteVrikcOcAkWm+dGL6qpeCktPjAv6N1JLnhbNiqS35UpFyBsQ==}

  '@types/react-dom@19.1.6':
    resolution: {integrity: sha512-4hOiT/dwO8Ko0gV1m/TJZYk3y0KBnY9vzDh7W+DH17b2HFSOGgdj33dhihPeuy3l0q23+4e+hoXHV6hCC4dCXw==}
    peerDependencies:
      '@types/react': ^19.0.0

  '@types/react@19.1.8':
    resolution: {integrity: sha512-AwAfQ2Wa5bCx9WP8nZL2uMZWod7J7/JSplxbTmBQ5ms6QpqNYm672H0Vu9ZVKVngQ+ii4R/byguVEUZQyeg44g==}

  '@types/tern@0.23.9':
    resolution: {integrity: sha512-ypzHFE/wBzh+BlH6rrBgS5I/Z7RD21pGhZ2rltb/+ZrVM1awdZwjx7hE5XfuYgHWk9uvV5HLZN3SloevCAp3Bw==}

  '@typescript-eslint/eslint-plugin@8.35.1':
    resolution: {integrity: sha512-9XNTlo7P7RJxbVeICaIIIEipqxLKguyh+3UbXuT2XQuFp6d8VOeDEGuz5IiX0dgZo8CiI6aOFLg4e8cF71SFVg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      '@typescript-eslint/parser': ^8.35.1
      eslint: ^8.57.0 || ^9.0.0
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/parser@8.35.1':
    resolution: {integrity: sha512-3MyiDfrfLeK06bi/g9DqJxP5pV74LNv4rFTyvGDmT3x2p1yp1lOd+qYZfiRPIOf/oON+WRZR5wxxuF85qOar+w==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      eslint: ^8.57.0 || ^9.0.0
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/project-service@8.35.1':
    resolution: {integrity: sha512-VYxn/5LOpVxADAuP3NrnxxHYfzVtQzLKeldIhDhzC8UHaiQvYlXvKuVho1qLduFbJjjy5U5bkGwa3rUGUb1Q6Q==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/scope-manager@8.35.1':
    resolution: {integrity: sha512-s/Bpd4i7ht2934nG+UoSPlYXd08KYz3bmjLEb7Ye1UVob0d1ENiT3lY8bsCmik4RqfSbPw9xJJHbugpPpP5JUg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@typescript-eslint/tsconfig-utils@8.35.1':
    resolution: {integrity: sha512-K5/U9VmT9dTHoNowWZpz+/TObS3xqC5h0xAIjXPw+MNcKV9qg6eSatEnmeAwkjHijhACH0/N7bkhKvbt1+DXWQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/type-utils@8.35.1':
    resolution: {integrity: sha512-HOrUBlfVRz5W2LIKpXzZoy6VTZzMu2n8q9C2V/cFngIC5U1nStJgv0tMV4sZPzdf4wQm9/ToWUFPMN9Vq9VJQQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      eslint: ^8.57.0 || ^9.0.0
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/types@8.35.1':
    resolution: {integrity: sha512-q/O04vVnKHfrrhNAscndAn1tuQhIkwqnaW+eu5waD5IPts2eX1dgJxgqcPx5BX109/qAz7IG6VrEPTOYKCNfRQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@typescript-eslint/typescript-estree@8.35.1':
    resolution: {integrity: sha512-Vvpuvj4tBxIka7cPs6Y1uvM7gJgdF5Uu9F+mBJBPY4MhvjrjWGK4H0lVgLJd/8PWZ23FTqsaJaLEkBCFUk8Y9g==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/utils@8.35.1':
    resolution: {integrity: sha512-lhnwatFmOFcazAsUm3ZnZFpXSxiwoa1Lj50HphnDe1Et01NF4+hrdXONSUHIcbVu2eFb1bAf+5yjXkGVkXBKAQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      eslint: ^8.57.0 || ^9.0.0
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/visitor-keys@8.35.1':
    resolution: {integrity: sha512-VRwixir4zBWCSTP/ljEo091lbpypz57PoeAQ9imjG+vbeof9LplljsL1mos4ccG6H9IjfrVGM359RozUnuFhpw==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@unrs/resolver-binding-android-arm-eabi@1.10.1':
    resolution: {integrity: sha512-zohDKXT1Ok0yhbVGff4YAg9HUs5ietG5GpvJBPFSApZnGe7uf2cd26DRhKZbn0Be6xHUZrSzP+RAgMmzyc71EA==}
    cpu: [arm]
    os: [android]

  '@unrs/resolver-binding-android-arm64@1.10.1':
    resolution: {integrity: sha512-tAN6k5UrTd4nicpA7s2PbjR/jagpDzAmvXFjbpTazUe5FRsFxVcBlS1F5Lzp5jtWU6bdiqRhSvd4X8rdpCffeA==}
    cpu: [arm64]
    os: [android]

  '@unrs/resolver-binding-darwin-arm64@1.10.1':
    resolution: {integrity: sha512-+FCsag8WkauI4dQ50XumCXdfvDCZEpMUnvZDsKMxfOisnEklpDFXc6ThY0WqybBYZbiwR5tWcFaZmI0G6b4vrg==}
    cpu: [arm64]
    os: [darwin]

  '@unrs/resolver-binding-darwin-x64@1.10.1':
    resolution: {integrity: sha512-qYKGGm5wk71ONcXTMZ0+J11qQeOAPz3nw6VtqrBUUELRyXFyvK8cHhHsLBFR4GHnilc2pgY1HTB2TvdW9wO26Q==}
    cpu: [x64]
    os: [darwin]

  '@unrs/resolver-binding-freebsd-x64@1.10.1':
    resolution: {integrity: sha512-hOHMAhbvIQ63gkpgeNsXcWPSyvXH7ZEyeg254hY0Lp/hX8NdW+FsUWq73g9946Pc/BrcVI/I3C1cmZ4RCX9bNw==}
    cpu: [x64]
    os: [freebsd]

  '@unrs/resolver-binding-linux-arm-gnueabihf@1.10.1':
    resolution: {integrity: sha512-6ds7+zzHJgTDmpe0gmFcOTvSUhG5oZukkt+cCsSb3k4Uiz2yEQB4iCRITX2hBwSW+p8gAieAfecITjgqCkswXw==}
    cpu: [arm]
    os: [linux]

  '@unrs/resolver-binding-linux-arm-musleabihf@1.10.1':
    resolution: {integrity: sha512-P7A0G2/jW00diNJyFeq4W9/nxovD62Ay8CMP4UK9OymC7qO7rG1a8Upad68/bdfpIOn7KSp7Aj/6lEW3yyznAA==}
    cpu: [arm]
    os: [linux]

  '@unrs/resolver-binding-linux-arm64-gnu@1.10.1':
    resolution: {integrity: sha512-Cg6xzdkrpltcTPO4At+A79zkC7gPDQIgosJmVV8M104ImB6KZi1MrNXgDYIAfkhUYjPzjNooEDFRAwwPadS7ZA==}
    cpu: [arm64]
    os: [linux]

  '@unrs/resolver-binding-linux-arm64-musl@1.10.1':
    resolution: {integrity: sha512-aNeg99bVkXa4lt+oZbjNRPC8ZpjJTKxijg/wILrJdzNyAymO2UC/HUK1UfDjt6T7U5p/mK24T3CYOi3/+YEQSA==}
    cpu: [arm64]
    os: [linux]

  '@unrs/resolver-binding-linux-ppc64-gnu@1.10.1':
    resolution: {integrity: sha512-ylz5ojeXrkPrtnzVhpCO+YegG63/aKhkoTlY8PfMfBfLaUG8v6m6iqrL7sBUKdVBgOB4kSTUPt9efQdA/Y3Z/w==}
    cpu: [ppc64]
    os: [linux]

  '@unrs/resolver-binding-linux-riscv64-gnu@1.10.1':
    resolution: {integrity: sha512-xcWyhmJfXXOxK7lvE4+rLwBq+on83svlc0AIypfe6x4sMJR+S4oD7n9OynaQShfj2SufPw2KJAotnsNb+4nN2g==}
    cpu: [riscv64]
    os: [linux]

  '@unrs/resolver-binding-linux-riscv64-musl@1.10.1':
    resolution: {integrity: sha512-mW9JZAdOCyorgi1eLJr4gX7xS67WNG9XNPYj5P8VuttK72XNsmdw9yhOO4tDANMgiLXFiSFaiL1gEpoNtRPw/A==}
    cpu: [riscv64]
    os: [linux]

  '@unrs/resolver-binding-linux-s390x-gnu@1.10.1':
    resolution: {integrity: sha512-NZGKhBy6xkJ0k09cWNZz4DnhBcGlhDd3W+j7EYoNvf5TSwj2K6kbmfqTWITEgkvjsMUjm1wsrc4IJaH6VtjyHQ==}
    cpu: [s390x]
    os: [linux]

  '@unrs/resolver-binding-linux-x64-gnu@1.10.1':
    resolution: {integrity: sha512-VsjgckJ0gNMw7p0d8In6uPYr+s0p16yrT2rvG4v2jUpEMYkpnfnCiALa9SWshbvlGjKQ98Q2x19agm3iFk8w8Q==}
    cpu: [x64]
    os: [linux]

  '@unrs/resolver-binding-linux-x64-musl@1.10.1':
    resolution: {integrity: sha512-idMnajMeejnaFi0Mx9UTLSYFDAOTfAEP7VjXNgxKApso3Eu2Njs0p2V95nNIyFi4oQVGFmIuCkoznAXtF/Zbmw==}
    cpu: [x64]
    os: [linux]

  '@unrs/resolver-binding-wasm32-wasi@1.10.1':
    resolution: {integrity: sha512-7jyhjIRNFjzlr8x5pth6Oi9hv3a7ubcVYm2GBFinkBQKcFhw4nIs5BtauSNtDW1dPIGrxF0ciynCZqzxMrYMsg==}
    engines: {node: '>=14.0.0'}
    cpu: [wasm32]

  '@unrs/resolver-binding-win32-arm64-msvc@1.10.1':
    resolution: {integrity: sha512-TY79+N+Gkoo7E99K+zmsKNeiuNJYlclZJtKqsHSls8We2iGhgxtletVsiBYie93MSTDRDMI8pkBZJlIJSZPrdA==}
    cpu: [arm64]
    os: [win32]

  '@unrs/resolver-binding-win32-ia32-msvc@1.10.1':
    resolution: {integrity: sha512-BAJN5PEPlEV+1m8+PCtFoKm3LQ1P57B4Z+0+efU0NzmCaGk7pUaOxuPgl+m3eufVeeNBKiPDltG0sSB9qEfCxw==}
    cpu: [ia32]
    os: [win32]

  '@unrs/resolver-binding-win32-x64-msvc@1.10.1':
    resolution: {integrity: sha512-2v3erKKmmCyIVvvhI2nF15qEbdBpISTq44m9pyd5gfIJB1PN94oePTLWEd82XUbIbvKhv76xTSeUQSCOGesLeg==}
    cpu: [x64]
    os: [win32]

  '@vitejs/plugin-react@4.6.0':
    resolution: {integrity: sha512-5Kgff+m8e2PB+9j51eGHEpn5kUzRKH2Ry0qGoe8ItJg7pqnkPrYPkDQZGgGmTa0EGarHrkjLvOdU3b1fzI8otQ==}
    engines: {node: ^14.18.0 || >=16.0.0}
    peerDependencies:
      vite: ^4.2.0 || ^5.0.0 || ^6.0.0 || ^7.0.0-beta.0

  '@vitest/expect@3.2.4':
    resolution: {integrity: sha512-Io0yyORnB6sikFlt8QW5K7slY4OjqNX9jmJQ02QDda8lyM6B5oNgVWoSoKPac8/kgnCUzuHQKrSLtu/uOqqrig==}

  '@vitest/mocker@3.2.4':
    resolution: {integrity: sha512-46ryTE9RZO/rfDd7pEqFl7etuyzekzEhUbTW3BvmeO/BcCMEgq59BKhek3dXDWgAj4oMK6OZi+vRr1wPW6qjEQ==}
    peerDependencies:
      msw: ^2.4.9
      vite: ^5.0.0 || ^6.0.0 || ^7.0.0-0
    peerDependenciesMeta:
      msw:
        optional: true
      vite:
        optional: true

  '@vitest/pretty-format@3.2.4':
    resolution: {integrity: sha512-IVNZik8IVRJRTr9fxlitMKeJeXFFFN0JaB9PHPGQ8NKQbGpfjlTx9zO4RefN8gp7eqjNy8nyK3NZmBzOPeIxtA==}

  '@vitest/runner@3.2.4':
    resolution: {integrity: sha512-oukfKT9Mk41LreEW09vt45f8wx7DordoWUZMYdY/cyAk7w5TWkTRCNZYF7sX7n2wB7jyGAl74OxgwhPgKaqDMQ==}

  '@vitest/snapshot@3.2.4':
    resolution: {integrity: sha512-dEYtS7qQP2CjU27QBC5oUOxLE/v5eLkGqPE0ZKEIDGMs4vKWe7IjgLOeauHsR0D5YuuycGRO5oSRXnwnmA78fQ==}

  '@vitest/spy@3.2.4':
    resolution: {integrity: sha512-vAfasCOe6AIK70iP5UD11Ac4siNUNJ9i/9PZ3NKx07sG6sUxeag1LWdNrMWeKKYBLlzuK+Gn65Yd5nyL6ds+nw==}

  '@vitest/ui@3.2.4':
    resolution: {integrity: sha512-hGISOaP18plkzbWEcP/QvtRW1xDXF2+96HbEX6byqQhAUbiS5oH6/9JwW+QsQCIYON2bI6QZBF+2PvOmrRZ9wA==}
    peerDependencies:
      vitest: 3.2.4

  '@vitest/utils@3.2.4':
    resolution: {integrity: sha512-fB2V0JFrQSMsCo9HiSq3Ezpdv4iYaXRG1Sx8edX3MwxfyNn83mKiGzOcH+Fkxt4MHxr3y42fQi1oeAInqgX2QA==}

  acorn-jsx@5.3.2:
    resolution: {integrity: sha512-rq9s+JNhf0IChjtDXxllJ7g41oZk5SlXtp0LHwyA5cejwn7vKmKp4pPri6YEePv2PU65sAsegbXtIinmDFDXgQ==}
    peerDependencies:
      acorn: ^6.0.0 || ^7.0.0 || ^8.0.0

  acorn@8.15.0:
    resolution: {integrity: sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==}
    engines: {node: '>=0.4.0'}
    hasBin: true

  agent-base@7.1.3:
    resolution: {integrity: sha512-jRR5wdylq8CkOe6hei19GGZnxM6rBGwFl3Bg0YItGDimvjGtAvdZk4Pu6Cl4u4Igsws4a1fd1Vq3ezrhn4KmFw==}
    engines: {node: '>= 14'}

  ajv@6.12.6:
    resolution: {integrity: sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==}

  ansi-regex@5.0.1:
    resolution: {integrity: sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==}
    engines: {node: '>=8'}

  ansi-regex@6.1.0:
    resolution: {integrity: sha512-7HSX4QQb4CspciLpVFwyRe79O3xsIZDDLER21kERQ71oaPodF8jL725AgJMFAYbooIqolJoRLuM81SpeUkpkvA==}
    engines: {node: '>=12'}

  ansi-styles@4.3.0:
    resolution: {integrity: sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==}
    engines: {node: '>=8'}

  ansi-styles@5.2.0:
    resolution: {integrity: sha512-Cxwpt2SfTzTtXcfOlzGEee8O+c+MmUgGrNiBcXnuWxuFJHe6a5Hz7qwhwe5OgaSYI0IJvkLqWX1ASG+cJOkEiA==}
    engines: {node: '>=10'}

  ansi-styles@6.2.1:
    resolution: {integrity: sha512-bN798gFfQX+viw3R7yrGWRqnrN2oRkEkUjjl4JNn4E8GxxbjtG3FbrEIIY3l8/hrwUwIeCZvi4QuOTP4MErVug==}
    engines: {node: '>=12'}

  any-promise@1.3.0:
    resolution: {integrity: sha512-7UvmKalWRt1wgjL1RrGxoSJW/0QZFIegpeGvZG9kjp8vrRu55XTHbwnqq2GpXm9uLbcuhxm3IqX9OB4MZR1b2A==}

  anymatch@3.1.3:
    resolution: {integrity: sha512-KMReFUr0B4t+D+OBkjR3KYqvocp2XaSzO55UcB6mgQMd3KbcE+mWTyvVV7D/zsdEbNnV6acZUutkiHQXvTr1Rw==}
    engines: {node: '>= 8'}

  arg@5.0.2:
    resolution: {integrity: sha512-PYjyFOLKQ9y57JvQ6QLo8dAgNqswh8M1RMJYdQduT6xbWSgK36P/Z/v+p888pM69jMMfS8Xd8F6I1kQ/I9HUGg==}

  argparse@2.0.1:
    resolution: {integrity: sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==}

  aria-hidden@1.2.6:
    resolution: {integrity: sha512-ik3ZgC9dY/lYVVM++OISsaYDeg1tb0VtP5uL3ouh1koGOaUMDPpbFIei4JkFimWUFPn90sbMNMXQAIVOlnYKJA==}
    engines: {node: '>=10'}

  aria-query@5.3.0:
    resolution: {integrity: sha512-b0P0sZPKtyu8HkeRAfCq0IfURZK+SuwMjY1UXGBU27wpAiTwQAIlq56IbIO+ytk/JjS1fMR14ee5WBBfKi5J6A==}

  aria-query@5.3.2:
    resolution: {integrity: sha512-COROpnaoap1E2F000S62r6A60uHZnmlvomhfyT2DlTcrY1OrBKn2UhH7qn5wTC9zMvD0AY7csdPSNwKP+7WiQw==}
    engines: {node: '>= 0.4'}

  array-buffer-byte-length@1.0.2:
    resolution: {integrity: sha512-LHE+8BuR7RYGDKvnrmcuSq3tDcKv9OFEXQt/HpbZhY7V6h0zlUXutnAD82GiFx9rdieCMjkvtcsPqBwgUl1Iiw==}
    engines: {node: '>= 0.4'}

  array-includes@3.1.9:
    resolution: {integrity: sha512-FmeCCAenzH0KH381SPT5FZmiA/TmpndpcaShhfgEN9eCVjnFBqq3l1xrI42y8+PPLI6hypzou4GXw00WHmPBLQ==}
    engines: {node: '>= 0.4'}

  array.prototype.findlast@1.2.5:
    resolution: {integrity: sha512-CVvd6FHg1Z3POpBLxO6E6zr+rSKEQ9L6rZHAaY7lLfhKsWYUBBOuMs0e9o24oopj6H+geRCX0YJ+TJLBK2eHyQ==}
    engines: {node: '>= 0.4'}

  array.prototype.findlastindex@1.2.6:
    resolution: {integrity: sha512-F/TKATkzseUExPlfvmwQKGITM3DGTK+vkAsCZoDc5daVygbJBnjEUCbgkAvVFsgfXfX4YIqZ/27G3k3tdXrTxQ==}
    engines: {node: '>= 0.4'}

  array.prototype.flat@1.3.3:
    resolution: {integrity: sha512-rwG/ja1neyLqCuGZ5YYrznA62D4mZXg0i1cIskIUKSiqF3Cje9/wXAls9B9s1Wa2fomMsIv8czB8jZcPmxCXFg==}
    engines: {node: '>= 0.4'}

  array.prototype.flatmap@1.3.3:
    resolution: {integrity: sha512-Y7Wt51eKJSyi80hFrJCePGGNo5ktJCslFuboqJsbf57CCPcm5zztluPlc4/aD8sWsKvlwatezpV4U1efk8kpjg==}
    engines: {node: '>= 0.4'}

  array.prototype.tosorted@1.1.4:
    resolution: {integrity: sha512-p6Fx8B7b7ZhL/gmUsAy0D15WhvDccw3mnGNbZpi3pmeJdxtWsj2jEaI4Y6oo3XiHfzuSgPwKc04MYt6KgvC/wA==}
    engines: {node: '>= 0.4'}

  arraybuffer.prototype.slice@1.0.4:
    resolution: {integrity: sha512-BNoCY6SXXPQ7gF2opIP4GBE+Xw7U+pHMYKuzjgCN3GwiaIR09UUeKfheyIry77QtrCBlC0KK0q5/TER/tYh3PQ==}
    engines: {node: '>= 0.4'}

  assertion-error@2.0.1:
    resolution: {integrity: sha512-Izi8RQcffqCeNVgFigKli1ssklIbpHnCYc6AknXGYoB6grJqyeby7jv12JUQgmTAnIDnbck1uxksT4dzN3PWBA==}
    engines: {node: '>=12'}

  ast-types-flow@0.0.8:
    resolution: {integrity: sha512-OH/2E5Fg20h2aPrbe+QL8JZQFko0YZaF+j4mnQ7BGhfavO7OpSLa8a0y9sBwomHdSbkhTS8TQNayBfnW5DwbvQ==}

  async-function@1.0.0:
    resolution: {integrity: sha512-hsU18Ae8CDTR6Kgu9DYf0EbCr/a5iGL0rytQDobUcdpYOKokk8LEjVphnXkDkgpi0wYVsqrXuP0bZxJaTqdgoA==}
    engines: {node: '>= 0.4'}

  asynckit@0.4.0:
    resolution: {integrity: sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==}

  autoprefixer@10.4.21:
    resolution: {integrity: sha512-O+A6LWV5LDHSJD3LjHYoNi4VLsj/Whi7k6zG12xTYaU4cQ8oxQGckXNX8cRHK5yOZ/ppVHe0ZBXGzSV9jXdVbQ==}
    engines: {node: ^10 || ^12 || >=14}
    hasBin: true
    peerDependencies:
      postcss: ^8.1.0

  available-typed-arrays@1.0.7:
    resolution: {integrity: sha512-wvUjBtSGN7+7SjNpq/9M2Tg350UZD3q62IFZLbRAR1bSMlCo1ZaeW+BJ+D090e4hIIZLBcTDWe4Mh4jvUDajzQ==}
    engines: {node: '>= 0.4'}

  axe-core@4.10.3:
    resolution: {integrity: sha512-Xm7bpRXnDSX2YE2YFfBk2FnF0ep6tmG7xPh8iHee8MIcrgq762Nkce856dYtJYLkuIoYZvGfTs/PbZhideTcEg==}
    engines: {node: '>=4'}

  axios@1.10.0:
    resolution: {integrity: sha512-/1xYAC4MP/HEG+3duIhFr4ZQXR4sQXOIe+o6sdqzeykGLx6Upp/1p8MHqhINOvGeP7xyNHe7tsiJByc4SSVUxw==}

  axobject-query@4.1.0:
    resolution: {integrity: sha512-qIj0G9wZbMGNLjLmg1PT6v2mE9AH2zlnADJD/2tC6E00hgmhUOfEB6greHPAfLRSufHqROIUTkw6E+M3lH0PTQ==}
    engines: {node: '>= 0.4'}

  balanced-match@1.0.2:
    resolution: {integrity: sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==}

  binary-extensions@2.3.0:
    resolution: {integrity: sha512-Ceh+7ox5qe7LJuLHoY0feh3pHuUDHAcRUeyL2VYghZwfpkNIy/+8Ocg0a3UuSoYzavmylwuLWQOf3hl0jjMMIw==}
    engines: {node: '>=8'}

  brace-expansion@1.1.12:
    resolution: {integrity: sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==}

  brace-expansion@2.0.2:
    resolution: {integrity: sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==}

  braces@3.0.3:
    resolution: {integrity: sha512-yQbXgO/OSZVD2IsiLlro+7Hf6Q18EJrKSEsdoMzKePKXct3gvD8oLcOQdIzGupr5Fj+EDe8gO/lxc1BzfMpxvA==}
    engines: {node: '>=8'}

  browserslist@4.25.1:
    resolution: {integrity: sha512-KGj0KoOMXLpSNkkEI6Z6mShmQy0bc1I+T7K9N81k4WWMrfz+6fQ6es80B/YLAeRoKvjYE1YSHHOW1qe9xIVzHw==}
    engines: {node: ^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || >=13.7}
    hasBin: true

  busboy@1.6.0:
    resolution: {integrity: sha512-8SFQbg/0hQ9xy3UNTB0YEnsNBbWfhf7RtnzpL7TkBiTBRfrQ9Fxcnz7VJsleJpyp6rVLvXiuORqjlHi5q+PYuA==}
    engines: {node: '>=10.16.0'}

  cac@6.7.14:
    resolution: {integrity: sha512-b6Ilus+c3RrdDk+JhLKUAQfzzgLEPy6wcXqS7f/xe1EETvsDP6GORG7SFuOs6cID5YkqchW/LXZbX5bc8j7ZcQ==}
    engines: {node: '>=8'}

  call-bind-apply-helpers@1.0.2:
    resolution: {integrity: sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==}
    engines: {node: '>= 0.4'}

  call-bind@1.0.8:
    resolution: {integrity: sha512-oKlSFMcMwpUg2ednkhQ454wfWiU/ul3CkJe/PEHcTKuiX6RpbehUiFMXu13HalGZxfUwCQzZG747YXBn1im9ww==}
    engines: {node: '>= 0.4'}

  call-bound@1.0.4:
    resolution: {integrity: sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==}
    engines: {node: '>= 0.4'}

  callsites@3.1.0:
    resolution: {integrity: sha512-P8BjAsXvZS+VIDUI11hHCQEv74YT67YUi5JJFNWIqL235sBmjX4+qx9Muvls5ivyNENctx46xQLQ3aTuE7ssaQ==}
    engines: {node: '>=6'}

  camelcase-css@2.0.1:
    resolution: {integrity: sha512-QOSvevhslijgYwRx6Rv7zKdMF8lbRmx+uQGx2+vDc+KI/eBnsy9kit5aj23AgGu3pa4t9AgwbnXWqS+iOY+2aA==}
    engines: {node: '>= 6'}

  caniuse-lite@1.0.30001726:
    resolution: {integrity: sha512-VQAUIUzBiZ/UnlM28fSp2CRF3ivUn1BWEvxMcVTNwpw91Py1pGbPIyIKtd+tzct9C3ouceCVdGAXxZOpZAsgdw==}

  chai@5.2.0:
    resolution: {integrity: sha512-mCuXncKXk5iCLhfhwTc0izo0gtEmpz5CtG2y8GiOINBlMVS6v8TMRc5TaLWKS6692m9+dVVfzgeVxR5UxWHTYw==}
    engines: {node: '>=12'}

  chalk@3.0.0:
    resolution: {integrity: sha512-4D3B6Wf41KOYRFdszmDqMCGq5VV/uMAB273JILmO+3jAlh8X4qDtdtgCR3fxtbLEMzSx22QdhnDcJvu2u1fVwg==}
    engines: {node: '>=8'}

  chalk@4.1.2:
    resolution: {integrity: sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==}
    engines: {node: '>=10'}

  check-error@2.1.1:
    resolution: {integrity: sha512-OAlb+T7V4Op9OwdkjmguYRqncdlx5JiofwOAUkmTF+jNdHwzTaTs4sRAGpzLF3oOz5xAyDGrPgeIDFQmDOTiJw==}
    engines: {node: '>= 16'}

  chokidar@3.6.0:
    resolution: {integrity: sha512-7VT13fmjotKpGipCW9JEQAusEPE+Ei8nl6/g4FBAmIm0GOOLMua9NDDo/DWp0ZAxCr3cPq5ZpBqmPAQgDda2Pw==}
    engines: {node: '>= 8.10.0'}

  class-variance-authority@0.7.1:
    resolution: {integrity: sha512-Ka+9Trutv7G8M6WT6SeiRWz792K5qEqIGEGzXKhAE6xOWAY6pPH8U+9IY3oCMv6kqTmLsv7Xh/2w2RigkePMsg==}

  client-only@0.0.1:
    resolution: {integrity: sha512-IV3Ou0jSMzZrd3pZ48nLkT9DA7Ag1pnPzaiQhpW7c3RbcqqzvzzVu+L8gfqMp/8IM2MQtSiqaCxrrcfu8I8rMA==}

  clsx@2.1.1:
    resolution: {integrity: sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==}
    engines: {node: '>=6'}

  cmdk@1.0.4:
    resolution: {integrity: sha512-AnsjfHyHpQ/EFeAnG216WY7A5LiYCoZzCSygiLvfXC3H3LFGCprErteUcszaVluGOhuOTbJS3jWHrSDYPBBygg==}
    peerDependencies:
      react: ^18 || ^19 || ^19.0.0-rc
      react-dom: ^18 || ^19 || ^19.0.0-rc

  codemirror-spell-checker@1.1.2:
    resolution: {integrity: sha512-2Tl6n0v+GJRsC9K3MLCdLaMOmvWL0uukajNJseorZJsslaxZyZMgENocPU8R0DyoTAiKsyqiemSOZo7kjGV0LQ==}

  codemirror@5.65.19:
    resolution: {integrity: sha512-+aFkvqhaAVr1gferNMuN8vkTSrWIFvzlMV9I2KBLCWS2WpZ2+UAkZjlMZmEuT+gcXTi6RrGQCkWq1/bDtGqhIA==}

  color-convert@2.0.1:
    resolution: {integrity: sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==}
    engines: {node: '>=7.0.0'}

  color-name@1.1.4:
    resolution: {integrity: sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==}

  color-string@1.9.1:
    resolution: {integrity: sha512-shrVawQFojnZv6xM40anx4CkoDP+fZsw/ZerEMsW/pyzsRbElpsL/DBVW7q3ExxwusdNXI3lXpuhEZkzs8p5Eg==}

  color@4.2.3:
    resolution: {integrity: sha512-1rXeuUUiGGrykh+CeBdu5Ie7OJwinCgQY0bc7GCRxy5xVHy+moaqkpL/jqQq0MtQOeYcrqEz4abc5f0KtU7W4A==}
    engines: {node: '>=12.5.0'}

  combined-stream@1.0.8:
    resolution: {integrity: sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==}
    engines: {node: '>= 0.8'}

  commander@4.1.1:
    resolution: {integrity: sha512-NOKm8xhkzAjzFx8B2v5OAHT+u5pRQc2UCa2Vq9jYL/31o2wi9mxBA7LIFs3sV5VSC49z6pEhfbMULvShKj26WA==}
    engines: {node: '>= 6'}

  concat-map@0.0.1:
    resolution: {integrity: sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==}

  convert-source-map@2.0.0:
    resolution: {integrity: sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==}

  cross-spawn@7.0.6:
    resolution: {integrity: sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==}
    engines: {node: '>= 8'}

  css.escape@1.5.1:
    resolution: {integrity: sha512-YUifsXXuknHlUsmlgyY0PKzgPOr7/FjCePfHNt0jxm83wHZi44VDMQ7/fGNkjY3/jV1MC+1CmZbaHzugyeRtpg==}

  cssesc@3.0.0:
    resolution: {integrity: sha512-/Tb/JcjK111nNScGob5MNtsntNM1aCNUDipB/TkwZFhyDrrE47SOx/18wF2bbjgc3ZzCSKW1T5nt5EbFoAz/Vg==}
    engines: {node: '>=4'}
    hasBin: true

  cssstyle@4.6.0:
    resolution: {integrity: sha512-2z+rWdzbbSZv6/rhtvzvqeZQHrBaqgogqt85sqFNbabZOuFbCVFb8kPeEtZjiKkbrm395irpNKiYeFeLiQnFPg==}
    engines: {node: '>=18'}

  csstype@3.1.3:
    resolution: {integrity: sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==}

  d3-array@3.2.4:
    resolution: {integrity: sha512-tdQAmyA18i4J7wprpYq8ClcxZy3SC31QMeByyCFyRt7BVHdREQZ5lpzoe5mFEYZUWe+oq8HBvk9JjpibyEV4Jg==}
    engines: {node: '>=12'}

  d3-color@3.1.0:
    resolution: {integrity: sha512-zg/chbXyeBtMQ1LbD/WSoW2DpC3I0mpmPdW+ynRTj/x2DAWYrIY7qeZIHidozwV24m4iavr15lNwIwLxRmOxhA==}
    engines: {node: '>=12'}

  d3-ease@3.0.1:
    resolution: {integrity: sha512-wR/XK3D3XcLIZwpbvQwQ5fK+8Ykds1ip7A2Txe0yxncXSdq1L9skcG7blcedkOX+ZcgxGAmLX1FrRGbADwzi0w==}
    engines: {node: '>=12'}

  d3-format@3.1.0:
    resolution: {integrity: sha512-YyUI6AEuY/Wpt8KWLgZHsIU86atmikuoOmCfommt0LYHiQSPjvX2AcFc38PX0CBpr2RCyZhjex+NS/LPOv6YqA==}
    engines: {node: '>=12'}

  d3-interpolate@3.0.1:
    resolution: {integrity: sha512-3bYs1rOD33uo8aqJfKP3JWPAibgw8Zm2+L9vBKEHJ2Rg+viTR7o5Mmv5mZcieN+FRYaAOWX5SJATX6k1PWz72g==}
    engines: {node: '>=12'}

  d3-path@3.1.0:
    resolution: {integrity: sha512-p3KP5HCf/bvjBSSKuXid6Zqijx7wIfNW+J/maPs+iwR35at5JCbLUT0LzF1cnjbCHWhqzQTIN2Jpe8pRebIEFQ==}
    engines: {node: '>=12'}

  d3-scale@4.0.2:
    resolution: {integrity: sha512-GZW464g1SH7ag3Y7hXjf8RoUuAFIqklOAq3MRl4OaWabTFJY9PN/E1YklhXLh+OQ3fM9yS2nOkCoS+WLZ6kvxQ==}
    engines: {node: '>=12'}

  d3-shape@3.2.0:
    resolution: {integrity: sha512-SaLBuwGm3MOViRq2ABk3eLoxwZELpH6zhl3FbAoJ7Vm1gofKx6El1Ib5z23NUEhF9AsGl7y+dzLe5Cw2AArGTA==}
    engines: {node: '>=12'}

  d3-time-format@4.1.0:
    resolution: {integrity: sha512-dJxPBlzC7NugB2PDLwo9Q8JiTR3M3e4/XANkreKSUxF8vvXKqm1Yfq4Q5dl8budlunRVlUUaDUgFt7eA8D6NLg==}
    engines: {node: '>=12'}

  d3-time@3.1.0:
    resolution: {integrity: sha512-VqKjzBLejbSMT4IgbmVgDjpkYrNWUYJnbCGo874u7MMKIWsILRX+OpX/gTk8MqjpT1A/c6HY2dCA77ZN0lkQ2Q==}
    engines: {node: '>=12'}

  d3-timer@3.0.1:
    resolution: {integrity: sha512-ndfJ/JxxMd3nw31uyKoY2naivF+r29V+Lc0svZxe1JvvIRmi8hUsrMvdOwgS1o6uBHmiz91geQ0ylPP0aj1VUA==}
    engines: {node: '>=12'}

  damerau-levenshtein@1.0.8:
    resolution: {integrity: sha512-sdQSFB7+llfUcQHUQO3+B8ERRj0Oa4w9POWMI/puGtuf7gFywGmkaLCElnudfTiKZV+NvHqL0ifzdrI8Ro7ESA==}

  data-urls@5.0.0:
    resolution: {integrity: sha512-ZYP5VBHshaDAiVZxjbRVcFJpc+4xGgT0bK3vzy1HLN8jTO975HEbuYzZJcHoQEY5K1a0z8YayJkyVETa08eNTg==}
    engines: {node: '>=18'}

  data-view-buffer@1.0.2:
    resolution: {integrity: sha512-EmKO5V3OLXh1rtK2wgXRansaK1/mtVdTUEiEI0W8RkvgT05kfxaH29PliLnpLP73yYO6142Q72QNa8Wx/A5CqQ==}
    engines: {node: '>= 0.4'}

  data-view-byte-length@1.0.2:
    resolution: {integrity: sha512-tuhGbE6CfTM9+5ANGf+oQb72Ky/0+s3xKUpHvShfiz2RxMFgFPjsXuRLBVMtvMs15awe45SRb83D6wH4ew6wlQ==}
    engines: {node: '>= 0.4'}

  data-view-byte-offset@1.0.1:
    resolution: {integrity: sha512-BS8PfmtDGnrgYdOonGZQdLZslWIeCGFP9tpan0hi1Co2Zr2NKADsvGYA8XxuG/4UWgJ6Cjtv+YJnB6MM69QGlQ==}
    engines: {node: '>= 0.4'}

  date-fns@4.1.0:
    resolution: {integrity: sha512-Ukq0owbQXxa/U3EGtsdVBkR1w7KOQ5gIBqdH2hkvknzZPYvBxb/aa6E8L7tmjFtkwZBu3UXBbjIgPo/Ez4xaNg==}

  debug@3.2.7:
    resolution: {integrity: sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==}
    peerDependencies:
      supports-color: '*'
    peerDependenciesMeta:
      supports-color:
        optional: true

  debug@4.4.1:
    resolution: {integrity: sha512-KcKCqiftBJcZr++7ykoDIEwSa3XWowTfNPo92BYxjXiyYEVrUQh2aLyhxBCwww+heortUFxEJYcRzosstTEBYQ==}
    engines: {node: '>=6.0'}
    peerDependencies:
      supports-color: '*'
    peerDependenciesMeta:
      supports-color:
        optional: true

  decimal.js-light@2.5.1:
    resolution: {integrity: sha512-qIMFpTMZmny+MMIitAB6D7iVPEorVw6YQRWkvarTkT4tBeSLLiHzcwj6q0MmYSFCiVpiqPJTJEYIrpcPzVEIvg==}

  decimal.js@10.5.0:
    resolution: {integrity: sha512-8vDa8Qxvr/+d94hSh5P3IJwI5t8/c0KsMp+g8bNw9cY2icONa5aPfvKeieW1WlG0WQYwwhJ7mjui2xtiePQSXw==}

  deep-eql@5.0.2:
    resolution: {integrity: sha512-h5k/5U50IJJFpzfL6nO9jaaumfjO/f2NjK/oYB2Djzm4p9L+3T9qWpZqZ2hAbLPuuYq9wrU08WQyBTL5GbPk5Q==}
    engines: {node: '>=6'}

  deep-is@0.1.4:
    resolution: {integrity: sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==}

  define-data-property@1.1.4:
    resolution: {integrity: sha512-rBMvIzlpA8v6E+SJZoo++HAYqsLrkg7MSfIinMPFhmkorw7X+dOXVJQs+QT69zGkzMyfDnIMN2Wid1+NbL3T+A==}
    engines: {node: '>= 0.4'}

  define-properties@1.2.1:
    resolution: {integrity: sha512-8QmQKqEASLd5nx0U1B1okLElbUuuttJ/AnYmRXbbbGDWh6uS208EjD4Xqq/I9wK7u0v6O08XhTWnt5XtEbR6Dg==}
    engines: {node: '>= 0.4'}

  delayed-stream@1.0.0:
    resolution: {integrity: sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==}
    engines: {node: '>=0.4.0'}

  dequal@2.0.3:
    resolution: {integrity: sha512-0je+qPKHEMohvfRTCEo3CrPG6cAzAYgmzKyxRiYSSDkS6eGJdyVJm7WaYA5ECaAD9wLB2T4EEeymA5aFVcYXCA==}
    engines: {node: '>=6'}

  detect-libc@2.0.4:
    resolution: {integrity: sha512-3UDv+G9CsCKO1WKMGw9fwq/SWJYbI0c5Y7LU1AXYoDdbhE2AHQ6N6Nb34sG8Fj7T5APy8qXDCKuuIHd1BR0tVA==}
    engines: {node: '>=8'}

  detect-node-es@1.1.0:
    resolution: {integrity: sha512-ypdmJU/TbBby2Dxibuv7ZLW3Bs1QEmM7nHjEANfohJLvE0XVujisn1qPJcZxg+qDucsr+bP6fLD1rPS3AhJ7EQ==}

  didyoumean@1.2.2:
    resolution: {integrity: sha512-gxtyfqMg7GKyhQmb056K7M3xszy/myH8w+B4RT+QXBQsvAOdc3XymqDDPHx1BgPgsdAA5SIifona89YtRATDzw==}

  dlv@1.1.3:
    resolution: {integrity: sha512-+HlytyjlPKnIG8XuRG8WvmBP8xs8P71y+SKKS6ZXWoEgLuePxtDoUEiH7WkdePWrQ5JBpE6aoVqfZfJUQkjXwA==}

  doctrine@2.1.0:
    resolution: {integrity: sha512-35mSku4ZXK0vfCuHEDAwt55dg2jNajHZ1odvF+8SSr82EsZY4QmXfuWso8oEd8zRhVObSN18aM0CjSdoBX7zIw==}
    engines: {node: '>=0.10.0'}

  dom-accessibility-api@0.5.16:
    resolution: {integrity: sha512-X7BJ2yElsnOJ30pZF4uIIDfBEVgF4XEBxL9Bxhy6dnrm5hkzqmsWHGTiHqRiITNhMyFLyAiWndIJP7Z1NTteDg==}

  dom-accessibility-api@0.6.3:
    resolution: {integrity: sha512-7ZgogeTnjuHbo+ct10G9Ffp0mif17idi0IyWNVA/wcwcm7NPOD/WEHVP3n7n3MhXqxoIYm8d6MuZohYWIZ4T3w==}

  dom-helpers@5.2.1:
    resolution: {integrity: sha512-nRCa7CK3VTrM2NmGkIy4cbK7IZlgBE/PYMn55rrXefr5xXDP0LdtfPnblFDoVdcAfslJ7or6iqAUnx0CCGIWQA==}

  dunder-proto@1.0.1:
    resolution: {integrity: sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==}
    engines: {node: '>= 0.4'}

  eastasianwidth@0.2.0:
    resolution: {integrity: sha512-I88TYZWc9XiYHRQ4/3c5rjjfgkjhLyW2luGIheGERbNQ6OY7yTybanSpDXZa8y7VUP9YmDcYa+eyq4ca7iLqWA==}

  easymde@2.20.0:
    resolution: {integrity: sha512-V1Z5f92TfR42Na852OWnIZMbM7zotWQYTddNaLYZFVKj7APBbyZ3FYJ27gBw2grMW3R6Qdv9J8n5Ij7XRSIgXQ==}

  electron-to-chromium@1.5.179:
    resolution: {integrity: sha512-UWKi/EbBopgfFsc5k61wFpV7WrnnSlSzW/e2XcBmS6qKYTivZlLtoll5/rdqRTxGglGHkmkW0j0pFNJG10EUIQ==}

  embla-carousel-react@8.5.1:
    resolution: {integrity: sha512-z9Y0K84BJvhChXgqn2CFYbfEi6AwEr+FFVVKm/MqbTQ2zIzO1VQri6w67LcfpVF0AjbhwVMywDZqY4alYkjW5w==}
    peerDependencies:
      react: ^16.8.0 || ^17.0.1 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc

  embla-carousel-reactive-utils@8.5.1:
    resolution: {integrity: sha512-n7VSoGIiiDIc4MfXF3ZRTO59KDp820QDuyBDGlt5/65+lumPHxX2JLz0EZ23hZ4eg4vZGUXwMkYv02fw2JVo/A==}
    peerDependencies:
      embla-carousel: 8.5.1

  embla-carousel@8.5.1:
    resolution: {integrity: sha512-JUb5+FOHobSiWQ2EJNaueCNT/cQU9L6XWBbWmorWPQT9bkbk+fhsuLr8wWrzXKagO3oWszBO7MSx+GfaRk4E6A==}

  emoji-regex@8.0.0:
    resolution: {integrity: sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==}

  emoji-regex@9.2.2:
    resolution: {integrity: sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==}

  entities@6.0.1:
    resolution: {integrity: sha512-aN97NXWF6AWBTahfVOIrB/NShkzi5H7F9r1s9mD3cDj4Ko5f2qhhVoYMibXF7GlLveb/D2ioWay8lxI97Ven3g==}
    engines: {node: '>=0.12'}

  es-abstract@1.24.0:
    resolution: {integrity: sha512-WSzPgsdLtTcQwm4CROfS5ju2Wa1QQcVeT37jFjYzdFz1r9ahadC8B8/a4qxJxM+09F18iumCdRmlr96ZYkQvEg==}
    engines: {node: '>= 0.4'}

  es-define-property@1.0.1:
    resolution: {integrity: sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==}
    engines: {node: '>= 0.4'}

  es-errors@1.3.0:
    resolution: {integrity: sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==}
    engines: {node: '>= 0.4'}

  es-iterator-helpers@1.2.1:
    resolution: {integrity: sha512-uDn+FE1yrDzyC0pCo961B2IHbdM8y/ACZsKD4dG6WqrjV53BADjwa7D+1aom2rsNVfLyDgU/eigvlJGJ08OQ4w==}
    engines: {node: '>= 0.4'}

  es-module-lexer@1.7.0:
    resolution: {integrity: sha512-jEQoCwk8hyb2AZziIOLhDqpm5+2ww5uIE6lkO/6jcOCusfk6LhMHpXXfBLXTZ7Ydyt0j4VoUQv6uGNYbdW+kBA==}

  es-object-atoms@1.1.1:
    resolution: {integrity: sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==}
    engines: {node: '>= 0.4'}

  es-set-tostringtag@2.1.0:
    resolution: {integrity: sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==}
    engines: {node: '>= 0.4'}

  es-shim-unscopables@1.1.0:
    resolution: {integrity: sha512-d9T8ucsEhh8Bi1woXCf+TIKDIROLG5WCkxg8geBCbvk22kzwC5G2OnXVMO6FUsvQlgUUXQ2itephWDLqDzbeCw==}
    engines: {node: '>= 0.4'}

  es-to-primitive@1.3.0:
    resolution: {integrity: sha512-w+5mJ3GuFL+NjVtJlvydShqE1eN3h3PbI7/5LAsYJP/2qtuMXjfL2LpHSRqo4b4eSF5K/DH1JXKUAHSB2UW50g==}
    engines: {node: '>= 0.4'}

  esbuild@0.25.5:
    resolution: {integrity: sha512-P8OtKZRv/5J5hhz0cUAdu/cLuPIKXpQl1R9pZtvmHWQvrAUVd0UNIPT4IB4W3rNOqVO0rlqHmCIbSwxh/c9yUQ==}
    engines: {node: '>=18'}
    hasBin: true

  escalade@3.2.0:
    resolution: {integrity: sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==}
    engines: {node: '>=6'}

  escape-string-regexp@4.0.0:
    resolution: {integrity: sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==}
    engines: {node: '>=10'}

  eslint-config-next@15.3.4:
    resolution: {integrity: sha512-WqeumCq57QcTP2lYlV6BRUySfGiBYEXlQ1L0mQ+u4N4X4ZhUVSSQ52WtjqHv60pJ6dD7jn+YZc0d1/ZSsxccvg==}
    peerDependencies:
      eslint: ^7.23.0 || ^8.0.0 || ^9.0.0
      typescript: '>=3.3.1'
    peerDependenciesMeta:
      typescript:
        optional: true

  eslint-import-resolver-node@0.3.9:
    resolution: {integrity: sha512-WFj2isz22JahUv+B788TlO3N6zL3nNJGU8CcZbPZvVEkBPaJdCV4vy5wyghty5ROFbCRnm132v8BScu5/1BQ8g==}

  eslint-import-resolver-typescript@3.10.1:
    resolution: {integrity: sha512-A1rHYb06zjMGAxdLSkN2fXPBwuSaQ0iO5M/hdyS0Ajj1VBaRp0sPD3dn1FhME3c/JluGFbwSxyCfqdSbtQLAHQ==}
    engines: {node: ^14.18.0 || >=16.0.0}
    peerDependencies:
      eslint: '*'
      eslint-plugin-import: '*'
      eslint-plugin-import-x: '*'
    peerDependenciesMeta:
      eslint-plugin-import:
        optional: true
      eslint-plugin-import-x:
        optional: true

  eslint-module-utils@2.12.1:
    resolution: {integrity: sha512-L8jSWTze7K2mTg0vos/RuLRS5soomksDPoJLXIslC7c8Wmut3bx7CPpJijDcBZtxQ5lrbUdM+s0OlNbz0DCDNw==}
    engines: {node: '>=4'}
    peerDependencies:
      '@typescript-eslint/parser': '*'
      eslint: '*'
      eslint-import-resolver-node: '*'
      eslint-import-resolver-typescript: '*'
      eslint-import-resolver-webpack: '*'
    peerDependenciesMeta:
      '@typescript-eslint/parser':
        optional: true
      eslint:
        optional: true
      eslint-import-resolver-node:
        optional: true
      eslint-import-resolver-typescript:
        optional: true
      eslint-import-resolver-webpack:
        optional: true

  eslint-plugin-import@2.32.0:
    resolution: {integrity: sha512-whOE1HFo/qJDyX4SnXzP4N6zOWn79WhnCUY/iDR0mPfQZO8wcYE4JClzI2oZrhBnnMUCBCHZhO6VQyoBU95mZA==}
    engines: {node: '>=4'}
    peerDependencies:
      '@typescript-eslint/parser': '*'
      eslint: ^2 || ^3 || ^4 || ^5 || ^6 || ^7.2.0 || ^8 || ^9
    peerDependenciesMeta:
      '@typescript-eslint/parser':
        optional: true

  eslint-plugin-jsx-a11y@6.10.2:
    resolution: {integrity: sha512-scB3nz4WmG75pV8+3eRUQOHZlNSUhFNq37xnpgRkCCELU3XMvXAxLk1eqWWyE22Ki4Q01Fnsw9BA3cJHDPgn2Q==}
    engines: {node: '>=4.0'}
    peerDependencies:
      eslint: ^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9

  eslint-plugin-react-hooks@5.2.0:
    resolution: {integrity: sha512-+f15FfK64YQwZdJNELETdn5ibXEUQmW1DZL6KXhNnc2heoy/sg9VJJeT7n8TlMWouzWqSWavFkIhHyIbIAEapg==}
    engines: {node: '>=10'}
    peerDependencies:
      eslint: ^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0 || ^9.0.0

  eslint-plugin-react@7.37.5:
    resolution: {integrity: sha512-Qteup0SqU15kdocexFNAJMvCJEfa2xUKNV4CC1xsVMrIIqEy3SQ/rqyxCWNzfrd3/ldy6HMlD2e0JDVpDg2qIA==}
    engines: {node: '>=4'}
    peerDependencies:
      eslint: ^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9.7

  eslint-scope@8.4.0:
    resolution: {integrity: sha512-sNXOfKCn74rt8RICKMvJS7XKV/Xk9kA7DyJr8mJik3S7Cwgy3qlkkmyS2uQB3jiJg6VNdZd/pDBJu0nvG2NlTg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  eslint-visitor-keys@3.4.3:
    resolution: {integrity: sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}

  eslint-visitor-keys@4.2.1:
    resolution: {integrity: sha512-Uhdk5sfqcee/9H/rCOJikYz67o0a2Tw2hGRPOG2Y1R2dg7brRe1uG0yaNQDHu+TO/uQPF/5eCapvYSmHUjt7JQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  eslint@9.30.1:
    resolution: {integrity: sha512-zmxXPNMOXmwm9E0yQLi5uqXHs7uq2UIiqEKo3Gq+3fwo1XrJ+hijAZImyF7hclW3E6oHz43Yk3RP8at6OTKflQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    hasBin: true
    peerDependencies:
      jiti: '*'
    peerDependenciesMeta:
      jiti:
        optional: true

  espree@10.4.0:
    resolution: {integrity: sha512-j6PAQ2uUr79PZhBjP5C5fhl8e39FmRnOjsD5lGnWrFU8i2G776tBK7+nP8KuQUTTyAZUwfQqXAgrVH5MbH9CYQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  esquery@1.6.0:
    resolution: {integrity: sha512-ca9pw9fomFcKPvFLXhBKUK90ZvGibiGOvRJNbjljY7s7uq/5YO4BOzcYtJqExdx99rF6aAcnRxHmcUHcz6sQsg==}
    engines: {node: '>=0.10'}

  esrecurse@4.3.0:
    resolution: {integrity: sha512-KmfKL3b6G+RXvP8N1vr3Tq1kL/oCFgn2NYXEtqP8/L3pKapUA4G8cFVaoF3SU323CD4XypR/ffioHmkti6/Tag==}
    engines: {node: '>=4.0'}

  estraverse@5.3.0:
    resolution: {integrity: sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==}
    engines: {node: '>=4.0'}

  estree-walker@3.0.3:
    resolution: {integrity: sha512-7RUKfXgSMMkzt6ZuXmqapOurLGPPfgj6l9uRZ7lRGolvk0y2yocc35LdcxKC5PQZdn2DMqioAQ2NoWcrTKmm6g==}

  esutils@2.0.3:
    resolution: {integrity: sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==}
    engines: {node: '>=0.10.0'}

  eventemitter3@4.0.7:
    resolution: {integrity: sha512-8guHBZCwKnFhYdHr2ysuRWErTwhoN2X8XELRlrRwpmfeY2jjuUN4taQMsULKUVo1K4DvZl+0pgfyoysHxvmvEw==}

  expect-type@1.2.1:
    resolution: {integrity: sha512-/kP8CAwxzLVEeFrMm4kMmy4CCDlpipyA7MYLVrdJIkV0fYF0UaigQHRsxHiuY/GEea+bh4KSv3TIlgr+2UL6bw==}
    engines: {node: '>=12.0.0'}

  fast-deep-equal@3.1.3:
    resolution: {integrity: sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==}

  fast-equals@5.2.2:
    resolution: {integrity: sha512-V7/RktU11J3I36Nwq2JnZEM7tNm17eBJz+u25qdxBZeCKiX6BkVSZQjwWIr+IobgnZy+ag73tTZgZi7tr0LrBw==}
    engines: {node: '>=6.0.0'}

  fast-glob@3.3.1:
    resolution: {integrity: sha512-kNFPyjhh5cKjrUltxs+wFx+ZkbRaxxmZ+X0ZU31SOsxCEtP9VPgtq2teZw1DebupL5GmDaNQ6yKMMVcM41iqDg==}
    engines: {node: '>=8.6.0'}

  fast-glob@3.3.3:
    resolution: {integrity: sha512-7MptL8U0cqcFdzIzwOTHoilX9x5BrNqye7Z/LuC7kCMRio1EMSyqRK3BEAUD7sXRq4iT4AzTVuZdhgQ2TCvYLg==}
    engines: {node: '>=8.6.0'}

  fast-json-stable-stringify@2.1.0:
    resolution: {integrity: sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==}

  fast-levenshtein@2.0.6:
    resolution: {integrity: sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==}

  fastq@1.19.1:
    resolution: {integrity: sha512-GwLTyxkCXjXbxqIhTsMI2Nui8huMPtnxg7krajPJAjnEG/iiOS7i+zCtWGZR9G0NBKbXKh6X9m9UIsYX/N6vvQ==}

  fdir@6.4.6:
    resolution: {integrity: sha512-hiFoqpyZcfNm1yc4u8oWCf9A2c4D3QjCrks3zmoVKVxpQRzmPNar1hUJcBG2RQHvEVGDN+Jm81ZheVLAQMK6+w==}
    peerDependencies:
      picomatch: ^3 || ^4
    peerDependenciesMeta:
      picomatch:
        optional: true

  fflate@0.8.2:
    resolution: {integrity: sha512-cPJU47OaAoCbg0pBvzsgpTPhmhqI5eJjh/JIu8tPj5q+T7iLvW/JAYUqmE7KOB4R1ZyEhzBaIQpQpardBF5z8A==}

  file-entry-cache@8.0.0:
    resolution: {integrity: sha512-XXTUwCvisa5oacNGRP9SfNtYBNAMi+RPwBFmblZEF7N7swHYQS6/Zfk7SRwx4D5j3CH211YNRco1DEMNVfZCnQ==}
    engines: {node: '>=16.0.0'}

  fill-range@7.1.1:
    resolution: {integrity: sha512-YsGpe3WHLK8ZYi4tWDg2Jy3ebRz2rXowDxnld4bkQB00cc/1Zw9AWnC0i9ztDJitivtQvaI9KaLyKrc+hBW0yg==}
    engines: {node: '>=8'}

  find-up@5.0.0:
    resolution: {integrity: sha512-78/PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==}
    engines: {node: '>=10'}

  flat-cache@4.0.1:
    resolution: {integrity: sha512-f7ccFPK3SXFHpx15UIGyRJ/FJQctuKZ0zVuN3frBo4HnK3cay9VEW0R6yPYFHC0AgqhukPzKjq22t5DmAyqGyw==}
    engines: {node: '>=16'}

  flatted@3.3.3:
    resolution: {integrity: sha512-GX+ysw4PBCz0PzosHDepZGANEuFCMLrnRTiEy9McGjmkCQYwRq4A/X786G/fjM/+OjsWSU1ZrY5qyARZmO/uwg==}

  follow-redirects@1.15.9:
    resolution: {integrity: sha512-gew4GsXizNgdoRyqmyfMHyAmXsZDk6mHkSxZFCzW9gwlbtOW44CDtYavM+y+72qD/Vq2l550kMF52DT8fOLJqQ==}
    engines: {node: '>=4.0'}
    peerDependencies:
      debug: '*'
    peerDependenciesMeta:
      debug:
        optional: true

  for-each@0.3.5:
    resolution: {integrity: sha512-dKx12eRCVIzqCxFGplyFKJMPvLEWgmNtUrpTiJIR5u97zEhRG8ySrtboPHZXx7daLxQVrl643cTzbab2tkQjxg==}
    engines: {node: '>= 0.4'}

  foreground-child@3.3.1:
    resolution: {integrity: sha512-gIXjKqtFuWEgzFRJA9WCQeSJLZDjgJUOMCMzxtvFq/37KojM1BFGufqsCy0r4qSQmYLsZYMeyRqzIWOMup03sw==}
    engines: {node: '>=14'}

  form-data@4.0.3:
    resolution: {integrity: sha512-qsITQPfmvMOSAdeyZ+12I1c+CKSstAFAwu+97zrnWAbIr5u8wfsExUzCesVLC8NgHuRUqNN4Zy6UPWUTRGslcA==}
    engines: {node: '>= 6'}

  fraction.js@4.3.7:
    resolution: {integrity: sha512-ZsDfxO51wGAXREY55a7la9LScWpwv9RxIrYABrlvOFBlH/ShPnrtsXeuUIfXKKOVicNxQ+o8JTbJvjS4M89yew==}

  fsevents@2.3.2:
    resolution: {integrity: sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==}
    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}
    os: [darwin]

  fsevents@2.3.3:
    resolution: {integrity: sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==}
    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}
    os: [darwin]

  function-bind@1.1.2:
    resolution: {integrity: sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==}

  function.prototype.name@1.1.8:
    resolution: {integrity: sha512-e5iwyodOHhbMr/yNrc7fDYG4qlbIvI5gajyzPnb5TCwyhjApznQh1BMFou9b30SevY43gCJKXycoCBjMbsuW0Q==}
    engines: {node: '>= 0.4'}

  functions-have-names@1.2.3:
    resolution: {integrity: sha512-xckBUXyTIqT97tq2x2AMb+g163b5JFysYk0x4qxNFwbfQkmNZoiRHb6sPzI9/QV33WeuvVYBUIiD4NzNIyqaRQ==}

  gensync@1.0.0-beta.2:
    resolution: {integrity: sha512-3hN7NaskYvMDLQY55gnW3NQ+mesEAepTqlg+VEbj7zzqEMBVNhzcGYYeqFo/TlYz6eQiFcp1HcsCZO+nGgS8zg==}
    engines: {node: '>=6.9.0'}

  get-intrinsic@1.3.0:
    resolution: {integrity: sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==}
    engines: {node: '>= 0.4'}

  get-nonce@1.0.1:
    resolution: {integrity: sha512-FJhYRoDaiatfEkUK8HKlicmu/3SGFD51q3itKDGoSTysQJBnfOcxU5GxnhE1E6soB76MbT0MBtnKJuXyAx+96Q==}
    engines: {node: '>=6'}

  get-proto@1.0.1:
    resolution: {integrity: sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==}
    engines: {node: '>= 0.4'}

  get-symbol-description@1.1.0:
    resolution: {integrity: sha512-w9UMqWwJxHNOvoNzSJ2oPF5wvYcvP7jUvYzhp67yEhTi17ZDBBC1z9pTdGuzjD+EFIqLSYRweZjqfiPzQ06Ebg==}
    engines: {node: '>= 0.4'}

  get-tsconfig@4.10.1:
    resolution: {integrity: sha512-auHyJ4AgMz7vgS8Hp3N6HXSmlMdUyhSUrfBF16w153rxtLIEOE+HGqaBppczZvnHLqQJfiHotCYpNhl0lUROFQ==}

  glob-parent@5.1.2:
    resolution: {integrity: sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==}
    engines: {node: '>= 6'}

  glob-parent@6.0.2:
    resolution: {integrity: sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==}
    engines: {node: '>=10.13.0'}

  glob@10.4.5:
    resolution: {integrity: sha512-7Bv8RF0k6xjo7d4A/PxYLbUCfb6c+Vpd2/mB2yRDlew7Jb5hEXiCD9ibfO7wpk8i4sevK6DFny9h7EYbM3/sHg==}
    hasBin: true

  globals@14.0.0:
    resolution: {integrity: sha512-oahGvuMGQlPw/ivIYBjVSrWAfWLBeku5tpPE2fOPLi+WHffIWbuh2tCjhyQhTBPMf5E9jDEH4FOmTYgYwbKwtQ==}
    engines: {node: '>=18'}

  globalthis@1.0.4:
    resolution: {integrity: sha512-DpLKbNU4WylpxJykQujfCcwYWiV/Jhm50Goo0wrVILAv5jOr9d+H+UR3PhSCD2rCCEIg0uc+G+muBTwD54JhDQ==}
    engines: {node: '>= 0.4'}

  gopd@1.2.0:
    resolution: {integrity: sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==}
    engines: {node: '>= 0.4'}

  graphemer@1.4.0:
    resolution: {integrity: sha512-EtKwoO6kxCL9WO5xipiHTZlSzBm7WLT627TqC/uVRd0HKmq8NXyebnNYxDoBi7wt8eTWrUrKXCOVaFq9x1kgag==}

  has-bigints@1.1.0:
    resolution: {integrity: sha512-R3pbpkcIqv2Pm3dUwgjclDRVmWpTJW2DcMzcIhEXEx1oh/CEMObMm3KLmRJOdvhM7o4uQBnwr8pzRK2sJWIqfg==}
    engines: {node: '>= 0.4'}

  has-flag@4.0.0:
    resolution: {integrity: sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==}
    engines: {node: '>=8'}

  has-property-descriptors@1.0.2:
    resolution: {integrity: sha512-55JNKuIW+vq4Ke1BjOTjM2YctQIvCT7GFzHwmfZPGo5wnrgkid0YQtnAleFSqumZm4az3n2BS+erby5ipJdgrg==}

  has-proto@1.2.0:
    resolution: {integrity: sha512-KIL7eQPfHQRC8+XluaIw7BHUwwqL19bQn4hzNgdr+1wXoU0KKj6rufu47lhY7KbJR2C6T6+PfyN0Ea7wkSS+qQ==}
    engines: {node: '>= 0.4'}

  has-symbols@1.1.0:
    resolution: {integrity: sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==}
    engines: {node: '>= 0.4'}

  has-tostringtag@1.0.2:
    resolution: {integrity: sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==}
    engines: {node: '>= 0.4'}

  hasown@2.0.2:
    resolution: {integrity: sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==}
    engines: {node: '>= 0.4'}

  html-encoding-sniffer@4.0.0:
    resolution: {integrity: sha512-Y22oTqIU4uuPgEemfz7NDJz6OeKf12Lsu+QC+s3BVpda64lTiMYCyGwg5ki4vFxkMwQdeZDl2adZoqUgdFuTgQ==}
    engines: {node: '>=18'}

  http-proxy-agent@7.0.2:
    resolution: {integrity: sha512-T1gkAiYYDWYx3V5Bmyu7HcfcvL7mUrTWiM6yOfa3PIphViJ/gFPbvidQ+veqSOHci/PxBcDabeUNCzpOODJZig==}
    engines: {node: '>= 14'}

  https-proxy-agent@7.0.6:
    resolution: {integrity: sha512-vK9P5/iUfdl95AI+JVyUuIcVtd4ofvtrOr3HNtM2yxC9bnMbEdp3x01OhQNnjb8IJYi38VlTE3mBXwcfvywuSw==}
    engines: {node: '>= 14'}

  iconv-lite@0.6.3:
    resolution: {integrity: sha512-4fCk79wshMdzMp2rH06qWrJE4iolqLhCUH+OiuIgU++RB0+94NlDL81atO7GX55uUKueo0txHNtvEyI6D7WdMw==}
    engines: {node: '>=0.10.0'}

  ignore@5.3.2:
    resolution: {integrity: sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==}
    engines: {node: '>= 4'}

  ignore@7.0.5:
    resolution: {integrity: sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==}
    engines: {node: '>= 4'}

  import-fresh@3.3.1:
    resolution: {integrity: sha512-TR3KfrTZTYLPB6jUjfx6MF9WcWrHL9su5TObK4ZkYgBdWKPOFoSoQIdEuTuR82pmtxH2spWG9h6etwfr1pLBqQ==}
    engines: {node: '>=6'}

  imurmurhash@0.1.4:
    resolution: {integrity: sha512-JmXMZ6wuvDmLiHEml9ykzqO6lwFbof0GG4IkcGaENdCRDDmMVnny7s5HsIgHCbaq0w2MyPhDqkhTUgS2LU2PHA==}
    engines: {node: '>=0.8.19'}

  indent-string@4.0.0:
    resolution: {integrity: sha512-EdDDZu4A2OyIK7Lr/2zG+w5jmbuk1DVBnEwREQvBzspBJkCEbRa8GxU1lghYcaGJCnRWibjDXlq779X1/y5xwg==}
    engines: {node: '>=8'}

  input-otp@1.4.1:
    resolution: {integrity: sha512-+yvpmKYKHi9jIGngxagY9oWiiblPB7+nEO75F2l2o4vs+6vpPZZmUl4tBNYuTCvQjhvEIbdNeJu70bhfYP2nbw==}
    peerDependencies:
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0.0 || ^19.0.0-rc

  internal-slot@1.1.0:
    resolution: {integrity: sha512-4gd7VpWNQNB4UKKCFFVcp1AVv+FMOgs9NKzjHKusc8jTMhd5eL1NqQqOpE0KzMds804/yHlglp3uxgluOqAPLw==}
    engines: {node: '>= 0.4'}

  internmap@2.0.3:
    resolution: {integrity: sha512-5Hh7Y1wQbvY5ooGgPbDaL5iYLAPzMTUrjMulskHLH6wnv/A+1q5rgEaiuqEjB+oxGXIVZs1FF+R/KPN3ZSQYYg==}
    engines: {node: '>=12'}

  is-array-buffer@3.0.5:
    resolution: {integrity: sha512-DDfANUiiG2wC1qawP66qlTugJeL5HyzMpfr8lLK+jMQirGzNod0B12cFB/9q838Ru27sBwfw78/rdoU7RERz6A==}
    engines: {node: '>= 0.4'}

  is-arrayish@0.3.2:
    resolution: {integrity: sha512-eVRqCvVlZbuw3GrM63ovNSNAeA1K16kaR/LRY/92w0zxQ5/1YzwblUX652i4Xs9RwAGjW9d9y6X88t8OaAJfWQ==}

  is-async-function@2.1.1:
    resolution: {integrity: sha512-9dgM/cZBnNvjzaMYHVoxxfPj2QXt22Ev7SuuPrs+xav0ukGB0S6d4ydZdEiM48kLx5kDV+QBPrpVnFyefL8kkQ==}
    engines: {node: '>= 0.4'}

  is-bigint@1.1.0:
    resolution: {integrity: sha512-n4ZT37wG78iz03xPRKJrHTdZbe3IicyucEtdRsV5yglwc3GyUfbAfpSeD0FJ41NbUNSt5wbhqfp1fS+BgnvDFQ==}
    engines: {node: '>= 0.4'}

  is-binary-path@2.1.0:
    resolution: {integrity: sha512-ZMERYes6pDydyuGidse7OsHxtbI7WVeUEozgR/g7rd0xUimYNlvZRE/K2MgZTjWy725IfelLeVcEM97mmtRGXw==}
    engines: {node: '>=8'}

  is-boolean-object@1.2.2:
    resolution: {integrity: sha512-wa56o2/ElJMYqjCjGkXri7it5FbebW5usLw/nPmCMs5DeZ7eziSYZhSmPRn0txqeW4LnAmQQU7FgqLpsEFKM4A==}
    engines: {node: '>= 0.4'}

  is-bun-module@2.0.0:
    resolution: {integrity: sha512-gNCGbnnnnFAUGKeZ9PdbyeGYJqewpmc2aKHUEMO5nQPWU9lOmv7jcmQIv+qHD8fXW6W7qfuCwX4rY9LNRjXrkQ==}

  is-callable@1.2.7:
    resolution: {integrity: sha512-1BC0BVFhS/p0qtw6enp8e+8OD0UrK0oFLztSjNzhcKA3WDuJxxAPXzPuPtKkjEY9UUoEWlX/8fgKeu2S8i9JTA==}
    engines: {node: '>= 0.4'}

  is-core-module@2.16.1:
    resolution: {integrity: sha512-UfoeMA6fIJ8wTYFEUjelnaGI67v6+N7qXJEvQuIGa99l4xsCruSYOVSQ0uPANn4dAzm8lkYPaKLrrijLq7x23w==}
    engines: {node: '>= 0.4'}

  is-data-view@1.0.2:
    resolution: {integrity: sha512-RKtWF8pGmS87i2D6gqQu/l7EYRlVdfzemCJN/P3UOs//x1QE7mfhvzHIApBTRf7axvT6DMGwSwBXYCT0nfB9xw==}
    engines: {node: '>= 0.4'}

  is-date-object@1.1.0:
    resolution: {integrity: sha512-PwwhEakHVKTdRNVOw+/Gyh0+MzlCl4R6qKvkhuvLtPMggI1WAHt9sOwZxQLSGpUaDnrdyDsomoRgNnCfKNSXXg==}
    engines: {node: '>= 0.4'}

  is-extglob@2.1.1:
    resolution: {integrity: sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==}
    engines: {node: '>=0.10.0'}

  is-finalizationregistry@1.1.1:
    resolution: {integrity: sha512-1pC6N8qWJbWoPtEjgcL2xyhQOP491EQjeUo3qTKcmV8YSDDJrOepfG8pcC7h/QgnQHYSv0mJ3Z/ZWxmatVrysg==}
    engines: {node: '>= 0.4'}

  is-fullwidth-code-point@3.0.0:
    resolution: {integrity: sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==}
    engines: {node: '>=8'}

  is-generator-function@1.1.0:
    resolution: {integrity: sha512-nPUB5km40q9e8UfN/Zc24eLlzdSf9OfKByBw9CIdw4H1giPMeA0OIJvbchsCu4npfI2QcMVBsGEBHKZ7wLTWmQ==}
    engines: {node: '>= 0.4'}

  is-glob@4.0.3:
    resolution: {integrity: sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==}
    engines: {node: '>=0.10.0'}

  is-map@2.0.3:
    resolution: {integrity: sha512-1Qed0/Hr2m+YqxnM09CjA2d/i6YZNfF6R2oRAOj36eUdS6qIV/huPJNSEpKbupewFs+ZsJlxsjjPbc0/afW6Lw==}
    engines: {node: '>= 0.4'}

  is-negative-zero@2.0.3:
    resolution: {integrity: sha512-5KoIu2Ngpyek75jXodFvnafB6DJgr3u8uuK0LEZJjrU19DrMD3EVERaR8sjz8CCGgpZvxPl9SuE1GMVPFHx1mw==}
    engines: {node: '>= 0.4'}

  is-number-object@1.1.1:
    resolution: {integrity: sha512-lZhclumE1G6VYD8VHe35wFaIif+CTy5SJIi5+3y4psDgWu4wPDoBhF8NxUOinEc7pHgiTsT6MaBb92rKhhD+Xw==}
    engines: {node: '>= 0.4'}

  is-number@7.0.0:
    resolution: {integrity: sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==}
    engines: {node: '>=0.12.0'}

  is-potential-custom-element-name@1.0.1:
    resolution: {integrity: sha512-bCYeRA2rVibKZd+s2625gGnGF/t7DSqDs4dP7CrLA1m7jKWz6pps0LpYLJN8Q64HtmPKJ1hrN3nzPNKFEKOUiQ==}

  is-regex@1.2.1:
    resolution: {integrity: sha512-MjYsKHO5O7mCsmRGxWcLWheFqN9DJ/2TmngvjKXihe6efViPqc274+Fx/4fYj/r03+ESvBdTXK0V6tA3rgez1g==}
    engines: {node: '>= 0.4'}

  is-set@2.0.3:
    resolution: {integrity: sha512-iPAjerrse27/ygGLxw+EBR9agv9Y6uLeYVJMu+QNCoouJ1/1ri0mGrcWpfCqFZuzzx3WjtwxG098X+n4OuRkPg==}
    engines: {node: '>= 0.4'}

  is-shared-array-buffer@1.0.4:
    resolution: {integrity: sha512-ISWac8drv4ZGfwKl5slpHG9OwPNty4jOWPRIhBpxOoD+hqITiwuipOQ2bNthAzwA3B4fIjO4Nln74N0S9byq8A==}
    engines: {node: '>= 0.4'}

  is-string@1.1.1:
    resolution: {integrity: sha512-BtEeSsoaQjlSPBemMQIrY1MY0uM6vnS1g5fmufYOtnxLGUZM2178PKbhsk7Ffv58IX+ZtcvoGwccYsh0PglkAA==}
    engines: {node: '>= 0.4'}

  is-symbol@1.1.1:
    resolution: {integrity: sha512-9gGx6GTtCQM73BgmHQXfDmLtfjjTUDSyoxTCbp5WtoixAhfgsDirWIcVQ/IHpvI5Vgd5i/J5F7B9cN/WlVbC/w==}
    engines: {node: '>= 0.4'}

  is-typed-array@1.1.15:
    resolution: {integrity: sha512-p3EcsicXjit7SaskXHs1hA91QxgTw46Fv6EFKKGS5DRFLD8yKnohjF3hxoju94b/OcMZoQukzpPpBE9uLVKzgQ==}
    engines: {node: '>= 0.4'}

  is-weakmap@2.0.2:
    resolution: {integrity: sha512-K5pXYOm9wqY1RgjpL3YTkF39tni1XajUIkawTLUo9EZEVUFga5gSQJF8nNS7ZwJQ02y+1YCNYcMh+HIf1ZqE+w==}
    engines: {node: '>= 0.4'}

  is-weakref@1.1.1:
    resolution: {integrity: sha512-6i9mGWSlqzNMEqpCp93KwRS1uUOodk2OJ6b+sq7ZPDSy2WuI5NFIxp/254TytR8ftefexkWn5xNiHUNpPOfSew==}
    engines: {node: '>= 0.4'}

  is-weakset@2.0.4:
    resolution: {integrity: sha512-mfcwb6IzQyOKTs84CQMrOwW4gQcaTOAWJ0zzJCl2WSPDrWk/OzDaImWFH3djXhb24g4eudZfLRozAvPGw4d9hQ==}
    engines: {node: '>= 0.4'}

  isarray@2.0.5:
    resolution: {integrity: sha512-xHjhDr3cNBK0BzdUJSPXZntQUx/mwMS5Rw4A7lPJ90XGAO6ISP/ePDNuo0vhqOZU+UD5JoodwCAAoZQd3FeAKw==}

  isexe@2.0.0:
    resolution: {integrity: sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==}

  iterator.prototype@1.1.5:
    resolution: {integrity: sha512-H0dkQoCa3b2VEeKQBOxFph+JAbcrQdE7KC0UkqwpLmv2EC4P41QXP+rqo9wYodACiG5/WM5s9oDApTU8utwj9g==}
    engines: {node: '>= 0.4'}

  jackspeak@3.4.3:
    resolution: {integrity: sha512-OGlZQpz2yfahA/Rd1Y8Cd9SIEsqvXkLVoSw/cgwhnhFMDbsQFeZYoJJ7bIZBS9BcamUW96asq/npPWugM+RQBw==}

  jiti@1.21.7:
    resolution: {integrity: sha512-/imKNG4EbWNrVjoNC/1H5/9GFy+tqjGBHCaSsN+P2RnPqjsLmv6UD3Ej+Kj8nBWaRAwyk7kK5ZUc+OEatnTR3A==}
    hasBin: true

  js-tokens@4.0.0:
    resolution: {integrity: sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==}

  js-tokens@9.0.1:
    resolution: {integrity: sha512-mxa9E9ITFOt0ban3j6L5MpjwegGz6lBQmM1IJkWeBZGcMxto50+eWdjC/52xDbS2vy0k7vIMK0Fe2wfL9OQSpQ==}

  js-yaml@4.1.0:
    resolution: {integrity: sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==}
    hasBin: true

  jsdom@26.1.0:
    resolution: {integrity: sha512-Cvc9WUhxSMEo4McES3P7oK3QaXldCfNWp7pl2NNeiIFlCoLr3kfq9kb1fxftiwk1FLV7CvpvDfonxtzUDeSOPg==}
    engines: {node: '>=18'}
    peerDependencies:
      canvas: ^3.0.0
    peerDependenciesMeta:
      canvas:
        optional: true

  jsesc@3.1.0:
    resolution: {integrity: sha512-/sM3dO2FOzXjKQhJuo0Q173wf2KOo8t4I8vHy6lF9poUp7bKT0/NHE8fPX23PwfhnykfqnC2xRxOnVw5XuGIaA==}
    engines: {node: '>=6'}
    hasBin: true

  json-buffer@3.0.1:
    resolution: {integrity: sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==}

  json-schema-traverse@0.4.1:
    resolution: {integrity: sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==}

  json-stable-stringify-without-jsonify@1.0.1:
    resolution: {integrity: sha512-Bdboy+l7tA3OGW6FjyFHWkP5LuByj1Tk33Ljyq0axyzdk9//JSi2u3fP1QSmd1KNwq6VOKYGlAu87CisVir6Pw==}

  json5@1.0.2:
    resolution: {integrity: sha512-g1MWMLBiz8FKi1e4w0UyVL3w+iJceWAFBAaBnnGKOpNa5f8TLktkbre1+s6oICydWAm+HRUGTmI+//xv2hvXYA==}
    hasBin: true

  json5@2.2.3:
    resolution: {integrity: sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==}
    engines: {node: '>=6'}
    hasBin: true

  jsx-ast-utils@3.3.5:
    resolution: {integrity: sha512-ZZow9HBI5O6EPgSJLUb8n2NKgmVWTwCvHGwFuJlMjvLFqlGG6pjirPhtdsseaLZjSibD8eegzmYpUZwoIlj2cQ==}
    engines: {node: '>=4.0'}

  keyv@4.5.4:
    resolution: {integrity: sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==}

  language-subtag-registry@0.3.23:
    resolution: {integrity: sha512-0K65Lea881pHotoGEa5gDlMxt3pctLi2RplBb7Ezh4rRdLEOtgi7n4EwK9lamnUCkKBqaeKRVebTq6BAxSkpXQ==}

  language-tags@1.0.9:
    resolution: {integrity: sha512-MbjN408fEndfiQXbFQ1vnd+1NoLDsnQW41410oQBXiyXDMYH5z505juWa4KUE1LqxRC7DgOgZDbKLxHIwm27hA==}
    engines: {node: '>=0.10'}

  levn@0.4.1:
    resolution: {integrity: sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==}
    engines: {node: '>= 0.8.0'}

  lilconfig@3.1.3:
    resolution: {integrity: sha512-/vlFKAoH5Cgt3Ie+JLhRbwOsCQePABiU3tJ1egGvyQ+33R/vcwM2Zl2QR/LzjsBeItPt3oSVXapn+m4nQDvpzw==}
    engines: {node: '>=14'}

  lines-and-columns@1.2.4:
    resolution: {integrity: sha512-7ylylesZQ/PV29jhEDl3Ufjo6ZX7gCqJr5F7PKrqc93v7fzSymt1BpwEU8nAUXs8qzzvqhbjhK5QZg6Mt/HkBg==}

  locate-path@6.0.0:
    resolution: {integrity: sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==}
    engines: {node: '>=10'}

  lodash.merge@4.6.2:
    resolution: {integrity: sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==}

  lodash@4.17.21:
    resolution: {integrity: sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==}

  loose-envify@1.4.0:
    resolution: {integrity: sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==}
    hasBin: true

  loupe@3.1.4:
    resolution: {integrity: sha512-wJzkKwJrheKtknCOKNEtDK4iqg/MxmZheEMtSTYvnzRdEYaZzmgH976nenp8WdJRdx5Vc1X/9MO0Oszl6ezeXg==}

  lru-cache@10.4.3:
    resolution: {integrity: sha512-JNAzZcXrCt42VGLuYz0zfAzDfAvJWW6AfYlDBQyDV5DClI2m5sAmK+OIO7s59XfsRsWHp02jAJrRadPRGTt6SQ==}

  lru-cache@5.1.1:
    resolution: {integrity: sha512-KpNARQA3Iwv+jTA0utUVVbrh+Jlrr1Fv0e56GGzAFOXN7dk/FviaDW8LHmK52DlcH4WP2n6gI8vN1aesBFgo9w==}

  lucide-react@0.454.0:
    resolution: {integrity: sha512-hw7zMDwykCLnEzgncEEjHeA6+45aeEzRYuKHuyRSOPkhko+J3ySGjGIzu+mmMfDFG1vazHepMaYFYHbTFAZAAQ==}
    peerDependencies:
      react: ^16.5.1 || ^17.0.0 || ^18.0.0 || ^19.0.0-rc

  lz-string@1.5.0:
    resolution: {integrity: sha512-h5bgJWpxJNswbU7qCrV0tIKQCaS3blPDrqKWx+QxzuzL1zGUzij9XCWLrSLsJPu5t+eWA/ycetzYAO5IOMcWAQ==}
    hasBin: true

  magic-string@0.30.17:
    resolution: {integrity: sha512-sNPKHvyjVf7gyjwS4xGTaW/mCnF8wnjtifKBEhxfZ7E/S8tQ0rssrwGNn6q8JH/ohItJfSQp9mBtQYuTlH5QnA==}

  marked@4.3.0:
    resolution: {integrity: sha512-PRsaiG84bK+AMvxziE/lCFss8juXjNaWzVbN5tXAm4XjeaS9NAHhop+PjQxz2A9h8Q4M/xGmzP8vqNwy6JeK0A==}
    engines: {node: '>= 12'}
    hasBin: true

  math-intrinsics@1.1.0:
    resolution: {integrity: sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==}
    engines: {node: '>= 0.4'}

  merge2@1.4.1:
    resolution: {integrity: sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==}
    engines: {node: '>= 8'}

  micromatch@4.0.8:
    resolution: {integrity: sha512-PXwfBhYu0hBCPw8Dn0E+WDYb7af3dSLVWKi3HGv84IdF4TyFoC0ysxFd0Goxw7nSv4T/PzEJQxsYsEiFCKo2BA==}
    engines: {node: '>=8.6'}

  mime-db@1.52.0:
    resolution: {integrity: sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==}
    engines: {node: '>= 0.6'}

  mime-types@2.1.35:
    resolution: {integrity: sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==}
    engines: {node: '>= 0.6'}

  min-indent@1.0.1:
    resolution: {integrity: sha512-I9jwMn07Sy/IwOj3zVkVik2JTvgpaykDZEigL6Rx6N9LbMywwUSMtxET+7lVoDLLd3O3IXwJwvuuns8UB/HeAg==}
    engines: {node: '>=4'}

  minimatch@3.1.2:
    resolution: {integrity: sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==}

  minimatch@9.0.5:
    resolution: {integrity: sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==}
    engines: {node: '>=16 || 14 >=14.17'}

  minimist@1.2.8:
    resolution: {integrity: sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==}

  minipass@7.1.2:
    resolution: {integrity: sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==}
    engines: {node: '>=16 || 14 >=14.17'}

  mrmime@2.0.1:
    resolution: {integrity: sha512-Y3wQdFg2Va6etvQ5I82yUhGdsKrcYox6p7FfL1LbK2J4V01F9TGlepTIhnK24t7koZibmg82KGglhA1XK5IsLQ==}
    engines: {node: '>=10'}

  ms@2.1.3:
    resolution: {integrity: sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==}

  mz@2.7.0:
    resolution: {integrity: sha512-z81GNO7nnYMEhrGh9LeymoE4+Yr0Wn5McHIZMK5cfQCl+NDX08sCZgUc9/6MHni9IWuFLm1Z3HTCXu2z9fN62Q==}

  nanoid@3.3.11:
    resolution: {integrity: sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==}
    engines: {node: ^10 || ^12 || ^13.7 || ^14 || >=15.0.1}
    hasBin: true

  napi-postinstall@0.3.0:
    resolution: {integrity: sha512-M7NqKyhODKV1gRLdkwE7pDsZP2/SC2a2vHkOYh9MCpKMbWVfyVfUw5MaH83Fv6XMjxr5jryUp3IDDL9rlxsTeA==}
    engines: {node: ^12.20.0 || ^14.18.0 || >=16.0.0}
    hasBin: true

  natural-compare@1.4.0:
    resolution: {integrity: sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==}

  next-themes@0.4.6:
    resolution: {integrity: sha512-pZvgD5L0IEvX5/9GWyHMf3m8BKiVQwsCMHfoFosXtXBMnaS0ZnIJ9ST4b4NqLVKDEm8QBxoNNGNaBv2JNF6XNA==}
    peerDependencies:
      react: ^16.8 || ^17 || ^18 || ^19 || ^19.0.0-rc
      react-dom: ^16.8 || ^17 || ^18 || ^19 || ^19.0.0-rc

  next@15.2.4:
    resolution: {integrity: sha512-VwL+LAaPSxEkd3lU2xWbgEOtrM8oedmyhBqaVNmgKB+GvZlCy9rgaEc+y2on0wv+l0oSFqLtYD6dcC1eAedUaQ==}
    engines: {node: ^18.18.0 || ^19.8.0 || >= 20.0.0}
    hasBin: true
    peerDependencies:
      '@opentelemetry/api': ^1.1.0
      '@playwright/test': ^1.41.2
      babel-plugin-react-compiler: '*'
      react: ^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0
      react-dom: ^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0
      sass: ^1.3.0
    peerDependenciesMeta:
      '@opentelemetry/api':
        optional: true
      '@playwright/test':
        optional: true
      babel-plugin-react-compiler:
        optional: true
      sass:
        optional: true

  node-releases@2.0.19:
    resolution: {integrity: sha512-xxOWJsBKtzAq7DY0J+DTzuz58K8e7sJbdgwkbMWQe8UYB6ekmsQ45q0M/tJDsGaZmbC+l7n57UV8Hl5tHxO9uw==}

  normalize-path@3.0.0:
    resolution: {integrity: sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb/mD4WYojCRwcwLA==}
    engines: {node: '>=0.10.0'}

  normalize-range@0.1.2:
    resolution: {integrity: sha512-bdok/XvKII3nUpklnV6P2hxtMNrCboOjAcyBuQnWEhO665FwrSNRxU+AqpsyvO6LgGYPspN+lu5CLtw4jPRKNA==}
    engines: {node: '>=0.10.0'}

  nwsapi@2.2.20:
    resolution: {integrity: sha512-/ieB+mDe4MrrKMT8z+mQL8klXydZWGR5Dowt4RAGKbJ3kIGEx3X4ljUo+6V73IXtUPWgfOlU5B9MlGxFO5T+cA==}

  object-assign@4.1.1:
    resolution: {integrity: sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==}
    engines: {node: '>=0.10.0'}

  object-hash@3.0.0:
    resolution: {integrity: sha512-RSn9F68PjH9HqtltsSnqYC1XXoWe9Bju5+213R98cNGttag9q9yAOTzdbsqvIa7aNm5WffBZFpWYr2aWrklWAw==}
    engines: {node: '>= 6'}

  object-inspect@1.13.4:
    resolution: {integrity: sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==}
    engines: {node: '>= 0.4'}

  object-keys@1.1.1:
    resolution: {integrity: sha512-NuAESUOUMrlIXOfHKzD6bpPu3tYt3xvjNdRIQ+FeT0lNb4K8WR70CaDxhuNguS2XG+GjkyMwOzsN5ZktImfhLA==}
    engines: {node: '>= 0.4'}

  object.assign@4.1.7:
    resolution: {integrity: sha512-nK28WOo+QIjBkDduTINE4JkF/UJJKyf2EJxvJKfblDpyg0Q+pkOHNTL0Qwy6NP6FhE/EnzV73BxxqcJaXY9anw==}
    engines: {node: '>= 0.4'}

  object.entries@1.1.9:
    resolution: {integrity: sha512-8u/hfXFRBD1O0hPUjioLhoWFHRmt6tKA4/vZPyckBr18l1KE9uHrFaFaUi8MDRTpi4uak2goyPTSNJLXX2k2Hw==}
    engines: {node: '>= 0.4'}

  object.fromentries@2.0.8:
    resolution: {integrity: sha512-k6E21FzySsSK5a21KRADBd/NGneRegFO5pLHfdQLpRDETUNJueLXs3WCzyQ3tFRDYgbq3KHGXfTbi2bs8WQ6rQ==}
    engines: {node: '>= 0.4'}

  object.groupby@1.0.3:
    resolution: {integrity: sha512-+Lhy3TQTuzXI5hevh8sBGqbmurHbbIjAi0Z4S63nthVLmLxfbj4T54a4CfZrXIrt9iP4mVAPYMo/v99taj3wjQ==}
    engines: {node: '>= 0.4'}

  object.values@1.2.1:
    resolution: {integrity: sha512-gXah6aZrcUxjWg2zR2MwouP2eHlCBzdV4pygudehaKXSGW4v2AsRQUK+lwwXhii6KFZcunEnmSUoYp5CXibxtA==}
    engines: {node: '>= 0.4'}

  optionator@0.9.4:
    resolution: {integrity: sha512-6IpQ7mKUxRcZNLIObR0hz7lxsapSSIYNZJwXPGeF0mTVqGKFIXj1DQcMoT22S3ROcLyY/rz0PWaWZ9ayWmad9g==}
    engines: {node: '>= 0.8.0'}

  own-keys@1.0.1:
    resolution: {integrity: sha512-qFOyK5PjiWZd+QQIh+1jhdb9LpxTF0qs7Pm8o5QHYZ0M3vKqSqzsZaEB6oWlxZ+q2sJBMI/Ktgd2N5ZwQoRHfg==}
    engines: {node: '>= 0.4'}

  p-limit@3.1.0:
    resolution: {integrity: sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==}
    engines: {node: '>=10'}

  p-locate@5.0.0:
    resolution: {integrity: sha512-LaNjtRWUBY++zB5nE/NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X/tl/QYq3TIeE6nxHppbo2LGymrG5Pw==}
    engines: {node: '>=10'}

  package-json-from-dist@1.0.1:
    resolution: {integrity: sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw==}

  parent-module@1.0.1:
    resolution: {integrity: sha512-GQ2EWRpQV8/o+Aw8YqtfZZPfNRWZYkbidE9k5rpl/hC3vtHHBfGm2Ifi6qWV+coDGkrUKZAxE3Lot5kcsRlh+g==}
    engines: {node: '>=6'}

  parse5@7.3.0:
    resolution: {integrity: sha512-IInvU7fabl34qmi9gY8XOVxhYyMyuH2xUNpb2q8/Y+7552KlejkRvqvD19nMoUW/uQGGbqNpA6Tufu5FL5BZgw==}

  path-exists@4.0.0:
    resolution: {integrity: sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc/ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7/w==}
    engines: {node: '>=8'}

  path-key@3.1.1:
    resolution: {integrity: sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==}
    engines: {node: '>=8'}

  path-parse@1.0.7:
    resolution: {integrity: sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==}

  path-scurry@1.11.1:
    resolution: {integrity: sha512-Xa4Nw17FS9ApQFJ9umLiJS4orGjm7ZzwUrwamcGQuHSzDyth9boKDaycYdDcZDuqYATXw4HFXgaqWTctW/v1HA==}
    engines: {node: '>=16 || 14 >=14.18'}

  pathe@2.0.3:
    resolution: {integrity: sha512-WUjGcAqP1gQacoQe+OBJsFA7Ld4DyXuUIjZ5cc75cLHvJ7dtNsTugphxIADwspS+AraAUePCKrSVtPLFj/F88w==}

  pathval@2.0.1:
    resolution: {integrity: sha512-//nshmD55c46FuFw26xV/xFAaB5HF9Xdap7HJBBnrKdAd6/GxDBaNA1870O79+9ueg61cZLSVc+OaFlfmObYVQ==}
    engines: {node: '>= 14.16'}

  picocolors@1.1.1:
    resolution: {integrity: sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==}

  picomatch@2.3.1:
    resolution: {integrity: sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==}
    engines: {node: '>=8.6'}

  picomatch@4.0.2:
    resolution: {integrity: sha512-M7BAV6Rlcy5u+m6oPhAPFgJTzAioX/6B0DxyvDlo9l8+T3nLKbrczg2WLUyzd45L8RqfUMyGPzekbMvX2Ldkwg==}
    engines: {node: '>=12'}

  pify@2.3.0:
    resolution: {integrity: sha512-udgsAY+fTnvv7kI7aaxbqwWNb0AHiB0qBO89PZKPkoTmGOgdbrHDKD+0B2X4uTfJ/FT1R09r9gTsjUjNJotuog==}
    engines: {node: '>=0.10.0'}

  pirates@4.0.7:
    resolution: {integrity: sha512-TfySrs/5nm8fQJDcBDuUng3VOUKsd7S+zqvbOTiGXHfxX4wK31ard+hoNuvkicM/2YFzlpDgABOevKSsB4G/FA==}
    engines: {node: '>= 6'}

  playwright-core@1.53.2:
    resolution: {integrity: sha512-ox/OytMy+2w1jcYEYlOo1Hhp8hZkLCximMTUTMBXjGUA1KoFfiSZ+DU+3a739jsPY0yoKH2TFy9S2fsJas8yAw==}
    engines: {node: '>=18'}
    hasBin: true

  playwright@1.53.2:
    resolution: {integrity: sha512-6K/qQxVFuVQhRQhFsVZ9fGeatxirtrpPgxzBYWyZLEXJzqYwuL4fuNmfOfD5et1tJE4GScKyPNeLhZeRwuTU3A==}
    engines: {node: '>=18'}
    hasBin: true

  possible-typed-array-names@1.1.0:
    resolution: {integrity: sha512-/+5VFTchJDoVj3bhoqi6UeymcD00DAwb1nJwamzPvHEszJ4FpF6SNNbUbOS8yI56qHzdV8eK0qEfOSiodkTdxg==}
    engines: {node: '>= 0.4'}

  postcss-import@15.1.0:
    resolution: {integrity: sha512-hpr+J05B2FVYUAXHeK1YyI267J/dDDhMU6B6civm8hSY1jYJnBXxzKDKDswzJmtLHryrjhnDjqqp/49t8FALew==}
    engines: {node: '>=14.0.0'}
    peerDependencies:
      postcss: ^8.0.0

  postcss-js@4.0.1:
    resolution: {integrity: sha512-dDLF8pEO191hJMtlHFPRa8xsizHaM82MLfNkUHdUtVEV3tgTp5oj+8qbEqYM57SLfc74KSbw//4SeJma2LRVIw==}
    engines: {node: ^12 || ^14 || >= 16}
    peerDependencies:
      postcss: ^8.4.21

  postcss-load-config@4.0.2:
    resolution: {integrity: sha512-bSVhyJGL00wMVoPUzAVAnbEoWyqRxkjv64tUl427SKnPrENtq6hJwUojroMz2VB+Q1edmi4IfrAPpami5VVgMQ==}
    engines: {node: '>= 14'}
    peerDependencies:
      postcss: '>=8.0.9'
      ts-node: '>=9.0.0'
    peerDependenciesMeta:
      postcss:
        optional: true
      ts-node:
        optional: true

  postcss-nested@6.2.0:
    resolution: {integrity: sha512-HQbt28KulC5AJzG+cZtj9kvKB93CFCdLvog1WFLf1D+xmMvPGlBstkpTEZfK5+AN9hfJocyBFCNiqyS48bpgzQ==}
    engines: {node: '>=12.0'}
    peerDependencies:
      postcss: ^8.2.14

  postcss-selector-parser@6.1.2:
    resolution: {integrity: sha512-Q8qQfPiZ+THO/3ZrOrO0cJJKfpYCagtMUkXbnEfmgUjwXg6z/WBeOyS9APBBPCTSiDV+s4SwQGu8yFsiMRIudg==}
    engines: {node: '>=4'}

  postcss-value-parser@4.2.0:
    resolution: {integrity: sha512-1NNCs6uurfkVbeXG4S8JFT9t19m45ICnif8zWLd5oPSZ50QnwMfK+H3jv408d4jw/7Bttv5axS5IiHoLaVNHeQ==}

  postcss@8.4.31:
    resolution: {integrity: sha512-PS08Iboia9mts/2ygV3eLpY5ghnUcfLV/EXTOW1E2qYxJKGGBUtNjN76FYHnMs36RmARn41bC0AZmn+rR0OVpQ==}
    engines: {node: ^10 || ^12 || >=14}

  postcss@8.5.6:
    resolution: {integrity: sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==}
    engines: {node: ^10 || ^12 || >=14}

  prelude-ls@1.2.1:
    resolution: {integrity: sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==}
    engines: {node: '>= 0.8.0'}

  pretty-format@27.5.1:
    resolution: {integrity: sha512-Qb1gy5OrP5+zDf2Bvnzdl3jsTf1qXVMazbvCoKhtKqVs4/YK4ozX4gKQJJVyNe+cajNPn0KoC0MC3FUmaHWEmQ==}
    engines: {node: ^10.13.0 || ^12.13.0 || ^14.15.0 || >=15.0.0}

  prop-types@15.8.1:
    resolution: {integrity: sha512-oj87CgZICdulUohogVAR7AjlC0327U4el4L6eAvOqCeudMDVU0NThNaV+b9Df4dXgSP1gXMTnPdhfe/2qDH5cg==}

  proxy-from-env@1.1.0:
    resolution: {integrity: sha512-D+zkORCbA9f1tdWRK0RaCR3GPv50cMxcrz4X8k5LTSUD1Dkw47mKJEZQNunItRTkWwgtaUSo1RVFRIG9ZXiFYg==}

  punycode@2.3.1:
    resolution: {integrity: sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==}
    engines: {node: '>=6'}

  queue-microtask@1.2.3:
    resolution: {integrity: sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==}

  react-day-picker@8.10.1:
    resolution: {integrity: sha512-TMx7fNbhLk15eqcMt+7Z7S2KF7mfTId/XJDjKE8f+IUcFn0l08/kI4FiYTL/0yuOLmEcbR4Fwe3GJf/NiiMnPA==}
    peerDependencies:
      date-fns: ^2.28.0 || ^3.0.0
      react: ^16.8.0 || ^17.0.0 || ^18.0.0

  react-dom@19.1.0:
    resolution: {integrity: sha512-Xs1hdnE+DyKgeHJeJznQmYMIBG3TKIHJJT95Q58nHLSrElKlGQqDTR2HQ9fx5CN/Gk6Vh/kupBTDLU11/nDk/g==}
    peerDependencies:
      react: ^19.1.0

  react-hook-form@7.59.0:
    resolution: {integrity: sha512-kmkek2/8grqarTJExFNjy+RXDIP8yM+QTl3QL6m6Q8b2bih4ltmiXxH7T9n+yXNK477xPh5yZT/6vD8sYGzJTA==}
    engines: {node: '>=18.0.0'}
    peerDependencies:
      react: ^16.8.0 || ^17 || ^18 || ^19

  react-is@16.13.1:
    resolution: {integrity: sha512-24e6ynE2H+OKt4kqsOvNd8kBpV65zoxbA4BVsEOB3ARVWQki/DHzaUoC5KuON/BiccDaCCTZBuOcfZs70kR8bQ==}

  react-is@17.0.2:
    resolution: {integrity: sha512-w2GsyukL62IJnlaff/nRegPQR94C/XXamvMWmSHRJ4y7Ts/4ocGRmTHvOs8PSE6pB3dWOrD/nueuU5sduBsQ4w==}

  react-is@18.3.1:
    resolution: {integrity: sha512-/LLMVyas0ljjAtoYiPqYiL8VWXzUUdThrmU5+n20DZv+a+ClRoevUzw5JxU+Ieh5/c87ytoTBV9G1FiKfNJdmg==}

  react-refresh@0.17.0:
    resolution: {integrity: sha512-z6F7K9bV85EfseRCp2bzrpyQ0Gkw1uLoCel9XBVWPg/TjRj94SkJzUTGfOa4bs7iJvBWtQG0Wq7wnI0syw3EBQ==}
    engines: {node: '>=0.10.0'}

  react-remove-scroll-bar@2.3.8:
    resolution: {integrity: sha512-9r+yi9+mgU33AKcj6IbT9oRCO78WriSj6t/cF8DWBZJ9aOGPOTEDvdUDz1FwKim7QXWwmHqtdHnRJfhAxEG46Q==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0
    peerDependenciesMeta:
      '@types/react':
        optional: true

  react-remove-scroll@2.7.1:
    resolution: {integrity: sha512-HpMh8+oahmIdOuS5aFKKY6Pyog+FNaZV/XyJOq7b4YFwsFHe5yYfdbIalI4k3vU2nSDql7YskmUseHsRrJqIPA==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  react-resizable-panels@2.1.9:
    resolution: {integrity: sha512-z77+X08YDIrgAes4jl8xhnUu1LNIRp4+E7cv4xHmLOxxUPO/ML7PSrE813b90vj7xvQ1lcf7g2uA9GeMZonjhQ==}
    peerDependencies:
      react: ^16.14.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
      react-dom: ^16.14.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc

  react-simplemde-editor@5.2.0:
    resolution: {integrity: sha512-GkTg1MlQHVK2Rks++7sjuQr/GVS/xm6y+HchZ4GPBWrhcgLieh4CjK04GTKbsfYorSRYKa0n37rtNSJmOzEDkQ==}
    peerDependencies:
      easymde: '>= 2.0.0 < 3.0.0'
      react: '>=16.8.2'
      react-dom: '>=16.8.2'

  react-smooth@4.0.4:
    resolution: {integrity: sha512-gnGKTpYwqL0Iii09gHobNolvX4Kiq4PKx6eWBCYYix+8cdw+cGo3do906l1NBPKkSWx1DghC1dlWG9L2uGd61Q==}
    peerDependencies:
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0
      react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0

  react-style-singleton@2.2.3:
    resolution: {integrity: sha512-b6jSvxvVnyptAiLjbkWLE/lOnR4lfTtDAl+eUC7RZy+QQWc6wRzIV2CE6xBuMmDxc2qIihtDCZD5NPOFl7fRBQ==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  react-transition-group@4.4.5:
    resolution: {integrity: sha512-pZcd1MCJoiKiBR2NRxeCRg13uCXbydPnmB4EOeRrY7480qNWO8IIgQG6zlDkm6uRMsURXPuKq0GWtiM59a5Q6g==}
    peerDependencies:
      react: '>=16.6.0'
      react-dom: '>=16.6.0'

  react@19.1.0:
    resolution: {integrity: sha512-FS+XFBNvn3GTAWq26joslQgWNoFu08F4kl0J4CgdNKADkdSGXQyTCnKteIAJy96Br6YbpEU1LSzV5dYtjMkMDg==}
    engines: {node: '>=0.10.0'}

  read-cache@1.0.0:
    resolution: {integrity: sha512-Owdv/Ft7IjOgm/i0xvNDZ1LrRANRfew4b2prF3OWMQLxLfu3bS8FVhCsrSCMK4lR56Y9ya+AThoTpDCTxCmpRA==}

  readdirp@3.6.0:
    resolution: {integrity: sha512-hOS089on8RduqdbhvQ5Z37A0ESjsqz6qnRcffsMU3495FuTdqSm+7bhJ29JvIOsBDEEnan5DPu9t3To9VRlMzA==}
    engines: {node: '>=8.10.0'}

  recharts-scale@0.4.5:
    resolution: {integrity: sha512-kivNFO+0OcUNu7jQquLXAxz1FIwZj8nrj+YkOKc5694NbjCvcT6aSZiIzNzd2Kul4o4rTto8QVR9lMNtxD4G1w==}

  recharts@2.15.0:
    resolution: {integrity: sha512-cIvMxDfpAmqAmVgc4yb7pgm/O1tmmkl/CjrvXuW+62/+7jj/iF9Ykm+hb/UJt42TREHMyd3gb+pkgoa2MxgDIw==}
    engines: {node: '>=14'}
    peerDependencies:
      react: ^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0
      react-dom: ^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0

  redent@3.0.0:
    resolution: {integrity: sha512-6tDA8g98We0zd0GvVeMT9arEOnTw9qM03L9cJXaCjrip1OO764RDBLBfrB4cwzNGDj5OA5ioymC9GkizgWJDUg==}
    engines: {node: '>=8'}

  reflect.getprototypeof@1.0.10:
    resolution: {integrity: sha512-00o4I+DVrefhv+nX0ulyi3biSHCPDe+yLv5o/p6d/UVlirijB8E16FtfwSAi4g3tcqrQ4lRAqQSoFEZJehYEcw==}
    engines: {node: '>= 0.4'}

  regexp.prototype.flags@1.5.4:
    resolution: {integrity: sha512-dYqgNSZbDwkaJ2ceRd9ojCGjBq+mOm9LmtXnAnEGyHhN/5R7iDW2TRw3h+o/jCFxus3P2LfWIIiwowAjANm7IA==}
    engines: {node: '>= 0.4'}

  resolve-from@4.0.0:
    resolution: {integrity: sha512-pb/MYmXstAkysRFx8piNI1tGFNQIFA3vkE3Gq4EuA1dF6gHp/+vgZqsCGJapvy8N3Q+4o7FwvquPJcnZ7RYy4g==}
    engines: {node: '>=4'}

  resolve-pkg-maps@1.0.0:
    resolution: {integrity: sha512-seS2Tj26TBVOC2NIc2rOe2y2ZO7efxITtLZcGSOnHHNOQ7CkiUBfw0Iw2ck6xkIhPwLhKNLS8BO+hEpngQlqzw==}

  resolve@1.22.10:
    resolution: {integrity: sha512-NPRy+/ncIMeDlTAsuqwKIiferiawhefFJtkNSW0qZJEqMEb+qBt/77B/jGeeek+F0uOeN05CDa6HXbbIgtVX4w==}
    engines: {node: '>= 0.4'}
    hasBin: true

  resolve@2.0.0-next.5:
    resolution: {integrity: sha512-U7WjGVG9sH8tvjW5SmGbQuui75FiyjAX72HX15DwBBwF9dNiQZRQAg9nnPhYy+TUnE0+VcrttuvNI8oSxZcocA==}
    hasBin: true

  reusify@1.1.0:
    resolution: {integrity: sha512-g6QUff04oZpHs0eG5p83rFLhHeV00ug/Yf9nZM6fLeUrPguBTkTQOdpAWWspMh55TZfVQDPaN3NQJfbVRAxdIw==}
    engines: {iojs: '>=1.0.0', node: '>=0.10.0'}

  rollup@4.44.1:
    resolution: {integrity: sha512-x8H8aPvD+xbl0Do8oez5f5o8eMS3trfCghc4HhLAnCkj7Vl0d1JWGs0UF/D886zLW2rOj2QymV/JcSSsw+XDNg==}
    engines: {node: '>=18.0.0', npm: '>=8.0.0'}
    hasBin: true

  rrweb-cssom@0.8.0:
    resolution: {integrity: sha512-guoltQEx+9aMf2gDZ0s62EcV8lsXR+0w8915TC3ITdn2YueuNjdAYh/levpU9nFaoChh9RUS5ZdQMrKfVEN9tw==}

  run-parallel@1.2.0:
    resolution: {integrity: sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==}

  safe-array-concat@1.1.3:
    resolution: {integrity: sha512-AURm5f0jYEOydBj7VQlVvDrjeFgthDdEF5H1dP+6mNpoXOMo1quQqJ4wvJDyRZ9+pO3kGWoOdmV08cSv2aJV6Q==}
    engines: {node: '>=0.4'}

  safe-push-apply@1.0.0:
    resolution: {integrity: sha512-iKE9w/Z7xCzUMIZqdBsp6pEQvwuEebH4vdpjcDWnyzaI6yl6O9FHvVpmGelvEHNsoY6wGblkxR6Zty/h00WiSA==}
    engines: {node: '>= 0.4'}

  safe-regex-test@1.1.0:
    resolution: {integrity: sha512-x/+Cz4YrimQxQccJf5mKEbIa1NzeCRNI5Ecl/ekmlYaampdNLPalVyIcCZNNH3MvmqBugV5TMYZXv0ljslUlaw==}
    engines: {node: '>= 0.4'}

  safer-buffer@2.1.2:
    resolution: {integrity: sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==}

  saxes@6.0.0:
    resolution: {integrity: sha512-xAg7SOnEhrm5zI3puOOKyy1OMcMlIJZYNJY7xLBwSze0UjhPLnWfj2GF2EpT0jmzaJKIWKHLsaSSajf35bcYnA==}
    engines: {node: '>=v12.22.7'}

  scheduler@0.26.0:
    resolution: {integrity: sha512-NlHwttCI/l5gCPR3D1nNXtWABUmBwvZpEQiD4IXSbIDq8BzLIK/7Ir5gTFSGZDUu37K5cMNp0hFtzO38sC7gWA==}

  semver@6.3.1:
    resolution: {integrity: sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==}
    hasBin: true

  semver@7.7.2:
    resolution: {integrity: sha512-RF0Fw+rO5AMf9MAyaRXI4AV0Ulj5lMHqVxxdSgiVbixSCXoEmmX/jk0CuJw4+3SqroYO9VoUh+HcuJivvtJemA==}
    engines: {node: '>=10'}
    hasBin: true

  set-function-length@1.2.2:
    resolution: {integrity: sha512-pgRc4hJ4/sNjWCSS9AmnS40x3bNMDTknHgL5UaMBTMyJnU90EgWh1Rz+MC9eFu4BuN/UwZjKQuY/1v3rM7HMfg==}
    engines: {node: '>= 0.4'}

  set-function-name@2.0.2:
    resolution: {integrity: sha512-7PGFlmtwsEADb0WYyvCMa1t+yke6daIG4Wirafur5kcf+MhUnPms1UeR0CKQdTZD81yESwMHbtn+TR+dMviakQ==}
    engines: {node: '>= 0.4'}

  set-proto@1.0.0:
    resolution: {integrity: sha512-RJRdvCo6IAnPdsvP/7m6bsQqNnn1FCBX5ZNtFL98MmFF/4xAIJTIg1YbHW5DC2W5SKZanrC6i4HsJqlajw/dZw==}
    engines: {node: '>= 0.4'}

  sharp@0.33.5:
    resolution: {integrity: sha512-haPVm1EkS9pgvHrQ/F3Xy+hgcuMV0Wm9vfIBSiwZ05k+xgb0PkBQpGsAA/oWdDobNaZTH5ppvHtzCFbnSEwHVw==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}

  shebang-command@2.0.0:
    resolution: {integrity: sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==}
    engines: {node: '>=8'}

  shebang-regex@3.0.0:
    resolution: {integrity: sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==}
    engines: {node: '>=8'}

  side-channel-list@1.0.0:
    resolution: {integrity: sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==}
    engines: {node: '>= 0.4'}

  side-channel-map@1.0.1:
    resolution: {integrity: sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==}
    engines: {node: '>= 0.4'}

  side-channel-weakmap@1.0.2:
    resolution: {integrity: sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==}
    engines: {node: '>= 0.4'}

  side-channel@1.1.0:
    resolution: {integrity: sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==}
    engines: {node: '>= 0.4'}

  siginfo@2.0.0:
    resolution: {integrity: sha512-ybx0WO1/8bSBLEWXZvEd7gMW3Sn3JFlW3TvX1nREbDLRNQNaeNN8WK0meBwPdAaOI7TtRRRJn/Es1zhrrCHu7g==}

  signal-exit@4.1.0:
    resolution: {integrity: sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==}
    engines: {node: '>=14'}

  simple-swizzle@0.2.2:
    resolution: {integrity: sha512-JA//kQgZtbuY83m+xT+tXJkmJncGMTFT+C+g2h2R9uxkYIrE2yy9sgmcLhCnw57/WSD+Eh3J97FPEDFnbXnDUg==}

  sirv@3.0.1:
    resolution: {integrity: sha512-FoqMu0NCGBLCcAkS1qA+XJIQTR6/JHfQXl+uGteNCQ76T91DMUjPa9xfmeqMY3z80nLSg9yQmNjK0Px6RWsH/A==}
    engines: {node: '>=18'}

  sonner@1.7.4:
    resolution: {integrity: sha512-DIS8z4PfJRbIyfVFDVnK9rO3eYDtse4Omcm6bt0oEr5/jtLgysmjuBl1frJ9E/EQZrFmKx2A8m/s5s9CRXIzhw==}
    peerDependencies:
      react: ^18.0.0 || ^19.0.0 || ^19.0.0-rc
      react-dom: ^18.0.0 || ^19.0.0 || ^19.0.0-rc

  source-map-js@1.2.1:
    resolution: {integrity: sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==}
    engines: {node: '>=0.10.0'}

  stable-hash@0.0.5:
    resolution: {integrity: sha512-+L3ccpzibovGXFK+Ap/f8LOS0ahMrHTf3xu7mMLSpEGU0EO9ucaysSylKo9eRDFNhWve/y275iPmIZ4z39a9iA==}

  stackback@0.0.2:
    resolution: {integrity: sha512-1XMJE5fQo1jGH6Y/7ebnwPOBEkIEnT4QF32d5R1+VXdXveM0IBMJt8zfaxX1P3QhVwrYe+576+jkANtSS2mBbw==}

  std-env@3.9.0:
    resolution: {integrity: sha512-UGvjygr6F6tpH7o2qyqR6QYpwraIjKSdtzyBdyytFOHmPZY917kwdwLG0RbOjWOnKmnm3PeHjaoLLMie7kPLQw==}

  stop-iteration-iterator@1.1.0:
    resolution: {integrity: sha512-eLoXW/DHyl62zxY4SCaIgnRhuMr6ri4juEYARS8E6sCEqzKpOiE521Ucofdx+KnDZl5xmvGYaaKCk5FEOxJCoQ==}
    engines: {node: '>= 0.4'}

  streamsearch@1.1.0:
    resolution: {integrity: sha512-Mcc5wHehp9aXz1ax6bZUyY5afg9u2rv5cqQI3mRrYkGC8rW2hM02jWuwjtL++LS5qinSyhj2QfLyNsuc+VsExg==}
    engines: {node: '>=10.0.0'}

  string-width@4.2.3:
    resolution: {integrity: sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==}
    engines: {node: '>=8'}

  string-width@5.1.2:
    resolution: {integrity: sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==}
    engines: {node: '>=12'}

  string.prototype.includes@2.0.1:
    resolution: {integrity: sha512-o7+c9bW6zpAdJHTtujeePODAhkuicdAryFsfVKwA+wGw89wJ4GTY484WTucM9hLtDEOpOvI+aHnzqnC5lHp4Rg==}
    engines: {node: '>= 0.4'}

  string.prototype.matchall@4.0.12:
    resolution: {integrity: sha512-6CC9uyBL+/48dYizRf7H7VAYCMCNTBeM78x/VTUe9bFEaxBepPJDa1Ow99LqI/1yF7kuy7Q3cQsYMrcjGUcskA==}
    engines: {node: '>= 0.4'}

  string.prototype.repeat@1.0.0:
    resolution: {integrity: sha512-0u/TldDbKD8bFCQ/4f5+mNRrXwZ8hg2w7ZR8wa16e8z9XpePWl3eGEcUD0OXpEH/VJH/2G3gjUtR3ZOiBe2S/w==}

  string.prototype.trim@1.2.10:
    resolution: {integrity: sha512-Rs66F0P/1kedk5lyYyH9uBzuiI/kNRmwJAR9quK6VOtIpZ2G+hMZd+HQbbv25MgCA6gEffoMZYxlTod4WcdrKA==}
    engines: {node: '>= 0.4'}

  string.prototype.trimend@1.0.9:
    resolution: {integrity: sha512-G7Ok5C6E/j4SGfyLCloXTrngQIQU3PWtXGst3yM7Bea9FRURf1S42ZHlZZtsNque2FN2PoUhfZXYLNWwEr4dLQ==}
    engines: {node: '>= 0.4'}

  string.prototype.trimstart@1.0.8:
    resolution: {integrity: sha512-UXSH262CSZY1tfu3G3Secr6uGLCFVPMhIqHjlgCUtCCcgihYc/xKs9djMTMUOb2j1mVSeU8EU6NWc/iQKU6Gfg==}
    engines: {node: '>= 0.4'}

  strip-ansi@6.0.1:
    resolution: {integrity: sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==}
    engines: {node: '>=8'}

  strip-ansi@7.1.0:
    resolution: {integrity: sha512-iq6eVVI64nQQTRYq2KtEg2d2uU7LElhTJwsH4YzIHZshxlgZms/wIc4VoDQTlG/IvVIrBKG06CrZnp0qv7hkcQ==}
    engines: {node: '>=12'}

  strip-bom@3.0.0:
    resolution: {integrity: sha512-vavAMRXOgBVNF6nyEEmL3DBK19iRpDcoIwW+swQ+CbGiu7lju6t+JklA1MHweoWtadgt4ISVUsXLyDq34ddcwA==}
    engines: {node: '>=4'}

  strip-indent@3.0.0:
    resolution: {integrity: sha512-laJTa3Jb+VQpaC6DseHhF7dXVqHTfJPCRDaEbid/drOhgitgYku/letMUqOXFoWV0zIIUbjpdH2t+tYj4bQMRQ==}
    engines: {node: '>=8'}

  strip-json-comments@3.1.1:
    resolution: {integrity: sha512-6fPc+R4ihwqP6N/aIv2f1gMH8lOVtWQHoqC4yK6oSDVVocumAsfCqjkXnqiYMhmMwS/mEHLp7Vehlt3ql6lEig==}
    engines: {node: '>=8'}

  strip-literal@3.0.0:
    resolution: {integrity: sha512-TcccoMhJOM3OebGhSBEmp3UZ2SfDMZUEBdRA/9ynfLi8yYajyWX3JiXArcJt4Umh4vISpspkQIY8ZZoCqjbviA==}

  styled-jsx@5.1.6:
    resolution: {integrity: sha512-qSVyDTeMotdvQYoHWLNGwRFJHC+i+ZvdBRYosOFgC+Wg1vx4frN2/RG/NA7SYqqvKNLf39P2LSRA2pu6n0XYZA==}
    engines: {node: '>= 12.0.0'}
    peerDependencies:
      '@babel/core': '*'
      babel-plugin-macros: '*'
      react: '>= 16.8.0 || 17.x.x || ^18.0.0-0 || ^19.0.0-0'
    peerDependenciesMeta:
      '@babel/core':
        optional: true
      babel-plugin-macros:
        optional: true

  sucrase@3.35.0:
    resolution: {integrity: sha512-8EbVDiu9iN/nESwxeSxDKe0dunta1GOlHufmSSXxMD2z2/tMZpDMpvXQGsc+ajGo8y2uYUmixaSRUc/QPoQ0GA==}
    engines: {node: '>=16 || 14 >=14.17'}
    hasBin: true

  supports-color@7.2.0:
    resolution: {integrity: sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==}
    engines: {node: '>=8'}

  supports-preserve-symlinks-flag@1.0.0:
    resolution: {integrity: sha512-ot0WnXS9fgdkgIcePe6RHNk1WA8+muPa6cSjeR3V8K27q9BB1rTE3R1p7Hv0z1ZyAc8s6Vvv8DIyWf681MAt0w==}
    engines: {node: '>= 0.4'}

  symbol-tree@3.2.4:
    resolution: {integrity: sha512-9QNk5KwDF+Bvz+PyObkmSYjI5ksVUYtjW7AU22r2NKcfLJcXp96hkDWU3+XndOsUb+AQ9QhfzfCT2O+CNWT5Tw==}

  tailwind-merge@2.6.0:
    resolution: {integrity: sha512-P+Vu1qXfzediirmHOC3xKGAYeZtPcV9g76X+xg2FD4tYgR71ewMA35Y3sCz3zhiN/dwefRpJX0yBcgwi1fXNQA==}

  tailwindcss-animate@1.0.7:
    resolution: {integrity: sha512-bl6mpH3T7I3UFxuvDEXLxy/VuFxBk5bbzplh7tXI68mwMokNYd1t9qPBHlnyTwfa4JGC4zP516I1hYYtQ/vspA==}
    peerDependencies:
      tailwindcss: '>=3.0.0 || insiders'

  tailwindcss@3.4.17:
    resolution: {integrity: sha512-w33E2aCvSDP0tW9RZuNXadXlkHXqFzSkQew/aIa2i/Sj8fThxwovwlXHSPXTbAHwEIhBFXAedUhP2tueAKP8Og==}
    engines: {node: '>=14.0.0'}
    hasBin: true

  thenify-all@1.6.0:
    resolution: {integrity: sha512-RNxQH/qI8/t3thXJDwcstUO4zeqo64+Uy/+sNVRBx4Xn2OX+OZ9oP+iJnNFqplFra2ZUVeKCSa2oVWi3T4uVmA==}
    engines: {node: '>=0.8'}

  thenify@3.3.1:
    resolution: {integrity: sha512-RVZSIV5IG10Hk3enotrhvz0T9em6cyHBLkH/YAZuKqd8hRkKhSfCGIcP2KUY0EPxndzANBmNllzWPwak+bheSw==}

  tiny-invariant@1.3.3:
    resolution: {integrity: sha512-+FbBPE1o9QAYvviau/qC5SE3caw21q3xkvWKBtja5vgqOWIHHJ3ioaq1VPfn/Szqctz2bU/oYeKd9/z5BL+PVg==}

  tinybench@2.9.0:
    resolution: {integrity: sha512-0+DUvqWMValLmha6lr4kD8iAMK1HzV0/aKnCtWb9v9641TnP/MFb7Pc2bxoxQjTXAErryXVgUOfv2YqNllqGeg==}

  tinyexec@0.3.2:
    resolution: {integrity: sha512-KQQR9yN7R5+OSwaK0XQoj22pwHoTlgYqmUscPYoknOoWCWfj/5/ABTMRi69FrKU5ffPVh5QcFikpWJI/P1ocHA==}

  tinyglobby@0.2.14:
    resolution: {integrity: sha512-tX5e7OM1HnYr2+a2C/4V0htOcSQcoSTH9KgJnVvNm5zm/cyEWKJ7j7YutsH9CxMdtOkkLFy2AHrMci9IM8IPZQ==}
    engines: {node: '>=12.0.0'}

  tinypool@1.1.1:
    resolution: {integrity: sha512-Zba82s87IFq9A9XmjiX5uZA/ARWDrB03OHlq+Vw1fSdt0I+4/Kutwy8BP4Y/y/aORMo61FQ0vIb5j44vSo5Pkg==}
    engines: {node: ^18.0.0 || >=20.0.0}

  tinyrainbow@2.0.0:
    resolution: {integrity: sha512-op4nsTR47R6p0vMUUoYl/a+ljLFVtlfaXkLQmqfLR1qHma1h/ysYk4hEXZ880bf2CYgTskvTa/e196Vd5dDQXw==}
    engines: {node: '>=14.0.0'}

  tinyspy@4.0.3:
    resolution: {integrity: sha512-t2T/WLB2WRgZ9EpE4jgPJ9w+i66UZfDc8wHh0xrwiRNN+UwH98GIJkTeZqX9rg0i0ptwzqW+uYeIF0T4F8LR7A==}
    engines: {node: '>=14.0.0'}

  tldts-core@6.1.86:
    resolution: {integrity: sha512-Je6p7pkk+KMzMv2XXKmAE3McmolOQFdxkKw0R8EYNr7sELW46JqnNeTX8ybPiQgvg1ymCoF8LXs5fzFaZvJPTA==}

  tldts@6.1.86:
    resolution: {integrity: sha512-WMi/OQ2axVTf/ykqCQgXiIct+mSQDFdH2fkwhPwgEwvJ1kSzZRiinb0zF2Xb8u4+OqPChmyI6MEu4EezNJz+FQ==}
    hasBin: true

  to-regex-range@5.0.1:
    resolution: {integrity: sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==}
    engines: {node: '>=8.0'}

  totalist@3.0.1:
    resolution: {integrity: sha512-sf4i37nQ2LBx4m3wB74y+ubopq6W/dIzXg0FDGjsYnZHVa1Da8FH853wlL2gtUhg+xJXjfk3kUZS3BRoQeoQBQ==}
    engines: {node: '>=6'}

  tough-cookie@5.1.2:
    resolution: {integrity: sha512-FVDYdxtnj0G6Qm/DhNPSb8Ju59ULcup3tuJxkFb5K8Bv2pUXILbf0xZWU8PX8Ov19OXljbUyveOFwRMwkXzO+A==}
    engines: {node: '>=16'}

  tr46@5.1.1:
    resolution: {integrity: sha512-hdF5ZgjTqgAntKkklYw0R03MG2x/bSzTtkxmIRw/sTNV8YXsCJ1tfLAX23lhxhHJlEf3CRCOCGGWw3vI3GaSPw==}
    engines: {node: '>=18'}

  ts-api-utils@2.1.0:
    resolution: {integrity: sha512-CUgTZL1irw8u29bzrOD/nH85jqyc74D6SshFgujOIA7osm2Rz7dYH77agkx7H4FBNxDq7Cjf+IjaX/8zwFW+ZQ==}
    engines: {node: '>=18.12'}
    peerDependencies:
      typescript: '>=4.8.4'

  ts-interface-checker@0.1.13:
    resolution: {integrity: sha512-Y/arvbn+rrz3JCKl9C4kVNfTfSm2/mEp5FSz5EsZSANGPSlQrpRI5M4PKF+mJnE52jOO90PnPSc3Ur3bTQw0gA==}

  tsconfig-paths@3.15.0:
    resolution: {integrity: sha512-2Ac2RgzDe/cn48GvOe3M+o82pEFewD3UPbyoUHHdKasHwJKjds4fLXWf/Ux5kATBKN20oaFGu+jbElp1pos0mg==}

  tslib@2.8.1:
    resolution: {integrity: sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w==}

  type-check@0.4.0:
    resolution: {integrity: sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==}
    engines: {node: '>= 0.8.0'}

  typed-array-buffer@1.0.3:
    resolution: {integrity: sha512-nAYYwfY3qnzX30IkA6AQZjVbtK6duGontcQm1WSG1MD94YLqK0515GNApXkoxKOWMusVssAHWLh9SeaoefYFGw==}
    engines: {node: '>= 0.4'}

  typed-array-byte-length@1.0.3:
    resolution: {integrity: sha512-BaXgOuIxz8n8pIq3e7Atg/7s+DpiYrxn4vdot3w9KbnBhcRQq6o3xemQdIfynqSeXeDrF32x+WvfzmOjPiY9lg==}
    engines: {node: '>= 0.4'}

  typed-array-byte-offset@1.0.4:
    resolution: {integrity: sha512-bTlAFB/FBYMcuX81gbL4OcpH5PmlFHqlCCpAl8AlEzMz5k53oNDvN8p1PNOWLEmI2x4orp3raOFB51tv9X+MFQ==}
    engines: {node: '>= 0.4'}

  typed-array-length@1.0.7:
    resolution: {integrity: sha512-3KS2b+kL7fsuk/eJZ7EQdnEmQoaho/r6KUef7hxvltNA5DR8NAUM+8wJMbJyZ4G9/7i3v5zPBIMN5aybAh2/Jg==}
    engines: {node: '>= 0.4'}

  typescript@5.8.3:
    resolution: {integrity: sha512-p1diW6TqL9L07nNxvRMM7hMMw4c5XOo/1ibL4aAIGmSAt9slTE1Xgw5KWuof2uTOvCg9BY7ZRi+GaF+7sfgPeQ==}
    engines: {node: '>=14.17'}
    hasBin: true

  typo-js@1.2.5:
    resolution: {integrity: sha512-F45vFWdGX8xahIk/sOp79z2NJs8ETMYsmMChm9D5Hlx3+9j7VnCyQyvij5MOCrNY3NNe8noSyokRjQRfq+Bc7A==}

  unbox-primitive@1.1.0:
    resolution: {integrity: sha512-nWJ91DjeOkej/TA8pXQ3myruKpKEYgqvpw9lz4OPHj/NWFNluYrjbz9j01CJ8yKQd2g4jFoOkINCTW2I5LEEyw==}
    engines: {node: '>= 0.4'}

  undici-types@6.21.0:
    resolution: {integrity: sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==}

  unrs-resolver@1.10.1:
    resolution: {integrity: sha512-EFrL7Hw4kmhZdwWO3dwwFJo6hO3FXuQ6Bg8BK/faHZ9m1YxqBS31BNSTxklIQkxK/4LlV8zTYnPsIRLBzTzjCA==}

  update-browserslist-db@1.1.3:
    resolution: {integrity: sha512-UxhIZQ+QInVdunkDAaiazvvT/+fXL5Osr0JZlJulepYu6Jd7qJtDZjlur0emRlT71EN3ScPoE7gvsuIKKNavKw==}
    hasBin: true
    peerDependencies:
      browserslist: '>= 4.21.0'

  uri-js@4.4.1:
    resolution: {integrity: sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==}

  use-callback-ref@1.3.3:
    resolution: {integrity: sha512-jQL3lRnocaFtu3V00JToYz/4QkNWswxijDaCVNZRiRTO3HQDLsdu1ZtmIUvV4yPp+rvWm5j0y0TG/S61cuijTg==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  use-sidecar@1.1.3:
    resolution: {integrity: sha512-Fedw0aZvkhynoPYlA5WXrMCAMm+nSWdZt6lzJQ7Ok8S6Q+VsHmHpRWndVRJ8Be0ZbkfPc5LRYH+5XrzXcEeLRQ==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  use-sync-external-store@1.5.0:
    resolution: {integrity: sha512-Rb46I4cGGVBmjamjphe8L/UnvJD+uPPtTkNvX5mZgqdbavhI4EbgIWJiIHXJ8bc/i9EQGPRh4DwEURJ552Do0A==}
    peerDependencies:
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0

  util-deprecate@1.0.2:
    resolution: {integrity: sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==}

  vaul@0.9.9:
    resolution: {integrity: sha512-7afKg48srluhZwIkaU+lgGtFCUsYBSGOl8vcc8N/M3YQlZFlynHD15AE+pwrYdc826o7nrIND4lL9Y6b9WWZZQ==}
    peerDependencies:
      react: ^16.8 || ^17.0 || ^18.0
      react-dom: ^16.8 || ^17.0 || ^18.0

  victory-vendor@36.9.2:
    resolution: {integrity: sha512-PnpQQMuxlwYdocC8fIJqVXvkeViHYzotI+NJrCuav0ZYFoq912ZHBk3mCeuj+5/VpodOjPe1z0Fk2ihgzlXqjQ==}

  vite-node@3.2.4:
    resolution: {integrity: sha512-EbKSKh+bh1E1IFxeO0pg1n4dvoOTt0UDiXMd/qn++r98+jPO1xtJilvXldeuQ8giIB5IkpjCgMleHMNEsGH6pg==}
    engines: {node: ^18.0.0 || ^20.0.0 || >=22.0.0}
    hasBin: true

  vite@7.0.0:
    resolution: {integrity: sha512-ixXJB1YRgDIw2OszKQS9WxGHKwLdCsbQNkpJN171udl6szi/rIySHL6/Os3s2+oE4P/FLD4dxg4mD7Wust+u5g==}
    engines: {node: ^20.19.0 || >=22.12.0}
    hasBin: true
    peerDependencies:
      '@types/node': ^20.19.0 || >=22.12.0
      jiti: '>=1.21.0'
      less: ^4.0.0
      lightningcss: ^1.21.0
      sass: ^1.70.0
      sass-embedded: ^1.70.0
      stylus: '>=0.54.8'
      sugarss: ^5.0.0
      terser: ^5.16.0
      tsx: ^4.8.1
      yaml: ^2.4.2
    peerDependenciesMeta:
      '@types/node':
        optional: true
      jiti:
        optional: true
      less:
        optional: true
      lightningcss:
        optional: true
      sass:
        optional: true
      sass-embedded:
        optional: true
      stylus:
        optional: true
      sugarss:
        optional: true
      terser:
        optional: true
      tsx:
        optional: true
      yaml:
        optional: true

  vitest@3.2.4:
    resolution: {integrity: sha512-LUCP5ev3GURDysTWiP47wRRUpLKMOfPh+yKTx3kVIEiu5KOMeqzpnYNsKyOoVrULivR8tLcks4+lga33Whn90A==}
    engines: {node: ^18.0.0 || ^20.0.0 || >=22.0.0}
    hasBin: true
    peerDependencies:
      '@edge-runtime/vm': '*'
      '@types/debug': ^4.1.12
      '@types/node': ^18.0.0 || ^20.0.0 || >=22.0.0
      '@vitest/browser': 3.2.4
      '@vitest/ui': 3.2.4
      happy-dom: '*'
      jsdom: '*'
    peerDependenciesMeta:
      '@edge-runtime/vm':
        optional: true
      '@types/debug':
        optional: true
      '@types/node':
        optional: true
      '@vitest/browser':
        optional: true
      '@vitest/ui':
        optional: true
      happy-dom:
        optional: true
      jsdom:
        optional: true

  w3c-xmlserializer@5.0.0:
    resolution: {integrity: sha512-o8qghlI8NZHU1lLPrpi2+Uq7abh4GGPpYANlalzWxyWteJOCsr/P+oPBA49TOLu5FTZO4d3F9MnWJfiMo4BkmA==}
    engines: {node: '>=18'}

  webidl-conversions@7.0.0:
    resolution: {integrity: sha512-VwddBukDzu71offAQR975unBIGqfKZpM+8ZX6ySk8nYhVoo5CYaZyzt3YBvYtRtO+aoGlqxPg/B87NGVZ/fu6g==}
    engines: {node: '>=12'}

  whatwg-encoding@3.1.1:
    resolution: {integrity: sha512-6qN4hJdMwfYBtE3YBTTHhoeuUrDBPZmbQaxWAqSALV/MeEnR5z1xd8UKud2RAkFoPkmB+hli1TZSnyi84xz1vQ==}
    engines: {node: '>=18'}

  whatwg-mimetype@4.0.0:
    resolution: {integrity: sha512-QaKxh0eNIi2mE9p2vEdzfagOKHCcj1pJ56EEHGQOVxp8r9/iszLUUV7v89x9O1p/T+NlTM5W7jW6+cz4Fq1YVg==}
    engines: {node: '>=18'}

  whatwg-url@14.2.0:
    resolution: {integrity: sha512-De72GdQZzNTUBBChsXueQUnPKDkg/5A5zp7pFDuQAj5UFoENpiACU0wlCvzpAGnTkj++ihpKwKyYewn/XNUbKw==}
    engines: {node: '>=18'}

  which-boxed-primitive@1.1.1:
    resolution: {integrity: sha512-TbX3mj8n0odCBFVlY8AxkqcHASw3L60jIuF8jFP78az3C2YhmGvqbHBpAjTRH2/xqYunrJ9g1jSyjCjpoWzIAA==}
    engines: {node: '>= 0.4'}

  which-builtin-type@1.2.1:
    resolution: {integrity: sha512-6iBczoX+kDQ7a3+YJBnh3T+KZRxM/iYNPXicqk66/Qfm1b93iu+yOImkg0zHbj5LNOcNv1TEADiZ0xa34B4q6Q==}
    engines: {node: '>= 0.4'}

  which-collection@1.0.2:
    resolution: {integrity: sha512-K4jVyjnBdgvc86Y6BkaLZEN933SwYOuBFkdmBu9ZfkcAbdVbpITnDmjvZ/aQjRXQrv5EPkTnD1s39GiiqbngCw==}
    engines: {node: '>= 0.4'}

  which-typed-array@1.1.19:
    resolution: {integrity: sha512-rEvr90Bck4WZt9HHFC4DJMsjvu7x+r6bImz0/BrbWb7A2djJ8hnZMrWnHo9F8ssv0OMErasDhftrfROTyqSDrw==}
    engines: {node: '>= 0.4'}

  which@2.0.2:
    resolution: {integrity: sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==}
    engines: {node: '>= 8'}
    hasBin: true

  why-is-node-running@2.3.0:
    resolution: {integrity: sha512-hUrmaWBdVDcxvYqnyh09zunKzROWjbZTiNy8dBEjkS7ehEDQibXJ7XvlmtbwuTclUiIyN+CyXQD4Vmko8fNm8w==}
    engines: {node: '>=8'}
    hasBin: true

  word-wrap@1.2.5:
    resolution: {integrity: sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==}
    engines: {node: '>=0.10.0'}

  wrap-ansi@7.0.0:
    resolution: {integrity: sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==}
    engines: {node: '>=10'}

  wrap-ansi@8.1.0:
    resolution: {integrity: sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==}
    engines: {node: '>=12'}

  ws@8.18.3:
    resolution: {integrity: sha512-PEIGCY5tSlUt50cqyMXfCzX+oOPqN0vuGqWzbcJ2xvnkzkq46oOpz7dQaTDBdfICb4N14+GARUDw2XV2N4tvzg==}
    engines: {node: '>=10.0.0'}
    peerDependencies:
      bufferutil: ^4.0.1
      utf-8-validate: '>=5.0.2'
    peerDependenciesMeta:
      bufferutil:
        optional: true
      utf-8-validate:
        optional: true

  xml-name-validator@5.0.0:
    resolution: {integrity: sha512-EvGK8EJ3DhaHfbRlETOWAS5pO9MZITeauHKJyb8wyajUfQUenkIg2MvLDTZ4T/TgIcm3HU0TFBgWWboAZ30UHg==}
    engines: {node: '>=18'}

  xmlchars@2.2.0:
    resolution: {integrity: sha512-JZnDKK8B0RCDw84FNdDAIpZK+JuJw+s7Lz8nksI7SIuU3UXJJslUthsi+uWBUYOwPFwW7W7PRLRfUKpxjtjFCw==}

  yallist@3.1.1:
    resolution: {integrity: sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==}

  yaml@2.8.0:
    resolution: {integrity: sha512-4lLa/EcQCB0cJkyts+FpIRx5G/llPxfP6VQU5KByHEhLxY3IJCH0f0Hy1MHI8sClTvsIb8qwRJ6R/ZdlDJ/leQ==}
    engines: {node: '>= 14.6'}
    hasBin: true

  yocto-queue@0.1.0:
    resolution: {integrity: sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==}
    engines: {node: '>=10'}

  zod@3.25.71:
    resolution: {integrity: sha512-BsBc/NPk7h8WsUWYWYL+BajcJPY8YhjelaWu2NMLuzgraKAz4Lb4/6K11g9jpuDetjMiqhZ6YaexFLOC0Ogi3Q==}

  zustand@5.0.6:
    resolution: {integrity: sha512-ihAqNeUVhe0MAD+X8M5UzqyZ9k3FFZLBTtqo6JLPwV53cbRB/mJwBI0PxcIgqhBBHlEs8G45OTDTMq3gNcLq3A==}
    engines: {node: '>=12.20.0'}
    peerDependencies:
      '@types/react': '>=18.0.0'
      immer: '>=9.0.6'
      react: '>=18.0.0'
      use-sync-external-store: '>=1.2.0'
    peerDependenciesMeta:
      '@types/react':
        optional: true
      immer:
        optional: true
      react:
        optional: true
      use-sync-external-store:
        optional: true

snapshots:

  '@adobe/css-tools@4.4.3': {}

  '@alloc/quick-lru@5.2.0': {}

  '@ampproject/remapping@2.3.0':
    dependencies:
      '@jridgewell/gen-mapping': 0.3.12
      '@jridgewell/trace-mapping': 0.3.29

  '@asamuzakjp/css-color@3.2.0':
    dependencies:
      '@csstools/css-calc': 2.1.4(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-color-parser': 3.0.10(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-parser-algorithms': 3.0.5(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-tokenizer': 3.0.4
      lru-cache: 10.4.3

  '@babel/code-frame@7.27.1':
    dependencies:
      '@babel/helper-validator-identifier': 7.27.1
      js-tokens: 4.0.0
      picocolors: 1.1.1

  '@babel/compat-data@7.28.0': {}

  '@babel/core@7.28.0':
    dependencies:
      '@ampproject/remapping': 2.3.0
      '@babel/code-frame': 7.27.1
      '@babel/generator': 7.28.0
      '@babel/helper-compilation-targets': 7.27.2
      '@babel/helper-module-transforms': 7.27.3(@babel/core@7.28.0)
      '@babel/helpers': 7.27.6
      '@babel/parser': 7.28.0
      '@babel/template': 7.27.2
      '@babel/traverse': 7.28.0
      '@babel/types': 7.28.0
      convert-source-map: 2.0.0
      debug: 4.4.1
      gensync: 1.0.0-beta.2
      json5: 2.2.3
      semver: 6.3.1
    transitivePeerDependencies:
      - supports-color

  '@babel/generator@7.28.0':
    dependencies:
      '@babel/parser': 7.28.0
      '@babel/types': 7.28.0
      '@jridgewell/gen-mapping': 0.3.12
      '@jridgewell/trace-mapping': 0.3.29
      jsesc: 3.1.0

  '@babel/helper-compilation-targets@7.27.2':
    dependencies:
      '@babel/compat-data': 7.28.0
      '@babel/helper-validator-option': 7.27.1
      browserslist: 4.25.1
      lru-cache: 5.1.1
      semver: 6.3.1

  '@babel/helper-globals@7.28.0': {}

  '@babel/helper-module-imports@7.27.1':
    dependencies:
      '@babel/traverse': 7.28.0
      '@babel/types': 7.28.0
    transitivePeerDependencies:
      - supports-color

  '@babel/helper-module-transforms@7.27.3(@babel/core@7.28.0)':
    dependencies:
      '@babel/core': 7.28.0
      '@babel/helper-module-imports': 7.27.1
      '@babel/helper-validator-identifier': 7.27.1
      '@babel/traverse': 7.28.0
    transitivePeerDependencies:
      - supports-color

  '@babel/helper-plugin-utils@7.27.1': {}

  '@babel/helper-string-parser@7.27.1': {}

  '@babel/helper-validator-identifier@7.27.1': {}

  '@babel/helper-validator-option@7.27.1': {}

  '@babel/helpers@7.27.6':
    dependencies:
      '@babel/template': 7.27.2
      '@babel/types': 7.28.0

  '@babel/parser@7.28.0':
    dependencies:
      '@babel/types': 7.28.0

  '@babel/plugin-transform-react-jsx-self@7.27.1(@babel/core@7.28.0)':
    dependencies:
      '@babel/core': 7.28.0
      '@babel/helper-plugin-utils': 7.27.1

  '@babel/plugin-transform-react-jsx-source@7.27.1(@babel/core@7.28.0)':
    dependencies:
      '@babel/core': 7.28.0
      '@babel/helper-plugin-utils': 7.27.1

  '@babel/runtime@7.27.6': {}

  '@babel/template@7.27.2':
    dependencies:
      '@babel/code-frame': 7.27.1
      '@babel/parser': 7.28.0
      '@babel/types': 7.28.0

  '@babel/traverse@7.28.0':
    dependencies:
      '@babel/code-frame': 7.27.1
      '@babel/generator': 7.28.0
      '@babel/helper-globals': 7.28.0
      '@babel/parser': 7.28.0
      '@babel/template': 7.27.2
      '@babel/types': 7.28.0
      debug: 4.4.1
    transitivePeerDependencies:
      - supports-color

  '@babel/types@7.28.0':
    dependencies:
      '@babel/helper-string-parser': 7.27.1
      '@babel/helper-validator-identifier': 7.27.1

  '@csstools/color-helpers@5.0.2': {}

  '@csstools/css-calc@2.1.4(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)':
    dependencies:
      '@csstools/css-parser-algorithms': 3.0.5(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-tokenizer': 3.0.4

  '@csstools/css-color-parser@3.0.10(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)':
    dependencies:
      '@csstools/color-helpers': 5.0.2
      '@csstools/css-calc': 2.1.4(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-parser-algorithms': 3.0.5(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-tokenizer': 3.0.4

  '@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4)':
    dependencies:
      '@csstools/css-tokenizer': 3.0.4

  '@csstools/css-tokenizer@3.0.4': {}

  '@emnapi/core@1.4.3':
    dependencies:
      '@emnapi/wasi-threads': 1.0.2
      tslib: 2.8.1
    optional: true

  '@emnapi/runtime@1.4.3':
    dependencies:
      tslib: 2.8.1
    optional: true

  '@emnapi/wasi-threads@1.0.2':
    dependencies:
      tslib: 2.8.1
    optional: true

  '@esbuild/aix-ppc64@0.25.5':
    optional: true

  '@esbuild/android-arm64@0.25.5':
    optional: true

  '@esbuild/android-arm@0.25.5':
    optional: true

  '@esbuild/android-x64@0.25.5':
    optional: true

  '@esbuild/darwin-arm64@0.25.5':
    optional: true

  '@esbuild/darwin-x64@0.25.5':
    optional: true

  '@esbuild/freebsd-arm64@0.25.5':
    optional: true

  '@esbuild/freebsd-x64@0.25.5':
    optional: true

  '@esbuild/linux-arm64@0.25.5':
    optional: true

  '@esbuild/linux-arm@0.25.5':
    optional: true

  '@esbuild/linux-ia32@0.25.5':
    optional: true

  '@esbuild/linux-loong64@0.25.5':
    optional: true

  '@esbuild/linux-mips64el@0.25.5':
    optional: true

  '@esbuild/linux-ppc64@0.25.5':
    optional: true

  '@esbuild/linux-riscv64@0.25.5':
    optional: true

  '@esbuild/linux-s390x@0.25.5':
    optional: true

  '@esbuild/linux-x64@0.25.5':
    optional: true

  '@esbuild/netbsd-arm64@0.25.5':
    optional: true

  '@esbuild/netbsd-x64@0.25.5':
    optional: true

  '@esbuild/openbsd-arm64@0.25.5':
    optional: true

  '@esbuild/openbsd-x64@0.25.5':
    optional: true

  '@esbuild/sunos-x64@0.25.5':
    optional: true

  '@esbuild/win32-arm64@0.25.5':
    optional: true

  '@esbuild/win32-ia32@0.25.5':
    optional: true

  '@esbuild/win32-x64@0.25.5':
    optional: true

  '@eslint-community/eslint-utils@4.7.0(eslint@9.30.1(jiti@1.21.7))':
    dependencies:
      eslint: 9.30.1(jiti@1.21.7)
      eslint-visitor-keys: 3.4.3

  '@eslint-community/regexpp@4.12.1': {}

  '@eslint/config-array@0.21.0':
    dependencies:
      '@eslint/object-schema': 2.1.6
      debug: 4.4.1
      minimatch: 3.1.2
    transitivePeerDependencies:
      - supports-color

  '@eslint/config-helpers@0.3.0': {}

  '@eslint/core@0.14.0':
    dependencies:
      '@types/json-schema': 7.0.15

  '@eslint/core@0.15.1':
    dependencies:
      '@types/json-schema': 7.0.15

  '@eslint/eslintrc@3.3.1':
    dependencies:
      ajv: 6.12.6
      debug: 4.4.1
      espree: 10.4.0
      globals: 14.0.0
      ignore: 5.3.2
      import-fresh: 3.3.1
      js-yaml: 4.1.0
      minimatch: 3.1.2
      strip-json-comments: 3.1.1
    transitivePeerDependencies:
      - supports-color

  '@eslint/js@9.30.1': {}

  '@eslint/object-schema@2.1.6': {}

  '@eslint/plugin-kit@0.3.3':
    dependencies:
      '@eslint/core': 0.15.1
      levn: 0.4.1

  '@floating-ui/core@1.7.2':
    dependencies:
      '@floating-ui/utils': 0.2.10

  '@floating-ui/dom@1.7.2':
    dependencies:
      '@floating-ui/core': 1.7.2
      '@floating-ui/utils': 0.2.10

  '@floating-ui/react-dom@2.1.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@floating-ui/dom': 1.7.2
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  '@floating-ui/utils@0.2.10': {}

  '@hookform/resolvers@3.10.0(react-hook-form@7.59.0(react@19.1.0))':
    dependencies:
      react-hook-form: 7.59.0(react@19.1.0)

  '@humanfs/core@0.19.1': {}

  '@humanfs/node@0.16.6':
    dependencies:
      '@humanfs/core': 0.19.1
      '@humanwhocodes/retry': 0.3.1

  '@humanwhocodes/module-importer@1.0.1': {}

  '@humanwhocodes/retry@0.3.1': {}

  '@humanwhocodes/retry@0.4.3': {}

  '@img/sharp-darwin-arm64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-darwin-arm64': 1.0.4
    optional: true

  '@img/sharp-darwin-x64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-darwin-x64': 1.0.4
    optional: true

  '@img/sharp-libvips-darwin-arm64@1.0.4':
    optional: true

  '@img/sharp-libvips-darwin-x64@1.0.4':
    optional: true

  '@img/sharp-libvips-linux-arm64@1.0.4':
    optional: true

  '@img/sharp-libvips-linux-arm@1.0.5':
    optional: true

  '@img/sharp-libvips-linux-s390x@1.0.4':
    optional: true

  '@img/sharp-libvips-linux-x64@1.0.4':
    optional: true

  '@img/sharp-libvips-linuxmusl-arm64@1.0.4':
    optional: true

  '@img/sharp-libvips-linuxmusl-x64@1.0.4':
    optional: true

  '@img/sharp-linux-arm64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linux-arm64': 1.0.4
    optional: true

  '@img/sharp-linux-arm@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linux-arm': 1.0.5
    optional: true

  '@img/sharp-linux-s390x@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linux-s390x': 1.0.4
    optional: true

  '@img/sharp-linux-x64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linux-x64': 1.0.4
    optional: true

  '@img/sharp-linuxmusl-arm64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linuxmusl-arm64': 1.0.4
    optional: true

  '@img/sharp-linuxmusl-x64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linuxmusl-x64': 1.0.4
    optional: true

  '@img/sharp-wasm32@0.33.5':
    dependencies:
      '@emnapi/runtime': 1.4.3
    optional: true

  '@img/sharp-win32-ia32@0.33.5':
    optional: true

  '@img/sharp-win32-x64@0.33.5':
    optional: true

  '@isaacs/cliui@8.0.2':
    dependencies:
      string-width: 5.1.2
      string-width-cjs: string-width@4.2.3
      strip-ansi: 7.1.0
      strip-ansi-cjs: strip-ansi@6.0.1
      wrap-ansi: 8.1.0
      wrap-ansi-cjs: wrap-ansi@7.0.0

  '@jridgewell/gen-mapping@0.3.12':
    dependencies:
      '@jridgewell/sourcemap-codec': 1.5.4
      '@jridgewell/trace-mapping': 0.3.29

  '@jridgewell/resolve-uri@3.1.2': {}

  '@jridgewell/sourcemap-codec@1.5.4': {}

  '@jridgewell/trace-mapping@0.3.29':
    dependencies:
      '@jridgewell/resolve-uri': 3.1.2
      '@jridgewell/sourcemap-codec': 1.5.4

  '@napi-rs/wasm-runtime@0.2.11':
    dependencies:
      '@emnapi/core': 1.4.3
      '@emnapi/runtime': 1.4.3
      '@tybys/wasm-util': 0.9.0
    optional: true

  '@next/env@15.2.4': {}

  '@next/eslint-plugin-next@15.3.4':
    dependencies:
      fast-glob: 3.3.1

  '@next/swc-darwin-arm64@15.2.4':
    optional: true

  '@next/swc-darwin-x64@15.2.4':
    optional: true

  '@next/swc-linux-arm64-gnu@15.2.4':
    optional: true

  '@next/swc-linux-arm64-musl@15.2.4':
    optional: true

  '@next/swc-linux-x64-gnu@15.2.4':
    optional: true

  '@next/swc-linux-x64-musl@15.2.4':
    optional: true

  '@next/swc-win32-arm64-msvc@15.2.4':
    optional: true

  '@next/swc-win32-x64-msvc@15.2.4':
    optional: true

  '@nodelib/fs.scandir@2.1.5':
    dependencies:
      '@nodelib/fs.stat': 2.0.5
      run-parallel: 1.2.0

  '@nodelib/fs.stat@2.0.5': {}

  '@nodelib/fs.walk@1.2.8':
    dependencies:
      '@nodelib/fs.scandir': 2.1.5
      fastq: 1.19.1

  '@nolyfill/is-core-module@1.0.39': {}

  '@pkgjs/parseargs@0.11.0':
    optional: true

  '@playwright/test@1.53.2':
    dependencies:
      playwright: 1.53.2

  '@polka/url@1.0.0-next.29': {}

  '@radix-ui/number@1.1.0': {}

  '@radix-ui/primitive@1.1.1': {}

  '@radix-ui/react-accordion@1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collapsible': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-alert-dialog@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dialog': 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-arrow@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-aspect-ratio@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-avatar@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-checkbox@1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-collapsible@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-collection@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-compose-refs@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-compose-refs@1.1.2(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-context-menu@2.2.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-menu': 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-context@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-dialog@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-focus-guards': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-focus-scope': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      aria-hidden: 1.2.6
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-remove-scroll: 2.7.1(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-direction@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-dismissable-layer@1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-escape-keydown': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-dropdown-menu@2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-menu': 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-focus-guards@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-focus-scope@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-hover-card@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-id@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-id@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-label@2.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-menu@2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-focus-guards': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-focus-scope': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      aria-hidden: 1.2.6
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-remove-scroll: 2.7.1(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-menubar@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-menu': 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-navigation-menu@1.2.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-visually-hidden': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-popover@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-focus-guards': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-focus-scope': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      aria-hidden: 1.2.6
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-remove-scroll: 2.7.1(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-popper@1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@floating-ui/react-dom': 2.1.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-arrow': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-rect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/rect': 1.1.0
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-portal@1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-presence@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-primitive@2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-primitive@2.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-slot': 1.2.3(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-progress@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-radio-group@1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-roving-focus@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-scroll-area@1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/number': 1.1.0
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-select@2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/number': 1.1.0
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-focus-guards': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-focus-scope': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-visually-hidden': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      aria-hidden: 1.2.6
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-remove-scroll: 2.7.1(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-separator@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-slider@1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/number': 1.1.0
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-slot@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-slot@1.2.3(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.2(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-switch@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-tabs@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-toast@1.2.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-visually-hidden': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-toggle-group@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-toggle': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-toggle@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-tooltip@1.1.6(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-visually-hidden': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-use-callback-ref@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-controllable-state@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-escape-keydown@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-layout-effect@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-layout-effect@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-previous@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-rect@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/rect': 1.1.0
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-size@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-visually-hidden@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/rect@1.1.0': {}

  '@rolldown/pluginutils@1.0.0-beta.19': {}

  '@rollup/rollup-android-arm-eabi@4.44.1':
    optional: true

  '@rollup/rollup-android-arm64@4.44.1':
    optional: true

  '@rollup/rollup-darwin-arm64@4.44.1':
    optional: true

  '@rollup/rollup-darwin-x64@4.44.1':
    optional: true

  '@rollup/rollup-freebsd-arm64@4.44.1':
    optional: true

  '@rollup/rollup-freebsd-x64@4.44.1':
    optional: true

  '@rollup/rollup-linux-arm-gnueabihf@4.44.1':
    optional: true

  '@rollup/rollup-linux-arm-musleabihf@4.44.1':
    optional: true

  '@rollup/rollup-linux-arm64-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-arm64-musl@4.44.1':
    optional: true

  '@rollup/rollup-linux-loongarch64-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-powerpc64le-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-riscv64-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-riscv64-musl@4.44.1':
    optional: true

  '@rollup/rollup-linux-s390x-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-x64-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-x64-musl@4.44.1':
    optional: true

  '@rollup/rollup-win32-arm64-msvc@4.44.1':
    optional: true

  '@rollup/rollup-win32-ia32-msvc@4.44.1':
    optional: true

  '@rollup/rollup-win32-x64-msvc@4.44.1':
    optional: true

  '@rtsao/scc@1.1.0': {}

  '@rushstack/eslint-patch@1.12.0': {}

  '@swc/counter@0.1.3': {}

  '@swc/helpers@0.5.15':
    dependencies:
      tslib: 2.8.1

  '@testing-library/dom@10.4.0':
    dependencies:
      '@babel/code-frame': 7.27.1
      '@babel/runtime': 7.27.6
      '@types/aria-query': 5.0.4
      aria-query: 5.3.0
      chalk: 4.1.2
      dom-accessibility-api: 0.5.16
      lz-string: 1.5.0
      pretty-format: 27.5.1

  '@testing-library/jest-dom@6.6.3':
    dependencies:
      '@adobe/css-tools': 4.4.3
      aria-query: 5.3.2
      chalk: 3.0.0
      css.escape: 1.5.1
      dom-accessibility-api: 0.6.3
      lodash: 4.17.21
      redent: 3.0.0

  '@testing-library/react@16.3.0(@testing-library/dom@10.4.0)(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@babel/runtime': 7.27.6
      '@testing-library/dom': 10.4.0
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@testing-library/user-event@14.6.1(@testing-library/dom@10.4.0)':
    dependencies:
      '@testing-library/dom': 10.4.0

  '@tybys/wasm-util@0.9.0':
    dependencies:
      tslib: 2.8.1
    optional: true

  '@types/aria-query@5.0.4': {}

  '@types/babel__core@7.20.5':
    dependencies:
      '@babel/parser': 7.28.0
      '@babel/types': 7.28.0
      '@types/babel__generator': 7.27.0
      '@types/babel__template': 7.4.4
      '@types/babel__traverse': 7.20.7

  '@types/babel__generator@7.27.0':
    dependencies:
      '@babel/types': 7.28.0

  '@types/babel__template@7.4.4':
    dependencies:
      '@babel/parser': 7.28.0
      '@babel/types': 7.28.0

  '@types/babel__traverse@7.20.7':
    dependencies:
      '@babel/types': 7.28.0

  '@types/chai@5.2.2':
    dependencies:
      '@types/deep-eql': 4.0.2

  '@types/codemirror@5.60.16':
    dependencies:
      '@types/tern': 0.23.9

  '@types/d3-array@3.2.1': {}

  '@types/d3-color@3.1.3': {}

  '@types/d3-ease@3.0.2': {}

  '@types/d3-interpolate@3.0.4':
    dependencies:
      '@types/d3-color': 3.1.3

  '@types/d3-path@3.1.1': {}

  '@types/d3-scale@4.0.9':
    dependencies:
      '@types/d3-time': 3.0.4

  '@types/d3-shape@3.1.7':
    dependencies:
      '@types/d3-path': 3.1.1

  '@types/d3-time@3.0.4': {}

  '@types/d3-timer@3.0.2': {}

  '@types/deep-eql@4.0.2': {}

  '@types/estree@1.0.8': {}

  '@types/json-schema@7.0.15': {}

  '@types/json5@0.0.29': {}

  '@types/marked@4.3.2': {}

  '@types/node@22.16.0':
    dependencies:
      undici-types: 6.21.0

  '@types/react-dom@19.1.6(@types/react@19.1.8)':
    dependencies:
      '@types/react': 19.1.8

  '@types/react@19.1.8':
    dependencies:
      csstype: 3.1.3

  '@types/tern@0.23.9':
    dependencies:
      '@types/estree': 1.0.8

  '@typescript-eslint/eslint-plugin@8.35.1(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)':
    dependencies:
      '@eslint-community/regexpp': 4.12.1
      '@typescript-eslint/parser': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      '@typescript-eslint/scope-manager': 8.35.1
      '@typescript-eslint/type-utils': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      '@typescript-eslint/utils': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      '@typescript-eslint/visitor-keys': 8.35.1
      eslint: 9.30.1(jiti@1.21.7)
      graphemer: 1.4.0
      ignore: 7.0.5
      natural-compare: 1.4.0
      ts-api-utils: 2.1.0(typescript@5.8.3)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)':
    dependencies:
      '@typescript-eslint/scope-manager': 8.35.1
      '@typescript-eslint/types': 8.35.1
      '@typescript-eslint/typescript-estree': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/visitor-keys': 8.35.1
      debug: 4.4.1
      eslint: 9.30.1(jiti@1.21.7)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/project-service@8.35.1(typescript@5.8.3)':
    dependencies:
      '@typescript-eslint/tsconfig-utils': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/types': 8.35.1
      debug: 4.4.1
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/scope-manager@8.35.1':
    dependencies:
      '@typescript-eslint/types': 8.35.1
      '@typescript-eslint/visitor-keys': 8.35.1

  '@typescript-eslint/tsconfig-utils@8.35.1(typescript@5.8.3)':
    dependencies:
      typescript: 5.8.3

  '@typescript-eslint/type-utils@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)':
    dependencies:
      '@typescript-eslint/typescript-estree': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/utils': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      debug: 4.4.1
      eslint: 9.30.1(jiti@1.21.7)
      ts-api-utils: 2.1.0(typescript@5.8.3)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/types@8.35.1': {}

  '@typescript-eslint/typescript-estree@8.35.1(typescript@5.8.3)':
    dependencies:
      '@typescript-eslint/project-service': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/tsconfig-utils': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/types': 8.35.1
      '@typescript-eslint/visitor-keys': 8.35.1
      debug: 4.4.1
      fast-glob: 3.3.3
      is-glob: 4.0.3
      minimatch: 9.0.5
      semver: 7.7.2
      ts-api-utils: 2.1.0(typescript@5.8.3)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/utils@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)':
    dependencies:
      '@eslint-community/eslint-utils': 4.7.0(eslint@9.30.1(jiti@1.21.7))
      '@typescript-eslint/scope-manager': 8.35.1
      '@typescript-eslint/types': 8.35.1
      '@typescript-eslint/typescript-estree': 8.35.1(typescript@5.8.3)
      eslint: 9.30.1(jiti@1.21.7)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/visitor-keys@8.35.1':
    dependencies:
      '@typescript-eslint/types': 8.35.1
      eslint-visitor-keys: 4.2.1

  '@unrs/resolver-binding-android-arm-eabi@1.10.1':
    optional: true

  '@unrs/resolver-binding-android-arm64@1.10.1':
    optional: true

  '@unrs/resolver-binding-darwin-arm64@1.10.1':
    optional: true

  '@unrs/resolver-binding-darwin-x64@1.10.1':
    optional: true

  '@unrs/resolver-binding-freebsd-x64@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-arm-gnueabihf@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-arm-musleabihf@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-arm64-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-arm64-musl@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-ppc64-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-riscv64-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-riscv64-musl@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-s390x-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-x64-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-x64-musl@1.10.1':
    optional: true

  '@unrs/resolver-binding-wasm32-wasi@1.10.1':
    dependencies:
      '@napi-rs/wasm-runtime': 0.2.11
    optional: true

  '@unrs/resolver-binding-win32-arm64-msvc@1.10.1':
    optional: true

  '@unrs/resolver-binding-win32-ia32-msvc@1.10.1':
    optional: true

  '@unrs/resolver-binding-win32-x64-msvc@1.10.1':
    optional: true

  '@vitejs/plugin-react@4.6.0(vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0))':
    dependencies:
      '@babel/core': 7.28.0
      '@babel/plugin-transform-react-jsx-self': 7.27.1(@babel/core@7.28.0)
      '@babel/plugin-transform-react-jsx-source': 7.27.1(@babel/core@7.28.0)
      '@rolldown/pluginutils': 1.0.0-beta.19
      '@types/babel__core': 7.20.5
      react-refresh: 0.17.0
      vite: 7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)
    transitivePeerDependencies:
      - supports-color

  '@vitest/expect@3.2.4':
    dependencies:
      '@types/chai': 5.2.2
      '@vitest/spy': 3.2.4
      '@vitest/utils': 3.2.4
      chai: 5.2.0
      tinyrainbow: 2.0.0

  '@vitest/mocker@3.2.4(vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0))':
    dependencies:
      '@vitest/spy': 3.2.4
      estree-walker: 3.0.3
      magic-string: 0.30.17
    optionalDependencies:
      vite: 7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)

  '@vitest/pretty-format@3.2.4':
    dependencies:
      tinyrainbow: 2.0.0

  '@vitest/runner@3.2.4':
    dependencies:
      '@vitest/utils': 3.2.4
      pathe: 2.0.3
      strip-literal: 3.0.0

  '@vitest/snapshot@3.2.4':
    dependencies:
      '@vitest/pretty-format': 3.2.4
      magic-string: 0.30.17
      pathe: 2.0.3

  '@vitest/spy@3.2.4':
    dependencies:
      tinyspy: 4.0.3

  '@vitest/ui@3.2.4(vitest@3.2.4)':
    dependencies:
      '@vitest/utils': 3.2.4
      fflate: 0.8.2
      flatted: 3.3.3
      pathe: 2.0.3
      sirv: 3.0.1
      tinyglobby: 0.2.14
      tinyrainbow: 2.0.0
      vitest: 3.2.4(@types/node@22.16.0)(@vitest/ui@3.2.4)(jiti@1.21.7)(jsdom@26.1.0)(yaml@2.8.0)

  '@vitest/utils@3.2.4':
    dependencies:
      '@vitest/pretty-format': 3.2.4
      loupe: 3.1.4
      tinyrainbow: 2.0.0

  acorn-jsx@5.3.2(acorn@8.15.0):
    dependencies:
      acorn: 8.15.0

  acorn@8.15.0: {}

  agent-base@7.1.3: {}

  ajv@6.12.6:
    dependencies:
      fast-deep-equal: 3.1.3
      fast-json-stable-stringify: 2.1.0
      json-schema-traverse: 0.4.1
      uri-js: 4.4.1

  ansi-regex@5.0.1: {}

  ansi-regex@6.1.0: {}

  ansi-styles@4.3.0:
    dependencies:
      color-convert: 2.0.1

  ansi-styles@5.2.0: {}

  ansi-styles@6.2.1: {}

  any-promise@1.3.0: {}

  anymatch@3.1.3:
    dependencies:
      normalize-path: 3.0.0
      picomatch: 2.3.1

  arg@5.0.2: {}

  argparse@2.0.1: {}

  aria-hidden@1.2.6:
    dependencies:
      tslib: 2.8.1

  aria-query@5.3.0:
    dependencies:
      dequal: 2.0.3

  aria-query@5.3.2: {}

  array-buffer-byte-length@1.0.2:
    dependencies:
      call-bound: 1.0.4
      is-array-buffer: 3.0.5

  array-includes@3.1.9:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-object-atoms: 1.1.1
      get-intrinsic: 1.3.0
      is-string: 1.1.1
      math-intrinsics: 1.1.0

  array.prototype.findlast@1.2.5:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      es-shim-unscopables: 1.1.0

  array.prototype.findlastindex@1.2.6:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      es-shim-unscopables: 1.1.0

  array.prototype.flat@1.3.3:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-shim-unscopables: 1.1.0

  array.prototype.flatmap@1.3.3:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-shim-unscopables: 1.1.0

  array.prototype.tosorted@1.1.4:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-shim-unscopables: 1.1.0

  arraybuffer.prototype.slice@1.0.4:
    dependencies:
      array-buffer-byte-length: 1.0.2
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      get-intrinsic: 1.3.0
      is-array-buffer: 3.0.5

  assertion-error@2.0.1: {}

  ast-types-flow@0.0.8: {}

  async-function@1.0.0: {}

  asynckit@0.4.0: {}

  autoprefixer@10.4.21(postcss@8.5.6):
    dependencies:
      browserslist: 4.25.1
      caniuse-lite: 1.0.30001726
      fraction.js: 4.3.7
      normalize-range: 0.1.2
      picocolors: 1.1.1
      postcss: 8.5.6
      postcss-value-parser: 4.2.0

  available-typed-arrays@1.0.7:
    dependencies:
      possible-typed-array-names: 1.1.0

  axe-core@4.10.3: {}

  axios@1.10.0:
    dependencies:
      follow-redirects: 1.15.9
      form-data: 4.0.3
      proxy-from-env: 1.1.0
    transitivePeerDependencies:
      - debug

  axobject-query@4.1.0: {}

  balanced-match@1.0.2: {}

  binary-extensions@2.3.0: {}

  brace-expansion@1.1.12:
    dependencies:
      balanced-match: 1.0.2
      concat-map: 0.0.1

  brace-expansion@2.0.2:
    dependencies:
      balanced-match: 1.0.2

  braces@3.0.3:
    dependencies:
      fill-range: 7.1.1

  browserslist@4.25.1:
    dependencies:
      caniuse-lite: 1.0.30001726
      electron-to-chromium: 1.5.179
      node-releases: 2.0.19
      update-browserslist-db: 1.1.3(browserslist@4.25.1)

  busboy@1.6.0:
    dependencies:
      streamsearch: 1.1.0

  cac@6.7.14: {}

  call-bind-apply-helpers@1.0.2:
    dependencies:
      es-errors: 1.3.0
      function-bind: 1.1.2

  call-bind@1.0.8:
    dependencies:
      call-bind-apply-helpers: 1.0.2
      es-define-property: 1.0.1
      get-intrinsic: 1.3.0
      set-function-length: 1.2.2

  call-bound@1.0.4:
    dependencies:
      call-bind-apply-helpers: 1.0.2
      get-intrinsic: 1.3.0

  callsites@3.1.0: {}

  camelcase-css@2.0.1: {}

  caniuse-lite@1.0.30001726: {}

  chai@5.2.0:
    dependencies:
      assertion-error: 2.0.1
      check-error: 2.1.1
      deep-eql: 5.0.2
      loupe: 3.1.4
      pathval: 2.0.1

  chalk@3.0.0:
    dependencies:
      ansi-styles: 4.3.0
      supports-color: 7.2.0

  chalk@4.1.2:
    dependencies:
      ansi-styles: 4.3.0
      supports-color: 7.2.0

  check-error@2.1.1: {}

  chokidar@3.6.0:
    dependencies:
      anymatch: 3.1.3
      braces: 3.0.3
      glob-parent: 5.1.2
      is-binary-path: 2.1.0
      is-glob: 4.0.3
      normalize-path: 3.0.0
      readdirp: 3.6.0
    optionalDependencies:
      fsevents: 2.3.3

  class-variance-authority@0.7.1:
    dependencies:
      clsx: 2.1.1

  client-only@0.0.1: {}

  clsx@2.1.1: {}

  cmdk@1.0.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@radix-ui/react-dialog': 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      use-sync-external-store: 1.5.0(react@19.1.0)
    transitivePeerDependencies:
      - '@types/react'
      - '@types/react-dom'

  codemirror-spell-checker@1.1.2:
    dependencies:
      typo-js: 1.2.5

  codemirror@5.65.19: {}

  color-convert@2.0.1:
    dependencies:
      color-name: 1.1.4

  color-name@1.1.4: {}

  color-string@1.9.1:
    dependencies:
      color-name: 1.1.4
      simple-swizzle: 0.2.2
    optional: true

  color@4.2.3:
    dependencies:
      color-convert: 2.0.1
      color-string: 1.9.1
    optional: true

  combined-stream@1.0.8:
    dependencies:
      delayed-stream: 1.0.0

  commander@4.1.1: {}

  concat-map@0.0.1: {}

  convert-source-map@2.0.0: {}

  cross-spawn@7.0.6:
    dependencies:
      path-key: 3.1.1
      shebang-command: 2.0.0
      which: 2.0.2

  css.escape@1.5.1: {}

  cssesc@3.0.0: {}

  cssstyle@4.6.0:
    dependencies:
      '@asamuzakjp/css-color': 3.2.0
      rrweb-cssom: 0.8.0

  csstype@3.1.3: {}

  d3-array@3.2.4:
    dependencies:
      internmap: 2.0.3

  d3-color@3.1.0: {}

  d3-ease@3.0.1: {}

  d3-format@3.1.0: {}

  d3-interpolate@3.0.1:
    dependencies:
      d3-color: 3.1.0

  d3-path@3.1.0: {}

  d3-scale@4.0.2:
    dependencies:
      d3-array: 3.2.4
      d3-format: 3.1.0
      d3-interpolate: 3.0.1
      d3-time: 3.1.0
      d3-time-format: 4.1.0

  d3-shape@3.2.0:
    dependencies:
      d3-path: 3.1.0

  d3-time-format@4.1.0:
    dependencies:
      d3-time: 3.1.0

  d3-time@3.1.0:
    dependencies:
      d3-array: 3.2.4

  d3-timer@3.0.1: {}

  damerau-levenshtein@1.0.8: {}

  data-urls@5.0.0:
    dependencies:
      whatwg-mimetype: 4.0.0
      whatwg-url: 14.2.0

  data-view-buffer@1.0.2:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-data-view: 1.0.2

  data-view-byte-length@1.0.2:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-data-view: 1.0.2

  data-view-byte-offset@1.0.1:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-data-view: 1.0.2

  date-fns@4.1.0: {}

  debug@3.2.7:
    dependencies:
      ms: 2.1.3

  debug@4.4.1:
    dependencies:
      ms: 2.1.3

  decimal.js-light@2.5.1: {}

  decimal.js@10.5.0: {}

  deep-eql@5.0.2: {}

  deep-is@0.1.4: {}

  define-data-property@1.1.4:
    dependencies:
      es-define-property: 1.0.1
      es-errors: 1.3.0
      gopd: 1.2.0

  define-properties@1.2.1:
    dependencies:
      define-data-property: 1.1.4
      has-property-descriptors: 1.0.2
      object-keys: 1.1.1

  delayed-stream@1.0.0: {}

  dequal@2.0.3: {}

  detect-libc@2.0.4:
    optional: true

  detect-node-es@1.1.0: {}

  didyoumean@1.2.2: {}

  dlv@1.1.3: {}

  doctrine@2.1.0:
    dependencies:
      esutils: 2.0.3

  dom-accessibility-api@0.5.16: {}

  dom-accessibility-api@0.6.3: {}

  dom-helpers@5.2.1:
    dependencies:
      '@babel/runtime': 7.27.6
      csstype: 3.1.3

  dunder-proto@1.0.1:
    dependencies:
      call-bind-apply-helpers: 1.0.2
      es-errors: 1.3.0
      gopd: 1.2.0

  eastasianwidth@0.2.0: {}

  easymde@2.20.0:
    dependencies:
      '@types/codemirror': 5.60.16
      '@types/marked': 4.3.2
      codemirror: 5.65.19
      codemirror-spell-checker: 1.1.2
      marked: 4.3.0

  electron-to-chromium@1.5.179: {}

  embla-carousel-react@8.5.1(react@19.1.0):
    dependencies:
      embla-carousel: 8.5.1
      embla-carousel-reactive-utils: 8.5.1(embla-carousel@8.5.1)
      react: 19.1.0

  embla-carousel-reactive-utils@8.5.1(embla-carousel@8.5.1):
    dependencies:
      embla-carousel: 8.5.1

  embla-carousel@8.5.1: {}

  emoji-regex@8.0.0: {}

  emoji-regex@9.2.2: {}

  entities@6.0.1: {}

  es-abstract@1.24.0:
    dependencies:
      array-buffer-byte-length: 1.0.2
      arraybuffer.prototype.slice: 1.0.4
      available-typed-arrays: 1.0.7
      call-bind: 1.0.8
      call-bound: 1.0.4
      data-view-buffer: 1.0.2
      data-view-byte-length: 1.0.2
      data-view-byte-offset: 1.0.1
      es-define-property: 1.0.1
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      es-set-tostringtag: 2.1.0
      es-to-primitive: 1.3.0
      function.prototype.name: 1.1.8
      get-intrinsic: 1.3.0
      get-proto: 1.0.1
      get-symbol-description: 1.1.0
      globalthis: 1.0.4
      gopd: 1.2.0
      has-property-descriptors: 1.0.2
      has-proto: 1.2.0
      has-symbols: 1.1.0
      hasown: 2.0.2
      internal-slot: 1.1.0
      is-array-buffer: 3.0.5
      is-callable: 1.2.7
      is-data-view: 1.0.2
      is-negative-zero: 2.0.3
      is-regex: 1.2.1
      is-set: 2.0.3
      is-shared-array-buffer: 1.0.4
      is-string: 1.1.1
      is-typed-array: 1.1.15
      is-weakref: 1.1.1
      math-intrinsics: 1.1.0
      object-inspect: 1.13.4
      object-keys: 1.1.1
      object.assign: 4.1.7
      own-keys: 1.0.1
      regexp.prototype.flags: 1.5.4
      safe-array-concat: 1.1.3
      safe-push-apply: 1.0.0
      safe-regex-test: 1.1.0
      set-proto: 1.0.0
      stop-iteration-iterator: 1.1.0
      string.prototype.trim: 1.2.10
      string.prototype.trimend: 1.0.9
      string.prototype.trimstart: 1.0.8
      typed-array-buffer: 1.0.3
      typed-array-byte-length: 1.0.3
      typed-array-byte-offset: 1.0.4
      typed-array-length: 1.0.7
      unbox-primitive: 1.1.0
      which-typed-array: 1.1.19

  es-define-property@1.0.1: {}

  es-errors@1.3.0: {}

  es-iterator-helpers@1.2.1:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-set-tostringtag: 2.1.0
      function-bind: 1.1.2
      get-intrinsic: 1.3.0
      globalthis: 1.0.4
      gopd: 1.2.0
      has-property-descriptors: 1.0.2
      has-proto: 1.2.0
      has-symbols: 1.1.0
      internal-slot: 1.1.0
      iterator.prototype: 1.1.5
      safe-array-concat: 1.1.3

  es-module-lexer@1.7.0: {}

  es-object-atoms@1.1.1:
    dependencies:
      es-errors: 1.3.0

  es-set-tostringtag@2.1.0:
    dependencies:
      es-errors: 1.3.0
      get-intrinsic: 1.3.0
      has-tostringtag: 1.0.2
      hasown: 2.0.2

  es-shim-unscopables@1.1.0:
    dependencies:
      hasown: 2.0.2

  es-to-primitive@1.3.0:
    dependencies:
      is-callable: 1.2.7
      is-date-object: 1.1.0
      is-symbol: 1.1.1

  esbuild@0.25.5:
    optionalDependencies:
      '@esbuild/aix-ppc64': 0.25.5
      '@esbuild/android-arm': 0.25.5
      '@esbuild/android-arm64': 0.25.5
      '@esbuild/android-x64': 0.25.5
      '@esbuild/darwin-arm64': 0.25.5
      '@esbuild/darwin-x64': 0.25.5
      '@esbuild/freebsd-arm64': 0.25.5
      '@esbuild/freebsd-x64': 0.25.5
      '@esbuild/linux-arm': 0.25.5
      '@esbuild/linux-arm64': 0.25.5
      '@esbuild/linux-ia32': 0.25.5
      '@esbuild/linux-loong64': 0.25.5
      '@esbuild/linux-mips64el': 0.25.5
      '@esbuild/linux-ppc64': 0.25.5
      '@esbuild/linux-riscv64': 0.25.5
      '@esbuild/linux-s390x': 0.25.5
      '@esbuild/linux-x64': 0.25.5
      '@esbuild/netbsd-arm64': 0.25.5
      '@esbuild/netbsd-x64': 0.25.5
      '@esbuild/openbsd-arm64': 0.25.5
      '@esbuild/openbsd-x64': 0.25.5
      '@esbuild/sunos-x64': 0.25.5
      '@esbuild/win32-arm64': 0.25.5
      '@esbuild/win32-ia32': 0.25.5
      '@esbuild/win32-x64': 0.25.5

  escalade@3.2.0: {}

  escape-string-regexp@4.0.0: {}

  eslint-config-next@15.3.4(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3):
    dependencies:
      '@next/eslint-plugin-next': 15.3.4
      '@rushstack/eslint-patch': 1.12.0
      '@typescript-eslint/eslint-plugin': 8.35.1(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      '@typescript-eslint/parser': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      eslint: 9.30.1(jiti@1.21.7)
      eslint-import-resolver-node: 0.3.9
      eslint-import-resolver-typescript: 3.10.1(eslint-plugin-import@2.32.0)(eslint@9.30.1(jiti@1.21.7))
      eslint-plugin-import: 2.32.0(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7))
      eslint-plugin-jsx-a11y: 6.10.2(eslint@9.30.1(jiti@1.21.7))
      eslint-plugin-react: 7.37.5(eslint@9.30.1(jiti@1.21.7))
      eslint-plugin-react-hooks: 5.2.0(eslint@9.30.1(jiti@1.21.7))
    optionalDependencies:
      typescript: 5.8.3
    transitivePeerDependencies:
      - eslint-import-resolver-webpack
      - eslint-plugin-import-x
      - supports-color

  eslint-import-resolver-node@0.3.9:
    dependencies:
      debug: 3.2.7
      is-core-module: 2.16.1
      resolve: 1.22.10
    transitivePeerDependencies:
      - supports-color

  eslint-import-resolver-typescript@3.10.1(eslint-plugin-import@2.32.0)(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      '@nolyfill/is-core-module': 1.0.39
      debug: 4.4.1
      eslint: 9.30.1(jiti@1.21.7)
      get-tsconfig: 4.10.1
      is-bun-module: 2.0.0
      stable-hash: 0.0.5
      tinyglobby: 0.2.14
      unrs-resolver: 1.10.1
    optionalDependencies:
      eslint-plugin-import: 2.32.0(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7))
    transitivePeerDependencies:
      - supports-color

  eslint-module-utils@2.12.1(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-node@0.3.9)(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      debug: 3.2.7
    optionalDependencies:
      '@typescript-eslint/parser': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      eslint: 9.30.1(jiti@1.21.7)
      eslint-import-resolver-node: 0.3.9
      eslint-import-resolver-typescript: 3.10.1(eslint-plugin-import@2.32.0)(eslint@9.30.1(jiti@1.21.7))
    transitivePeerDependencies:
      - supports-color

  eslint-plugin-import@2.32.0(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      '@rtsao/scc': 1.1.0
      array-includes: 3.1.9
      array.prototype.findlastindex: 1.2.6
      array.prototype.flat: 1.3.3
      array.prototype.flatmap: 1.3.3
      debug: 3.2.7
      doctrine: 2.1.0
      eslint: 9.30.1(jiti@1.21.7)
      eslint-import-resolver-node: 0.3.9
      eslint-module-utils: 2.12.1(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-node@0.3.9)(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7))
      hasown: 2.0.2
      is-core-module: 2.16.1
      is-glob: 4.0.3
      minimatch: 3.1.2
      object.fromentries: 2.0.8
      object.groupby: 1.0.3
      object.values: 1.2.1
      semver: 6.3.1
      string.prototype.trimend: 1.0.9
      tsconfig-paths: 3.15.0
    optionalDependencies:
      '@typescript-eslint/parser': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
    transitivePeerDependencies:
      - eslint-import-resolver-typescript
      - eslint-import-resolver-webpack
      - supports-color

  eslint-plugin-jsx-a11y@6.10.2(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      aria-query: 5.3.2
      array-includes: 3.1.9
      array.prototype.flatmap: 1.3.3
      ast-types-flow: 0.0.8
      axe-core: 4.10.3
      axobject-query: 4.1.0
      damerau-levenshtein: 1.0.8
      emoji-regex: 9.2.2
      eslint: 9.30.1(jiti@1.21.7)
      hasown: 2.0.2
      jsx-ast-utils: 3.3.5
      language-tags: 1.0.9
      minimatch: 3.1.2
      object.fromentries: 2.0.8
      safe-regex-test: 1.1.0
      string.prototype.includes: 2.0.1

  eslint-plugin-react-hooks@5.2.0(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      eslint: 9.30.1(jiti@1.21.7)

  eslint-plugin-react@7.37.5(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      array-includes: 3.1.9
      array.prototype.findlast: 1.2.5
      array.prototype.flatmap: 1.3.3
      array.prototype.tosorted: 1.1.4
      doctrine: 2.1.0
      es-iterator-helpers: 1.2.1
      eslint: 9.30.1(jiti@1.21.7)
      estraverse: 5.3.0
      hasown: 2.0.2
      jsx-ast-utils: 3.3.5
      minimatch: 3.1.2
      object.entries: 1.1.9
      object.fromentries: 2.0.8
      object.values: 1.2.1
      prop-types: 15.8.1
      resolve: 2.0.0-next.5
      semver: 6.3.1
      string.prototype.matchall: 4.0.12
      string.prototype.repeat: 1.0.0

  eslint-scope@8.4.0:
    dependencies:
      esrecurse: 4.3.0
      estraverse: 5.3.0

  eslint-visitor-keys@3.4.3: {}

  eslint-visitor-keys@4.2.1: {}

  eslint@9.30.1(jiti@1.21.7):
    dependencies:
      '@eslint-community/eslint-utils': 4.7.0(eslint@9.30.1(jiti@1.21.7))
      '@eslint-community/regexpp': 4.12.1
      '@eslint/config-array': 0.21.0
      '@eslint/config-helpers': 0.3.0
      '@eslint/core': 0.14.0
      '@eslint/eslintrc': 3.3.1
      '@eslint/js': 9.30.1
      '@eslint/plugin-kit': 0.3.3
      '@humanfs/node': 0.16.6
      '@humanwhocodes/module-importer': 1.0.1
      '@humanwhocodes/retry': 0.4.3
      '@types/estree': 1.0.8
      '@types/json-schema': 7.0.15
      ajv: 6.12.6
      chalk: 4.1.2
      cross-spawn: 7.0.6
      debug: 4.4.1
      escape-string-regexp: 4.0.0
      eslint-scope: 8.4.0
      eslint-visitor-keys: 4.2.1
      espree: 10.4.0
      esquery: 1.6.0
      esutils: 2.0.3
      fast-deep-equal: 3.1.3
      file-entry-cache: 8.0.0
      find-up: 5.0.0
      glob-parent: 6.0.2
      ignore: 5.3.2
      imurmurhash: 0.1.4
      is-glob: 4.0.3
      json-stable-stringify-without-jsonify: 1.0.1
      lodash.merge: 4.6.2
      minimatch: 3.1.2
      natural-compare: 1.4.0
      optionator: 0.9.4
    optionalDependencies:
      jiti: 1.21.7
    transitivePeerDependencies:
      - supports-color

  espree@10.4.0:
    dependencies:
      acorn: 8.15.0
      acorn-jsx: 5.3.2(acorn@8.15.0)
      eslint-visitor-keys: 4.2.1

  esquery@1.6.0:
    dependencies:
      estraverse: 5.3.0

  esrecurse@4.3.0:
    dependencies:
      estraverse: 5.3.0

  estraverse@5.3.0: {}

  estree-walker@3.0.3:
    dependencies:
      '@types/estree': 1.0.8

  esutils@2.0.3: {}

  eventemitter3@4.0.7: {}

  expect-type@1.2.1: {}

  fast-deep-equal@3.1.3: {}

  fast-equals@5.2.2: {}

  fast-glob@3.3.1:
    dependencies:
      '@nodelib/fs.stat': 2.0.5
      '@nodelib/fs.walk': 1.2.8
      glob-parent: 5.1.2
      merge2: 1.4.1
      micromatch: 4.0.8

  fast-glob@3.3.3:
    dependencies:
      '@nodelib/fs.stat': 2.0.5
      '@nodelib/fs.walk': 1.2.8
      glob-parent: 5.1.2
      merge2: 1.4.1
      micromatch: 4.0.8

  fast-json-stable-stringify@2.1.0: {}

  fast-levenshtein@2.0.6: {}

  fastq@1.19.1:
    dependencies:
      reusify: 1.1.0

  fdir@6.4.6(picomatch@4.0.2):
    optionalDependencies:
      picomatch: 4.0.2

  fflate@0.8.2: {}

  file-entry-cache@8.0.0:
    dependencies:
      flat-cache: 4.0.1

  fill-range@7.1.1:
    dependencies:
      to-regex-range: 5.0.1

  find-up@5.0.0:
    dependencies:
      locate-path: 6.0.0
      path-exists: 4.0.0

  flat-cache@4.0.1:
    dependencies:
      flatted: 3.3.3
      keyv: 4.5.4

  flatted@3.3.3: {}

  follow-redirects@1.15.9: {}

  for-each@0.3.5:
    dependencies:
      is-callable: 1.2.7

  foreground-child@3.3.1:
    dependencies:
      cross-spawn: 7.0.6
      signal-exit: 4.1.0

  form-data@4.0.3:
    dependencies:
      asynckit: 0.4.0
      combined-stream: 1.0.8
      es-set-tostringtag: 2.1.0
      hasown: 2.0.2
      mime-types: 2.1.35

  fraction.js@4.3.7: {}

  fsevents@2.3.2:
    optional: true

  fsevents@2.3.3:
    optional: true

  function-bind@1.1.2: {}

  function.prototype.name@1.1.8:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      functions-have-names: 1.2.3
      hasown: 2.0.2
      is-callable: 1.2.7

  functions-have-names@1.2.3: {}

  gensync@1.0.0-beta.2: {}

  get-intrinsic@1.3.0:
    dependencies:
      call-bind-apply-helpers: 1.0.2
      es-define-property: 1.0.1
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      function-bind: 1.1.2
      get-proto: 1.0.1
      gopd: 1.2.0
      has-symbols: 1.1.0
      hasown: 2.0.2
      math-intrinsics: 1.1.0

  get-nonce@1.0.1: {}

  get-proto@1.0.1:
    dependencies:
      dunder-proto: 1.0.1
      es-object-atoms: 1.1.1

  get-symbol-description@1.1.0:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      get-intrinsic: 1.3.0

  get-tsconfig@4.10.1:
    dependencies:
      resolve-pkg-maps: 1.0.0

  glob-parent@5.1.2:
    dependencies:
      is-glob: 4.0.3

  glob-parent@6.0.2:
    dependencies:
      is-glob: 4.0.3

  glob@10.4.5:
    dependencies:
      foreground-child: 3.3.1
      jackspeak: 3.4.3
      minimatch: 9.0.5
      minipass: 7.1.2
      package-json-from-dist: 1.0.1
      path-scurry: 1.11.1

  globals@14.0.0: {}

  globalthis@1.0.4:
    dependencies:
      define-properties: 1.2.1
      gopd: 1.2.0

  gopd@1.2.0: {}

  graphemer@1.4.0: {}

  has-bigints@1.1.0: {}

  has-flag@4.0.0: {}

  has-property-descriptors@1.0.2:
    dependencies:
      es-define-property: 1.0.1

  has-proto@1.2.0:
    dependencies:
      dunder-proto: 1.0.1

  has-symbols@1.1.0: {}

  has-tostringtag@1.0.2:
    dependencies:
      has-symbols: 1.1.0

  hasown@2.0.2:
    dependencies:
      function-bind: 1.1.2

  html-encoding-sniffer@4.0.0:
    dependencies:
      whatwg-encoding: 3.1.1

  http-proxy-agent@7.0.2:
    dependencies:
      agent-base: 7.1.3
      debug: 4.4.1
    transitivePeerDependencies:
      - supports-color

  https-proxy-agent@7.0.6:
    dependencies:
      agent-base: 7.1.3
      debug: 4.4.1
    transitivePeerDependencies:
      - supports-color

  iconv-lite@0.6.3:
    dependencies:
      safer-buffer: 2.1.2

  ignore@5.3.2: {}

  ignore@7.0.5: {}

  import-fresh@3.3.1:
    dependencies:
      parent-module: 1.0.1
      resolve-from: 4.0.0

  imurmurhash@0.1.4: {}

  indent-string@4.0.0: {}

  input-otp@1.4.1(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  internal-slot@1.1.0:
    dependencies:
      es-errors: 1.3.0
      hasown: 2.0.2
      side-channel: 1.1.0

  internmap@2.0.3: {}

  is-array-buffer@3.0.5:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      get-intrinsic: 1.3.0

  is-arrayish@0.3.2:
    optional: true

  is-async-function@2.1.1:
    dependencies:
      async-function: 1.0.0
      call-bound: 1.0.4
      get-proto: 1.0.1
      has-tostringtag: 1.0.2
      safe-regex-test: 1.1.0

  is-bigint@1.1.0:
    dependencies:
      has-bigints: 1.1.0

  is-binary-path@2.1.0:
    dependencies:
      binary-extensions: 2.3.0

  is-boolean-object@1.2.2:
    dependencies:
      call-bound: 1.0.4
      has-tostringtag: 1.0.2

  is-bun-module@2.0.0:
    dependencies:
      semver: 7.7.2

  is-callable@1.2.7: {}

  is-core-module@2.16.1:
    dependencies:
      hasown: 2.0.2

  is-data-view@1.0.2:
    dependencies:
      call-bound: 1.0.4
      get-intrinsic: 1.3.0
      is-typed-array: 1.1.15

  is-date-object@1.1.0:
    dependencies:
      call-bound: 1.0.4
      has-tostringtag: 1.0.2

  is-extglob@2.1.1: {}

  is-finalizationregistry@1.1.1:
    dependencies:
      call-bound: 1.0.4

  is-fullwidth-code-point@3.0.0: {}

  is-generator-function@1.1.0:
    dependencies:
      call-bound: 1.0.4
      get-proto: 1.0.1
      has-tostringtag: 1.0.2
      safe-regex-test: 1.1.0

  is-glob@4.0.3:
    dependencies:
      is-extglob: 2.1.1

  is-map@2.0.3: {}

  is-negative-zero@2.0.3: {}

  is-number-object@1.1.1:
    dependencies:
      call-bound: 1.0.4
      has-tostringtag: 1.0.2

  is-number@7.0.0: {}

  is-potential-custom-element-name@1.0.1: {}

  is-regex@1.2.1:
    dependencies:
      call-bound: 1.0.4
      gopd: 1.2.0
      has-tostringtag: 1.0.2
      hasown: 2.0.2

  is-set@2.0.3: {}

  is-shared-array-buffer@1.0.4:
    dependencies:
      call-bound: 1.0.4

  is-string@1.1.1:
    dependencies:
      call-bound: 1.0.4
      has-tostringtag: 1.0.2

  is-symbol@1.1.1:
    dependencies:
      call-bound: 1.0.4
      has-symbols: 1.1.0
      safe-regex-test: 1.1.0

  is-typed-array@1.1.15:
    dependencies:
      which-typed-array: 1.1.19

  is-weakmap@2.0.2: {}

  is-weakref@1.1.1:
    dependencies:
      call-bound: 1.0.4

  is-weakset@2.0.4:
    dependencies:
      call-bound: 1.0.4
      get-intrinsic: 1.3.0

  isarray@2.0.5: {}

  isexe@2.0.0: {}

  iterator.prototype@1.1.5:
    dependencies:
      define-data-property: 1.1.4
      es-object-atoms: 1.1.1
      get-intrinsic: 1.3.0
      get-proto: 1.0.1
      has-symbols: 1.1.0
      set-function-name: 2.0.2

  jackspeak@3.4.3:
    dependencies:
      '@isaacs/cliui': 8.0.2
    optionalDependencies:
      '@pkgjs/parseargs': 0.11.0

  jiti@1.21.7: {}

  js-tokens@4.0.0: {}

  js-tokens@9.0.1: {}

  js-yaml@4.1.0:
    dependencies:
      argparse: 2.0.1

  jsdom@26.1.0:
    dependencies:
      cssstyle: 4.6.0
      data-urls: 5.0.0
      decimal.js: 10.5.0
      html-encoding-sniffer: 4.0.0
      http-proxy-agent: 7.0.2
      https-proxy-agent: 7.0.6
      is-potential-custom-element-name: 1.0.1
      nwsapi: 2.2.20
      parse5: 7.3.0
      rrweb-cssom: 0.8.0
      saxes: 6.0.0
      symbol-tree: 3.2.4
      tough-cookie: 5.1.2
      w3c-xmlserializer: 5.0.0
      webidl-conversions: 7.0.0
      whatwg-encoding: 3.1.1
      whatwg-mimetype: 4.0.0
      whatwg-url: 14.2.0
      ws: 8.18.3
      xml-name-validator: 5.0.0
    transitivePeerDependencies:
      - bufferutil
      - supports-color
      - utf-8-validate

  jsesc@3.1.0: {}

  json-buffer@3.0.1: {}

  json-schema-traverse@0.4.1: {}

  json-stable-stringify-without-jsonify@1.0.1: {}

  json5@1.0.2:
    dependencies:
      minimist: 1.2.8

  json5@2.2.3: {}

  jsx-ast-utils@3.3.5:
    dependencies:
      array-includes: 3.1.9
      array.prototype.flat: 1.3.3
      object.assign: 4.1.7
      object.values: 1.2.1

  keyv@4.5.4:
    dependencies:
      json-buffer: 3.0.1

  language-subtag-registry@0.3.23: {}

  language-tags@1.0.9:
    dependencies:
      language-subtag-registry: 0.3.23

  levn@0.4.1:
    dependencies:
      prelude-ls: 1.2.1
      type-check: 0.4.0

  lilconfig@3.1.3: {}

  lines-and-columns@1.2.4: {}

  locate-path@6.0.0:
    dependencies:
      p-locate: 5.0.0

  lodash.merge@4.6.2: {}

  lodash@4.17.21: {}

  loose-envify@1.4.0:
    dependencies:
      js-tokens: 4.0.0

  loupe@3.1.4: {}

  lru-cache@10.4.3: {}

  lru-cache@5.1.1:
    dependencies:
      yallist: 3.1.1

  lucide-react@0.454.0(react@19.1.0):
    dependencies:
      react: 19.1.0

  lz-string@1.5.0: {}

  magic-string@0.30.17:
    dependencies:
      '@jridgewell/sourcemap-codec': 1.5.4

  marked@4.3.0: {}

  math-intrinsics@1.1.0: {}

  merge2@1.4.1: {}

  micromatch@4.0.8:
    dependencies:
      braces: 3.0.3
      picomatch: 2.3.1

  mime-db@1.52.0: {}

  mime-types@2.1.35:
    dependencies:
      mime-db: 1.52.0

  min-indent@1.0.1: {}

  minimatch@3.1.2:
    dependencies:
      brace-expansion: 1.1.12

  minimatch@9.0.5:
    dependencies:
      brace-expansion: 2.0.2

  minimist@1.2.8: {}

  minipass@7.1.2: {}

  mrmime@2.0.1: {}

  ms@2.1.3: {}

  mz@2.7.0:
    dependencies:
      any-promise: 1.3.0
      object-assign: 4.1.1
      thenify-all: 1.6.0

  nanoid@3.3.11: {}

  napi-postinstall@0.3.0: {}

  natural-compare@1.4.0: {}

  next-themes@0.4.6(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  next@15.2.4(@babel/core@7.28.0)(@playwright/test@1.53.2)(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@next/env': 15.2.4
      '@swc/counter': 0.1.3
      '@swc/helpers': 0.5.15
      busboy: 1.6.0
      caniuse-lite: 1.0.30001726
      postcss: 8.4.31
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      styled-jsx: 5.1.6(@babel/core@7.28.0)(react@19.1.0)
    optionalDependencies:
      '@next/swc-darwin-arm64': 15.2.4
      '@next/swc-darwin-x64': 15.2.4
      '@next/swc-linux-arm64-gnu': 15.2.4
      '@next/swc-linux-arm64-musl': 15.2.4
      '@next/swc-linux-x64-gnu': 15.2.4
      '@next/swc-linux-x64-musl': 15.2.4
      '@next/swc-win32-arm64-msvc': 15.2.4
      '@next/swc-win32-x64-msvc': 15.2.4
      '@playwright/test': 1.53.2
      sharp: 0.33.5
    transitivePeerDependencies:
      - '@babel/core'
      - babel-plugin-macros

  node-releases@2.0.19: {}

  normalize-path@3.0.0: {}

  normalize-range@0.1.2: {}

  nwsapi@2.2.20: {}

  object-assign@4.1.1: {}

  object-hash@3.0.0: {}

  object-inspect@1.13.4: {}

  object-keys@1.1.1: {}

  object.assign@4.1.7:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-object-atoms: 1.1.1
      has-symbols: 1.1.0
      object-keys: 1.1.1

  object.entries@1.1.9:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-object-atoms: 1.1.1

  object.fromentries@2.0.8:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-object-atoms: 1.1.1

  object.groupby@1.0.3:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0

  object.values@1.2.1:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-object-atoms: 1.1.1

  optionator@0.9.4:
    dependencies:
      deep-is: 0.1.4
      fast-levenshtein: 2.0.6
      levn: 0.4.1
      prelude-ls: 1.2.1
      type-check: 0.4.0
      word-wrap: 1.2.5

  own-keys@1.0.1:
    dependencies:
      get-intrinsic: 1.3.0
      object-keys: 1.1.1
      safe-push-apply: 1.0.0

  p-limit@3.1.0:
    dependencies:
      yocto-queue: 0.1.0

  p-locate@5.0.0:
    dependencies:
      p-limit: 3.1.0

  package-json-from-dist@1.0.1: {}

  parent-module@1.0.1:
    dependencies:
      callsites: 3.1.0

  parse5@7.3.0:
    dependencies:
      entities: 6.0.1

  path-exists@4.0.0: {}

  path-key@3.1.1: {}

  path-parse@1.0.7: {}

  path-scurry@1.11.1:
    dependencies:
      lru-cache: 10.4.3
      minipass: 7.1.2

  pathe@2.0.3: {}

  pathval@2.0.1: {}

  picocolors@1.1.1: {}

  picomatch@2.3.1: {}

  picomatch@4.0.2: {}

  pify@2.3.0: {}

  pirates@4.0.7: {}

  playwright-core@1.53.2: {}

  playwright@1.53.2:
    dependencies:
      playwright-core: 1.53.2
    optionalDependencies:
      fsevents: 2.3.2

  possible-typed-array-names@1.1.0: {}

  postcss-import@15.1.0(postcss@8.5.6):
    dependencies:
      postcss: 8.5.6
      postcss-value-parser: 4.2.0
      read-cache: 1.0.0
      resolve: 1.22.10

  postcss-js@4.0.1(postcss@8.5.6):
    dependencies:
      camelcase-css: 2.0.1
      postcss: 8.5.6

  postcss-load-config@4.0.2(postcss@8.5.6):
    dependencies:
      lilconfig: 3.1.3
      yaml: 2.8.0
    optionalDependencies:
      postcss: 8.5.6

  postcss-nested@6.2.0(postcss@8.5.6):
    dependencies:
      postcss: 8.5.6
      postcss-selector-parser: 6.1.2

  postcss-selector-parser@6.1.2:
    dependencies:
      cssesc: 3.0.0
      util-deprecate: 1.0.2

  postcss-value-parser@4.2.0: {}

  postcss@8.4.31:
    dependencies:
      nanoid: 3.3.11
      picocolors: 1.1.1
      source-map-js: 1.2.1

  postcss@8.5.6:
    dependencies:
      nanoid: 3.3.11
      picocolors: 1.1.1
      source-map-js: 1.2.1

  prelude-ls@1.2.1: {}

  pretty-format@27.5.1:
    dependencies:
      ansi-regex: 5.0.1
      ansi-styles: 5.2.0
      react-is: 17.0.2

  prop-types@15.8.1:
    dependencies:
      loose-envify: 1.4.0
      object-assign: 4.1.1
      react-is: 16.13.1

  proxy-from-env@1.1.0: {}

  punycode@2.3.1: {}

  queue-microtask@1.2.3: {}

  react-day-picker@8.10.1(date-fns@4.1.0)(react@19.1.0):
    dependencies:
      date-fns: 4.1.0
      react: 19.1.0

  react-dom@19.1.0(react@19.1.0):
    dependencies:
      react: 19.1.0
      scheduler: 0.26.0

  react-hook-form@7.59.0(react@19.1.0):
    dependencies:
      react: 19.1.0

  react-is@16.13.1: {}

  react-is@17.0.2: {}

  react-is@18.3.1: {}

  react-refresh@0.17.0: {}

  react-remove-scroll-bar@2.3.8(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-style-singleton: 2.2.3(@types/react@19.1.8)(react@19.1.0)
      tslib: 2.8.1
    optionalDependencies:
      '@types/react': 19.1.8

  react-remove-scroll@2.7.1(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-remove-scroll-bar: 2.3.8(@types/react@19.1.8)(react@19.1.0)
      react-style-singleton: 2.2.3(@types/react@19.1.8)(react@19.1.0)
      tslib: 2.8.1
      use-callback-ref: 1.3.3(@types/react@19.1.8)(react@19.1.0)
      use-sidecar: 1.1.3(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8

  react-resizable-panels@2.1.9(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  react-simplemde-editor@5.2.0(easymde@2.20.0)(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@types/codemirror': 5.60.16
      easymde: 2.20.0
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  react-smooth@4.0.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      fast-equals: 5.2.2
      prop-types: 15.8.1
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-transition-group: 4.4.5(react-dom@19.1.0(react@19.1.0))(react@19.1.0)

  react-style-singleton@2.2.3(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      get-nonce: 1.0.1
      react: 19.1.0
      tslib: 2.8.1
    optionalDependencies:
      '@types/react': 19.1.8

  react-transition-group@4.4.5(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@babel/runtime': 7.27.6
      dom-helpers: 5.2.1
      loose-envify: 1.4.0
      prop-types: 15.8.1
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  react@19.1.0: {}

  read-cache@1.0.0:
    dependencies:
      pify: 2.3.0

  readdirp@3.6.0:
    dependencies:
      picomatch: 2.3.1

  recharts-scale@0.4.5:
    dependencies:
      decimal.js-light: 2.5.1

  recharts@2.15.0(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      clsx: 2.1.1
      eventemitter3: 4.0.7
      lodash: 4.17.21
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-is: 18.3.1
      react-smooth: 4.0.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      recharts-scale: 0.4.5
      tiny-invariant: 1.3.3
      victory-vendor: 36.9.2

  redent@3.0.0:
    dependencies:
      indent-string: 4.0.0
      strip-indent: 3.0.0

  reflect.getprototypeof@1.0.10:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      get-intrinsic: 1.3.0
      get-proto: 1.0.1
      which-builtin-type: 1.2.1

  regexp.prototype.flags@1.5.4:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-errors: 1.3.0
      get-proto: 1.0.1
      gopd: 1.2.0
      set-function-name: 2.0.2

  resolve-from@4.0.0: {}

  resolve-pkg-maps@1.0.0: {}

  resolve@1.22.10:
    dependencies:
      is-core-module: 2.16.1
      path-parse: 1.0.7
      supports-preserve-symlinks-flag: 1.0.0

  resolve@2.0.0-next.5:
    dependencies:
      is-core-module: 2.16.1
      path-parse: 1.0.7
      supports-preserve-symlinks-flag: 1.0.0

  reusify@1.1.0: {}

  rollup@4.44.1:
    dependencies:
      '@types/estree': 1.0.8
    optionalDependencies:
      '@rollup/rollup-android-arm-eabi': 4.44.1
      '@rollup/rollup-android-arm64': 4.44.1
      '@rollup/rollup-darwin-arm64': 4.44.1
      '@rollup/rollup-darwin-x64': 4.44.1
      '@rollup/rollup-freebsd-arm64': 4.44.1
      '@rollup/rollup-freebsd-x64': 4.44.1
      '@rollup/rollup-linux-arm-gnueabihf': 4.44.1
      '@rollup/rollup-linux-arm-musleabihf': 4.44.1
      '@rollup/rollup-linux-arm64-gnu': 4.44.1
      '@rollup/rollup-linux-arm64-musl': 4.44.1
      '@rollup/rollup-linux-loongarch64-gnu': 4.44.1
      '@rollup/rollup-linux-powerpc64le-gnu': 4.44.1
      '@rollup/rollup-linux-riscv64-gnu': 4.44.1
      '@rollup/rollup-linux-riscv64-musl': 4.44.1
      '@rollup/rollup-linux-s390x-gnu': 4.44.1
      '@rollup/rollup-linux-x64-gnu': 4.44.1
      '@rollup/rollup-linux-x64-musl': 4.44.1
      '@rollup/rollup-win32-arm64-msvc': 4.44.1
      '@rollup/rollup-win32-ia32-msvc': 4.44.1
      '@rollup/rollup-win32-x64-msvc': 4.44.1
      fsevents: 2.3.3

  rrweb-cssom@0.8.0: {}

  run-parallel@1.2.0:
    dependencies:
      queue-microtask: 1.2.3

  safe-array-concat@1.1.3:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      get-intrinsic: 1.3.0
      has-symbols: 1.1.0
      isarray: 2.0.5

  safe-push-apply@1.0.0:
    dependencies:
      es-errors: 1.3.0
      isarray: 2.0.5

  safe-regex-test@1.1.0:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-regex: 1.2.1

  safer-buffer@2.1.2: {}

  saxes@6.0.0:
    dependencies:
      xmlchars: 2.2.0

  scheduler@0.26.0: {}

  semver@6.3.1: {}

  semver@7.7.2: {}

  set-function-length@1.2.2:
    dependencies:
      define-data-property: 1.1.4
      es-errors: 1.3.0
      function-bind: 1.1.2
      get-intrinsic: 1.3.0
      gopd: 1.2.0
      has-property-descriptors: 1.0.2

  set-function-name@2.0.2:
    dependencies:
      define-data-property: 1.1.4
      es-errors: 1.3.0
      functions-have-names: 1.2.3
      has-property-descriptors: 1.0.2

  set-proto@1.0.0:
    dependencies:
      dunder-proto: 1.0.1
      es-errors: 1.3.0
      es-object-atoms: 1.1.1

  sharp@0.33.5:
    dependencies:
      color: 4.2.3
      detect-libc: 2.0.4
      semver: 7.7.2
    optionalDependencies:
      '@img/sharp-darwin-arm64': 0.33.5
      '@img/sharp-darwin-x64': 0.33.5
      '@img/sharp-libvips-darwin-arm64': 1.0.4
      '@img/sharp-libvips-darwin-x64': 1.0.4
      '@img/sharp-libvips-linux-arm': 1.0.5
      '@img/sharp-libvips-linux-arm64': 1.0.4
      '@img/sharp-libvips-linux-s390x': 1.0.4
      '@img/sharp-libvips-linux-x64': 1.0.4
      '@img/sharp-libvips-linuxmusl-arm64': 1.0.4
      '@img/sharp-libvips-linuxmusl-x64': 1.0.4
      '@img/sharp-linux-arm': 0.33.5
      '@img/sharp-linux-arm64': 0.33.5
      '@img/sharp-linux-s390x': 0.33.5
      '@img/sharp-linux-x64': 0.33.5
      '@img/sharp-linuxmusl-arm64': 0.33.5
      '@img/sharp-linuxmusl-x64': 0.33.5
      '@img/sharp-wasm32': 0.33.5
      '@img/sharp-win32-ia32': 0.33.5
      '@img/sharp-win32-x64': 0.33.5
    optional: true

  shebang-command@2.0.0:
    dependencies:
      shebang-regex: 3.0.0

  shebang-regex@3.0.0: {}

  side-channel-list@1.0.0:
    dependencies:
      es-errors: 1.3.0
      object-inspect: 1.13.4

  side-channel-map@1.0.1:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      get-intrinsic: 1.3.0
      object-inspect: 1.13.4

  side-channel-weakmap@1.0.2:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      get-intrinsic: 1.3.0
      object-inspect: 1.13.4
      side-channel-map: 1.0.1

  side-channel@1.1.0:
    dependencies:
      es-errors: 1.3.0
      object-inspect: 1.13.4
      side-channel-list: 1.0.0
      side-channel-map: 1.0.1
      side-channel-weakmap: 1.0.2

  siginfo@2.0.0: {}

  signal-exit@4.1.0: {}

  simple-swizzle@0.2.2:
    dependencies:
      is-arrayish: 0.3.2
    optional: true

  sirv@3.0.1:
    dependencies:
      '@polka/url': 1.0.0-next.29
      mrmime: 2.0.1
      totalist: 3.0.1

  sonner@1.7.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  source-map-js@1.2.1: {}

  stable-hash@0.0.5: {}

  stackback@0.0.2: {}

  std-env@3.9.0: {}

  stop-iteration-iterator@1.1.0:
    dependencies:
      es-errors: 1.3.0
      internal-slot: 1.1.0

  streamsearch@1.1.0: {}

  string-width@4.2.3:
    dependencies:
      emoji-regex: 8.0.0
      is-fullwidth-code-point: 3.0.0
      strip-ansi: 6.0.1

  string-width@5.1.2:
    dependencies:
      eastasianwidth: 0.2.0
      emoji-regex: 9.2.2
      strip-ansi: 7.1.0

  string.prototype.includes@2.0.1:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0

  string.prototype.matchall@4.0.12:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      get-intrinsic: 1.3.0
      gopd: 1.2.0
      has-symbols: 1.1.0
      internal-slot: 1.1.0
      regexp.prototype.flags: 1.5.4
      set-function-name: 2.0.2
      side-channel: 1.1.0

  string.prototype.repeat@1.0.0:
    dependencies:
      define-properties: 1.2.1
      es-abstract: 1.24.0

  string.prototype.trim@1.2.10:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-data-property: 1.1.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-object-atoms: 1.1.1
      has-property-descriptors: 1.0.2

  string.prototype.trimend@1.0.9:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-object-atoms: 1.1.1

  string.prototype.trimstart@1.0.8:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-object-atoms: 1.1.1

  strip-ansi@6.0.1:
    dependencies:
      ansi-regex: 5.0.1

  strip-ansi@7.1.0:
    dependencies:
      ansi-regex: 6.1.0

  strip-bom@3.0.0: {}

  strip-indent@3.0.0:
    dependencies:
      min-indent: 1.0.1

  strip-json-comments@3.1.1: {}

  strip-literal@3.0.0:
    dependencies:
      js-tokens: 9.0.1

  styled-jsx@5.1.6(@babel/core@7.28.0)(react@19.1.0):
    dependencies:
      client-only: 0.0.1
      react: 19.1.0
    optionalDependencies:
      '@babel/core': 7.28.0

  sucrase@3.35.0:
    dependencies:
      '@jridgewell/gen-mapping': 0.3.12
      commander: 4.1.1
      glob: 10.4.5
      lines-and-columns: 1.2.4
      mz: 2.7.0
      pirates: 4.0.7
      ts-interface-checker: 0.1.13

  supports-color@7.2.0:
    dependencies:
      has-flag: 4.0.0

  supports-preserve-symlinks-flag@1.0.0: {}

  symbol-tree@3.2.4: {}

  tailwind-merge@2.6.0: {}

  tailwindcss-animate@1.0.7(tailwindcss@3.4.17):
    dependencies:
      tailwindcss: 3.4.17

  tailwindcss@3.4.17:
    dependencies:
      '@alloc/quick-lru': 5.2.0
      arg: 5.0.2
      chokidar: 3.6.0
      didyoumean: 1.2.2
      dlv: 1.1.3
      fast-glob: 3.3.3
      glob-parent: 6.0.2
      is-glob: 4.0.3
      jiti: 1.21.7
      lilconfig: 3.1.3
      micromatch: 4.0.8
      normalize-path: 3.0.0
      object-hash: 3.0.0
      picocolors: 1.1.1
      postcss: 8.5.6
      postcss-import: 15.1.0(postcss@8.5.6)
      postcss-js: 4.0.1(postcss@8.5.6)
      postcss-load-config: 4.0.2(postcss@8.5.6)
      postcss-nested: 6.2.0(postcss@8.5.6)
      postcss-selector-parser: 6.1.2
      resolve: 1.22.10
      sucrase: 3.35.0
    transitivePeerDependencies:
      - ts-node

  thenify-all@1.6.0:
    dependencies:
      thenify: 3.3.1

  thenify@3.3.1:
    dependencies:
      any-promise: 1.3.0

  tiny-invariant@1.3.3: {}

  tinybench@2.9.0: {}

  tinyexec@0.3.2: {}

  tinyglobby@0.2.14:
    dependencies:
      fdir: 6.4.6(picomatch@4.0.2)
      picomatch: 4.0.2

  tinypool@1.1.1: {}

  tinyrainbow@2.0.0: {}

  tinyspy@4.0.3: {}

  tldts-core@6.1.86: {}

  tldts@6.1.86:
    dependencies:
      tldts-core: 6.1.86

  to-regex-range@5.0.1:
    dependencies:
      is-number: 7.0.0

  totalist@3.0.1: {}

  tough-cookie@5.1.2:
    dependencies:
      tldts: 6.1.86

  tr46@5.1.1:
    dependencies:
      punycode: 2.3.1

  ts-api-utils@2.1.0(typescript@5.8.3):
    dependencies:
      typescript: 5.8.3

  ts-interface-checker@0.1.13: {}

  tsconfig-paths@3.15.0:
    dependencies:
      '@types/json5': 0.0.29
      json5: 1.0.2
      minimist: 1.2.8
      strip-bom: 3.0.0

  tslib@2.8.1: {}

  type-check@0.4.0:
    dependencies:
      prelude-ls: 1.2.1

  typed-array-buffer@1.0.3:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-typed-array: 1.1.15

  typed-array-byte-length@1.0.3:
    dependencies:
      call-bind: 1.0.8
      for-each: 0.3.5
      gopd: 1.2.0
      has-proto: 1.2.0
      is-typed-array: 1.1.15

  typed-array-byte-offset@1.0.4:
    dependencies:
      available-typed-arrays: 1.0.7
      call-bind: 1.0.8
      for-each: 0.3.5
      gopd: 1.2.0
      has-proto: 1.2.0
      is-typed-array: 1.1.15
      reflect.getprototypeof: 1.0.10

  typed-array-length@1.0.7:
    dependencies:
      call-bind: 1.0.8
      for-each: 0.3.5
      gopd: 1.2.0
      is-typed-array: 1.1.15
      possible-typed-array-names: 1.1.0
      reflect.getprototypeof: 1.0.10

  typescript@5.8.3: {}

  typo-js@1.2.5: {}

  unbox-primitive@1.1.0:
    dependencies:
      call-bound: 1.0.4
      has-bigints: 1.1.0
      has-symbols: 1.1.0
      which-boxed-primitive: 1.1.1

  undici-types@6.21.0: {}

  unrs-resolver@1.10.1:
    dependencies:
      napi-postinstall: 0.3.0
    optionalDependencies:
      '@unrs/resolver-binding-android-arm-eabi': 1.10.1
      '@unrs/resolver-binding-android-arm64': 1.10.1
      '@unrs/resolver-binding-darwin-arm64': 1.10.1
      '@unrs/resolver-binding-darwin-x64': 1.10.1
      '@unrs/resolver-binding-freebsd-x64': 1.10.1
      '@unrs/resolver-binding-linux-arm-gnueabihf': 1.10.1
      '@unrs/resolver-binding-linux-arm-musleabihf': 1.10.1
      '@unrs/resolver-binding-linux-arm64-gnu': 1.10.1
      '@unrs/resolver-binding-linux-arm64-musl': 1.10.1
      '@unrs/resolver-binding-linux-ppc64-gnu': 1.10.1
      '@unrs/resolver-binding-linux-riscv64-gnu': 1.10.1
      '@unrs/resolver-binding-linux-riscv64-musl': 1.10.1
      '@unrs/resolver-binding-linux-s390x-gnu': 1.10.1
      '@unrs/resolver-binding-linux-x64-gnu': 1.10.1
      '@unrs/resolver-binding-linux-x64-musl': 1.10.1
      '@unrs/resolver-binding-wasm32-wasi': 1.10.1
      '@unrs/resolver-binding-win32-arm64-msvc': 1.10.1
      '@unrs/resolver-binding-win32-ia32-msvc': 1.10.1
      '@unrs/resolver-binding-win32-x64-msvc': 1.10.1

  update-browserslist-db@1.1.3(browserslist@4.25.1):
    dependencies:
      browserslist: 4.25.1
      escalade: 3.2.0
      picocolors: 1.1.1

  uri-js@4.4.1:
    dependencies:
      punycode: 2.3.1

  use-callback-ref@1.3.3(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      react: 19.1.0
      tslib: 2.8.1
    optionalDependencies:
      '@types/react': 19.1.8

  use-sidecar@1.1.3(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      detect-node-es: 1.1.0
      react: 19.1.0
      tslib: 2.8.1
    optionalDependencies:
      '@types/react': 19.1.8

  use-sync-external-store@1.5.0(react@19.1.0):
    dependencies:
      react: 19.1.0

  util-deprecate@1.0.2: {}

  vaul@0.9.9(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@radix-ui/react-dialog': 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    transitivePeerDependencies:
      - '@types/react'
      - '@types/react-dom'

  victory-vendor@36.9.2:
    dependencies:
      '@types/d3-array': 3.2.1
      '@types/d3-ease': 3.0.2
      '@types/d3-interpolate': 3.0.4
      '@types/d3-scale': 4.0.9
      '@types/d3-shape': 3.1.7
      '@types/d3-time': 3.0.4
      '@types/d3-timer': 3.0.2
      d3-array: 3.2.4
      d3-ease: 3.0.1
      d3-interpolate: 3.0.1
      d3-scale: 4.0.2
      d3-shape: 3.2.0
      d3-time: 3.1.0
      d3-timer: 3.0.1

  vite-node@3.2.4(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0):
    dependencies:
      cac: 6.7.14
      debug: 4.4.1
      es-module-lexer: 1.7.0
      pathe: 2.0.3
      vite: 7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)
    transitivePeerDependencies:
      - '@types/node'
      - jiti
      - less
      - lightningcss
      - sass
      - sass-embedded
      - stylus
      - sugarss
      - supports-color
      - terser
      - tsx
      - yaml

  vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0):
    dependencies:
      esbuild: 0.25.5
      fdir: 6.4.6(picomatch@4.0.2)
      picomatch: 4.0.2
      postcss: 8.5.6
      rollup: 4.44.1
      tinyglobby: 0.2.14
    optionalDependencies:
      '@types/node': 22.16.0
      fsevents: 2.3.3
      jiti: 1.21.7
      yaml: 2.8.0

  vitest@3.2.4(@types/node@22.16.0)(@vitest/ui@3.2.4)(jiti@1.21.7)(jsdom@26.1.0)(yaml@2.8.0):
    dependencies:
      '@types/chai': 5.2.2
      '@vitest/expect': 3.2.4
      '@vitest/mocker': 3.2.4(vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0))
      '@vitest/pretty-format': 3.2.4
      '@vitest/runner': 3.2.4
      '@vitest/snapshot': 3.2.4
      '@vitest/spy': 3.2.4
      '@vitest/utils': 3.2.4
      chai: 5.2.0
      debug: 4.4.1
      expect-type: 1.2.1
      magic-string: 0.30.17
      pathe: 2.0.3
      picomatch: 4.0.2
      std-env: 3.9.0
      tinybench: 2.9.0
      tinyexec: 0.3.2
      tinyglobby: 0.2.14
      tinypool: 1.1.1
      tinyrainbow: 2.0.0
      vite: 7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)
      vite-node: 3.2.4(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)
      why-is-node-running: 2.3.0
    optionalDependencies:
      '@types/node': 22.16.0
      '@vitest/ui': 3.2.4(vitest@3.2.4)
      jsdom: 26.1.0
    transitivePeerDependencies:
      - jiti
      - less
      - lightningcss
      - msw
      - sass
      - sass-embedded
      - stylus
      - sugarss
      - supports-color
      - terser
      - tsx
      - yaml

  w3c-xmlserializer@5.0.0:
    dependencies:
      xml-name-validator: 5.0.0

  webidl-conversions@7.0.0: {}

  whatwg-encoding@3.1.1:
    dependencies:
      iconv-lite: 0.6.3

  whatwg-mimetype@4.0.0: {}

  whatwg-url@14.2.0:
    dependencies:
      tr46: 5.1.1
      webidl-conversions: 7.0.0

  which-boxed-primitive@1.1.1:
    dependencies:
      is-bigint: 1.1.0
      is-boolean-object: 1.2.2
      is-number-object: 1.1.1
      is-string: 1.1.1
      is-symbol: 1.1.1

  which-builtin-type@1.2.1:
    dependencies:
      call-bound: 1.0.4
      function.prototype.name: 1.1.8
      has-tostringtag: 1.0.2
      is-async-function: 2.1.1
      is-date-object: 1.1.0
      is-finalizationregistry: 1.1.1
      is-generator-function: 1.1.0
      is-regex: 1.2.1
      is-weakref: 1.1.1
      isarray: 2.0.5
      which-boxed-primitive: 1.1.1
      which-collection: 1.0.2
      which-typed-array: 1.1.19

  which-collection@1.0.2:
    dependencies:
      is-map: 2.0.3
      is-set: 2.0.3
      is-weakmap: 2.0.2
      is-weakset: 2.0.4

  which-typed-array@1.1.19:
    dependencies:
      available-typed-arrays: 1.0.7
      call-bind: 1.0.8
      call-bound: 1.0.4
      for-each: 0.3.5
      get-proto: 1.0.1
      gopd: 1.2.0
      has-tostringtag: 1.0.2

  which@2.0.2:
    dependencies:
      isexe: 2.0.0

  why-is-node-running@2.3.0:
    dependencies:
      siginfo: 2.0.0
      stackback: 0.0.2

  word-wrap@1.2.5: {}

  wrap-ansi@7.0.0:
    dependencies:
      ansi-styles: 4.3.0
      string-width: 4.2.3
      strip-ansi: 6.0.1

  wrap-ansi@8.1.0:
    dependencies:
      ansi-styles: 6.2.1
      string-width: 5.1.2
      strip-ansi: 7.1.0

  ws@8.18.3: {}

  xml-name-validator@5.0.0: {}

  xmlchars@2.2.0: {}

  yallist@3.1.1: {}

  yaml@2.8.0: {}

  yocto-queue@0.1.0: {}

  zod@3.25.71: {}

  zustand@5.0.6(@types/react@19.1.8)(react@19.1.0)(use-sync-external-store@1.5.0(react@19.1.0)):
    optionalDependencies:
      '@types/react': 19.1.8
      react: 19.1.0
      use-sync-external-store: 1.5.0(react@19.1.0)


# END FILE CONTENTS


# File: frontend/postcss.config.mjs

/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

export default config;


# END FILE CONTENTS


# File: app/services/stt/interfaces.py

"""
æœå‹™ä»‹é¢å®šç¾©
"""

from __future__ import annotations
from abc import ABC, abstractmethod
from typing import Any, Dict
from uuid import UUID


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1ï¸âƒ£ èˆŠçš„ TranscriptionServiceï¼ˆè‹¥åˆ¥è™•é‚„åœ¨ç”¨ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class TranscriptionService(ABC):
    """è½‰éŒ„æœå‹™æŠ½è±¡åŸºç¤é¡ï¼ˆèˆŠï¼‰"""

    @abstractmethod
    async def process_audio_chunk(
        self, session_id: UUID, chunk_sequence: int, webm_data: bytes
    ) -> None:
        """è™•ç†ä¸€å€‹éŸ³è¨Šåˆ‡ç‰‡"""
        raise NotImplementedError

    @abstractmethod
    async def shutdown(self) -> None:
        """å„ªé›…åœ°é—œé–‰æœå‹™"""
        raise NotImplementedError


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2ï¸âƒ£ æ–°çš„ ISTTProviderï¼šfactory èˆ‡å„ provider ä½¿ç”¨
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class ISTTProvider(ABC):
    """
    Speech-to-Text Provider ä»‹é¢ã€‚

    æ¯å€‹ providerï¼ˆWhisper/GPT-4o/Geminiâ€¦ï¼‰éƒ½è¦å¯¦ä½œ `transcribe`ã€‚
    """

    # provider çš„è­˜åˆ¥ç¢¼
    name: str  # ç›´æ¥å±¬æ€§ï¼Œç¦æ­¢å†å®šç¾©åŒåæ–¹æ³•

    @abstractmethod
    async def transcribe(
        self, audio: bytes, session_id: UUID, chunk_seq: int
    ) -> Dict[str, Any] | None:
        """
        :param audio: 10s WebM/WAV bytes
        :return: çµ±ä¸€æ¬„ä½ dictï¼Œè‹¥ `None` ä»£è¡¨ç„¡æ–‡å­—
        """
        raise NotImplementedError

    # å¯é¸ï¼šæ¯åˆ†é˜æœ€å¤§è«‹æ±‚æ•¸ï¼Œçµ¦æ’ç¨‹å™¨åƒè€ƒ
    def max_rpm(self) -> int:
        return 60


__all__ = ["ISTTProvider", "TranscriptionService"]


# END FILE CONTENTS


# File: frontend/lib/simple-audio-recorder.ts

"use client"

import { getAudioChunkIntervalMs } from './config'

/**
 * SimpleAudioRecorder - ç°¡åŒ–éŸ³è¨ŠéŒ„è£½å™¨
 *
 * Phase 2 é‡æ§‹ï¼šç§»é™¤è¤‡é›œçš„ SegmentedAudioRecorder é‚è¼¯
 * æ”¹ç”¨æ¨™æº– MediaRecorder + timeslice æ¨¡å¼ï¼ˆå¯é…ç½®ï¼‰
 *
 * ç‰¹é»ï¼š
 * - ä½¿ç”¨ MediaRecorder.start(timeslice) è‡ªå‹•åˆ‡ç‰‡
 * - æ¯å€‹æ®µè½åŒ…å«å®Œæ•´ WebM Header
 * - ç°¡åŒ–éŒ¯èª¤è™•ç†
 * - ç§»é™¤éæ­¸å•Ÿå‹•/åœæ­¢è¤‡é›œæ€§
 * - æ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®åˆ‡ç‰‡æ™‚é–“
 */

export interface AudioSegment {
    blob: Blob
    timestamp: number
    duration: number
    sequence: number
}

export interface SimpleAudioRecorderConfig {
    segmentDuration: number // æ®µè½æ™‚é•·ï¼ˆæ¯«ç§’ï¼‰
    mimeType: string
    audioBitsPerSecond: number
}

const DEFAULT_CONFIG: SimpleAudioRecorderConfig = {
    segmentDuration: getAudioChunkIntervalMs(), // å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
    mimeType: 'audio/webm;codecs=opus',
    audioBitsPerSecond: 128000, // 128 kbps for configurable chunks
}

export class SimpleAudioRecorder {
    private stream: MediaStream | null = null
    private mediaRecorder: MediaRecorder | null = null
    private config: SimpleAudioRecorderConfig
    private sequence: number = 0
    private isRecording: boolean = false

    // äº‹ä»¶å›èª¿
    private onSegmentCallback?: (segment: AudioSegment) => void
    private onErrorCallback?: (error: Error) => void

    constructor(config: Partial<SimpleAudioRecorderConfig> = {}) {
        this.config = { ...DEFAULT_CONFIG, ...config }
    }

    /**
     * åˆå§‹åŒ–éŒ„éŸ³å™¨ - ç²å–éŸ³è¨Šæ¬Šé™
     */
    async initialize(): Promise<void> {
        if (this.stream) {
            return // å·²åˆå§‹åŒ–
        }

        try {
            this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })
            console.log('ğŸ¤ [SimpleAudioRecorder] éŸ³è¨Šæ¬Šé™ç²å–æˆåŠŸ')
        } catch (error) {
            const errorMsg = error instanceof Error ? error.message : 'ç²å–éŸ³è¨Šæ¬Šé™å¤±æ•—'
            this.handleError(new Error(errorMsg))
            throw error
        }
    }

    /**
     * é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨æ¨™æº– MediaRecorder + timeslice
     */
    async start(onSegmentAvailable: (segment: AudioSegment) => void): Promise<void> {
        if (this.isRecording) {
            throw new Error('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
        }

        if (!this.stream) {
            await this.initialize()
        }

        this.onSegmentCallback = onSegmentAvailable
        this.sequence = 0
        this.isRecording = true

        console.log('ğŸ¬ [SimpleAudioRecorder] é–‹å§‹éŒ„éŸ³', {
            segmentDuration: this.config.segmentDuration,
            mimeType: this.config.mimeType,
            audioBitsPerSecond: this.config.audioBitsPerSecond
        })

        // å»ºç«‹ MediaRecorder å¯¦ä¾‹
        this.mediaRecorder = new MediaRecorder(this.stream!, {
            mimeType: this.config.mimeType,
            audioBitsPerSecond: this.config.audioBitsPerSecond,
        })

        // è¨­å®šè³‡æ–™æ¥æ”¶è™•ç†
        this.mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0 && this.isRecording) {
                console.log(`ğŸ“¦ [SimpleAudioRecorder] æ®µè½ #${this.sequence} å®Œæˆ`, {
                    size: event.data.size,
                    mimeType: this.config.mimeType,
                })

                const segment: AudioSegment = {
                    blob: event.data,
                    timestamp: Date.now(),
                    duration: this.config.segmentDuration,
                    sequence: this.sequence++,
                }

                // å›èª¿é€šçŸ¥æœ‰æ–°æ®µè½å¯ç”¨
                this.onSegmentCallback?.(segment)
            }
        }

        // éŒ¯èª¤è™•ç†
        this.mediaRecorder.onerror = (event) => {
            console.error('âŒ [SimpleAudioRecorder] MediaRecorder éŒ¯èª¤:', event)
            this.handleError(new Error(`MediaRecorder éŒ¯èª¤: ${event}`))
        }

        // é–‹å§‹éŒ„è£½ï¼Œä½¿ç”¨ timeslice è‡ªå‹•åˆ‡ç‰‡
        this.mediaRecorder.start(this.config.segmentDuration)
        console.log('âœ… [SimpleAudioRecorder] MediaRecorder å·²å•Ÿå‹•ï¼Œè‡ªå‹• 10 ç§’åˆ‡ç‰‡')
    }

    /**
     * åœæ­¢éŒ„éŸ³
     */
    stop(): void {
        console.log('â¹ï¸ [SimpleAudioRecorder] åœæ­¢éŒ„éŸ³')

        this.isRecording = false

        if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {
            this.mediaRecorder.stop()
        }
    }

    /**
     * æ¸…ç†è³‡æº
     */
    cleanup(): void {
        this.stop()

        if (this.stream) {
            this.stream.getTracks().forEach(track => track.stop())
            this.stream = null
        }

        this.mediaRecorder = null
        this.sequence = 0
        console.log('ğŸ§¹ [SimpleAudioRecorder] å·²æ¸…ç†')
    }

    /**
     * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
     */
    get recording(): boolean {
        return this.isRecording
    }

    /**
     * ç²å–ç•¶å‰åºè™Ÿ
     */
    get currentSequence(): number {
        return this.sequence
    }

    /**
     * ç²å–ç•¶å‰é…ç½®
     */
    get currentConfig(): SimpleAudioRecorderConfig {
        return { ...this.config }
    }

    // éŒ¯èª¤è™•ç†
    private handleError(error: Error): void {
        console.error('âŒ [SimpleAudioRecorder] éŒ¯èª¤:', error)
        this.isRecording = false
        this.onErrorCallback?.(error)
    }

    // äº‹ä»¶å›èª¿è¨­å®š
    onSegment(callback: (segment: AudioSegment) => void): void {
        this.onSegmentCallback = callback
    }

    onError(callback: (error: Error) => void): void {
        this.onErrorCallback = callback
    }
}

// å·¥å» å‡½æ•¸
export const createSimpleAudioRecorder = (config?: Partial<SimpleAudioRecorderConfig>): SimpleAudioRecorder => {
    return new SimpleAudioRecorder(config)
}

/**
 * æª¢æŸ¥ç€è¦½å™¨éŸ³è¨ŠéŒ„è£½æ”¯æ´
 */
export async function checkSimpleAudioRecordingSupport(): Promise<{ isSupported: boolean; error?: string }> {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API' }
    }

    if (!window.MediaRecorder) {
        return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API' }
    }

    // æª¢æŸ¥ MIME é¡å‹æ”¯æ´
    if (!MediaRecorder.isTypeSupported(DEFAULT_CONFIG.mimeType)) {
        return { isSupported: false, error: `ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${DEFAULT_CONFIG.mimeType}` }
    }

    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
        // ç«‹å³åœæ­¢ä¸²æµä»¥é‡‹æ”¾è³‡æº
        stream.getTracks().forEach(track => track.stop())
        return { isSupported: true }
    } catch (error) {
        return { isSupported: false, error: `ç„¡æ³•ç²å–éº¥å…‹é¢¨æ¬Šé™: ${error}` }
    }
}


# END FILE CONTENTS


# File: app/core/ffmpeg.py

"""
FFmpeg éŸ³è¨Šè½‰æ›æœå‹™ (REST API ç°¡åŒ–æ¶æ§‹)

å¯¦ä½œ WebM åˆ° 16kHz mono PCM çš„è½‰æ›ï¼Œå°ˆé–€è™•ç†å®Œæ•´ 10s æª”æ¡ˆ
"""

import asyncio
import subprocess
import shlex
import logging
from typing import Optional
from dataclasses import dataclass

logger = logging.getLogger(__name__)

# FFmpeg å‘½ä»¤ï¼šWebM è¼¸å…¥ â†’ 16kHz å–®è²é“ PCM è¼¸å‡º
FFMPEG_CMD = "ffmpeg -i pipe:0 -ac 1 -ar 16000 -f s16le pipe:1 -loglevel error"


@dataclass
class WebMHeaderInfo:
    """WebM æª”é ­ä¿¡æ¯æ•¸æ“šé¡"""
    is_complete: bool = False
    has_ebml_header: bool = False
    has_segment: bool = False
    header_size: int = 0
    codec_type: str = "unknown"
    track_count: int = 0
    error_message: Optional[str] = None


def detect_webm_header_info(data: bytes) -> WebMHeaderInfo:
    """
    æª¢æ¸¬ WebM æª”é ­ä¿¡æ¯

    Args:
        data: WebM éŸ³é »äºŒé€²åˆ¶æ•¸æ“š

    Returns:
        WebMHeaderInfo: æª”é ­ä¿¡æ¯
    """
    info = WebMHeaderInfo()

    if not data or len(data) < 16:
        info.error_message = "æ•¸æ“šé•·åº¦ä¸è¶³"
        return info

    try:
        # æª¢æŸ¥ EBML æ¨™é ­ (0x1A45DFA3)
        if data[:4] == b'\x1A\x45\xDF\xA3':
            info.has_ebml_header = True

            # ç°¡å–®æª¢æ¸¬ Segment å…ƒç´  (0x18538067)
            if b'\x18\x53\x80\x67' in data[:1024]:
                info.has_segment = True

                # ä¼°ç®—æª”é ­å¤§å°ï¼ˆç°¡åŒ–ç‰ˆæœ¬ï¼‰
                cluster_pos = data.find(b'\x1F\x43\xB6\x75')  # Cluster æ¨™è¨˜
                if cluster_pos > 0:
                    info.header_size = cluster_pos
                else:
                    info.header_size = min(len(data), 512)  # é è¨­ä¼°ç®—

                info.is_complete = True
                info.codec_type = "opus" if b'Opus' in data[:1024] else "vorbis"
                info.track_count = 1  # ç°¡åŒ–å‡è¨­åªæœ‰ä¸€å€‹éŸ³è»Œ
            else:
                info.error_message = "ç¼ºå°‘ Segment å…ƒç´ "
        else:
            info.error_message = "ç¼ºå°‘ EBML æª”é ­"

    except Exception as e:
        info.error_message = f"æª¢æ¸¬ç•°å¸¸: {str(e)}"

    return info


def is_webm_header_complete(data: bytes) -> bool:
    """
    æª¢æŸ¥ WebM æª”é ­æ˜¯å¦å®Œæ•´

    Args:
        data: WebM éŸ³é »äºŒé€²åˆ¶æ•¸æ“š

    Returns:
        bool: å¦‚æœæª”é ­å®Œæ•´å‰‡è¿”å› True
    """
    if not data or len(data) < 16:
        return False

    # æª¢æŸ¥ EBML æª”é ­
    if data[:4] != b'\x1A\x45\xDF\xA3':
        return False

    # æª¢æŸ¥æ˜¯å¦åŒ…å« Segment å…ƒç´ 
    return b'\x18\x53\x80\x67' in data[:1024]


def detect_audio_format(audio_data: bytes) -> str:
    """
    æª¢æ¸¬éŸ³é »æ ¼å¼

    Args:
        audio_data: éŸ³é »äºŒé€²åˆ¶æ•¸æ“š

    Returns:
        str: æª¢æ¸¬åˆ°çš„éŸ³é »æ ¼å¼ ('webm', 'mp4', 'ogg', 'wav', 'unknown')
    """
    if not audio_data or len(audio_data) < 16:
        return 'unknown'

    # æª¢æŸ¥æª”æ¡ˆé ­ç°½å
    header = audio_data[:16]

    # WebM æ ¼å¼ (EBML header)
    if header.startswith(b'\x1A\x45\xDF\xA3'):
        return 'webm'

    # MP4 æ ¼å¼ (ftypMSNV for fragmented MP4, ftyp for regular MP4)
    if b'ftyp' in header[:8] or header[4:8] == b'ftyp':
        return 'mp4'

    # OGG æ ¼å¼
    if header.startswith(b'OggS'):
        return 'ogg'

    # WAV æ ¼å¼ (RIFF header)
    if header.startswith(b'RIFF') and header[8:12] == b'WAVE':
        return 'wav'

    # æª¢æŸ¥æ›´å¤§ç¯„åœå…§çš„ MP4 æ ¼å¼æ¨™è­˜
    search_range = min(len(audio_data), 64)
    for i in range(search_range - 4):
        if audio_data[i:i+4] == b'ftyp':
            return 'mp4'

    logger.debug(f"Unknown audio format, header: {header.hex()}")
    return 'unknown'


def check_ffmpeg_health() -> dict:
    """
    æª¢æŸ¥ FFmpeg å¥åº·ç‹€æ…‹

    Returns:
        dict: åŒ…å« FFmpeg ç‹€æ…‹ä¿¡æ¯çš„å­—å…¸
    """
    try:
        # æª¢æŸ¥ FFmpeg æ˜¯å¦å¯ç”¨
        result = subprocess.run(['ffmpeg', '-version'],
                              capture_output=True, text=True, timeout=5)

        if result.returncode == 0:
            # è§£æç‰ˆæœ¬ä¿¡æ¯
            version_line = result.stdout.split('\n')[0]
            version = version_line.split(' ')[2] if len(version_line.split(' ')) > 2 else 'unknown'

            return {
                'ffmpeg_available': True,
                'status': 'healthy',
                'version': version,
                'active_processes': 0,  # ç°¡åŒ–ç‰ˆæœ¬ï¼Œä¸è¿½è¸ªæ´»èºé€²ç¨‹
                'pooled_processes': 0,
                'max_processes': 3
            }
        else:
            return {
                'ffmpeg_available': False,
                'status': 'error',
                'error': 'FFmpeg command failed'
            }

    except FileNotFoundError:
        return {
            'ffmpeg_available': False,
            'status': 'not_found',
            'error': 'FFmpeg not installed'
        }
    except subprocess.TimeoutExpired:
        return {
            'ffmpeg_available': False,
            'status': 'timeout',
            'error': 'FFmpeg version check timeout'
        }
    except Exception as e:
        return {
            'ffmpeg_available': False,
            'status': 'error',
            'error': str(e)
        }


async def webm_to_pcm(webm: bytes) -> bytes:
    """
    å°‡ WebM éŸ³è¨Šè½‰æ›ç‚º PCM æ ¼å¼

    è½‰æ›åƒæ•¸ï¼š
    - è¼¸å…¥ï¼šWebM æ ¼å¼éŸ³è¨Šè³‡æ–™
    - è¼¸å‡ºï¼š16kHz å–®è²é“ signed 16-bit little-endian PCM
    - é©ç”¨æ–¼ Azure OpenAI Whisper API

    Args:
        webm: WebM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Returns:
        bytes: PCM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Raises:
        RuntimeError: FFmpeg è½‰æ›å¤±æ•—æ™‚æ‹‹å‡º
    """
    try:
        logger.debug(f"ğŸµ [FFmpeg] é–‹å§‹è½‰æ› WebM â†’ PCM (size: {len(webm)} bytes)")

        # å»ºç«‹ FFmpeg å­ç¨‹åº
        proc = await asyncio.create_subprocess_exec(
            *shlex.split(FFMPEG_CMD),
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )

        # åŸ·è¡Œè½‰æ›
        stdout, stderr = await proc.communicate(webm)

        # æª¢æŸ¥è½‰æ›çµæœ
        if proc.returncode != 0:
            error_msg = stderr.decode('utf-8') if stderr else "Unknown FFmpeg error"
            logger.error(f"âŒ [FFmpeg] è½‰æ›å¤±æ•— (è¿”å›ç¢¼: {proc.returncode}): {error_msg}")
            raise RuntimeError(f"FFmpeg convert failed: {error_msg}")

        if not stdout:
            logger.error("âŒ [FFmpeg] è½‰æ›çµæœç‚ºç©º")
            raise RuntimeError("FFmpeg convert produced no output")

        logger.info(f"âœ… [FFmpeg] WebM â†’ PCM è½‰æ›æˆåŠŸ ({len(webm)} â†’ {len(stdout)} bytes)")
        return stdout

    except asyncio.TimeoutError:
        logger.error("âŒ [FFmpeg] è½‰æ›è¶…æ™‚")
        raise RuntimeError("FFmpeg convert timeout")
    except FileNotFoundError:
        logger.error("âŒ [FFmpeg] FFmpeg ç¨‹åºæœªæ‰¾åˆ°ï¼Œè«‹ç¢ºèªå·²å®‰è£ FFmpeg")
        raise RuntimeError("FFmpeg not found. Please install FFmpeg.")
    except Exception as e:
        logger.error(f"âŒ [FFmpeg] è½‰æ›ç•°å¸¸: {str(e)}")
        raise RuntimeError(f"FFmpeg convert error: {str(e)}")


async def webm_to_wav(webm: bytes) -> Optional[bytes]:
    """
    å°‡ WebM éŸ³è¨Šè½‰æ›ç‚º 16kHz mono 16-bit RIFF-WAV æ ¼å¼

    Args:
        webm: WebM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Returns:
        Optional[bytes]: WAV æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™ï¼Œå¤±æ•—æ™‚å›å‚³ None
    """
    ffmpeg_cmd = "ffmpeg -f webm -i pipe:0 -ac 1 -ar 16000 -f wav -y pipe:1 -loglevel error"
    try:
        logger.debug(f"ğŸµ [FFmpeg] é–‹å§‹è½‰æ› WebM â†’ WAV (size: {len(webm)} bytes)")
        proc = await asyncio.create_subprocess_exec(
            *shlex.split(ffmpeg_cmd),
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )
        stdout, stderr = await proc.communicate(webm)
        if proc.returncode != 0:
            error_msg = stderr.decode('utf-8') if stderr else "Unknown FFmpeg error"
            logger.error(f"âŒ [FFmpeg] WebM â†’ WAV è½‰æ›å¤±æ•— (è¿”å›ç¢¼: {proc.returncode}): {error_msg}")
            return None
        if not stdout:
            logger.error("âŒ [FFmpeg] WebM â†’ WAV è½‰æ›çµæœç‚ºç©º")
            return None
        logger.info(f"âœ… [FFmpeg] WebM â†’ WAV è½‰æ›æˆåŠŸ ({len(webm)} â†’ {len(stdout)} bytes)")
        return stdout
    except asyncio.TimeoutError:
        logger.error("âŒ [FFmpeg] WebM â†’ WAV è½‰æ›è¶…æ™‚")
        return None
    except FileNotFoundError:
        logger.error("âŒ [FFmpeg] FFmpeg ç¨‹åºæœªæ‰¾åˆ°ï¼Œè«‹ç¢ºèªå·²å®‰è£ FFmpeg")
        return None
    except Exception as e:
        logger.error(f"âŒ [FFmpeg] WebM â†’ WAV è½‰æ›ç•°å¸¸: {str(e)}")
        return None


async def validate_webm_audio(webm: bytes) -> bool:
    """
    é©—è­‰ WebM éŸ³è¨Šæª”æ¡ˆæ˜¯å¦æœ‰æ•ˆ

    ä½¿ç”¨ FFmpeg ä¾†æª¢æŸ¥éŸ³è¨Šæª”æ¡ˆçš„å®Œæ•´æ€§å’Œæ ¼å¼

    Args:
        webm: WebM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Returns:
        bool: å¦‚æœéŸ³è¨Šæª”æ¡ˆæœ‰æ•ˆå‰‡è¿”å› True
    """
    try:
        # ä½¿ç”¨ FFmpeg é©—è­‰æ¨¡å¼ï¼ˆä¸ç”¢ç”Ÿè¼¸å‡ºï¼Œåªæª¢æŸ¥æ ¼å¼ï¼‰
        validate_cmd = "ffmpeg -v error -i pipe:0 -f null -"

        proc = await asyncio.create_subprocess_exec(
            *shlex.split(validate_cmd),
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )

        stdout, stderr = await proc.communicate(webm)

        if proc.returncode == 0:
            logger.debug("âœ… [FFmpeg] WebM éŸ³è¨Šæª”æ¡ˆé©—è­‰é€šé")
            return True
        else:
            error_msg = stderr.decode('utf-8') if stderr else "Unknown validation error"
            logger.warning(f"âš ï¸ [FFmpeg] WebM éŸ³è¨Šæª”æ¡ˆé©—è­‰å¤±æ•—: {error_msg}")
            return False

    except Exception as e:
        logger.warning(f"âš ï¸ [FFmpeg] éŸ³è¨Šæª”æ¡ˆé©—è­‰ç•°å¸¸: {str(e)}")
        return False


async def get_audio_info(webm: bytes) -> Optional[dict]:
    """
    ç²å–éŸ³è¨Šæª”æ¡ˆè³‡è¨Š

    Args:
        webm: WebM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Returns:
        dict: åŒ…å«éŸ³è¨Šè³‡è¨Šçš„å­—å…¸ï¼Œå¦‚æœå¤±æ•—å‰‡è¿”å› None
    """
    try:
        # ä½¿ç”¨ ffprobe ç²å–éŸ³è¨Šè³‡è¨Š
        probe_cmd = "ffprobe -v quiet -print_format json -show_format -show_streams pipe:0"

        proc = await asyncio.create_subprocess_exec(
            *shlex.split(probe_cmd),
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )

        stdout, stderr = await proc.communicate(webm)

        if proc.returncode == 0 and stdout:
            import json
            info = json.loads(stdout.decode('utf-8'))
            logger.debug(f"ğŸ“Š [FFprobe] éŸ³è¨Šè³‡è¨Š: {info}")
            return info
        else:
            logger.warning("âš ï¸ [FFprobe] ç„¡æ³•ç²å–éŸ³è¨Šè³‡è¨Š")
            return None

    except Exception as e:
        logger.warning(f"âš ï¸ [FFprobe] ç²å–éŸ³è¨Šè³‡è¨Šç•°å¸¸: {str(e)}")
        return None


# END FILE CONTENTS


# File: app/db/__init__.py



# END FILE CONTENTS


# File: app/services/stt/gpt4o_provider.py

# app/services/stt/gpt4o_provider.py
from __future__ import annotations

import logging
from datetime import datetime
from io import BytesIO
from typing import Any, Dict
from uuid import UUID

from openai import AsyncAzureOpenAI, RateLimitError

from app.core.config import get_settings
from app.core.ffmpeg import detect_audio_format, webm_to_wav
from app.db.database import get_supabase_client
from app.services.stt.interfaces import ISTTProvider
from app.services.stt.lang_map import to_gpt4o
from app.utils.timer import PerformanceTimer
from app.utils.timing import calc_times

settings = get_settings()
logger = logging.getLogger(__name__)


class GPT4oProvider(ISTTProvider):
    """Azure GPT-4o Audio Transcriptions"""

    name = "gpt4o"
    _client: AsyncAzureOpenAI | None = None

    # ---------- client singleton ------------------------------------
    @classmethod
    def _client_lazy(cls) -> AsyncAzureOpenAI:
        if cls._client is None:
            api_key_raw = settings.AZURE_OPENAI_API_KEY
            api_key = (
                api_key_raw.get_secret_value()
                if hasattr(api_key_raw, "get_secret_value")
                else api_key_raw
            )
            cls._client = AsyncAzureOpenAI(
                api_key=api_key,
                azure_endpoint=settings.AZURE_OPENAI_ENDPOINT,
                api_version="2024-06-01",
                timeout=(5, 55),          # connect / read
                max_retries=2,
            )
        return cls._client

    # ---------- main -------------------------------------------------
    async def transcribe(
        self,
        audio: bytes,
        session_id: UUID,
        chunk_seq: int,
    ) -> Dict[str, Any] | None:
        """
        â€¢ å°‡ WebMâ†’WAVï¼ˆ16 kHz monoï¼‰
        â€¢ å‘¼å« GPT-4o å–å¾— text
        â€¢ å›å‚³çµ±ä¸€æ¬„ä½ï¼›None ä»£è¡¨è·³é
        """

        # 1. å–å¾— canonical lang_code â†’ zh / en / auto
        supa = get_supabase_client()
        row = (
            supa.table("sessions").select("lang_code")
            .eq("id", str(session_id)).single().execute()
        )
        canonical = (row.data or {}).get("lang_code", "zh-TW")
        api_lang = to_gpt4o(canonical)

        # 2. è½‰ WAV
        fmt = detect_audio_format(audio)
        if fmt not in ("webm", "wav"):
            logger.error("GPT4o ä¸æ”¯æ´æ ¼å¼ %s", fmt)
            return None

        wav_bytes = await webm_to_wav(audio) if fmt == "webm" else audio
        if not wav_bytes:
            logger.error("WebMâ†’WAV è½‰æ›å¤±æ•— %s seq=%s", session_id, chunk_seq)
            return None

        # 3. å‘¼å« GPT-4o
        client = self._client_lazy()
        with PerformanceTimer(f"gpt4o chunk {chunk_seq}"):
            try:
                # (filename, bytes/IO, mime)
                file_tuple = ("chunk.wav", wav_bytes, "audio/wav")
                resp = await client.audio.transcriptions.create(
                    model=settings.GPT4O_DEPLOYMENT_NAME,
                    file=file_tuple,
                    language=api_lang,
                    response_format="json",
                    prompt=settings.GPT4O_TRANSCRIBE_PROMPT or None,
                )
            except RateLimitError as e:
                logger.warning("GPT4o 429: %s", e)
                raise
            except Exception as e:
                logger.error("GPT4o API error: %s", e, exc_info=True)
                return None

        text = getattr(resp, "text", "").strip()
        if not text:
            logger.info("GPT4o ç©ºç™½æ–‡å­— %s seq=%s", session_id, chunk_seq)
            return None

        # 4. æ™‚é–“æˆ³ = chunk_seq Ã— D
        start_time, end_time = calc_times(chunk_seq)

        return {
            "text": text,
            "chunk_sequence": chunk_seq,
            "session_id": str(session_id),
            "lang_code": canonical,
            "start_time": start_time,
            "end_time": end_time,
            "timestamp": datetime.utcnow().isoformat(),
            "duration": settings.AUDIO_CHUNK_DURATION_SEC,
        }

    # ---------- meta -----------------------------------------------
    def max_rpm(self) -> int:
        return getattr(settings, "GPT4O_MAX_REQUESTS", 60)


# END FILE CONTENTS


# File: frontend/components/ui/context-menu.tsx

"use client"

import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}


# END FILE CONTENTS


# File: app/schemas/__init__.py



# END FILE CONTENTS


# File: app/services/azure_whisper.py

import logging
import tempfile
from datetime import datetime
from pathlib import Path
from uuid import UUID
from typing import Any, Dict, Optional

from openai import AsyncAzureOpenAI
from httpx import Timeout
from app.core.config import settings

__all__ = ["AzureWhisperService", "PerformanceTimer"]

logger = logging.getLogger(__name__)

class PerformanceTimer:
    """æ•ˆèƒ½è¨ˆæ™‚å™¨"""
    def __init__(self, operation_name: str):
        self.operation_name = operation_name
        self.start_time = None
        self.end_time = None

    def __enter__(self):
        import time
        self.start_time = time.time()
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        import time
        self.end_time = time.time()
        duration = self.get_duration()
        if duration > 1.0:
            logger.warning(f"âš ï¸  {self.operation_name} took {duration:.2f}s (slow)")
        else:
            logger.info(f"â±ï¸  {self.operation_name} completed in {duration:.2f}s")

    def get_duration(self) -> float:
        if self.start_time and self.end_time:
            return self.end_time - self.start_time
        return 0.0

class AzureWhisperService:
    def __init__(self):
        self.client = AsyncAzureOpenAI(
            api_key=settings.AZURE_OPENAI_API_KEY,
            azure_endpoint=settings.AZURE_OPENAI_ENDPOINT,
            api_version="2024-06-01",
            timeout=Timeout(connect=5, read=55, write=30, pool=5),
            max_retries=2,
        )
        self.deployment = settings.WHISPER_DEPLOYMENT_NAME
        self.language = settings.WHISPER_LANGUAGE

    async def transcribe(self, audio: bytes, session_id: UUID, chunk_seq: int, *, api_language: str, canonical_lang: str) -> Optional[Dict[str, Any]]:
        with PerformanceTimer(f"Whisper chunk {chunk_seq}"):
            with tempfile.NamedTemporaryFile(suffix='.webm', delete=False) as temp_file:
                temp_file.write(audio)
                temp_file.flush()
                logger.info(f"ğŸ” call whisper: session_id={session_id}, chunk={chunk_seq}, api_lang={api_language}, canonical_lang={canonical_lang}, temp_file={temp_file.name}")
                try:
                    with open(temp_file.name, 'rb') as audio_file:
                        transcript = await self.client.audio.transcriptions.create(
                            model=self.deployment,
                            file=audio_file,
                            language=api_language,
                            response_format="json",
                            temperature=0
                        )
                    # Debug Azure å›å‚³å…§å®¹
                    try:
                        import json
                        logger.debug("Whisper raw json â‡’ %s", resp) # type: ignore
                        logger.debug("Whisper raw response: %s", json.dumps(transcript if isinstance(transcript, dict) else transcript.__dict__, ensure_ascii=False, indent=2))
                    except Exception as e:
                        logger.debug("Whisper raw response (fallback): %s", str(transcript))
                        logger.debug("Failed to json.dumps transcript: %s", e)
                    Path(temp_file.name).unlink(missing_ok=True)
                    text = getattr(transcript, "text", None) or (transcript.get("text") if isinstance(transcript, dict) else None)
                    if not text or not text.strip():
                        return None
                    return {
                        "text": text.strip(),
                        "chunk_sequence": chunk_seq,
                        "session_id": str(session_id),
                        "lang_code": canonical_lang,
                        "timestamp": datetime.utcnow().isoformat(),
                    }
                finally:

                    Path(temp_file.name).unlink(missing_ok=True)


# END FILE CONTENTS


# File: frontend/components/default-state.tsx

"use client"

import { Button } from "@/components/ui/button"
import { Upload, FileText } from "lucide-react"

interface DefaultStateProps {
  onStartRecording: () => void
}

export function DefaultState({ onStartRecording }: DefaultStateProps) {
  const handleClick = () => {
    console.log("ğŸ”˜ [DefaultState] æŒ‰éˆ•è¢«é»æ“Š")
    console.log("ğŸ”˜ [DefaultState] onStartRecording å‡½æ•¸:", typeof onStartRecording)
    try {
      onStartRecording()
      console.log("ğŸ”˜ [DefaultState] onStartRecording èª¿ç”¨æˆåŠŸ")
    } catch (error) {
      console.error("ğŸ”˜ [DefaultState] onStartRecording èª¿ç”¨å¤±æ•—:", error)
    }
  }

  console.log("ğŸ”„ [DefaultState] çµ„ä»¶æ¸²æŸ“ï¼ŒonStartRecording:", typeof onStartRecording)

  return (
    <div className="h-full flex flex-col p-6">
      {/* Main content */}
      <div className="flex-1 flex flex-col items-center justify-center space-y-6">
        <Button
          onClick={handleClick}
          size="lg"
          className="flex items-center gap-3 px-8 py-4 text-base"
          data-testid="start-recording-button"
        >
          <Upload className="w-5 h-5" />
          Start Recording
        </Button>

        <div className="text-center text-muted-foreground text-sm space-y-1">
          <p className="flex items-center justify-center gap-2">
            <FileText className="w-4 h-4" />
            æˆ–ç›´æ¥é–‹å§‹ç·¨å¯«ç­†è¨˜
          </p>
          <p>éŒ„éŸ³åŠŸèƒ½éš¨æ™‚å¯ä»¥å•Ÿç”¨</p>
        </div>
      </div>
    </div>
  )
}


# END FILE CONTENTS


# File: .cursor/rules/frontend.mdc

---
description:
globs:
alwaysApply: false
---
<!-- Source: https://github.com/arthow4n/live-language-mate/blob/master/CLAUDE.md -->

### Development Notes

- Uses shadcn/ui component library extensively
- In the default state without a specified style, the tweakcn clean-slate style is applied first: `npx shadcn@latest add https://tweakcn.com/r/themes/clean-slate.json`
- Responsive design with mobile-first approach
- Settings stored in localStorage with versioning


## TypeScript coding style and conventions

- Prefer named import/export over default import/export.
- Early return, early throw.
- In frontend Vitest test files, import explicitly the test helpers e.g. `import { beforeEach, describe, expect, `test`, vi } from 'vitest';`.
- Use Zod to validate and cast type as early as possible, this includes but not limit to handling the following scenarios: `any`, `unknown`, `DefaultBodyType`.
- Always assign unknown type to `const x: unknown = JSON.parse()`, `cosnt x: unknown = await request.json()`, `cosnt x: unknown = await response.json()`, then validate with Zod.
- Zod schemas are shared between frontend and backend.
- Zod schemas are in `frontend/schemas/`, you should find in there first to see if there's a schema you can reuse. You should not create Zod schemas outside of `frontend/schemas/`.
- Never use `any`, `as` type assertion or `!` non-null assertion operator, you should instead use type narrowing, for example in test you can use `expectToBeInstanceOf`, `expectToNotBeNull`, `expectToNotBeUndefined`, and outside of test `instanceof` or do a proper object validation with Zod.
- If you would declare an untyped object, instead you should either type it with e.g. `const x: X = {}` or `{} satisfies X`.
- Avoid optional function parameter, optional property, and default values. If you are about to add one or you see any of such usages, try to look around the related code paths and see if you can refactor to remove it. Default values should only be used when it's absolutely necessary.
- Throw if a logic not really optional:

```ts
// Bad: Is Y optional?
if (x instaceof X) { x.Y(); }

// Bad: Is Y optional?
x?.Y();

// Good: Type narrowing and early throw
if (!x instanceof X) { throw new Error(); }
x.Y();

// Best: Zod type narrowing and early throw, prefer .parse over .safeParse when possible.
zodSchema.parse(x);
x.Y();

// Compromise: Explain why Y is optional if Y is really optional.
x?.Y(); // Y is optional because ...
```

### In fronted, instead of X use Y

- `as` operator -> use Zod
- `console.error` -> `logError`
- `JSX.Element` -> `React.JSX.Element`
- `toBeTruthy`, `.not.toBeNull`, `toBeDefined`, `toBeInstanceOf` or `if (instanceof)` -> use the type narrowing expect helpers in `frontend/__tests__/typedExpectHelpers.ts`
- `getAllBy*()[*]` -> `getByTestId` or `getByText`
- `() => {}` empty mock -> `vi.fn()`
- `JSON.stringify(x)` if x is not typed -> `const x: X = {}; JSON.stringify(x)` or `JSON.stringify({} satisfies X)`
- `fireEvent` -> `userEvent`
- `vi.mock` -> never mock imported code, we write integration test and should not mock any decendant imports.



## Test

- When writing test, write integration test.
- Write integration test to cover business logic, if something can be clicked, input or be interacted in any other ways by the user, it should be covered by a test.
- When writing new test, make sure the test is genuinely new and not testing what another test has already covered. You should look for other existing test cases to understand if the test you are about to write is already covered by another test.
- Use Playwright to test end-to-end frontend with @playwright-e2e-testing.mdc
- Focus on testing the component/function's integrated behaviour, for example, if the import tree looks like A -> B -> C, you should not mock any of A/B/C, instead you should focus on testing if interacting with A as a whole gives you the expected result; in B's test you should not mock B/C and instead test interacting with B; and so on.
- You should only change a test file if you are fixing lint/type errors, or you made a change that requires update that test file.
- If you are only editing test, you should not change the existing code logic that in the test. If refactoring would make writing test easier, explain to the user and wait for feedback. You may add testid yourself if needed.
- If an action will make an API request, you should test whether the API will get the correctly formed request.
- Before you write or change any test code, make sure you step back and get a full picture first, by reading through the related code paths from beginning to end, and understanding how the code and data flows.
- Instead of fixing many test cases in one go, focus on fixing 1 test at a time, each test case should have its own todo item.
- `DragEvent`, `DataTransferItemList`, `DataTransfer`, `DOMRect` are polyfilled and can be used in test:

```ts
const event = new DragEvent('dragenter', {
  cancelable: true,
  bubbles: true,
});
event.dataTransfer?.items.add('hello world', 'text/plain');
```

## Lint

- If you would eslint disable anything, think again and see if there's a better approach to fix it, if you still need to eslint disable, make sure you add -- comment after it to explain why you chose to disable.

### Instead of command X, use Y

- `rg`, `grep` -> use Search tool
- `find` -> `git ls-files` or your own List tool
- `rm` -> try `git rm` first, if fail then try `git clean`
- `head`/`tail`/`cat` -> read the file with tool instead
- `npx tsc` -> `npm run typecheck`
- Don't chain or pipe commands, chained and piped commands will be denied.


# END FILE CONTENTS


# File: frontend/__tests__/integration/websocket-state-sync.test.ts

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { renderHook, act } from '@testing-library/react'
import { createElement } from 'react'
import { AppStateProvider } from '../../hooks/use-app-state-context'
import { useTranscriptNew } from '../../hooks/use-transcript-new'
import { featureFlagManager } from '../../lib/feature-flags'
import type { ReactNode } from 'react'

// Mock WebSocket
class MockWebSocket {
    onopen: ((event: Event) => void) | null = null
    onmessage: ((event: MessageEvent) => void) | null = null
    onerror: ((event: Event) => void) | null = null
    onclose: ((event: CloseEvent) => void) | null = null
    readyState = 0 // WebSocket.CONNECTING

    constructor(public url: string) {
        // æ¨¡æ“¬ç•°æ­¥é€£æ¥
        setTimeout(() => {
            this.readyState = 1 // WebSocket.OPEN
            if (this.onopen) {
                this.onopen(new Event('open'))
            }
        }, 10)
    }

    send(data: string) {
        // æ¨¡æ“¬ç™¼é€æ•¸æ“š
    }

    close() {
        this.readyState = 3 // WebSocket.CLOSED
        if (this.onclose) {
            this.onclose(new CloseEvent('close'))
        }
    }

    // æ¨¡æ“¬æ¥æ”¶æ¶ˆæ¯
    simulateMessage(data: any) {
        if (this.onmessage) {
            this.onmessage(new MessageEvent('message', { data: JSON.stringify(data) }))
        }
    }

    // æ¨¡æ“¬éŒ¯èª¤
    simulateError() {
        if (this.onerror) {
            this.onerror(new Event('error'))
        }
    }
}

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
    clear: vi.fn(),
}

Object.defineProperty(window, 'localStorage', {
    value: localStorageMock
})

// Mock WebSocket globally
Object.defineProperty(window, 'WebSocket', {
    value: MockWebSocket
})

function TestWrapper({ children }: { children: ReactNode }) {
    return createElement(AppStateProvider, null, children)
}

describe('WebSocket èˆ‡ç‹€æ…‹åŒæ­¥æ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        featureFlagManager.reset()
        featureFlagManager.enable('useNewStateManagement')
        featureFlagManager.enable('useNewTranscriptHook')
        localStorageMock.getItem.mockReturnValue(null)
    })

    describe('WebSocket é€£æ¥ç®¡ç†', () => {
        test('æ‡‰è©²èƒ½å¤ å»ºç«‹ WebSocket é€£æ¥', async () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // åˆå§‹ç‹€æ…‹æ‡‰è©²æ˜¯æœªé€£æ¥
            expect(result.current.isConnected).toBe(false)

            // é€™è£¡æˆ‘å€‘ç„¡æ³•ç›´æ¥æ¸¬è©¦ WebSocket é€£æ¥ï¼Œå› ç‚ºå®ƒåœ¨ TranscriptManager ä¸­
            // ä½†æˆ‘å€‘å¯ä»¥æ¸¬è©¦ Hook çš„åŸºæœ¬åŠŸèƒ½
            expect(result.current.error).toBe(null)
            expect(result.current.autoScrollEnabled).toBe(true)
        })

        test('æ‡‰è©²æä¾› WebSocket æ§åˆ¶æ–¹æ³•', () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æª¢æŸ¥æ‰€æœ‰å¿…è¦çš„æ–¹æ³•éƒ½å­˜åœ¨
            expect(typeof result.current.disconnect).toBe('function')
            expect(typeof result.current.clearTranscripts).toBe('function')
            expect(typeof result.current.enableAutoScroll).toBe('function')
            expect(typeof result.current.disableAutoScroll).toBe('function')
            expect(typeof result.current.scrollToLatest).toBe('function')
        })

        test('æ‡‰è©²èƒ½å¤ æ§åˆ¶è‡ªå‹•æ»¾å‹•', async () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // åˆå§‹ç‹€æ…‹ï¼šè‡ªå‹•æ»¾å‹•å•Ÿç”¨
            expect(result.current.autoScrollEnabled).toBe(true)

            // ç¦ç”¨è‡ªå‹•æ»¾å‹•
            await act(async () => {
                result.current.disableAutoScroll()
            })

            expect(result.current.autoScrollEnabled).toBe(false)

            // å•Ÿç”¨è‡ªå‹•æ»¾å‹•
            await act(async () => {
                result.current.enableAutoScroll()
            })

            expect(result.current.autoScrollEnabled).toBe(true)
        })
    })

    describe('ç‹€æ…‹åŒæ­¥', () => {
        test('Hook æ‡‰è©²èˆ‡ Context ç‹€æ…‹ä¿æŒåŒæ­¥', () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æª¢æŸ¥ Hook è¿”å›çš„ç‹€æ…‹çµæ§‹
            expect(result.current).toHaveProperty('isConnected')
            expect(result.current).toHaveProperty('error')
            expect(result.current).toHaveProperty('autoScrollEnabled')
            expect(result.current).toHaveProperty('disconnect')
            expect(result.current).toHaveProperty('clearTranscripts')
        })

        test('æ¸…é™¤é€å­—ç¨¿æ‡‰è©²æ­£å¸¸å·¥ä½œ', async () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æ¸…é™¤é€å­—ç¨¿ä¸æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
            await act(async () => {
                expect(() => result.current.clearTranscripts()).not.toThrow()
            })
        })

        test('æ–·é–‹é€£æ¥æ‡‰è©²æ­£å¸¸å·¥ä½œ', async () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æ–·é–‹é€£æ¥ä¸æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
            await act(async () => {
                expect(() => result.current.disconnect()).not.toThrow()
            })
        })
    })

    describe('éŒ¯èª¤è™•ç†', () => {
        test('æ‡‰è©²æ­£ç¢ºè™•ç† WebSocket éŒ¯èª¤', () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // åˆå§‹éŒ¯èª¤ç‹€æ…‹æ‡‰è©²æ˜¯ null
            expect(result.current.error).toBe(null)
        })

        test('Hook unmount æ‡‰è©²æ¸…ç†è³‡æº', () => {
            const { unmount } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // unmount æ‡‰è©²æ­£å¸¸åŸ·è¡Œè€Œä¸æ‹‹å‡ºéŒ¯èª¤
            expect(() => unmount()).not.toThrow()
        })
    })

    describe('åŠŸèƒ½é–‹é—œæ•´åˆ', () => {
        test('ç•¶åŠŸèƒ½é–‹é—œé—œé–‰æ™‚æ‡‰è©²ä½¿ç”¨èˆŠç‰ˆæœ¬', () => {
            // ç¦ç”¨æ–°çš„ Transcript Hook
            featureFlagManager.disable('useNewTranscriptHook')

            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æ‡‰è©²ä»ç„¶æä¾›ç›¸åŒçš„ API
            expect(result.current).toHaveProperty('isConnected')
            expect(result.current).toHaveProperty('error')
            expect(result.current).toHaveProperty('autoScrollEnabled')
        })

        test('ç•¶åŠŸèƒ½é–‹é—œå•Ÿç”¨æ™‚æ‡‰è©²ä½¿ç”¨æ–°ç‰ˆæœ¬', () => {
            // ç¢ºä¿æ–°åŠŸèƒ½é–‹é—œå•Ÿç”¨
            featureFlagManager.enable('useNewTranscriptHook')

            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æ‡‰è©²æä¾›å®Œæ•´çš„ API
            expect(result.current).toHaveProperty('isConnected')
            expect(result.current).toHaveProperty('error')
            expect(result.current).toHaveProperty('autoScrollEnabled')
            expect(result.current).toHaveProperty('disconnect')
            expect(result.current).toHaveProperty('clearTranscripts')
        })
    })

    describe('å¤šå¯¦ä¾‹æ¸¬è©¦', () => {
        test('å¤šå€‹ Hook å¯¦ä¾‹æ‡‰è©²å…±äº« TranscriptManager', () => {
            const { result: result1 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })
            const { result: result2 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // å…©å€‹å¯¦ä¾‹æ‡‰è©²æœ‰ç›¸åŒçš„é€£æ¥ç‹€æ…‹
            expect(result1.current.isConnected).toBe(result2.current.isConnected)
            expect(result1.current.error).toBe(result2.current.error)
        })

        test('ä¸€å€‹å¯¦ä¾‹çš„æ“ä½œæ‡‰è©²å½±éŸ¿å…¶ä»–å¯¦ä¾‹', async () => {
            const { result: result1 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })
            const { result: result2 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // å¾ç¬¬ä¸€å€‹å¯¦ä¾‹ç¦ç”¨è‡ªå‹•æ»¾å‹•
            await act(async () => {
                result1.current.disableAutoScroll()
            })

            // ç¬¬äºŒå€‹å¯¦ä¾‹æ‡‰è©²åæ˜ ç›¸åŒçš„ç‹€æ…‹
            expect(result2.current.autoScrollEnabled).toBe(false)
        })
    })

    describe('è¨˜æ†¶é«”ç®¡ç†', () => {
        test('Hook æ‡‰è©²æ­£ç¢ºæ¸…ç†è³‡æº', () => {
            const { unmount } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // å¤šæ¬¡ mount/unmount æ‡‰è©²ç©©å®š
            for (let i = 0; i < 3; i++) {
                unmount()
                const { unmount: newUnmount } = renderHook(() => useTranscriptNew(), {
                    wrapper: TestWrapper
                })
                expect(() => newUnmount()).not.toThrow()
            }
        })

        test('Context unmount ä¸æ‡‰è©²å½±éŸ¿ TranscriptManager', () => {
            let unmount1: () => void
            let unmount2: () => void

            // ç¬¬ä¸€å€‹ Provider
            const { unmount: u1 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })
            unmount1 = u1

            // ç¬¬äºŒå€‹ Provider
            const { unmount: u2 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })
            unmount2 = u2

            // æ¸…ç†ç¬¬ä¸€å€‹ä¸æ‡‰è©²å½±éŸ¿ç¬¬äºŒå€‹
            expect(() => unmount1()).not.toThrow()
            expect(() => unmount2()).not.toThrow()
        })
    })
})


# END FILE CONTENTS


# File: frontend/types/app-state-context.ts

import { AppData, AppState, SessionStatus, SessionType, TranscriptEntry } from "./app-state"
import { StateTransitionTrigger, StateTransitionResult } from './state-transitions';

// ç‹€æ…‹ç®¡ç† Actions
export type AppStateAction =
    | { type: "SET_STATE"; payload: AppState }
    | { type: "SET_APP_STATE"; payload: AppState }  // åˆ¥åï¼Œç‚ºäº†å‘å¾Œç›¸å®¹
    | { type: "SET_RECORDING"; payload: boolean }
    | { type: "SET_RECORDING_TIME"; payload: number }
    | { type: "SET_EDITOR_CONTENT"; payload: string }
    | { type: "SET_TRANSCRIPT_ENTRIES"; payload: TranscriptEntry[] }
    | { type: "ADD_TRANSCRIPT_ENTRY"; payload: TranscriptEntry }
    | { type: "SET_SESSION"; payload: { id: string; status: SessionStatus; type: SessionType } | null }
    | { type: "UPDATE_SESSION_STATUS"; payload: SessionStatus }
    | { type: "RESET_STATE" }
    | { type: "SET_LOADING"; payload: boolean }
    | { type: "SET_ERROR"; payload: string | null }
    | { type: "CLEAR_ERROR" }

// Context ç‹€æ…‹ä»‹é¢
export interface AppStateContextValue {
    // ç‹€æ…‹æ•¸æ“š
    appData: AppData
    isLoading: boolean
    error: string | null

    // ç‹€æ…‹æ›´æ–°å‡½æ•¸
    dispatch: (action: AppStateAction) => void

    // ä¾¿åˆ©æ–¹æ³•ï¼ˆå°è£å¸¸ç”¨çš„ dispatch æ“ä½œï¼‰
    setState: (state: AppState) => void
    setRecording: (isRecording: boolean) => void
    setRecordingTime: (time: number) => void
    setEditorContent: (content: string) => void
    setTranscriptEntries: (entries: TranscriptEntry[]) => void
    addTranscriptEntry: (entry: TranscriptEntry) => void
    setSession: (session: { id: string; status: SessionStatus; type: SessionType } | null) => void
    updateSessionStatus: (status: SessionStatus) => void
    resetState: () => void
    setLoading: (loading: boolean) => void
    setError: (error: string | null) => void
    transition: (trigger: StateTransitionTrigger) => StateTransitionResult | null
}

// åˆå§‹ç‹€æ…‹
export const initialAppData: AppData = {
    state: "default",
    transcriptEntries: [],
    editorContent: "",
    isRecording: false,
    recordingTime: 0,
    session: null,
}

export const initialContextState = {
    appData: initialAppData,
    isLoading: false,
    error: null,
}


# END FILE CONTENTS


# File: frontend/e2e/export-api.spec.ts

import { test, expect, Page } from '@playwright/test'
import JSZip from 'jszip'

// æ¸¬è©¦ç”¨å‡ session idï¼Œè«‹ç¢ºä¿å¾Œç«¯æœ‰å°æ‡‰ completed session æˆ–æ‰‹å‹•è¨­ç½®
const TEST_SESSION_ID = 'test-session-completed-001'

// ä¸‹è¼‰ä¸¦è§£å£“ zipï¼Œé©—è­‰å…§å®¹
async function fetchAndUnzipZip(page: Page, sid: string) {
    const response = await page.request.get(`/api/export/${sid}?type=zip`)
    expect(response.status()).toBe(200)
    const buffer = await response.body()
    const zip = await JSZip.loadAsync(buffer)
    const note = await zip.file('note.md')?.async('string')
    const transcript = await zip.file('transcript.txt')?.async('string')
    return { note, transcript }
}

test.describe('åŒ¯å‡º API Proxy æ¸¬è©¦', () => {
    test('æ‡‰è©²æ­£ç¢º proxy /api/export/<sid> åˆ° FastAPI', async ({ page }) => {
        // ç›´æ¥ç™¼é€ fetch è«‹æ±‚
        const response = await page.request.get(`/api/export/${TEST_SESSION_ID}?type=zip`)
        // æ‡‰è©²ä¸æ˜¯ 404
        expect(response.status()).not.toBe(404)
        // æ‡‰è©²ä¸æ˜¯ Next.js é è¨­ 404 é é¢
        const text = await response.text()
        expect(text).not.toContain('This page could not be found')
        // æ¨™é ­æ‡‰æœ‰ FastAPI æ¨™è¨˜ï¼ˆå¦‚ server: uvicornï¼‰
        const serverHeader = response.headers()['server'] || ''
        expect(serverHeader.toLowerCase()).toContain('uvicorn')
    })

    test('æ‡‰è©²èƒ½ä¸‹è¼‰ä¸¦é©—è­‰ zip å…§å®¹', async ({ page }) => {
        const { note, transcript } = await fetchAndUnzipZip(page, TEST_SESSION_ID)
        expect(note).toBeDefined()
        expect(transcript).toBeDefined()
        expect(note?.length).toBeGreaterThan(0)
        expect(transcript?.length).toBeGreaterThan(0)
        // å¯æ ¹æ“šå¯¦éš›å…§å®¹åŠ å¼·é©—è­‰
        expect(note).toMatch(/.+/) // è‡³å°‘æœ‰å…§å®¹
        expect(transcript).toMatch(/\[\d{2}:\d{2}:\d{2}\]/) // æœ‰æ™‚é–“æˆ³
    })
})


# END FILE CONTENTS


# File: gptree_output.txt

# Project Directory Structure:
.
â”œâ”€â”€ .cursor/
â”‚   â””â”€â”€ rules/
â”‚       â”œâ”€â”€ backend.mdc
â”‚       â”œâ”€â”€ frontend.mdc
â”‚       â”œâ”€â”€ playwright-e2e-testing.mdc
â”‚       â”œâ”€â”€ python.mdc
â”‚       â”œâ”€â”€ react.mdc
â”‚       â”œâ”€â”€ rules.mdc
â”‚       â””â”€â”€ ui-rules/
â”‚           â”œâ”€â”€ create-prototype.mdc
â”‚           â””â”€â”€ shadcn-tailwind-ui-guideline.mdc
â”œâ”€â”€ .cursorignore
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ .editorconfig
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gptree_config
â”œâ”€â”€ .pytest_cache/
â”œâ”€â”€ PRD.md
â”œâ”€â”€ README.md
â”œâ”€â”€ SPEC.md
â”œâ”€â”€ Todos.md
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ export.py
â”‚   â”‚   â”œâ”€â”€ notes.py
â”‚   â”‚   â”œâ”€â”€ segments.py
â”‚   â”‚   â””â”€â”€ sessions.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ audio_vad.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ container.py
â”‚   â”‚   â”œâ”€â”€ ffmpeg.py
â”‚   â”‚   â””â”€â”€ webm_header_repairer.py
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â”œâ”€â”€ supabase_config.py
â”‚   â”‚   â””â”€â”€ supabase_init.sql
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ httpx_timeout.py
â”‚   â”‚   â”œâ”€â”€ prom_helpers.py
â”‚   â”‚   â”œâ”€â”€ rate_limit.py
â”‚   â”‚   â””â”€â”€ settings_utils.py
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ note.py
â”‚   â”‚   â””â”€â”€ session.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ azure_openai_v2.py
â”‚   â”‚   â”œâ”€â”€ azure_whisper.py
â”‚   â”‚   â”œâ”€â”€ r2_client.py
â”‚   â”‚   â”œâ”€â”€ stt/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ factory.py
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_provider.py
â”‚   â”‚   â”‚   â”œâ”€â”€ gpt4o_provider.py
â”‚   â”‚   â”‚   â”œâ”€â”€ interfaces.py
â”‚   â”‚   â”‚   â”œâ”€â”€ lang_map.py
â”‚   â”‚   â”‚   â”œâ”€â”€ save_utils.py
â”‚   â”‚   â”‚   â””â”€â”€ whisper_provider.py
â”‚   â”‚   â””â”€â”€ transcript_feed.py
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ timer.py
â”‚   â”‚   â”œâ”€â”€ timing.py
â”‚   â”‚   â””â”€â”€ validators.py
â”‚   â””â”€â”€ ws/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ transcript_feed.py
â”‚       â””â”€â”€ upload_audio.py
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ADD_GEMINI.md
â”‚   â”œâ”€â”€ auto-retry-upload-spec.md
â”‚   â”œâ”€â”€ export-spec.md
â”‚   â”œâ”€â”€ export-tdd-tasks.md
â”‚   â”œâ”€â”€ export-transcript-format.md
â”‚   â”œâ”€â”€ export-wait-until-completed-20240608.md
â”‚   â”œâ”€â”€ lang-map-refactor.md
â”‚   â”œâ”€â”€ skip-silence-spec.md
â”‚   â”œâ”€â”€ stop-processing-finish-flow.md
â”‚   â”œâ”€â”€ traceback-debug-spec.md
â”‚   â””â”€â”€ webm-to-wav-gpt4o.md
â”œâ”€â”€ e2e/
â”‚   â””â”€â”€ export-api.spec.ts
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ .eslintrc.json
â”‚   â”œâ”€â”€ .next/
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â””â”€â”€ integration/
â”‚   â”‚       â”œâ”€â”€ app-state-provider.test.tsx
â”‚   â”‚       â”œâ”€â”€ state-transitions.test.ts
â”‚   â”‚       â”œâ”€â”€ state-transitions.test.tsx
â”‚   â”‚       â””â”€â”€ websocket-state-sync.test.ts
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ app-store-zustand.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ NetworkRestorerClient.tsx
â”‚   â”‚   â”œâ”€â”€ SessionLoadingOverlay.tsx
â”‚   â”‚   â”œâ”€â”€ default-state.tsx
â”‚   â”‚   â”œâ”€â”€ finish-state.tsx
â”‚   â”‚   â”œâ”€â”€ provider-context-menu.tsx
â”‚   â”‚   â”œâ”€â”€ recording-active-state.tsx
â”‚   â”‚   â”œâ”€â”€ recording-state.tsx
â”‚   â”‚   â”œâ”€â”€ recording-waiting-state.tsx
â”‚   â”‚   â”œâ”€â”€ theme-provider.tsx
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â”œâ”€â”€ ExportButton.test.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ExportButton.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ accordion.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ alert-dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ alert.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ aspect-ratio.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ avatar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ breadcrumb.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ calendar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ carousel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ chart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ checkbox.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ collapsible.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ command.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ context-menu.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ drawer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dropdown-menu.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ hover-card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input-otp.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ menubar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ navigation-menu.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ pagination.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ popover.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ progress.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ radio-group.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ resizable.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ scroll-area.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ separator.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ sheet.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ skeleton.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ slider.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ sonner.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ switch.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tabs.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toast.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toaster.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toggle-group.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toggle.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tooltip.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ use-mobile.tsx
â”‚   â”‚   â”‚   â””â”€â”€ use-toast.ts
â”‚   â”‚   â”œâ”€â”€ upload-status-indicator.tsx
â”‚   â”‚   â””â”€â”€ waiting-state.tsx
â”‚   â”œâ”€â”€ components.json
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ languages.ts
â”‚   â”‚   â””â”€â”€ providers.ts
â”‚   â”œâ”€â”€ e2e/
â”‚   â”‚   â”œâ”€â”€ export-api.spec.ts
â”‚   â”‚   â”œâ”€â”€ offline-recovery.spec.ts
â”‚   â”‚   â”œâ”€â”€ service-layer-integration.spec.ts
â”‚   â”‚   â””â”€â”€ transcript-integration.spec.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ use-app-state-adapter.ts
â”‚   â”‚   â”œâ”€â”€ use-app-state-context.ts
â”‚   â”‚   â”œâ”€â”€ use-app-state-new.ts
â”‚   â”‚   â”œâ”€â”€ use-app-state.ts
â”‚   â”‚   â”œâ”€â”€ use-local-draft.ts
â”‚   â”‚   â”œâ”€â”€ use-mobile.tsx
â”‚   â”‚   â”œâ”€â”€ use-notes.ts
â”‚   â”‚   â”œâ”€â”€ use-recording-adapter.ts
â”‚   â”‚   â”œâ”€â”€ use-recording-new.ts
â”‚   â”‚   â”œâ”€â”€ use-recording.ts
â”‚   â”‚   â”œâ”€â”€ use-session-adapter.ts
â”‚   â”‚   â”œâ”€â”€ use-session-new.ts
â”‚   â”‚   â”œâ”€â”€ use-session.test.ts
â”‚   â”‚   â”œâ”€â”€ use-session.ts
â”‚   â”‚   â”œâ”€â”€ use-toast.ts
â”‚   â”‚   â”œâ”€â”€ use-transcript-adapter.ts
â”‚   â”‚   â”œâ”€â”€ use-transcript-new.ts
â”‚   â”‚   â”œâ”€â”€ use-transcript.ts
â”‚   â”‚   â””â”€â”€ useNetworkRestorer.ts
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”‚   â”œâ”€â”€ advanced-audio-recorder.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ initial-state-loader.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ migration-adapter.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ network-restorer.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ rest-audio-uploader-409.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ segmented-audio-recorder.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ state-machine.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ state-management.test.ts
â”‚   â”‚   â”œâ”€â”€ advanced-audio-recorder.ts
â”‚   â”‚   â”œâ”€â”€ api.test.ts
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ app-state-reducer.ts
â”‚   â”‚   â”œâ”€â”€ app-store-zustand.ts
â”‚   â”‚   â”œâ”€â”€ app-store.ts
â”‚   â”‚   â”œâ”€â”€ audio-recorder.ts
â”‚   â”‚   â”œâ”€â”€ config.ts
â”‚   â”‚   â”œâ”€â”€ feature-flags.ts
â”‚   â”‚   â”œâ”€â”€ initial-state-loader.ts
â”‚   â”‚   â”œâ”€â”€ interfaces.ts
â”‚   â”‚   â”œâ”€â”€ migration-adapter.ts
â”‚   â”‚   â”œâ”€â”€ rest-audio-uploader.ts
â”‚   â”‚   â”œâ”€â”€ segmented-audio-recorder.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ recording-flow-service.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ recording-service.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ session-service-409.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ session-service.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ simple-recording-service.test.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ transcript-service.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ base-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ interfaces.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ recording-flow-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ recording-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ service-container.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ service-registry.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ session-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ simple-recording-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ transcript-service-adapted.ts
â”‚   â”‚   â”‚   â””â”€â”€ transcript-service.ts
â”‚   â”‚   â”œâ”€â”€ simple-audio-recorder.ts
â”‚   â”‚   â”œâ”€â”€ state-machine.ts
â”‚   â”‚   â”œâ”€â”€ stream/
â”‚   â”‚   â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ audio-uploader.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ audio-uploader.ts
â”‚   â”‚   â”œâ”€â”€ transcript-manager-adapter.ts
â”‚   â”‚   â”œâ”€â”€ transcript-manager-new.ts
â”‚   â”‚   â”œâ”€â”€ transcript-manager.ts
â”‚   â”‚   â”œâ”€â”€ typed-emitter.ts
â”‚   â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚   â””â”€â”€ websocket.ts
â”‚   â”œâ”€â”€ next.config.mjs
â”‚   â”œâ”€â”€ node_modules/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ playwright-report/
â”‚   â”œâ”€â”€ playwright.config.ts
â”‚   â”œâ”€â”€ pnpm-lock.yaml
â”‚   â”œâ”€â”€ postcss.config.mjs
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â””â”€â”€ app-state-provider-wrapper.tsx
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ placeholder-logo.png
â”‚   â”‚   â”œâ”€â”€ placeholder-logo.svg
â”‚   â”‚   â”œâ”€â”€ placeholder-user.jpg
â”‚   â”‚   â”œâ”€â”€ placeholder.jpg
â”‚   â”‚   â””â”€â”€ placeholder.svg
â”‚   â”œâ”€â”€ refresh.ts
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ test-setup.ts
â”‚   â”œâ”€â”€ study-scriber.tsx
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ test-transcript-integration.js
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ app-state-context.ts
â”‚   â”‚   â”œâ”€â”€ app-state.ts
â”‚   â”‚   â”œâ”€â”€ state-transitions.ts
â”‚   â”‚   â””â”€â”€ websocket-messages.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ event-bus.ts
â”‚   â”‚   â”œâ”€â”€ export.ts
â”‚   â”‚   â””â”€â”€ time.ts
â”‚   â””â”€â”€ vitest.config.ts
â”œâ”€â”€ main.py
â”œâ”€â”€ package.json
â”œâ”€â”€ playwright.config.ts
â”œâ”€â”€ pnpm-lock.yaml
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ pytest.ini
â”œâ”€â”€ tests/
â””â”€â”€ uv.lock

# BEGIN FILE CONTENTS

# File: frontend/components/ui/ExportButton.test.tsx

import { render, fireEvent, waitFor } from '@testing-library/react'
import ExportButton from './ExportButton'

jest.mock('@/hooks/use-session', () => ({
    useSession: () => ({ waitUntilCompleted: jest.fn() }),
}))
jest.mock('@/lib/api', () => ({
    notesAPI: { updateNote: jest.fn() },
}))
jest.mock('@/utils/export', () => ({
    downloadZip: jest.fn(),
}))
jest.mock('@/hooks/use-toast', () => ({
    toast: jest.fn(),
}))

const { useSession } = require('@/hooks/use-session')
const { notesAPI } = require('@/lib/api')
const { downloadZip } = require('@/utils/export')
const { toast } = require('@/hooks/use-toast')

describe('ExportButton', () => {
    beforeEach(() => {
        jest.clearAllMocks()
    })

    it('calls waitUntilCompleted and downloads on success', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(true) })
        notesAPI.updateNote.mockResolvedValue({})
        downloadZip.mockResolvedValue()
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        fireEvent.click(getByText(/Export/))
        await waitFor(() => expect(notesAPI.updateNote).toHaveBeenCalledWith('sid', { content: 'abc' }))
        expect(downloadZip).toHaveBeenCalledWith('sid')
    })

    it('shows toast if waitUntilCompleted returns false', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(false) })
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        fireEvent.click(getByText(/Export/))
        await waitFor(() => expect(toast).toHaveBeenCalledWith(expect.objectContaining({ title: expect.stringMatching(/å¾Œç«¯ä»åœ¨è™•ç†/) })))
    })

    it('shows error toast if updateNote fails', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(true) })
        notesAPI.updateNote.mockRejectedValue(new Error('fail'))
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        fireEvent.click(getByText(/Export/))
        await waitFor(() => expect(toast).toHaveBeenCalledWith(expect.objectContaining({ variant: 'destructive' })))
    })

    it('shows error toast if downloadZip fails', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(true) })
        notesAPI.updateNote.mockResolvedValue({})
        downloadZip.mockRejectedValue(new Error('fail'))
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        fireEvent.click(getByText(/Export/))
        await waitFor(() => expect(toast).toHaveBeenCalledWith(expect.objectContaining({ variant: 'destructive' })))
    })

    it('does not trigger export when busy', async () => {
        useSession.mockReturnValue({ waitUntilCompleted: jest.fn().mockResolvedValue(true) })
        notesAPI.updateNote.mockResolvedValue({})
        downloadZip.mockResolvedValue()
        const { getByText } = render(<ExportButton sid="sid" editorContent="abc" />)
        const btn = getByText(/Export/)
        fireEvent.click(btn)
        fireEvent.click(btn)
        await waitFor(() => expect(notesAPI.updateNote).toHaveBeenCalledTimes(1))
    })
})


# END FILE CONTENTS


# File: app/ws/__init__.py

"""
WebSocket æ¨¡çµ„

æä¾›å³æ™‚éŸ³è¨Šä¸Šå‚³å’Œé€å­—ç¨¿æ¨é€åŠŸèƒ½
"""

"""app.ws package åˆå§‹åŒ–æª”

é¿å…åœ¨ import æ™‚é€ æˆå¾ªç’°ä¾è³´ï¼Œæš«ä¸ä¸»å‹•è¼‰å…¥ upload_audioã€‚éœ€è¦æ™‚è«‹ç›´æ¥å¾ `app.ws.upload_audio` å°å…¥ç›®æ¨™ã€‚"""

__all__ = []


# END FILE CONTENTS


# File: app/ws/transcript_feed.py

import asyncio
import logging
import json
from fastapi import APIRouter, WebSocket, WebSocketDisconnect
from typing import Dict, List

logger = logging.getLogger(__name__)
router = APIRouter()

class ConnectionManager:
    def __init__(self):
        # å°‡æ´»èºé€£æ¥å„²å­˜åœ¨å­—å…¸ä¸­ï¼Œä»¥ session_id ç‚ºéµ
        self.active_connections: Dict[str, List[WebSocket]] = {}
        logger.info("ConnectionManager (In-Memory) å·²åˆå§‹åŒ–")

    async def connect(self, websocket: WebSocket, session_id: str):
        await websocket.accept()
        if session_id not in self.active_connections:
            self.active_connections[session_id] = []
        self.active_connections[session_id].append(websocket)
        logger.info(f"WebSocket å®¢æˆ¶ç«¯å·²é€£æ¥åˆ° session_id: {session_id}ã€‚ç›®å‰è©² session æœ‰ {len(self.active_connections[session_id])} å€‹é€£æ¥ã€‚")

    def disconnect(self, websocket: WebSocket, session_id: str):
        if session_id in self.active_connections:
            try:
                self.active_connections[session_id].remove(websocket)
                logger.info(f"WebSocket å®¢æˆ¶ç«¯å·²å¾ session_id: {session_id} æ–·é–‹ã€‚")
                if not self.active_connections[session_id]:
                    del self.active_connections[session_id]
                    logger.info(f"Session_id: {session_id} å·²ç„¡é€£æ¥ï¼Œå¾ç®¡ç†å™¨ä¸­ç§»é™¤ã€‚")
            except ValueError:
                logger.warning(f"å˜—è©¦æ–·é–‹ä¸€å€‹ä¸å­˜åœ¨æ–¼ session_id: {session_id} çš„ WebSocket é€£æ¥ã€‚")
        else:
            logger.warning(f"å˜—è©¦å¾ä¸€å€‹ä¸å­˜åœ¨çš„ session_id: {session_id} æ–·é–‹é€£æ¥ã€‚")

    async def broadcast(self, message: str, session_id: str):
        if session_id in self.active_connections and self.active_connections[session_id]:
            client_count = len(self.active_connections[session_id])
            logger.info(f"ğŸ“¡ [ConnectionManager] æ­£åœ¨å‘ session_id: {session_id} çš„ {client_count} å€‹å®¢æˆ¶ç«¯å»£æ’­è¨Šæ¯")

            # è¨˜éŒ„è¨Šæ¯å…§å®¹ï¼ˆç°¡åŒ–ç‰ˆï¼‰
            try:
                import json
                parsed_msg = json.loads(message)
                msg_type = parsed_msg.get('type', parsed_msg.get('phase', 'unknown'))
                logger.info(f"ğŸ“¡ [ConnectionManager] è¨Šæ¯é¡å‹: {msg_type}")
                if 'text' in parsed_msg:
                    text_preview = parsed_msg['text'][:30] + ('...' if len(parsed_msg['text']) > 30 else '')
                    logger.info(f"ğŸ“¡ [ConnectionManager] æ–‡å­—é è¦½: '{text_preview}'")
            except:
                logger.info(f"ğŸ“¡ [ConnectionManager] åŸå§‹è¨Šæ¯: {message[:100]}...")

            # å»ºç«‹ä¸€å€‹ä»»å‹™åˆ—è¡¨ä»¥ä½µç™¼ç™¼é€
            tasks = [connection.send_text(message) for connection in self.active_connections[session_id]]
            results = await asyncio.gather(*tasks, return_exceptions=True)

            # æª¢æŸ¥ç™¼é€çµæœ
            success_count = sum(1 for r in results if not isinstance(r, Exception))
            error_count = len(results) - success_count

            if error_count > 0:
                logger.warning(f"ğŸ“¡ [ConnectionManager] å»£æ’­çµæœ: {success_count} æˆåŠŸ, {error_count} å¤±æ•—")
                for i, result in enumerate(results):
                    if isinstance(result, Exception):
                        logger.error(f"ğŸ“¡ [ConnectionManager] å®¢æˆ¶ç«¯ {i} ç™¼é€å¤±æ•—: {result}")
            else:
                logger.info(f"âœ… [ConnectionManager] å»£æ’­æˆåŠŸ: æ‰€æœ‰ {client_count} å€‹å®¢æˆ¶ç«¯éƒ½æ”¶åˆ°è¨Šæ¯")
        else:
            logger.warning(f"âš ï¸ [ConnectionManager] å»£æ’­å¤±æ•—ï¼šæ‰¾ä¸åˆ° session_id: {session_id} çš„æ´»èºé€£æ¥")
            logger.info(f"ğŸ“Š [ConnectionManager] ç›®å‰æ´»èº sessions: {list(self.active_connections.keys())}")

# å»ºç«‹ä¸€å€‹å…¨åŸŸçš„ ConnectionManager å¯¦ä¾‹
manager = ConnectionManager()

@router.websocket("/ws/transcript_feed/{session_id}")
async def websocket_endpoint(websocket: WebSocket, session_id: str):
    """
    ç”¨æ–¼æ¥æ”¶å³æ™‚é€å­—ç¨¿çš„ WebSocket ç«¯é»ã€‚

    - æ¯ä¸ª session_id å»ºç«‹ä¸€å€‹ç¨ç«‹çš„å»£æ’­é »é“ã€‚
    - å®¢æˆ¶ç«¯é€£æ¥å¾Œï¼ŒæœƒåŠ å…¥å°æ‡‰ session_id çš„é »é“ä¸¦ç›£è½è¨Šæ¯ã€‚
    - å¾Œç«¯è½‰éŒ„æœå‹™å®Œæˆå¾Œï¼Œæœƒå°‡çµæœç™¼å¸ƒåˆ°æ­¤é »é“ã€‚
    """
    await manager.connect(websocket, session_id)
    # æ–°å¢ï¼šå‘ŠçŸ¥å‰ç«¯ç­‰å¾…éšæ®µ
    await websocket.send_text(json.dumps({"phase": "waiting"}))
    try:
        # ä¿æŒé€£ç·šé–‹å•Ÿä»¥æ¥æ”¶å»£æ’­
        while True:
            # é€™å€‹è¿´åœˆä¸»è¦æ˜¯ç‚ºäº†ç¶­æŒé€£ç·šç‹€æ…‹ï¼Œ
            # receive_text() æœƒç­‰å¾…å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯ã€‚
            # æˆ‘å€‘å¯ä»¥è¨­å®šä¸€å€‹ timeout ä¾†å®šæœŸæª¢æŸ¥é€£ç·šæˆ–é€²è¡Œæ¸…ç†ã€‚
            await websocket.receive_text()

    except WebSocketDisconnect:
        logger.info(f"WebSocket for session {session_id} ä¸»å‹•æ–·é–‹é€£æ¥ã€‚")
        manager.disconnect(websocket, session_id)
    except Exception as e:
        logger.error(f"WebSocket for session {session_id} ç™¼ç”Ÿæ„å¤–éŒ¯èª¤: {e}")
        manager.disconnect(websocket, session_id)


# END FILE CONTENTS


# File: frontend/hooks/use-session.test.ts

// @ts-expect-error: jest types for test runner
import '@types/jest'
import '@testing-library/jest-dom'
import { renderHook, act } from '@testing-library/react'
import { useSession } from './use-session'

jest.mock('../lib/api', () => ({
    sessionAPI: {
        getSession: jest.fn(),
    },
}))

const { sessionAPI } = require('../lib/api')

describe('useSession - waitUntilCompleted', () => {
    beforeEach(() => {
        jest.clearAllMocks()
    })

    it('should resolve true immediately if session is completed', async () => {
        sessionAPI.getSession.mockResolvedValue({ status: 'completed' })
        const { result } = renderHook(() => useSession())
        await act(async () => {
            const ok = await result.current.waitUntilCompleted('sid', 1000)
            expect(ok).toBe(true)
        })
        expect(sessionAPI.getSession).toHaveBeenCalledTimes(1)
    })

    it('should poll until completed then resolve true', async () => {
        const states = [
            { status: 'processing' },
            { status: 'processing' },
            { status: 'completed' },
        ]
        let call = 0
        sessionAPI.getSession.mockImplementation(() => Promise.resolve(states[call++]))
        const { result } = renderHook(() => useSession())
        await act(async () => {
            const ok = await result.current.waitUntilCompleted('sid', 2000)
            expect(ok).toBe(true)
        })
        expect(sessionAPI.getSession).toHaveBeenCalledTimes(3)
    })

    it('should return false if timeout before completed', async () => {
        sessionAPI.getSession.mockResolvedValue({ status: 'processing' })
        const { result } = renderHook(() => useSession())
        await act(async () => {
            const ok = await result.current.waitUntilCompleted('sid', 1600)
            expect(ok).toBe(false)
        })
        // 1600ms / 1500ms = 2 æ¬¡
        expect(sessionAPI.getSession).toHaveBeenCalledTimes(2)
    })

    it('should ignore 404 and retry until timeout', async () => {
        const error = { response: { status: 404 }, isAxiosError: true }
        sessionAPI.getSession.mockRejectedValue(error)
        const { result } = renderHook(() => useSession())
        await act(async () => {
            const ok = await result.current.waitUntilCompleted('sid', 1600)
            expect(ok).toBe(false)
        })
        expect(sessionAPI.getSession).toHaveBeenCalledTimes(2)
    })

    it('should throw on non-404 error', async () => {
        const error = { response: { status: 500 }, isAxiosError: true }
        sessionAPI.getSession.mockRejectedValue(error)
        const { result } = renderHook(() => useSession())
        await expect(result.current.waitUntilCompleted('sid', 1000)).rejects.toEqual(error)
    })
})


# END FILE CONTENTS


# File: frontend/__tests__/integration/state-transitions.test.ts

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { StateMachine } from '../../lib/state-machine'
import { featureFlagManager } from '../../lib/feature-flags'
import type { AppState } from '../../types/app-state'
import type { StateTransitionContext } from '../../types/state-transitions'

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
    clear: vi.fn(),
}

Object.defineProperty(window, 'localStorage', {
    value: localStorageMock
})

describe('ç‹€æ…‹è½‰æ›æ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        featureFlagManager.reset()
        featureFlagManager.enable('useNewStateManagement')
        localStorageMock.getItem.mockReturnValue(null)
    })

    describe('åŸºæœ¬ç‹€æ…‹è½‰æ›', () => {
        test('æ‡‰è©²æ”¯æ´ default â†’ recording_waiting è½‰æ›', () => {
            const stateMachine = new StateMachine('default')

            const canTransition = stateMachine.canTransition('START_RECORDING')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('START_RECORDING')
            expect(newState).toBe('recording_waiting')
        })

        test('æ‡‰è©²æ”¯æ´ recording_waiting â†’ recording_active è½‰æ›', () => {
            const stateMachine = new StateMachine('recording_waiting')

            const canTransition = stateMachine.canTransition('RECORDING_STARTED')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('RECORDING_STARTED')
            expect(newState).toBe('recording_active')
        })

        test('æ‡‰è©²æ”¯æ´ recording_active â†’ processing è½‰æ›', () => {
            const stateMachine = new StateMachine('recording_active')

            const canTransition = stateMachine.canTransition('STOP_RECORDING')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('STOP_RECORDING')
            expect(newState).toBe('processing')
        })

        test('æ‡‰è©²æ”¯æ´ processing â†’ finished è½‰æ›', () => {
            const stateMachine = new StateMachine('processing')

            const canTransition = stateMachine.canTransition('PROCESSING_COMPLETE')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('PROCESSING_COMPLETE')
            expect(newState).toBe('finished')
        })
    })

    describe('ç‹€æ…‹è½‰æ›é™åˆ¶', () => {
        test('ä¸æ‡‰è©²å…è¨±ç„¡æ•ˆçš„ç‹€æ…‹è½‰æ›', () => {
            const stateMachine = new StateMachine('default')

            // ä¸èƒ½ç›´æ¥å¾ default è·³åˆ° recording_active
            const canTransition = stateMachine.canTransition('RECORDING_STARTED')
            expect(canTransition).toBe(false)

            // å˜—è©¦ç„¡æ•ˆè½‰æ›æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
            expect(() => {
                stateMachine.transition('RECORDING_STARTED')
            }).toThrow()
        })

        test('finished ç‹€æ…‹æ‡‰è©²åªèƒ½é‡ç½®åˆ° default', () => {
            const stateMachine = new StateMachine('finished')

            // åªèƒ½é‡ç½®
            expect(stateMachine.canTransition('RESET')).toBe(true)
            expect(stateMachine.canTransition('START_RECORDING')).toBe(false)
            expect(stateMachine.canTransition('STOP_RECORDING')).toBe(false)

            const newState = stateMachine.transition('RESET')
            expect(newState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´å¾ä»»ä½•ç‹€æ…‹é‡ç½®åˆ° default', () => {
            const states: AppState[] = ['default', 'recording_waiting', 'recording_active', 'processing', 'finished']

            states.forEach(state => {
                const stateMachine = new StateMachine(state)
                expect(stateMachine.canTransition('RESET')).toBe(true)
                expect(stateMachine.transition('RESET')).toBe('default')
            })
        })
    })

    describe('å®Œæ•´ç‹€æ…‹æµç¨‹', () => {
        test('æ‡‰è©²æ”¯æ´å®Œæ•´çš„éŒ„éŸ³æµç¨‹', () => {
            const stateMachine = new StateMachine('default')

            // å®Œæ•´æµç¨‹ï¼šdefault â†’ recording_waiting â†’ recording_active â†’ processing â†’ finished
            expect(stateMachine.getCurrentState()).toBe('default')

            // é–‹å§‹éŒ„éŸ³
            const waitingState = stateMachine.transition('START_RECORDING')
            expect(waitingState).toBe('recording_waiting')

            // éŒ„éŸ³é–‹å§‹
            const activeState = stateMachine.transition('RECORDING_STARTED')
            expect(activeState).toBe('recording_active')

            // åœæ­¢éŒ„éŸ³
            const processingState = stateMachine.transition('STOP_RECORDING')
            expect(processingState).toBe('processing')

            // è™•ç†å®Œæˆ
            const finishedState = stateMachine.transition('PROCESSING_COMPLETE')
            expect(finishedState).toBe('finished')

            // é‡ç½®
            const resetState = stateMachine.transition('RESET')
            expect(resetState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´ç­†è¨˜æ¨¡å¼æµç¨‹', () => {
            const stateMachine = new StateMachine('default')

            // ç­†è¨˜æ¨¡å¼ï¼šdefault â†’ finished (ç›´æ¥å®Œæˆ)
            expect(stateMachine.getCurrentState()).toBe('default')

            const finishedState = stateMachine.transition('FINISH_SESSION')
            expect(finishedState).toBe('finished')
        })
    })

    describe('éŒ¯èª¤æ¢å¾©', () => {
        test('æ‡‰è©²æ”¯æ´éŒ¯èª¤ç‹€æ…‹æ¢å¾©', () => {
            const stateMachine = new StateMachine('recording_active')

            // å¾éŒ„éŸ³ä¸­ç™¼ç”ŸéŒ¯èª¤
            const errorState = stateMachine.transition('ERROR')
            expect(errorState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´æœƒè©±å‡ç´š', () => {
            const stateMachine = new StateMachine('default')

            // å‡ç´šåˆ°éŒ„éŸ³æ¨¡å¼
            const upgradedState = stateMachine.transition('UPGRADE_TO_RECORDING')
            expect(upgradedState).toBe('recording_waiting')
        })
    })

    describe('ä¸¦ç™¼ç‹€æ…‹è®Šæ›´', () => {
        test('ç‹€æ…‹æ©Ÿæ‡‰è©²æ˜¯ç·šç¨‹å®‰å…¨çš„', () => {
            const stateMachine = new StateMachine('default')
            const results: AppState[] = []

            // æ¨¡æ“¬ä¸¦ç™¼è½‰æ›
            const transitions = [
                'START_RECORDING',
                'RESET',
                'START_RECORDING',
                'RESET'
            ]

            transitions.forEach(trigger => {
                try {
                    const newState = stateMachine.transition(trigger as any)
                    results.push(newState)
                } catch (error) {
                    // æŸäº›è½‰æ›å¯èƒ½å¤±æ•—ï¼Œé€™æ˜¯é æœŸçš„
                }
            })

            // æœ€å¾Œç‹€æ…‹æ‡‰è©²æ˜¯æœ‰æ•ˆçš„
            const finalState = stateMachine.getCurrentState()
            const validStates: AppState[] = ['default', 'recording_waiting', 'recording_active', 'processing', 'finished']
            expect(validStates).toContain(finalState)
        })
    })

    describe('ç‹€æ…‹æ­·å²', () => {
        test('æ‡‰è©²è¨˜éŒ„ç‹€æ…‹è½‰æ›æ­·å²', () => {
            const stateMachine = new StateMachine('default')

            stateMachine.transition('START_RECORDING')
            stateMachine.transition('RECORDING_STARTED')
            stateMachine.transition('STOP_RECORDING')

            const history = stateMachine.getHistory()
            expect(history).toHaveLength(4) // åŒ…å«åˆå§‹ç‹€æ…‹
            expect(history[0]).toBe('default')
            expect(history[1]).toBe('recording_waiting')
            expect(history[2]).toBe('recording_active')
            expect(history[3]).toBe('processing')
        })

        test('æ‡‰è©²æ”¯æ´å›åˆ°ä¸Šä¸€å€‹ç‹€æ…‹', () => {
            const stateMachine = new StateMachine('default')

            stateMachine.transition('START_RECORDING')
            stateMachine.transition('RECORDING_STARTED')

            const canGoBack = stateMachine.canGoBack()
            expect(canGoBack).toBe(true)

            const previousState = stateMachine.goBack()
            expect(previousState).toBe('recording_waiting')
            expect(stateMachine.getCurrentState()).toBe('recording_waiting')
        })
    })
})


# END FILE CONTENTS


# File: frontend/e2e/service-layer-integration.spec.ts

import { test, expect } from '@playwright/test'

/**
 * æœå‹™å±¤æ•´åˆæ¸¬è©¦ - å®Œæ•´é©—è­‰é‡æ§‹å¾Œçš„ç³»çµ±
 */

test.describe('æœå‹™å±¤æ•´åˆæ¸¬è©¦', () => {
    let consoleLogs: string[] = []
    let consoleErrors: string[] = []

    test.beforeEach(async ({ page }) => {
        consoleLogs = []
        consoleErrors = []

        // ç›£è½ console è¼¸å‡º
        page.on('console', (msg) => {
            const text = `[${msg.type()}] ${msg.text()}`
            console.log(`ğŸ–¥ï¸  ${text}`)

            if (msg.type() === 'error') {
                consoleErrors.push(text)
            } else {
                consoleLogs.push(text)
            }
        })

        page.on('pageerror', (error) => {
            console.log(`âŒ Page Error: ${error.message}`)
            consoleErrors.push(`PAGE_ERROR: ${error.message}`)
        })

        console.log('ğŸš€ å°èˆªåˆ°æ‡‰ç”¨...')
        await page.goto('/')
        await page.waitForLoadState('networkidle')
        console.log('âœ… é é¢è¼‰å…¥å®Œæˆ')
    })

    test('åŸºç¤æ¶æ§‹é©—è­‰', async ({ page }) => {
        console.log('\nğŸ”§ é©—è­‰æœå‹™å±¤åŸºç¤æ¶æ§‹...')

        await expect(page.locator('body')).toBeVisible()
        await page.waitForTimeout(3000)

        const result = await page.evaluate(() => ({
            hasWindow: typeof window !== 'undefined',
            windowKeys: Object.keys(window).length,
            appElements: document.querySelectorAll('[id*="root"], main, .app').length
        }))

        console.log('ğŸ“Š åŸºç¤æª¢æŸ¥:', result)
        console.log(`ğŸ“Š Console Logs: ${consoleLogs.length}`)
        console.log(`âŒ Errors: ${consoleErrors.length}`)
    })

    test('éŒ„éŸ³åŠŸèƒ½å®Œæ•´æ¸¬è©¦', async ({ page }) => {
        console.log('\nğŸ¤ æ¸¬è©¦éŒ„éŸ³åŠŸèƒ½...')

        await page.context().grantPermissions(['microphone'])

        const buttons = await page.locator('button').all()
        console.log(`ğŸ“Š æ‰¾åˆ° ${buttons.length} å€‹æŒ‰éˆ•`)

        for (const button of buttons.slice(0, 3)) {
            const text = await button.textContent()
            const isVisible = await button.isVisible()
            const isEnabled = await button.isEnabled()

            console.log(`ğŸ“‹ æŒ‰éˆ•: "${text}" - å¯è¦‹:${isVisible}, å•Ÿç”¨:${isEnabled}`)

            if (isVisible && isEnabled && text?.trim()) {
                console.log(`ğŸ”„ é»æ“Š: "${text}"`)
                const logsBefore = consoleLogs.length

                await button.click()
                await page.waitForTimeout(2000)

                const newLogs = consoleLogs.slice(logsBefore)
                console.log(`ğŸ“ æ–°å¢ ${newLogs.length} æ¢æ—¥èªŒ`)
                newLogs.forEach(log => console.log(`   ${log}`))
            }
        }
    })

    test('æœå‹™å±¤æ—¥èªŒåˆ†æ', async ({ page }) => {
        console.log('\nğŸ” åˆ†ææœå‹™å±¤æ—¥èªŒ...')

        await page.waitForTimeout(2000)

        // è§¸ç™¼ä¸€äº›äº’å‹•
        const elements = page.locator('button, input, [role="button"]')
        const count = await elements.count()

        for (let i = 0; i < Math.min(3, count); i++) {
            try {
                await elements.nth(i).click()
                await page.waitForTimeout(500)
            } catch { }
        }

        // åˆ†ææ—¥èªŒ
        const serviceLogs = consoleLogs.filter(log =>
            log.toLowerCase().includes('service') ||
            log.toLowerCase().includes('container')
        )

        const recordingLogs = consoleLogs.filter(log =>
            log.toLowerCase().includes('record') ||
            log.toLowerCase().includes('audio')
        )

        const stateLogs = consoleLogs.filter(log =>
            log.toLowerCase().includes('state') ||
            log.toLowerCase().includes('action')
        )

        console.log('\nğŸ“Š æ—¥èªŒåˆ†æ:')
        console.log(`   æœå‹™å±¤: ${serviceLogs.length}`)
        console.log(`   éŒ„éŸ³: ${recordingLogs.length}`)
        console.log(`   ç‹€æ…‹: ${stateLogs.length}`)
        console.log(`   ç¸½è¨ˆ: ${consoleLogs.length}`)
        console.log(`   éŒ¯èª¤: ${consoleErrors.length}`)

        if (serviceLogs.length > 0) {
            console.log('\nğŸ”§ æœå‹™å±¤æ—¥èªŒ:')
            serviceLogs.forEach(log => console.log(`   ${log}`))
        }

        if (recordingLogs.length > 0) {
            console.log('\nğŸ¤ éŒ„éŸ³æ—¥èªŒ:')
            recordingLogs.forEach(log => console.log(`   ${log}`))
        }
    })

    test.afterEach(async () => {
        console.log('\nğŸ“‹ æ¸¬è©¦ç¸½çµ:')
        console.log(`ğŸ“Š Console Logs: ${consoleLogs.length}`)
        console.log(`âŒ Errors: ${consoleErrors.length}`)

        if (consoleErrors.length > 0) {
            console.log('\nâŒ éŒ¯èª¤è©³æƒ…:')
            consoleErrors.forEach(error => console.log(`   ${error}`))
        }

        console.log('ğŸ æ¸¬è©¦å®Œæˆ\n' + '='.repeat(50))
    })
})


# END FILE CONTENTS


# File: frontend/hooks/use-session.ts

"use client"

import { useState, useCallback, useMemo } from 'react'
import axios from 'axios'
import { sessionAPI, type SessionCreateRequest, type SessionResponse } from '../lib/api'

interface UseSessionReturn {
    currentSession: SessionResponse | null
    isLoading: boolean
    error: string | null
    createNoteSession: (title?: string, content?: string) => Promise<SessionResponse | null>
    createRecordingSession: (title?: string, content?: string, lang_code?: string, stt_provider?: string) => Promise<SessionResponse | null>
    upgradeToRecording: () => Promise<SessionResponse | null>
    finishSession: () => Promise<void>
    deleteSession: () => Promise<void>
    clearSession: () => void
    checkActiveSession: () => Promise<SessionResponse | null>
}

export function useSession(): UseSessionReturn {
    const [currentSession, setCurrentSession] = useState<SessionResponse | null>(null)
    const [isLoading, setIsLoading] = useState(false)
    const [error, setError] = useState<string | null>(null)

    const clearError = useCallback(() => {
        setError(null)
    }, [])

    const checkActiveSession = useCallback(async (): Promise<SessionResponse | null> => {
        setIsLoading(true)
        clearError()

        try {
            const activeSession = await sessionAPI.getActiveSession()
            if (activeSession) {
                setCurrentSession(activeSession)
                console.log('âœ… å·²æ¢å¾©æ´»èºæœƒè©±ç‹€æ…‹:', activeSession)
                return activeSession
            } else {
                console.log('â„¹ï¸ æ²’æœ‰æ´»èºæœƒè©±ï¼Œä½¿ç”¨é è¨­ç‹€æ…‹')
                return null
            }
        } catch (err) {
            // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œä¸”æ˜¯åˆå§‹åŒ–éšæ®µï¼Œå‰‡éœé»˜è™•ç†
            if (err instanceof Error && err.message.includes('Network Error')) {
                console.warn('âš ï¸ Backend API é€£ç·šæš«æ™‚å¤±æ•—ï¼Œå°‡åœ¨å¾ŒçºŒé‡è©¦:', err.message)
                return null // éœé»˜å¤±æ•—ï¼Œä¸è¨­ç½®éŒ¯èª¤ç‹€æ…‹
            }

            const errorMessage = err instanceof Error ? err.message : 'æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            setIsLoading(false)
        }
    }, [clearError])
    const createNoteSession = useCallback(async (title?: string, content?: string): Promise<SessionResponse | null> => {
        setIsLoading(true)
        clearError()

        try {
            const sessionData: SessionCreateRequest = {
                title,
                type: 'note_only',
                content,
            }

            const session = await sessionAPI.createSession(sessionData)
            setCurrentSession(session)
            console.log('âœ… ç´”ç­†è¨˜æœƒè©±å»ºç«‹æˆåŠŸ:', session)
            return session
        } catch (err) {
            // ç‰¹åˆ¥è™•ç† 409 è¡çªéŒ¯èª¤
            if (axios.isAxiosError(err) && err.response?.status === 409) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                setError(conflictMessage)
                console.error('âŒ æœƒè©±è¡çªéŒ¯èª¤ (409):', err.response?.data?.detail || err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹æœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å»ºç«‹ç´”ç­†è¨˜æœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            setIsLoading(false)
        }
    }, [clearError])

    const createRecordingSession = useCallback(async (title?: string, content?: string, lang_code?: string, stt_provider?: string): Promise<SessionResponse | null> => {
        setIsLoading(true)
        clearError()

        try {
            const sessionData: SessionCreateRequest = {
                title,
                type: 'recording',
                content,
                lang_code,
                stt_provider,
            }

            const session = await sessionAPI.createSession(sessionData)
            setCurrentSession(session)
            console.log('âœ… éŒ„éŸ³æœƒè©±å»ºç«‹æˆåŠŸ:', session)
            return session
        } catch (err) {
            // ç‰¹åˆ¥è™•ç† 409 è¡çªéŒ¯èª¤
            if (axios.isAxiosError(err) && err.response?.status === 409) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                setError(conflictMessage)
                console.error('âŒ æœƒè©±è¡çªéŒ¯èª¤ (409):', err.response?.data?.detail || err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            setIsLoading(false)
        }
    }, [clearError])

    const upgradeToRecording = useCallback(async (): Promise<SessionResponse | null> => {
        if (!currentSession) {
            setError('æ²’æœ‰æ´»èºçš„æœƒè©±å¯ä»¥å‡ç´š')
            return null
        }

        if (currentSession.type === 'recording') {
            console.log('ğŸ”„ æœƒè©±å·²ç¶“æ˜¯éŒ„éŸ³æ¨¡å¼')
            return currentSession
        }

        setIsLoading(true)
        clearError()

        try {
            const updatedSession = await sessionAPI.upgradeToRecording(currentSession.id)
            setCurrentSession(updatedSession)
            console.log('âœ… æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼æˆåŠŸ:', updatedSession)
            return updatedSession
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å‡ç´šæœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å‡ç´šæœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            setIsLoading(false)
        }
    }, [currentSession, clearError])

    const finishSession = useCallback(async (): Promise<void> => {
        if (!currentSession) {
            console.log('ğŸ”„ æ²’æœ‰æ´»èºçš„æœƒè©±éœ€è¦å®Œæˆ')
            return
        }

        setIsLoading(true)
        clearError()

        try {
            await sessionAPI.finishSession(currentSession.id)
            console.log('âœ… æœƒè©±å®ŒæˆæˆåŠŸ:', currentSession.id)
            // ä¿æŒ session è³‡æ–™ï¼Œåªæ›´æ–°ç‹€æ…‹
            setCurrentSession((prev: SessionResponse | null) => prev ? { ...prev, status: 'completed' } : null)
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å®Œæˆæœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å®Œæˆæœƒè©±å¤±æ•—:', err)
        } finally {
            setIsLoading(false)
        }
    }, [currentSession, clearError])

    const deleteSession = useCallback(async (): Promise<void> => {
        if (!currentSession) {
            console.log('ğŸ”„ æ²’æœ‰æ´»èºçš„æœƒè©±éœ€è¦åˆªé™¤')
            return
        }

        setIsLoading(true)
        clearError()

        try {
            await sessionAPI.deleteSession(currentSession.id)
            console.log('âœ… æœƒè©±åˆªé™¤æˆåŠŸ:', currentSession.id)
            setCurrentSession(null)
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'åˆªé™¤æœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ åˆªé™¤æœƒè©±å¤±æ•—:', err)
        } finally {
            setIsLoading(false)
        }
    }, [currentSession, clearError])

    const clearSession = useCallback(() => {
        setCurrentSession(null)
        setError(null)
        console.log('ğŸ”„ æœƒè©±å·²æ¸…é™¤')
    }, [])

    return useMemo(() => ({
        currentSession,
        isLoading,
        error,
        createNoteSession,
        createRecordingSession,
        upgradeToRecording,
        finishSession,
        deleteSession,
        clearSession,
        checkActiveSession,
    }), [
        currentSession,
        isLoading,
        error,
        createNoteSession,
        createRecordingSession,
        upgradeToRecording,
        finishSession,
        deleteSession,
        clearSession,
        checkActiveSession,
    ])
}


# END FILE CONTENTS


# File: frontend/package.json

{
  "name": "my-v0-project",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "build": "next build",
    "dev": "next dev",
    "lint": "next lint",
    "start": "next start",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:run": "vitest run",
    "e2e": "playwright test"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.1",
    "@radix-ui/react-accordion": "1.2.2",
    "@radix-ui/react-alert-dialog": "1.1.4",
    "@radix-ui/react-aspect-ratio": "1.1.1",
    "@radix-ui/react-avatar": "1.1.2",
    "@radix-ui/react-checkbox": "1.1.3",
    "@radix-ui/react-collapsible": "1.1.2",
    "@radix-ui/react-context-menu": "2.2.4",
    "@radix-ui/react-dialog": "1.1.4",
    "@radix-ui/react-dropdown-menu": "2.1.4",
    "@radix-ui/react-hover-card": "1.1.4",
    "@radix-ui/react-label": "2.1.1",
    "@radix-ui/react-menubar": "1.1.4",
    "@radix-ui/react-navigation-menu": "1.2.3",
    "@radix-ui/react-popover": "1.1.4",
    "@radix-ui/react-progress": "1.1.1",
    "@radix-ui/react-radio-group": "1.2.2",
    "@radix-ui/react-scroll-area": "1.2.2",
    "@radix-ui/react-select": "2.1.4",
    "@radix-ui/react-separator": "1.1.1",
    "@radix-ui/react-slider": "1.2.2",
    "@radix-ui/react-slot": "1.1.1",
    "@radix-ui/react-switch": "1.1.2",
    "@radix-ui/react-tabs": "1.1.2",
    "@radix-ui/react-toast": "1.2.4",
    "@radix-ui/react-toggle": "1.1.1",
    "@radix-ui/react-toggle-group": "1.1.1",
    "@radix-ui/react-tooltip": "1.1.6",
    "axios": "^1.10.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "1.0.4",
    "date-fns": "4.1.0",
    "easymde": "latest",
    "embla-carousel-react": "8.5.1",
    "input-otp": "1.4.1",
    "lucide-react": "^0.454.0",
    "next": "15.2.4",
    "next-themes": "^0.4.4",
    "react": "^19",
    "react-day-picker": "8.10.1",
    "react-dom": "^19",
    "react-hook-form": "^7.54.1",
    "react-resizable-panels": "^2.1.7",
    "react-simplemde-editor": "latest",
    "recharts": "2.15.0",
    "sonner": "^1.7.1",
    "tailwind-merge": "^2.5.5",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.6",
    "zod": "^3.24.1",
    "zustand": "^5.0.6"
  },
  "devDependencies": {
    "@playwright/test": "^1.44.1",
    "@testing-library/jest-dom": "^6.6.3",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^14.6.1",
    "@types/node": "^22",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "@vitejs/plugin-react": "^4.6.0",
    "@vitest/ui": "^3.2.4",
    "autoprefixer": "^10.4.20",
    "eslint": "^9",
    "eslint-config-next": "15.3.4",
    "jsdom": "^26.1.0",
    "postcss": "^8.5.0",
    "tailwindcss": "^3.4.17",
    "typescript": "^5",
    "vitest": "^3.2.4"
  },
  "packageManager": "pnpm@10.7.0+sha1.66453f13fbf9078d3db193718206a8d738afdbdb"
}


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/session-service.test.ts

"use client"

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { SessionService } from '../session-service'
import { sessionAPI } from '../../api'
import type { SessionResponse } from '../../api'

// Mock sessionAPI
vi.mock('../../api', () => ({
    sessionAPI: {
        createSession: vi.fn(),
        upgradeToRecording: vi.fn(),
        finishSession: vi.fn(),
        deleteSession: vi.fn(),
        getActiveSession: vi.fn(),
    }
}))

describe('SessionService', () => {
    let sessionService: SessionService
    const mockSessionAPI = sessionAPI as any

    beforeEach(() => {
        sessionService = new SessionService()
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('æœå‹™åˆå§‹åŒ–', () => {
        it('æ‡‰è©²æ­£ç¢ºåˆå§‹åŒ– SessionService', () => {
            expect(sessionService).toBeDefined()
            expect(sessionService['serviceName']).toBe('SessionService')
        })

        it('æ‡‰è©²æ­£ç¢ºå•Ÿå‹•å’Œåœæ­¢æœå‹™', async () => {
            await sessionService.start()
            expect(sessionService['isRunning']).toBe(true)

            await sessionService.stop()
            expect(sessionService['isRunning']).toBe(false)
        })
    })

    describe('createRecordingSession', () => {
        const mockSession: SessionResponse = {
            id: 'test-session-id',
            title: 'Test Recording Session',
            type: 'recording',
            status: 'active',
            language: 'zh-TW',
            created_at: '2024-01-01T00:00:00Z',
            updated_at: '2024-01-01T00:00:00Z'
        }

        it('æ‡‰è©²æˆåŠŸå‰µå»ºéŒ„éŸ³æœƒè©±', async () => {
            mockSessionAPI.createSession.mockResolvedValue(mockSession)

            const result = await sessionService.createRecordingSession('Test Title', 'Test Content')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'Test Title',
                type: 'recording',
                content: 'Test Content'
            })
            expect(result).toEqual(mockSession)
        })

        it('æ‡‰è©²è™•ç†å¯é¸å…§å®¹åƒæ•¸', async () => {
            mockSessionAPI.createSession.mockResolvedValue(mockSession)

            await sessionService.createRecordingSession('Test Title')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'Test Title',
                type: 'recording',
                content: undefined
            })
        })

        it('æ‡‰è©²è™•ç† API éŒ¯èª¤', async () => {
            const apiError = new Error('API Error')
            mockSessionAPI.createSession.mockRejectedValue(apiError)

            await expect(sessionService.createRecordingSession('Test Title'))
                .rejects.toThrow('API Error')
        })

        it('æ‡‰è©²è™•ç† 409 è¡çªéŒ¯èª¤', async () => {
            const conflictError = new Error('409 Conflict')
            conflictError.message = '409'
            mockSessionAPI.createSession.mockRejectedValue(conflictError)

            await expect(sessionService.createRecordingSession('Test Title'))
                .rejects.toThrow('409')
        })
    })

    describe('createNoteSession', () => {
        const mockSession: SessionResponse = {
            id: 'test-note-session',
            title: 'Test Note Session',
            type: 'note_only',
            status: 'active',
            language: 'zh-TW',
            created_at: '2024-01-01T00:00:00Z',
            updated_at: '2024-01-01T00:00:00Z'
        }

        it('æ‡‰è©²æˆåŠŸå‰µå»ºç´”ç­†è¨˜æœƒè©±', async () => {
            mockSessionAPI.createSession.mockResolvedValue(mockSession)

            const result = await sessionService.createNoteSession('Note Title', 'Note Content')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'Note Title',
                type: 'note_only',
                content: 'Note Content'
            })
            expect(result).toEqual(mockSession)
        })

        it('æ‡‰è©²è™•ç†å¯é¸å…§å®¹åƒæ•¸', async () => {
            mockSessionAPI.createSession.mockResolvedValue(mockSession)

            await sessionService.createNoteSession('Note Title')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'Note Title',
                type: 'note_only',
                content: undefined
            })
        })
    })

    describe('upgradeToRecording', () => {
        const mockUpgradedSession: SessionResponse = {
            id: 'upgraded-session',
            title: 'Upgraded Session',
            type: 'recording',
            status: 'active',
            language: 'zh-TW',
            created_at: '2024-01-01T00:00:00Z',
            updated_at: '2024-01-01T00:00:00Z'
        }

        it('æ‡‰è©²æˆåŠŸå‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼', async () => {
            mockSessionAPI.upgradeToRecording.mockResolvedValue(mockUpgradedSession)

            const result = await sessionService.upgradeToRecording('session-id')

            expect(mockSessionAPI.upgradeToRecording).toHaveBeenCalledWith('session-id')
            expect(result).toEqual(mockUpgradedSession)
        })

        it('æ‡‰è©²è™•ç†å‡ç´šå¤±æ•—', async () => {
            const upgradeError = new Error('Upgrade failed')
            mockSessionAPI.upgradeToRecording.mockRejectedValue(upgradeError)

            await expect(sessionService.upgradeToRecording('session-id'))
                .rejects.toThrow('Upgrade failed')
        })
    })

    describe('finishSession', () => {
        it('æ‡‰è©²æˆåŠŸå®Œæˆæœƒè©±', async () => {
            mockSessionAPI.finishSession.mockResolvedValue(undefined)

            await sessionService.finishSession('session-id')

            expect(mockSessionAPI.finishSession).toHaveBeenCalledWith('session-id')
        })

        it('æ‡‰è©²è™•ç†å®Œæˆæœƒè©±å¤±æ•—', async () => {
            const finishError = new Error('Finish failed')
            mockSessionAPI.finishSession.mockRejectedValue(finishError)

            await expect(sessionService.finishSession('session-id'))
                .rejects.toThrow('Finish failed')
        })
    })

    describe('deleteSession', () => {
        it('æ‡‰è©²æˆåŠŸåˆªé™¤æœƒè©±', async () => {
            mockSessionAPI.deleteSession.mockResolvedValue(undefined)

            await sessionService.deleteSession('session-id')

            expect(mockSessionAPI.deleteSession).toHaveBeenCalledWith('session-id')
        })

        it('æ‡‰è©²è™•ç†åˆªé™¤æœƒè©±å¤±æ•—', async () => {
            const deleteError = new Error('Delete failed')
            mockSessionAPI.deleteSession.mockRejectedValue(deleteError)

            await expect(sessionService.deleteSession('session-id'))
                .rejects.toThrow('Delete failed')
        })
    })

    describe('checkActiveSession', () => {
        const mockActiveSession: SessionResponse = {
            id: 'active-session',
            title: 'Active Session',
            type: 'recording',
            status: 'active',
            language: 'zh-TW',
            created_at: '2024-01-01T00:00:00Z',
            updated_at: '2024-01-01T00:00:00Z'
        }

        it('æ‡‰è©²è¿”å›æ´»èºæœƒè©±', async () => {
            mockSessionAPI.getActiveSession.mockResolvedValue(mockActiveSession)

            const result = await sessionService.checkActiveSession()

            expect(mockSessionAPI.getActiveSession).toHaveBeenCalled()
            expect(result).toEqual(mockActiveSession)
        })

        it('æ‡‰è©²åœ¨æ²’æœ‰æ´»èºæœƒè©±æ™‚è¿”å› null', async () => {
            mockSessionAPI.getActiveSession.mockResolvedValue(null)

            const result = await sessionService.checkActiveSession()

            expect(result).toBeNull()
        })

        it('æ‡‰è©²è™•ç†æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—', async () => {
            const checkError = new Error('Check failed')
            mockSessionAPI.getActiveSession.mockRejectedValue(checkError)

            await expect(sessionService.checkActiveSession())
                .rejects.toThrow('Check failed')
        })
    })

    describe('éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæ¢ä»¶', () => {
        it('æ‡‰è©²è™•ç†ç©ºå­—ç¬¦ä¸²åƒæ•¸', async () => {
            mockSessionAPI.createSession.mockResolvedValue({
                id: 'test-session',
                title: '',
                type: 'recording',
                status: 'active',
                language: 'zh-TW',
                created_at: '2024-01-01T00:00:00Z',
                updated_at: '2024-01-01T00:00:00Z'
            })

            await sessionService.createRecordingSession('')

            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: '',
                type: 'recording',
                content: undefined
            })
        })

        it('æ‡‰è©²è™•ç†ç¶²è·¯éŒ¯èª¤', async () => {
            const networkError = new Error('Network Error')
            mockSessionAPI.createSession.mockRejectedValue(networkError)

            await expect(sessionService.createRecordingSession('Test'))
                .rejects.toThrow('Network Error')
        })

        it('æ‡‰è©²è™•ç†è¶…æ™‚éŒ¯èª¤', async () => {
            const timeoutError = new Error('Request timeout')
            mockSessionAPI.createSession.mockRejectedValue(timeoutError)

            await expect(sessionService.createRecordingSession('Test'))
                .rejects.toThrow('Request timeout')
        })
    })

    describe('ä¸¦ç™¼å ´æ™¯æ¸¬è©¦', () => {
        it('æ‡‰è©²è™•ç†ä¸¦ç™¼çš„æœƒè©±å‰µå»ºè«‹æ±‚', async () => {
            const mockSession1 = { ...mockSessionAPI, id: 'session-1' }
            const mockSession2 = { ...mockSessionAPI, id: 'session-2' }

            mockSessionAPI.createSession
                .mockResolvedValueOnce(mockSession1)
                .mockResolvedValueOnce(mockSession2)

            const promises = [
                sessionService.createRecordingSession('Session 1'),
                sessionService.createRecordingSession('Session 2')
            ]

            const results = await Promise.all(promises)

            expect(results).toHaveLength(2)
            expect(mockSessionAPI.createSession).toHaveBeenCalledTimes(2)
        })

        it('æ‡‰è©²è™•ç†ä¸€å€‹æˆåŠŸä¸€å€‹å¤±æ•—çš„ä¸¦ç™¼è«‹æ±‚', async () => {
            const mockSession = { id: 'success-session' }
            const error = new Error('Failed')

            mockSessionAPI.createSession
                .mockResolvedValueOnce(mockSession)
                .mockRejectedValueOnce(error)

            const promises = [
                sessionService.createRecordingSession('Success'),
                sessionService.createRecordingSession('Fail')
            ]

            const results = await Promise.allSettled(promises)

            expect(results[0].status).toBe('fulfilled')
            expect(results[1].status).toBe('rejected')
        })
    })

    describe('æœå‹™ç‹€æ…‹ç®¡ç†', () => {
        it('æ‡‰è©²å ±å‘Šæ­£ç¢ºçš„æœå‹™ç‹€æ…‹', () => {
            const info = sessionService.getServiceInfo()

            expect(info).toMatchObject({
                serviceName: 'SessionService',
                isInitialized: expect.any(Boolean),
                isRunning: expect.any(Boolean)
            })
        })

        it('æ‡‰è©²åœ¨å¤šæ¬¡å•Ÿå‹•æ™‚ä¿æŒç©©å®š', async () => {
            await sessionService.start()
            await sessionService.start()
            await sessionService.start()

            expect(sessionService['isRunning']).toBe(true)
        })

        it('æ‡‰è©²åœ¨å¤šæ¬¡åœæ­¢æ™‚ä¿æŒç©©å®š', async () => {
            await sessionService.start()
            await sessionService.stop()
            await sessionService.stop()
            await sessionService.stop()

            expect(sessionService['isRunning']).toBe(false)
        })
    })
})


# END FILE CONTENTS


# File: app/api/__init__.py



# END FILE CONTENTS


# File: app/services/stt/base.py

from __future__ import annotations

import abc
from typing import Dict, Any
from uuid import UUID

__all__ = ["ISTTProvider"]

class ISTTProvider(abc.ABC):
    """èªéŸ³è½‰æ–‡å­— Provider ä»‹é¢ã€‚æ‰€æœ‰è½‰éŒ„æœå‹™éœ€å¯¦ä½œæ­¤ä»‹é¢ã€‚"""

    @abc.abstractmethod
    async def transcribe(self, webm: bytes, session_id: UUID, chunk_seq: int) -> Dict[str, Any]:
        """è½‰éŒ„æŒ‡å®š WebM éŸ³è¨Šã€‚

        Args:
            webm: åŸå§‹ WebM éŸ³è¨ŠäºŒé€²ä½è³‡æ–™ã€‚
            session_id: æœƒè©± IDã€‚
            chunk_seq: åˆ‡ç‰‡åºè™Ÿã€‚

        Returns:
            dict: éœ€åŒ…å« text, start_offset, end_offset ç­‰æ¬„ä½ï¼Œå‰ç«¯ä¿æŒä¸€è‡´ã€‚"""

    @abc.abstractmethod
    def name(self) -> str:
        """å›å‚³ Provider åç¨± (ä¾‹å¦‚ 'whisper', 'gemini')"""

    @abc.abstractmethod
    def max_rpm(self) -> int:
        """API é€Ÿç‡é™åˆ¶ï¼šæ¯åˆ†é˜æœ€å¤§è«‹æ±‚æ•¸ (RateLimiter ç”¨)"""


# END FILE CONTENTS


# File: app/db/supabase_config.py

"""
StudyScriber Supabase é…ç½®ç®¡ç†

æ•´åˆ Supabase è³‡æ–™åº«èˆ‡ SQLAlchemy ORM
"""

import os
import re
from typing import Optional
from dotenv import load_dotenv
from supabase import create_client, Client

# è¼‰å…¥ç’°å¢ƒè®Šæ•¸
load_dotenv()

class SupabaseConfig:
    """Supabase é…ç½®ç®¡ç†é¡åˆ¥"""

    def __init__(self):
        self.supabase_url = os.getenv("SUPABASE_URL")
        self.supabase_key = os.getenv("SUPABASE_KEY")  # å¯ä»¥æ˜¯ anon key æˆ– service key
        self.db_mode = os.getenv("DB_MODE")

    def is_configured(self) -> bool:
        """æª¢æŸ¥ Supabase æ˜¯å¦å·²æ­£ç¢ºé…ç½®"""
        return (
            self.db_mode == "supabase" and
            bool(self.supabase_url) and
            bool(self.supabase_key)
        )

    def get_database_url(self) -> str:
        """
        æ ¹æ“šè¨­å®šæ¨¡å¼å›å‚³è³‡æ–™åº«é€£æ¥å­—ä¸²

        Returns:
            str: PostgreSQL é€£æ¥å­—ä¸²
        """
        if self.db_mode == "supabase":
            if not self.supabase_url or not self.supabase_key:
                raise ValueError("SUPABASE_URL å’Œ SUPABASE_KEY æ˜¯å¿…é ˆçš„")

            # å¾ Supabase URL æå– PostgreSQL é€£æ¥è³‡è¨Š
            # Supabase URL æ ¼å¼: https://your-project-ref.supabase.co
            # PostgreSQL é€£æ¥æ ¼å¼: postgresql+asyncpg://postgres:[password]@db.your-project-ref.supabase.co:5432/postgres

            # æå–å°ˆæ¡ˆ ID
            url_match = re.match(r'https://([^.]+)\.supabase\.co', self.supabase_url)
            if not url_match:
                raise ValueError(f"ç„¡æ•ˆçš„ Supabase URL æ ¼å¼: {self.supabase_url}")

            project_ref = url_match.group(1)

            # ä½¿ç”¨ service_role key ä½œç‚ºå¯†ç¢¼ï¼ˆå¦‚æœæä¾›çš„æ˜¯ service_role keyï¼‰
            # å¦‚æœæ˜¯ anon keyï¼Œæˆ‘å€‘éœ€è¦ä½¿ç”¨ä¸åŒçš„æ–¹æ³•
            if self.supabase_key.startswith('eyJ'):  # JWT token (anon key)
                # å°æ–¼ anon keyï¼Œæˆ‘å€‘ä¸èƒ½ç›´æ¥é€£æ¥ PostgreSQLï¼Œå¿…é ˆä½¿ç”¨ Supabase å®¢æˆ¶ç«¯
                # é€™è£¡æˆ‘å€‘å›å‚³ä¸€å€‹ç‰¹æ®Šçš„æ¨™è­˜ç¬¦ï¼Œè®“ database.py çŸ¥é“è¦ä½¿ç”¨ Supabase å®¢æˆ¶ç«¯
                return f"supabase+client://{project_ref}"
            else:
                # å‡è¨­æ˜¯ service_role keyï¼Œå¯ä»¥ç›´æ¥é€£æ¥ PostgreSQL
                return f"postgresql+asyncpg://postgres:{self.supabase_key}@db.{project_ref}.supabase.co:5432/postgres"
        else:
            # ä½¿ç”¨æœ¬åœ°è³‡æ–™åº«
            return os.getenv(
                "DATABASE_URL",
                "postgresql+asyncpg://postgres:password@localhost:5432/studyscriber"
            )

    def get_client(self) -> Optional[Client]:
        """
        å»ºç«‹ Supabase å®¢æˆ¶ç«¯é€£æ¥

        Returns:
            Optional[Client]: Supabase å®¢æˆ¶ç«¯å¯¦ä¾‹ï¼Œå¦‚æœæ˜¯æœ¬åœ°æ¨¡å¼å‰‡å›å‚³ None
        """
        if self.is_configured():
            return create_client(self.supabase_url, self.supabase_key)
        return None

    def is_supabase_mode(self) -> bool:
        """æª¢æŸ¥æ˜¯å¦ç‚º Supabase æ¨¡å¼"""
        return self.db_mode == "supabase"


# å…¨åŸŸé…ç½®å¯¦ä¾‹
supabase_config = SupabaseConfig()

# ä¾¿åˆ©å‡½å¼
def get_supabase_client() -> Client:
    """ç²å– Supabase å®¢æˆ¶ç«¯å¯¦ä¾‹"""
    client = supabase_config.get_client()
    if client is None:
        raise ValueError("Supabase å®¢æˆ¶ç«¯ç„¡æ³•åˆå§‹åŒ–ï¼Œè«‹æª¢æŸ¥ç’°å¢ƒé…ç½®")
    return client


# END FILE CONTENTS


# File: frontend/lib/__tests__/state-machine.test.ts

import { describe, test, expect, beforeEach, vi } from 'vitest'
import { StateMachine, StateMachineManager, createStateMachine } from '../state-machine'
import { StateTransitionContext } from '../../types/state-transitions'

describe('StateMachine', () => {
    let stateMachine: StateMachine
    let initialContext: StateTransitionContext

    beforeEach(() => {
        initialContext = {
            currentState: 'default',
            isRecording: false,
            transcriptCount: 0,
            session: null,
            error: null,
        }
        stateMachine = new StateMachine(initialContext)
    })

    test('should initialize with correct state', () => {
        expect(stateMachine.getCurrentState()).toBe('default')
        expect(stateMachine.getContext()).toEqual(initialContext)
    })

    test('should update context correctly', () => {
        const newContext = {
            isRecording: true,
            session: { id: 'test-id', status: 'active' as const, type: 'recording' as const }
        }

        stateMachine.updateContext(newContext)
        const updatedContext = stateMachine.getContext()

        expect(updatedContext.isRecording).toBe(true)
        expect(updatedContext.session).toEqual(newContext.session)
    })

    test('should validate USER_START_RECORDING transition from default', () => {
        const canTransition = stateMachine.canTransition('USER_START_RECORDING')
        expect(canTransition).toBe(true)
    })

    test('should not allow invalid transitions', () => {
        const canTransition = stateMachine.canTransition('USER_STOP_RECORDING')
        expect(canTransition).toBe(false)
    })

    test('should execute valid state transition', () => {
        const result = stateMachine.transition('USER_START_RECORDING')

        expect(result.success).toBe(true)
        expect(result.newState).toBe('recording_waiting')
        expect(result.sideEffects).toBeDefined()
        expect(stateMachine.getCurrentState()).toBe('recording_waiting')
    })

    test('should reject invalid state transition', () => {
        const result = stateMachine.transition('USER_STOP_RECORDING')

        expect(result.success).toBe(false)
        expect(result.error).toBeDefined()
        expect(stateMachine.getCurrentState()).toBe('default')
    })

    test('should handle FIRST_TRANSCRIPT_RECEIVED transition', () => {
        // å…ˆè½‰æ›åˆ° recording_waiting ç‹€æ…‹
        stateMachine.transition('USER_START_RECORDING')

        // æ›´æ–°ä¸Šä¸‹æ–‡ä»¥ç¬¦åˆè½‰æ›æ¢ä»¶
        stateMachine.updateContext({
            currentState: 'recording_waiting',
            isRecording: true,
            transcriptCount: 1,
            session: { id: 'test-id', status: 'active', type: 'recording' }
        })

        const result = stateMachine.transition('FIRST_TRANSCRIPT_RECEIVED')
        expect(result.success).toBe(true)
        expect(result.newState).toBe('recording_active')
    })

    test('should get available transitions correctly', () => {
        const transitions = stateMachine.getAvailableTransitions()
        expect(transitions).toContain('USER_START_RECORDING')
        expect(transitions).not.toContain('USER_STOP_RECORDING')
    })

    test('should reset state machine', () => {
        stateMachine.transition('USER_START_RECORDING')
        expect(stateMachine.getCurrentState()).toBe('recording_waiting')

        stateMachine.reset()
        expect(stateMachine.getCurrentState()).toBe('default')
        expect(stateMachine.getContext().isRecording).toBe(false)
    })

    test('should handle listeners correctly', () => {
        const mockListener = vi.fn()
        stateMachine.addListener(mockListener)

        stateMachine.transition('USER_START_RECORDING')

        expect(mockListener).toHaveBeenCalledWith(
            'recording_waiting',
            expect.any(Array)
        )

        stateMachine.removeListener(mockListener)
    })
})

describe('StateMachineManager', () => {
    let manager: StateMachineManager
    let initialContext: StateTransitionContext

    beforeEach(() => {
        initialContext = {
            currentState: 'default',
            isRecording: false,
            transcriptCount: 0,
            session: null,
            error: null,
        }
        manager = new StateMachineManager(initialContext)
    })

    test('should create manager with state machine', () => {
        const stateMachine = manager.getStateMachine()
        expect(stateMachine).toBeInstanceOf(StateMachine)
        expect(stateMachine.getCurrentState()).toBe('default')
    })

    test('should register side effect handlers', () => {
        const mockHandler = {
            handleSideEffect: vi.fn()
        }

        manager.registerSideEffectHandler('CREATE_SESSION', mockHandler)

        // è§¸ç™¼æœƒç”¢ç”Ÿ CREATE_SESSION å‰¯ä½œç”¨çš„è½‰æ›
        const stateMachine = manager.getStateMachine()
        stateMachine.transition('USER_START_RECORDING')

        // ç­‰å¾…å‰¯ä½œç”¨è™•ç†
        setTimeout(() => {
            expect(mockHandler.handleSideEffect).toHaveBeenCalled()
        }, 0)
    })

    test('should update context and trigger auto transition', () => {
        const result = manager.updateContextAndTransition(
            { isRecording: false },
            'USER_START_RECORDING'
        )

        expect(result).toBeDefined()
        expect(result?.success).toBe(true)
        expect(result?.newState).toBe('recording_waiting')
    })
})

describe('createStateMachine', () => {
    test('should create state machine manager', () => {
        const initialContext: StateTransitionContext = {
            currentState: 'default',
            isRecording: false,
            transcriptCount: 0,
            session: null,
            error: null,
        }

        const manager = createStateMachine(initialContext)
        expect(manager).toBeInstanceOf(StateMachineManager)

        const stateMachine = manager.getStateMachine()
        expect(stateMachine.getCurrentState()).toBe('default')
    })
})


# END FILE CONTENTS


# File: frontend/components/ui/toast.tsx

"use client"

import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}


# END FILE CONTENTS


# File: frontend/components/ui/toggle-group.tsx

"use client"

import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }


# END FILE CONTENTS


# File: frontend/components/ui/separator.tsx

"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }


# END FILE CONTENTS


# File: docs/traceback-debug-spec.md

# StudyScriber API 500 ä¾‹å¤– Traceback è¡Œç‚ºèªªæ˜

## åŠŸèƒ½èªªæ˜

ç•¶ API ç™¼ç”Ÿæœªæ•æ‰çš„ 500 ä¾‹å¤–ï¼ˆInternal Server Errorï¼‰æ™‚ï¼Œç³»çµ±æœƒæ ¹æ“šç’°å¢ƒè¨­å®šè‡ªå‹•æ±ºå®šæ˜¯å¦åœ¨å›æ‡‰ä¸­é¡¯ç¤ºè©³ç´° Python tracebackï¼š

- **é–‹ç™¼ç’°å¢ƒï¼ˆsettings.DEBUG = Trueï¼‰**ï¼š
  - API å›æ‡‰æœƒå¤šä¸€å€‹ `traceback` æ¬„ä½ï¼Œå…§å«å®Œæ•´ Python éŒ¯èª¤å †ç–Šè³‡è¨Šï¼Œæ–¹ä¾¿é™¤éŒ¯ã€‚
- **æ­£å¼ç’°å¢ƒï¼ˆsettings.DEBUG = Falseï¼‰**ï¼š
  - API å›æ‡‰ä¸æœƒé¡¯ç¤º tracebackï¼Œåƒ…å›å‚³ä¸€èˆ¬éŒ¯èª¤è¨Šæ¯ï¼Œé¿å…æ´©æ¼å…§éƒ¨ç´°ç¯€ã€‚

## è¨­å®šæ–¹æ³•

1. ç·¨è¼¯ `.env` æˆ– `.env.local` æª”æ¡ˆï¼ŒåŠ å…¥ï¼š

   ```
   DEBUG=true
   ```

2. æˆ–æ–¼å•Ÿå‹•æ™‚ä»¥ç’°å¢ƒè®Šæ•¸æŒ‡å®šï¼š

   ```sh
   export DEBUG=true
   uvicorn main:fastapi_app --reload --port 8000
   ```

3. é è¨­æ­£å¼ç’°å¢ƒï¼ˆæœªè¨­ DEBUG æˆ–è¨­ç‚º falseï¼‰ä¸æœƒé¡¯ç¤º tracebackã€‚

## æ³¨æ„äº‹é …

- åªæœ‰æœªæ•æ‰çš„ Exception æœƒé€²å…¥å…¨åŸŸä¾‹å¤–è™•ç†ä¸¦é¡¯ç¤º tracebackã€‚
- å¸¸è¦‹ HTTPExceptionã€é©—è­‰éŒ¯èª¤ç­‰ï¼Œä»ç”± FastAPI é è¨­è™•ç†ï¼Œä¸æœƒé¡¯ç¤º tracebackã€‚
- è«‹å‹¿åœ¨æ­£å¼ç’°å¢ƒé–‹å•Ÿ DEBUG=trueï¼Œä»¥å…æ´©æ¼æ•æ„Ÿè³‡è¨Šã€‚

---

å¦‚éœ€å¼·åˆ¶æ¸¬è©¦ tracebackï¼Œå¯æ–¼ä»»ä¸€ API ç«¯é»å…§ raise Exception è§€å¯Ÿæ•ˆæœã€‚ 


# END FILE CONTENTS


# File: frontend/hooks/use-app-state-adapter.ts

"use client"

import { useAppState as useAppStateLegacy } from './use-app-state'
import { useAppStateNew } from './use-app-state-new'
import { isFeatureEnabled } from '../lib/feature-flags'
import type { AppData } from '../types/app-state'

// çµ±ä¸€çš„ UseAppState ä»‹é¢
interface UseAppStateReturn {
    // æ‡‰ç”¨ç‹€æ…‹
    appData: AppData
    isLoading: boolean
    error: string | null

    // æœƒè©±ç®¡ç†
    createNoteSession: (title?: string) => Promise<void>
    createRecordingSession: (title?: string) => Promise<void>
    upgradeToRecording: () => Promise<void>
    finishSession: () => Promise<void>
    newNote: () => Promise<void>

    // éŒ„éŸ³æ§åˆ¶
    startRecording: (title?: string) => Promise<void>
    stopRecording: () => Promise<void>

    // æœ¬åœ°è‰ç¨¿
    saveLocalDraft: (content: string) => void

    // å¤–éƒ¨ç‹€æ…‹
    session: any
    sessionLoading: boolean
    sessionError: string | null

    // éŒ„éŸ³ç‹€æ…‹
    recordingError: string | null

    // é€å­—ç¨¿ç‹€æ…‹
    transcriptConnected: boolean
    transcriptError: string | null
    transcriptAutoScroll: boolean
    enableAutoScroll: () => void
    disableAutoScroll: () => void
    scrollToLatest: () => void
}

/**
 * useAppState é©é…å™¨ Hook
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨æ–°èˆŠç‰ˆæœ¬çš„ useAppState
 * ç¢ºä¿ API å®Œå…¨ç›¸å®¹ï¼Œç¾æœ‰çµ„ä»¶ç„¡éœ€ä¿®æ”¹
 */
export function useAppState(): UseAppStateReturn {
    const useNewAppStateHook = isFeatureEnabled('useNewAppStateHook')
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')

    console.log('ğŸ”„ [useAppStateAdapter] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewAppStateHook,
        useNewStateManagement,
        willUseNewVersion: useNewAppStateHook || useNewStateManagement
    })

    // å¦‚æœå•Ÿç”¨æ–° AppState Hook æˆ–æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬
    if (useNewAppStateHook || useNewStateManagement) {
        console.log('ğŸ”„ [useAppStateAdapter] ä½¿ç”¨æ–°ç‰ˆæœ¬ useAppStateNew')
        return useAppStateNew()
    }

    // å¦å‰‡ä½¿ç”¨èˆŠç‰ˆæœ¬
    console.log('ğŸ”„ [useAppStateAdapter] ä½¿ç”¨èˆŠç‰ˆæœ¬ useAppState')
    return useAppStateLegacy()
}

// å°å‡ºèˆŠç‰ˆæœ¬ä¾›ç›´æ¥ä½¿ç”¨ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ç‰¹æ®Šæƒ…æ³ï¼‰
export { useAppState as useAppStateLegacy } from './use-app-state'
export { useAppStateNew } from './use-app-state-new'


# END FILE CONTENTS


# File: app/api/notes.py

"""
StudyScriber Notes ç®¡ç† API ç«¯é»

å¯¦ä½œç­†è¨˜å„²å­˜ã€è‡ªå‹•å„²å­˜èˆ‡ UPSERT é‚è¼¯
"""

from datetime import datetime
from uuid import UUID
from fastapi import APIRouter, Depends, HTTPException, status
from supabase import Client
import json

from app.db.database import get_supabase_client
from app.schemas.note import (
    NoteSaveRequest, NoteOut, NoteSaveResponse, NoteConflictError
)

# å»ºç«‹è·¯ç”±å™¨
router = APIRouter(prefix="/api", tags=["ç­†è¨˜ç®¡ç†"])


@router.put("/notes/{session_id}", response_model=NoteSaveResponse)
async def save_note(
    session_id: UUID,
    request: NoteSaveRequest,
    supabase: Client = Depends(get_supabase_client)
) -> NoteSaveResponse:
    """
    å„²å­˜ç­†è¨˜å…§å®¹ (B-003)

    - å¯¦ä½œ UPSERT é‚è¼¯ï¼šæœ‰å‰‡æ›´æ–°ï¼Œç„¡å‰‡å»ºç«‹
    - æ™‚é–“æˆ³ç®¡ç†ï¼šæª¢æŸ¥å®¢æˆ¶ç«¯æ™‚é–“æˆ³é¿å…è¦†è“‹è¼ƒæ–°å…§å®¹
    - æ¬Šé™æª¢æŸ¥ï¼šç¢ºä¿æœƒè©±å­˜åœ¨ä¸”å¯ç·¨è¼¯
    - è‡ªå‹•æ›´æ–°æœƒè©±çš„ updated_at æ™‚é–“æˆ³
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨ä¸”å¯ç·¨è¼¯
        session = await _ensure_session_editable(supabase, session_id)

        # æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç­†è¨˜
        existing_note = await _get_existing_note(supabase, session_id)

        if existing_note:
            # æ›´æ–°ç¾æœ‰ç­†è¨˜
            updated_note = await _update_note(supabase, existing_note, request)
        else:
            # å»ºç«‹æ–°ç­†è¨˜
            updated_note = await _create_note(supabase, session_id, request)

        # æ›´æ–°æœƒè©±æ™‚é–“æˆ³
        await _update_session_timestamp(supabase, session_id)

        # æº–å‚™æ™‚é–“æˆ³
        server_ts = datetime.fromisoformat(updated_note['updated_at'].replace('Z', '+00:00')) if 'Z' in updated_note['updated_at'] else datetime.fromisoformat(updated_note['updated_at'])

        return NoteSaveResponse(
            success=True,
            message="ç­†è¨˜å·²æˆåŠŸå„²å­˜",
            server_ts=server_ts,
            note=NoteOut.model_validate(updated_note)
        )

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"å„²å­˜ç­†è¨˜æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.get("/notes/{session_id}", response_model=NoteOut)
async def get_note(
    session_id: UUID,
    supabase: Client = Depends(get_supabase_client)
) -> NoteOut:
    """
    å–å¾—ç­†è¨˜å…§å®¹

    - ç”¨æ–¼å‰ç«¯è¼‰å…¥ç¾æœ‰ç­†è¨˜
    - å¦‚æœç­†è¨˜ä¸å­˜åœ¨å‰‡è¿”å›ç©ºç™½ç­†è¨˜
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨
        await _ensure_session_exists(supabase, session_id)

        # æŸ¥è©¢ç­†è¨˜
        note = await _get_existing_note(supabase, session_id)

        if not note:
            # å¦‚æœç­†è¨˜ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºç™½ç­†è¨˜
            note = {
                'session_id': str(session_id),
                'content': "",
                'updated_at': datetime.utcnow().isoformat(),
                'client_ts': None
            }

        return NoteOut.model_validate(note)

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"å–å¾—ç­†è¨˜æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


# ç§æœ‰è¼”åŠ©å‡½å¼

async def _ensure_session_exists(supabase: Client, session_id: UUID) -> dict:
    """ç¢ºä¿æœƒè©±å­˜åœ¨"""
    response = supabase.table("sessions").select("*").eq("id", str(session_id)).limit(1).execute()

    if not response.data:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail={"error": "session_not_found", "message": "æŒ‡å®šçš„æœƒè©±ä¸å­˜åœ¨"}
        )

    return response.data[0]


async def _ensure_session_editable(supabase: Client, session_id: UUID) -> dict:
    """ç¢ºä¿æœƒè©±å­˜åœ¨ä¸”å¯ç·¨è¼¯"""
    session = await _ensure_session_exists(supabase, session_id)

    # æª¢æŸ¥æœƒè©±ç‹€æ…‹æ˜¯å¦å…è¨±ç·¨è¼¯
    if session.get('status') == 'error':
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail={
                "error": "session_not_editable",
                "message": f"æœƒè©±ç‹€æ…‹ç‚º {session.get('status')}ï¼Œç„¡æ³•ç·¨è¼¯ç­†è¨˜"
            }
        )

    return session


async def _get_existing_note(supabase: Client, session_id: UUID) -> dict | None:
    """å–å¾—ç¾æœ‰ç­†è¨˜"""
    response = supabase.table("notes").select("id, session_id, content, client_ts, created_at, updated_at").eq("session_id", str(session_id)).limit(1).execute()

    return response.data[0] if response.data else None


async def _update_note(supabase: Client, note: dict, request: NoteSaveRequest) -> dict:
    """æ›´æ–°ç¾æœ‰ç­†è¨˜"""
    # æª¢æŸ¥æ™‚é–“æˆ³è¡çªï¼ˆå¦‚æœæä¾›å®¢æˆ¶ç«¯æ™‚é–“æˆ³ï¼‰
    if request.client_ts:
        note_updated_at = datetime.fromisoformat(note['updated_at'].replace('Z', '+00:00'))
        if note_updated_at > request.client_ts:
            # æº–å‚™ä¼ºæœå™¨ç«¯ç­†è¨˜è³‡æ–™
            server_note_data = {
                'session_id': str(note['session_id']),
                'content': note['content'],
                'updated_at': note_updated_at,
                'client_ts': note.get('client_ts')
            }

            # å»ºç«‹éŒ¯èª¤ç‰©ä»¶
            conflict_error = NoteConflictError(
                message="å®¢æˆ¶ç«¯ç­†è¨˜ç‰ˆæœ¬è¼ƒèˆŠï¼Œè«‹é‡æ–°è¼‰å…¥æœ€æ–°ç‰ˆæœ¬",
                server_note=NoteOut.model_validate(server_note_data),
                client_ts=request.client_ts,
                server_ts=note_updated_at
            )

            # ä½¿ç”¨ model_dump_json ç¢ºä¿å®Œå…¨åºåˆ—åŒ–
            error_detail_str = conflict_error.model_dump_json()
            error_detail = json.loads(error_detail_str)

            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail=error_detail
            )

    # æ›´æ–°ç­†è¨˜å…§å®¹
    update_data = {
        'content': request.content,
        'client_ts': request.client_ts.isoformat() if request.client_ts else None,
        'updated_at': datetime.utcnow().isoformat()
    }

    response = supabase.table("notes").update(update_data).eq("session_id", str(note['session_id'])).execute()

    if not response.data:
        raise HTTPException(status_code=500, detail="ç„¡æ³•æ›´æ–°ç­†è¨˜")

    return response.data[0]


async def _create_note(supabase: Client, session_id: UUID, request: NoteSaveRequest) -> dict:
    """å»ºç«‹æ–°ç­†è¨˜"""
    current_time = datetime.utcnow().isoformat()
    note_data = {
        'session_id': str(session_id),
        'content': request.content,
        'client_ts': request.client_ts.isoformat() if request.client_ts else None,
        'updated_at': current_time
    }

    response = supabase.table("notes").insert(note_data).execute()

    if not response.data:
        raise HTTPException(status_code=500, detail="ç„¡æ³•å»ºç«‹ç­†è¨˜")

    return response.data[0]


async def _update_session_timestamp(supabase: Client, session_id: UUID) -> None:
    """æ›´æ–°æœƒè©±æ™‚é–“æˆ³"""
    update_data = {
        'updated_at': datetime.utcnow().isoformat()
    }

    supabase.table("sessions").update(update_data).eq("id", str(session_id)).execute()


# END FILE CONTENTS


# File: app/db/database.py

"""
StudyScriber Supabase è³‡æ–™åº«é€£æ¥é…ç½®

å°ˆç‚º Supabase PostgreSQL è¨­è¨ˆçš„è³‡æ–™åº«é€£æ¥æ¨¡çµ„
ä½¿ç”¨ Supabase å®¢æˆ¶ç«¯ API é€²è¡Œè³‡æ–™åº«æ“ä½œ
"""
import logging
from .supabase_config import get_supabase_client

# è¨­ç½®æ—¥èªŒ
logger = logging.getLogger(__name__)

def get_supabase_db():
    """
    å–å¾— Supabase å®¢æˆ¶ç«¯çš„ä¾è³´æ³¨å…¥å‡½å¼ã€‚

    å–ä»£èˆŠçš„ get_async_session å’Œ get_database_session_safeã€‚
    ç”¨æ–¼ FastAPI çš„ Depends()ã€‚
    """
    return get_supabase_client()

async def check_database_connection():
    """
    æª¢æŸ¥ Supabase è³‡æ–™åº«é€£æ¥ç‹€æ…‹
    """
    try:
        client = get_supabase_client()
        # å˜—è©¦åŸ·è¡Œä¸€å€‹ç°¡å–®çš„æŸ¥è©¢
        client.table('sessions').select("id").limit(1).execute()
        logger.info("âœ… Supabase è³‡æ–™åº«é€£æ¥æ­£å¸¸")
        return True
    except Exception as e:
        logger.error(f"âŒ Supabase è³‡æ–™åº«é€£æ¥å¤±æ•—: {e}")
        logger.error("ğŸ’¡ è«‹æª¢æŸ¥ SUPABASE_URL å’Œ SUPABASE_KEY ç’°å¢ƒè®Šæ•¸")
        return False

async def check_tables_exist() -> bool:
    """
    æª¢æŸ¥æ‰€æœ‰å¿…è¦çš„ Supabase è³‡æ–™åº«è¡¨æ ¼æ˜¯å¦å­˜åœ¨

    Returns:
        bool: å¦‚æœæ‰€æœ‰è¡¨æ ¼éƒ½å­˜åœ¨å‰‡å›å‚³ Trueï¼Œå¦å‰‡å›å‚³ False
    """
    required_tables = [
        'sessions',
        'audio_files',
        'transcript_segments',
        'transcripts',
        'notes'
    ]
    client = get_supabase_client()

    try:
        for table_name in required_tables:
            try:
                # å˜—è©¦æŸ¥è©¢è¡¨æ ¼ä¾†æª¢æŸ¥æ˜¯å¦å­˜åœ¨
                client.table(table_name).select("id", head=True).limit(1).execute()
                logger.info(f"âœ… è¡¨æ ¼ '{table_name}' å­˜åœ¨ä¸”å¯è¨ªå•")
            except Exception:
                logger.error(f"âŒ è¡¨æ ¼ '{table_name}' ä¸å­˜åœ¨æˆ–ç„¡æ³•è¨ªå•ã€‚")
                return False
        logger.info("âœ… æ‰€æœ‰æ ¸å¿ƒè¡¨æ ¼éƒ½å­˜åœ¨")
        return True
    except Exception as e:
        logger.error(f"âŒ æª¢æŸ¥è¡¨æ ¼æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
        return False

async def auto_init_database():
    """
    è‡ªå‹•æª¢æ¸¬ä¸¦åˆå§‹åŒ– Supabase è³‡æ–™åº«

    æª¢æŸ¥è¡¨æ ¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å‰‡æç¤ºä½¿ç”¨è€…æ‰‹å‹•åŸ·è¡Œ SQL è…³æœ¬
    """
    logger.info("ğŸ” æª¢æŸ¥ Supabase è³‡æ–™åº«è¡¨æ ¼ç‹€æ…‹...")

    if await check_tables_exist():
        logger.info("âœ… Supabase è³‡æ–™åº«è¡¨æ ¼å·²å­˜åœ¨ï¼Œè·³éåˆå§‹åŒ–")
        return

    logger.warning("ğŸš§ åµæ¸¬åˆ°ç¼ºå¤±çš„è¡¨æ ¼")
    logger.warning("ğŸ“‹ è«‹åœ¨ Supabase Dashboard çš„ SQL Editor ä¸­åŸ·è¡Œä»¥ä¸‹è…³æœ¬ï¼š")
    logger.warning("   app/db/supabase_init.sql")
    logger.warning("ğŸ’¡ æˆ–åƒè€ƒ README.md ä¸­çš„è©³ç´°è¨­å®šæŒ‡å—")

    raise RuntimeError(
        "è³‡æ–™åº«è¡¨æ ¼å°šæœªå»ºç«‹ã€‚è«‹åœ¨ Supabase Dashboard ä¸­åŸ·è¡Œ app/db/supabase_init.sql è…³æœ¬ã€‚"
    )

# ç‚ºäº†å…¼å®¹èˆŠçš„å‘½åï¼Œä¿ç•™ä¸€å€‹åˆ¥å
get_supabase_client_safe = get_supabase_db

# æ–°å¢ï¼šå›å‚³ç›®å‰è³‡æ–™åº«æ¨¡å¼ï¼ˆSupabase å›ºå®šï¼‰

def get_database_mode() -> str:
    """å–å¾—ç›®å‰è³‡æ–™åº«é€£ç·šæ¨¡å¼ã€‚"""
    return "supabase"


async def get_database_stats() -> dict:
    """å–å¾— Supabase è³‡æ–™åº«çµ±è¨ˆè³‡è¨Šï¼ˆç°¡æ˜“å ä½å¯¦ä½œï¼‰ã€‚"""
    # åœ¨å®Œæ•´å¯¦ä½œä¸­å¯ä»¥å‘¼å« Supabase RPC æˆ–è³‡è¨Šè¦–åœ–
    return {
        "tables": "unknown",
        "status": "placeholder",
    }


# END FILE CONTENTS


# File: app/services/azure_whisper.py

import logging
import tempfile
from datetime import datetime
from pathlib import Path
from uuid import UUID
from typing import Any, Dict, Optional

from openai import AsyncAzureOpenAI
from httpx import Timeout
from app.core.config import settings

__all__ = ["AzureWhisperService", "PerformanceTimer"]

logger = logging.getLogger(__name__)

class PerformanceTimer:
    """æ•ˆèƒ½è¨ˆæ™‚å™¨"""
    def __init__(self, operation_name: str):
        self.operation_name = operation_name
        self.start_time = None
        self.end_time = None

    def __enter__(self):
        import time
        self.start_time = time.time()
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        import time
        self.end_time = time.time()
        duration = self.get_duration()
        if duration > 1.0:
            logger.warning(f"âš ï¸  {self.operation_name} took {duration:.2f}s (slow)")
        else:
            logger.info(f"â±ï¸  {self.operation_name} completed in {duration:.2f}s")

    def get_duration(self) -> float:
        if self.start_time and self.end_time:
            return self.end_time - self.start_time
        return 0.0

class AzureWhisperService:
    def __init__(self):
        self.client = AsyncAzureOpenAI(
            api_key=settings.AZURE_OPENAI_API_KEY,
            azure_endpoint=settings.AZURE_OPENAI_ENDPOINT,
            api_version="2024-06-01",
            timeout=Timeout(connect=5, read=55, write=30, pool=5),
            max_retries=2,
        )
        self.deployment = settings.WHISPER_DEPLOYMENT_NAME
        self.language = settings.WHISPER_LANGUAGE

    async def transcribe(self, audio: bytes, session_id: UUID, chunk_seq: int, *, api_language: str, canonical_lang: str) -> Optional[Dict[str, Any]]:
        with PerformanceTimer(f"Whisper chunk {chunk_seq}"):
            with tempfile.NamedTemporaryFile(suffix='.webm', delete=False) as temp_file:
                temp_file.write(audio)
                temp_file.flush()
                logger.info(f"ğŸ” call whisper: session_id={session_id}, chunk={chunk_seq}, api_lang={api_language}, canonical_lang={canonical_lang}, temp_file={temp_file.name}")
                try:
                    with open(temp_file.name, 'rb') as audio_file:
                        transcript = await self.client.audio.transcriptions.create(
                            model=self.deployment,
                            file=audio_file,
                            language=api_language,
                            response_format="json",
                            temperature=0
                        )
                    # Debug Azure å›å‚³å…§å®¹
                    try:
                        import json
                        logger.debug("Whisper raw json â‡’ %s", resp) # type: ignore
                        logger.debug("Whisper raw response: %s", json.dumps(transcript if isinstance(transcript, dict) else transcript.__dict__, ensure_ascii=False, indent=2))
                    except Exception as e:
                        logger.debug("Whisper raw response (fallback): %s", str(transcript))
                        logger.debug("Failed to json.dumps transcript: %s", e)
                    Path(temp_file.name).unlink(missing_ok=True)
                    text = getattr(transcript, "text", None) or (transcript.get("text") if isinstance(transcript, dict) else None)
                    if not text or not text.strip():
                        return None
                    return {
                        "text": text.strip(),
                        "chunk_sequence": chunk_seq,
                        "session_id": str(session_id),
                        "lang_code": canonical_lang,
                        "timestamp": datetime.utcnow().isoformat(),
                    }
                finally:

                    Path(temp_file.name).unlink(missing_ok=True)


# END FILE CONTENTS


# File: .gptree_config

# GPTree Local Config
version: 2

# Whether to use .gitignore
useGitIgnore: true
# File types to include (e.g., .py,.js)
includeFileTypes: *
# File types to exclude when includeFileTypes is '*'
excludeFileTypes: 
# Output file name
outputFile: gptree_output.txt
# Whether to output the file locally or relative to the project directory
outputFileLocally: true
# Whether to copy the output to the clipboard
copyToClipboard: false
# Whether to use safe mode (prevent overly large files from being combined)
safeMode: true
# Whether to store the files chosen in the config file (--save, -s)
storeFilesChosen: true
# Whether to include line numbers in the output (--line-numbers, -n)
lineNumbers: false
# Whether to show ignored files in the directory tree
showIgnoredInTree: false
# Whether to show only default ignored files in the directory tree while still respecting gitignore
showDefaultIgnoredInTree: false
# Previously selected files (when using the -s or --save flag previously)
previousFiles: 


# END FILE CONTENTS


# File: app/services/stt/factory.py

# app/services/stt/factory.py
from __future__ import annotations

import logging
from typing import Dict, Type
from uuid import UUID

from app.db.database import get_supabase_client
from app.services.stt.interfaces import ISTTProvider
from app.services.stt.whisper_provider import WhisperProvider
from app.services.stt.gpt4o_provider import GPT4oProvider
from app.services.stt.gemini_provider import GeminiProvider
from app.core.config import get_settings

logger = logging.getLogger(__name__)

settings = get_settings()
# ------------------------------------------------------------------
# 1. provider singleton cache
# ------------------------------------------------------------------
_provider_cache: Dict[str, ISTTProvider] = {}


def _instance(cls: Type[ISTTProvider]) -> ISTTProvider:
    """
    lazy singleton per provider class
    Provider é¡åˆ¥å¿…é ˆæœ‰ `name` class å±¬æ€§ (str)
    """
    if cls.name not in _provider_cache:
        _provider_cache[cls.name] = cls()
    return _provider_cache[cls.name]


# ------------------------------------------------------------------
# 2. public API
# ------------------------------------------------------------------
def get_provider(session_id: UUID) -> ISTTProvider:
    """
    æ ¹æ“š sessions.stt_provider æ¬„ä½ï¼Œå›å‚³å°æ‡‰ ISTTProvider ç‰©ä»¶ã€‚
    é è¨­ whisperã€‚
    """
    supa = get_supabase_client()
    row = (
        supa.table("sessions")
        .select("stt_provider")
        .eq("id", str(session_id))
        .single()
        .execute()
    )

    provider_code: str = (
    row.data or {}
).get("stt_provider", settings.STT_PROVIDER_DEFAULT).lower()

    match provider_code:
        case "gpt4o" | "gpt-4o":
            return _instance(GPT4oProvider)
        case "gemini" | "google_gemini":
            return _instance(GeminiProvider)
        case "whisper" | _:
            # åŒ…å« None / ç©ºå­—ä¸² â†’ whisper
            return _instance(WhisperProvider)


# END FILE CONTENTS


# File: frontend/components/ui/carousel.tsx

"use client"

import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}


# END FILE CONTENTS


# File: frontend/hooks/use-recording-adapter.ts

"use client"

import { useRecording as useRecordingLegacy } from './use-recording'
import { useRecordingNew } from './use-recording-new'
import { isFeatureEnabled } from '../lib/feature-flags'
import { TranscriptMessage } from '../lib/transcript-manager'

// çµ±ä¸€çš„ UseRecording ä»‹é¢
interface UseRecordingReturn {
    isRecording: boolean
    recordingTime: number
    transcripts: TranscriptMessage[]
    transcriptCompleted: boolean
    error: string | null
    startRecording: (sessionId: string) => Promise<void>
    stopRecording: () => void
    clearTranscripts: () => void
}

/**
 * useRecording é©é…å™¨ Hook
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨æ–°èˆŠç‰ˆæœ¬çš„ useRecording
 * ç¢ºä¿ API å®Œå…¨ç›¸å®¹ï¼Œç¾æœ‰çµ„ä»¶ç„¡éœ€ä¿®æ”¹
 */
export function useRecording(): UseRecordingReturn {
    const useNewRecordingHook = isFeatureEnabled('useNewRecordingHook')
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')

    console.log('ğŸ”„ [useRecordingAdapter] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewRecordingHook,
        useNewStateManagement,
        willUseNewVersion: useNewRecordingHook || useNewStateManagement
    })

    // å¦‚æœå•Ÿç”¨æ–° Recording Hook æˆ–æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬
    if (useNewRecordingHook || useNewStateManagement) {
        console.log('ğŸ”„ [useRecordingAdapter] ä½¿ç”¨æ–°ç‰ˆæœ¬ useRecordingNew')
        return useRecordingNew()
    }

    // å¦å‰‡ä½¿ç”¨èˆŠç‰ˆæœ¬
    console.log('ğŸ”„ [useRecordingAdapter] ä½¿ç”¨èˆŠç‰ˆæœ¬ useRecording')
    return useRecordingLegacy()
}

// å°å‡ºèˆŠç‰ˆæœ¬ä¾›ç›´æ¥ä½¿ç”¨ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ç‰¹æ®Šæƒ…æ³ï¼‰
export { useRecording as useRecordingLegacy } from './use-recording'
export { useRecordingNew } from './use-recording-new'


# END FILE CONTENTS


# File: frontend/components/ui/sheet.tsx

"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/simple-recording-service.test.ts

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { SimpleRecordingService } from '../simple-recording-service'

// Mock AdvancedAudioRecorder
vi.mock('../../advanced-audio-recorder', () => ({
    AdvancedAudioRecorder: vi.fn().mockImplementation(() => ({
        start: vi.fn(),
        stop: vi.fn(),
        cleanup: vi.fn(),
        onSegment: vi.fn(),
        onError: vi.fn(),
    }))
}))

// Mock RestAudioUploader
vi.mock('../rest-audio-uploader', () => ({
    RestAudioUploader: vi.fn().mockImplementation(() => ({
        uploadSegment: vi.fn(),
        retryFailedSegments: vi.fn(),
        getCachedSegmentsCount: vi.fn(),
        cleanup: vi.fn(),
        onUploadSuccess: vi.fn(),
        onUploadError: vi.fn(),
        onCacheStored: vi.fn(),
    }))
}))

describe('SimpleRecordingService', () => {
    let service: SimpleRecordingService
    let mockStream: MediaStream
    let origGetUserMedia: any

    beforeEach(() => {
        service = new SimpleRecordingService()
        mockStream = { getTracks: vi.fn() } as any
        origGetUserMedia = navigator.mediaDevices.getUserMedia
        navigator.mediaDevices.getUserMedia = vi.fn().mockResolvedValue(mockStream)
    })

    afterEach(() => {
        vi.restoreAllMocks()
        navigator.mediaDevices.getUserMedia = origGetUserMedia
    })

    it('æ‡‰è©²æ­£ç¢ºåˆå§‹åŒ– audioRecorder èˆ‡ audioUploader ä¸¦é–‹å§‹éŒ„éŸ³', async () => {
        await service.startRecording('test-session')
        // audioRecorder, audioUploader æ‡‰è¢«å»ºç«‹
        expect(service['audioRecorder']).toBeDefined()
        expect(service['audioUploader']).toBeDefined()
        expect(service['recordingState'].isRecording).toBe(true)
    })

    it('æ‡‰è©²è™•ç†éº¥å…‹é¢¨æ¬Šé™ä¸è¶³', async () => {
        navigator.mediaDevices.getUserMedia = vi.fn().mockRejectedValue(new Error('Permission denied'))
        await expect(service.startRecording('fail-session')).rejects.toThrow('Permission denied')
        expect(service['audioRecorder']).toBeNull()
        expect(service['audioUploader']).toBeNull()
        expect(service['recordingState'].isRecording).toBe(false)
        expect(service['recordingState'].error).toMatch(/Permission denied/)
    })

    it('æ‡‰è©²è™•ç†åˆå§‹åŒ–å¤±æ•—', async () => {
        // æ¨¡æ“¬ stream å­˜åœ¨ä½† initMediaRecorder å¤±æ•—
        service['stream'] = mockStream
        service['sessionId'] = 'fail-session'
        // å¼·åˆ¶è®“ initMediaRecorder æ‹‹å‡ºéŒ¯èª¤
        service['initMediaRecorder'] = vi.fn().mockImplementation(() => { throw new Error('Init failed') })
        await expect(service.startRecording('fail-session')).rejects.toThrow('Init failed')
        expect(service['audioRecorder']).toBeNull()
        expect(service['audioUploader']).toBeNull()
        expect(service['recordingState'].isRecording).toBe(false)
        expect(service['recordingState'].error).toMatch(/Init failed/)
    })

    it('æ‡‰è©²è™•ç†é‡è¤‡å•Ÿå‹•éŒ„éŸ³', async () => {
        await service.startRecording('session-1')
        // å†æ¬¡å•Ÿå‹•éŒ„éŸ³
        service['stopRecording'] = vi.fn().mockResolvedValue(undefined)
        await service.startRecording('session-2')
        expect(service['stopRecording']).toHaveBeenCalled()
        expect(service['audioRecorder']).toBeDefined()
        expect(service['audioUploader']).toBeDefined()
        expect(service['recordingState'].isRecording).toBe(true)
        expect(service['recordingState'].currentSessionId).toBe('session-2')
    })
})


# END FILE CONTENTS


# File: frontend/components/recording-state.tsx

"use client"

import { RecordingWaitingState } from "./recording-waiting-state"
import { RecordingActiveState } from "./recording-active-state"
import type { TranscriptEntry } from "../types/app-state"

interface RecordingStateProps {
  transcriptEntries: TranscriptEntry[]
  recordingTime: number
  onStopRecording: () => void
  error?: string | null
}

export function RecordingState({ transcriptEntries, recordingTime, onStopRecording, error }: RecordingStateProps) {
  if (transcriptEntries.length === 0) {
    return (
      <RecordingWaitingState
        recordingTime={recordingTime}
        onStopRecording={onStopRecording}
        transcriptEntries={transcriptEntries}
        error={error}
      />
    )
  }
  return (
    <RecordingActiveState
      transcriptEntries={transcriptEntries}
      recordingTime={recordingTime}
      onStopRecording={onStopRecording}
    />
  )
}


# END FILE CONTENTS


# File: uv.lock

version = 1
revision = 2
requires-python = ">=3.12"
resolution-markers = [
    "python_full_version >= '3.13'",
    "python_full_version < '3.13'",
]

[[package]]
name = "aiofiles"
version = "24.1.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/0b/03/a88171e277e8caa88a4c77808c20ebb04ba74cc4681bf1e9416c862de237/aiofiles-24.1.0.tar.gz", hash = "sha256:22a075c9e5a3810f0c2e48f3008c94d68c65d763b9b03857924c99e57355166c", size = 30247, upload-time = "2024-06-24T11:02:03.584Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a5/45/30bb92d442636f570cb5651bc661f52b610e2eec3f891a5dc3a4c3667db0/aiofiles-24.1.0-py3-none-any.whl", hash = "sha256:b4ec55f4195e3eb5d7abd1bf7e061763e864dd4954231fb8539a0ef8bb8260e5", size = 15896, upload-time = "2024-06-24T11:02:01.529Z" },
]

[[package]]
name = "aiohappyeyeballs"
version = "2.6.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/26/30/f84a107a9c4331c14b2b586036f40965c128aa4fee4dda5d3d51cb14ad54/aiohappyeyeballs-2.6.1.tar.gz", hash = "sha256:c3f9d0113123803ccadfdf3f0faa505bc78e6a72d1cc4806cbd719826e943558", size = 22760, upload-time = "2025-03-12T01:42:48.764Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/0f/15/5bf3b99495fb160b63f95972b81750f18f7f4e02ad051373b669d17d44f2/aiohappyeyeballs-2.6.1-py3-none-any.whl", hash = "sha256:f349ba8f4b75cb25c99c5c2d84e997e485204d2902a9597802b0371f09331fb8", size = 15265, upload-time = "2025-03-12T01:42:47.083Z" },
]

[[package]]
name = "aiohttp"
version = "3.12.13"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "aiohappyeyeballs" },
    { name = "aiosignal" },
    { name = "attrs" },
    { name = "frozenlist" },
    { name = "multidict" },
    { name = "propcache" },
    { name = "yarl" },
]
sdist = { url = "https://files.pythonhosted.org/packages/42/6e/ab88e7cb2a4058bed2f7870276454f85a7c56cd6da79349eb314fc7bbcaa/aiohttp-3.12.13.tar.gz", hash = "sha256:47e2da578528264a12e4e3dd8dd72a7289e5f812758fe086473fab037a10fcce", size = 7819160, upload-time = "2025-06-14T15:15:41.354Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b4/6a/ce40e329788013cd190b1d62bbabb2b6a9673ecb6d836298635b939562ef/aiohttp-3.12.13-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:0aa580cf80558557285b49452151b9c69f2fa3ad94c5c9e76e684719a8791b73", size = 700491, upload-time = "2025-06-14T15:14:00.048Z" },
    { url = "https://files.pythonhosted.org/packages/28/d9/7150d5cf9163e05081f1c5c64a0cdf3c32d2f56e2ac95db2a28fe90eca69/aiohttp-3.12.13-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:b103a7e414b57e6939cc4dece8e282cfb22043efd0c7298044f6594cf83ab347", size = 475104, upload-time = "2025-06-14T15:14:01.691Z" },
    { url = "https://files.pythonhosted.org/packages/f8/91/d42ba4aed039ce6e449b3e2db694328756c152a79804e64e3da5bc19dffc/aiohttp-3.12.13-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:78f64e748e9e741d2eccff9597d09fb3cd962210e5b5716047cbb646dc8fe06f", size = 467948, upload-time = "2025-06-14T15:14:03.561Z" },
    { url = "https://files.pythonhosted.org/packages/99/3b/06f0a632775946981d7c4e5a865cddb6e8dfdbaed2f56f9ade7bb4a1039b/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:29c955989bf4c696d2ededc6b0ccb85a73623ae6e112439398935362bacfaaf6", size = 1714742, upload-time = "2025-06-14T15:14:05.558Z" },
    { url = "https://files.pythonhosted.org/packages/92/a6/2552eebad9ec5e3581a89256276009e6a974dc0793632796af144df8b740/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:d640191016763fab76072c87d8854a19e8e65d7a6fcfcbf017926bdbbb30a7e5", size = 1697393, upload-time = "2025-06-14T15:14:07.194Z" },
    { url = "https://files.pythonhosted.org/packages/d8/9f/bd08fdde114b3fec7a021381b537b21920cdd2aa29ad48c5dffd8ee314f1/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:4dc507481266b410dede95dd9f26c8d6f5a14315372cc48a6e43eac652237d9b", size = 1752486, upload-time = "2025-06-14T15:14:08.808Z" },
    { url = "https://files.pythonhosted.org/packages/f7/e1/affdea8723aec5bd0959171b5490dccd9a91fcc505c8c26c9f1dca73474d/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8a94daa873465d518db073bd95d75f14302e0208a08e8c942b2f3f1c07288a75", size = 1798643, upload-time = "2025-06-14T15:14:10.767Z" },
    { url = "https://files.pythonhosted.org/packages/f3/9d/666d856cc3af3a62ae86393baa3074cc1d591a47d89dc3bf16f6eb2c8d32/aiohttp-3.12.13-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:177f52420cde4ce0bb9425a375d95577fe082cb5721ecb61da3049b55189e4e6", size = 1718082, upload-time = "2025-06-14T15:14:12.38Z" },
    { url = "https://files.pythonhosted.org/packages/f3/ce/3c185293843d17be063dada45efd2712bb6bf6370b37104b4eda908ffdbd/aiohttp-3.12.13-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:0f7df1f620ec40f1a7fbcb99ea17d7326ea6996715e78f71a1c9a021e31b96b8", size = 1633884, upload-time = "2025-06-14T15:14:14.415Z" },
    { url = "https://files.pythonhosted.org/packages/3a/5b/f3413f4b238113be35dfd6794e65029250d4b93caa0974ca572217745bdb/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:3062d4ad53b36e17796dce1c0d6da0ad27a015c321e663657ba1cc7659cfc710", size = 1694943, upload-time = "2025-06-14T15:14:16.48Z" },
    { url = "https://files.pythonhosted.org/packages/82/c8/0e56e8bf12081faca85d14a6929ad5c1263c146149cd66caa7bc12255b6d/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:8605e22d2a86b8e51ffb5253d9045ea73683d92d47c0b1438e11a359bdb94462", size = 1716398, upload-time = "2025-06-14T15:14:18.589Z" },
    { url = "https://files.pythonhosted.org/packages/ea/f3/33192b4761f7f9b2f7f4281365d925d663629cfaea093a64b658b94fc8e1/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:54fbbe6beafc2820de71ece2198458a711e224e116efefa01b7969f3e2b3ddae", size = 1657051, upload-time = "2025-06-14T15:14:20.223Z" },
    { url = "https://files.pythonhosted.org/packages/5e/0b/26ddd91ca8f84c48452431cb4c5dd9523b13bc0c9766bda468e072ac9e29/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:050bd277dfc3768b606fd4eae79dd58ceda67d8b0b3c565656a89ae34525d15e", size = 1736611, upload-time = "2025-06-14T15:14:21.988Z" },
    { url = "https://files.pythonhosted.org/packages/c3/8d/e04569aae853302648e2c138a680a6a2f02e374c5b6711732b29f1e129cc/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:2637a60910b58f50f22379b6797466c3aa6ae28a6ab6404e09175ce4955b4e6a", size = 1764586, upload-time = "2025-06-14T15:14:23.979Z" },
    { url = "https://files.pythonhosted.org/packages/ac/98/c193c1d1198571d988454e4ed75adc21c55af247a9fda08236602921c8c8/aiohttp-3.12.13-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:e986067357550d1aaa21cfe9897fa19e680110551518a5a7cf44e6c5638cb8b5", size = 1724197, upload-time = "2025-06-14T15:14:25.692Z" },
    { url = "https://files.pythonhosted.org/packages/e7/9e/07bb8aa11eec762c6b1ff61575eeeb2657df11ab3d3abfa528d95f3e9337/aiohttp-3.12.13-cp312-cp312-win32.whl", hash = "sha256:ac941a80aeea2aaae2875c9500861a3ba356f9ff17b9cb2dbfb5cbf91baaf5bf", size = 421771, upload-time = "2025-06-14T15:14:27.364Z" },
    { url = "https://files.pythonhosted.org/packages/52/66/3ce877e56ec0813069cdc9607cd979575859c597b6fb9b4182c6d5f31886/aiohttp-3.12.13-cp312-cp312-win_amd64.whl", hash = "sha256:671f41e6146a749b6c81cb7fd07f5a8356d46febdaaaf07b0e774ff04830461e", size = 447869, upload-time = "2025-06-14T15:14:29.05Z" },
    { url = "https://files.pythonhosted.org/packages/11/0f/db19abdf2d86aa1deec3c1e0e5ea46a587b97c07a16516b6438428b3a3f8/aiohttp-3.12.13-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:d4a18e61f271127465bdb0e8ff36e8f02ac4a32a80d8927aa52371e93cd87938", size = 694910, upload-time = "2025-06-14T15:14:30.604Z" },
    { url = "https://files.pythonhosted.org/packages/d5/81/0ab551e1b5d7f1339e2d6eb482456ccbe9025605b28eed2b1c0203aaaade/aiohttp-3.12.13-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:532542cb48691179455fab429cdb0d558b5e5290b033b87478f2aa6af5d20ace", size = 472566, upload-time = "2025-06-14T15:14:32.275Z" },
    { url = "https://files.pythonhosted.org/packages/34/3f/6b7d336663337672d29b1f82d1f252ec1a040fe2d548f709d3f90fa2218a/aiohttp-3.12.13-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:d7eea18b52f23c050ae9db5d01f3d264ab08f09e7356d6f68e3f3ac2de9dfabb", size = 464856, upload-time = "2025-06-14T15:14:34.132Z" },
    { url = "https://files.pythonhosted.org/packages/26/7f/32ca0f170496aa2ab9b812630fac0c2372c531b797e1deb3deb4cea904bd/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:ad7c8e5c25f2a26842a7c239de3f7b6bfb92304593ef997c04ac49fb703ff4d7", size = 1703683, upload-time = "2025-06-14T15:14:36.034Z" },
    { url = "https://files.pythonhosted.org/packages/ec/53/d5513624b33a811c0abea8461e30a732294112318276ce3dbf047dbd9d8b/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:6af355b483e3fe9d7336d84539fef460120c2f6e50e06c658fe2907c69262d6b", size = 1684946, upload-time = "2025-06-14T15:14:38Z" },
    { url = "https://files.pythonhosted.org/packages/37/72/4c237dd127827b0247dc138d3ebd49c2ded6114c6991bbe969058575f25f/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:a95cf9f097498f35c88e3609f55bb47b28a5ef67f6888f4390b3d73e2bac6177", size = 1737017, upload-time = "2025-06-14T15:14:39.951Z" },
    { url = "https://files.pythonhosted.org/packages/0d/67/8a7eb3afa01e9d0acc26e1ef847c1a9111f8b42b82955fcd9faeb84edeb4/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:b8ed8c38a1c584fe99a475a8f60eefc0b682ea413a84c6ce769bb19a7ff1c5ef", size = 1786390, upload-time = "2025-06-14T15:14:42.151Z" },
    { url = "https://files.pythonhosted.org/packages/48/19/0377df97dd0176ad23cd8cad4fd4232cfeadcec6c1b7f036315305c98e3f/aiohttp-3.12.13-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:7a0b9170d5d800126b5bc89d3053a2363406d6e327afb6afaeda2d19ee8bb103", size = 1708719, upload-time = "2025-06-14T15:14:44.039Z" },
    { url = "https://files.pythonhosted.org/packages/61/97/ade1982a5c642b45f3622255173e40c3eed289c169f89d00eeac29a89906/aiohttp-3.12.13-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:372feeace612ef8eb41f05ae014a92121a512bd5067db8f25101dd88a8db11da", size = 1622424, upload-time = "2025-06-14T15:14:45.945Z" },
    { url = "https://files.pythonhosted.org/packages/99/ab/00ad3eea004e1d07ccc406e44cfe2b8da5acb72f8c66aeeb11a096798868/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:a946d3702f7965d81f7af7ea8fb03bb33fe53d311df48a46eeca17e9e0beed2d", size = 1675447, upload-time = "2025-06-14T15:14:47.911Z" },
    { url = "https://files.pythonhosted.org/packages/3f/fe/74e5ce8b2ccaba445fe0087abc201bfd7259431d92ae608f684fcac5d143/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:a0c4725fae86555bbb1d4082129e21de7264f4ab14baf735278c974785cd2041", size = 1707110, upload-time = "2025-06-14T15:14:50.334Z" },
    { url = "https://files.pythonhosted.org/packages/ef/c4/39af17807f694f7a267bd8ab1fbacf16ad66740862192a6c8abac2bff813/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:9b28ea2f708234f0a5c44eb6c7d9eb63a148ce3252ba0140d050b091b6e842d1", size = 1649706, upload-time = "2025-06-14T15:14:52.378Z" },
    { url = "https://files.pythonhosted.org/packages/38/e8/f5a0a5f44f19f171d8477059aa5f28a158d7d57fe1a46c553e231f698435/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:d4f5becd2a5791829f79608c6f3dc745388162376f310eb9c142c985f9441cc1", size = 1725839, upload-time = "2025-06-14T15:14:54.617Z" },
    { url = "https://files.pythonhosted.org/packages/fd/ac/81acc594c7f529ef4419d3866913f628cd4fa9cab17f7bf410a5c3c04c53/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:60f2ce6b944e97649051d5f5cc0f439360690b73909230e107fd45a359d3e911", size = 1759311, upload-time = "2025-06-14T15:14:56.597Z" },
    { url = "https://files.pythonhosted.org/packages/38/0d/aabe636bd25c6ab7b18825e5a97d40024da75152bec39aa6ac8b7a677630/aiohttp-3.12.13-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:69fc1909857401b67bf599c793f2183fbc4804717388b0b888f27f9929aa41f3", size = 1708202, upload-time = "2025-06-14T15:14:58.598Z" },
    { url = "https://files.pythonhosted.org/packages/1f/ab/561ef2d8a223261683fb95a6283ad0d36cb66c87503f3a7dde7afe208bb2/aiohttp-3.12.13-cp313-cp313-win32.whl", hash = "sha256:7d7e68787a2046b0e44ba5587aa723ce05d711e3a3665b6b7545328ac8e3c0dd", size = 420794, upload-time = "2025-06-14T15:15:00.939Z" },
    { url = "https://files.pythonhosted.org/packages/9d/47/b11d0089875a23bff0abd3edb5516bcd454db3fefab8604f5e4b07bd6210/aiohttp-3.12.13-cp313-cp313-win_amd64.whl", hash = "sha256:5a178390ca90419bfd41419a809688c368e63c86bd725e1186dd97f6b89c2706", size = 446735, upload-time = "2025-06-14T15:15:02.858Z" },
]

[[package]]
name = "aiosignal"
version = "1.3.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "frozenlist" },
]
sdist = { url = "https://files.pythonhosted.org/packages/ba/b5/6d55e80f6d8a08ce22b982eafa278d823b541c925f11ee774b0b9c43473d/aiosignal-1.3.2.tar.gz", hash = "sha256:a8c255c66fafb1e499c9351d0bf32ff2d8a0321595ebac3b93713656d2436f54", size = 19424, upload-time = "2024-12-13T17:10:40.86Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/ec/6a/bc7e17a3e87a2985d3e8f4da4cd0f481060eb78fb08596c42be62c90a4d9/aiosignal-1.3.2-py2.py3-none-any.whl", hash = "sha256:45cde58e409a301715980c2b01d0c28bdde3770d8290b5eb2173759d9acb31a5", size = 7597, upload-time = "2024-12-13T17:10:38.469Z" },
]

[[package]]
name = "annotated-types"
version = "0.7.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/ee/67/531ea369ba64dcff5ec9c3402f9f51bf748cec26dde048a2f973a4eea7f5/annotated_types-0.7.0.tar.gz", hash = "sha256:aff07c09a53a08bc8cfccb9c85b05f1aa9a2a6f23728d790723543408344ce89", size = 16081, upload-time = "2024-05-20T21:33:25.928Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/78/b6/6307fbef88d9b5ee7421e68d78a9f162e0da4900bc5f5793f6d3d0e34fb8/annotated_types-0.7.0-py3-none-any.whl", hash = "sha256:1f02e8b43a8fbbc3f3e0d4f0f4bfc8131bcb4eebe8849b8e5c773f3a1c582a53", size = 13643, upload-time = "2024-05-20T21:33:24.1Z" },
]

[[package]]
name = "anyio"
version = "4.9.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "idna" },
    { name = "sniffio" },
    { name = "typing-extensions", marker = "python_full_version < '3.13'" },
]
sdist = { url = "https://files.pythonhosted.org/packages/95/7d/4c1bd541d4dffa1b52bd83fb8527089e097a106fc90b467a7313b105f840/anyio-4.9.0.tar.gz", hash = "sha256:673c0c244e15788651a4ff38710fea9675823028a6f08a5eda409e0c9840a028", size = 190949, upload-time = "2025-03-17T00:02:54.77Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a1/ee/48ca1a7c89ffec8b6a0c5d02b89c305671d5ffd8d3c94acf8b8c408575bb/anyio-4.9.0-py3-none-any.whl", hash = "sha256:9f76d541cad6e36af7beb62e978876f3b41e3e04f2c1fbf0884604c0a9c4d93c", size = 100916, upload-time = "2025-03-17T00:02:52.713Z" },
]

[[package]]
name = "attrs"
version = "25.3.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/5a/b0/1367933a8532ee6ff8d63537de4f1177af4bff9f3e829baf7331f595bb24/attrs-25.3.0.tar.gz", hash = "sha256:75d7cefc7fb576747b2c81b4442d4d4a1ce0900973527c011d1030fd3bf4af1b", size = 812032, upload-time = "2025-03-13T11:10:22.779Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/77/06/bb80f5f86020c4551da315d78b3ab75e8228f89f0162f2c3a819e407941a/attrs-25.3.0-py3-none-any.whl", hash = "sha256:427318ce031701fea540783410126f03899a97ffc6f61596ad581ac2e40e3bc3", size = 63815, upload-time = "2025-03-13T11:10:21.14Z" },
]

[[package]]
name = "cachetools"
version = "5.5.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/6c/81/3747dad6b14fa2cf53fcf10548cf5aea6913e96fab41a3c198676f8948a5/cachetools-5.5.2.tar.gz", hash = "sha256:1a661caa9175d26759571b2e19580f9d6393969e5dfca11fdb1f947a23e640d4", size = 28380, upload-time = "2025-02-20T21:01:19.524Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/72/76/20fa66124dbe6be5cafeb312ece67de6b61dd91a0247d1ea13db4ebb33c2/cachetools-5.5.2-py3-none-any.whl", hash = "sha256:d26a22bcc62eb95c3beabd9f1ee5e820d3d2704fe2967cbe350e20c8ffcd3f0a", size = 10080, upload-time = "2025-02-20T21:01:16.647Z" },
]

[[package]]
name = "certifi"
version = "2025.6.15"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/73/f7/f14b46d4bcd21092d7d3ccef689615220d8a08fb25e564b65d20738e672e/certifi-2025.6.15.tar.gz", hash = "sha256:d747aa5a8b9bbbb1bb8c22bb13e22bd1f18e9796defa16bab421f7f7a317323b", size = 158753, upload-time = "2025-06-15T02:45:51.329Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/84/ae/320161bd181fc06471eed047ecce67b693fd7515b16d495d8932db763426/certifi-2025.6.15-py3-none-any.whl", hash = "sha256:2e0c7ce7cb5d8f8634ca55d2ba7e6ec2689a2fd6537d8dec1296a477a4910057", size = 157650, upload-time = "2025-06-15T02:45:49.977Z" },
]

[[package]]
name = "charset-normalizer"
version = "3.4.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/e4/33/89c2ced2b67d1c2a61c19c6751aa8902d46ce3dacb23600a283619f5a12d/charset_normalizer-3.4.2.tar.gz", hash = "sha256:5baececa9ecba31eff645232d59845c07aa030f0c81ee70184a90d35099a0e63", size = 126367, upload-time = "2025-05-02T08:34:42.01Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d7/a4/37f4d6035c89cac7930395a35cc0f1b872e652eaafb76a6075943754f095/charset_normalizer-3.4.2-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:0c29de6a1a95f24b9a1aa7aefd27d2487263f00dfd55a77719b530788f75cff7", size = 199936, upload-time = "2025-05-02T08:32:33.712Z" },
    { url = "https://files.pythonhosted.org/packages/ee/8a/1a5e33b73e0d9287274f899d967907cd0bf9c343e651755d9307e0dbf2b3/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:cddf7bd982eaa998934a91f69d182aec997c6c468898efe6679af88283b498d3", size = 143790, upload-time = "2025-05-02T08:32:35.768Z" },
    { url = "https://files.pythonhosted.org/packages/66/52/59521f1d8e6ab1482164fa21409c5ef44da3e9f653c13ba71becdd98dec3/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:fcbe676a55d7445b22c10967bceaaf0ee69407fbe0ece4d032b6eb8d4565982a", size = 153924, upload-time = "2025-05-02T08:32:37.284Z" },
    { url = "https://files.pythonhosted.org/packages/86/2d/fb55fdf41964ec782febbf33cb64be480a6b8f16ded2dbe8db27a405c09f/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:d41c4d287cfc69060fa91cae9683eacffad989f1a10811995fa309df656ec214", size = 146626, upload-time = "2025-05-02T08:32:38.803Z" },
    { url = "https://files.pythonhosted.org/packages/8c/73/6ede2ec59bce19b3edf4209d70004253ec5f4e319f9a2e3f2f15601ed5f7/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:4e594135de17ab3866138f496755f302b72157d115086d100c3f19370839dd3a", size = 148567, upload-time = "2025-05-02T08:32:40.251Z" },
    { url = "https://files.pythonhosted.org/packages/09/14/957d03c6dc343c04904530b6bef4e5efae5ec7d7990a7cbb868e4595ee30/charset_normalizer-3.4.2-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:cf713fe9a71ef6fd5adf7a79670135081cd4431c2943864757f0fa3a65b1fafd", size = 150957, upload-time = "2025-05-02T08:32:41.705Z" },
    { url = "https://files.pythonhosted.org/packages/0d/c8/8174d0e5c10ccebdcb1b53cc959591c4c722a3ad92461a273e86b9f5a302/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:a370b3e078e418187da8c3674eddb9d983ec09445c99a3a263c2011993522981", size = 145408, upload-time = "2025-05-02T08:32:43.709Z" },
    { url = "https://files.pythonhosted.org/packages/58/aa/8904b84bc8084ac19dc52feb4f5952c6df03ffb460a887b42615ee1382e8/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:a955b438e62efdf7e0b7b52a64dc5c3396e2634baa62471768a64bc2adb73d5c", size = 153399, upload-time = "2025-05-02T08:32:46.197Z" },
    { url = "https://files.pythonhosted.org/packages/c2/26/89ee1f0e264d201cb65cf054aca6038c03b1a0c6b4ae998070392a3ce605/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:7222ffd5e4de8e57e03ce2cef95a4c43c98fcb72ad86909abdfc2c17d227fc1b", size = 156815, upload-time = "2025-05-02T08:32:48.105Z" },
    { url = "https://files.pythonhosted.org/packages/fd/07/68e95b4b345bad3dbbd3a8681737b4338ff2c9df29856a6d6d23ac4c73cb/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:bee093bf902e1d8fc0ac143c88902c3dfc8941f7ea1d6a8dd2bcb786d33db03d", size = 154537, upload-time = "2025-05-02T08:32:49.719Z" },
    { url = "https://files.pythonhosted.org/packages/77/1a/5eefc0ce04affb98af07bc05f3bac9094513c0e23b0562d64af46a06aae4/charset_normalizer-3.4.2-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:dedb8adb91d11846ee08bec4c8236c8549ac721c245678282dcb06b221aab59f", size = 149565, upload-time = "2025-05-02T08:32:51.404Z" },
    { url = "https://files.pythonhosted.org/packages/37/a0/2410e5e6032a174c95e0806b1a6585eb21e12f445ebe239fac441995226a/charset_normalizer-3.4.2-cp312-cp312-win32.whl", hash = "sha256:db4c7bf0e07fc3b7d89ac2a5880a6a8062056801b83ff56d8464b70f65482b6c", size = 98357, upload-time = "2025-05-02T08:32:53.079Z" },
    { url = "https://files.pythonhosted.org/packages/6c/4f/c02d5c493967af3eda9c771ad4d2bbc8df6f99ddbeb37ceea6e8716a32bc/charset_normalizer-3.4.2-cp312-cp312-win_amd64.whl", hash = "sha256:5a9979887252a82fefd3d3ed2a8e3b937a7a809f65dcb1e068b090e165bbe99e", size = 105776, upload-time = "2025-05-02T08:32:54.573Z" },
    { url = "https://files.pythonhosted.org/packages/ea/12/a93df3366ed32db1d907d7593a94f1fe6293903e3e92967bebd6950ed12c/charset_normalizer-3.4.2-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:926ca93accd5d36ccdabd803392ddc3e03e6d4cd1cf17deff3b989ab8e9dbcf0", size = 199622, upload-time = "2025-05-02T08:32:56.363Z" },
    { url = "https://files.pythonhosted.org/packages/04/93/bf204e6f344c39d9937d3c13c8cd5bbfc266472e51fc8c07cb7f64fcd2de/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:eba9904b0f38a143592d9fc0e19e2df0fa2e41c3c3745554761c5f6447eedabf", size = 143435, upload-time = "2025-05-02T08:32:58.551Z" },
    { url = "https://files.pythonhosted.org/packages/22/2a/ea8a2095b0bafa6c5b5a55ffdc2f924455233ee7b91c69b7edfcc9e02284/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:3fddb7e2c84ac87ac3a947cb4e66d143ca5863ef48e4a5ecb83bd48619e4634e", size = 153653, upload-time = "2025-05-02T08:33:00.342Z" },
    { url = "https://files.pythonhosted.org/packages/b6/57/1b090ff183d13cef485dfbe272e2fe57622a76694061353c59da52c9a659/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:98f862da73774290f251b9df8d11161b6cf25b599a66baf087c1ffe340e9bfd1", size = 146231, upload-time = "2025-05-02T08:33:02.081Z" },
    { url = "https://files.pythonhosted.org/packages/e2/28/ffc026b26f441fc67bd21ab7f03b313ab3fe46714a14b516f931abe1a2d8/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:6c9379d65defcab82d07b2a9dfbfc2e95bc8fe0ebb1b176a3190230a3ef0e07c", size = 148243, upload-time = "2025-05-02T08:33:04.063Z" },
    { url = "https://files.pythonhosted.org/packages/c0/0f/9abe9bd191629c33e69e47c6ef45ef99773320e9ad8e9cb08b8ab4a8d4cb/charset_normalizer-3.4.2-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:e635b87f01ebc977342e2697d05b56632f5f879a4f15955dfe8cef2448b51691", size = 150442, upload-time = "2025-05-02T08:33:06.418Z" },
    { url = "https://files.pythonhosted.org/packages/67/7c/a123bbcedca91d5916c056407f89a7f5e8fdfce12ba825d7d6b9954a1a3c/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:1c95a1e2902a8b722868587c0e1184ad5c55631de5afc0eb96bc4b0d738092c0", size = 145147, upload-time = "2025-05-02T08:33:08.183Z" },
    { url = "https://files.pythonhosted.org/packages/ec/fe/1ac556fa4899d967b83e9893788e86b6af4d83e4726511eaaad035e36595/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:ef8de666d6179b009dce7bcb2ad4c4a779f113f12caf8dc77f0162c29d20490b", size = 153057, upload-time = "2025-05-02T08:33:09.986Z" },
    { url = "https://files.pythonhosted.org/packages/2b/ff/acfc0b0a70b19e3e54febdd5301a98b72fa07635e56f24f60502e954c461/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:32fc0341d72e0f73f80acb0a2c94216bd704f4f0bce10aedea38f30502b271ff", size = 156454, upload-time = "2025-05-02T08:33:11.814Z" },
    { url = "https://files.pythonhosted.org/packages/92/08/95b458ce9c740d0645feb0e96cea1f5ec946ea9c580a94adfe0b617f3573/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:289200a18fa698949d2b39c671c2cc7a24d44096784e76614899a7ccf2574b7b", size = 154174, upload-time = "2025-05-02T08:33:13.707Z" },
    { url = "https://files.pythonhosted.org/packages/78/be/8392efc43487ac051eee6c36d5fbd63032d78f7728cb37aebcc98191f1ff/charset_normalizer-3.4.2-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:4a476b06fbcf359ad25d34a057b7219281286ae2477cc5ff5e3f70a246971148", size = 149166, upload-time = "2025-05-02T08:33:15.458Z" },
    { url = "https://files.pythonhosted.org/packages/44/96/392abd49b094d30b91d9fbda6a69519e95802250b777841cf3bda8fe136c/charset_normalizer-3.4.2-cp313-cp313-win32.whl", hash = "sha256:aaeeb6a479c7667fbe1099af9617c83aaca22182d6cf8c53966491a0f1b7ffb7", size = 98064, upload-time = "2025-05-02T08:33:17.06Z" },
    { url = "https://files.pythonhosted.org/packages/e9/b0/0200da600134e001d91851ddc797809e2fe0ea72de90e09bec5a2fbdaccb/charset_normalizer-3.4.2-cp313-cp313-win_amd64.whl", hash = "sha256:aa6af9e7d59f9c12b33ae4e9450619cf2488e2bbe9b44030905877f0b2324980", size = 105641, upload-time = "2025-05-02T08:33:18.753Z" },
    { url = "https://files.pythonhosted.org/packages/20/94/c5790835a017658cbfabd07f3bfb549140c3ac458cfc196323996b10095a/charset_normalizer-3.4.2-py3-none-any.whl", hash = "sha256:7f56930ab0abd1c45cd15be65cc741c28b1c9a34876ce8c17a2fa107810c0af0", size = 52626, upload-time = "2025-05-02T08:34:40.053Z" },
]

[[package]]
name = "click"
version = "8.2.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
]
sdist = { url = "https://files.pythonhosted.org/packages/60/6c/8ca2efa64cf75a977a0d7fac081354553ebe483345c734fb6b6515d96bbc/click-8.2.1.tar.gz", hash = "sha256:27c491cc05d968d271d5a1db13e3b5a184636d9d930f148c50b038f0d0646202", size = 286342, upload-time = "2025-05-20T23:19:49.832Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/85/32/10bb5764d90a8eee674e9dc6f4db6a0ab47c8c4d0d83c27f7c39ac415a4d/click-8.2.1-py3-none-any.whl", hash = "sha256:61a3265b914e850b85317d0b3109c7f8cd35a670f963866005d6ef1d5175a12b", size = 102215, upload-time = "2025-05-20T23:19:47.796Z" },
]

[[package]]
name = "colorama"
version = "0.4.6"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/d8/53/6f443c9a4a8358a93a6792e2acffb9d9d5cb0a5cfd8802644b7b1c9a02e4/colorama-0.4.6.tar.gz", hash = "sha256:08695f5cb7ed6e0531a20572697297273c47b8cae5a63ffc6d6ed5c201be6e44", size = 27697, upload-time = "2022-10-25T02:36:22.414Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d1/d6/3965ed04c63042e047cb6a3e6ed1a63a35087b6a609aa3a15ed8ac56c221/colorama-0.4.6-py2.py3-none-any.whl", hash = "sha256:4f1d9991f5acc0ca119f9d443620b77f9d6b33703e51011c16baf57afb285fc6", size = 25335, upload-time = "2022-10-25T02:36:20.889Z" },
]

[[package]]
name = "coverage"
version = "7.9.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/e7/e0/98670a80884f64578f0c22cd70c5e81a6e07b08167721c7487b4d70a7ca0/coverage-7.9.1.tar.gz", hash = "sha256:6cf43c78c4282708a28e466316935ec7489a9c487518a77fa68f716c67909cec", size = 813650, upload-time = "2025-06-13T13:02:28.627Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/68/d9/7f66eb0a8f2fce222de7bdc2046ec41cb31fe33fb55a330037833fb88afc/coverage-7.9.1-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:a8de12b4b87c20de895f10567639c0797b621b22897b0af3ce4b4e204a743626", size = 212336, upload-time = "2025-06-13T13:01:10.909Z" },
    { url = "https://files.pythonhosted.org/packages/20/20/e07cb920ef3addf20f052ee3d54906e57407b6aeee3227a9c91eea38a665/coverage-7.9.1-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:5add197315a054e92cee1b5f686a2bcba60c4c3e66ee3de77ace6c867bdee7cb", size = 212571, upload-time = "2025-06-13T13:01:12.518Z" },
    { url = "https://files.pythonhosted.org/packages/78/f8/96f155de7e9e248ca9c8ff1a40a521d944ba48bec65352da9be2463745bf/coverage-7.9.1-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:600a1d4106fe66f41e5d0136dfbc68fe7200a5cbe85610ddf094f8f22e1b0300", size = 246377, upload-time = "2025-06-13T13:01:14.87Z" },
    { url = "https://files.pythonhosted.org/packages/3e/cf/1d783bd05b7bca5c10ded5f946068909372e94615a4416afadfe3f63492d/coverage-7.9.1-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:2a876e4c3e5a2a1715a6608906aa5a2e0475b9c0f68343c2ada98110512ab1d8", size = 243394, upload-time = "2025-06-13T13:01:16.23Z" },
    { url = "https://files.pythonhosted.org/packages/02/dd/e7b20afd35b0a1abea09fb3998e1abc9f9bd953bee548f235aebd2b11401/coverage-7.9.1-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:81f34346dd63010453922c8e628a52ea2d2ccd73cb2487f7700ac531b247c8a5", size = 245586, upload-time = "2025-06-13T13:01:17.532Z" },
    { url = "https://files.pythonhosted.org/packages/4e/38/b30b0006fea9d617d1cb8e43b1bc9a96af11eff42b87eb8c716cf4d37469/coverage-7.9.1-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:888f8eee13f2377ce86d44f338968eedec3291876b0b8a7289247ba52cb984cd", size = 245396, upload-time = "2025-06-13T13:01:19.164Z" },
    { url = "https://files.pythonhosted.org/packages/31/e4/4d8ec1dc826e16791f3daf1b50943e8e7e1eb70e8efa7abb03936ff48418/coverage-7.9.1-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:9969ef1e69b8c8e1e70d591f91bbc37fc9a3621e447525d1602801a24ceda898", size = 243577, upload-time = "2025-06-13T13:01:22.433Z" },
    { url = "https://files.pythonhosted.org/packages/25/f4/b0e96c5c38e6e40ef465c4bc7f138863e2909c00e54a331da335faf0d81a/coverage-7.9.1-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:60c458224331ee3f1a5b472773e4a085cc27a86a0b48205409d364272d67140d", size = 244809, upload-time = "2025-06-13T13:01:24.143Z" },
    { url = "https://files.pythonhosted.org/packages/8a/65/27e0a1fa5e2e5079bdca4521be2f5dabf516f94e29a0defed35ac2382eb2/coverage-7.9.1-cp312-cp312-win32.whl", hash = "sha256:5f646a99a8c2b3ff4c6a6e081f78fad0dde275cd59f8f49dc4eab2e394332e74", size = 214724, upload-time = "2025-06-13T13:01:25.435Z" },
    { url = "https://files.pythonhosted.org/packages/9b/a8/d5b128633fd1a5e0401a4160d02fa15986209a9e47717174f99dc2f7166d/coverage-7.9.1-cp312-cp312-win_amd64.whl", hash = "sha256:30f445f85c353090b83e552dcbbdad3ec84c7967e108c3ae54556ca69955563e", size = 215535, upload-time = "2025-06-13T13:01:27.861Z" },
    { url = "https://files.pythonhosted.org/packages/a3/37/84bba9d2afabc3611f3e4325ee2c6a47cd449b580d4a606b240ce5a6f9bf/coverage-7.9.1-cp312-cp312-win_arm64.whl", hash = "sha256:af41da5dca398d3474129c58cb2b106a5d93bbb196be0d307ac82311ca234342", size = 213904, upload-time = "2025-06-13T13:01:29.202Z" },
    { url = "https://files.pythonhosted.org/packages/d0/a7/a027970c991ca90f24e968999f7d509332daf6b8c3533d68633930aaebac/coverage-7.9.1-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:31324f18d5969feef7344a932c32428a2d1a3e50b15a6404e97cba1cc9b2c631", size = 212358, upload-time = "2025-06-13T13:01:30.909Z" },
    { url = "https://files.pythonhosted.org/packages/f2/48/6aaed3651ae83b231556750280682528fea8ac7f1232834573472d83e459/coverage-7.9.1-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:0c804506d624e8a20fb3108764c52e0eef664e29d21692afa375e0dd98dc384f", size = 212620, upload-time = "2025-06-13T13:01:32.256Z" },
    { url = "https://files.pythonhosted.org/packages/6c/2a/f4b613f3b44d8b9f144847c89151992b2b6b79cbc506dee89ad0c35f209d/coverage-7.9.1-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:ef64c27bc40189f36fcc50c3fb8f16ccda73b6a0b80d9bd6e6ce4cffcd810bbd", size = 245788, upload-time = "2025-06-13T13:01:33.948Z" },
    { url = "https://files.pythonhosted.org/packages/04/d2/de4fdc03af5e4e035ef420ed26a703c6ad3d7a07aff2e959eb84e3b19ca8/coverage-7.9.1-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:d4fe2348cc6ec372e25adec0219ee2334a68d2f5222e0cba9c0d613394e12d86", size = 243001, upload-time = "2025-06-13T13:01:35.285Z" },
    { url = "https://files.pythonhosted.org/packages/f5/e8/eed18aa5583b0423ab7f04e34659e51101135c41cd1dcb33ac1d7013a6d6/coverage-7.9.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:34ed2186fe52fcc24d4561041979a0dec69adae7bce2ae8d1c49eace13e55c43", size = 244985, upload-time = "2025-06-13T13:01:36.712Z" },
    { url = "https://files.pythonhosted.org/packages/17/f8/ae9e5cce8885728c934eaa58ebfa8281d488ef2afa81c3dbc8ee9e6d80db/coverage-7.9.1-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:25308bd3d00d5eedd5ae7d4357161f4df743e3c0240fa773ee1b0f75e6c7c0f1", size = 245152, upload-time = "2025-06-13T13:01:39.303Z" },
    { url = "https://files.pythonhosted.org/packages/5a/c8/272c01ae792bb3af9b30fac14d71d63371db227980682836ec388e2c57c0/coverage-7.9.1-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:73e9439310f65d55a5a1e0564b48e34f5369bee943d72c88378f2d576f5a5751", size = 243123, upload-time = "2025-06-13T13:01:40.727Z" },
    { url = "https://files.pythonhosted.org/packages/8c/d0/2819a1e3086143c094ab446e3bdf07138527a7b88cb235c488e78150ba7a/coverage-7.9.1-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:37ab6be0859141b53aa89412a82454b482c81cf750de4f29223d52268a86de67", size = 244506, upload-time = "2025-06-13T13:01:42.184Z" },
    { url = "https://files.pythonhosted.org/packages/8b/4e/9f6117b89152df7b6112f65c7a4ed1f2f5ec8e60c4be8f351d91e7acc848/coverage-7.9.1-cp313-cp313-win32.whl", hash = "sha256:64bdd969456e2d02a8b08aa047a92d269c7ac1f47e0c977675d550c9a0863643", size = 214766, upload-time = "2025-06-13T13:01:44.482Z" },
    { url = "https://files.pythonhosted.org/packages/27/0f/4b59f7c93b52c2c4ce7387c5a4e135e49891bb3b7408dcc98fe44033bbe0/coverage-7.9.1-cp313-cp313-win_amd64.whl", hash = "sha256:be9e3f68ca9edb897c2184ad0eee815c635565dbe7a0e7e814dc1f7cbab92c0a", size = 215568, upload-time = "2025-06-13T13:01:45.772Z" },
    { url = "https://files.pythonhosted.org/packages/09/1e/9679826336f8c67b9c39a359352882b24a8a7aee48d4c9cad08d38d7510f/coverage-7.9.1-cp313-cp313-win_arm64.whl", hash = "sha256:1c503289ffef1d5105d91bbb4d62cbe4b14bec4d13ca225f9c73cde9bb46207d", size = 213939, upload-time = "2025-06-13T13:01:47.087Z" },
    { url = "https://files.pythonhosted.org/packages/bb/5b/5c6b4e7a407359a2e3b27bf9c8a7b658127975def62077d441b93a30dbe8/coverage-7.9.1-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:0b3496922cb5f4215bf5caaef4cf12364a26b0be82e9ed6d050f3352cf2d7ef0", size = 213079, upload-time = "2025-06-13T13:01:48.554Z" },
    { url = "https://files.pythonhosted.org/packages/a2/22/1e2e07279fd2fd97ae26c01cc2186e2258850e9ec125ae87184225662e89/coverage-7.9.1-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:9565c3ab1c93310569ec0d86b017f128f027cab0b622b7af288696d7ed43a16d", size = 213299, upload-time = "2025-06-13T13:01:49.997Z" },
    { url = "https://files.pythonhosted.org/packages/14/c0/4c5125a4b69d66b8c85986d3321520f628756cf524af810baab0790c7647/coverage-7.9.1-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:2241ad5dbf79ae1d9c08fe52b36d03ca122fb9ac6bca0f34439e99f8327ac89f", size = 256535, upload-time = "2025-06-13T13:01:51.314Z" },
    { url = "https://files.pythonhosted.org/packages/81/8b/e36a04889dda9960be4263e95e777e7b46f1bb4fc32202612c130a20c4da/coverage-7.9.1-cp313-cp313t-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3bb5838701ca68b10ebc0937dbd0eb81974bac54447c55cd58dea5bca8451029", size = 252756, upload-time = "2025-06-13T13:01:54.403Z" },
    { url = "https://files.pythonhosted.org/packages/98/82/be04eff8083a09a4622ecd0e1f31a2c563dbea3ed848069e7b0445043a70/coverage-7.9.1-cp313-cp313t-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:b30a25f814591a8c0c5372c11ac8967f669b97444c47fd794926e175c4047ece", size = 254912, upload-time = "2025-06-13T13:01:56.769Z" },
    { url = "https://files.pythonhosted.org/packages/0f/25/c26610a2c7f018508a5ab958e5b3202d900422cf7cdca7670b6b8ca4e8df/coverage-7.9.1-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:2d04b16a6062516df97969f1ae7efd0de9c31eb6ebdceaa0d213b21c0ca1a683", size = 256144, upload-time = "2025-06-13T13:01:58.19Z" },
    { url = "https://files.pythonhosted.org/packages/c5/8b/fb9425c4684066c79e863f1e6e7ecebb49e3a64d9f7f7860ef1688c56f4a/coverage-7.9.1-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:7931b9e249edefb07cd6ae10c702788546341d5fe44db5b6108a25da4dca513f", size = 254257, upload-time = "2025-06-13T13:01:59.645Z" },
    { url = "https://files.pythonhosted.org/packages/93/df/27b882f54157fc1131e0e215b0da3b8d608d9b8ef79a045280118a8f98fe/coverage-7.9.1-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:52e92b01041151bf607ee858e5a56c62d4b70f4dac85b8c8cb7fb8a351ab2c10", size = 255094, upload-time = "2025-06-13T13:02:01.37Z" },
    { url = "https://files.pythonhosted.org/packages/41/5f/cad1c3dbed8b3ee9e16fa832afe365b4e3eeab1fb6edb65ebbf745eabc92/coverage-7.9.1-cp313-cp313t-win32.whl", hash = "sha256:684e2110ed84fd1ca5f40e89aa44adf1729dc85444004111aa01866507adf363", size = 215437, upload-time = "2025-06-13T13:02:02.905Z" },
    { url = "https://files.pythonhosted.org/packages/99/4d/fad293bf081c0e43331ca745ff63673badc20afea2104b431cdd8c278b4c/coverage-7.9.1-cp313-cp313t-win_amd64.whl", hash = "sha256:437c576979e4db840539674e68c84b3cda82bc824dd138d56bead1435f1cb5d7", size = 216605, upload-time = "2025-06-13T13:02:05.638Z" },
    { url = "https://files.pythonhosted.org/packages/1f/56/4ee027d5965fc7fc126d7ec1187529cc30cc7d740846e1ecb5e92d31b224/coverage-7.9.1-cp313-cp313t-win_arm64.whl", hash = "sha256:18a0912944d70aaf5f399e350445738a1a20b50fbea788f640751c2ed9208b6c", size = 214392, upload-time = "2025-06-13T13:02:07.642Z" },
    { url = "https://files.pythonhosted.org/packages/08/b8/7ddd1e8ba9701dea08ce22029917140e6f66a859427406579fd8d0ca7274/coverage-7.9.1-py3-none-any.whl", hash = "sha256:66b974b145aa189516b6bf2d8423e888b742517d37872f6ee4c5be0073bd9a3c", size = 204000, upload-time = "2025-06-13T13:02:27.173Z" },
]

[[package]]
name = "deprecation"
version = "2.1.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "packaging" },
]
sdist = { url = "https://files.pythonhosted.org/packages/5a/d3/8ae2869247df154b64c1884d7346d412fed0c49df84db635aab2d1c40e62/deprecation-2.1.0.tar.gz", hash = "sha256:72b3bde64e5d778694b0cf68178aed03d15e15477116add3fb773e581f9518ff", size = 173788, upload-time = "2020-04-20T14:23:38.738Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/02/c3/253a89ee03fc9b9682f1541728eb66db7db22148cd94f89ab22528cd1e1b/deprecation-2.1.0-py2.py3-none-any.whl", hash = "sha256:a10811591210e1fb0e768a8c25517cabeabcba6f0bf96564f8ff45189f90b14a", size = 11178, upload-time = "2020-04-20T14:23:36.581Z" },
]

[[package]]
name = "distro"
version = "1.9.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/fc/f8/98eea607f65de6527f8a2e8885fc8015d3e6f5775df186e443e0964a11c3/distro-1.9.0.tar.gz", hash = "sha256:2fa77c6fd8940f116ee1d6b94a2f90b13b5ea8d019b98bc8bafdcabcdd9bdbed", size = 60722, upload-time = "2023-12-24T09:54:32.31Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/12/b3/231ffd4ab1fc9d679809f356cebee130ac7daa00d6d6f3206dd4fd137e9e/distro-1.9.0-py3-none-any.whl", hash = "sha256:7bffd925d65168f85027d8da9af6bddab658135b840670a223589bc0c8ef02b2", size = 20277, upload-time = "2023-12-24T09:54:30.421Z" },
]

[[package]]
name = "fastapi"
version = "0.115.14"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pydantic" },
    { name = "starlette" },
    { name = "typing-extensions" },
]
sdist = { url = "https://files.pythonhosted.org/packages/ca/53/8c38a874844a8b0fa10dd8adf3836ac154082cf88d3f22b544e9ceea0a15/fastapi-0.115.14.tar.gz", hash = "sha256:b1de15cdc1c499a4da47914db35d0e4ef8f1ce62b624e94e0e5824421df99739", size = 296263, upload-time = "2025-06-26T15:29:08.21Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/53/50/b1222562c6d270fea83e9c9075b8e8600b8479150a18e4516a6138b980d1/fastapi-0.115.14-py3-none-any.whl", hash = "sha256:6c0c8bf9420bd58f565e585036d971872472b4f7d3f6c73b698e10cffdefb3ca", size = 95514, upload-time = "2025-06-26T15:29:06.49Z" },
]

[[package]]
name = "frozenlist"
version = "1.7.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/79/b1/b64018016eeb087db503b038296fd782586432b9c077fc5c7839e9cb6ef6/frozenlist-1.7.0.tar.gz", hash = "sha256:2e310d81923c2437ea8670467121cc3e9b0f76d3043cc1d2331d56c7fb7a3a8f", size = 45078, upload-time = "2025-06-09T23:02:35.538Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/ef/a2/c8131383f1e66adad5f6ecfcce383d584ca94055a34d683bbb24ac5f2f1c/frozenlist-1.7.0-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:3dbf9952c4bb0e90e98aec1bd992b3318685005702656bc6f67c1a32b76787f2", size = 81424, upload-time = "2025-06-09T23:00:42.24Z" },
    { url = "https://files.pythonhosted.org/packages/4c/9d/02754159955088cb52567337d1113f945b9e444c4960771ea90eb73de8db/frozenlist-1.7.0-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:1f5906d3359300b8a9bb194239491122e6cf1444c2efb88865426f170c262cdb", size = 47952, upload-time = "2025-06-09T23:00:43.481Z" },
    { url = "https://files.pythonhosted.org/packages/01/7a/0046ef1bd6699b40acd2067ed6d6670b4db2f425c56980fa21c982c2a9db/frozenlist-1.7.0-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:3dabd5a8f84573c8d10d8859a50ea2dec01eea372031929871368c09fa103478", size = 46688, upload-time = "2025-06-09T23:00:44.793Z" },
    { url = "https://files.pythonhosted.org/packages/d6/a2/a910bafe29c86997363fb4c02069df4ff0b5bc39d33c5198b4e9dd42d8f8/frozenlist-1.7.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:aa57daa5917f1738064f302bf2626281a1cb01920c32f711fbc7bc36111058a8", size = 243084, upload-time = "2025-06-09T23:00:46.125Z" },
    { url = "https://files.pythonhosted.org/packages/64/3e/5036af9d5031374c64c387469bfcc3af537fc0f5b1187d83a1cf6fab1639/frozenlist-1.7.0-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:c193dda2b6d49f4c4398962810fa7d7c78f032bf45572b3e04dd5249dff27e08", size = 233524, upload-time = "2025-06-09T23:00:47.73Z" },
    { url = "https://files.pythonhosted.org/packages/06/39/6a17b7c107a2887e781a48ecf20ad20f1c39d94b2a548c83615b5b879f28/frozenlist-1.7.0-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:bfe2b675cf0aaa6d61bf8fbffd3c274b3c9b7b1623beb3809df8a81399a4a9c4", size = 248493, upload-time = "2025-06-09T23:00:49.742Z" },
    { url = "https://files.pythonhosted.org/packages/be/00/711d1337c7327d88c44d91dd0f556a1c47fb99afc060ae0ef66b4d24793d/frozenlist-1.7.0-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8fc5d5cda37f62b262405cf9652cf0856839c4be8ee41be0afe8858f17f4c94b", size = 244116, upload-time = "2025-06-09T23:00:51.352Z" },
    { url = "https://files.pythonhosted.org/packages/24/fe/74e6ec0639c115df13d5850e75722750adabdc7de24e37e05a40527ca539/frozenlist-1.7.0-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:b0d5ce521d1dd7d620198829b87ea002956e4319002ef0bc8d3e6d045cb4646e", size = 224557, upload-time = "2025-06-09T23:00:52.855Z" },
    { url = "https://files.pythonhosted.org/packages/8d/db/48421f62a6f77c553575201e89048e97198046b793f4a089c79a6e3268bd/frozenlist-1.7.0-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:488d0a7d6a0008ca0db273c542098a0fa9e7dfaa7e57f70acef43f32b3f69dca", size = 241820, upload-time = "2025-06-09T23:00:54.43Z" },
    { url = "https://files.pythonhosted.org/packages/1d/fa/cb4a76bea23047c8462976ea7b7a2bf53997a0ca171302deae9d6dd12096/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:15a7eaba63983d22c54d255b854e8108e7e5f3e89f647fc854bd77a237e767df", size = 236542, upload-time = "2025-06-09T23:00:56.409Z" },
    { url = "https://files.pythonhosted.org/packages/5d/32/476a4b5cfaa0ec94d3f808f193301debff2ea42288a099afe60757ef6282/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:1eaa7e9c6d15df825bf255649e05bd8a74b04a4d2baa1ae46d9c2d00b2ca2cb5", size = 249350, upload-time = "2025-06-09T23:00:58.468Z" },
    { url = "https://files.pythonhosted.org/packages/8d/ba/9a28042f84a6bf8ea5dbc81cfff8eaef18d78b2a1ad9d51c7bc5b029ad16/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:e4389e06714cfa9d47ab87f784a7c5be91d3934cd6e9a7b85beef808297cc025", size = 225093, upload-time = "2025-06-09T23:01:00.015Z" },
    { url = "https://files.pythonhosted.org/packages/bc/29/3a32959e68f9cf000b04e79ba574527c17e8842e38c91d68214a37455786/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:73bd45e1488c40b63fe5a7df892baf9e2a4d4bb6409a2b3b78ac1c6236178e01", size = 245482, upload-time = "2025-06-09T23:01:01.474Z" },
    { url = "https://files.pythonhosted.org/packages/80/e8/edf2f9e00da553f07f5fa165325cfc302dead715cab6ac8336a5f3d0adc2/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:99886d98e1643269760e5fe0df31e5ae7050788dd288947f7f007209b8c33f08", size = 249590, upload-time = "2025-06-09T23:01:02.961Z" },
    { url = "https://files.pythonhosted.org/packages/1c/80/9a0eb48b944050f94cc51ee1c413eb14a39543cc4f760ed12657a5a3c45a/frozenlist-1.7.0-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:290a172aae5a4c278c6da8a96222e6337744cd9c77313efe33d5670b9f65fc43", size = 237785, upload-time = "2025-06-09T23:01:05.095Z" },
    { url = "https://files.pythonhosted.org/packages/f3/74/87601e0fb0369b7a2baf404ea921769c53b7ae00dee7dcfe5162c8c6dbf0/frozenlist-1.7.0-cp312-cp312-win32.whl", hash = "sha256:426c7bc70e07cfebc178bc4c2bf2d861d720c4fff172181eeb4a4c41d4ca2ad3", size = 39487, upload-time = "2025-06-09T23:01:06.54Z" },
    { url = "https://files.pythonhosted.org/packages/0b/15/c026e9a9fc17585a9d461f65d8593d281fedf55fbf7eb53f16c6df2392f9/frozenlist-1.7.0-cp312-cp312-win_amd64.whl", hash = "sha256:563b72efe5da92e02eb68c59cb37205457c977aa7a449ed1b37e6939e5c47c6a", size = 43874, upload-time = "2025-06-09T23:01:07.752Z" },
    { url = "https://files.pythonhosted.org/packages/24/90/6b2cebdabdbd50367273c20ff6b57a3dfa89bd0762de02c3a1eb42cb6462/frozenlist-1.7.0-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:ee80eeda5e2a4e660651370ebffd1286542b67e268aa1ac8d6dbe973120ef7ee", size = 79791, upload-time = "2025-06-09T23:01:09.368Z" },
    { url = "https://files.pythonhosted.org/packages/83/2e/5b70b6a3325363293fe5fc3ae74cdcbc3e996c2a11dde2fd9f1fb0776d19/frozenlist-1.7.0-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:d1a81c85417b914139e3a9b995d4a1c84559afc839a93cf2cb7f15e6e5f6ed2d", size = 47165, upload-time = "2025-06-09T23:01:10.653Z" },
    { url = "https://files.pythonhosted.org/packages/f4/25/a0895c99270ca6966110f4ad98e87e5662eab416a17e7fd53c364bf8b954/frozenlist-1.7.0-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:cbb65198a9132ebc334f237d7b0df163e4de83fb4f2bdfe46c1e654bdb0c5d43", size = 45881, upload-time = "2025-06-09T23:01:12.296Z" },
    { url = "https://files.pythonhosted.org/packages/19/7c/71bb0bbe0832793c601fff68cd0cf6143753d0c667f9aec93d3c323f4b55/frozenlist-1.7.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:dab46c723eeb2c255a64f9dc05b8dd601fde66d6b19cdb82b2e09cc6ff8d8b5d", size = 232409, upload-time = "2025-06-09T23:01:13.641Z" },
    { url = "https://files.pythonhosted.org/packages/c0/45/ed2798718910fe6eb3ba574082aaceff4528e6323f9a8570be0f7028d8e9/frozenlist-1.7.0-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:6aeac207a759d0dedd2e40745575ae32ab30926ff4fa49b1635def65806fddee", size = 225132, upload-time = "2025-06-09T23:01:15.264Z" },
    { url = "https://files.pythonhosted.org/packages/ba/e2/8417ae0f8eacb1d071d4950f32f229aa6bf68ab69aab797b72a07ea68d4f/frozenlist-1.7.0-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:bd8c4e58ad14b4fa7802b8be49d47993182fdd4023393899632c88fd8cd994eb", size = 237638, upload-time = "2025-06-09T23:01:16.752Z" },
    { url = "https://files.pythonhosted.org/packages/f8/b7/2ace5450ce85f2af05a871b8c8719b341294775a0a6c5585d5e6170f2ce7/frozenlist-1.7.0-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:04fb24d104f425da3540ed83cbfc31388a586a7696142004c577fa61c6298c3f", size = 233539, upload-time = "2025-06-09T23:01:18.202Z" },
    { url = "https://files.pythonhosted.org/packages/46/b9/6989292c5539553dba63f3c83dc4598186ab2888f67c0dc1d917e6887db6/frozenlist-1.7.0-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:6a5c505156368e4ea6b53b5ac23c92d7edc864537ff911d2fb24c140bb175e60", size = 215646, upload-time = "2025-06-09T23:01:19.649Z" },
    { url = "https://files.pythonhosted.org/packages/72/31/bc8c5c99c7818293458fe745dab4fd5730ff49697ccc82b554eb69f16a24/frozenlist-1.7.0-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:8bd7eb96a675f18aa5c553eb7ddc24a43c8c18f22e1f9925528128c052cdbe00", size = 232233, upload-time = "2025-06-09T23:01:21.175Z" },
    { url = "https://files.pythonhosted.org/packages/59/52/460db4d7ba0811b9ccb85af996019f5d70831f2f5f255f7cc61f86199795/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:05579bf020096fe05a764f1f84cd104a12f78eaab68842d036772dc6d4870b4b", size = 227996, upload-time = "2025-06-09T23:01:23.098Z" },
    { url = "https://files.pythonhosted.org/packages/ba/c9/f4b39e904c03927b7ecf891804fd3b4df3db29b9e487c6418e37988d6e9d/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:376b6222d114e97eeec13d46c486facd41d4f43bab626b7c3f6a8b4e81a5192c", size = 242280, upload-time = "2025-06-09T23:01:24.808Z" },
    { url = "https://files.pythonhosted.org/packages/b8/33/3f8d6ced42f162d743e3517781566b8481322be321b486d9d262adf70bfb/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:0aa7e176ebe115379b5b1c95b4096fb1c17cce0847402e227e712c27bdb5a949", size = 217717, upload-time = "2025-06-09T23:01:26.28Z" },
    { url = "https://files.pythonhosted.org/packages/3e/e8/ad683e75da6ccef50d0ab0c2b2324b32f84fc88ceee778ed79b8e2d2fe2e/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:3fbba20e662b9c2130dc771e332a99eff5da078b2b2648153a40669a6d0e36ca", size = 236644, upload-time = "2025-06-09T23:01:27.887Z" },
    { url = "https://files.pythonhosted.org/packages/b2/14/8d19ccdd3799310722195a72ac94ddc677541fb4bef4091d8e7775752360/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:f3f4410a0a601d349dd406b5713fec59b4cee7e71678d5b17edda7f4655a940b", size = 238879, upload-time = "2025-06-09T23:01:29.524Z" },
    { url = "https://files.pythonhosted.org/packages/ce/13/c12bf657494c2fd1079a48b2db49fa4196325909249a52d8f09bc9123fd7/frozenlist-1.7.0-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:e2cdfaaec6a2f9327bf43c933c0319a7c429058e8537c508964a133dffee412e", size = 232502, upload-time = "2025-06-09T23:01:31.287Z" },
    { url = "https://files.pythonhosted.org/packages/d7/8b/e7f9dfde869825489382bc0d512c15e96d3964180c9499efcec72e85db7e/frozenlist-1.7.0-cp313-cp313-win32.whl", hash = "sha256:5fc4df05a6591c7768459caba1b342d9ec23fa16195e744939ba5914596ae3e1", size = 39169, upload-time = "2025-06-09T23:01:35.503Z" },
    { url = "https://files.pythonhosted.org/packages/35/89/a487a98d94205d85745080a37860ff5744b9820a2c9acbcdd9440bfddf98/frozenlist-1.7.0-cp313-cp313-win_amd64.whl", hash = "sha256:52109052b9791a3e6b5d1b65f4b909703984b770694d3eb64fad124c835d7cba", size = 43219, upload-time = "2025-06-09T23:01:36.784Z" },
    { url = "https://files.pythonhosted.org/packages/56/d5/5c4cf2319a49eddd9dd7145e66c4866bdc6f3dbc67ca3d59685149c11e0d/frozenlist-1.7.0-cp313-cp313t-macosx_10_13_universal2.whl", hash = "sha256:a6f86e4193bb0e235ef6ce3dde5cbabed887e0b11f516ce8a0f4d3b33078ec2d", size = 84345, upload-time = "2025-06-09T23:01:38.295Z" },
    { url = "https://files.pythonhosted.org/packages/a4/7d/ec2c1e1dc16b85bc9d526009961953df9cec8481b6886debb36ec9107799/frozenlist-1.7.0-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:82d664628865abeb32d90ae497fb93df398a69bb3434463d172b80fc25b0dd7d", size = 48880, upload-time = "2025-06-09T23:01:39.887Z" },
    { url = "https://files.pythonhosted.org/packages/69/86/f9596807b03de126e11e7d42ac91e3d0b19a6599c714a1989a4e85eeefc4/frozenlist-1.7.0-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:912a7e8375a1c9a68325a902f3953191b7b292aa3c3fb0d71a216221deca460b", size = 48498, upload-time = "2025-06-09T23:01:41.318Z" },
    { url = "https://files.pythonhosted.org/packages/5e/cb/df6de220f5036001005f2d726b789b2c0b65f2363b104bbc16f5be8084f8/frozenlist-1.7.0-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:9537c2777167488d539bc5de2ad262efc44388230e5118868e172dd4a552b146", size = 292296, upload-time = "2025-06-09T23:01:42.685Z" },
    { url = "https://files.pythonhosted.org/packages/83/1f/de84c642f17c8f851a2905cee2dae401e5e0daca9b5ef121e120e19aa825/frozenlist-1.7.0-cp313-cp313t-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:f34560fb1b4c3e30ba35fa9a13894ba39e5acfc5f60f57d8accde65f46cc5e74", size = 273103, upload-time = "2025-06-09T23:01:44.166Z" },
    { url = "https://files.pythonhosted.org/packages/88/3c/c840bfa474ba3fa13c772b93070893c6e9d5c0350885760376cbe3b6c1b3/frozenlist-1.7.0-cp313-cp313t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:acd03d224b0175f5a850edc104ac19040d35419eddad04e7cf2d5986d98427f1", size = 292869, upload-time = "2025-06-09T23:01:45.681Z" },
    { url = "https://files.pythonhosted.org/packages/a6/1c/3efa6e7d5a39a1d5ef0abeb51c48fb657765794a46cf124e5aca2c7a592c/frozenlist-1.7.0-cp313-cp313t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:f2038310bc582f3d6a09b3816ab01737d60bf7b1ec70f5356b09e84fb7408ab1", size = 291467, upload-time = "2025-06-09T23:01:47.234Z" },
    { url = "https://files.pythonhosted.org/packages/4f/00/d5c5e09d4922c395e2f2f6b79b9a20dab4b67daaf78ab92e7729341f61f6/frozenlist-1.7.0-cp313-cp313t-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:b8c05e4c8e5f36e5e088caa1bf78a687528f83c043706640a92cb76cd6999384", size = 266028, upload-time = "2025-06-09T23:01:48.819Z" },
    { url = "https://files.pythonhosted.org/packages/4e/27/72765be905619dfde25a7f33813ac0341eb6b076abede17a2e3fbfade0cb/frozenlist-1.7.0-cp313-cp313t-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:765bb588c86e47d0b68f23c1bee323d4b703218037765dcf3f25c838c6fecceb", size = 284294, upload-time = "2025-06-09T23:01:50.394Z" },
    { url = "https://files.pythonhosted.org/packages/88/67/c94103a23001b17808eb7dd1200c156bb69fb68e63fcf0693dde4cd6228c/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:32dc2e08c67d86d0969714dd484fd60ff08ff81d1a1e40a77dd34a387e6ebc0c", size = 281898, upload-time = "2025-06-09T23:01:52.234Z" },
    { url = "https://files.pythonhosted.org/packages/42/34/a3e2c00c00f9e2a9db5653bca3fec306349e71aff14ae45ecc6d0951dd24/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_armv7l.whl", hash = "sha256:c0303e597eb5a5321b4de9c68e9845ac8f290d2ab3f3e2c864437d3c5a30cd65", size = 290465, upload-time = "2025-06-09T23:01:53.788Z" },
    { url = "https://files.pythonhosted.org/packages/bb/73/f89b7fbce8b0b0c095d82b008afd0590f71ccb3dee6eee41791cf8cd25fd/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:a47f2abb4e29b3a8d0b530f7c3598badc6b134562b1a5caee867f7c62fee51e3", size = 266385, upload-time = "2025-06-09T23:01:55.769Z" },
    { url = "https://files.pythonhosted.org/packages/cd/45/e365fdb554159462ca12df54bc59bfa7a9a273ecc21e99e72e597564d1ae/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_ppc64le.whl", hash = "sha256:3d688126c242a6fabbd92e02633414d40f50bb6002fa4cf995a1d18051525657", size = 288771, upload-time = "2025-06-09T23:01:57.4Z" },
    { url = "https://files.pythonhosted.org/packages/00/11/47b6117002a0e904f004d70ec5194fe9144f117c33c851e3d51c765962d0/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_s390x.whl", hash = "sha256:4e7e9652b3d367c7bd449a727dc79d5043f48b88d0cbfd4f9f1060cf2b414104", size = 288206, upload-time = "2025-06-09T23:01:58.936Z" },
    { url = "https://files.pythonhosted.org/packages/40/37/5f9f3c3fd7f7746082ec67bcdc204db72dad081f4f83a503d33220a92973/frozenlist-1.7.0-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:1a85e345b4c43db8b842cab1feb41be5cc0b10a1830e6295b69d7310f99becaf", size = 282620, upload-time = "2025-06-09T23:02:00.493Z" },
    { url = "https://files.pythonhosted.org/packages/0b/31/8fbc5af2d183bff20f21aa743b4088eac4445d2bb1cdece449ae80e4e2d1/frozenlist-1.7.0-cp313-cp313t-win32.whl", hash = "sha256:3a14027124ddb70dfcee5148979998066897e79f89f64b13328595c4bdf77c81", size = 43059, upload-time = "2025-06-09T23:02:02.072Z" },
    { url = "https://files.pythonhosted.org/packages/bb/ed/41956f52105b8dbc26e457c5705340c67c8cc2b79f394b79bffc09d0e938/frozenlist-1.7.0-cp313-cp313t-win_amd64.whl", hash = "sha256:3bf8010d71d4507775f658e9823210b7427be36625b387221642725b515dcf3e", size = 47516, upload-time = "2025-06-09T23:02:03.779Z" },
    { url = "https://files.pythonhosted.org/packages/ee/45/b82e3c16be2182bff01179db177fe144d58b5dc787a7d4492c6ed8b9317f/frozenlist-1.7.0-py3-none-any.whl", hash = "sha256:9a5af342e34f7e97caf8c995864c7a396418ae2859cc6fdf1b1073020d516a7e", size = 13106, upload-time = "2025-06-09T23:02:34.204Z" },
]

[[package]]
name = "google-ai-generativelanguage"
version = "0.6.15"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-api-core", extra = ["grpc"] },
    { name = "google-auth" },
    { name = "proto-plus" },
    { name = "protobuf" },
]
sdist = { url = "https://files.pythonhosted.org/packages/11/d1/48fe5d7a43d278e9f6b5ada810b0a3530bbeac7ed7fcbcd366f932f05316/google_ai_generativelanguage-0.6.15.tar.gz", hash = "sha256:8f6d9dc4c12b065fe2d0289026171acea5183ebf2d0b11cefe12f3821e159ec3", size = 1375443, upload-time = "2025-01-13T21:50:47.459Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/7c/a3/67b8a6ff5001a1d8864922f2d6488dc2a14367ceb651bc3f09a947f2f306/google_ai_generativelanguage-0.6.15-py3-none-any.whl", hash = "sha256:5a03ef86377aa184ffef3662ca28f19eeee158733e45d7947982eb953c6ebb6c", size = 1327356, upload-time = "2025-01-13T21:50:44.174Z" },
]

[[package]]
name = "google-api-core"
version = "2.25.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-auth" },
    { name = "googleapis-common-protos" },
    { name = "proto-plus" },
    { name = "protobuf" },
    { name = "requests" },
]
sdist = { url = "https://files.pythonhosted.org/packages/dc/21/e9d043e88222317afdbdb567165fdbc3b0aad90064c7e0c9eb0ad9955ad8/google_api_core-2.25.1.tar.gz", hash = "sha256:d2aaa0b13c78c61cb3f4282c464c046e45fbd75755683c9c525e6e8f7ed0a5e8", size = 165443, upload-time = "2025-06-12T20:52:20.439Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/14/4b/ead00905132820b623732b175d66354e9d3e69fcf2a5dcdab780664e7896/google_api_core-2.25.1-py3-none-any.whl", hash = "sha256:8a2a56c1fef82987a524371f99f3bd0143702fecc670c72e600c1cda6bf8dbb7", size = 160807, upload-time = "2025-06-12T20:52:19.334Z" },
]

[package.optional-dependencies]
grpc = [
    { name = "grpcio" },
    { name = "grpcio-status" },
]

[[package]]
name = "google-api-python-client"
version = "2.176.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-api-core" },
    { name = "google-auth" },
    { name = "google-auth-httplib2" },
    { name = "httplib2" },
    { name = "uritemplate" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3e/38/daf70faf6d05556d382bac640bc6765f09fcfb9dfb51ac4a595d3453a2a9/google_api_python_client-2.176.0.tar.gz", hash = "sha256:2b451cdd7fd10faeb5dd20f7d992f185e1e8f4124c35f2cdcc77c843139a4cf1", size = 13154773, upload-time = "2025-07-08T18:07:10.354Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b1/2c/758f415a19a12c3c6d06902794b0dd4c521d912a59b98ab752bba48812df/google_api_python_client-2.176.0-py3-none-any.whl", hash = "sha256:e22239797f1d085341e12cd924591fc65c56d08e0af02549d7606092e6296510", size = 13678445, upload-time = "2025-07-08T18:07:07.799Z" },
]

[[package]]
name = "google-auth"
version = "2.40.3"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "cachetools" },
    { name = "pyasn1-modules" },
    { name = "rsa" },
]
sdist = { url = "https://files.pythonhosted.org/packages/9e/9b/e92ef23b84fa10a64ce4831390b7a4c2e53c0132568d99d4ae61d04c8855/google_auth-2.40.3.tar.gz", hash = "sha256:500c3a29adedeb36ea9cf24b8d10858e152f2412e3ca37829b3fa18e33d63b77", size = 281029, upload-time = "2025-06-04T18:04:57.577Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/17/63/b19553b658a1692443c62bd07e5868adaa0ad746a0751ba62c59568cd45b/google_auth-2.40.3-py2.py3-none-any.whl", hash = "sha256:1370d4593e86213563547f97a92752fc658456fe4514c809544f330fed45a7ca", size = 216137, upload-time = "2025-06-04T18:04:55.573Z" },
]

[[package]]
name = "google-auth-httplib2"
version = "0.2.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-auth" },
    { name = "httplib2" },
]
sdist = { url = "https://files.pythonhosted.org/packages/56/be/217a598a818567b28e859ff087f347475c807a5649296fb5a817c58dacef/google-auth-httplib2-0.2.0.tar.gz", hash = "sha256:38aa7badf48f974f1eb9861794e9c0cb2a0511a4ec0679b1f886d108f5640e05", size = 10842, upload-time = "2023-12-12T17:40:30.722Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/be/8a/fe34d2f3f9470a27b01c9e76226965863f153d5fbe276f83608562e49c04/google_auth_httplib2-0.2.0-py2.py3-none-any.whl", hash = "sha256:b65a0a2123300dd71281a7bf6e64d65a0759287df52729bdd1ae2e47dc311a3d", size = 9253, upload-time = "2023-12-12T17:40:13.055Z" },
]

[[package]]
name = "google-generativeai"
version = "0.8.5"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "google-ai-generativelanguage" },
    { name = "google-api-core" },
    { name = "google-api-python-client" },
    { name = "google-auth" },
    { name = "protobuf" },
    { name = "pydantic" },
    { name = "tqdm" },
    { name = "typing-extensions" },
]
wheels = [
    { url = "https://files.pythonhosted.org/packages/6e/40/c42ff9ded9f09ec9392879a8e6538a00b2dc185e834a3392917626255419/google_generativeai-0.8.5-py3-none-any.whl", hash = "sha256:22b420817fb263f8ed520b33285f45976d5b21e904da32b80d4fd20c055123a2", size = 155427, upload-time = "2025-04-17T00:40:00.67Z" },
]

[[package]]
name = "googleapis-common-protos"
version = "1.70.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "protobuf" },
]
sdist = { url = "https://files.pythonhosted.org/packages/39/24/33db22342cf4a2ea27c9955e6713140fedd51e8b141b5ce5260897020f1a/googleapis_common_protos-1.70.0.tar.gz", hash = "sha256:0e1b44e0ea153e6594f9f394fef15193a68aaaea2d843f83e2742717ca753257", size = 145903, upload-time = "2025-04-14T10:17:02.924Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/86/f1/62a193f0227cf15a920390abe675f386dec35f7ae3ffe6da582d3ade42c7/googleapis_common_protos-1.70.0-py3-none-any.whl", hash = "sha256:b8bfcca8c25a2bb253e0e0b0adaf8c00773e5e6af6fd92397576680b807e0fd8", size = 294530, upload-time = "2025-04-14T10:17:01.271Z" },
]

[[package]]
name = "gotrue"
version = "2.12.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "httpx", extra = ["http2"] },
    { name = "pydantic" },
    { name = "pyjwt" },
    { name = "pytest-mock" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3f/54/5d3befeb871bc91d83a87217e56c882a5c42dfa49ad7983e41de21ff557c/gotrue-2.12.2.tar.gz", hash = "sha256:9f23c4e45d5129c495867fd95ce14c4ebe5054b07d7449b01874332cb5c1f076", size = 38059, upload-time = "2025-06-23T21:21:35.225Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/9b/1d/6d5e3eaf663eaff0d3084eb2d370d7a7c0cf83d9d94a2bba1eaa50fe145e/gotrue-2.12.2-py3-none-any.whl", hash = "sha256:72443e106507545b2814f3c52d66c3b8f5eaf05c1e43b21b0fadf72742971406", size = 43968, upload-time = "2025-06-23T21:21:33.415Z" },
]

[[package]]
name = "grpcio"
version = "1.73.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/79/e8/b43b851537da2e2f03fa8be1aef207e5cbfb1a2e014fbb6b40d24c177cd3/grpcio-1.73.1.tar.gz", hash = "sha256:7fce2cd1c0c1116cf3850564ebfc3264fba75d3c74a7414373f1238ea365ef87", size = 12730355, upload-time = "2025-06-26T01:53:24.622Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b8/41/456caf570c55d5ac26f4c1f2db1f2ac1467d5bf3bcd660cba3e0a25b195f/grpcio-1.73.1-cp312-cp312-linux_armv7l.whl", hash = "sha256:921b25618b084e75d424a9f8e6403bfeb7abef074bb6c3174701e0f2542debcf", size = 5334621, upload-time = "2025-06-26T01:52:23.602Z" },
    { url = "https://files.pythonhosted.org/packages/2a/c2/9a15e179e49f235bb5e63b01590658c03747a43c9775e20c4e13ca04f4c4/grpcio-1.73.1-cp312-cp312-macosx_11_0_universal2.whl", hash = "sha256:277b426a0ed341e8447fbf6c1d6b68c952adddf585ea4685aa563de0f03df887", size = 10601131, upload-time = "2025-06-26T01:52:25.691Z" },
    { url = "https://files.pythonhosted.org/packages/0c/1d/1d39e90ef6348a0964caa7c5c4d05f3bae2c51ab429eb7d2e21198ac9b6d/grpcio-1.73.1-cp312-cp312-manylinux_2_17_aarch64.whl", hash = "sha256:96c112333309493c10e118d92f04594f9055774757f5d101b39f8150f8c25582", size = 5759268, upload-time = "2025-06-26T01:52:27.631Z" },
    { url = "https://files.pythonhosted.org/packages/8a/2b/2dfe9ae43de75616177bc576df4c36d6401e0959833b2e5b2d58d50c1f6b/grpcio-1.73.1-cp312-cp312-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:f48e862aed925ae987eb7084409a80985de75243389dc9d9c271dd711e589918", size = 6409791, upload-time = "2025-06-26T01:52:29.711Z" },
    { url = "https://files.pythonhosted.org/packages/6e/66/e8fe779b23b5a26d1b6949e5c70bc0a5fd08f61a6ec5ac7760d589229511/grpcio-1.73.1-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:83a6c2cce218e28f5040429835fa34a29319071079e3169f9543c3fbeff166d2", size = 6003728, upload-time = "2025-06-26T01:52:31.352Z" },
    { url = "https://files.pythonhosted.org/packages/a9/39/57a18fcef567784108c4fc3f5441cb9938ae5a51378505aafe81e8e15ecc/grpcio-1.73.1-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:65b0458a10b100d815a8426b1442bd17001fdb77ea13665b2f7dc9e8587fdc6b", size = 6103364, upload-time = "2025-06-26T01:52:33.028Z" },
    { url = "https://files.pythonhosted.org/packages/c5/46/28919d2aa038712fc399d02fa83e998abd8c1f46c2680c5689deca06d1b2/grpcio-1.73.1-cp312-cp312-musllinux_1_1_i686.whl", hash = "sha256:0a9f3ea8dce9eae9d7cb36827200133a72b37a63896e0e61a9d5ec7d61a59ab1", size = 6749194, upload-time = "2025-06-26T01:52:34.734Z" },
    { url = "https://files.pythonhosted.org/packages/3d/56/3898526f1fad588c5d19a29ea0a3a4996fb4fa7d7c02dc1be0c9fd188b62/grpcio-1.73.1-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:de18769aea47f18e782bf6819a37c1c528914bfd5683b8782b9da356506190c8", size = 6283902, upload-time = "2025-06-26T01:52:36.503Z" },
    { url = "https://files.pythonhosted.org/packages/dc/64/18b77b89c5870d8ea91818feb0c3ffb5b31b48d1b0ee3e0f0d539730fea3/grpcio-1.73.1-cp312-cp312-win32.whl", hash = "sha256:24e06a5319e33041e322d32c62b1e728f18ab8c9dbc91729a3d9f9e3ed336642", size = 3668687, upload-time = "2025-06-26T01:52:38.678Z" },
    { url = "https://files.pythonhosted.org/packages/3c/52/302448ca6e52f2a77166b2e2ed75f5d08feca4f2145faf75cb768cccb25b/grpcio-1.73.1-cp312-cp312-win_amd64.whl", hash = "sha256:303c8135d8ab176f8038c14cc10d698ae1db9c480f2b2823f7a987aa2a4c5646", size = 4334887, upload-time = "2025-06-26T01:52:40.743Z" },
    { url = "https://files.pythonhosted.org/packages/37/bf/4ca20d1acbefabcaba633ab17f4244cbbe8eca877df01517207bd6655914/grpcio-1.73.1-cp313-cp313-linux_armv7l.whl", hash = "sha256:b310824ab5092cf74750ebd8a8a8981c1810cb2b363210e70d06ef37ad80d4f9", size = 5335615, upload-time = "2025-06-26T01:52:42.896Z" },
    { url = "https://files.pythonhosted.org/packages/75/ed/45c345f284abec5d4f6d77cbca9c52c39b554397eb7de7d2fcf440bcd049/grpcio-1.73.1-cp313-cp313-macosx_11_0_universal2.whl", hash = "sha256:8f5a6df3fba31a3485096ac85b2e34b9666ffb0590df0cd044f58694e6a1f6b5", size = 10595497, upload-time = "2025-06-26T01:52:44.695Z" },
    { url = "https://files.pythonhosted.org/packages/a4/75/bff2c2728018f546d812b755455014bc718f8cdcbf5c84f1f6e5494443a8/grpcio-1.73.1-cp313-cp313-manylinux_2_17_aarch64.whl", hash = "sha256:052e28fe9c41357da42250a91926a3e2f74c046575c070b69659467ca5aa976b", size = 5765321, upload-time = "2025-06-26T01:52:46.871Z" },
    { url = "https://files.pythonhosted.org/packages/70/3b/14e43158d3b81a38251b1d231dfb45a9b492d872102a919fbf7ba4ac20cd/grpcio-1.73.1-cp313-cp313-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:1c0bf15f629b1497436596b1cbddddfa3234273490229ca29561209778ebe182", size = 6415436, upload-time = "2025-06-26T01:52:49.134Z" },
    { url = "https://files.pythonhosted.org/packages/e5/3f/81d9650ca40b54338336fd360f36773be8cb6c07c036e751d8996eb96598/grpcio-1.73.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:0ab860d5bfa788c5a021fba264802e2593688cd965d1374d31d2b1a34cacd854", size = 6007012, upload-time = "2025-06-26T01:52:51.076Z" },
    { url = "https://files.pythonhosted.org/packages/55/f4/59edf5af68d684d0f4f7ad9462a418ac517201c238551529098c9aa28cb0/grpcio-1.73.1-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:ad1d958c31cc91ab050bd8a91355480b8e0683e21176522bacea225ce51163f2", size = 6105209, upload-time = "2025-06-26T01:52:52.773Z" },
    { url = "https://files.pythonhosted.org/packages/e4/a8/700d034d5d0786a5ba14bfa9ce974ed4c976936c2748c2bd87aa50f69b36/grpcio-1.73.1-cp313-cp313-musllinux_1_1_i686.whl", hash = "sha256:f43ffb3bd415c57224c7427bfb9e6c46a0b6e998754bfa0d00f408e1873dcbb5", size = 6753655, upload-time = "2025-06-26T01:52:55.064Z" },
    { url = "https://files.pythonhosted.org/packages/1f/29/efbd4ac837c23bc48e34bbaf32bd429f0dc9ad7f80721cdb4622144c118c/grpcio-1.73.1-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:686231cdd03a8a8055f798b2b54b19428cdf18fa1549bee92249b43607c42668", size = 6287288, upload-time = "2025-06-26T01:52:57.33Z" },
    { url = "https://files.pythonhosted.org/packages/d8/61/c6045d2ce16624bbe18b5d169c1a5ce4d6c3a47bc9d0e5c4fa6a50ed1239/grpcio-1.73.1-cp313-cp313-win32.whl", hash = "sha256:89018866a096e2ce21e05eabed1567479713ebe57b1db7cbb0f1e3b896793ba4", size = 3668151, upload-time = "2025-06-26T01:52:59.405Z" },
    { url = "https://files.pythonhosted.org/packages/c2/d7/77ac689216daee10de318db5aa1b88d159432dc76a130948a56b3aa671a2/grpcio-1.73.1-cp313-cp313-win_amd64.whl", hash = "sha256:4a68f8c9966b94dff693670a5cf2b54888a48a5011c5d9ce2295a1a1465ee84f", size = 4335747, upload-time = "2025-06-26T01:53:01.233Z" },
]

[[package]]
name = "grpcio-status"
version = "1.71.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "googleapis-common-protos" },
    { name = "grpcio" },
    { name = "protobuf" },
]
sdist = { url = "https://files.pythonhosted.org/packages/fd/d1/b6e9877fedae3add1afdeae1f89d1927d296da9cf977eca0eb08fb8a460e/grpcio_status-1.71.2.tar.gz", hash = "sha256:c7a97e176df71cdc2c179cd1847d7fc86cca5832ad12e9798d7fed6b7a1aab50", size = 13677, upload-time = "2025-06-28T04:24:05.426Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/67/58/317b0134129b556a93a3b0afe00ee675b5657f0155509e22fcb853bafe2d/grpcio_status-1.71.2-py3-none-any.whl", hash = "sha256:803c98cb6a8b7dc6dbb785b1111aed739f241ab5e9da0bba96888aa74704cfd3", size = 14424, upload-time = "2025-06-28T04:23:42.136Z" },
]

[[package]]
name = "h11"
version = "0.16.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/01/ee/02a2c011bdab74c6fb3c75474d40b3052059d95df7e73351460c8588d963/h11-0.16.0.tar.gz", hash = "sha256:4e35b956cf45792e4caa5885e69fba00bdbc6ffafbfa020300e549b208ee5ff1", size = 101250, upload-time = "2025-04-24T03:35:25.427Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/04/4b/29cac41a4d98d144bf5f6d33995617b185d14b22401f75ca86f384e87ff1/h11-0.16.0-py3-none-any.whl", hash = "sha256:63cf8bbe7522de3bf65932fda1d9c2772064ffb3dae62d55932da54b31cb6c86", size = 37515, upload-time = "2025-04-24T03:35:24.344Z" },
]

[[package]]
name = "h2"
version = "4.2.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "hpack" },
    { name = "hyperframe" },
]
sdist = { url = "https://files.pythonhosted.org/packages/1b/38/d7f80fd13e6582fb8e0df8c9a653dcc02b03ca34f4d72f34869298c5baf8/h2-4.2.0.tar.gz", hash = "sha256:c8a52129695e88b1a0578d8d2cc6842bbd79128ac685463b887ee278126ad01f", size = 2150682, upload-time = "2025-02-02T07:43:51.815Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d0/9e/984486f2d0a0bd2b024bf4bc1c62688fcafa9e61991f041fb0e2def4a982/h2-4.2.0-py3-none-any.whl", hash = "sha256:479a53ad425bb29af087f3458a61d30780bc818e4ebcf01f0b536ba916462ed0", size = 60957, upload-time = "2025-02-01T11:02:26.481Z" },
]

[[package]]
name = "hpack"
version = "4.1.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/2c/48/71de9ed269fdae9c8057e5a4c0aa7402e8bb16f2c6e90b3aa53327b113f8/hpack-4.1.0.tar.gz", hash = "sha256:ec5eca154f7056aa06f196a557655c5b009b382873ac8d1e66e79e87535f1dca", size = 51276, upload-time = "2025-01-22T21:44:58.347Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/07/c6/80c95b1b2b94682a72cbdbfb85b81ae2daffa4291fbfa1b1464502ede10d/hpack-4.1.0-py3-none-any.whl", hash = "sha256:157ac792668d995c657d93111f46b4535ed114f0c9c8d672271bbec7eae1b496", size = 34357, upload-time = "2025-01-22T21:44:56.92Z" },
]

[[package]]
name = "httpcore"
version = "1.0.9"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "certifi" },
    { name = "h11" },
]
sdist = { url = "https://files.pythonhosted.org/packages/06/94/82699a10bca87a5556c9c59b5963f2d039dbd239f25bc2a63907a05a14cb/httpcore-1.0.9.tar.gz", hash = "sha256:6e34463af53fd2ab5d807f399a9b45ea31c3dfa2276f15a2c3f00afff6e176e8", size = 85484, upload-time = "2025-04-24T22:06:22.219Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/7e/f5/f66802a942d491edb555dd61e3a9961140fd64c90bce1eafd741609d334d/httpcore-1.0.9-py3-none-any.whl", hash = "sha256:2d400746a40668fc9dec9810239072b40b4484b640a8c38fd654a024c7a1bf55", size = 78784, upload-time = "2025-04-24T22:06:20.566Z" },
]

[[package]]
name = "httplib2"
version = "0.22.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pyparsing" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3d/ad/2371116b22d616c194aa25ec410c9c6c37f23599dcd590502b74db197584/httplib2-0.22.0.tar.gz", hash = "sha256:d7a10bc5ef5ab08322488bde8c726eeee5c8618723fdb399597ec58f3d82df81", size = 351116, upload-time = "2023-03-21T22:29:37.214Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a8/6c/d2fbdaaa5959339d53ba38e94c123e4e84b8fbc4b84beb0e70d7c1608486/httplib2-0.22.0-py3-none-any.whl", hash = "sha256:14ae0a53c1ba8f3d37e9e27cf37eabb0fb9980f435ba405d546948b009dd64dc", size = 96854, upload-time = "2023-03-21T22:29:35.683Z" },
]

[[package]]
name = "httptools"
version = "0.6.4"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/a7/9a/ce5e1f7e131522e6d3426e8e7a490b3a01f39a6696602e1c4f33f9e94277/httptools-0.6.4.tar.gz", hash = "sha256:4e93eee4add6493b59a5c514da98c939b244fce4a0d8879cd3f466562f4b7d5c", size = 240639, upload-time = "2024-10-16T19:45:08.902Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/bb/0e/d0b71465c66b9185f90a091ab36389a7352985fe857e352801c39d6127c8/httptools-0.6.4-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:df017d6c780287d5c80601dafa31f17bddb170232d85c066604d8558683711a2", size = 200683, upload-time = "2024-10-16T19:44:30.175Z" },
    { url = "https://files.pythonhosted.org/packages/e2/b8/412a9bb28d0a8988de3296e01efa0bd62068b33856cdda47fe1b5e890954/httptools-0.6.4-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:85071a1e8c2d051b507161f6c3e26155b5c790e4e28d7f236422dbacc2a9cc44", size = 104337, upload-time = "2024-10-16T19:44:31.786Z" },
    { url = "https://files.pythonhosted.org/packages/9b/01/6fb20be3196ffdc8eeec4e653bc2a275eca7f36634c86302242c4fbb2760/httptools-0.6.4-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:69422b7f458c5af875922cdb5bd586cc1f1033295aa9ff63ee196a87519ac8e1", size = 508796, upload-time = "2024-10-16T19:44:32.825Z" },
    { url = "https://files.pythonhosted.org/packages/f7/d8/b644c44acc1368938317d76ac991c9bba1166311880bcc0ac297cb9d6bd7/httptools-0.6.4-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:16e603a3bff50db08cd578d54f07032ca1631450ceb972c2f834c2b860c28ea2", size = 510837, upload-time = "2024-10-16T19:44:33.974Z" },
    { url = "https://files.pythonhosted.org/packages/52/d8/254d16a31d543073a0e57f1c329ca7378d8924e7e292eda72d0064987486/httptools-0.6.4-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:ec4f178901fa1834d4a060320d2f3abc5c9e39766953d038f1458cb885f47e81", size = 485289, upload-time = "2024-10-16T19:44:35.111Z" },
    { url = "https://files.pythonhosted.org/packages/5f/3c/4aee161b4b7a971660b8be71a92c24d6c64372c1ab3ae7f366b3680df20f/httptools-0.6.4-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:f9eb89ecf8b290f2e293325c646a211ff1c2493222798bb80a530c5e7502494f", size = 489779, upload-time = "2024-10-16T19:44:36.253Z" },
    { url = "https://files.pythonhosted.org/packages/12/b7/5cae71a8868e555f3f67a50ee7f673ce36eac970f029c0c5e9d584352961/httptools-0.6.4-cp312-cp312-win_amd64.whl", hash = "sha256:db78cb9ca56b59b016e64b6031eda5653be0589dba2b1b43453f6e8b405a0970", size = 88634, upload-time = "2024-10-16T19:44:37.357Z" },
    { url = "https://files.pythonhosted.org/packages/94/a3/9fe9ad23fd35f7de6b91eeb60848986058bd8b5a5c1e256f5860a160cc3e/httptools-0.6.4-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:ade273d7e767d5fae13fa637f4d53b6e961fb7fd93c7797562663f0171c26660", size = 197214, upload-time = "2024-10-16T19:44:38.738Z" },
    { url = "https://files.pythonhosted.org/packages/ea/d9/82d5e68bab783b632023f2fa31db20bebb4e89dfc4d2293945fd68484ee4/httptools-0.6.4-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:856f4bc0478ae143bad54a4242fccb1f3f86a6e1be5548fecfd4102061b3a083", size = 102431, upload-time = "2024-10-16T19:44:39.818Z" },
    { url = "https://files.pythonhosted.org/packages/96/c1/cb499655cbdbfb57b577734fde02f6fa0bbc3fe9fb4d87b742b512908dff/httptools-0.6.4-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:322d20ea9cdd1fa98bd6a74b77e2ec5b818abdc3d36695ab402a0de8ef2865a3", size = 473121, upload-time = "2024-10-16T19:44:41.189Z" },
    { url = "https://files.pythonhosted.org/packages/af/71/ee32fd358f8a3bb199b03261f10921716990808a675d8160b5383487a317/httptools-0.6.4-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:4d87b29bd4486c0093fc64dea80231f7c7f7eb4dc70ae394d70a495ab8436071", size = 473805, upload-time = "2024-10-16T19:44:42.384Z" },
    { url = "https://files.pythonhosted.org/packages/8a/0a/0d4df132bfca1507114198b766f1737d57580c9ad1cf93c1ff673e3387be/httptools-0.6.4-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:342dd6946aa6bda4b8f18c734576106b8a31f2fe31492881a9a160ec84ff4bd5", size = 448858, upload-time = "2024-10-16T19:44:43.959Z" },
    { url = "https://files.pythonhosted.org/packages/1e/6a/787004fdef2cabea27bad1073bf6a33f2437b4dbd3b6fb4a9d71172b1c7c/httptools-0.6.4-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:4b36913ba52008249223042dca46e69967985fb4051951f94357ea681e1f5dc0", size = 452042, upload-time = "2024-10-16T19:44:45.071Z" },
    { url = "https://files.pythonhosted.org/packages/4d/dc/7decab5c404d1d2cdc1bb330b1bf70e83d6af0396fd4fc76fc60c0d522bf/httptools-0.6.4-cp313-cp313-win_amd64.whl", hash = "sha256:28908df1b9bb8187393d5b5db91435ccc9c8e891657f9cbb42a2541b44c82fc8", size = 87682, upload-time = "2024-10-16T19:44:46.46Z" },
]

[[package]]
name = "httpx"
version = "0.28.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "anyio" },
    { name = "certifi" },
    { name = "httpcore" },
    { name = "idna" },
]
sdist = { url = "https://files.pythonhosted.org/packages/b1/df/48c586a5fe32a0f01324ee087459e112ebb7224f646c0b5023f5e79e9956/httpx-0.28.1.tar.gz", hash = "sha256:75e98c5f16b0f35b567856f597f06ff2270a374470a5c2392242528e3e3e42fc", size = 141406, upload-time = "2024-12-06T15:37:23.222Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/2a/39/e50c7c3a983047577ee07d2a9e53faf5a69493943ec3f6a384bdc792deb2/httpx-0.28.1-py3-none-any.whl", hash = "sha256:d909fcccc110f8c7faf814ca82a9a4d816bc5a6dbfea25d6591d6985b8ba59ad", size = 73517, upload-time = "2024-12-06T15:37:21.509Z" },
]

[package.optional-dependencies]
http2 = [
    { name = "h2" },
]

[[package]]
name = "hyperframe"
version = "6.1.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/02/e7/94f8232d4a74cc99514c13a9f995811485a6903d48e5d952771ef6322e30/hyperframe-6.1.0.tar.gz", hash = "sha256:f630908a00854a7adeabd6382b43923a4c4cd4b821fcb527e6ab9e15382a3b08", size = 26566, upload-time = "2025-01-22T21:41:49.302Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/48/30/47d0bf6072f7252e6521f3447ccfa40b421b6824517f82854703d0f5a98b/hyperframe-6.1.0-py3-none-any.whl", hash = "sha256:b03380493a519fce58ea5af42e4a42317bf9bd425596f7a0835ffce80f1a42e5", size = 13007, upload-time = "2025-01-22T21:41:47.295Z" },
]

[[package]]
name = "idna"
version = "3.10"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f1/70/7703c29685631f5a7590aa73f1f1d3fa9a380e654b86af429e0934a32f7d/idna-3.10.tar.gz", hash = "sha256:12f65c9b470abda6dc35cf8e63cc574b1c52b11df2c86030af0ac09b01b13ea9", size = 190490, upload-time = "2024-09-15T18:07:39.745Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/76/c6/c88e154df9c4e1a2a66ccf0005a88dfb2650c1dffb6f5ce603dfbd452ce3/idna-3.10-py3-none-any.whl", hash = "sha256:946d195a0d259cbba61165e88e65941f16e9b36ea6ddb97f00452bae8b1287d3", size = 70442, upload-time = "2024-09-15T18:07:37.964Z" },
]

[[package]]
name = "iniconfig"
version = "2.1.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f2/97/ebf4da567aa6827c909642694d71c9fcf53e5b504f2d96afea02718862f3/iniconfig-2.1.0.tar.gz", hash = "sha256:3abbd2e30b36733fee78f9c7f7308f2d0050e88f0087fd25c2645f63c773e1c7", size = 4793, upload-time = "2025-03-19T20:09:59.721Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/2c/e1/e6716421ea10d38022b952c159d5161ca1193197fb744506875fbb87ea7b/iniconfig-2.1.0-py3-none-any.whl", hash = "sha256:9deba5723312380e77435581c6bf4935c94cbfab9b1ed33ef8d238ea168eb760", size = 6050, upload-time = "2025-03-19T20:10:01.071Z" },
]

[[package]]
name = "jiter"
version = "0.10.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/ee/9d/ae7ddb4b8ab3fb1b51faf4deb36cb48a4fbbd7cb36bad6a5fca4741306f7/jiter-0.10.0.tar.gz", hash = "sha256:07a7142c38aacc85194391108dc91b5b57093c978a9932bd86a36862759d9500", size = 162759, upload-time = "2025-05-18T19:04:59.73Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/6d/b5/348b3313c58f5fbfb2194eb4d07e46a35748ba6e5b3b3046143f3040bafa/jiter-0.10.0-cp312-cp312-macosx_10_12_x86_64.whl", hash = "sha256:1e274728e4a5345a6dde2d343c8da018b9d4bd4350f5a472fa91f66fda44911b", size = 312262, upload-time = "2025-05-18T19:03:44.637Z" },
    { url = "https://files.pythonhosted.org/packages/9c/4a/6a2397096162b21645162825f058d1709a02965606e537e3304b02742e9b/jiter-0.10.0-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:7202ae396446c988cb2a5feb33a543ab2165b786ac97f53b59aafb803fef0744", size = 320124, upload-time = "2025-05-18T19:03:46.341Z" },
    { url = "https://files.pythonhosted.org/packages/2a/85/1ce02cade7516b726dd88f59a4ee46914bf79d1676d1228ef2002ed2f1c9/jiter-0.10.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:23ba7722d6748b6920ed02a8f1726fb4b33e0fd2f3f621816a8b486c66410ab2", size = 345330, upload-time = "2025-05-18T19:03:47.596Z" },
    { url = "https://files.pythonhosted.org/packages/75/d0/bb6b4f209a77190ce10ea8d7e50bf3725fc16d3372d0a9f11985a2b23eff/jiter-0.10.0-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:371eab43c0a288537d30e1f0b193bc4eca90439fc08a022dd83e5e07500ed026", size = 369670, upload-time = "2025-05-18T19:03:49.334Z" },
    { url = "https://files.pythonhosted.org/packages/a0/f5/a61787da9b8847a601e6827fbc42ecb12be2c925ced3252c8ffcb56afcaf/jiter-0.10.0-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:6c675736059020365cebc845a820214765162728b51ab1e03a1b7b3abb70f74c", size = 489057, upload-time = "2025-05-18T19:03:50.66Z" },
    { url = "https://files.pythonhosted.org/packages/12/e4/6f906272810a7b21406c760a53aadbe52e99ee070fc5c0cb191e316de30b/jiter-0.10.0-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:0c5867d40ab716e4684858e4887489685968a47e3ba222e44cde6e4a2154f959", size = 389372, upload-time = "2025-05-18T19:03:51.98Z" },
    { url = "https://files.pythonhosted.org/packages/e2/ba/77013b0b8ba904bf3762f11e0129b8928bff7f978a81838dfcc958ad5728/jiter-0.10.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:395bb9a26111b60141757d874d27fdea01b17e8fac958b91c20128ba8f4acc8a", size = 352038, upload-time = "2025-05-18T19:03:53.703Z" },
    { url = "https://files.pythonhosted.org/packages/67/27/c62568e3ccb03368dbcc44a1ef3a423cb86778a4389e995125d3d1aaa0a4/jiter-0.10.0-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:6842184aed5cdb07e0c7e20e5bdcfafe33515ee1741a6835353bb45fe5d1bd95", size = 391538, upload-time = "2025-05-18T19:03:55.046Z" },
    { url = "https://files.pythonhosted.org/packages/c0/72/0d6b7e31fc17a8fdce76164884edef0698ba556b8eb0af9546ae1a06b91d/jiter-0.10.0-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:62755d1bcea9876770d4df713d82606c8c1a3dca88ff39046b85a048566d56ea", size = 523557, upload-time = "2025-05-18T19:03:56.386Z" },
    { url = "https://files.pythonhosted.org/packages/2f/09/bc1661fbbcbeb6244bd2904ff3a06f340aa77a2b94e5a7373fd165960ea3/jiter-0.10.0-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:533efbce2cacec78d5ba73a41756beff8431dfa1694b6346ce7af3a12c42202b", size = 514202, upload-time = "2025-05-18T19:03:57.675Z" },
    { url = "https://files.pythonhosted.org/packages/1b/84/5a5d5400e9d4d54b8004c9673bbe4403928a00d28529ff35b19e9d176b19/jiter-0.10.0-cp312-cp312-win32.whl", hash = "sha256:8be921f0cadd245e981b964dfbcd6fd4bc4e254cdc069490416dd7a2632ecc01", size = 211781, upload-time = "2025-05-18T19:03:59.025Z" },
    { url = "https://files.pythonhosted.org/packages/9b/52/7ec47455e26f2d6e5f2ea4951a0652c06e5b995c291f723973ae9e724a65/jiter-0.10.0-cp312-cp312-win_amd64.whl", hash = "sha256:a7c7d785ae9dda68c2678532a5a1581347e9c15362ae9f6e68f3fdbfb64f2e49", size = 206176, upload-time = "2025-05-18T19:04:00.305Z" },
    { url = "https://files.pythonhosted.org/packages/2e/b0/279597e7a270e8d22623fea6c5d4eeac328e7d95c236ed51a2b884c54f70/jiter-0.10.0-cp313-cp313-macosx_10_12_x86_64.whl", hash = "sha256:e0588107ec8e11b6f5ef0e0d656fb2803ac6cf94a96b2b9fc675c0e3ab5e8644", size = 311617, upload-time = "2025-05-18T19:04:02.078Z" },
    { url = "https://files.pythonhosted.org/packages/91/e3/0916334936f356d605f54cc164af4060e3e7094364add445a3bc79335d46/jiter-0.10.0-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:cafc4628b616dc32530c20ee53d71589816cf385dd9449633e910d596b1f5c8a", size = 318947, upload-time = "2025-05-18T19:04:03.347Z" },
    { url = "https://files.pythonhosted.org/packages/6a/8e/fd94e8c02d0e94539b7d669a7ebbd2776e51f329bb2c84d4385e8063a2ad/jiter-0.10.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:520ef6d981172693786a49ff5b09eda72a42e539f14788124a07530f785c3ad6", size = 344618, upload-time = "2025-05-18T19:04:04.709Z" },
    { url = "https://files.pythonhosted.org/packages/6f/b0/f9f0a2ec42c6e9c2e61c327824687f1e2415b767e1089c1d9135f43816bd/jiter-0.10.0-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:554dedfd05937f8fc45d17ebdf298fe7e0c77458232bcb73d9fbbf4c6455f5b3", size = 368829, upload-time = "2025-05-18T19:04:06.912Z" },
    { url = "https://files.pythonhosted.org/packages/e8/57/5bbcd5331910595ad53b9fd0c610392ac68692176f05ae48d6ce5c852967/jiter-0.10.0-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:5bc299da7789deacf95f64052d97f75c16d4fc8c4c214a22bf8d859a4288a1c2", size = 491034, upload-time = "2025-05-18T19:04:08.222Z" },
    { url = "https://files.pythonhosted.org/packages/9b/be/c393df00e6e6e9e623a73551774449f2f23b6ec6a502a3297aeeece2c65a/jiter-0.10.0-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:5161e201172de298a8a1baad95eb85db4fb90e902353b1f6a41d64ea64644e25", size = 388529, upload-time = "2025-05-18T19:04:09.566Z" },
    { url = "https://files.pythonhosted.org/packages/42/3e/df2235c54d365434c7f150b986a6e35f41ebdc2f95acea3036d99613025d/jiter-0.10.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:2e2227db6ba93cb3e2bf67c87e594adde0609f146344e8207e8730364db27041", size = 350671, upload-time = "2025-05-18T19:04:10.98Z" },
    { url = "https://files.pythonhosted.org/packages/c6/77/71b0b24cbcc28f55ab4dbfe029f9a5b73aeadaba677843fc6dc9ed2b1d0a/jiter-0.10.0-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:15acb267ea5e2c64515574b06a8bf393fbfee6a50eb1673614aa45f4613c0cca", size = 390864, upload-time = "2025-05-18T19:04:12.722Z" },
    { url = "https://files.pythonhosted.org/packages/6a/d3/ef774b6969b9b6178e1d1e7a89a3bd37d241f3d3ec5f8deb37bbd203714a/jiter-0.10.0-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:901b92f2e2947dc6dfcb52fd624453862e16665ea909a08398dde19c0731b7f4", size = 522989, upload-time = "2025-05-18T19:04:14.261Z" },
    { url = "https://files.pythonhosted.org/packages/0c/41/9becdb1d8dd5d854142f45a9d71949ed7e87a8e312b0bede2de849388cb9/jiter-0.10.0-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:d0cb9a125d5a3ec971a094a845eadde2db0de85b33c9f13eb94a0c63d463879e", size = 513495, upload-time = "2025-05-18T19:04:15.603Z" },
    { url = "https://files.pythonhosted.org/packages/9c/36/3468e5a18238bdedae7c4d19461265b5e9b8e288d3f86cd89d00cbb48686/jiter-0.10.0-cp313-cp313-win32.whl", hash = "sha256:48a403277ad1ee208fb930bdf91745e4d2d6e47253eedc96e2559d1e6527006d", size = 211289, upload-time = "2025-05-18T19:04:17.541Z" },
    { url = "https://files.pythonhosted.org/packages/7e/07/1c96b623128bcb913706e294adb5f768fb7baf8db5e1338ce7b4ee8c78ef/jiter-0.10.0-cp313-cp313-win_amd64.whl", hash = "sha256:75f9eb72ecb640619c29bf714e78c9c46c9c4eaafd644bf78577ede459f330d4", size = 205074, upload-time = "2025-05-18T19:04:19.21Z" },
    { url = "https://files.pythonhosted.org/packages/54/46/caa2c1342655f57d8f0f2519774c6d67132205909c65e9aa8255e1d7b4f4/jiter-0.10.0-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:28ed2a4c05a1f32ef0e1d24c2611330219fed727dae01789f4a335617634b1ca", size = 318225, upload-time = "2025-05-18T19:04:20.583Z" },
    { url = "https://files.pythonhosted.org/packages/43/84/c7d44c75767e18946219ba2d703a5a32ab37b0bc21886a97bc6062e4da42/jiter-0.10.0-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:14a4c418b1ec86a195f1ca69da8b23e8926c752b685af665ce30777233dfe070", size = 350235, upload-time = "2025-05-18T19:04:22.363Z" },
    { url = "https://files.pythonhosted.org/packages/01/16/f5a0135ccd968b480daad0e6ab34b0c7c5ba3bc447e5088152696140dcb3/jiter-0.10.0-cp313-cp313t-win_amd64.whl", hash = "sha256:d7bfed2fe1fe0e4dda6ef682cee888ba444b21e7a6553e03252e4feb6cf0adca", size = 207278, upload-time = "2025-05-18T19:04:23.627Z" },
    { url = "https://files.pythonhosted.org/packages/1c/9b/1d646da42c3de6c2188fdaa15bce8ecb22b635904fc68be025e21249ba44/jiter-0.10.0-cp314-cp314-macosx_10_12_x86_64.whl", hash = "sha256:5e9251a5e83fab8d87799d3e1a46cb4b7f2919b895c6f4483629ed2446f66522", size = 310866, upload-time = "2025-05-18T19:04:24.891Z" },
    { url = "https://files.pythonhosted.org/packages/ad/0e/26538b158e8a7c7987e94e7aeb2999e2e82b1f9d2e1f6e9874ddf71ebda0/jiter-0.10.0-cp314-cp314-macosx_11_0_arm64.whl", hash = "sha256:023aa0204126fe5b87ccbcd75c8a0d0261b9abdbbf46d55e7ae9f8e22424eeb8", size = 318772, upload-time = "2025-05-18T19:04:26.161Z" },
    { url = "https://files.pythonhosted.org/packages/7b/fb/d302893151caa1c2636d6574d213e4b34e31fd077af6050a9c5cbb42f6fb/jiter-0.10.0-cp314-cp314-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:3c189c4f1779c05f75fc17c0c1267594ed918996a231593a21a5ca5438445216", size = 344534, upload-time = "2025-05-18T19:04:27.495Z" },
    { url = "https://files.pythonhosted.org/packages/01/d8/5780b64a149d74e347c5128d82176eb1e3241b1391ac07935693466d6219/jiter-0.10.0-cp314-cp314-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:15720084d90d1098ca0229352607cd68256c76991f6b374af96f36920eae13c4", size = 369087, upload-time = "2025-05-18T19:04:28.896Z" },
    { url = "https://files.pythonhosted.org/packages/e8/5b/f235a1437445160e777544f3ade57544daf96ba7e96c1a5b24a6f7ac7004/jiter-0.10.0-cp314-cp314-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:e4f2fb68e5f1cfee30e2b2a09549a00683e0fde4c6a2ab88c94072fc33cb7426", size = 490694, upload-time = "2025-05-18T19:04:30.183Z" },
    { url = "https://files.pythonhosted.org/packages/85/a9/9c3d4617caa2ff89cf61b41e83820c27ebb3f7b5fae8a72901e8cd6ff9be/jiter-0.10.0-cp314-cp314-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:ce541693355fc6da424c08b7edf39a2895f58d6ea17d92cc2b168d20907dee12", size = 388992, upload-time = "2025-05-18T19:04:32.028Z" },
    { url = "https://files.pythonhosted.org/packages/68/b1/344fd14049ba5c94526540af7eb661871f9c54d5f5601ff41a959b9a0bbd/jiter-0.10.0-cp314-cp314-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:31c50c40272e189d50006ad5c73883caabb73d4e9748a688b216e85a9a9ca3b9", size = 351723, upload-time = "2025-05-18T19:04:33.467Z" },
    { url = "https://files.pythonhosted.org/packages/41/89/4c0e345041186f82a31aee7b9d4219a910df672b9fef26f129f0cda07a29/jiter-0.10.0-cp314-cp314-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:fa3402a2ff9815960e0372a47b75c76979d74402448509ccd49a275fa983ef8a", size = 392215, upload-time = "2025-05-18T19:04:34.827Z" },
    { url = "https://files.pythonhosted.org/packages/55/58/ee607863e18d3f895feb802154a2177d7e823a7103f000df182e0f718b38/jiter-0.10.0-cp314-cp314-musllinux_1_1_aarch64.whl", hash = "sha256:1956f934dca32d7bb647ea21d06d93ca40868b505c228556d3373cbd255ce853", size = 522762, upload-time = "2025-05-18T19:04:36.19Z" },
    { url = "https://files.pythonhosted.org/packages/15/d0/9123fb41825490d16929e73c212de9a42913d68324a8ce3c8476cae7ac9d/jiter-0.10.0-cp314-cp314-musllinux_1_1_x86_64.whl", hash = "sha256:fcedb049bdfc555e261d6f65a6abe1d5ad68825b7202ccb9692636c70fcced86", size = 513427, upload-time = "2025-05-18T19:04:37.544Z" },
    { url = "https://files.pythonhosted.org/packages/d8/b3/2bd02071c5a2430d0b70403a34411fc519c2f227da7b03da9ba6a956f931/jiter-0.10.0-cp314-cp314-win32.whl", hash = "sha256:ac509f7eccca54b2a29daeb516fb95b6f0bd0d0d8084efaf8ed5dfc7b9f0b357", size = 210127, upload-time = "2025-05-18T19:04:38.837Z" },
    { url = "https://files.pythonhosted.org/packages/03/0c/5fe86614ea050c3ecd728ab4035534387cd41e7c1855ef6c031f1ca93e3f/jiter-0.10.0-cp314-cp314t-macosx_11_0_arm64.whl", hash = "sha256:5ed975b83a2b8639356151cef5c0d597c68376fc4922b45d0eb384ac058cfa00", size = 318527, upload-time = "2025-05-18T19:04:40.612Z" },
    { url = "https://files.pythonhosted.org/packages/b3/4a/4175a563579e884192ba6e81725fc0448b042024419be8d83aa8a80a3f44/jiter-0.10.0-cp314-cp314t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:3aa96f2abba33dc77f79b4cf791840230375f9534e5fac927ccceb58c5e604a5", size = 354213, upload-time = "2025-05-18T19:04:41.894Z" },
]

[[package]]
name = "loguru"
version = "0.7.3"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
    { name = "win32-setctime", marker = "sys_platform == 'win32'" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3a/05/a1dae3dffd1116099471c643b8924f5aa6524411dc6c63fdae648c4f1aca/loguru-0.7.3.tar.gz", hash = "sha256:19480589e77d47b8d85b2c827ad95d49bf31b0dcde16593892eb51dd18706eb6", size = 63559, upload-time = "2024-12-06T11:20:56.608Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/0c/29/0348de65b8cc732daa3e33e67806420b2ae89bdce2b04af740289c5c6c8c/loguru-0.7.3-py3-none-any.whl", hash = "sha256:31a33c10c8e1e10422bfd431aeb5d351c7cf7fa671e3c4df004162264b28220c", size = 61595, upload-time = "2024-12-06T11:20:54.538Z" },
]

[[package]]
name = "multidict"
version = "6.6.3"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/3d/2c/5dad12e82fbdf7470f29bff2171484bf07cb3b16ada60a6589af8f376440/multidict-6.6.3.tar.gz", hash = "sha256:798a9eb12dab0a6c2e29c1de6f3468af5cb2da6053a20dfa3344907eed0937cc", size = 101006, upload-time = "2025-06-30T15:53:46.929Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/0e/a0/6b57988ea102da0623ea814160ed78d45a2645e4bbb499c2896d12833a70/multidict-6.6.3-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:056bebbeda16b2e38642d75e9e5310c484b7c24e3841dc0fb943206a72ec89d6", size = 76514, upload-time = "2025-06-30T15:51:48.728Z" },
    { url = "https://files.pythonhosted.org/packages/07/7a/d1e92665b0850c6c0508f101f9cf0410c1afa24973e1115fe9c6a185ebf7/multidict-6.6.3-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:e5f481cccb3c5c5e5de5d00b5141dc589c1047e60d07e85bbd7dea3d4580d63f", size = 45394, upload-time = "2025-06-30T15:51:49.986Z" },
    { url = "https://files.pythonhosted.org/packages/52/6f/dd104490e01be6ef8bf9573705d8572f8c2d2c561f06e3826b081d9e6591/multidict-6.6.3-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:10bea2ee839a759ee368b5a6e47787f399b41e70cf0c20d90dfaf4158dfb4e55", size = 43590, upload-time = "2025-06-30T15:51:51.331Z" },
    { url = "https://files.pythonhosted.org/packages/44/fe/06e0e01b1b0611e6581b7fd5a85b43dacc08b6cea3034f902f383b0873e5/multidict-6.6.3-cp312-cp312-manylinux1_i686.manylinux2014_i686.manylinux_2_17_i686.manylinux_2_5_i686.whl", hash = "sha256:2334cfb0fa9549d6ce2c21af2bfbcd3ac4ec3646b1b1581c88e3e2b1779ec92b", size = 237292, upload-time = "2025-06-30T15:51:52.584Z" },
    { url = "https://files.pythonhosted.org/packages/ce/71/4f0e558fb77696b89c233c1ee2d92f3e1d5459070a0e89153c9e9e804186/multidict-6.6.3-cp312-cp312-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:b8fee016722550a2276ca2cb5bb624480e0ed2bd49125b2b73b7010b9090e888", size = 258385, upload-time = "2025-06-30T15:51:53.913Z" },
    { url = "https://files.pythonhosted.org/packages/e3/25/cca0e68228addad24903801ed1ab42e21307a1b4b6dd2cf63da5d3ae082a/multidict-6.6.3-cp312-cp312-manylinux2014_armv7l.manylinux_2_17_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:e5511cb35f5c50a2db21047c875eb42f308c5583edf96bd8ebf7d770a9d68f6d", size = 242328, upload-time = "2025-06-30T15:51:55.672Z" },
    { url = "https://files.pythonhosted.org/packages/6e/a3/46f2d420d86bbcb8fe660b26a10a219871a0fbf4d43cb846a4031533f3e0/multidict-6.6.3-cp312-cp312-manylinux2014_ppc64le.manylinux_2_17_ppc64le.manylinux_2_28_ppc64le.whl", hash = "sha256:712b348f7f449948e0a6c4564a21c7db965af900973a67db432d724619b3c680", size = 268057, upload-time = "2025-06-30T15:51:57.037Z" },
    { url = "https://files.pythonhosted.org/packages/9e/73/1c743542fe00794a2ec7466abd3f312ccb8fad8dff9f36d42e18fb1ec33e/multidict-6.6.3-cp312-cp312-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:e4e15d2138ee2694e038e33b7c3da70e6b0ad8868b9f8094a72e1414aeda9c1a", size = 269341, upload-time = "2025-06-30T15:51:59.111Z" },
    { url = "https://files.pythonhosted.org/packages/a4/11/6ec9dcbe2264b92778eeb85407d1df18812248bf3506a5a1754bc035db0c/multidict-6.6.3-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:8df25594989aebff8a130f7899fa03cbfcc5d2b5f4a461cf2518236fe6f15961", size = 256081, upload-time = "2025-06-30T15:52:00.533Z" },
    { url = "https://files.pythonhosted.org/packages/9b/2b/631b1e2afeb5f1696846d747d36cda075bfdc0bc7245d6ba5c319278d6c4/multidict-6.6.3-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:159ca68bfd284a8860f8d8112cf0521113bffd9c17568579e4d13d1f1dc76b65", size = 253581, upload-time = "2025-06-30T15:52:02.43Z" },
    { url = "https://files.pythonhosted.org/packages/bf/0e/7e3b93f79efeb6111d3bf9a1a69e555ba1d07ad1c11bceb56b7310d0d7ee/multidict-6.6.3-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:e098c17856a8c9ade81b4810888c5ad1914099657226283cab3062c0540b0643", size = 250750, upload-time = "2025-06-30T15:52:04.26Z" },
    { url = "https://files.pythonhosted.org/packages/ad/9e/086846c1d6601948e7de556ee464a2d4c85e33883e749f46b9547d7b0704/multidict-6.6.3-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:67c92ed673049dec52d7ed39f8cf9ebbadf5032c774058b4406d18c8f8fe7063", size = 251548, upload-time = "2025-06-30T15:52:06.002Z" },
    { url = "https://files.pythonhosted.org/packages/8c/7b/86ec260118e522f1a31550e87b23542294880c97cfbf6fb18cc67b044c66/multidict-6.6.3-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:bd0578596e3a835ef451784053cfd327d607fc39ea1a14812139339a18a0dbc3", size = 262718, upload-time = "2025-06-30T15:52:07.707Z" },
    { url = "https://files.pythonhosted.org/packages/8c/bd/22ce8f47abb0be04692c9fc4638508b8340987b18691aa7775d927b73f72/multidict-6.6.3-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:346055630a2df2115cd23ae271910b4cae40f4e336773550dca4889b12916e75", size = 259603, upload-time = "2025-06-30T15:52:09.58Z" },
    { url = "https://files.pythonhosted.org/packages/07/9c/91b7ac1691be95cd1f4a26e36a74b97cda6aa9820632d31aab4410f46ebd/multidict-6.6.3-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:555ff55a359302b79de97e0468e9ee80637b0de1fce77721639f7cd9440b3a10", size = 251351, upload-time = "2025-06-30T15:52:10.947Z" },
    { url = "https://files.pythonhosted.org/packages/6f/5c/4d7adc739884f7a9fbe00d1eac8c034023ef8bad71f2ebe12823ca2e3649/multidict-6.6.3-cp312-cp312-win32.whl", hash = "sha256:73ab034fb8d58ff85c2bcbadc470efc3fafeea8affcf8722855fb94557f14cc5", size = 41860, upload-time = "2025-06-30T15:52:12.334Z" },
    { url = "https://files.pythonhosted.org/packages/6a/a3/0fbc7afdf7cb1aa12a086b02959307848eb6bcc8f66fcb66c0cb57e2a2c1/multidict-6.6.3-cp312-cp312-win_amd64.whl", hash = "sha256:04cbcce84f63b9af41bad04a54d4cc4e60e90c35b9e6ccb130be2d75b71f8c17", size = 45982, upload-time = "2025-06-30T15:52:13.6Z" },
    { url = "https://files.pythonhosted.org/packages/b8/95/8c825bd70ff9b02462dc18d1295dd08d3e9e4eb66856d292ffa62cfe1920/multidict-6.6.3-cp312-cp312-win_arm64.whl", hash = "sha256:0f1130b896ecb52d2a1e615260f3ea2af55fa7dc3d7c3003ba0c3121a759b18b", size = 43210, upload-time = "2025-06-30T15:52:14.893Z" },
    { url = "https://files.pythonhosted.org/packages/52/1d/0bebcbbb4f000751fbd09957257903d6e002943fc668d841a4cf2fb7f872/multidict-6.6.3-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:540d3c06d48507357a7d57721e5094b4f7093399a0106c211f33540fdc374d55", size = 75843, upload-time = "2025-06-30T15:52:16.155Z" },
    { url = "https://files.pythonhosted.org/packages/07/8f/cbe241b0434cfe257f65c2b1bcf9e8d5fb52bc708c5061fb29b0fed22bdf/multidict-6.6.3-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:9c19cea2a690f04247d43f366d03e4eb110a0dc4cd1bbeee4d445435428ed35b", size = 45053, upload-time = "2025-06-30T15:52:17.429Z" },
    { url = "https://files.pythonhosted.org/packages/32/d2/0b3b23f9dbad5b270b22a3ac3ea73ed0a50ef2d9a390447061178ed6bdb8/multidict-6.6.3-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:7af039820cfd00effec86bda5d8debef711a3e86a1d3772e85bea0f243a4bd65", size = 43273, upload-time = "2025-06-30T15:52:19.346Z" },
    { url = "https://files.pythonhosted.org/packages/fd/fe/6eb68927e823999e3683bc49678eb20374ba9615097d085298fd5b386564/multidict-6.6.3-cp313-cp313-manylinux1_i686.manylinux2014_i686.manylinux_2_17_i686.manylinux_2_5_i686.whl", hash = "sha256:500b84f51654fdc3944e936f2922114349bf8fdcac77c3092b03449f0e5bc2b3", size = 237124, upload-time = "2025-06-30T15:52:20.773Z" },
    { url = "https://files.pythonhosted.org/packages/e7/ab/320d8507e7726c460cb77117848b3834ea0d59e769f36fdae495f7669929/multidict-6.6.3-cp313-cp313-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:f3fc723ab8a5c5ed6c50418e9bfcd8e6dceba6c271cee6728a10a4ed8561520c", size = 256892, upload-time = "2025-06-30T15:52:22.242Z" },
    { url = "https://files.pythonhosted.org/packages/76/60/38ee422db515ac69834e60142a1a69111ac96026e76e8e9aa347fd2e4591/multidict-6.6.3-cp313-cp313-manylinux2014_armv7l.manylinux_2_17_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:94c47ea3ade005b5976789baaed66d4de4480d0a0bf31cef6edaa41c1e7b56a6", size = 240547, upload-time = "2025-06-30T15:52:23.736Z" },
    { url = "https://files.pythonhosted.org/packages/27/fb/905224fde2dff042b030c27ad95a7ae744325cf54b890b443d30a789b80e/multidict-6.6.3-cp313-cp313-manylinux2014_ppc64le.manylinux_2_17_ppc64le.manylinux_2_28_ppc64le.whl", hash = "sha256:dbc7cf464cc6d67e83e136c9f55726da3a30176f020a36ead246eceed87f1cd8", size = 266223, upload-time = "2025-06-30T15:52:25.185Z" },
    { url = "https://files.pythonhosted.org/packages/76/35/dc38ab361051beae08d1a53965e3e1a418752fc5be4d3fb983c5582d8784/multidict-6.6.3-cp313-cp313-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:900eb9f9da25ada070f8ee4a23f884e0ee66fe4e1a38c3af644256a508ad81ca", size = 267262, upload-time = "2025-06-30T15:52:26.969Z" },
    { url = "https://files.pythonhosted.org/packages/1f/a3/0a485b7f36e422421b17e2bbb5a81c1af10eac1d4476f2ff92927c730479/multidict-6.6.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:7c6df517cf177da5d47ab15407143a89cd1a23f8b335f3a28d57e8b0a3dbb884", size = 254345, upload-time = "2025-06-30T15:52:28.467Z" },
    { url = "https://files.pythonhosted.org/packages/b4/59/bcdd52c1dab7c0e0d75ff19cac751fbd5f850d1fc39172ce809a74aa9ea4/multidict-6.6.3-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:4ef421045f13879e21c994b36e728d8e7d126c91a64b9185810ab51d474f27e7", size = 252248, upload-time = "2025-06-30T15:52:29.938Z" },
    { url = "https://files.pythonhosted.org/packages/bb/a4/2d96aaa6eae8067ce108d4acee6f45ced5728beda55c0f02ae1072c730d1/multidict-6.6.3-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:6c1e61bb4f80895c081790b6b09fa49e13566df8fbff817da3f85b3a8192e36b", size = 250115, upload-time = "2025-06-30T15:52:31.416Z" },
    { url = "https://files.pythonhosted.org/packages/25/d2/ed9f847fa5c7d0677d4f02ea2c163d5e48573de3f57bacf5670e43a5ffaa/multidict-6.6.3-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:e5e8523bb12d7623cd8300dbd91b9e439a46a028cd078ca695eb66ba31adee3c", size = 249649, upload-time = "2025-06-30T15:52:32.996Z" },
    { url = "https://files.pythonhosted.org/packages/1f/af/9155850372563fc550803d3f25373308aa70f59b52cff25854086ecb4a79/multidict-6.6.3-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:ef58340cc896219e4e653dade08fea5c55c6df41bcc68122e3be3e9d873d9a7b", size = 261203, upload-time = "2025-06-30T15:52:34.521Z" },
    { url = "https://files.pythonhosted.org/packages/36/2f/c6a728f699896252cf309769089568a33c6439626648843f78743660709d/multidict-6.6.3-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:fc9dc435ec8699e7b602b94fe0cd4703e69273a01cbc34409af29e7820f777f1", size = 258051, upload-time = "2025-06-30T15:52:35.999Z" },
    { url = "https://files.pythonhosted.org/packages/d0/60/689880776d6b18fa2b70f6cc74ff87dd6c6b9b47bd9cf74c16fecfaa6ad9/multidict-6.6.3-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:9e864486ef4ab07db5e9cb997bad2b681514158d6954dd1958dfb163b83d53e6", size = 249601, upload-time = "2025-06-30T15:52:37.473Z" },
    { url = "https://files.pythonhosted.org/packages/75/5e/325b11f2222a549019cf2ef879c1f81f94a0d40ace3ef55cf529915ba6cc/multidict-6.6.3-cp313-cp313-win32.whl", hash = "sha256:5633a82fba8e841bc5c5c06b16e21529573cd654f67fd833650a215520a6210e", size = 41683, upload-time = "2025-06-30T15:52:38.927Z" },
    { url = "https://files.pythonhosted.org/packages/b1/ad/cf46e73f5d6e3c775cabd2a05976547f3f18b39bee06260369a42501f053/multidict-6.6.3-cp313-cp313-win_amd64.whl", hash = "sha256:e93089c1570a4ad54c3714a12c2cef549dc9d58e97bcded193d928649cab78e9", size = 45811, upload-time = "2025-06-30T15:52:40.207Z" },
    { url = "https://files.pythonhosted.org/packages/c5/c9/2e3fe950db28fb7c62e1a5f46e1e38759b072e2089209bc033c2798bb5ec/multidict-6.6.3-cp313-cp313-win_arm64.whl", hash = "sha256:c60b401f192e79caec61f166da9c924e9f8bc65548d4246842df91651e83d600", size = 43056, upload-time = "2025-06-30T15:52:41.575Z" },
    { url = "https://files.pythonhosted.org/packages/3a/58/aaf8114cf34966e084a8cc9517771288adb53465188843d5a19862cb6dc3/multidict-6.6.3-cp313-cp313t-macosx_10_13_universal2.whl", hash = "sha256:02fd8f32d403a6ff13864b0851f1f523d4c988051eea0471d4f1fd8010f11134", size = 82811, upload-time = "2025-06-30T15:52:43.281Z" },
    { url = "https://files.pythonhosted.org/packages/71/af/5402e7b58a1f5b987a07ad98f2501fdba2a4f4b4c30cf114e3ce8db64c87/multidict-6.6.3-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:f3aa090106b1543f3f87b2041eef3c156c8da2aed90c63a2fbed62d875c49c37", size = 48304, upload-time = "2025-06-30T15:52:45.026Z" },
    { url = "https://files.pythonhosted.org/packages/39/65/ab3c8cafe21adb45b24a50266fd747147dec7847425bc2a0f6934b3ae9ce/multidict-6.6.3-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:e924fb978615a5e33ff644cc42e6aa241effcf4f3322c09d4f8cebde95aff5f8", size = 46775, upload-time = "2025-06-30T15:52:46.459Z" },
    { url = "https://files.pythonhosted.org/packages/49/ba/9fcc1b332f67cc0c0c8079e263bfab6660f87fe4e28a35921771ff3eea0d/multidict-6.6.3-cp313-cp313t-manylinux1_i686.manylinux2014_i686.manylinux_2_17_i686.manylinux_2_5_i686.whl", hash = "sha256:b9fe5a0e57c6dbd0e2ce81ca66272282c32cd11d31658ee9553849d91289e1c1", size = 229773, upload-time = "2025-06-30T15:52:47.88Z" },
    { url = "https://files.pythonhosted.org/packages/a4/14/0145a251f555f7c754ce2dcbcd012939bbd1f34f066fa5d28a50e722a054/multidict-6.6.3-cp313-cp313t-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:b24576f208793ebae00280c59927c3b7c2a3b1655e443a25f753c4611bc1c373", size = 250083, upload-time = "2025-06-30T15:52:49.366Z" },
    { url = "https://files.pythonhosted.org/packages/9e/d4/d5c0bd2bbb173b586c249a151a26d2fb3ec7d53c96e42091c9fef4e1f10c/multidict-6.6.3-cp313-cp313t-manylinux2014_armv7l.manylinux_2_17_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:135631cb6c58eac37d7ac0df380294fecdc026b28837fa07c02e459c7fb9c54e", size = 228980, upload-time = "2025-06-30T15:52:50.903Z" },
    { url = "https://files.pythonhosted.org/packages/21/32/c9a2d8444a50ec48c4733ccc67254100c10e1c8ae8e40c7a2d2183b59b97/multidict-6.6.3-cp313-cp313t-manylinux2014_ppc64le.manylinux_2_17_ppc64le.manylinux_2_28_ppc64le.whl", hash = "sha256:274d416b0df887aef98f19f21578653982cfb8a05b4e187d4a17103322eeaf8f", size = 257776, upload-time = "2025-06-30T15:52:52.764Z" },
    { url = "https://files.pythonhosted.org/packages/68/d0/14fa1699f4ef629eae08ad6201c6b476098f5efb051b296f4c26be7a9fdf/multidict-6.6.3-cp313-cp313t-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:e252017a817fad7ce05cafbe5711ed40faeb580e63b16755a3a24e66fa1d87c0", size = 256882, upload-time = "2025-06-30T15:52:54.596Z" },
    { url = "https://files.pythonhosted.org/packages/da/88/84a27570fbe303c65607d517a5f147cd2fc046c2d1da02b84b17b9bdc2aa/multidict-6.6.3-cp313-cp313t-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:2e4cc8d848cd4fe1cdee28c13ea79ab0ed37fc2e89dd77bac86a2e7959a8c3bc", size = 247816, upload-time = "2025-06-30T15:52:56.175Z" },
    { url = "https://files.pythonhosted.org/packages/1c/60/dca352a0c999ce96a5d8b8ee0b2b9f729dcad2e0b0c195f8286269a2074c/multidict-6.6.3-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:9e236a7094b9c4c1b7585f6b9cca34b9d833cf079f7e4c49e6a4a6ec9bfdc68f", size = 245341, upload-time = "2025-06-30T15:52:57.752Z" },
    { url = "https://files.pythonhosted.org/packages/50/ef/433fa3ed06028f03946f3993223dada70fb700f763f70c00079533c34578/multidict-6.6.3-cp313-cp313t-musllinux_1_2_armv7l.whl", hash = "sha256:e0cb0ab69915c55627c933f0b555a943d98ba71b4d1c57bc0d0a66e2567c7471", size = 235854, upload-time = "2025-06-30T15:52:59.74Z" },
    { url = "https://files.pythonhosted.org/packages/1b/1f/487612ab56fbe35715320905215a57fede20de7db40a261759690dc80471/multidict-6.6.3-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:81ef2f64593aba09c5212a3d0f8c906a0d38d710a011f2f42759704d4557d3f2", size = 243432, upload-time = "2025-06-30T15:53:01.602Z" },
    { url = "https://files.pythonhosted.org/packages/da/6f/ce8b79de16cd885c6f9052c96a3671373d00c59b3ee635ea93e6e81b8ccf/multidict-6.6.3-cp313-cp313t-musllinux_1_2_ppc64le.whl", hash = "sha256:b9cbc60010de3562545fa198bfc6d3825df430ea96d2cc509c39bd71e2e7d648", size = 252731, upload-time = "2025-06-30T15:53:03.517Z" },
    { url = "https://files.pythonhosted.org/packages/bb/fe/a2514a6aba78e5abefa1624ca85ae18f542d95ac5cde2e3815a9fbf369aa/multidict-6.6.3-cp313-cp313t-musllinux_1_2_s390x.whl", hash = "sha256:70d974eaaa37211390cd02ef93b7e938de564bbffa866f0b08d07e5e65da783d", size = 247086, upload-time = "2025-06-30T15:53:05.48Z" },
    { url = "https://files.pythonhosted.org/packages/8c/22/b788718d63bb3cce752d107a57c85fcd1a212c6c778628567c9713f9345a/multidict-6.6.3-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:3713303e4a6663c6d01d648a68f2848701001f3390a030edaaf3fc949c90bf7c", size = 243338, upload-time = "2025-06-30T15:53:07.522Z" },
    { url = "https://files.pythonhosted.org/packages/22/d6/fdb3d0670819f2228f3f7d9af613d5e652c15d170c83e5f1c94fbc55a25b/multidict-6.6.3-cp313-cp313t-win32.whl", hash = "sha256:639ecc9fe7cd73f2495f62c213e964843826f44505a3e5d82805aa85cac6f89e", size = 47812, upload-time = "2025-06-30T15:53:09.263Z" },
    { url = "https://files.pythonhosted.org/packages/b6/d6/a9d2c808f2c489ad199723197419207ecbfbc1776f6e155e1ecea9c883aa/multidict-6.6.3-cp313-cp313t-win_amd64.whl", hash = "sha256:9f97e181f344a0ef3881b573d31de8542cc0dbc559ec68c8f8b5ce2c2e91646d", size = 53011, upload-time = "2025-06-30T15:53:11.038Z" },
    { url = "https://files.pythonhosted.org/packages/f2/40/b68001cba8188dd267590a111f9661b6256debc327137667e832bf5d66e8/multidict-6.6.3-cp313-cp313t-win_arm64.whl", hash = "sha256:ce8b7693da41a3c4fde5871c738a81490cea5496c671d74374c8ab889e1834fb", size = 45254, upload-time = "2025-06-30T15:53:12.421Z" },
    { url = "https://files.pythonhosted.org/packages/d8/30/9aec301e9772b098c1f5c0ca0279237c9766d94b97802e9888010c64b0ed/multidict-6.6.3-py3-none-any.whl", hash = "sha256:8db10f29c7541fc5da4defd8cd697e1ca429db743fa716325f236079b96f775a", size = 12313, upload-time = "2025-06-30T15:53:45.437Z" },
]

[[package]]
name = "openai"
version = "1.93.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "anyio" },
    { name = "distro" },
    { name = "httpx" },
    { name = "jiter" },
    { name = "pydantic" },
    { name = "sniffio" },
    { name = "tqdm" },
    { name = "typing-extensions" },
]
sdist = { url = "https://files.pythonhosted.org/packages/e4/d7/e91c6a9cf71726420cddf539852ee4c29176ebb716a702d9118d0409fd8e/openai-1.93.0.tar.gz", hash = "sha256:988f31ade95e1ff0585af11cc5a64510225e4f5cd392698c675d0a9265b8e337", size = 486573, upload-time = "2025-06-27T21:21:39.421Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/64/46/a10d9df4673df56f71201d129ba1cb19eaff3366d08c8664d61a7df52e65/openai-1.93.0-py3-none-any.whl", hash = "sha256:3d746fe5498f0dd72e0d9ab706f26c91c0f646bf7459e5629af8ba7c9dbdf090", size = 755038, upload-time = "2025-06-27T21:21:37.532Z" },
]

[[package]]
name = "packaging"
version = "25.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/a1/d4/1fc4078c65507b51b96ca8f8c3ba19e6a61c8253c72794544580a7b6c24d/packaging-25.0.tar.gz", hash = "sha256:d443872c98d677bf60f6a1f2f8c1cb748e8fe762d2bf9d3148b5599295b0fc4f", size = 165727, upload-time = "2025-04-19T11:48:59.673Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/20/12/38679034af332785aac8774540895e234f4d07f7545804097de4b666afd8/packaging-25.0-py3-none-any.whl", hash = "sha256:29572ef2b1f17581046b3a2227d5c611fb25ec70ca1ba8554b24b0e69331a484", size = 66469, upload-time = "2025-04-19T11:48:57.875Z" },
]

[[package]]
name = "pluggy"
version = "1.6.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f9/e2/3e91f31a7d2b083fe6ef3fa267035b518369d9511ffab804f839851d2779/pluggy-1.6.0.tar.gz", hash = "sha256:7dcc130b76258d33b90f61b658791dede3486c3e6bfb003ee5c9bfb396dd22f3", size = 69412, upload-time = "2025-05-15T12:30:07.975Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/54/20/4d324d65cc6d9205fabedc306948156824eb9f0ee1633355a8f7ec5c66bf/pluggy-1.6.0-py3-none-any.whl", hash = "sha256:e920276dd6813095e9377c0bc5566d94c932c33b27a3e3945d8389c374dd4746", size = 20538, upload-time = "2025-05-15T12:30:06.134Z" },
]

[[package]]
name = "postgrest"
version = "1.1.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "deprecation" },
    { name = "httpx", extra = ["http2"] },
    { name = "pydantic" },
]
sdist = { url = "https://files.pythonhosted.org/packages/6e/3e/1b50568e1f5db0bdced4a82c7887e37326585faef7ca43ead86849cb4861/postgrest-1.1.1.tar.gz", hash = "sha256:f3bb3e8c4602775c75c844a31f565f5f3dd584df4d36d683f0b67d01a86be322", size = 15431, upload-time = "2025-06-23T19:21:34.742Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a4/71/188a50ea64c17f73ff4df5196ec1553a8f1723421eb2d1069c73bab47d78/postgrest-1.1.1-py3-none-any.whl", hash = "sha256:98a6035ee1d14288484bfe36235942c5fb2d26af6d8120dfe3efbe007859251a", size = 22366, upload-time = "2025-06-23T19:21:33.637Z" },
]

[[package]]
name = "prometheus-client"
version = "0.22.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/5e/cf/40dde0a2be27cc1eb41e333d1a674a74ce8b8b0457269cc640fd42b07cf7/prometheus_client-0.22.1.tar.gz", hash = "sha256:190f1331e783cf21eb60bca559354e0a4d4378facecf78f5428c39b675d20d28", size = 69746, upload-time = "2025-06-02T14:29:01.152Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/32/ae/ec06af4fe3ee72d16973474f122541746196aaa16cea6f66d18b963c6177/prometheus_client-0.22.1-py3-none-any.whl", hash = "sha256:cca895342e308174341b2cbf99a56bef291fbc0ef7b9e5412a0f26d653ba7094", size = 58694, upload-time = "2025-06-02T14:29:00.068Z" },
]

[[package]]
name = "propcache"
version = "0.3.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/a6/16/43264e4a779dd8588c21a70f0709665ee8f611211bdd2c87d952cfa7c776/propcache-0.3.2.tar.gz", hash = "sha256:20d7d62e4e7ef05f221e0db2856b979540686342e7dd9973b815599c7057e168", size = 44139, upload-time = "2025-06-09T22:56:06.081Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a8/42/9ca01b0a6f48e81615dca4765a8f1dd2c057e0540f6116a27dc5ee01dfb6/propcache-0.3.2-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:8de106b6c84506b31c27168582cd3cb3000a6412c16df14a8628e5871ff83c10", size = 73674, upload-time = "2025-06-09T22:54:30.551Z" },
    { url = "https://files.pythonhosted.org/packages/af/6e/21293133beb550f9c901bbece755d582bfaf2176bee4774000bd4dd41884/propcache-0.3.2-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:28710b0d3975117239c76600ea351934ac7b5ff56e60953474342608dbbb6154", size = 43570, upload-time = "2025-06-09T22:54:32.296Z" },
    { url = "https://files.pythonhosted.org/packages/0c/c8/0393a0a3a2b8760eb3bde3c147f62b20044f0ddac81e9d6ed7318ec0d852/propcache-0.3.2-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:ce26862344bdf836650ed2487c3d724b00fbfec4233a1013f597b78c1cb73615", size = 43094, upload-time = "2025-06-09T22:54:33.929Z" },
    { url = "https://files.pythonhosted.org/packages/37/2c/489afe311a690399d04a3e03b069225670c1d489eb7b044a566511c1c498/propcache-0.3.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:bca54bd347a253af2cf4544bbec232ab982f4868de0dd684246b67a51bc6b1db", size = 226958, upload-time = "2025-06-09T22:54:35.186Z" },
    { url = "https://files.pythonhosted.org/packages/9d/ca/63b520d2f3d418c968bf596839ae26cf7f87bead026b6192d4da6a08c467/propcache-0.3.2-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:55780d5e9a2ddc59711d727226bb1ba83a22dd32f64ee15594b9392b1f544eb1", size = 234894, upload-time = "2025-06-09T22:54:36.708Z" },
    { url = "https://files.pythonhosted.org/packages/11/60/1d0ed6fff455a028d678df30cc28dcee7af77fa2b0e6962ce1df95c9a2a9/propcache-0.3.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:035e631be25d6975ed87ab23153db6a73426a48db688070d925aa27e996fe93c", size = 233672, upload-time = "2025-06-09T22:54:38.062Z" },
    { url = "https://files.pythonhosted.org/packages/37/7c/54fd5301ef38505ab235d98827207176a5c9b2aa61939b10a460ca53e123/propcache-0.3.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:ee6f22b6eaa39297c751d0e80c0d3a454f112f5c6481214fcf4c092074cecd67", size = 224395, upload-time = "2025-06-09T22:54:39.634Z" },
    { url = "https://files.pythonhosted.org/packages/ee/1a/89a40e0846f5de05fdc6779883bf46ba980e6df4d2ff8fb02643de126592/propcache-0.3.2-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:7ca3aee1aa955438c4dba34fc20a9f390e4c79967257d830f137bd5a8a32ed3b", size = 212510, upload-time = "2025-06-09T22:54:41.565Z" },
    { url = "https://files.pythonhosted.org/packages/5e/33/ca98368586c9566a6b8d5ef66e30484f8da84c0aac3f2d9aec6d31a11bd5/propcache-0.3.2-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:7a4f30862869fa2b68380d677cc1c5fcf1e0f2b9ea0cf665812895c75d0ca3b8", size = 222949, upload-time = "2025-06-09T22:54:43.038Z" },
    { url = "https://files.pythonhosted.org/packages/ba/11/ace870d0aafe443b33b2f0b7efdb872b7c3abd505bfb4890716ad7865e9d/propcache-0.3.2-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:b77ec3c257d7816d9f3700013639db7491a434644c906a2578a11daf13176251", size = 217258, upload-time = "2025-06-09T22:54:44.376Z" },
    { url = "https://files.pythonhosted.org/packages/5b/d2/86fd6f7adffcfc74b42c10a6b7db721d1d9ca1055c45d39a1a8f2a740a21/propcache-0.3.2-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:cab90ac9d3f14b2d5050928483d3d3b8fb6b4018893fc75710e6aa361ecb2474", size = 213036, upload-time = "2025-06-09T22:54:46.243Z" },
    { url = "https://files.pythonhosted.org/packages/07/94/2d7d1e328f45ff34a0a284cf5a2847013701e24c2a53117e7c280a4316b3/propcache-0.3.2-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:0b504d29f3c47cf6b9e936c1852246c83d450e8e063d50562115a6be6d3a2535", size = 227684, upload-time = "2025-06-09T22:54:47.63Z" },
    { url = "https://files.pythonhosted.org/packages/b7/05/37ae63a0087677e90b1d14710e532ff104d44bc1efa3b3970fff99b891dc/propcache-0.3.2-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:ce2ac2675a6aa41ddb2a0c9cbff53780a617ac3d43e620f8fd77ba1c84dcfc06", size = 234562, upload-time = "2025-06-09T22:54:48.982Z" },
    { url = "https://files.pythonhosted.org/packages/a4/7c/3f539fcae630408d0bd8bf3208b9a647ccad10976eda62402a80adf8fc34/propcache-0.3.2-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:62b4239611205294cc433845b914131b2a1f03500ff3c1ed093ed216b82621e1", size = 222142, upload-time = "2025-06-09T22:54:50.424Z" },
    { url = "https://files.pythonhosted.org/packages/7c/d2/34b9eac8c35f79f8a962546b3e97e9d4b990c420ee66ac8255d5d9611648/propcache-0.3.2-cp312-cp312-win32.whl", hash = "sha256:df4a81b9b53449ebc90cc4deefb052c1dd934ba85012aa912c7ea7b7e38b60c1", size = 37711, upload-time = "2025-06-09T22:54:52.072Z" },
    { url = "https://files.pythonhosted.org/packages/19/61/d582be5d226cf79071681d1b46b848d6cb03d7b70af7063e33a2787eaa03/propcache-0.3.2-cp312-cp312-win_amd64.whl", hash = "sha256:7046e79b989d7fe457bb755844019e10f693752d169076138abf17f31380800c", size = 41479, upload-time = "2025-06-09T22:54:53.234Z" },
    { url = "https://files.pythonhosted.org/packages/dc/d1/8c747fafa558c603c4ca19d8e20b288aa0c7cda74e9402f50f31eb65267e/propcache-0.3.2-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:ca592ed634a73ca002967458187109265e980422116c0a107cf93d81f95af945", size = 71286, upload-time = "2025-06-09T22:54:54.369Z" },
    { url = "https://files.pythonhosted.org/packages/61/99/d606cb7986b60d89c36de8a85d58764323b3a5ff07770a99d8e993b3fa73/propcache-0.3.2-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:9ecb0aad4020e275652ba3975740f241bd12a61f1a784df044cf7477a02bc252", size = 42425, upload-time = "2025-06-09T22:54:55.642Z" },
    { url = "https://files.pythonhosted.org/packages/8c/96/ef98f91bbb42b79e9bb82bdd348b255eb9d65f14dbbe3b1594644c4073f7/propcache-0.3.2-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:7f08f1cc28bd2eade7a8a3d2954ccc673bb02062e3e7da09bc75d843386b342f", size = 41846, upload-time = "2025-06-09T22:54:57.246Z" },
    { url = "https://files.pythonhosted.org/packages/5b/ad/3f0f9a705fb630d175146cd7b1d2bf5555c9beaed54e94132b21aac098a6/propcache-0.3.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:d1a342c834734edb4be5ecb1e9fb48cb64b1e2320fccbd8c54bf8da8f2a84c33", size = 208871, upload-time = "2025-06-09T22:54:58.975Z" },
    { url = "https://files.pythonhosted.org/packages/3a/38/2085cda93d2c8b6ec3e92af2c89489a36a5886b712a34ab25de9fbca7992/propcache-0.3.2-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:8a544caaae1ac73f1fecfae70ded3e93728831affebd017d53449e3ac052ac1e", size = 215720, upload-time = "2025-06-09T22:55:00.471Z" },
    { url = "https://files.pythonhosted.org/packages/61/c1/d72ea2dc83ac7f2c8e182786ab0fc2c7bd123a1ff9b7975bee671866fe5f/propcache-0.3.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:310d11aa44635298397db47a3ebce7db99a4cc4b9bbdfcf6c98a60c8d5261cf1", size = 215203, upload-time = "2025-06-09T22:55:01.834Z" },
    { url = "https://files.pythonhosted.org/packages/af/81/b324c44ae60c56ef12007105f1460d5c304b0626ab0cc6b07c8f2a9aa0b8/propcache-0.3.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:4c1396592321ac83157ac03a2023aa6cc4a3cc3cfdecb71090054c09e5a7cce3", size = 206365, upload-time = "2025-06-09T22:55:03.199Z" },
    { url = "https://files.pythonhosted.org/packages/09/73/88549128bb89e66d2aff242488f62869014ae092db63ccea53c1cc75a81d/propcache-0.3.2-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:8cabf5b5902272565e78197edb682017d21cf3b550ba0460ee473753f28d23c1", size = 196016, upload-time = "2025-06-09T22:55:04.518Z" },
    { url = "https://files.pythonhosted.org/packages/b9/3f/3bdd14e737d145114a5eb83cb172903afba7242f67c5877f9909a20d948d/propcache-0.3.2-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:0a2f2235ac46a7aa25bdeb03a9e7060f6ecbd213b1f9101c43b3090ffb971ef6", size = 205596, upload-time = "2025-06-09T22:55:05.942Z" },
    { url = "https://files.pythonhosted.org/packages/0f/ca/2f4aa819c357d3107c3763d7ef42c03980f9ed5c48c82e01e25945d437c1/propcache-0.3.2-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:92b69e12e34869a6970fd2f3da91669899994b47c98f5d430b781c26f1d9f387", size = 200977, upload-time = "2025-06-09T22:55:07.792Z" },
    { url = "https://files.pythonhosted.org/packages/cd/4a/e65276c7477533c59085251ae88505caf6831c0e85ff8b2e31ebcbb949b1/propcache-0.3.2-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:54e02207c79968ebbdffc169591009f4474dde3b4679e16634d34c9363ff56b4", size = 197220, upload-time = "2025-06-09T22:55:09.173Z" },
    { url = "https://files.pythonhosted.org/packages/7c/54/fc7152e517cf5578278b242396ce4d4b36795423988ef39bb8cd5bf274c8/propcache-0.3.2-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:4adfb44cb588001f68c5466579d3f1157ca07f7504fc91ec87862e2b8e556b88", size = 210642, upload-time = "2025-06-09T22:55:10.62Z" },
    { url = "https://files.pythonhosted.org/packages/b9/80/abeb4a896d2767bf5f1ea7b92eb7be6a5330645bd7fb844049c0e4045d9d/propcache-0.3.2-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:fd3e6019dc1261cd0291ee8919dd91fbab7b169bb76aeef6c716833a3f65d206", size = 212789, upload-time = "2025-06-09T22:55:12.029Z" },
    { url = "https://files.pythonhosted.org/packages/b3/db/ea12a49aa7b2b6d68a5da8293dcf50068d48d088100ac016ad92a6a780e6/propcache-0.3.2-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:4c181cad81158d71c41a2bce88edce078458e2dd5ffee7eddd6b05da85079f43", size = 205880, upload-time = "2025-06-09T22:55:13.45Z" },
    { url = "https://files.pythonhosted.org/packages/d1/e5/9076a0bbbfb65d1198007059c65639dfd56266cf8e477a9707e4b1999ff4/propcache-0.3.2-cp313-cp313-win32.whl", hash = "sha256:8a08154613f2249519e549de2330cf8e2071c2887309a7b07fb56098f5170a02", size = 37220, upload-time = "2025-06-09T22:55:15.284Z" },
    { url = "https://files.pythonhosted.org/packages/d3/f5/b369e026b09a26cd77aa88d8fffd69141d2ae00a2abaaf5380d2603f4b7f/propcache-0.3.2-cp313-cp313-win_amd64.whl", hash = "sha256:e41671f1594fc4ab0a6dec1351864713cb3a279910ae8b58f884a88a0a632c05", size = 40678, upload-time = "2025-06-09T22:55:16.445Z" },
    { url = "https://files.pythonhosted.org/packages/a4/3a/6ece377b55544941a08d03581c7bc400a3c8cd3c2865900a68d5de79e21f/propcache-0.3.2-cp313-cp313t-macosx_10_13_universal2.whl", hash = "sha256:9a3cf035bbaf035f109987d9d55dc90e4b0e36e04bbbb95af3055ef17194057b", size = 76560, upload-time = "2025-06-09T22:55:17.598Z" },
    { url = "https://files.pythonhosted.org/packages/0c/da/64a2bb16418740fa634b0e9c3d29edff1db07f56d3546ca2d86ddf0305e1/propcache-0.3.2-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:156c03d07dc1323d8dacaa221fbe028c5c70d16709cdd63502778e6c3ccca1b0", size = 44676, upload-time = "2025-06-09T22:55:18.922Z" },
    { url = "https://files.pythonhosted.org/packages/36/7b/f025e06ea51cb72c52fb87e9b395cced02786610b60a3ed51da8af017170/propcache-0.3.2-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:74413c0ba02ba86f55cf60d18daab219f7e531620c15f1e23d95563f505efe7e", size = 44701, upload-time = "2025-06-09T22:55:20.106Z" },
    { url = "https://files.pythonhosted.org/packages/a4/00/faa1b1b7c3b74fc277f8642f32a4c72ba1d7b2de36d7cdfb676db7f4303e/propcache-0.3.2-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:f066b437bb3fa39c58ff97ab2ca351db465157d68ed0440abecb21715eb24b28", size = 276934, upload-time = "2025-06-09T22:55:21.5Z" },
    { url = "https://files.pythonhosted.org/packages/74/ab/935beb6f1756e0476a4d5938ff44bf0d13a055fed880caf93859b4f1baf4/propcache-0.3.2-cp313-cp313t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:f1304b085c83067914721e7e9d9917d41ad87696bf70f0bc7dee450e9c71ad0a", size = 278316, upload-time = "2025-06-09T22:55:22.918Z" },
    { url = "https://files.pythonhosted.org/packages/f8/9d/994a5c1ce4389610838d1caec74bdf0e98b306c70314d46dbe4fcf21a3e2/propcache-0.3.2-cp313-cp313t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:ab50cef01b372763a13333b4e54021bdcb291fc9a8e2ccb9c2df98be51bcde6c", size = 282619, upload-time = "2025-06-09T22:55:24.651Z" },
    { url = "https://files.pythonhosted.org/packages/2b/00/a10afce3d1ed0287cef2e09506d3be9822513f2c1e96457ee369adb9a6cd/propcache-0.3.2-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:fad3b2a085ec259ad2c2842666b2a0a49dea8463579c606426128925af1ed725", size = 265896, upload-time = "2025-06-09T22:55:26.049Z" },
    { url = "https://files.pythonhosted.org/packages/2e/a8/2aa6716ffa566ca57c749edb909ad27884680887d68517e4be41b02299f3/propcache-0.3.2-cp313-cp313t-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:261fa020c1c14deafd54c76b014956e2f86991af198c51139faf41c4d5e83892", size = 252111, upload-time = "2025-06-09T22:55:27.381Z" },
    { url = "https://files.pythonhosted.org/packages/36/4f/345ca9183b85ac29c8694b0941f7484bf419c7f0fea2d1e386b4f7893eed/propcache-0.3.2-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:46d7f8aa79c927e5f987ee3a80205c987717d3659f035c85cf0c3680526bdb44", size = 268334, upload-time = "2025-06-09T22:55:28.747Z" },
    { url = "https://files.pythonhosted.org/packages/3e/ca/fcd54f78b59e3f97b3b9715501e3147f5340167733d27db423aa321e7148/propcache-0.3.2-cp313-cp313t-musllinux_1_2_armv7l.whl", hash = "sha256:6d8f3f0eebf73e3c0ff0e7853f68be638b4043c65a70517bb575eff54edd8dbe", size = 255026, upload-time = "2025-06-09T22:55:30.184Z" },
    { url = "https://files.pythonhosted.org/packages/8b/95/8e6a6bbbd78ac89c30c225210a5c687790e532ba4088afb8c0445b77ef37/propcache-0.3.2-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:03c89c1b14a5452cf15403e291c0ccd7751d5b9736ecb2c5bab977ad6c5bcd81", size = 250724, upload-time = "2025-06-09T22:55:31.646Z" },
    { url = "https://files.pythonhosted.org/packages/ee/b0/0dd03616142baba28e8b2d14ce5df6631b4673850a3d4f9c0f9dd714a404/propcache-0.3.2-cp313-cp313t-musllinux_1_2_ppc64le.whl", hash = "sha256:0cc17efde71e12bbaad086d679ce575268d70bc123a5a71ea7ad76f70ba30bba", size = 268868, upload-time = "2025-06-09T22:55:33.209Z" },
    { url = "https://files.pythonhosted.org/packages/c5/98/2c12407a7e4fbacd94ddd32f3b1e3d5231e77c30ef7162b12a60e2dd5ce3/propcache-0.3.2-cp313-cp313t-musllinux_1_2_s390x.whl", hash = "sha256:acdf05d00696bc0447e278bb53cb04ca72354e562cf88ea6f9107df8e7fd9770", size = 271322, upload-time = "2025-06-09T22:55:35.065Z" },
    { url = "https://files.pythonhosted.org/packages/35/91/9cb56efbb428b006bb85db28591e40b7736847b8331d43fe335acf95f6c8/propcache-0.3.2-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:4445542398bd0b5d32df908031cb1b30d43ac848e20470a878b770ec2dcc6330", size = 265778, upload-time = "2025-06-09T22:55:36.45Z" },
    { url = "https://files.pythonhosted.org/packages/9a/4c/b0fe775a2bdd01e176b14b574be679d84fc83958335790f7c9a686c1f468/propcache-0.3.2-cp313-cp313t-win32.whl", hash = "sha256:f86e5d7cd03afb3a1db8e9f9f6eff15794e79e791350ac48a8c924e6f439f394", size = 41175, upload-time = "2025-06-09T22:55:38.436Z" },
    { url = "https://files.pythonhosted.org/packages/a4/ff/47f08595e3d9b5e149c150f88d9714574f1a7cbd89fe2817158a952674bf/propcache-0.3.2-cp313-cp313t-win_amd64.whl", hash = "sha256:9704bedf6e7cbe3c65eca4379a9b53ee6a83749f047808cbb5044d40d7d72198", size = 44857, upload-time = "2025-06-09T22:55:39.687Z" },
    { url = "https://files.pythonhosted.org/packages/cc/35/cc0aaecf278bb4575b8555f2b137de5ab821595ddae9da9d3cd1da4072c7/propcache-0.3.2-py3-none-any.whl", hash = "sha256:98f1ec44fb675f5052cccc8e609c46ed23a35a1cfd18545ad4e29002d858a43f", size = 12663, upload-time = "2025-06-09T22:56:04.484Z" },
]

[[package]]
name = "proto-plus"
version = "1.26.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "protobuf" },
]
sdist = { url = "https://files.pythonhosted.org/packages/f4/ac/87285f15f7cce6d4a008f33f1757fb5a13611ea8914eb58c3d0d26243468/proto_plus-1.26.1.tar.gz", hash = "sha256:21a515a4c4c0088a773899e23c7bbade3d18f9c66c73edd4c7ee3816bc96a012", size = 56142, upload-time = "2025-03-10T15:54:38.843Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/4e/6d/280c4c2ce28b1593a19ad5239c8b826871fc6ec275c21afc8e1820108039/proto_plus-1.26.1-py3-none-any.whl", hash = "sha256:13285478c2dcf2abb829db158e1047e2f1e8d63a077d94263c2b88b043c75a66", size = 50163, upload-time = "2025-03-10T15:54:37.335Z" },
]

[[package]]
name = "protobuf"
version = "5.29.5"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/43/29/d09e70352e4e88c9c7a198d5645d7277811448d76c23b00345670f7c8a38/protobuf-5.29.5.tar.gz", hash = "sha256:bc1463bafd4b0929216c35f437a8e28731a2b7fe3d98bb77a600efced5a15c84", size = 425226, upload-time = "2025-05-28T23:51:59.82Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/5f/11/6e40e9fc5bba02988a214c07cf324595789ca7820160bfd1f8be96e48539/protobuf-5.29.5-cp310-abi3-win32.whl", hash = "sha256:3f1c6468a2cfd102ff4703976138844f78ebd1fb45f49011afc5139e9e283079", size = 422963, upload-time = "2025-05-28T23:51:41.204Z" },
    { url = "https://files.pythonhosted.org/packages/81/7f/73cefb093e1a2a7c3ffd839e6f9fcafb7a427d300c7f8aef9c64405d8ac6/protobuf-5.29.5-cp310-abi3-win_amd64.whl", hash = "sha256:3f76e3a3675b4a4d867b52e4a5f5b78a2ef9565549d4037e06cf7b0942b1d3fc", size = 434818, upload-time = "2025-05-28T23:51:44.297Z" },
    { url = "https://files.pythonhosted.org/packages/dd/73/10e1661c21f139f2c6ad9b23040ff36fee624310dc28fba20d33fdae124c/protobuf-5.29.5-cp38-abi3-macosx_10_9_universal2.whl", hash = "sha256:e38c5add5a311f2a6eb0340716ef9b039c1dfa428b28f25a7838ac329204a671", size = 418091, upload-time = "2025-05-28T23:51:45.907Z" },
    { url = "https://files.pythonhosted.org/packages/6c/04/98f6f8cf5b07ab1294c13f34b4e69b3722bb609c5b701d6c169828f9f8aa/protobuf-5.29.5-cp38-abi3-manylinux2014_aarch64.whl", hash = "sha256:fa18533a299d7ab6c55a238bf8629311439995f2e7eca5caaff08663606e9015", size = 319824, upload-time = "2025-05-28T23:51:47.545Z" },
    { url = "https://files.pythonhosted.org/packages/85/e4/07c80521879c2d15f321465ac24c70efe2381378c00bf5e56a0f4fbac8cd/protobuf-5.29.5-cp38-abi3-manylinux2014_x86_64.whl", hash = "sha256:63848923da3325e1bf7e9003d680ce6e14b07e55d0473253a690c3a8b8fd6e61", size = 319942, upload-time = "2025-05-28T23:51:49.11Z" },
    { url = "https://files.pythonhosted.org/packages/7e/cc/7e77861000a0691aeea8f4566e5d3aa716f2b1dece4a24439437e41d3d25/protobuf-5.29.5-py3-none-any.whl", hash = "sha256:6cf42630262c59b2d8de33954443d94b746c952b01434fc58a417fdbd2e84bd5", size = 172823, upload-time = "2025-05-28T23:51:58.157Z" },
]

[[package]]
name = "psycopg2-binary"
version = "2.9.10"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/cb/0e/bdc8274dc0585090b4e3432267d7be4dfbfd8971c0fa59167c711105a6bf/psycopg2-binary-2.9.10.tar.gz", hash = "sha256:4b3df0e6990aa98acda57d983942eff13d824135fe2250e6522edaa782a06de2", size = 385764, upload-time = "2024-10-16T11:24:58.126Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/49/7d/465cc9795cf76f6d329efdafca74693714556ea3891813701ac1fee87545/psycopg2_binary-2.9.10-cp312-cp312-macosx_12_0_x86_64.whl", hash = "sha256:880845dfe1f85d9d5f7c412efea7a08946a46894537e4e5d091732eb1d34d9a0", size = 3044771, upload-time = "2024-10-16T11:20:35.234Z" },
    { url = "https://files.pythonhosted.org/packages/8b/31/6d225b7b641a1a2148e3ed65e1aa74fc86ba3fee850545e27be9e1de893d/psycopg2_binary-2.9.10-cp312-cp312-macosx_14_0_arm64.whl", hash = "sha256:9440fa522a79356aaa482aa4ba500b65f28e5d0e63b801abf6aa152a29bd842a", size = 3275336, upload-time = "2024-10-16T11:20:38.742Z" },
    { url = "https://files.pythonhosted.org/packages/30/b7/a68c2b4bff1cbb1728e3ec864b2d92327c77ad52edcd27922535a8366f68/psycopg2_binary-2.9.10-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:e3923c1d9870c49a2d44f795df0c889a22380d36ef92440ff618ec315757e539", size = 2851637, upload-time = "2024-10-16T11:20:42.145Z" },
    { url = "https://files.pythonhosted.org/packages/0b/b1/cfedc0e0e6f9ad61f8657fd173b2f831ce261c02a08c0b09c652b127d813/psycopg2_binary-2.9.10-cp312-cp312-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:7b2c956c028ea5de47ff3a8d6b3cc3330ab45cf0b7c3da35a2d6ff8420896526", size = 3082097, upload-time = "2024-10-16T11:20:46.185Z" },
    { url = "https://files.pythonhosted.org/packages/18/ed/0a8e4153c9b769f59c02fb5e7914f20f0b2483a19dae7bf2db54b743d0d0/psycopg2_binary-2.9.10-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:f758ed67cab30b9a8d2833609513ce4d3bd027641673d4ebc9c067e4d208eec1", size = 3264776, upload-time = "2024-10-16T11:20:50.879Z" },
    { url = "https://files.pythonhosted.org/packages/10/db/d09da68c6a0cdab41566b74e0a6068a425f077169bed0946559b7348ebe9/psycopg2_binary-2.9.10-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:8cd9b4f2cfab88ed4a9106192de509464b75a906462fb846b936eabe45c2063e", size = 3020968, upload-time = "2024-10-16T11:20:56.819Z" },
    { url = "https://files.pythonhosted.org/packages/94/28/4d6f8c255f0dfffb410db2b3f9ac5218d959a66c715c34cac31081e19b95/psycopg2_binary-2.9.10-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:6dc08420625b5a20b53551c50deae6e231e6371194fa0651dbe0fb206452ae1f", size = 2872334, upload-time = "2024-10-16T11:21:02.411Z" },
    { url = "https://files.pythonhosted.org/packages/05/f7/20d7bf796593c4fea95e12119d6cc384ff1f6141a24fbb7df5a668d29d29/psycopg2_binary-2.9.10-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:d7cd730dfa7c36dbe8724426bf5612798734bff2d3c3857f36f2733f5bfc7c00", size = 2822722, upload-time = "2024-10-16T11:21:09.01Z" },
    { url = "https://files.pythonhosted.org/packages/4d/e4/0c407ae919ef626dbdb32835a03b6737013c3cc7240169843965cada2bdf/psycopg2_binary-2.9.10-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:155e69561d54d02b3c3209545fb08938e27889ff5a10c19de8d23eb5a41be8a5", size = 2920132, upload-time = "2024-10-16T11:21:16.339Z" },
    { url = "https://files.pythonhosted.org/packages/2d/70/aa69c9f69cf09a01da224909ff6ce8b68faeef476f00f7ec377e8f03be70/psycopg2_binary-2.9.10-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:c3cc28a6fd5a4a26224007712e79b81dbaee2ffb90ff406256158ec4d7b52b47", size = 2959312, upload-time = "2024-10-16T11:21:25.584Z" },
    { url = "https://files.pythonhosted.org/packages/d3/bd/213e59854fafe87ba47814bf413ace0dcee33a89c8c8c814faca6bc7cf3c/psycopg2_binary-2.9.10-cp312-cp312-win32.whl", hash = "sha256:ec8a77f521a17506a24a5f626cb2aee7850f9b69a0afe704586f63a464f3cd64", size = 1025191, upload-time = "2024-10-16T11:21:29.912Z" },
    { url = "https://files.pythonhosted.org/packages/92/29/06261ea000e2dc1e22907dbbc483a1093665509ea586b29b8986a0e56733/psycopg2_binary-2.9.10-cp312-cp312-win_amd64.whl", hash = "sha256:18c5ee682b9c6dd3696dad6e54cc7ff3a1a9020df6a5c0f861ef8bfd338c3ca0", size = 1164031, upload-time = "2024-10-16T11:21:34.211Z" },
    { url = "https://files.pythonhosted.org/packages/3e/30/d41d3ba765609c0763505d565c4d12d8f3c79793f0d0f044ff5a28bf395b/psycopg2_binary-2.9.10-cp313-cp313-macosx_12_0_x86_64.whl", hash = "sha256:26540d4a9a4e2b096f1ff9cce51253d0504dca5a85872c7f7be23be5a53eb18d", size = 3044699, upload-time = "2024-10-16T11:21:42.841Z" },
    { url = "https://files.pythonhosted.org/packages/35/44/257ddadec7ef04536ba71af6bc6a75ec05c5343004a7ec93006bee66c0bc/psycopg2_binary-2.9.10-cp313-cp313-macosx_14_0_arm64.whl", hash = "sha256:e217ce4d37667df0bc1c397fdcd8de5e81018ef305aed9415c3b093faaeb10fb", size = 3275245, upload-time = "2024-10-16T11:21:51.989Z" },
    { url = "https://files.pythonhosted.org/packages/1b/11/48ea1cd11de67f9efd7262085588790a95d9dfcd9b8a687d46caf7305c1a/psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:245159e7ab20a71d989da00f280ca57da7641fa2cdcf71749c193cea540a74f7", size = 2851631, upload-time = "2024-10-16T11:21:57.584Z" },
    { url = "https://files.pythonhosted.org/packages/62/e0/62ce5ee650e6c86719d621a761fe4bc846ab9eff8c1f12b1ed5741bf1c9b/psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3c4ded1a24b20021ebe677b7b08ad10bf09aac197d6943bfe6fec70ac4e4690d", size = 3082140, upload-time = "2024-10-16T11:22:02.005Z" },
    { url = "https://files.pythonhosted.org/packages/27/ce/63f946c098611f7be234c0dd7cb1ad68b0b5744d34f68062bb3c5aa510c8/psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:3abb691ff9e57d4a93355f60d4f4c1dd2d68326c968e7db17ea96df3c023ef73", size = 3264762, upload-time = "2024-10-16T11:22:06.412Z" },
    { url = "https://files.pythonhosted.org/packages/43/25/c603cd81402e69edf7daa59b1602bd41eb9859e2824b8c0855d748366ac9/psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:8608c078134f0b3cbd9f89b34bd60a943b23fd33cc5f065e8d5f840061bd0673", size = 3020967, upload-time = "2024-10-16T11:22:11.583Z" },
    { url = "https://files.pythonhosted.org/packages/5f/d6/8708d8c6fca531057fa170cdde8df870e8b6a9b136e82b361c65e42b841e/psycopg2_binary-2.9.10-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:230eeae2d71594103cd5b93fd29d1ace6420d0b86f4778739cb1a5a32f607d1f", size = 2872326, upload-time = "2024-10-16T11:22:16.406Z" },
    { url = "https://files.pythonhosted.org/packages/ce/ac/5b1ea50fc08a9df82de7e1771537557f07c2632231bbab652c7e22597908/psycopg2_binary-2.9.10-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:bb89f0a835bcfc1d42ccd5f41f04870c1b936d8507c6df12b7737febc40f0909", size = 2822712, upload-time = "2024-10-16T11:22:21.366Z" },
    { url = "https://files.pythonhosted.org/packages/c4/fc/504d4503b2abc4570fac3ca56eb8fed5e437bf9c9ef13f36b6621db8ef00/psycopg2_binary-2.9.10-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:f0c2d907a1e102526dd2986df638343388b94c33860ff3bbe1384130828714b1", size = 2920155, upload-time = "2024-10-16T11:22:25.684Z" },
    { url = "https://files.pythonhosted.org/packages/b2/d1/323581e9273ad2c0dbd1902f3fb50c441da86e894b6e25a73c3fda32c57e/psycopg2_binary-2.9.10-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:f8157bed2f51db683f31306aa497311b560f2265998122abe1dce6428bd86567", size = 2959356, upload-time = "2024-10-16T11:22:30.562Z" },
    { url = "https://files.pythonhosted.org/packages/08/50/d13ea0a054189ae1bc21af1d85b6f8bb9bbc5572991055d70ad9006fe2d6/psycopg2_binary-2.9.10-cp313-cp313-win_amd64.whl", hash = "sha256:27422aa5f11fbcd9b18da48373eb67081243662f9b46e6fd07c3eb46e4535142", size = 2569224, upload-time = "2025-01-04T20:09:19.234Z" },
]

[[package]]
name = "pyasn1"
version = "0.6.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/ba/e9/01f1a64245b89f039897cb0130016d79f77d52669aae6ee7b159a6c4c018/pyasn1-0.6.1.tar.gz", hash = "sha256:6f580d2bdd84365380830acf45550f2511469f673cb4a5ae3857a3170128b034", size = 145322, upload-time = "2024-09-10T22:41:42.55Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/c8/f1/d6a797abb14f6283c0ddff96bbdd46937f64122b8c925cab503dd37f8214/pyasn1-0.6.1-py3-none-any.whl", hash = "sha256:0d632f46f2ba09143da3a8afe9e33fb6f92fa2320ab7e886e2d0f7672af84629", size = 83135, upload-time = "2024-09-11T16:00:36.122Z" },
]

[[package]]
name = "pyasn1-modules"
version = "0.4.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pyasn1" },
]
sdist = { url = "https://files.pythonhosted.org/packages/e9/e6/78ebbb10a8c8e4b61a59249394a4a594c1a7af95593dc933a349c8d00964/pyasn1_modules-0.4.2.tar.gz", hash = "sha256:677091de870a80aae844b1ca6134f54652fa2c8c5a52aa396440ac3106e941e6", size = 307892, upload-time = "2025-03-28T02:41:22.17Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/47/8d/d529b5d697919ba8c11ad626e835d4039be708a35b0d22de83a269a6682c/pyasn1_modules-0.4.2-py3-none-any.whl", hash = "sha256:29253a9207ce32b64c3ac6600edc75368f98473906e8fd1043bd6b5b1de2c14a", size = 181259, upload-time = "2025-03-28T02:41:19.028Z" },
]

[[package]]
name = "pydantic"
version = "2.11.7"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "annotated-types" },
    { name = "pydantic-core" },
    { name = "typing-extensions" },
    { name = "typing-inspection" },
]
sdist = { url = "https://files.pythonhosted.org/packages/00/dd/4325abf92c39ba8623b5af936ddb36ffcfe0beae70405d456ab1fb2f5b8c/pydantic-2.11.7.tar.gz", hash = "sha256:d989c3c6cb79469287b1569f7447a17848c998458d49ebe294e975b9baf0f0db", size = 788350, upload-time = "2025-06-14T08:33:17.137Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/6a/c0/ec2b1c8712ca690e5d61979dee872603e92b8a32f94cc1b72d53beab008a/pydantic-2.11.7-py3-none-any.whl", hash = "sha256:dde5df002701f6de26248661f6835bbe296a47bf73990135c7d07ce741b9623b", size = 444782, upload-time = "2025-06-14T08:33:14.905Z" },
]

[[package]]
name = "pydantic-core"
version = "2.33.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "typing-extensions" },
]
sdist = { url = "https://files.pythonhosted.org/packages/ad/88/5f2260bdfae97aabf98f1778d43f69574390ad787afb646292a638c923d4/pydantic_core-2.33.2.tar.gz", hash = "sha256:7cb8bc3605c29176e1b105350d2e6474142d7c1bd1d9327c4a9bdb46bf827acc", size = 435195, upload-time = "2025-04-23T18:33:52.104Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/18/8a/2b41c97f554ec8c71f2a8a5f85cb56a8b0956addfe8b0efb5b3d77e8bdc3/pydantic_core-2.33.2-cp312-cp312-macosx_10_12_x86_64.whl", hash = "sha256:a7ec89dc587667f22b6a0b6579c249fca9026ce7c333fc142ba42411fa243cdc", size = 2009000, upload-time = "2025-04-23T18:31:25.863Z" },
    { url = "https://files.pythonhosted.org/packages/a1/02/6224312aacb3c8ecbaa959897af57181fb6cf3a3d7917fd44d0f2917e6f2/pydantic_core-2.33.2-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:3c6db6e52c6d70aa0d00d45cdb9b40f0433b96380071ea80b09277dba021ddf7", size = 1847996, upload-time = "2025-04-23T18:31:27.341Z" },
    { url = "https://files.pythonhosted.org/packages/d6/46/6dcdf084a523dbe0a0be59d054734b86a981726f221f4562aed313dbcb49/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:4e61206137cbc65e6d5256e1166f88331d3b6238e082d9f74613b9b765fb9025", size = 1880957, upload-time = "2025-04-23T18:31:28.956Z" },
    { url = "https://files.pythonhosted.org/packages/ec/6b/1ec2c03837ac00886ba8160ce041ce4e325b41d06a034adbef11339ae422/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:eb8c529b2819c37140eb51b914153063d27ed88e3bdc31b71198a198e921e011", size = 1964199, upload-time = "2025-04-23T18:31:31.025Z" },
    { url = "https://files.pythonhosted.org/packages/2d/1d/6bf34d6adb9debd9136bd197ca72642203ce9aaaa85cfcbfcf20f9696e83/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:c52b02ad8b4e2cf14ca7b3d918f3eb0ee91e63b3167c32591e57c4317e134f8f", size = 2120296, upload-time = "2025-04-23T18:31:32.514Z" },
    { url = "https://files.pythonhosted.org/packages/e0/94/2bd0aaf5a591e974b32a9f7123f16637776c304471a0ab33cf263cf5591a/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:96081f1605125ba0855dfda83f6f3df5ec90c61195421ba72223de35ccfb2f88", size = 2676109, upload-time = "2025-04-23T18:31:33.958Z" },
    { url = "https://files.pythonhosted.org/packages/f9/41/4b043778cf9c4285d59742281a769eac371b9e47e35f98ad321349cc5d61/pydantic_core-2.33.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:8f57a69461af2a5fa6e6bbd7a5f60d3b7e6cebb687f55106933188e79ad155c1", size = 2002028, upload-time = "2025-04-23T18:31:39.095Z" },
    { url = "https://files.pythonhosted.org/packages/cb/d5/7bb781bf2748ce3d03af04d5c969fa1308880e1dca35a9bd94e1a96a922e/pydantic_core-2.33.2-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:572c7e6c8bb4774d2ac88929e3d1f12bc45714ae5ee6d9a788a9fb35e60bb04b", size = 2100044, upload-time = "2025-04-23T18:31:41.034Z" },
    { url = "https://files.pythonhosted.org/packages/fe/36/def5e53e1eb0ad896785702a5bbfd25eed546cdcf4087ad285021a90ed53/pydantic_core-2.33.2-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:db4b41f9bd95fbe5acd76d89920336ba96f03e149097365afe1cb092fceb89a1", size = 2058881, upload-time = "2025-04-23T18:31:42.757Z" },
    { url = "https://files.pythonhosted.org/packages/01/6c/57f8d70b2ee57fc3dc8b9610315949837fa8c11d86927b9bb044f8705419/pydantic_core-2.33.2-cp312-cp312-musllinux_1_1_armv7l.whl", hash = "sha256:fa854f5cf7e33842a892e5c73f45327760bc7bc516339fda888c75ae60edaeb6", size = 2227034, upload-time = "2025-04-23T18:31:44.304Z" },
    { url = "https://files.pythonhosted.org/packages/27/b9/9c17f0396a82b3d5cbea4c24d742083422639e7bb1d5bf600e12cb176a13/pydantic_core-2.33.2-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:5f483cfb75ff703095c59e365360cb73e00185e01aaea067cd19acffd2ab20ea", size = 2234187, upload-time = "2025-04-23T18:31:45.891Z" },
    { url = "https://files.pythonhosted.org/packages/b0/6a/adf5734ffd52bf86d865093ad70b2ce543415e0e356f6cacabbc0d9ad910/pydantic_core-2.33.2-cp312-cp312-win32.whl", hash = "sha256:9cb1da0f5a471435a7bc7e439b8a728e8b61e59784b2af70d7c169f8dd8ae290", size = 1892628, upload-time = "2025-04-23T18:31:47.819Z" },
    { url = "https://files.pythonhosted.org/packages/43/e4/5479fecb3606c1368d496a825d8411e126133c41224c1e7238be58b87d7e/pydantic_core-2.33.2-cp312-cp312-win_amd64.whl", hash = "sha256:f941635f2a3d96b2973e867144fde513665c87f13fe0e193c158ac51bfaaa7b2", size = 1955866, upload-time = "2025-04-23T18:31:49.635Z" },
    { url = "https://files.pythonhosted.org/packages/0d/24/8b11e8b3e2be9dd82df4b11408a67c61bb4dc4f8e11b5b0fc888b38118b5/pydantic_core-2.33.2-cp312-cp312-win_arm64.whl", hash = "sha256:cca3868ddfaccfbc4bfb1d608e2ccaaebe0ae628e1416aeb9c4d88c001bb45ab", size = 1888894, upload-time = "2025-04-23T18:31:51.609Z" },
    { url = "https://files.pythonhosted.org/packages/46/8c/99040727b41f56616573a28771b1bfa08a3d3fe74d3d513f01251f79f172/pydantic_core-2.33.2-cp313-cp313-macosx_10_12_x86_64.whl", hash = "sha256:1082dd3e2d7109ad8b7da48e1d4710c8d06c253cbc4a27c1cff4fbcaa97a9e3f", size = 2015688, upload-time = "2025-04-23T18:31:53.175Z" },
    { url = "https://files.pythonhosted.org/packages/3a/cc/5999d1eb705a6cefc31f0b4a90e9f7fc400539b1a1030529700cc1b51838/pydantic_core-2.33.2-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:f517ca031dfc037a9c07e748cefd8d96235088b83b4f4ba8939105d20fa1dcd6", size = 1844808, upload-time = "2025-04-23T18:31:54.79Z" },
    { url = "https://files.pythonhosted.org/packages/6f/5e/a0a7b8885c98889a18b6e376f344da1ef323d270b44edf8174d6bce4d622/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:0a9f2c9dd19656823cb8250b0724ee9c60a82f3cdf68a080979d13092a3b0fef", size = 1885580, upload-time = "2025-04-23T18:31:57.393Z" },
    { url = "https://files.pythonhosted.org/packages/3b/2a/953581f343c7d11a304581156618c3f592435523dd9d79865903272c256a/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:2b0a451c263b01acebe51895bfb0e1cc842a5c666efe06cdf13846c7418caa9a", size = 1973859, upload-time = "2025-04-23T18:31:59.065Z" },
    { url = "https://files.pythonhosted.org/packages/e6/55/f1a813904771c03a3f97f676c62cca0c0a4138654107c1b61f19c644868b/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:1ea40a64d23faa25e62a70ad163571c0b342b8bf66d5fa612ac0dec4f069d916", size = 2120810, upload-time = "2025-04-23T18:32:00.78Z" },
    { url = "https://files.pythonhosted.org/packages/aa/c3/053389835a996e18853ba107a63caae0b9deb4a276c6b472931ea9ae6e48/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:0fb2d542b4d66f9470e8065c5469ec676978d625a8b7a363f07d9a501a9cb36a", size = 2676498, upload-time = "2025-04-23T18:32:02.418Z" },
    { url = "https://files.pythonhosted.org/packages/eb/3c/f4abd740877a35abade05e437245b192f9d0ffb48bbbbd708df33d3cda37/pydantic_core-2.33.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:9fdac5d6ffa1b5a83bca06ffe7583f5576555e6c8b3a91fbd25ea7780f825f7d", size = 2000611, upload-time = "2025-04-23T18:32:04.152Z" },
    { url = "https://files.pythonhosted.org/packages/59/a7/63ef2fed1837d1121a894d0ce88439fe3e3b3e48c7543b2a4479eb99c2bd/pydantic_core-2.33.2-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.whl", hash = "sha256:04a1a413977ab517154eebb2d326da71638271477d6ad87a769102f7c2488c56", size = 2107924, upload-time = "2025-04-23T18:32:06.129Z" },
    { url = "https://files.pythonhosted.org/packages/04/8f/2551964ef045669801675f1cfc3b0d74147f4901c3ffa42be2ddb1f0efc4/pydantic_core-2.33.2-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:c8e7af2f4e0194c22b5b37205bfb293d166a7344a5b0d0eaccebc376546d77d5", size = 2063196, upload-time = "2025-04-23T18:32:08.178Z" },
    { url = "https://files.pythonhosted.org/packages/26/bd/d9602777e77fc6dbb0c7db9ad356e9a985825547dce5ad1d30ee04903918/pydantic_core-2.33.2-cp313-cp313-musllinux_1_1_armv7l.whl", hash = "sha256:5c92edd15cd58b3c2d34873597a1e20f13094f59cf88068adb18947df5455b4e", size = 2236389, upload-time = "2025-04-23T18:32:10.242Z" },
    { url = "https://files.pythonhosted.org/packages/42/db/0e950daa7e2230423ab342ae918a794964b053bec24ba8af013fc7c94846/pydantic_core-2.33.2-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:65132b7b4a1c0beded5e057324b7e16e10910c106d43675d9bd87d4f38dde162", size = 2239223, upload-time = "2025-04-23T18:32:12.382Z" },
    { url = "https://files.pythonhosted.org/packages/58/4d/4f937099c545a8a17eb52cb67fe0447fd9a373b348ccfa9a87f141eeb00f/pydantic_core-2.33.2-cp313-cp313-win32.whl", hash = "sha256:52fb90784e0a242bb96ec53f42196a17278855b0f31ac7c3cc6f5c1ec4811849", size = 1900473, upload-time = "2025-04-23T18:32:14.034Z" },
    { url = "https://files.pythonhosted.org/packages/a0/75/4a0a9bac998d78d889def5e4ef2b065acba8cae8c93696906c3a91f310ca/pydantic_core-2.33.2-cp313-cp313-win_amd64.whl", hash = "sha256:c083a3bdd5a93dfe480f1125926afcdbf2917ae714bdb80b36d34318b2bec5d9", size = 1955269, upload-time = "2025-04-23T18:32:15.783Z" },
    { url = "https://files.pythonhosted.org/packages/f9/86/1beda0576969592f1497b4ce8e7bc8cbdf614c352426271b1b10d5f0aa64/pydantic_core-2.33.2-cp313-cp313-win_arm64.whl", hash = "sha256:e80b087132752f6b3d714f041ccf74403799d3b23a72722ea2e6ba2e892555b9", size = 1893921, upload-time = "2025-04-23T18:32:18.473Z" },
    { url = "https://files.pythonhosted.org/packages/a4/7d/e09391c2eebeab681df2b74bfe6c43422fffede8dc74187b2b0bf6fd7571/pydantic_core-2.33.2-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:61c18fba8e5e9db3ab908620af374db0ac1baa69f0f32df4f61ae23f15e586ac", size = 1806162, upload-time = "2025-04-23T18:32:20.188Z" },
    { url = "https://files.pythonhosted.org/packages/f1/3d/847b6b1fed9f8ed3bb95a9ad04fbd0b212e832d4f0f50ff4d9ee5a9f15cf/pydantic_core-2.33.2-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:95237e53bb015f67b63c91af7518a62a8660376a6a0db19b89acc77a4d6199f5", size = 1981560, upload-time = "2025-04-23T18:32:22.354Z" },
    { url = "https://files.pythonhosted.org/packages/6f/9a/e73262f6c6656262b5fdd723ad90f518f579b7bc8622e43a942eec53c938/pydantic_core-2.33.2-cp313-cp313t-win_amd64.whl", hash = "sha256:c2fc0a768ef76c15ab9238afa6da7f69895bb5d1ee83aeea2e3509af4472d0b9", size = 1935777, upload-time = "2025-04-23T18:32:25.088Z" },
]

[[package]]
name = "pydantic-settings"
version = "2.10.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pydantic" },
    { name = "python-dotenv" },
    { name = "typing-inspection" },
]
sdist = { url = "https://files.pythonhosted.org/packages/68/85/1ea668bbab3c50071ca613c6ab30047fb36ab0da1b92fa8f17bbc38fd36c/pydantic_settings-2.10.1.tar.gz", hash = "sha256:06f0062169818d0f5524420a360d632d5857b83cffd4d42fe29597807a1614ee", size = 172583, upload-time = "2025-06-24T13:26:46.841Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/58/f0/427018098906416f580e3cf1366d3b1abfb408a0652e9f31600c24a1903c/pydantic_settings-2.10.1-py3-none-any.whl", hash = "sha256:a60952460b99cf661dc25c29c0ef171721f98bfcb52ef8d9ea4c943d7c8cc796", size = 45235, upload-time = "2025-06-24T13:26:45.485Z" },
]

[[package]]
name = "pygments"
version = "2.19.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/b0/77/a5b8c569bf593b0140bde72ea885a803b82086995367bf2037de0159d924/pygments-2.19.2.tar.gz", hash = "sha256:636cb2477cec7f8952536970bc533bc43743542f70392ae026374600add5b887", size = 4968631, upload-time = "2025-06-21T13:39:12.283Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/c7/21/705964c7812476f378728bdf590ca4b771ec72385c533964653c68e86bdc/pygments-2.19.2-py3-none-any.whl", hash = "sha256:86540386c03d588bb81d44bc3928634ff26449851e99741617ecb9037ee5ec0b", size = 1225217, upload-time = "2025-06-21T13:39:07.939Z" },
]

[[package]]
name = "pyjwt"
version = "2.10.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/e7/46/bd74733ff231675599650d3e47f361794b22ef3e3770998dda30d3b63726/pyjwt-2.10.1.tar.gz", hash = "sha256:3cc5772eb20009233caf06e9d8a0577824723b44e6648ee0a2aedb6cf9381953", size = 87785, upload-time = "2024-11-28T03:43:29.933Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/61/ad/689f02752eeec26aed679477e80e632ef1b682313be70793d798c1d5fc8f/PyJWT-2.10.1-py3-none-any.whl", hash = "sha256:dcdd193e30abefd5debf142f9adfcdd2b58004e644f25406ffaebd50bd98dacb", size = 22997, upload-time = "2024-11-28T03:43:27.893Z" },
]

[[package]]
name = "pyparsing"
version = "3.2.3"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/bb/22/f1129e69d94ffff626bdb5c835506b3a5b4f3d070f17ea295e12c2c6f60f/pyparsing-3.2.3.tar.gz", hash = "sha256:b9c13f1ab8b3b542f72e28f634bad4de758ab3ce4546e4301970ad6fa77c38be", size = 1088608, upload-time = "2025-03-25T05:01:28.114Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/05/e7/df2285f3d08fee213f2d041540fa4fc9ca6c2d44cf36d3a035bf2a8d2bcc/pyparsing-3.2.3-py3-none-any.whl", hash = "sha256:a749938e02d6fd0b59b356ca504a24982314bb090c383e3cf201c95ef7e2bfcf", size = 111120, upload-time = "2025-03-25T05:01:24.908Z" },
]

[[package]]
name = "pytest"
version = "8.4.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
    { name = "iniconfig" },
    { name = "packaging" },
    { name = "pluggy" },
    { name = "pygments" },
]
sdist = { url = "https://files.pythonhosted.org/packages/08/ba/45911d754e8eba3d5a841a5ce61a65a685ff1798421ac054f85aa8747dfb/pytest-8.4.1.tar.gz", hash = "sha256:7c67fd69174877359ed9371ec3af8a3d2b04741818c51e5e99cc1742251fa93c", size = 1517714, upload-time = "2025-06-18T05:48:06.109Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/29/16/c8a903f4c4dffe7a12843191437d7cd8e32751d5de349d45d3fe69544e87/pytest-8.4.1-py3-none-any.whl", hash = "sha256:539c70ba6fcead8e78eebbf1115e8b589e7565830d7d006a8723f19ac8a0afb7", size = 365474, upload-time = "2025-06-18T05:48:03.955Z" },
]

[[package]]
name = "pytest-asyncio"
version = "1.0.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pytest" },
]
sdist = { url = "https://files.pythonhosted.org/packages/d0/d4/14f53324cb1a6381bef29d698987625d80052bb33932d8e7cbf9b337b17c/pytest_asyncio-1.0.0.tar.gz", hash = "sha256:d15463d13f4456e1ead2594520216b225a16f781e144f8fdf6c5bb4667c48b3f", size = 46960, upload-time = "2025-05-26T04:54:40.484Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/30/05/ce271016e351fddc8399e546f6e23761967ee09c8c568bbfbecb0c150171/pytest_asyncio-1.0.0-py3-none-any.whl", hash = "sha256:4f024da9f1ef945e680dc68610b52550e36590a67fd31bb3b4943979a1f90ef3", size = 15976, upload-time = "2025-05-26T04:54:39.035Z" },
]

[[package]]
name = "pytest-cov"
version = "6.2.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "coverage" },
    { name = "pluggy" },
    { name = "pytest" },
]
sdist = { url = "https://files.pythonhosted.org/packages/18/99/668cade231f434aaa59bbfbf49469068d2ddd945000621d3d165d2e7dd7b/pytest_cov-6.2.1.tar.gz", hash = "sha256:25cc6cc0a5358204b8108ecedc51a9b57b34cc6b8c967cc2c01a4e00d8a67da2", size = 69432, upload-time = "2025-06-12T10:47:47.684Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/bc/16/4ea354101abb1287856baa4af2732be351c7bee728065aed451b678153fd/pytest_cov-6.2.1-py3-none-any.whl", hash = "sha256:f5bc4c23f42f1cdd23c70b1dab1bbaef4fc505ba950d53e0081d0730dd7e86d5", size = 24644, upload-time = "2025-06-12T10:47:45.932Z" },
]

[[package]]
name = "pytest-mock"
version = "3.14.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pytest" },
]
sdist = { url = "https://files.pythonhosted.org/packages/71/28/67172c96ba684058a4d24ffe144d64783d2a270d0af0d9e792737bddc75c/pytest_mock-3.14.1.tar.gz", hash = "sha256:159e9edac4c451ce77a5cdb9fc5d1100708d2dd4ba3c3df572f14097351af80e", size = 33241, upload-time = "2025-05-26T13:58:45.167Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b2/05/77b60e520511c53d1c1ca75f1930c7dd8e971d0c4379b7f4b3f9644685ba/pytest_mock-3.14.1-py3-none-any.whl", hash = "sha256:178aefcd11307d874b4cd3100344e7e2d888d9791a6a1d9bfe90fbc1b74fd1d0", size = 9923, upload-time = "2025-05-26T13:58:43.487Z" },
]

[[package]]
name = "python-dateutil"
version = "2.9.0.post0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "six" },
]
sdist = { url = "https://files.pythonhosted.org/packages/66/c0/0c8b6ad9f17a802ee498c46e004a0eb49bc148f2fd230864601a86dcf6db/python-dateutil-2.9.0.post0.tar.gz", hash = "sha256:37dd54208da7e1cd875388217d5e00ebd4179249f90fb72437e91a35459a0ad3", size = 342432, upload-time = "2024-03-01T18:36:20.211Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/ec/57/56b9bcc3c9c6a792fcbaf139543cee77261f3651ca9da0c93f5c1221264b/python_dateutil-2.9.0.post0-py2.py3-none-any.whl", hash = "sha256:a8b2bc7bffae282281c8140a97d3aa9c14da0b136dfe83f850eea9a5f7470427", size = 229892, upload-time = "2024-03-01T18:36:18.57Z" },
]

[[package]]
name = "python-dotenv"
version = "1.1.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f6/b0/4bc07ccd3572a2f9df7e6782f52b0c6c90dcbb803ac4a167702d7d0dfe1e/python_dotenv-1.1.1.tar.gz", hash = "sha256:a8a6399716257f45be6a007360200409fce5cda2661e3dec71d23dc15f6189ab", size = 41978, upload-time = "2025-06-24T04:21:07.341Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/5f/ed/539768cf28c661b5b068d66d96a2f155c4971a5d55684a514c1a0e0dec2f/python_dotenv-1.1.1-py3-none-any.whl", hash = "sha256:31f23644fe2602f88ff55e1f5c79ba497e01224ee7737937930c448e4d0e24dc", size = 20556, upload-time = "2025-06-24T04:21:06.073Z" },
]

[[package]]
name = "python-multipart"
version = "0.0.20"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/f3/87/f44d7c9f274c7ee665a29b885ec97089ec5dc034c7f3fafa03da9e39a09e/python_multipart-0.0.20.tar.gz", hash = "sha256:8dd0cab45b8e23064ae09147625994d090fa46f5b0d1e13af944c331a7fa9d13", size = 37158, upload-time = "2024-12-16T19:45:46.972Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/45/58/38b5afbc1a800eeea951b9285d3912613f2603bdf897a4ab0f4bd7f405fc/python_multipart-0.0.20-py3-none-any.whl", hash = "sha256:8a62d3a8335e06589fe01f2a3e178cdcc632f3fbe0d492ad9ee0ec35aab1f104", size = 24546, upload-time = "2024-12-16T19:45:44.423Z" },
]

[[package]]
name = "pyyaml"
version = "6.0.2"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/54/ed/79a089b6be93607fa5cdaedf301d7dfb23af5f25c398d5ead2525b063e17/pyyaml-6.0.2.tar.gz", hash = "sha256:d584d9ec91ad65861cc08d42e834324ef890a082e591037abe114850ff7bbc3e", size = 130631, upload-time = "2024-08-06T20:33:50.674Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/86/0c/c581167fc46d6d6d7ddcfb8c843a4de25bdd27e4466938109ca68492292c/PyYAML-6.0.2-cp312-cp312-macosx_10_9_x86_64.whl", hash = "sha256:c70c95198c015b85feafc136515252a261a84561b7b1d51e3384e0655ddf25ab", size = 183873, upload-time = "2024-08-06T20:32:25.131Z" },
    { url = "https://files.pythonhosted.org/packages/a8/0c/38374f5bb272c051e2a69281d71cba6fdb983413e6758b84482905e29a5d/PyYAML-6.0.2-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:ce826d6ef20b1bc864f0a68340c8b3287705cae2f8b4b1d932177dcc76721725", size = 173302, upload-time = "2024-08-06T20:32:26.511Z" },
    { url = "https://files.pythonhosted.org/packages/c3/93/9916574aa8c00aa06bbac729972eb1071d002b8e158bd0e83a3b9a20a1f7/PyYAML-6.0.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:1f71ea527786de97d1a0cc0eacd1defc0985dcf6b3f17bb77dcfc8c34bec4dc5", size = 739154, upload-time = "2024-08-06T20:32:28.363Z" },
    { url = "https://files.pythonhosted.org/packages/95/0f/b8938f1cbd09739c6da569d172531567dbcc9789e0029aa070856f123984/PyYAML-6.0.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:9b22676e8097e9e22e36d6b7bda33190d0d400f345f23d4065d48f4ca7ae0425", size = 766223, upload-time = "2024-08-06T20:32:30.058Z" },
    { url = "https://files.pythonhosted.org/packages/b9/2b/614b4752f2e127db5cc206abc23a8c19678e92b23c3db30fc86ab731d3bd/PyYAML-6.0.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:80bab7bfc629882493af4aa31a4cfa43a4c57c83813253626916b8c7ada83476", size = 767542, upload-time = "2024-08-06T20:32:31.881Z" },
    { url = "https://files.pythonhosted.org/packages/d4/00/dd137d5bcc7efea1836d6264f049359861cf548469d18da90cd8216cf05f/PyYAML-6.0.2-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:0833f8694549e586547b576dcfaba4a6b55b9e96098b36cdc7ebefe667dfed48", size = 731164, upload-time = "2024-08-06T20:32:37.083Z" },
    { url = "https://files.pythonhosted.org/packages/c9/1f/4f998c900485e5c0ef43838363ba4a9723ac0ad73a9dc42068b12aaba4e4/PyYAML-6.0.2-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:8b9c7197f7cb2738065c481a0461e50ad02f18c78cd75775628afb4d7137fb3b", size = 756611, upload-time = "2024-08-06T20:32:38.898Z" },
    { url = "https://files.pythonhosted.org/packages/df/d1/f5a275fdb252768b7a11ec63585bc38d0e87c9e05668a139fea92b80634c/PyYAML-6.0.2-cp312-cp312-win32.whl", hash = "sha256:ef6107725bd54b262d6dedcc2af448a266975032bc85ef0172c5f059da6325b4", size = 140591, upload-time = "2024-08-06T20:32:40.241Z" },
    { url = "https://files.pythonhosted.org/packages/0c/e8/4f648c598b17c3d06e8753d7d13d57542b30d56e6c2dedf9c331ae56312e/PyYAML-6.0.2-cp312-cp312-win_amd64.whl", hash = "sha256:7e7401d0de89a9a855c839bc697c079a4af81cf878373abd7dc625847d25cbd8", size = 156338, upload-time = "2024-08-06T20:32:41.93Z" },
    { url = "https://files.pythonhosted.org/packages/ef/e3/3af305b830494fa85d95f6d95ef7fa73f2ee1cc8ef5b495c7c3269fb835f/PyYAML-6.0.2-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:efdca5630322a10774e8e98e1af481aad470dd62c3170801852d752aa7a783ba", size = 181309, upload-time = "2024-08-06T20:32:43.4Z" },
    { url = "https://files.pythonhosted.org/packages/45/9f/3b1c20a0b7a3200524eb0076cc027a970d320bd3a6592873c85c92a08731/PyYAML-6.0.2-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:50187695423ffe49e2deacb8cd10510bc361faac997de9efef88badc3bb9e2d1", size = 171679, upload-time = "2024-08-06T20:32:44.801Z" },
    { url = "https://files.pythonhosted.org/packages/7c/9a/337322f27005c33bcb656c655fa78325b730324c78620e8328ae28b64d0c/PyYAML-6.0.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:0ffe8360bab4910ef1b9e87fb812d8bc0a308b0d0eef8c8f44e0254ab3b07133", size = 733428, upload-time = "2024-08-06T20:32:46.432Z" },
    { url = "https://files.pythonhosted.org/packages/a3/69/864fbe19e6c18ea3cc196cbe5d392175b4cf3d5d0ac1403ec3f2d237ebb5/PyYAML-6.0.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:17e311b6c678207928d649faa7cb0d7b4c26a0ba73d41e99c4fff6b6c3276484", size = 763361, upload-time = "2024-08-06T20:32:51.188Z" },
    { url = "https://files.pythonhosted.org/packages/04/24/b7721e4845c2f162d26f50521b825fb061bc0a5afcf9a386840f23ea19fa/PyYAML-6.0.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:70b189594dbe54f75ab3a1acec5f1e3faa7e8cf2f1e08d9b561cb41b845f69d5", size = 759523, upload-time = "2024-08-06T20:32:53.019Z" },
    { url = "https://files.pythonhosted.org/packages/2b/b2/e3234f59ba06559c6ff63c4e10baea10e5e7df868092bf9ab40e5b9c56b6/PyYAML-6.0.2-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:41e4e3953a79407c794916fa277a82531dd93aad34e29c2a514c2c0c5fe971cc", size = 726660, upload-time = "2024-08-06T20:32:54.708Z" },
    { url = "https://files.pythonhosted.org/packages/fe/0f/25911a9f080464c59fab9027482f822b86bf0608957a5fcc6eaac85aa515/PyYAML-6.0.2-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:68ccc6023a3400877818152ad9a1033e3db8625d899c72eacb5a668902e4d652", size = 751597, upload-time = "2024-08-06T20:32:56.985Z" },
    { url = "https://files.pythonhosted.org/packages/14/0d/e2c3b43bbce3cf6bd97c840b46088a3031085179e596d4929729d8d68270/PyYAML-6.0.2-cp313-cp313-win32.whl", hash = "sha256:bc2fa7c6b47d6bc618dd7fb02ef6fdedb1090ec036abab80d4681424b84c1183", size = 140527, upload-time = "2024-08-06T20:33:03.001Z" },
    { url = "https://files.pythonhosted.org/packages/fa/de/02b54f42487e3d3c6efb3f89428677074ca7bf43aae402517bc7cca949f3/PyYAML-6.0.2-cp313-cp313-win_amd64.whl", hash = "sha256:8388ee1976c416731879ac16da0aff3f63b286ffdd57cdeb95f3f2e085687563", size = 156446, upload-time = "2024-08-06T20:33:04.33Z" },
]

[[package]]
name = "realtime"
version = "2.5.3"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "typing-extensions" },
    { name = "websockets" },
]
sdist = { url = "https://files.pythonhosted.org/packages/48/94/3cf962b814303a1688eece56a94b25a7bd423d60705f1124cba0896c9c07/realtime-2.5.3.tar.gz", hash = "sha256:0587594f3bc1c84bf007ff625075b86db6528843e03250dc84f4f2808be3d99a", size = 18527, upload-time = "2025-06-26T22:39:01.59Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/fe/2a/f69c156a58d44b7b9ca22dab181b91e4d93d074f99923c75907bf3953d40/realtime-2.5.3-py3-none-any.whl", hash = "sha256:eb0994636946eff04c4c7f044f980c8c633c7eb632994f549f61053a474ac970", size = 21784, upload-time = "2025-06-26T22:38:59.98Z" },
]

[[package]]
name = "requests"
version = "2.32.4"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "certifi" },
    { name = "charset-normalizer" },
    { name = "idna" },
    { name = "urllib3" },
]
sdist = { url = "https://files.pythonhosted.org/packages/e1/0a/929373653770d8a0d7ea76c37de6e41f11eb07559b103b1c02cafb3f7cf8/requests-2.32.4.tar.gz", hash = "sha256:27d0316682c8a29834d3264820024b62a36942083d52caf2f14c0591336d3422", size = 135258, upload-time = "2025-06-09T16:43:07.34Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/7c/e4/56027c4a6b4ae70ca9de302488c5ca95ad4a39e190093d6c1a8ace08341b/requests-2.32.4-py3-none-any.whl", hash = "sha256:27babd3cda2a6d50b30443204ee89830707d396671944c998b5975b031ac2b2c", size = 64847, upload-time = "2025-06-09T16:43:05.728Z" },
]

[[package]]
name = "rsa"
version = "4.9.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "pyasn1" },
]
sdist = { url = "https://files.pythonhosted.org/packages/da/8a/22b7beea3ee0d44b1916c0c1cb0ee3af23b700b6da9f04991899d0c555d4/rsa-4.9.1.tar.gz", hash = "sha256:e7bdbfdb5497da4c07dfd35530e1a902659db6ff241e39d9953cad06ebd0ae75", size = 29034, upload-time = "2025-04-16T09:51:18.218Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/64/8d/0133e4eb4beed9e425d9a98ed6e081a55d195481b7632472be1af08d2f6b/rsa-4.9.1-py3-none-any.whl", hash = "sha256:68635866661c6836b8d39430f97a996acbd61bfa49406748ea243539fe239762", size = 34696, upload-time = "2025-04-16T09:51:17.142Z" },
]

[[package]]
name = "six"
version = "1.17.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/94/e7/b2c673351809dca68a0e064b6af791aa332cf192da575fd474ed7d6f16a2/six-1.17.0.tar.gz", hash = "sha256:ff70335d468e7eb6ec65b95b99d3a2836546063f63acc5171de367e834932a81", size = 34031, upload-time = "2024-12-04T17:35:28.174Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b7/ce/149a00dd41f10bc29e5921b496af8b574d8413afcd5e30dfa0ed46c2cc5e/six-1.17.0-py2.py3-none-any.whl", hash = "sha256:4721f391ed90541fddacab5acf947aa0d3dc7d27b2e1e8eda2be8970586c3274", size = 11050, upload-time = "2024-12-04T17:35:26.475Z" },
]

[[package]]
name = "sniffio"
version = "1.3.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/a2/87/a6771e1546d97e7e041b6ae58d80074f81b7d5121207425c964ddf5cfdbd/sniffio-1.3.1.tar.gz", hash = "sha256:f4324edc670a0f49750a81b895f35c3adb843cca46f0530f79fc1babb23789dc", size = 20372, upload-time = "2024-02-25T23:20:04.057Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/e9/44/75a9c9421471a6c4805dbf2356f7c181a29c1879239abab1ea2cc8f38b40/sniffio-1.3.1-py3-none-any.whl", hash = "sha256:2f6da418d1f1e0fddd844478f41680e794e6051915791a034ff65e5f100525a2", size = 10235, upload-time = "2024-02-25T23:20:01.196Z" },
]

[[package]]
name = "starlette"
version = "0.46.2"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "anyio" },
]
sdist = { url = "https://files.pythonhosted.org/packages/ce/20/08dfcd9c983f6a6f4a1000d934b9e6d626cff8d2eeb77a89a68eef20a2b7/starlette-0.46.2.tar.gz", hash = "sha256:7f7361f34eed179294600af672f565727419830b54b7b084efe44bb82d2fccd5", size = 2580846, upload-time = "2025-04-13T13:56:17.942Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/8b/0c/9d30a4ebeb6db2b25a841afbb80f6ef9a854fc3b41be131d249a977b4959/starlette-0.46.2-py3-none-any.whl", hash = "sha256:595633ce89f8ffa71a015caed34a5b2dc1c0cdb3f0f1fbd1e69339cf2abeec35", size = 72037, upload-time = "2025-04-13T13:56:16.21Z" },
]

[[package]]
name = "storage3"
version = "0.12.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "deprecation" },
    { name = "httpx", extra = ["http2"] },
    { name = "python-dateutil" },
]
sdist = { url = "https://files.pythonhosted.org/packages/c5/86/9eae84e8ad4ba73f575f3eaf5536d949f2fd7d6adc85829f9af04bce97e2/storage3-0.12.0.tar.gz", hash = "sha256:94243f20922d57738bf42e96b9f5582b4d166e8bf209eccf20b146909f3f71b0", size = 10024, upload-time = "2025-06-19T17:50:51.763Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/b0/7e/693d6d603db142eb5e6f3cb76eb6e9c439582b7539e2695e175e2de3ac44/storage3-0.12.0-py3-none-any.whl", hash = "sha256:1c4585693ca42243ded1512b58e54c697111e91a20916cd14783eebc37e7c87d", size = 18422, upload-time = "2025-06-19T17:50:50.294Z" },
]

[[package]]
name = "strenum"
version = "0.4.15"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/85/ad/430fb60d90e1d112a62ff57bdd1f286ec73a2a0331272febfddd21f330e1/StrEnum-0.4.15.tar.gz", hash = "sha256:878fb5ab705442070e4dd1929bb5e2249511c0bcf2b0eeacf3bcd80875c82eff", size = 23384, upload-time = "2023-06-29T22:02:58.399Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/81/69/297302c5f5f59c862faa31e6cb9a4cd74721cd1e052b38e464c5b402df8b/StrEnum-0.4.15-py3-none-any.whl", hash = "sha256:a30cda4af7cc6b5bf52c8055bc4bf4b2b6b14a93b574626da33df53cf7740659", size = 8851, upload-time = "2023-06-29T22:02:56.947Z" },
]

[[package]]
name = "study-scriber"
version = "0.1.0"
source = { virtual = "." }
dependencies = [
    { name = "aiofiles" },
    { name = "aiohttp" },
    { name = "fastapi" },
    { name = "google-generativeai" },
    { name = "gotrue" },
    { name = "httpx" },
    { name = "loguru" },
    { name = "openai" },
    { name = "postgrest" },
    { name = "prometheus-client" },
    { name = "psycopg2-binary" },
    { name = "pydantic" },
    { name = "pydantic-settings" },
    { name = "pytest" },
    { name = "pytest-asyncio" },
    { name = "python-dotenv" },
    { name = "python-multipart" },
    { name = "realtime" },
    { name = "storage3" },
    { name = "supabase" },
    { name = "uvicorn", extra = ["standard"] },
    { name = "uvloop" },
]

[package.optional-dependencies]
dev = [
    { name = "pytest" },
    { name = "pytest-asyncio" },
    { name = "pytest-cov" },
]

[package.metadata]
requires-dist = [
    { name = "aiofiles" },
    { name = "aiohttp" },
    { name = "fastapi" },
    { name = "google-generativeai" },
    { name = "gotrue" },
    { name = "httpx" },
    { name = "loguru" },
    { name = "openai" },
    { name = "postgrest" },
    { name = "prometheus-client" },
    { name = "psycopg2-binary" },
    { name = "pydantic" },
    { name = "pydantic-settings" },
    { name = "pytest", specifier = ">=8.0.0" },
    { name = "pytest", marker = "extra == 'dev'", specifier = ">=8.0.0" },
    { name = "pytest-asyncio", specifier = ">=0.23.0" },
    { name = "pytest-asyncio", marker = "extra == 'dev'", specifier = ">=0.23.0" },
    { name = "pytest-cov", marker = "extra == 'dev'", specifier = ">=4.0.0" },
    { name = "python-dotenv" },
    { name = "python-multipart" },
    { name = "realtime" },
    { name = "storage3" },
    { name = "supabase" },
    { name = "uvicorn", extras = ["standard"] },
    { name = "uvloop" },
]
provides-extras = ["dev"]

[[package]]
name = "supabase"
version = "2.16.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "gotrue" },
    { name = "httpx" },
    { name = "postgrest" },
    { name = "realtime" },
    { name = "storage3" },
    { name = "supafunc" },
]
sdist = { url = "https://files.pythonhosted.org/packages/c6/93/335b91e8d09a95a337f051f84e85495f7732400f10c1bcb698a7571f8f1c/supabase-2.16.0.tar.gz", hash = "sha256:98f3810158012d4ec0e3083f2e5515f5e10b32bd71e7d458662140e963c1d164", size = 14595, upload-time = "2025-06-23T16:09:29.504Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/7e/75/2ab71e6605d20a740ff041c6176a328cfaa3fcee0dd0db885e081d98df06/supabase-2.16.0-py3-none-any.whl", hash = "sha256:99065caab3d90a56650bf39fbd0e49740995da3738ab28706c61bd7f2401db55", size = 17713, upload-time = "2025-06-23T16:09:28.299Z" },
]

[[package]]
name = "supafunc"
version = "0.10.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "httpx", extra = ["http2"] },
    { name = "strenum" },
]
sdist = { url = "https://files.pythonhosted.org/packages/e8/4b/16f94bcae8a49f5e09544a4fb0e6ad1c2288038036cefdeedb72fcffd92c/supafunc-0.10.1.tar.gz", hash = "sha256:a5b33c8baecb6b5297d25da29a2503e2ec67ee6986f3d44c137e651b8a59a17d", size = 5036, upload-time = "2025-06-23T18:26:50.327Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/76/4a/9cbea12d86a741d4e73a6e278c2b1d6479fb03d1002efb00e8e71aea76db/supafunc-0.10.1-py3-none-any.whl", hash = "sha256:26df9bd25ff2ef56cb5bfb8962de98f43331f7f8ff69572bac3ed9c3a9672040", size = 8028, upload-time = "2025-06-23T18:26:49.176Z" },
]

[[package]]
name = "tqdm"
version = "4.67.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
]
sdist = { url = "https://files.pythonhosted.org/packages/a8/4b/29b4ef32e036bb34e4ab51796dd745cdba7ed47ad142a9f4a1eb8e0c744d/tqdm-4.67.1.tar.gz", hash = "sha256:f8aef9c52c08c13a65f30ea34f4e5aac3fd1a34959879d7e59e63027286627f2", size = 169737, upload-time = "2024-11-24T20:12:22.481Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d0/30/dc54f88dd4a2b5dc8a0279bdd7270e735851848b762aeb1c1184ed1f6b14/tqdm-4.67.1-py3-none-any.whl", hash = "sha256:26445eca388f82e72884e0d580d5464cd801a3ea01e63e5601bdff9ba6a48de2", size = 78540, upload-time = "2024-11-24T20:12:19.698Z" },
]

[[package]]
name = "typing-extensions"
version = "4.14.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/d1/bc/51647cd02527e87d05cb083ccc402f93e441606ff1f01739a62c8ad09ba5/typing_extensions-4.14.0.tar.gz", hash = "sha256:8676b788e32f02ab42d9e7c61324048ae4c6d844a399eebace3d4979d75ceef4", size = 107423, upload-time = "2025-06-02T14:52:11.399Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/69/e0/552843e0d356fbb5256d21449fa957fa4eff3bbc135a74a691ee70c7c5da/typing_extensions-4.14.0-py3-none-any.whl", hash = "sha256:a1514509136dd0b477638fc68d6a91497af5076466ad0fa6c338e44e359944af", size = 43839, upload-time = "2025-06-02T14:52:10.026Z" },
]

[[package]]
name = "typing-inspection"
version = "0.4.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "typing-extensions" },
]
sdist = { url = "https://files.pythonhosted.org/packages/f8/b1/0c11f5058406b3af7609f121aaa6b609744687f1d158b3c3a5bf4cc94238/typing_inspection-0.4.1.tar.gz", hash = "sha256:6ae134cc0203c33377d43188d4064e9b357dba58cff3185f22924610e70a9d28", size = 75726, upload-time = "2025-05-21T18:55:23.885Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/17/69/cd203477f944c353c31bade965f880aa1061fd6bf05ded0726ca845b6ff7/typing_inspection-0.4.1-py3-none-any.whl", hash = "sha256:389055682238f53b04f7badcb49b989835495a96700ced5dab2d8feae4b26f51", size = 14552, upload-time = "2025-05-21T18:55:22.152Z" },
]

[[package]]
name = "uritemplate"
version = "4.2.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/98/60/f174043244c5306c9988380d2cb10009f91563fc4b31293d27e17201af56/uritemplate-4.2.0.tar.gz", hash = "sha256:480c2ed180878955863323eea31b0ede668795de182617fef9c6ca09e6ec9d0e", size = 33267, upload-time = "2025-06-02T15:12:06.318Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a9/99/3ae339466c9183ea5b8ae87b34c0b897eda475d2aec2307cae60e5cd4f29/uritemplate-4.2.0-py3-none-any.whl", hash = "sha256:962201ba1c4edcab02e60f9a0d3821e82dfc5d2d6662a21abd533879bdb8a686", size = 11488, upload-time = "2025-06-02T15:12:03.405Z" },
]

[[package]]
name = "urllib3"
version = "2.5.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/15/22/9ee70a2574a4f4599c47dd506532914ce044817c7752a79b6a51286319bc/urllib3-2.5.0.tar.gz", hash = "sha256:3fc47733c7e419d4bc3f6b3dc2b4f890bb743906a30d56ba4a5bfa4bbff92760", size = 393185, upload-time = "2025-06-18T14:07:41.644Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/a7/c2/fe1e52489ae3122415c51f387e221dd0773709bad6c6cdaa599e8a2c5185/urllib3-2.5.0-py3-none-any.whl", hash = "sha256:e6b01673c0fa6a13e374b50871808eb3bf7046c4b125b216f6bf1cc604cff0dc", size = 129795, upload-time = "2025-06-18T14:07:40.39Z" },
]

[[package]]
name = "uvicorn"
version = "0.35.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "click" },
    { name = "h11" },
]
sdist = { url = "https://files.pythonhosted.org/packages/5e/42/e0e305207bb88c6b8d3061399c6a961ffe5fbb7e2aa63c9234df7259e9cd/uvicorn-0.35.0.tar.gz", hash = "sha256:bc662f087f7cf2ce11a1d7fd70b90c9f98ef2e2831556dd078d131b96cc94a01", size = 78473, upload-time = "2025-06-28T16:15:46.058Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d2/e2/dc81b1bd1dcfe91735810265e9d26bc8ec5da45b4c0f6237e286819194c3/uvicorn-0.35.0-py3-none-any.whl", hash = "sha256:197535216b25ff9b785e29a0b79199f55222193d47f820816e7da751e9bc8d4a", size = 66406, upload-time = "2025-06-28T16:15:44.816Z" },
]

[package.optional-dependencies]
standard = [
    { name = "colorama", marker = "sys_platform == 'win32'" },
    { name = "httptools" },
    { name = "python-dotenv" },
    { name = "pyyaml" },
    { name = "uvloop", marker = "platform_python_implementation != 'PyPy' and sys_platform != 'cygwin' and sys_platform != 'win32'" },
    { name = "watchfiles" },
    { name = "websockets" },
]

[[package]]
name = "uvloop"
version = "0.21.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/af/c0/854216d09d33c543f12a44b393c402e89a920b1a0a7dc634c42de91b9cf6/uvloop-0.21.0.tar.gz", hash = "sha256:3bf12b0fda68447806a7ad847bfa591613177275d35b6724b1ee573faa3704e3", size = 2492741, upload-time = "2024-10-14T23:38:35.489Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/8c/4c/03f93178830dc7ce8b4cdee1d36770d2f5ebb6f3d37d354e061eefc73545/uvloop-0.21.0-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:359ec2c888397b9e592a889c4d72ba3d6befba8b2bb01743f72fffbde663b59c", size = 1471284, upload-time = "2024-10-14T23:37:47.833Z" },
    { url = "https://files.pythonhosted.org/packages/43/3e/92c03f4d05e50f09251bd8b2b2b584a2a7f8fe600008bcc4523337abe676/uvloop-0.21.0-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:f7089d2dc73179ce5ac255bdf37c236a9f914b264825fdaacaded6990a7fb4c2", size = 821349, upload-time = "2024-10-14T23:37:50.149Z" },
    { url = "https://files.pythonhosted.org/packages/a6/ef/a02ec5da49909dbbfb1fd205a9a1ac4e88ea92dcae885e7c961847cd51e2/uvloop-0.21.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:baa4dcdbd9ae0a372f2167a207cd98c9f9a1ea1188a8a526431eef2f8116cc8d", size = 4580089, upload-time = "2024-10-14T23:37:51.703Z" },
    { url = "https://files.pythonhosted.org/packages/06/a7/b4e6a19925c900be9f98bec0a75e6e8f79bb53bdeb891916609ab3958967/uvloop-0.21.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:86975dca1c773a2c9864f4c52c5a55631038e387b47eaf56210f873887b6c8dc", size = 4693770, upload-time = "2024-10-14T23:37:54.122Z" },
    { url = "https://files.pythonhosted.org/packages/ce/0c/f07435a18a4b94ce6bd0677d8319cd3de61f3a9eeb1e5f8ab4e8b5edfcb3/uvloop-0.21.0-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:461d9ae6660fbbafedd07559c6a2e57cd553b34b0065b6550685f6653a98c1cb", size = 4451321, upload-time = "2024-10-14T23:37:55.766Z" },
    { url = "https://files.pythonhosted.org/packages/8f/eb/f7032be105877bcf924709c97b1bf3b90255b4ec251f9340cef912559f28/uvloop-0.21.0-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:183aef7c8730e54c9a3ee3227464daed66e37ba13040bb3f350bc2ddc040f22f", size = 4659022, upload-time = "2024-10-14T23:37:58.195Z" },
    { url = "https://files.pythonhosted.org/packages/3f/8d/2cbef610ca21539f0f36e2b34da49302029e7c9f09acef0b1c3b5839412b/uvloop-0.21.0-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:bfd55dfcc2a512316e65f16e503e9e450cab148ef11df4e4e679b5e8253a5281", size = 1468123, upload-time = "2024-10-14T23:38:00.688Z" },
    { url = "https://files.pythonhosted.org/packages/93/0d/b0038d5a469f94ed8f2b2fce2434a18396d8fbfb5da85a0a9781ebbdec14/uvloop-0.21.0-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:787ae31ad8a2856fc4e7c095341cccc7209bd657d0e71ad0dc2ea83c4a6fa8af", size = 819325, upload-time = "2024-10-14T23:38:02.309Z" },
    { url = "https://files.pythonhosted.org/packages/50/94/0a687f39e78c4c1e02e3272c6b2ccdb4e0085fda3b8352fecd0410ccf915/uvloop-0.21.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:5ee4d4ef48036ff6e5cfffb09dd192c7a5027153948d85b8da7ff705065bacc6", size = 4582806, upload-time = "2024-10-14T23:38:04.711Z" },
    { url = "https://files.pythonhosted.org/packages/d2/19/f5b78616566ea68edd42aacaf645adbf71fbd83fc52281fba555dc27e3f1/uvloop-0.21.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:f3df876acd7ec037a3d005b3ab85a7e4110422e4d9c1571d4fc89b0fc41b6816", size = 4701068, upload-time = "2024-10-14T23:38:06.385Z" },
    { url = "https://files.pythonhosted.org/packages/47/57/66f061ee118f413cd22a656de622925097170b9380b30091b78ea0c6ea75/uvloop-0.21.0-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:bd53ecc9a0f3d87ab847503c2e1552b690362e005ab54e8a48ba97da3924c0dc", size = 4454428, upload-time = "2024-10-14T23:38:08.416Z" },
    { url = "https://files.pythonhosted.org/packages/63/9a/0962b05b308494e3202d3f794a6e85abe471fe3cafdbcf95c2e8c713aabd/uvloop-0.21.0-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:a5c39f217ab3c663dc699c04cbd50c13813e31d917642d459fdcec07555cc553", size = 4660018, upload-time = "2024-10-14T23:38:10.888Z" },
]

[[package]]
name = "watchfiles"
version = "1.1.0"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "anyio" },
]
sdist = { url = "https://files.pythonhosted.org/packages/2a/9a/d451fcc97d029f5812e898fd30a53fd8c15c7bbd058fd75cfc6beb9bd761/watchfiles-1.1.0.tar.gz", hash = "sha256:693ed7ec72cbfcee399e92c895362b6e66d63dac6b91e2c11ae03d10d503e575", size = 94406, upload-time = "2025-06-15T19:06:59.42Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/f6/b8/858957045a38a4079203a33aaa7d23ea9269ca7761c8a074af3524fbb240/watchfiles-1.1.0-cp312-cp312-macosx_10_12_x86_64.whl", hash = "sha256:9dc001c3e10de4725c749d4c2f2bdc6ae24de5a88a339c4bce32300a31ede179", size = 402339, upload-time = "2025-06-15T19:05:24.516Z" },
    { url = "https://files.pythonhosted.org/packages/80/28/98b222cca751ba68e88521fabd79a4fab64005fc5976ea49b53fa205d1fa/watchfiles-1.1.0-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:d9ba68ec283153dead62cbe81872d28e053745f12335d037de9cbd14bd1877f5", size = 394409, upload-time = "2025-06-15T19:05:25.469Z" },
    { url = "https://files.pythonhosted.org/packages/86/50/dee79968566c03190677c26f7f47960aff738d32087087bdf63a5473e7df/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:130fc497b8ee68dce163e4254d9b0356411d1490e868bd8790028bc46c5cc297", size = 450939, upload-time = "2025-06-15T19:05:26.494Z" },
    { url = "https://files.pythonhosted.org/packages/40/45/a7b56fb129700f3cfe2594a01aa38d033b92a33dddce86c8dfdfc1247b72/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:50a51a90610d0845a5931a780d8e51d7bd7f309ebc25132ba975aca016b576a0", size = 457270, upload-time = "2025-06-15T19:05:27.466Z" },
    { url = "https://files.pythonhosted.org/packages/b5/c8/fa5ef9476b1d02dc6b5e258f515fcaaecf559037edf8b6feffcbc097c4b8/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:dc44678a72ac0910bac46fa6a0de6af9ba1355669b3dfaf1ce5f05ca7a74364e", size = 483370, upload-time = "2025-06-15T19:05:28.548Z" },
    { url = "https://files.pythonhosted.org/packages/98/68/42cfcdd6533ec94f0a7aab83f759ec11280f70b11bfba0b0f885e298f9bd/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:a543492513a93b001975ae283a51f4b67973662a375a403ae82f420d2c7205ee", size = 598654, upload-time = "2025-06-15T19:05:29.997Z" },
    { url = "https://files.pythonhosted.org/packages/d3/74/b2a1544224118cc28df7e59008a929e711f9c68ce7d554e171b2dc531352/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8ac164e20d17cc285f2b94dc31c384bc3aa3dd5e7490473b3db043dd70fbccfd", size = 478667, upload-time = "2025-06-15T19:05:31.172Z" },
    { url = "https://files.pythonhosted.org/packages/8c/77/e3362fe308358dc9f8588102481e599c83e1b91c2ae843780a7ded939a35/watchfiles-1.1.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:f7590d5a455321e53857892ab8879dce62d1f4b04748769f5adf2e707afb9d4f", size = 452213, upload-time = "2025-06-15T19:05:32.299Z" },
    { url = "https://files.pythonhosted.org/packages/6e/17/c8f1a36540c9a1558d4faf08e909399e8133599fa359bf52ec8fcee5be6f/watchfiles-1.1.0-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:37d3d3f7defb13f62ece99e9be912afe9dd8a0077b7c45ee5a57c74811d581a4", size = 626718, upload-time = "2025-06-15T19:05:33.415Z" },
    { url = "https://files.pythonhosted.org/packages/26/45/fb599be38b4bd38032643783d7496a26a6f9ae05dea1a42e58229a20ac13/watchfiles-1.1.0-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:7080c4bb3efd70a07b1cc2df99a7aa51d98685be56be6038c3169199d0a1c69f", size = 623098, upload-time = "2025-06-15T19:05:34.534Z" },
    { url = "https://files.pythonhosted.org/packages/a1/e7/fdf40e038475498e160cd167333c946e45d8563ae4dd65caf757e9ffe6b4/watchfiles-1.1.0-cp312-cp312-win32.whl", hash = "sha256:cbcf8630ef4afb05dc30107bfa17f16c0896bb30ee48fc24bf64c1f970f3b1fd", size = 279209, upload-time = "2025-06-15T19:05:35.577Z" },
    { url = "https://files.pythonhosted.org/packages/3f/d3/3ae9d5124ec75143bdf088d436cba39812122edc47709cd2caafeac3266f/watchfiles-1.1.0-cp312-cp312-win_amd64.whl", hash = "sha256:cbd949bdd87567b0ad183d7676feb98136cde5bb9025403794a4c0db28ed3a47", size = 292786, upload-time = "2025-06-15T19:05:36.559Z" },
    { url = "https://files.pythonhosted.org/packages/26/2f/7dd4fc8b5f2b34b545e19629b4a018bfb1de23b3a496766a2c1165ca890d/watchfiles-1.1.0-cp312-cp312-win_arm64.whl", hash = "sha256:0a7d40b77f07be87c6faa93d0951a0fcd8cbca1ddff60a1b65d741bac6f3a9f6", size = 284343, upload-time = "2025-06-15T19:05:37.5Z" },
    { url = "https://files.pythonhosted.org/packages/d3/42/fae874df96595556a9089ade83be34a2e04f0f11eb53a8dbf8a8a5e562b4/watchfiles-1.1.0-cp313-cp313-macosx_10_12_x86_64.whl", hash = "sha256:5007f860c7f1f8df471e4e04aaa8c43673429047d63205d1630880f7637bca30", size = 402004, upload-time = "2025-06-15T19:05:38.499Z" },
    { url = "https://files.pythonhosted.org/packages/fa/55/a77e533e59c3003d9803c09c44c3651224067cbe7fb5d574ddbaa31e11ca/watchfiles-1.1.0-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:20ecc8abbd957046f1fe9562757903f5eaf57c3bce70929fda6c7711bb58074a", size = 393671, upload-time = "2025-06-15T19:05:39.52Z" },
    { url = "https://files.pythonhosted.org/packages/05/68/b0afb3f79c8e832e6571022611adbdc36e35a44e14f129ba09709aa4bb7a/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:f2f0498b7d2a3c072766dba3274fe22a183dbea1f99d188f1c6c72209a1063dc", size = 449772, upload-time = "2025-06-15T19:05:40.897Z" },
    { url = "https://files.pythonhosted.org/packages/ff/05/46dd1f6879bc40e1e74c6c39a1b9ab9e790bf1f5a2fe6c08b463d9a807f4/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:239736577e848678e13b201bba14e89718f5c2133dfd6b1f7846fa1b58a8532b", size = 456789, upload-time = "2025-06-15T19:05:42.045Z" },
    { url = "https://files.pythonhosted.org/packages/8b/ca/0eeb2c06227ca7f12e50a47a3679df0cd1ba487ea19cf844a905920f8e95/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:eff4b8d89f444f7e49136dc695599a591ff769300734446c0a86cba2eb2f9895", size = 482551, upload-time = "2025-06-15T19:05:43.781Z" },
    { url = "https://files.pythonhosted.org/packages/31/47/2cecbd8694095647406645f822781008cc524320466ea393f55fe70eed3b/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:12b0a02a91762c08f7264e2e79542f76870c3040bbc847fb67410ab81474932a", size = 597420, upload-time = "2025-06-15T19:05:45.244Z" },
    { url = "https://files.pythonhosted.org/packages/d9/7e/82abc4240e0806846548559d70f0b1a6dfdca75c1b4f9fa62b504ae9b083/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:29e7bc2eee15cbb339c68445959108803dc14ee0c7b4eea556400131a8de462b", size = 477950, upload-time = "2025-06-15T19:05:46.332Z" },
    { url = "https://files.pythonhosted.org/packages/25/0d/4d564798a49bf5482a4fa9416dea6b6c0733a3b5700cb8a5a503c4b15853/watchfiles-1.1.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:d9481174d3ed982e269c090f780122fb59cee6c3796f74efe74e70f7780ed94c", size = 451706, upload-time = "2025-06-15T19:05:47.459Z" },
    { url = "https://files.pythonhosted.org/packages/81/b5/5516cf46b033192d544102ea07c65b6f770f10ed1d0a6d388f5d3874f6e4/watchfiles-1.1.0-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:80f811146831c8c86ab17b640801c25dc0a88c630e855e2bef3568f30434d52b", size = 625814, upload-time = "2025-06-15T19:05:48.654Z" },
    { url = "https://files.pythonhosted.org/packages/0c/dd/7c1331f902f30669ac3e754680b6edb9a0dd06dea5438e61128111fadd2c/watchfiles-1.1.0-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:60022527e71d1d1fda67a33150ee42869042bce3d0fcc9cc49be009a9cded3fb", size = 622820, upload-time = "2025-06-15T19:05:50.088Z" },
    { url = "https://files.pythonhosted.org/packages/1b/14/36d7a8e27cd128d7b1009e7715a7c02f6c131be9d4ce1e5c3b73d0e342d8/watchfiles-1.1.0-cp313-cp313-win32.whl", hash = "sha256:32d6d4e583593cb8576e129879ea0991660b935177c0f93c6681359b3654bfa9", size = 279194, upload-time = "2025-06-15T19:05:51.186Z" },
    { url = "https://files.pythonhosted.org/packages/25/41/2dd88054b849aa546dbeef5696019c58f8e0774f4d1c42123273304cdb2e/watchfiles-1.1.0-cp313-cp313-win_amd64.whl", hash = "sha256:f21af781a4a6fbad54f03c598ab620e3a77032c5878f3d780448421a6e1818c7", size = 292349, upload-time = "2025-06-15T19:05:52.201Z" },
    { url = "https://files.pythonhosted.org/packages/c8/cf/421d659de88285eb13941cf11a81f875c176f76a6d99342599be88e08d03/watchfiles-1.1.0-cp313-cp313-win_arm64.whl", hash = "sha256:5366164391873ed76bfdf618818c82084c9db7fac82b64a20c44d335eec9ced5", size = 283836, upload-time = "2025-06-15T19:05:53.265Z" },
    { url = "https://files.pythonhosted.org/packages/45/10/6faf6858d527e3599cc50ec9fcae73590fbddc1420bd4fdccfebffeedbc6/watchfiles-1.1.0-cp313-cp313t-macosx_10_12_x86_64.whl", hash = "sha256:17ab167cca6339c2b830b744eaf10803d2a5b6683be4d79d8475d88b4a8a4be1", size = 400343, upload-time = "2025-06-15T19:05:54.252Z" },
    { url = "https://files.pythonhosted.org/packages/03/20/5cb7d3966f5e8c718006d0e97dfe379a82f16fecd3caa7810f634412047a/watchfiles-1.1.0-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:328dbc9bff7205c215a7807da7c18dce37da7da718e798356212d22696404339", size = 392916, upload-time = "2025-06-15T19:05:55.264Z" },
    { url = "https://files.pythonhosted.org/packages/8c/07/d8f1176328fa9e9581b6f120b017e286d2a2d22ae3f554efd9515c8e1b49/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:f7208ab6e009c627b7557ce55c465c98967e8caa8b11833531fdf95799372633", size = 449582, upload-time = "2025-06-15T19:05:56.317Z" },
    { url = "https://files.pythonhosted.org/packages/66/e8/80a14a453cf6038e81d072a86c05276692a1826471fef91df7537dba8b46/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:a8f6f72974a19efead54195bc9bed4d850fc047bb7aa971268fd9a8387c89011", size = 456752, upload-time = "2025-06-15T19:05:57.359Z" },
    { url = "https://files.pythonhosted.org/packages/5a/25/0853b3fe0e3c2f5af9ea60eb2e781eade939760239a72c2d38fc4cc335f6/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:d181ef50923c29cf0450c3cd47e2f0557b62218c50b2ab8ce2ecaa02bd97e670", size = 481436, upload-time = "2025-06-15T19:05:58.447Z" },
    { url = "https://files.pythonhosted.org/packages/fe/9e/4af0056c258b861fbb29dcb36258de1e2b857be4a9509e6298abcf31e5c9/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:adb4167043d3a78280d5d05ce0ba22055c266cf8655ce942f2fb881262ff3cdf", size = 596016, upload-time = "2025-06-15T19:05:59.59Z" },
    { url = "https://files.pythonhosted.org/packages/c5/fa/95d604b58aa375e781daf350897aaaa089cff59d84147e9ccff2447c8294/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8c5701dc474b041e2934a26d31d39f90fac8a3dee2322b39f7729867f932b1d4", size = 476727, upload-time = "2025-06-15T19:06:01.086Z" },
    { url = "https://files.pythonhosted.org/packages/65/95/fe479b2664f19be4cf5ceeb21be05afd491d95f142e72d26a42f41b7c4f8/watchfiles-1.1.0-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:b067915e3c3936966a8607f6fe5487df0c9c4afb85226613b520890049deea20", size = 451864, upload-time = "2025-06-15T19:06:02.144Z" },
    { url = "https://files.pythonhosted.org/packages/d3/8a/3c4af14b93a15ce55901cd7a92e1a4701910f1768c78fb30f61d2b79785b/watchfiles-1.1.0-cp313-cp313t-musllinux_1_1_aarch64.whl", hash = "sha256:9c733cda03b6d636b4219625a4acb5c6ffb10803338e437fb614fef9516825ef", size = 625626, upload-time = "2025-06-15T19:06:03.578Z" },
    { url = "https://files.pythonhosted.org/packages/da/f5/cf6aa047d4d9e128f4b7cde615236a915673775ef171ff85971d698f3c2c/watchfiles-1.1.0-cp313-cp313t-musllinux_1_1_x86_64.whl", hash = "sha256:cc08ef8b90d78bfac66f0def80240b0197008e4852c9f285907377b2947ffdcb", size = 622744, upload-time = "2025-06-15T19:06:05.066Z" },
    { url = "https://files.pythonhosted.org/packages/2c/00/70f75c47f05dea6fd30df90f047765f6fc2d6eb8b5a3921379b0b04defa2/watchfiles-1.1.0-cp314-cp314-macosx_10_12_x86_64.whl", hash = "sha256:9974d2f7dc561cce3bb88dfa8eb309dab64c729de85fba32e98d75cf24b66297", size = 402114, upload-time = "2025-06-15T19:06:06.186Z" },
    { url = "https://files.pythonhosted.org/packages/53/03/acd69c48db4a1ed1de26b349d94077cca2238ff98fd64393f3e97484cae6/watchfiles-1.1.0-cp314-cp314-macosx_11_0_arm64.whl", hash = "sha256:c68e9f1fcb4d43798ad8814c4c1b61547b014b667216cb754e606bfade587018", size = 393879, upload-time = "2025-06-15T19:06:07.369Z" },
    { url = "https://files.pythonhosted.org/packages/2f/c8/a9a2a6f9c8baa4eceae5887fecd421e1b7ce86802bcfc8b6a942e2add834/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:95ab1594377effac17110e1352989bdd7bdfca9ff0e5eeccd8c69c5389b826d0", size = 450026, upload-time = "2025-06-15T19:06:08.476Z" },
    { url = "https://files.pythonhosted.org/packages/fe/51/d572260d98388e6e2b967425c985e07d47ee6f62e6455cefb46a6e06eda5/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:fba9b62da882c1be1280a7584ec4515d0a6006a94d6e5819730ec2eab60ffe12", size = 457917, upload-time = "2025-06-15T19:06:09.988Z" },
    { url = "https://files.pythonhosted.org/packages/c6/2d/4258e52917bf9f12909b6ec314ff9636276f3542f9d3807d143f27309104/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3434e401f3ce0ed6b42569128b3d1e3af773d7ec18751b918b89cd49c14eaafb", size = 483602, upload-time = "2025-06-15T19:06:11.088Z" },
    { url = "https://files.pythonhosted.org/packages/84/99/bee17a5f341a4345fe7b7972a475809af9e528deba056f8963d61ea49f75/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:fa257a4d0d21fcbca5b5fcba9dca5a78011cb93c0323fb8855c6d2dfbc76eb77", size = 596758, upload-time = "2025-06-15T19:06:12.197Z" },
    { url = "https://files.pythonhosted.org/packages/40/76/e4bec1d59b25b89d2b0716b41b461ed655a9a53c60dc78ad5771fda5b3e6/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:7fd1b3879a578a8ec2076c7961076df540b9af317123f84569f5a9ddee64ce92", size = 477601, upload-time = "2025-06-15T19:06:13.391Z" },
    { url = "https://files.pythonhosted.org/packages/1f/fa/a514292956f4a9ce3c567ec0c13cce427c158e9f272062685a8a727d08fc/watchfiles-1.1.0-cp314-cp314-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:62cc7a30eeb0e20ecc5f4bd113cd69dcdb745a07c68c0370cea919f373f65d9e", size = 451936, upload-time = "2025-06-15T19:06:14.656Z" },
    { url = "https://files.pythonhosted.org/packages/32/5d/c3bf927ec3bbeb4566984eba8dd7a8eb69569400f5509904545576741f88/watchfiles-1.1.0-cp314-cp314-musllinux_1_1_aarch64.whl", hash = "sha256:891c69e027748b4a73847335d208e374ce54ca3c335907d381fde4e41661b13b", size = 626243, upload-time = "2025-06-15T19:06:16.232Z" },
    { url = "https://files.pythonhosted.org/packages/e6/65/6e12c042f1a68c556802a84d54bb06d35577c81e29fba14019562479159c/watchfiles-1.1.0-cp314-cp314-musllinux_1_1_x86_64.whl", hash = "sha256:12fe8eaffaf0faa7906895b4f8bb88264035b3f0243275e0bf24af0436b27259", size = 623073, upload-time = "2025-06-15T19:06:17.457Z" },
    { url = "https://files.pythonhosted.org/packages/89/ab/7f79d9bf57329e7cbb0a6fd4c7bd7d0cee1e4a8ef0041459f5409da3506c/watchfiles-1.1.0-cp314-cp314t-macosx_10_12_x86_64.whl", hash = "sha256:bfe3c517c283e484843cb2e357dd57ba009cff351edf45fb455b5fbd1f45b15f", size = 400872, upload-time = "2025-06-15T19:06:18.57Z" },
    { url = "https://files.pythonhosted.org/packages/df/d5/3f7bf9912798e9e6c516094db6b8932df53b223660c781ee37607030b6d3/watchfiles-1.1.0-cp314-cp314t-macosx_11_0_arm64.whl", hash = "sha256:a9ccbf1f129480ed3044f540c0fdbc4ee556f7175e5ab40fe077ff6baf286d4e", size = 392877, upload-time = "2025-06-15T19:06:19.55Z" },
    { url = "https://files.pythonhosted.org/packages/0d/c5/54ec7601a2798604e01c75294770dbee8150e81c6e471445d7601610b495/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:ba0e3255b0396cac3cc7bbace76404dd72b5438bf0d8e7cefa2f79a7f3649caa", size = 449645, upload-time = "2025-06-15T19:06:20.66Z" },
    { url = "https://files.pythonhosted.org/packages/0a/04/c2f44afc3b2fce21ca0b7802cbd37ed90a29874f96069ed30a36dfe57c2b/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:4281cd9fce9fc0a9dbf0fc1217f39bf9cf2b4d315d9626ef1d4e87b84699e7e8", size = 457424, upload-time = "2025-06-15T19:06:21.712Z" },
    { url = "https://files.pythonhosted.org/packages/9f/b0/eec32cb6c14d248095261a04f290636da3df3119d4040ef91a4a50b29fa5/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:6d2404af8db1329f9a3c9b79ff63e0ae7131986446901582067d9304ae8aaf7f", size = 481584, upload-time = "2025-06-15T19:06:22.777Z" },
    { url = "https://files.pythonhosted.org/packages/d1/e2/ca4bb71c68a937d7145aa25709e4f5d68eb7698a25ce266e84b55d591bbd/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:e78b6ed8165996013165eeabd875c5dfc19d41b54f94b40e9fff0eb3193e5e8e", size = 596675, upload-time = "2025-06-15T19:06:24.226Z" },
    { url = "https://files.pythonhosted.org/packages/a1/dd/b0e4b7fb5acf783816bc950180a6cd7c6c1d2cf7e9372c0ea634e722712b/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:249590eb75ccc117f488e2fabd1bfa33c580e24b96f00658ad88e38844a040bb", size = 477363, upload-time = "2025-06-15T19:06:25.42Z" },
    { url = "https://files.pythonhosted.org/packages/69/c4/088825b75489cb5b6a761a4542645718893d395d8c530b38734f19da44d2/watchfiles-1.1.0-cp314-cp314t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:d05686b5487cfa2e2c28ff1aa370ea3e6c5accfe6435944ddea1e10d93872147", size = 452240, upload-time = "2025-06-15T19:06:26.552Z" },
    { url = "https://files.pythonhosted.org/packages/10/8c/22b074814970eeef43b7c44df98c3e9667c1f7bf5b83e0ff0201b0bd43f9/watchfiles-1.1.0-cp314-cp314t-musllinux_1_1_aarch64.whl", hash = "sha256:d0e10e6f8f6dc5762adee7dece33b722282e1f59aa6a55da5d493a97282fedd8", size = 625607, upload-time = "2025-06-15T19:06:27.606Z" },
    { url = "https://files.pythonhosted.org/packages/32/fa/a4f5c2046385492b2273213ef815bf71a0d4c1943b784fb904e184e30201/watchfiles-1.1.0-cp314-cp314t-musllinux_1_1_x86_64.whl", hash = "sha256:af06c863f152005c7592df1d6a7009c836a247c9d8adb78fef8575a5a98699db", size = 623315, upload-time = "2025-06-15T19:06:29.076Z" },
]

[[package]]
name = "websockets"
version = "15.0.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/21/e6/26d09fab466b7ca9c7737474c52be4f76a40301b08362eb2dbc19dcc16c1/websockets-15.0.1.tar.gz", hash = "sha256:82544de02076bafba038ce055ee6412d68da13ab47f0c60cab827346de828dee", size = 177016, upload-time = "2025-03-05T20:03:41.606Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/51/6b/4545a0d843594f5d0771e86463606a3988b5a09ca5123136f8a76580dd63/websockets-15.0.1-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:3e90baa811a5d73f3ca0bcbf32064d663ed81318ab225ee4f427ad4e26e5aff3", size = 175437, upload-time = "2025-03-05T20:02:16.706Z" },
    { url = "https://files.pythonhosted.org/packages/f4/71/809a0f5f6a06522af902e0f2ea2757f71ead94610010cf570ab5c98e99ed/websockets-15.0.1-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:592f1a9fe869c778694f0aa806ba0374e97648ab57936f092fd9d87f8bc03665", size = 173096, upload-time = "2025-03-05T20:02:18.832Z" },
    { url = "https://files.pythonhosted.org/packages/3d/69/1a681dd6f02180916f116894181eab8b2e25b31e484c5d0eae637ec01f7c/websockets-15.0.1-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:0701bc3cfcb9164d04a14b149fd74be7347a530ad3bbf15ab2c678a2cd3dd9a2", size = 173332, upload-time = "2025-03-05T20:02:20.187Z" },
    { url = "https://files.pythonhosted.org/packages/a6/02/0073b3952f5bce97eafbb35757f8d0d54812b6174ed8dd952aa08429bcc3/websockets-15.0.1-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:e8b56bdcdb4505c8078cb6c7157d9811a85790f2f2b3632c7d1462ab5783d215", size = 183152, upload-time = "2025-03-05T20:02:22.286Z" },
    { url = "https://files.pythonhosted.org/packages/74/45/c205c8480eafd114b428284840da0b1be9ffd0e4f87338dc95dc6ff961a1/websockets-15.0.1-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:0af68c55afbd5f07986df82831c7bff04846928ea8d1fd7f30052638788bc9b5", size = 182096, upload-time = "2025-03-05T20:02:24.368Z" },
    { url = "https://files.pythonhosted.org/packages/14/8f/aa61f528fba38578ec553c145857a181384c72b98156f858ca5c8e82d9d3/websockets-15.0.1-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:64dee438fed052b52e4f98f76c5790513235efaa1ef7f3f2192c392cd7c91b65", size = 182523, upload-time = "2025-03-05T20:02:25.669Z" },
    { url = "https://files.pythonhosted.org/packages/ec/6d/0267396610add5bc0d0d3e77f546d4cd287200804fe02323797de77dbce9/websockets-15.0.1-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:d5f6b181bb38171a8ad1d6aa58a67a6aa9d4b38d0f8c5f496b9e42561dfc62fe", size = 182790, upload-time = "2025-03-05T20:02:26.99Z" },
    { url = "https://files.pythonhosted.org/packages/02/05/c68c5adbf679cf610ae2f74a9b871ae84564462955d991178f95a1ddb7dd/websockets-15.0.1-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:5d54b09eba2bada6011aea5375542a157637b91029687eb4fdb2dab11059c1b4", size = 182165, upload-time = "2025-03-05T20:02:30.291Z" },
    { url = "https://files.pythonhosted.org/packages/29/93/bb672df7b2f5faac89761cb5fa34f5cec45a4026c383a4b5761c6cea5c16/websockets-15.0.1-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:3be571a8b5afed347da347bfcf27ba12b069d9d7f42cb8c7028b5e98bbb12597", size = 182160, upload-time = "2025-03-05T20:02:31.634Z" },
    { url = "https://files.pythonhosted.org/packages/ff/83/de1f7709376dc3ca9b7eeb4b9a07b4526b14876b6d372a4dc62312bebee0/websockets-15.0.1-cp312-cp312-win32.whl", hash = "sha256:c338ffa0520bdb12fbc527265235639fb76e7bc7faafbb93f6ba80d9c06578a9", size = 176395, upload-time = "2025-03-05T20:02:33.017Z" },
    { url = "https://files.pythonhosted.org/packages/7d/71/abf2ebc3bbfa40f391ce1428c7168fb20582d0ff57019b69ea20fa698043/websockets-15.0.1-cp312-cp312-win_amd64.whl", hash = "sha256:fcd5cf9e305d7b8338754470cf69cf81f420459dbae8a3b40cee57417f4614a7", size = 176841, upload-time = "2025-03-05T20:02:34.498Z" },
    { url = "https://files.pythonhosted.org/packages/cb/9f/51f0cf64471a9d2b4d0fc6c534f323b664e7095640c34562f5182e5a7195/websockets-15.0.1-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:ee443ef070bb3b6ed74514f5efaa37a252af57c90eb33b956d35c8e9c10a1931", size = 175440, upload-time = "2025-03-05T20:02:36.695Z" },
    { url = "https://files.pythonhosted.org/packages/8a/05/aa116ec9943c718905997412c5989f7ed671bc0188ee2ba89520e8765d7b/websockets-15.0.1-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:5a939de6b7b4e18ca683218320fc67ea886038265fd1ed30173f5ce3f8e85675", size = 173098, upload-time = "2025-03-05T20:02:37.985Z" },
    { url = "https://files.pythonhosted.org/packages/ff/0b/33cef55ff24f2d92924923c99926dcce78e7bd922d649467f0eda8368923/websockets-15.0.1-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:746ee8dba912cd6fc889a8147168991d50ed70447bf18bcda7039f7d2e3d9151", size = 173329, upload-time = "2025-03-05T20:02:39.298Z" },
    { url = "https://files.pythonhosted.org/packages/31/1d/063b25dcc01faa8fada1469bdf769de3768b7044eac9d41f734fd7b6ad6d/websockets-15.0.1-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:595b6c3969023ecf9041b2936ac3827e4623bfa3ccf007575f04c5a6aa318c22", size = 183111, upload-time = "2025-03-05T20:02:40.595Z" },
    { url = "https://files.pythonhosted.org/packages/93/53/9a87ee494a51bf63e4ec9241c1ccc4f7c2f45fff85d5bde2ff74fcb68b9e/websockets-15.0.1-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3c714d2fc58b5ca3e285461a4cc0c9a66bd0e24c5da9911e30158286c9b5be7f", size = 182054, upload-time = "2025-03-05T20:02:41.926Z" },
    { url = "https://files.pythonhosted.org/packages/ff/b2/83a6ddf56cdcbad4e3d841fcc55d6ba7d19aeb89c50f24dd7e859ec0805f/websockets-15.0.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:0f3c1e2ab208db911594ae5b4f79addeb3501604a165019dd221c0bdcabe4db8", size = 182496, upload-time = "2025-03-05T20:02:43.304Z" },
    { url = "https://files.pythonhosted.org/packages/98/41/e7038944ed0abf34c45aa4635ba28136f06052e08fc2168520bb8b25149f/websockets-15.0.1-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:229cf1d3ca6c1804400b0a9790dc66528e08a6a1feec0d5040e8b9eb14422375", size = 182829, upload-time = "2025-03-05T20:02:48.812Z" },
    { url = "https://files.pythonhosted.org/packages/e0/17/de15b6158680c7623c6ef0db361da965ab25d813ae54fcfeae2e5b9ef910/websockets-15.0.1-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:756c56e867a90fb00177d530dca4b097dd753cde348448a1012ed6c5131f8b7d", size = 182217, upload-time = "2025-03-05T20:02:50.14Z" },
    { url = "https://files.pythonhosted.org/packages/33/2b/1f168cb6041853eef0362fb9554c3824367c5560cbdaad89ac40f8c2edfc/websockets-15.0.1-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:558d023b3df0bffe50a04e710bc87742de35060580a293c2a984299ed83bc4e4", size = 182195, upload-time = "2025-03-05T20:02:51.561Z" },
    { url = "https://files.pythonhosted.org/packages/86/eb/20b6cdf273913d0ad05a6a14aed4b9a85591c18a987a3d47f20fa13dcc47/websockets-15.0.1-cp313-cp313-win32.whl", hash = "sha256:ba9e56e8ceeeedb2e080147ba85ffcd5cd0711b89576b83784d8605a7df455fa", size = 176393, upload-time = "2025-03-05T20:02:53.814Z" },
    { url = "https://files.pythonhosted.org/packages/1b/6c/c65773d6cab416a64d191d6ee8a8b1c68a09970ea6909d16965d26bfed1e/websockets-15.0.1-cp313-cp313-win_amd64.whl", hash = "sha256:e09473f095a819042ecb2ab9465aee615bd9c2028e4ef7d933600a8401c79561", size = 176837, upload-time = "2025-03-05T20:02:55.237Z" },
    { url = "https://files.pythonhosted.org/packages/fa/a8/5b41e0da817d64113292ab1f8247140aac61cbf6cfd085d6a0fa77f4984f/websockets-15.0.1-py3-none-any.whl", hash = "sha256:f7a866fbc1e97b5c617ee4116daaa09b722101d4a3c170c787450ba409f9736f", size = 169743, upload-time = "2025-03-05T20:03:39.41Z" },
]

[[package]]
name = "win32-setctime"
version = "1.2.0"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/b3/8f/705086c9d734d3b663af0e9bb3d4de6578d08f46b1b101c2442fd9aecaa2/win32_setctime-1.2.0.tar.gz", hash = "sha256:ae1fdf948f5640aae05c511ade119313fb6a30d7eabe25fef9764dca5873c4c0", size = 4867, upload-time = "2024-12-07T15:28:28.314Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/e1/07/c6fe3ad3e685340704d314d765b7912993bcb8dc198f0e7a89382d37974b/win32_setctime-1.2.0-py3-none-any.whl", hash = "sha256:95d644c4e708aba81dc3704a116d8cbc974d70b3bdb8be1d150e36be6e9d1390", size = 4083, upload-time = "2024-12-07T15:28:26.465Z" },
]

[[package]]
name = "yarl"
version = "1.20.1"
source = { registry = "https://pypi.org/simple" }
dependencies = [
    { name = "idna" },
    { name = "multidict" },
    { name = "propcache" },
]
sdist = { url = "https://files.pythonhosted.org/packages/3c/fb/efaa23fa4e45537b827620f04cf8f3cd658b76642205162e072703a5b963/yarl-1.20.1.tar.gz", hash = "sha256:d017a4997ee50c91fd5466cef416231bb82177b93b029906cefc542ce14c35ac", size = 186428, upload-time = "2025-06-10T00:46:09.923Z" }
wheels = [
    { url = "https://files.pythonhosted.org/packages/5f/9a/cb7fad7d73c69f296eda6815e4a2c7ed53fc70c2f136479a91c8e5fbdb6d/yarl-1.20.1-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:bdcc4cd244e58593a4379fe60fdee5ac0331f8eb70320a24d591a3be197b94a9", size = 133667, upload-time = "2025-06-10T00:43:44.369Z" },
    { url = "https://files.pythonhosted.org/packages/67/38/688577a1cb1e656e3971fb66a3492501c5a5df56d99722e57c98249e5b8a/yarl-1.20.1-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:b29a2c385a5f5b9c7d9347e5812b6f7ab267193c62d282a540b4fc528c8a9d2a", size = 91025, upload-time = "2025-06-10T00:43:46.295Z" },
    { url = "https://files.pythonhosted.org/packages/50/ec/72991ae51febeb11a42813fc259f0d4c8e0507f2b74b5514618d8b640365/yarl-1.20.1-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:1112ae8154186dfe2de4732197f59c05a83dc814849a5ced892b708033f40dc2", size = 89709, upload-time = "2025-06-10T00:43:48.22Z" },
    { url = "https://files.pythonhosted.org/packages/99/da/4d798025490e89426e9f976702e5f9482005c548c579bdae792a4c37769e/yarl-1.20.1-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:90bbd29c4fe234233f7fa2b9b121fb63c321830e5d05b45153a2ca68f7d310ee", size = 352287, upload-time = "2025-06-10T00:43:49.924Z" },
    { url = "https://files.pythonhosted.org/packages/1a/26/54a15c6a567aac1c61b18aa0f4b8aa2e285a52d547d1be8bf48abe2b3991/yarl-1.20.1-cp312-cp312-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:680e19c7ce3710ac4cd964e90dad99bf9b5029372ba0c7cbfcd55e54d90ea819", size = 345429, upload-time = "2025-06-10T00:43:51.7Z" },
    { url = "https://files.pythonhosted.org/packages/d6/95/9dcf2386cb875b234353b93ec43e40219e14900e046bf6ac118f94b1e353/yarl-1.20.1-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:4a979218c1fdb4246a05efc2cc23859d47c89af463a90b99b7c56094daf25a16", size = 365429, upload-time = "2025-06-10T00:43:53.494Z" },
    { url = "https://files.pythonhosted.org/packages/91/b2/33a8750f6a4bc224242a635f5f2cff6d6ad5ba651f6edcccf721992c21a0/yarl-1.20.1-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:255b468adf57b4a7b65d8aad5b5138dce6a0752c139965711bdcb81bc370e1b6", size = 363862, upload-time = "2025-06-10T00:43:55.766Z" },
    { url = "https://files.pythonhosted.org/packages/98/28/3ab7acc5b51f4434b181b0cee8f1f4b77a65919700a355fb3617f9488874/yarl-1.20.1-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:a97d67108e79cfe22e2b430d80d7571ae57d19f17cda8bb967057ca8a7bf5bfd", size = 355616, upload-time = "2025-06-10T00:43:58.056Z" },
    { url = "https://files.pythonhosted.org/packages/36/a3/f666894aa947a371724ec7cd2e5daa78ee8a777b21509b4252dd7bd15e29/yarl-1.20.1-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:8570d998db4ddbfb9a590b185a0a33dbf8aafb831d07a5257b4ec9948df9cb0a", size = 339954, upload-time = "2025-06-10T00:43:59.773Z" },
    { url = "https://files.pythonhosted.org/packages/f1/81/5f466427e09773c04219d3450d7a1256138a010b6c9f0af2d48565e9ad13/yarl-1.20.1-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:97c75596019baae7c71ccf1d8cc4738bc08134060d0adfcbe5642f778d1dca38", size = 365575, upload-time = "2025-06-10T00:44:02.051Z" },
    { url = "https://files.pythonhosted.org/packages/2e/e3/e4b0ad8403e97e6c9972dd587388940a032f030ebec196ab81a3b8e94d31/yarl-1.20.1-cp312-cp312-musllinux_1_2_armv7l.whl", hash = "sha256:1c48912653e63aef91ff988c5432832692ac5a1d8f0fb8a33091520b5bbe19ef", size = 365061, upload-time = "2025-06-10T00:44:04.196Z" },
    { url = "https://files.pythonhosted.org/packages/ac/99/b8a142e79eb86c926f9f06452eb13ecb1bb5713bd01dc0038faf5452e544/yarl-1.20.1-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:4c3ae28f3ae1563c50f3d37f064ddb1511ecc1d5584e88c6b7c63cf7702a6d5f", size = 364142, upload-time = "2025-06-10T00:44:06.527Z" },
    { url = "https://files.pythonhosted.org/packages/34/f2/08ed34a4a506d82a1a3e5bab99ccd930a040f9b6449e9fd050320e45845c/yarl-1.20.1-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:c5e9642f27036283550f5f57dc6156c51084b458570b9d0d96100c8bebb186a8", size = 381894, upload-time = "2025-06-10T00:44:08.379Z" },
    { url = "https://files.pythonhosted.org/packages/92/f8/9a3fbf0968eac704f681726eff595dce9b49c8a25cd92bf83df209668285/yarl-1.20.1-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:2c26b0c49220d5799f7b22c6838409ee9bc58ee5c95361a4d7831f03cc225b5a", size = 383378, upload-time = "2025-06-10T00:44:10.51Z" },
    { url = "https://files.pythonhosted.org/packages/af/85/9363f77bdfa1e4d690957cd39d192c4cacd1c58965df0470a4905253b54f/yarl-1.20.1-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:564ab3d517e3d01c408c67f2e5247aad4019dcf1969982aba3974b4093279004", size = 374069, upload-time = "2025-06-10T00:44:12.834Z" },
    { url = "https://files.pythonhosted.org/packages/35/99/9918c8739ba271dcd935400cff8b32e3cd319eaf02fcd023d5dcd487a7c8/yarl-1.20.1-cp312-cp312-win32.whl", hash = "sha256:daea0d313868da1cf2fac6b2d3a25c6e3a9e879483244be38c8e6a41f1d876a5", size = 81249, upload-time = "2025-06-10T00:44:14.731Z" },
    { url = "https://files.pythonhosted.org/packages/eb/83/5d9092950565481b413b31a23e75dd3418ff0a277d6e0abf3729d4d1ce25/yarl-1.20.1-cp312-cp312-win_amd64.whl", hash = "sha256:48ea7d7f9be0487339828a4de0360d7ce0efc06524a48e1810f945c45b813698", size = 86710, upload-time = "2025-06-10T00:44:16.716Z" },
    { url = "https://files.pythonhosted.org/packages/8a/e1/2411b6d7f769a07687acee88a062af5833cf1966b7266f3d8dfb3d3dc7d3/yarl-1.20.1-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:0b5ff0fbb7c9f1b1b5ab53330acbfc5247893069e7716840c8e7d5bb7355038a", size = 131811, upload-time = "2025-06-10T00:44:18.933Z" },
    { url = "https://files.pythonhosted.org/packages/b2/27/584394e1cb76fb771371770eccad35de400e7b434ce3142c2dd27392c968/yarl-1.20.1-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:14f326acd845c2b2e2eb38fb1346c94f7f3b01a4f5c788f8144f9b630bfff9a3", size = 90078, upload-time = "2025-06-10T00:44:20.635Z" },
    { url = "https://files.pythonhosted.org/packages/bf/9a/3246ae92d4049099f52d9b0fe3486e3b500e29b7ea872d0f152966fc209d/yarl-1.20.1-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:f60e4ad5db23f0b96e49c018596707c3ae89f5d0bd97f0ad3684bcbad899f1e7", size = 88748, upload-time = "2025-06-10T00:44:22.34Z" },
    { url = "https://files.pythonhosted.org/packages/a3/25/35afe384e31115a1a801fbcf84012d7a066d89035befae7c5d4284df1e03/yarl-1.20.1-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:49bdd1b8e00ce57e68ba51916e4bb04461746e794e7c4d4bbc42ba2f18297691", size = 349595, upload-time = "2025-06-10T00:44:24.314Z" },
    { url = "https://files.pythonhosted.org/packages/28/2d/8aca6cb2cabc8f12efcb82749b9cefecbccfc7b0384e56cd71058ccee433/yarl-1.20.1-cp313-cp313-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:66252d780b45189975abfed839616e8fd2dbacbdc262105ad7742c6ae58f3e31", size = 342616, upload-time = "2025-06-10T00:44:26.167Z" },
    { url = "https://files.pythonhosted.org/packages/0b/e9/1312633d16b31acf0098d30440ca855e3492d66623dafb8e25b03d00c3da/yarl-1.20.1-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:59174e7332f5d153d8f7452a102b103e2e74035ad085f404df2e40e663a22b28", size = 361324, upload-time = "2025-06-10T00:44:27.915Z" },
    { url = "https://files.pythonhosted.org/packages/bc/a0/688cc99463f12f7669eec7c8acc71ef56a1521b99eab7cd3abb75af887b0/yarl-1.20.1-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:e3968ec7d92a0c0f9ac34d5ecfd03869ec0cab0697c91a45db3fbbd95fe1b653", size = 359676, upload-time = "2025-06-10T00:44:30.041Z" },
    { url = "https://files.pythonhosted.org/packages/af/44/46407d7f7a56e9a85a4c207724c9f2c545c060380718eea9088f222ba697/yarl-1.20.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:d1a4fbb50e14396ba3d375f68bfe02215d8e7bc3ec49da8341fe3157f59d2ff5", size = 352614, upload-time = "2025-06-10T00:44:32.171Z" },
    { url = "https://files.pythonhosted.org/packages/b1/91/31163295e82b8d5485d31d9cf7754d973d41915cadce070491778d9c9825/yarl-1.20.1-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:11a62c839c3a8eac2410e951301309426f368388ff2f33799052787035793b02", size = 336766, upload-time = "2025-06-10T00:44:34.494Z" },
    { url = "https://files.pythonhosted.org/packages/b4/8e/c41a5bc482121f51c083c4c2bcd16b9e01e1cf8729e380273a952513a21f/yarl-1.20.1-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:041eaa14f73ff5a8986b4388ac6bb43a77f2ea09bf1913df7a35d4646db69e53", size = 364615, upload-time = "2025-06-10T00:44:36.856Z" },
    { url = "https://files.pythonhosted.org/packages/e3/5b/61a3b054238d33d70ea06ebba7e58597891b71c699e247df35cc984ab393/yarl-1.20.1-cp313-cp313-musllinux_1_2_armv7l.whl", hash = "sha256:377fae2fef158e8fd9d60b4c8751387b8d1fb121d3d0b8e9b0be07d1b41e83dc", size = 360982, upload-time = "2025-06-10T00:44:39.141Z" },
    { url = "https://files.pythonhosted.org/packages/df/a3/6a72fb83f8d478cb201d14927bc8040af901811a88e0ff2da7842dd0ed19/yarl-1.20.1-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:1c92f4390e407513f619d49319023664643d3339bd5e5a56a3bebe01bc67ec04", size = 369792, upload-time = "2025-06-10T00:44:40.934Z" },
    { url = "https://files.pythonhosted.org/packages/7c/af/4cc3c36dfc7c077f8dedb561eb21f69e1e9f2456b91b593882b0b18c19dc/yarl-1.20.1-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:d25ddcf954df1754ab0f86bb696af765c5bfaba39b74095f27eececa049ef9a4", size = 382049, upload-time = "2025-06-10T00:44:42.854Z" },
    { url = "https://files.pythonhosted.org/packages/19/3a/e54e2c4752160115183a66dc9ee75a153f81f3ab2ba4bf79c3c53b33de34/yarl-1.20.1-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:909313577e9619dcff8c31a0ea2aa0a2a828341d92673015456b3ae492e7317b", size = 384774, upload-time = "2025-06-10T00:44:45.275Z" },
    { url = "https://files.pythonhosted.org/packages/9c/20/200ae86dabfca89060ec6447649f219b4cbd94531e425e50d57e5f5ac330/yarl-1.20.1-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:793fd0580cb9664548c6b83c63b43c477212c0260891ddf86809e1c06c8b08f1", size = 374252, upload-time = "2025-06-10T00:44:47.31Z" },
    { url = "https://files.pythonhosted.org/packages/83/75/11ee332f2f516b3d094e89448da73d557687f7d137d5a0f48c40ff211487/yarl-1.20.1-cp313-cp313-win32.whl", hash = "sha256:468f6e40285de5a5b3c44981ca3a319a4b208ccc07d526b20b12aeedcfa654b7", size = 81198, upload-time = "2025-06-10T00:44:49.164Z" },
    { url = "https://files.pythonhosted.org/packages/ba/ba/39b1ecbf51620b40ab402b0fc817f0ff750f6d92712b44689c2c215be89d/yarl-1.20.1-cp313-cp313-win_amd64.whl", hash = "sha256:495b4ef2fea40596bfc0affe3837411d6aa3371abcf31aac0ccc4bdd64d4ef5c", size = 86346, upload-time = "2025-06-10T00:44:51.182Z" },
    { url = "https://files.pythonhosted.org/packages/43/c7/669c52519dca4c95153c8ad96dd123c79f354a376346b198f438e56ffeb4/yarl-1.20.1-cp313-cp313t-macosx_10_13_universal2.whl", hash = "sha256:f60233b98423aab21d249a30eb27c389c14929f47be8430efa7dbd91493a729d", size = 138826, upload-time = "2025-06-10T00:44:52.883Z" },
    { url = "https://files.pythonhosted.org/packages/6a/42/fc0053719b44f6ad04a75d7f05e0e9674d45ef62f2d9ad2c1163e5c05827/yarl-1.20.1-cp313-cp313t-macosx_10_13_x86_64.whl", hash = "sha256:6f3eff4cc3f03d650d8755c6eefc844edde99d641d0dcf4da3ab27141a5f8ddf", size = 93217, upload-time = "2025-06-10T00:44:54.658Z" },
    { url = "https://files.pythonhosted.org/packages/4f/7f/fa59c4c27e2a076bba0d959386e26eba77eb52ea4a0aac48e3515c186b4c/yarl-1.20.1-cp313-cp313t-macosx_11_0_arm64.whl", hash = "sha256:69ff8439d8ba832d6bed88af2c2b3445977eba9a4588b787b32945871c2444e3", size = 92700, upload-time = "2025-06-10T00:44:56.784Z" },
    { url = "https://files.pythonhosted.org/packages/2f/d4/062b2f48e7c93481e88eff97a6312dca15ea200e959f23e96d8ab898c5b8/yarl-1.20.1-cp313-cp313t-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:3cf34efa60eb81dd2645a2e13e00bb98b76c35ab5061a3989c7a70f78c85006d", size = 347644, upload-time = "2025-06-10T00:44:59.071Z" },
    { url = "https://files.pythonhosted.org/packages/89/47/78b7f40d13c8f62b499cc702fdf69e090455518ae544c00a3bf4afc9fc77/yarl-1.20.1-cp313-cp313t-manylinux_2_17_armv7l.manylinux2014_armv7l.manylinux_2_31_armv7l.whl", hash = "sha256:8e0fe9364ad0fddab2688ce72cb7a8e61ea42eff3c7caeeb83874a5d479c896c", size = 323452, upload-time = "2025-06-10T00:45:01.605Z" },
    { url = "https://files.pythonhosted.org/packages/eb/2b/490d3b2dc66f52987d4ee0d3090a147ea67732ce6b4d61e362c1846d0d32/yarl-1.20.1-cp313-cp313t-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:8f64fbf81878ba914562c672024089e3401974a39767747691c65080a67b18c1", size = 346378, upload-time = "2025-06-10T00:45:03.946Z" },
    { url = "https://files.pythonhosted.org/packages/66/ad/775da9c8a94ce925d1537f939a4f17d782efef1f973039d821cbe4bcc211/yarl-1.20.1-cp313-cp313t-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:f6342d643bf9a1de97e512e45e4b9560a043347e779a173250824f8b254bd5ce", size = 353261, upload-time = "2025-06-10T00:45:05.992Z" },
    { url = "https://files.pythonhosted.org/packages/4b/23/0ed0922b47a4f5c6eb9065d5ff1e459747226ddce5c6a4c111e728c9f701/yarl-1.20.1-cp313-cp313t-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:56dac5f452ed25eef0f6e3c6a066c6ab68971d96a9fb441791cad0efba6140d3", size = 335987, upload-time = "2025-06-10T00:45:08.227Z" },
    { url = "https://files.pythonhosted.org/packages/3e/49/bc728a7fe7d0e9336e2b78f0958a2d6b288ba89f25a1762407a222bf53c3/yarl-1.20.1-cp313-cp313t-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:c7d7f497126d65e2cad8dc5f97d34c27b19199b6414a40cb36b52f41b79014be", size = 329361, upload-time = "2025-06-10T00:45:10.11Z" },
    { url = "https://files.pythonhosted.org/packages/93/8f/b811b9d1f617c83c907e7082a76e2b92b655400e61730cd61a1f67178393/yarl-1.20.1-cp313-cp313t-musllinux_1_2_aarch64.whl", hash = "sha256:67e708dfb8e78d8a19169818eeb5c7a80717562de9051bf2413aca8e3696bf16", size = 346460, upload-time = "2025-06-10T00:45:12.055Z" },
    { url = "https://files.pythonhosted.org/packages/70/fd/af94f04f275f95da2c3b8b5e1d49e3e79f1ed8b6ceb0f1664cbd902773ff/yarl-1.20.1-cp313-cp313t-musllinux_1_2_armv7l.whl", hash = "sha256:595c07bc79af2494365cc96ddeb772f76272364ef7c80fb892ef9d0649586513", size = 334486, upload-time = "2025-06-10T00:45:13.995Z" },
    { url = "https://files.pythonhosted.org/packages/84/65/04c62e82704e7dd0a9b3f61dbaa8447f8507655fd16c51da0637b39b2910/yarl-1.20.1-cp313-cp313t-musllinux_1_2_i686.whl", hash = "sha256:7bdd2f80f4a7df852ab9ab49484a4dee8030023aa536df41f2d922fd57bf023f", size = 342219, upload-time = "2025-06-10T00:45:16.479Z" },
    { url = "https://files.pythonhosted.org/packages/91/95/459ca62eb958381b342d94ab9a4b6aec1ddec1f7057c487e926f03c06d30/yarl-1.20.1-cp313-cp313t-musllinux_1_2_ppc64le.whl", hash = "sha256:c03bfebc4ae8d862f853a9757199677ab74ec25424d0ebd68a0027e9c639a390", size = 350693, upload-time = "2025-06-10T00:45:18.399Z" },
    { url = "https://files.pythonhosted.org/packages/a6/00/d393e82dd955ad20617abc546a8f1aee40534d599ff555ea053d0ec9bf03/yarl-1.20.1-cp313-cp313t-musllinux_1_2_s390x.whl", hash = "sha256:344d1103e9c1523f32a5ed704d576172d2cabed3122ea90b1d4e11fe17c66458", size = 355803, upload-time = "2025-06-10T00:45:20.677Z" },
    { url = "https://files.pythonhosted.org/packages/9e/ed/c5fb04869b99b717985e244fd93029c7a8e8febdfcffa06093e32d7d44e7/yarl-1.20.1-cp313-cp313t-musllinux_1_2_x86_64.whl", hash = "sha256:88cab98aa4e13e1ade8c141daeedd300a4603b7132819c484841bb7af3edce9e", size = 341709, upload-time = "2025-06-10T00:45:23.221Z" },
    { url = "https://files.pythonhosted.org/packages/24/fd/725b8e73ac2a50e78a4534ac43c6addf5c1c2d65380dd48a9169cc6739a9/yarl-1.20.1-cp313-cp313t-win32.whl", hash = "sha256:b121ff6a7cbd4abc28985b6028235491941b9fe8fe226e6fdc539c977ea1739d", size = 86591, upload-time = "2025-06-10T00:45:25.793Z" },
    { url = "https://files.pythonhosted.org/packages/94/c3/b2e9f38bc3e11191981d57ea08cab2166e74ea770024a646617c9cddd9f6/yarl-1.20.1-cp313-cp313t-win_amd64.whl", hash = "sha256:541d050a355bbbc27e55d906bc91cb6fe42f96c01413dd0f4ed5a5240513874f", size = 93003, upload-time = "2025-06-10T00:45:27.752Z" },
    { url = "https://files.pythonhosted.org/packages/b4/2d/2345fce04cfd4bee161bf1e7d9cdc702e3e16109021035dbb24db654a622/yarl-1.20.1-py3-none-any.whl", hash = "sha256:83b8eb083fe4683c6115795d9fc1cfaf2cbbefb19b3a1cb68f6527460f483a77", size = 46542, upload-time = "2025-06-10T00:46:07.521Z" },
]


# END FILE CONTENTS


# File: frontend/components/ui/command.tsx

"use client"

import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

const CommandDialog = ({ children, ...props }: DialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}


# END FILE CONTENTS


# File: frontend/utils/export.ts

import { toast } from '@/hooks/use-toast'

export async function downloadZip(sid: string) {
    try {
        const res = await fetch(`/api/export/${sid}?type=zip`)
        if (!res.ok) {
            toast({ title: `Export failed: ${res.statusText}`, variant: 'destructive' })
            return
        }
        const blob = await res.blob()
        const url = window.URL.createObjectURL(blob)

        const a = document.createElement('a')
        a.href = url
        a.download = `${sid}.zip`
        a.style.display = 'none'
        document.body.appendChild(a)
        a.click()
        a.remove()
        setTimeout(() => URL.revokeObjectURL(url), 1_000)
        toast({ title: 'Export started', variant: 'default' })
    } catch (err) {
        console.error(err)
        toast({ title: 'Network error when exporting', variant: 'destructive' })
    }
}


# END FILE CONTENTS


# File: frontend/components/ui/sidebar.tsx

"use client"

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar:state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}


# END FILE CONTENTS


# File: frontend/constants/providers.ts

export const PROVIDERS = [
  { code: 'whisper', label: 'Azure Whisper' },
  { code: 'gpt4o', label: 'Azure GPT-4o-transcribe' },
];


# END FILE CONTENTS


# File: app/middleware/__init__.py



# END FILE CONTENTS


# File: frontend/hooks/use-local-draft.ts

"use client"

import { useState, useCallback, useEffect, useRef, useMemo } from 'react'

interface DraftData {
    content: string;
}

interface UseLocalDraftReturn {
    draft: DraftData;
    hasDraft: boolean
    lastDraftTime: Date | null
    saveDraft: (data: Partial<DraftData>) => void
    loadDraft: () => DraftData | null
    clearDraft: () => void
    isDraftNewer: (serverTimestamp: Date) => boolean
}

const DRAFT_KEY = 'studyscriber_draft'

export function useLocalDraft(sessionId?: string): UseLocalDraftReturn {
    const [draft, setDraft] = useState<DraftData>({ content: '' })
    const [hasDraft, setHasDraft] = useState(false)
    const [lastDraftTime, setLastDraftTime] = useState<Date | null>(null)

    const autoSaveTimeoutRef = useRef<NodeJS.Timeout | null>(null)
    const currentSessionRef = useRef<string | undefined>(sessionId)

    // æ›´æ–° session ID
    useEffect(() => {
        currentSessionRef.current = sessionId
    }, [sessionId])

    // æ¸…é™¤è‡ªå‹•å„²å­˜è¨ˆæ™‚å™¨
    const clearAutoSaveTimeout = useCallback(() => {
        if (autoSaveTimeoutRef.current) {
            clearTimeout(autoSaveTimeoutRef.current)
            autoSaveTimeoutRef.current = null
        }
    }, [])

    // å¾ localStorage è¼‰å…¥è‰ç¨¿
    const loadDraft = useCallback((): DraftData | null => {
        try {
            const draftJson = localStorage.getItem(DRAFT_KEY)
            if (!draftJson) {
                setHasDraft(false)
                return null
            }

            const parsed = JSON.parse(draftJson)
            const draftData: DraftData = {
                content: parsed.content || ''
            }
            const timestamp = parsed.timestamp ? new Date(parsed.timestamp) : new Date()
            const storedSessionId = parsed.sessionId

            // æª¢æŸ¥è‰ç¨¿æ˜¯å¦å±¬æ–¼ç•¶å‰æœƒè©±ï¼ˆå¦‚æœæœ‰æŒ‡å®šæœƒè©±ï¼‰
            if (currentSessionRef.current && storedSessionId !== currentSessionRef.current) {
                console.log('ğŸ“ è‰ç¨¿å±¬æ–¼å…¶ä»–æœƒè©±ï¼Œä¸è¼‰å…¥')
                return null
            }

            setDraft(draftData)
            setHasDraft(!!draftData.content.trim())
            setLastDraftTime(timestamp)

            console.log('ğŸ“– è‰ç¨¿å·²å¾æœ¬åœ°è¼‰å…¥')
            return draftData
        } catch (err) {
            console.error('âŒ è¼‰å…¥è‰ç¨¿å¤±æ•—:', err)
            return null
        }
    }, [])

    // å„²å­˜è‰ç¨¿åˆ° localStorage
    const saveDraft = useCallback((data: Partial<DraftData>) => {
        const now = new Date()

        // å–å¾—ç›®å‰çš„è‰ç¨¿å…§å®¹ï¼Œä¸¦èˆ‡æ–°çš„å…§å®¹åˆä½µ
        const currentDraft = { ...draft, ...data }

        if (!currentDraft.content.trim()) {
            // ç©ºå…§å®¹æ™‚æ¸…é™¤è‰ç¨¿
            clearDraft()
            return
        }

        const draftDataToStore = {
            ...currentDraft,
            timestamp: now.toISOString(),
            sessionId: currentSessionRef.current || null,
        }

        try {
            localStorage.setItem(DRAFT_KEY, JSON.stringify(draftDataToStore))
            setDraft(currentDraft)
            setHasDraft(true)
            setLastDraftTime(now)

            console.log('ğŸ’¾ è‰ç¨¿å·²å„²å­˜åˆ°æœ¬åœ°:', currentDraft)
        } catch (err) {
            console.error('âŒ å„²å­˜è‰ç¨¿å¤±æ•—:', err)
        }
    }, [draft]) // ä¾è³´ draft ç‹€æ…‹

    // æ¸…é™¤è‰ç¨¿
    const clearDraft = useCallback(() => {
        clearAutoSaveTimeout()
        try {
            localStorage.removeItem(DRAFT_KEY)

            const clearedDraft = { content: '' }
            setDraft(clearedDraft)
            setHasDraft(false)
            setLastDraftTime(null)

            console.log('ğŸ—‘ï¸ è‰ç¨¿å·²æ¸…é™¤')
        } catch (err) {
            console.error('âŒ æ¸…é™¤è‰ç¨¿å¤±æ•—:', err)
        }
    }, [clearAutoSaveTimeout])

    // åˆ¤æ–·è‰ç¨¿æ˜¯å¦æ¯”ä¼ºæœå™¨ç‰ˆæœ¬æ›´æ–°
    const isDraftNewer = useCallback((serverTimestamp: Date): boolean => {
        if (!lastDraftTime || !hasDraft) {
            return false
        }
        return lastDraftTime > serverTimestamp
    }, [lastDraftTime, hasDraft])

    // è‡ªå‹•å„²å­˜è‰ç¨¿ï¼ˆä½¿ç”¨é˜²æŠ–å‹•ï¼‰
    const autoSaveDraft = useCallback((data: Partial<DraftData>) => {
        clearAutoSaveTimeout()

        // 500ms é˜²æŠ–å‹•ï¼Œé¿å…éæ–¼é »ç¹çš„å„²å­˜
        autoSaveTimeoutRef.current = setTimeout(() => {
            saveDraft(data)
        }, 500)
    }, [saveDraft, clearAutoSaveTimeout])

    // åˆå§‹åŒ–æ™‚è¼‰å…¥è‰ç¨¿
    useEffect(() => {
        loadDraft()
    }, [loadDraft])

    // çµ„ä»¶å¸è¼‰æ™‚æ¸…ç†
    useEffect(() => {
        return () => {
            clearAutoSaveTimeout()
        }
    }, [clearAutoSaveTimeout])

    return useMemo(() => ({
        draft,
        hasDraft,
        lastDraftTime,
        saveDraft: autoSaveDraft, // ä½¿ç”¨é˜²æŠ–ç‰ˆæœ¬
        loadDraft,
        clearDraft,
        isDraftNewer,
    }), [
        draft,
        hasDraft,
        lastDraftTime,
        autoSaveDraft,
        loadDraft,
        clearDraft,
        isDraftNewer,
    ])
}


# END FILE CONTENTS


# File: frontend/src/test-setup.ts

import '@testing-library/jest-dom'
import { vi } from 'vitest'

// æ¨¡æ“¬ window.matchMedia (Radix UI éœ€è¦)
Object.defineProperty(window, 'matchMedia', {
    writable: true,
    value: vi.fn().mockImplementation((query: string) => ({
        matches: false,
        media: query,
        onchange: null,
        addListener: vi.fn(),
        removeListener: vi.fn(),
        addEventListener: vi.fn(),
        removeEventListener: vi.fn(),
        dispatchEvent: vi.fn(),
    })),
})

// æ¨¡æ“¬ ResizeObserver (æŸäº› UI å…ƒä»¶éœ€è¦)
Object.defineProperty(global, 'ResizeObserver', {
    writable: true,
    value: vi.fn().mockImplementation(() => ({
        observe: vi.fn(),
        unobserve: vi.fn(),
        disconnect: vi.fn(),
    })),
})


# END FILE CONTENTS


# File: frontend/README.md

# Recreate the UI

*Automatically synced with your [v0.dev](https://v0.dev) deployments*

[![Deployed on Vercel](https://img.shields.io/badge/Deployed%20on-Vercel-black?style=for-the-badge&logo=vercel)](https://vercel.com/otoitsukis-projects/v0-recreate-the-ui)
[![Built with v0](https://img.shields.io/badge/Built%20with-v0.dev-black?style=for-the-badge)](https://v0.dev/chat/projects/5FBRtobaC6g)

## Overview

This repository will stay in sync with your deployed chats on [v0.dev](https://v0.dev).
Any changes you make to your deployed app will be automatically pushed to this repository from [v0.dev](https://v0.dev).

## Deployment

Your project is live at:

**[https://vercel.com/otoitsukis-projects/v0-recreate-the-ui](https://vercel.com/otoitsukis-projects/v0-recreate-the-ui)**

## Build your app

Continue building your app on:

**[https://v0.dev/chat/projects/5FBRtobaC6g](https://v0.dev/chat/projects/5FBRtobaC6g)**

## How It Works

1. Create and modify your project using [v0.dev](https://v0.dev)
2. Deploy your chats from the v0 interface
3. Changes are automatically pushed to this repository
4. Vercel deploys the latest version from this repository

# END FILE CONTENTS


# File: docs/export-transcript-format.md

# transcript.txt æ–°æ ¼å¼è¦æ ¼ï¼ˆ2024-07-15ï¼‰

## 1. æ ¼å¼èªªæ˜
- æ¯æ®µä¸€è¡Œï¼Œæ ¼å¼ï¼š[hh:mm:ss] é€å­—ç¨¿å…§å®¹
- ä¾†æºç‚º transcript_segmentsï¼Œä¾ chunk_sequence æ’åº
- timestamp æ¬„ä½è‹¥æœ‰ï¼Œè½‰æ›ç‚º hh:mm:ssï¼Œç„¡å‰‡ç‚º 00:00:00

## 2. ç¯„ä¾‹
```
[00:00:01] ä½ å¥½ï¼Œé€™æ˜¯ç¬¬ä¸€æ®µ
[00:00:05] é€™æ˜¯ç¬¬äºŒæ®µ
[00:00:10] æ¸¬è©¦ç¬¬ä¸‰æ®µ
```

## 3. æ“´å……å»ºè­°
- æœªä¾†å¯æ”¯æ´ transcript.jsonï¼Œå®Œæ•´æ¬„ä½çµæ§‹
- å¯é¸æ“‡ç´”æ–‡å­—/å«æ™‚é–“æˆ³/JSON æ ¼å¼ 


# END FILE CONTENTS


# File: frontend/components/ui/popover.tsx

"use client"

import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }


# END FILE CONTENTS


# File: .editorconfig

root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.py]
indent_style = space
indent_size = 4
max_line_length = 79

[*.{yml,yaml}]
indent_style = space
indent_size = 2

[*.{json,js,ts}]
indent_style = space
indent_size = 2

[*.md]
trim_trailing_whitespace = false


# END FILE CONTENTS


# File: app/services/stt/save_utils.py

import json, logging
from uuid import UUID
from datetime import datetime

from app.db.database import get_supabase_client
from app.utils.timing import calc_times
from app.ws.transcript_feed import manager as ws

logger = logging.getLogger(__name__)


async def save_and_push_result(
    sid: UUID,
    chunk_seq: int,
    res: dict,
) -> None:
    """
    å°‡ provider å›å‚³çš„çµæœï¼š
      1. å¯«å…¥ transcript_segments
      2. é€é WebSocket æ¨é€çµ¦å‰ç«¯
    å¿…è¦æ¬„ä½ï¼štext, lang_code, timestamp
    å¯é¸æ¬„ä½ï¼šstart_time, end_time
    """
    # -------- 1. æ™‚é–“æ¬„ä½ä¿éšœ --------
    if "start_time" not in res or "end_time" not in res:
        res["start_time"], res["end_time"] = calc_times(chunk_seq)

    # -------- 2. å¯«å…¥ DB -------------
    supa = get_supabase_client()
    seg_data = {
        "session_id": str(sid),
        "chunk_sequence": chunk_seq,
        "text": res["text"],
        "start_time": res["start_time"],
        "end_time": res["end_time"],
        "confidence": 1.0,
        "lang_code": res["lang_code"],
        "created_at": res.get("timestamp", datetime.utcnow().isoformat()),
    }
    row = supa.table("transcript_segments").insert(seg_data).execute()
    seg_id = row.data[0]["id"]

    # -------- 3. WebSocket æ¨é€ ------
    await ws.broadcast(
        json.dumps(
            {
                "type": "transcript_segment",
                "session_id": str(sid),
                "segment_id": seg_id,
                "chunk_sequence": chunk_seq,
                "start_time": res["start_time"],
                "end_time": res["end_time"],
                "text": res["text"],
            }
        ),
        str(sid),
    )
    logger.info("ğŸ“¡ æ¨é€ transcript_segment seq=%s start=%.1f", chunk_seq, res["start_time"])


# END FILE CONTENTS


# File: app/services/stt/__init__.py

from .interfaces import ISTTProvider           # å°å¤–æš´éœ²
__all__ = ["ISTTProvider"]


# END FILE CONTENTS


# File: docs/lang-map-refactor.md

# Lang-map Refactor è¦æ ¼èˆ‡è¨­è¨ˆ

## ç›®æ¨™
1. å‰ç«¯ä¸‹æ‹‰å¯é¸ Provider (whisper / gpt4o) èˆ‡èªè¨€ (zh-TW / en-US â€¦)
2. å¾Œç«¯ `sessions.lang_code` æ°¸é å­˜ BCP-47ï¼ˆzh-TWã€en-USâ€¦ï¼‰
3. å„ Provider åœ¨å‘¼å«å¤–éƒ¨ API å‰ï¼Œè‡ªè¡ŒæŠŠ lang_code è½‰æˆè©² API æ”¯æ´æ ¼å¼
   - Whisper    : zh â†’ zh, en â†’ en  (ISO-639-1, å°å¯«)
   - GPT-4o-STT : zh â†’ zh, en â†’ en  (å¯å‚³ auto)
4. å…¶ä»–ç¨‹å¼ç¢¼ä¸å† hard-code èªè¨€ç¢¼

## ä¸»è¦æª”æ¡ˆ/è·¯å¾‘
- backend
  - app/services/stt/interfaces.py
  - app/services/stt/lang_map.py
  - app/services/stt/whisper_provider.py
  - app/services/stt/gpt4o_provider.py
  - app/services/stt/factory.py
  - app/api/segments.py
  - migrations/20250713_add_enum_lang.sql
- frontend
  - frontend/constants/languages.ts
  - frontend/constants/providers.ts
  - frontend/hooks/useSession.ts

## è¨­è¨ˆé‡é»
- èªè¨€ç¢¼è½‰æ›é›†ä¸­æ–¼ lang_map.pyï¼ŒProvider ç«¯è‡ªå‹•è½‰æ›
- session.lang_code æ°¸é å­˜ BCP-47
- å‰ç«¯/å¾Œç«¯çš†ç§»é™¤ hard-codeï¼Œçµ±ä¸€ import å¸¸æ•¸
- SQL migration è£œ enum type æ”¯æ´ zh/en

## TDD/Tidy First æµç¨‹
- å…ˆå¯«æ¸¬è©¦èˆ‡å‹åˆ¥ï¼Œé€æ­¥é‡æ§‹ provider/factory
- æ¯æ­¥é©Ÿ commit åˆ†æ˜ï¼Œçµæ§‹èˆ‡è¡Œç‚ºåˆ†é›¢
- æ–‡ä»¶åŒæ­¥æ›´æ–°

## æ¸¬è©¦
- lang_map.py å–®å…ƒæ¸¬è©¦
- provider/factory æµç¨‹æ•´åˆæ¸¬è©¦
- å‰ç«¯ä¸‹æ‹‰é¸å–®èˆ‡ session å»ºç«‹æµç¨‹æ¸¬è©¦

## åŸ·è¡Œæ­¥é©Ÿ
1. åŸ·è¡Œ SQL migration
2. .env WHISPER_LANGUAGE å¯ä¿ç•™ zh-TWï¼ˆä¸å½±éŸ¿ï¼‰
3. npm run dev + uv pip run main.py
4. å‰ç«¯é¸ provider + èªè¨€ï¼Œä¸Šå‚³å¾Œæ‡‰ï¼š
   - Whisper â†’ 200 OKï¼Œèªè¨€æ¬„å­˜ zh-TW
   - GPT-4o â†’ TODO NotImplementedï¼ˆå…ˆå› 501ï¼‰ 


# END FILE CONTENTS


# File: frontend/hooks/use-transcript-adapter.ts

"use client"

import { useTranscript as useTranscriptLegacy } from './use-transcript'
import { useTranscriptNew } from './use-transcript-new'
import { isFeatureEnabled } from '../lib/feature-flags'
import { TranscriptMessage } from '../lib/transcript-manager'

// çµ±ä¸€çš„ UseTranscript ä»‹é¢
interface UseTranscriptReturn {
    transcripts: TranscriptMessage[]
    isConnected: boolean
    isCompleted: boolean
    error: string | null
    connect: (sessionId: string) => Promise<void>
    disconnect: () => void
    clearTranscripts: () => void
    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    autoScrollEnabled: boolean
    enableAutoScroll: () => void
    disableAutoScroll: () => void
    scrollToLatest: () => void
    setScrollContainer: (element: HTMLElement | null) => void
}

/**
 * useTranscript é©é…å™¨ Hook
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨æ–°èˆŠç‰ˆæœ¬çš„ useTranscript
 * ç‰¹åˆ¥æ³¨æ„ä¿æŒ TranscriptManager çš„ WebSocket é‡é€£æ©Ÿåˆ¶
 */
export function useTranscript(): UseTranscriptReturn {
    const useNewTranscriptHook = isFeatureEnabled('useNewTranscriptHook')
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')

    console.log('ğŸ”„ [useTranscriptAdapter] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewTranscriptHook,
        useNewStateManagement,
        willUseNewVersion: useNewTranscriptHook || useNewStateManagement
    })

    // å¦‚æœå•Ÿç”¨æ–° Transcript Hook æˆ–æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬
    if (useNewTranscriptHook || useNewStateManagement) {
        console.log('ğŸ”„ [useTranscriptAdapter] ä½¿ç”¨æ–°ç‰ˆæœ¬ useTranscriptNew')
        return useTranscriptNew()
    }

    // å¦å‰‡ä½¿ç”¨èˆŠç‰ˆæœ¬
    console.log('ğŸ”„ [useTranscriptAdapter] ä½¿ç”¨èˆŠç‰ˆæœ¬ useTranscript')
    return useTranscriptLegacy()
}

// å°å‡ºèˆŠç‰ˆæœ¬ä¾›ç›´æ¥ä½¿ç”¨ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ç‰¹æ®Šæƒ…æ³ï¼‰
export { useTranscript as useTranscriptLegacy } from './use-transcript'
export { useTranscriptNew } from './use-transcript-new'


# END FILE CONTENTS


# File: PRD.md

# StudyScriber PRD

---

## 1. å°ˆæ¡ˆé¡˜æ™¯

æä¾›ã€Œé‚ŠéŒ„é‚Šè½‰éŒ„ã€çš„é›²ç«¯ç­†è¨˜ï¼Œè®“å…§éƒ¨è¨“ç·´ã€è¬›åº§ç­†è¨˜ä¸€æ¬¡åˆ°ä½ï¼šå¯é¸éŒ„éŸ³ã€å³æ™‚é€å­—ç¨¿ã€Markdown ç­†è¨˜èˆ‡åŒ¯å‡ºï¼Œä¸€æ¢é¾å®Œæˆã€‚

---

## 2. ç”¢å“å®šä½

| é …ç›®     | æè¿°                                                               |
| -------- | ------------------------------------------------------------------ |
| ç›®æ¨™æ—ç¾¤ | æˆå¹´è‡ªå­¸è€…                                                         |
| ç—›é»     | å‚™èª²ï¼è½èª²åŒæ™‚è¦åšç­†è¨˜ã€æ•´ç†é€å­—ç¨¿è€—æ™‚ã€æœ‰æ™‚åªéœ€è¦ç­†è¨˜åŠŸèƒ½         |
| æ ¸å¿ƒåƒ¹å€¼ | 1 å€‹ç•«é¢å®Œæˆã€Œç´”ç­†è¨˜ã€æˆ–ã€ŒéŒ„éŸ³ â†’ å³æ™‚é€å­—ç¨¿ â†’ ç­†è¨˜ã€ï¼Œèª²å¾Œä¸€éµåŒ¯å‡º |

---

## 3. åŠŸèƒ½åˆ—è¡¨

1. **é›²ç«¯ Markdown ç­†è¨˜**  
   éš¨æ™‚æ’°å¯« Markdown ç­†è¨˜

2. **éŒ„éŸ³èˆ‡å³æ™‚é€å­—ç¨¿**  
   é‚ŠéŒ„éŸ³é‚Šè‡ªå‹•ç”¢ç”Ÿé€å­—ç¨¿ï¼Œæ”¯æ´å¤šåœ‹èªè¨€

3. **å¤šç¨®èªéŸ³è¾¨è­˜å¼•æ“é¸æ“‡**  
   å¯åˆ‡æ› Whisper æˆ– GPT-4o-transcribe Model

4. **ä¸€éµåŒ¯å‡º**  
   ç­†è¨˜ã€é€å­—ç¨¿å¯ä¸€éµåŒ¯å‡º ZIP æª”



# END FILE CONTENTS


# File: frontend/lib/__tests__/initial-state-loader.test.ts

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { InitialStateLoader } from '../initial-state-loader'
import type { AppData } from '../../types/app-state'

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
    clear: vi.fn(),
}

// åœ¨æ¸¬è©¦ç’°å¢ƒä¸­è¨­ç½® localStorage mock
Object.defineProperty(window, 'localStorage', {
    value: localStorageMock
})

describe('InitialStateLoader', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        localStorageMock.getItem.mockReturnValue(null)
    })

    describe('loadInitialAppData', () => {
        test('æ‡‰è©²è¿”å›é è¨­ç‹€æ…‹ç•¶æ²’æœ‰æŒä¹…åŒ–è³‡æ–™æ™‚', () => {
            const result = InitialStateLoader.loadInitialAppData()

            expect(result).toEqual({
                state: 'default',
                transcriptEntries: [],
                editorContent: '',
                isRecording: false,
                recordingTime: 0,
                session: null,
            })
        })

        test('æ‡‰è©²è¼‰å…¥è‰ç¨¿ç­†è¨˜å…§å®¹', () => {
            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'draft_note') return 'æ¸¬è©¦è‰ç¨¿å…§å®¹'
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            expect(result.editorContent).toBe('æ¸¬è©¦è‰ç¨¿å…§å®¹')
            expect(localStorageMock.getItem).toHaveBeenCalledWith('draft_note')
        })

        test('æ‡‰è©²è¼‰å…¥ä¸Šæ¬¡æœƒè©±è³‡è¨Š', () => {
            const mockSession = {
                id: 'test-session-id',
                status: 'active',
                type: 'recording'
            }

            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'last_session') return JSON.stringify(mockSession)
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            expect(result.session).toEqual(mockSession)
            expect(localStorageMock.getItem).toHaveBeenCalledWith('last_session')
        })

        test('æ‡‰è©²å¿½ç•¥å·²å®Œæˆçš„æœƒè©±', () => {
            const completedSession = {
                id: 'test-session-id',
                status: 'completed',
                type: 'recording'
            }

            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'last_session') return JSON.stringify(completedSession)
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            expect(result.session).toBeNull()
        })

        test('æ‡‰è©²è¼‰å…¥å®Œæ•´çš„æ‡‰ç”¨ç‹€æ…‹', () => {
            const mockAppState = {
                state: 'recording_active',
                transcriptEntries: [
                    { time: '00:01', text: 'æ¸¬è©¦é€å­—ç¨¿' }
                ]
            }

            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'app_state_v1') return JSON.stringify(mockAppState)
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            expect(result.state).toBe('recording_active')
            expect(result.transcriptEntries).toEqual(mockAppState.transcriptEntries)
        })

        test('æ‡‰è©²è™•ç†ç„¡æ•ˆçš„ JSON è³‡æ–™', () => {
            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'last_session') return 'invalid json'
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            // æ‡‰è©²è¿”å›é è¨­ç‹€æ…‹è€Œä¸æ˜¯æ‹‹å‡ºéŒ¯èª¤
            expect(result.session).toBeNull()
        })
    })

    describe('saveAppState', () => {
        test('æ‡‰è©²å„²å­˜æ‡‰ç”¨ç‹€æ…‹åˆ° localStorage', () => {
            const mockAppData: AppData = {
                state: 'recording_active',
                transcriptEntries: [{ time: '00:01', text: 'æ¸¬è©¦' }],
                editorContent: 'æ¸¬è©¦å…§å®¹',
                isRecording: true,
                recordingTime: 30,
                session: {
                    id: 'test-session',
                    status: 'active',
                    type: 'recording'
                }
            }

            InitialStateLoader.saveAppState(mockAppData)

            expect(localStorageMock.setItem).toHaveBeenCalledWith(
                'app_state_v1',
                JSON.stringify({
                    state: 'recording_active',
                    transcriptEntries: [{ time: '00:01', text: 'æ¸¬è©¦' }]
                })
            )

            expect(localStorageMock.setItem).toHaveBeenCalledWith(
                'last_session',
                JSON.stringify(mockAppData.session)
            )
        })

        test('æ‡‰è©²ç§»é™¤æœƒè©±è³‡è¨Šç•¶ session ç‚º null', () => {
            const mockAppData: AppData = {
                state: 'default',
                transcriptEntries: [],
                editorContent: '',
                isRecording: false,
                recordingTime: 0,
                session: null
            }

            InitialStateLoader.saveAppState(mockAppData)

            expect(localStorageMock.removeItem).toHaveBeenCalledWith('last_session')
        })
    })

    describe('clearPersistedState', () => {
        test('æ‡‰è©²æ¸…é™¤æŒä¹…åŒ–ç‹€æ…‹', () => {
            InitialStateLoader.clearPersistedState()

            expect(localStorageMock.removeItem).toHaveBeenCalledWith('app_state_v1')
            expect(localStorageMock.removeItem).toHaveBeenCalledWith('last_session')
            // ä¸æ‡‰è©²æ¸…é™¤ draft_note
            expect(localStorageMock.removeItem).not.toHaveBeenCalledWith('draft_note')
        })
    })

    describe('hasPersistedState', () => {
        test('ç•¶æœ‰æŒä¹…åŒ–ç‹€æ…‹æ™‚æ‡‰è©²è¿”å› true', () => {
            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'app_state_v1') return '{"state":"default"}'
                return null
            })

            expect(InitialStateLoader.hasPersistedState()).toBe(true)
        })

        test('ç•¶æ²’æœ‰æŒä¹…åŒ–ç‹€æ…‹æ™‚æ‡‰è©²è¿”å› false', () => {
            expect(InitialStateLoader.hasPersistedState()).toBe(false)
        })

        test('ç•¶æœ‰æœƒè©±è³‡è¨Šæ™‚æ‡‰è©²è¿”å› true', () => {
            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'last_session') return '{"id":"test"}'
                return null
            })

            expect(InitialStateLoader.hasPersistedState()).toBe(true)
        })
    })
})


# END FILE CONTENTS


# File: frontend/utils/event-bus.ts

type Handler = (payload?: unknown) => void
const bus = new Map<string, Set<Handler>>()

export function on(event: string, fn: Handler) {
    (bus.get(event) ?? bus.set(event, new Set()).get(event))!.add(fn)
}
export function off(event: string, fn: Handler) {
    bus.get(event)?.delete(fn)
}
export function emit(event: string, payload?: unknown) {
    bus.get(event)?.forEach(fn => fn(payload))
}


# END FILE CONTENTS


# File: package.json

{
	"devDependencies": {
		"@playwright/test": "^1.54.1",
		"jszip": "^3.10.1"
	},
	"packageManager": "pnpm@10.7.0+sha1.66453f13fbf9078d3db193718206a8d738afdbdb"
}


# END FILE CONTENTS


# File: docs/export-wait-until-completed-20240608.md

# åŒ¯å‡ºéœ€ç­‰ session ç‹€æ…‹ completed æµç¨‹è¦æ ¼

- **å»ºç«‹æ—¥æœŸ**ï¼š2024-06-08
- **åŠŸèƒ½èªªæ˜**ï¼š
  - å‰ç«¯åŒ¯å‡ºéŒ„éŸ³/é€å­—ç¨¿æ™‚ï¼Œå¿…é ˆç­‰å¾Œç«¯ session ç‹€æ…‹ç‚º completedï¼Œæ‰èƒ½é€²è¡Œä¸‹è¼‰ï¼Œé¿å… 500/409 éŒ¯èª¤ã€‚

---

## ä¸€ã€å¾Œç«¯

### 1. PATCH /session/{sid}/finish
- å·²æœ‰ï¼šå‘¼å«æ™‚æœƒå°‡ session.status è¨­ç‚º completedã€‚

### 2. WebSocket éŒ„éŸ³ä¸Šå‚³æµç¨‹
- æ–°å¢ï¼š
  - åœ¨ `app/ws/upload_audio.py` çš„ `_handle_upload_complete` æ–¹æ³•çµå°¾ï¼Œæ–¼æ‰€æœ‰éŸ³æª”åˆ‡ç‰‡ä¸Šå‚³èˆ‡è½‰éŒ„å®Œæˆå¾Œï¼Œè‡ªå‹•å°‡ session ç‹€æ…‹è¨­ç‚º completedã€‚
  - å¯¦ä½œï¼š
    ```python
    self.supabase_client.table("sessions").update({
        "status": "completed",
        "completed_at": datetime.utcnow().isoformat()
    }).eq("id", str(self.session_id)).execute()
    ```

---

## äºŒã€å‰ç«¯

### 1. useSession hook
- æä¾› `waitUntilCompleted(timeout)` æ–¹æ³•ï¼Œæ¯ 1.5 ç§’è¼ªè©¢ `/api/session/{sid}`ï¼Œç›´åˆ° status === completed æˆ–è¶…æ™‚ã€‚

### 2. ExportButton
- åŒ¯å‡ºå‰å‘¼å« `waitUntilCompleted`ï¼Œè‹¥æœªå®Œæˆå‰‡æç¤ºç”¨æˆ¶ã€Œå¾Œç«¯ä»åœ¨è™•ç†é€å­—ç¨¿ï¼Œè«‹ç¨å€™å†è©¦ã€ã€‚
- å®Œæˆå¾Œæ‰æœƒè§¸ç™¼ä¸‹è¼‰ã€‚

---

## ä¸‰ã€æ¸¬è©¦
- æ‡‰æ¸¬è©¦ï¼š
  - éŒ„éŸ³çµæŸå¾Œï¼Œsession ç‹€æ…‹æœƒè‡ªå‹•æ¨™è¨˜ completedã€‚
  - åŒ¯å‡ºæ™‚è‹¥æœªå®Œæˆï¼Œå‰ç«¯æœƒæ­£ç¢ºæç¤ºã€‚
  - åŒ¯å‡ºæ™‚è‹¥å·²å®Œæˆï¼Œèƒ½æ­£ç¢ºä¸‹è¼‰ã€‚

---

## å››ã€å‚™è¨»
- æ­¤è¨­è¨ˆå¯é˜²æ­¢å‰ç«¯èª¤è§¸ç™¼åŒ¯å‡ºæ™‚ï¼Œå¾Œç«¯å°šæœªå®Œæˆé€å­—ç¨¿è™•ç†ï¼Œå°è‡´ 500/409 éŒ¯èª¤ã€‚
- session ç‹€æ…‹çµ±ä¸€ç”± finish API æˆ– WebSocket è™•ç†çµæŸæ™‚è‡ªå‹•æ¨™è¨˜ã€‚ 


# END FILE CONTENTS


# File: frontend/lib/__tests__/segmented-audio-recorder.test.ts

import { describe, test, expect, beforeEach, vi, afterEach } from 'vitest'
import { SegmentedAudioRecorder, checkSegmentedAudioRecordingSupport } from '../segmented-audio-recorder'

// Mock navigator.mediaDevices
const mockGetUserMedia = vi.fn()
Object.defineProperty(navigator, 'mediaDevices', {
    writable: true,
    value: {
        getUserMedia: mockGetUserMedia,
    },
})

// Mock MediaRecorder
const mockStart = vi.fn()
const mockStop = vi.fn()
const mockRequestData = vi.fn()

class MockMediaRecorder {
    start = mockStart
    stop = mockStop
    requestData = mockRequestData
    state: string = 'inactive'
    ondataavailable: ((event: any) => void) | null = null
    onerror: ((event: any) => void) | null = null

    constructor(stream: any, options: any) {
        // Store for verification
    }

    static isTypeSupported = vi.fn().mockReturnValue(true)
}

Object.defineProperty(window, 'MediaRecorder', {
    writable: true,
    value: MockMediaRecorder,
})

// Mock stream
const mockTrack = { stop: vi.fn() }
const mockStream = {
    getTracks: vi.fn(() => [mockTrack])
}

describe('SegmentedAudioRecorder', () => {
    let recorder: SegmentedAudioRecorder

    beforeEach(() => {
        vi.clearAllMocks()
        mockGetUserMedia.mockResolvedValue(mockStream)

        recorder = new SegmentedAudioRecorder({
            segmentDuration: 1000,
            mimeType: 'audio/webm;codecs=opus',
            audioBitsPerSecond: 64000
        })
    })

    afterEach(() => {
        recorder.cleanup()
    })

    describe('åˆå§‹åŒ–å’Œé…ç½®', () => {
        test('æ‡‰è©²ä½¿ç”¨é è¨­é…ç½®å‰µå»ºéŒ„éŸ³å™¨', () => {
            const defaultRecorder = new SegmentedAudioRecorder()

            expect(defaultRecorder.currentConfig).toEqual({
                segmentDuration: 10000,
                mimeType: 'audio/webm;codecs=opus',
                audioBitsPerSecond: 64000
            })
            expect(defaultRecorder.currentState).toBe('idle')
            expect(defaultRecorder.isRecording).toBe(false)
            expect(defaultRecorder.currentSequence).toBe(0)
        })

        test('æ‡‰è©²æ¥å—è‡ªè¨‚é…ç½®', () => {
            const customConfig = {
                segmentDuration: 3000,
                mimeType: 'audio/webm',
                audioBitsPerSecond: 64000
            }

            const customRecorder = new SegmentedAudioRecorder(customConfig)
            expect(customRecorder.currentConfig).toEqual(customConfig)
        })

        test('æ‡‰è©²æ­£ç¢ºè¨­ç½®äº‹ä»¶å›èª¿', () => {
            const onSegment = vi.fn()
            const onError = vi.fn()
            const onStateChange = vi.fn()

            recorder.onSegment(onSegment)
            recorder.onError(onError)
            recorder.onStateChange(onStateChange)

            // å›èª¿æ‡‰è©²è¢«æ­£ç¢ºè¨­ç½®ï¼ˆé€éå¾ŒçºŒè¡Œç‚ºé©—è­‰ï¼‰
            expect(recorder.currentState).toBe('idle')
        })
    })

    describe('éŸ³è¨Šæ¬Šé™å’Œåˆå§‹åŒ–', () => {
        test('æ‡‰è©²æˆåŠŸåˆå§‹åŒ–éŸ³è¨Šæ¬Šé™', async () => {
            await recorder.initialize()

            expect(mockGetUserMedia).toHaveBeenCalledWith({ audio: true })
        })

        test('æ‡‰è©²è™•ç†æ¬Šé™è¢«æ‹’çµ•çš„æƒ…æ³', async () => {
            const error = new Error('Permission denied')
            mockGetUserMedia.mockRejectedValueOnce(error)

            const onError = vi.fn()
            recorder.onError(onError)

            await expect(recorder.initialize()).rejects.toThrow('Permission denied')
        })

        test('æ‡‰è©²é¿å…é‡è¤‡åˆå§‹åŒ–', async () => {
            await recorder.initialize()
            await recorder.initialize() // ç¬¬äºŒæ¬¡èª¿ç”¨

            expect(mockGetUserMedia).toHaveBeenCalledTimes(1)
        })
    })

    describe('éŒ„éŸ³ç‹€æ…‹ç®¡ç†', () => {
        beforeEach(async () => {
            await recorder.initialize()
        })

        test('æ‡‰è©²æ­£ç¢ºé–‹å§‹éŒ„éŸ³', async () => {
            const onSegment = vi.fn()

            await recorder.start(onSegment)

            expect(recorder.isRecording).toBe(true)
            expect(recorder.currentState).toBe('recording')
            expect(mockStart).toHaveBeenCalled()
        })

        test('æ‡‰è©²é˜²æ­¢é‡è¤‡é–‹å§‹éŒ„éŸ³', async () => {
            const onSegment = vi.fn()

            await recorder.start(onSegment)

            await expect(recorder.start(onSegment)).rejects.toThrow('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
        })

        test('æ‡‰è©²æ­£ç¢ºåœæ­¢éŒ„éŸ³', async () => {
            const onSegment = vi.fn()

            await recorder.start(onSegment)
            recorder.stop()

            expect(recorder.isRecording).toBe(false)
            expect(recorder.currentState).toBe('idle')
        })
    })

    describe('åºè™Ÿç®¡ç†', () => {
        test('æ‡‰è©²å¾ 0 é–‹å§‹åºè™Ÿ', () => {
            expect(recorder.currentSequence).toBe(0)
        })

        test('æ‡‰è©²åœ¨é‡æ–°é–‹å§‹éŒ„éŸ³æ™‚é‡ç½®åºè™Ÿ', async () => {
            await recorder.initialize()
            const onSegment = vi.fn()

            await recorder.start(onSegment)
            recorder.stop()

            expect(recorder.currentSequence).toBe(0)
        })
    })

    describe('è³‡æºæ¸…ç†', () => {
        test('æ‡‰è©²æ­£ç¢ºæ¸…ç†æ‰€æœ‰è³‡æº', async () => {
            await recorder.initialize()
            const onSegment = vi.fn()
            await recorder.start(onSegment)

            recorder.cleanup()

            expect(recorder.isRecording).toBe(false)
            expect(recorder.currentSequence).toBe(0)
            expect(mockTrack.stop).toHaveBeenCalled()
        })
    })
})

describe('ç€è¦½å™¨æ”¯æ´æª¢æŸ¥', () => {
    test('æ‡‰è©²æª¢æŸ¥åŸºæœ¬ç€è¦½å™¨æ”¯æ´', async () => {
        const result = await checkSegmentedAudioRecordingSupport()
        expect(result.isSupported).toBe(true)
    })

    test('æ‡‰è©²æª¢æ¸¬ MediaDevices API ä¸æ”¯æ´', async () => {
        // ä½¿ç”¨ vi.stubGlobal ä¾†æ¨¡æ“¬ä¸æ”¯æ´çš„æƒ…æ³
        vi.stubGlobal('navigator', { ...navigator, mediaDevices: undefined })

        const result = await checkSegmentedAudioRecordingSupport()

        expect(result.isSupported).toBe(false)
        expect(result.error).toContain('ä¸æ”¯æ´ MediaDevices API')

        vi.unstubAllGlobals()
    })

    test('æ‡‰è©²æª¢æ¸¬ MediaRecorder API ä¸æ”¯æ´', async () => {
        // ç›´æ¥æ¸¬è©¦æ²’æœ‰ MediaRecorder çš„æƒ…æ³
        const originalMediaRecorder = global.MediaRecorder
        delete (global as any).MediaRecorder

        const result = await checkSegmentedAudioRecordingSupport()

        expect(result.isSupported).toBe(false)
        expect(result.error).toContain('ä¸æ”¯æ´ MediaRecorder API')

        // æ¢å¾©
        global.MediaRecorder = originalMediaRecorder
    })
})


# END FILE CONTENTS


# File: frontend/app/globals.css

@tailwind base;
@tailwind components;
@tailwind utilities;
@import "easymde/dist/easymde.min.css";

@theme {
  --color-background: oklch(1 0 0);
  --color-foreground: oklch(0.145 0 0);
  --color-muted: oklch(0.898 0 0);
  --color-muted-foreground: oklch(0.478 0 0);
  --color-border: oklch(0.898 0 0);
  --color-primary: oklch(0.205 0 0);
  --color-primary-foreground: oklch(0.985 0 0);
}

:root {
  --border: 210, 12%, 83%;
}

/* Custom SimpleMDE styling to match design system */
.CodeMirror {
  font-family: ui-sans-serif, system-ui, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: oklch(0.145 0 0);
  background-color: oklch(1 0 0);
  border: none;
  padding: 16px;
}

.editor-toolbar {
  border: none;
  background-color: oklch(1 0 0);
  padding: 16px;
  border-bottom: 1px solid oklch(0.898 0 0);
}

.editor-toolbar a {
  color: oklch(0.478 0 0) !important;
  border: none !important;
  padding: 8px !important;
  margin: 0 4px !important;
}

.editor-toolbar a:hover {
  background-color: oklch(0.898 0 0) !important;
  color: oklch(0.145 0 0) !important;
}

.editor-toolbar.fullscreen {
  background-color: oklch(1 0 0);
}

.CodeMirror-fullscreen {
  background-color: oklch(1 0 0);
}

/* Make SimpleMDE container fill full height */
.editor-container .react-simplemde-editor {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.editor-container .editor-toolbar {
  flex-shrink: 0;
}

.editor-container .CodeMirror {
  flex: 1;
  height: auto !important;
}

.editor-container .CodeMirror-scroll {
  min-height: 100%;
}

.EasyMDEContainer .editor-toolbar {
  border: 0px solid transparent !important;
}

.EasyMDEContainer .CodeMirror-wrap {
  border-width: 1px 0px 0px 0px !important;
}

# END FILE CONTENTS


# File: app/db/supabase_init.sql

/* -----------------------------------------------
StudyScriber â€“ Supabase Database Bootstrap v2025-07-13
------------------------------------------------- */

-- ---------- ENUM TYPES ----------
DO $$ BEGIN
    CREATE TYPE session_type AS ENUM ('note_only', 'recording');
EXCEPTION WHEN duplicate_object THEN NULL; END $$;

DO $$ BEGIN
    CREATE TYPE session_status AS ENUM ('active', 'completed', 'error');
EXCEPTION WHEN duplicate_object THEN NULL; END $$;

DO $$ BEGIN
    CREATE TYPE lang_code AS ENUM ('zh-TW', 'en-US');
EXCEPTION WHEN duplicate_object THEN NULL; END $$;

COMMENT ON TYPE lang_code IS 'èªè¨€ä»£ç¢¼ï¼šzh-TW=ç¹é«”ä¸­æ–‡ï¼›en-US=ç¾å¼è‹±æ–‡';

-- ---------- TABLE: sessions ----------
CREATE TABLE IF NOT EXISTS sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    type session_type NOT NULL DEFAULT 'note_only',
    status session_status NOT NULL DEFAULT 'active',
    title VARCHAR(255) DEFAULT 'æœªå‘½åç­†è¨˜',
    lang_code lang_code NOT NULL DEFAULT 'zh-TW', -- â˜… æ”¹å
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    started_at TIMESTAMPTZ,
    stt_provider TEXT,
    completed_at TIMESTAMPTZ
);

-- ---------- TABLE: notes ----------
CREATE TABLE IF NOT EXISTS notes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    session_id UUID NOT NULL REFERENCES sessions (id) ON DELETE CASCADE,
    content TEXT NOT NULL DEFAULT '',
    client_ts TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (session_id) -- æ¯å€‹ session åƒ…ä¸€æ¢ note
);

-- ---------- TABLE: audio_files ----------
CREATE TABLE IF NOT EXISTS audio_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    session_id UUID NOT NULL REFERENCES sessions (id) ON DELETE CASCADE,
    chunk_sequence INTEGER NOT NULL,
    r2_key TEXT NOT NULL,
    r2_bucket TEXT NOT NULL,
    file_size INTEGER NOT NULL,
    duration_seconds DECIMAL(10, 3),
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (session_id, chunk_sequence)
);

-- ---------- TABLE: transcript_segments ----------
CREATE TABLE IF NOT EXISTS transcript_segments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    session_id UUID NOT NULL REFERENCES sessions (id) ON DELETE CASCADE,
    chunk_sequence INTEGER NOT NULL,
    start_time DECIMAL(10, 3) NOT NULL,
    end_time DECIMAL(10, 3) NOT NULL,
    text TEXT NOT NULL,
    confidence DECIMAL(5, 4) DEFAULT 0.0,
    lang_code lang_code DEFAULT 'zh-TW', -- â˜… æ”¹å
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

-- ---------- TABLE: transcripts ----------
CREATE TABLE IF NOT EXISTS transcripts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    session_id UUID NOT NULL REFERENCES sessions (id) ON DELETE CASCADE,
    full_text TEXT NOT NULL DEFAULT '',
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (session_id) -- æ¯å€‹ session åƒ…ä¸€æ¢å®Œæ•´é€å­—ç¨¿
);

-- ---------- INDEXES ----------
CREATE INDEX IF NOT EXISTS idx_sessions_status ON sessions (status);

CREATE INDEX IF NOT EXISTS idx_sessions_created_at ON sessions (created_at);

CREATE INDEX IF NOT EXISTS idx_notes_session_id ON notes (session_id);

CREATE INDEX IF NOT EXISTS idx_audio_files_session_id ON audio_files (session_id);

CREATE INDEX IF NOT EXISTS idx_audio_files_sequence ON audio_files (session_id, chunk_sequence);

CREATE INDEX IF NOT EXISTS idx_transcript_segments_session_id ON transcript_segments (session_id);

CREATE INDEX IF NOT EXISTS idx_transcript_segments_sequence ON transcript_segments (session_id, chunk_sequence);

CREATE INDEX IF NOT EXISTS idx_transcripts_session_id ON transcripts (session_id);

-- ---------- TRIGGER: update updated_at ----------
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS trigger LANGUAGE plpgsql AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END $$;

DROP TRIGGER IF EXISTS update_sessions_updated_at ON sessions;

DROP TRIGGER IF EXISTS update_notes_updated_at ON notes;

DROP TRIGGER IF EXISTS update_transcripts_updated_at ON transcripts;

CREATE TRIGGER update_sessions_updated_at
    BEFORE UPDATE ON sessions
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_notes_updated_at
    BEFORE UPDATE ON notes
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_transcripts_updated_at
    BEFORE UPDATE ON transcripts
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- ---------- TRIGGER: single active session ----------
CREATE OR REPLACE FUNCTION check_single_active_session()
RETURNS trigger LANGUAGE plpgsql AS $$
BEGIN
    IF NEW.status = 'active' THEN
        UPDATE sessions
           SET status      = 'completed',
               completed_at = CURRENT_TIMESTAMP
         WHERE status = 'active'
           AND id      <> NEW.id;
    END IF;
    RETURN NEW;
END $$;

DROP TRIGGER IF EXISTS ensure_single_active_session ON sessions;

CREATE TRIGGER ensure_single_active_session
    BEFORE INSERT OR UPDATE ON sessions
    FOR EACH ROW EXECUTE FUNCTION check_single_active_session();

-- ---------- DONE ----------
SELECT 'StudyScriber è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆï¼' AS message;


# END FILE CONTENTS


# File: frontend/.eslintrc.json

{
  "extends": [
    "next/core-web-vitals",
    "next/typescript"
  ]
}


# END FILE CONTENTS


# File: frontend/components/default-state.tsx

"use client"

import { Button } from "@/components/ui/button"
import { Upload, FileText } from "lucide-react"

interface DefaultStateProps {
  onStartRecording: () => void
}

export function DefaultState({ onStartRecording }: DefaultStateProps) {
  const handleClick = () => {
    console.log("ğŸ”˜ [DefaultState] æŒ‰éˆ•è¢«é»æ“Š")
    console.log("ğŸ”˜ [DefaultState] onStartRecording å‡½æ•¸:", typeof onStartRecording)
    try {
      onStartRecording()
      console.log("ğŸ”˜ [DefaultState] onStartRecording èª¿ç”¨æˆåŠŸ")
    } catch (error) {
      console.error("ğŸ”˜ [DefaultState] onStartRecording èª¿ç”¨å¤±æ•—:", error)
    }
  }

  console.log("ğŸ”„ [DefaultState] çµ„ä»¶æ¸²æŸ“ï¼ŒonStartRecording:", typeof onStartRecording)

  return (
    <div className="h-full flex flex-col p-6">
      {/* Main content */}
      <div className="flex-1 flex flex-col items-center justify-center space-y-6">
        <Button
          onClick={handleClick}
          size="lg"
          className="flex items-center gap-3 px-8 py-4 text-base"
          data-testid="start-recording-button"
        >
          <Upload className="w-5 h-5" />
          Start Recording
        </Button>

        <div className="text-center text-muted-foreground text-sm space-y-1">
          <p className="flex items-center justify-center gap-2">
            <FileText className="w-4 h-4" />
            æˆ–ç›´æ¥é–‹å§‹ç·¨å¯«ç­†è¨˜
          </p>
          <p>éŒ„éŸ³åŠŸèƒ½éš¨æ™‚å¯ä»¥å•Ÿç”¨</p>
        </div>
      </div>
    </div>
  )
}


# END FILE CONTENTS


# File: frontend/lib/services/session-service.ts

"use client"

import { BaseService } from './base-service'
import { ISessionService } from './interfaces'
import { sessionAPI, type SessionCreateRequest, type SessionResponse } from '../api'
import axios from 'axios'

/**
 * SessionService - æœƒè©±ç®¡ç†æœå‹™
 *
 * é‡æ§‹ç¾æœ‰çš„ sessionAPI é‚è¼¯åˆ°æœå‹™å±¤ï¼Œæä¾›ï¼š
 * - æœƒè©±å‰µå»ºï¼ˆç´”ç­†è¨˜ã€éŒ„éŸ³æ¨¡å¼ï¼‰
 * - æœƒè©±å‡ç´šï¼ˆç´”ç­†è¨˜ â†’ éŒ„éŸ³æ¨¡å¼ï¼‰
 * - æœƒè©±ç‹€æ…‹ç®¡ç†
 * - çµ±ä¸€éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
 */
import { STTProvider } from '../api'

export class SessionService extends BaseService implements ISessionService {
    protected readonly serviceName = 'SessionService'

    /**
     * æœå‹™åˆå§‹åŒ–
     * é‡ç”¨ç¾æœ‰çš„ sessionAPI é…ç½®å’Œæ””æˆªå™¨
     */
    async initialize(): Promise<void> {
        this.logInfo('æœå‹™åˆå§‹åŒ–é–‹å§‹')

        // æª¢æŸ¥ sessionAPI å¯ç”¨æ€§
        try {
            // ç°¡å–®çš„å¥åº·æª¢æŸ¥ - å˜—è©¦ç²å–æ´»èºæœƒè©±
            await this.checkActiveSession()
            this.logSuccess('API é€£æ¥æª¢æŸ¥', 'å¾Œç«¯ API é€£æ¥æ­£å¸¸')
        } catch (error) {
            // ç¶²è·¯éŒ¯èª¤ä¸å½±éŸ¿åˆå§‹åŒ–ï¼Œè¨˜éŒ„è­¦å‘Šå³å¯
            if (axios.isAxiosError(error) && error.code === 'ERR_NETWORK') {
                this.logWarning('API é€£æ¥æª¢æŸ¥å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿æœå‹™åˆå§‹åŒ–', error.message)
            } else {
                this.logWarning('åˆå§‹åŒ–å¥åº·æª¢æŸ¥å¤±æ•—', error)
            }
        }

        this.logSuccess('åˆå§‹åŒ–å®Œæˆ')
    }

    /**
     * æœå‹™æ¸…ç†
     */
    async cleanup(): Promise<void> {
        this.logInfo('æœå‹™æ¸…ç†é–‹å§‹')
        // SessionService ä¸»è¦æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œç„¡éœ€ç‰¹æ®Šæ¸…ç†
        this.logSuccess('æ¸…ç†å®Œæˆ')
    }

    /**
     * ç¢ºä¿éŒ„éŸ³æœƒè©±å­˜åœ¨ - å„ªé›…è™•ç†æœƒè©±è¡çª
     *
     * ç­–ç•¥ï¼š
     * 1. å„ªå…ˆå˜—è©¦å‰µå»ºæ–°çš„éŒ„éŸ³æœƒè©±
     * 2. è‹¥é‡åˆ° 409 è¡çªï¼Œæ”¹ç‚ºç²å–ç¾æœ‰æ´»èºæœƒè©±
     * 3. ç¢ºä¿è¿”å›å¯ç”¨çš„éŒ„éŸ³æœƒè©±
     */
    async ensureRecordingSession(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse> {
        this.logInfo('ç¢ºä¿éŒ„éŸ³æœƒè©±å­˜åœ¨ - å¼·åˆ¶æ–°å»ºç­–ç•¥', { title, hasContent: !!content, hasStartTs: !!startTs, sttProvider })

        try {
            // 1. æª¢æŸ¥ä¸¦å®Œæˆä»»ä½•ç¾æœ‰æ´»èºæœƒè©±
            const existingSession = await this.checkActiveSession()
            if (existingSession) {
                this.logInfo('æª¢æ¸¬åˆ°ç¾æœ‰æ´»èºæœƒè©±ï¼Œæº–å‚™å®Œæˆ', {
                    sessionId: existingSession.id,
                    type: existingSession.type,
                    status: existingSession.status
                })

                await this.finishSession(existingSession.id)
                this.logSuccess('ç¾æœ‰æœƒè©±å·²å®Œæˆ', { sessionId: existingSession.id })
            } else {
                this.logInfo('æ²’æœ‰ç¾æœ‰æ´»èºæœƒè©±')
            }

            // 2. å¼·åˆ¶å‰µå»ºæ–°æœƒè©±
            const newSession = await this.createRecordingSession(
                title,
                content,
                startTs,
                sttProvider
            )

            this.logSuccess('å¼·åˆ¶æ–°å»ºç­–ç•¥å®Œæˆ', {
                newSessionId: newSession.id,
                type: newSession.type,
                status: newSession.status,
                sttProvider
            })

            return newSession

        } catch (error) {
            if (error instanceof Error && error.message.includes('409')) {
                // é‡åˆ°è¡çªï¼Œç²å–ç¾æœ‰æ´»èºæœƒè©±
                this.logWarning('æœƒè©±è¡çªï¼Œå˜—è©¦ç²å–ç¾æœ‰æ´»èºæœƒè©±')
                const activeSession = await this.checkActiveSession()
                if (activeSession) {
                    return activeSession
                }
            }
            this.handleError('ç¢ºä¿éŒ„éŸ³æœƒè©±å­˜åœ¨ - å¼·åˆ¶æ–°å»ºç­–ç•¥', error as Error)
        }
    }

    /**
     * å‰µå»ºéŒ„éŸ³æœƒè©±
     * é‡ç”¨ sessionAPI.createSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async createRecordingSession(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse> {
        this.logInfo('å‰µå»ºéŒ„éŸ³æœƒè©±', { title, hasContent: !!content, hasStartTs: !!startTs, sttProvider })

        try {
            const sessionData: SessionCreateRequest = {
                title,
                type: 'recording',
                content,
                start_ts: startTs,
                stt_provider: sttProvider
            }

            const session = await sessionAPI.createSession(sessionData)

            this.logSuccess('éŒ„éŸ³æœƒè©±å‰µå»ºæˆåŠŸ', {
                sessionId: session.id,
                type: session.type,
                status: session.status,
                withStartTs: !!startTs,
                sttProvider
            })

            return session
        } catch (error) {
            // ä¸åœ¨é€™è£¡è™•ç† 409 éŒ¯èª¤ï¼Œäº¤ç”± ensureRecordingSession è™•ç†
            this.handleError('å‰µå»ºéŒ„éŸ³æœƒè©±', error)
        }
    }

    /**
     * å‰µå»ºç´”ç­†è¨˜æœƒè©±
     * é‡ç”¨ sessionAPI.createSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async createNoteSession(title?: string, content?: string): Promise<SessionResponse> {
        this.logInfo('å‰µå»ºç´”ç­†è¨˜æœƒè©±', { title, hasContent: !!content })

        try {
            const sessionData: SessionCreateRequest = {
                title,
                type: 'note_only',
                content,
            }

            const session = await sessionAPI.createSession(sessionData)

            this.logSuccess('ç´”ç­†è¨˜æœƒè©±å‰µå»ºæˆåŠŸ', {
                sessionId: session.id,
                type: session.type,
                status: session.status
            })

            return session
        } catch (error) {
            // è™•ç†æœƒè©±è¡çªéŒ¯èª¤ï¼ˆ409ï¼‰
            if (axios.isAxiosError(error) && error.response?.status === 409) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                this.logWarning('æœƒè©±è¡çªéŒ¯èª¤ (409)', {
                    detail: error.response?.data?.detail,
                    message: error.message
                })
                this.handleError('å‰µå»ºç´”ç­†è¨˜æœƒè©±', new Error(conflictMessage))
            }

            this.handleError('å‰µå»ºç´”ç­†è¨˜æœƒè©±', error)
        }
    }

    /**
     * å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼
     * é‡ç”¨ sessionAPI.upgradeToRecording çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async upgradeToRecording(sessionId: string): Promise<SessionResponse> {
        this.logInfo('å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼', { sessionId })

        try {
            // å…ˆæª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨å’Œç‹€æ…‹
            const currentSession = await this.checkActiveSession()

            if (!currentSession) {
                this.handleError('å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼', new Error('æ²’æœ‰æ´»èºçš„æœƒè©±å¯ä»¥å‡ç´š'))
            }

            if (currentSession!.id !== sessionId) {
                this.handleError('å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼',
                    new Error(`æœƒè©± ID ä¸åŒ¹é…ï¼šè¦æ±‚å‡ç´š ${sessionId}ï¼Œä½†æ´»èºæœƒè©±ç‚º ${currentSession!.id}`))
            }

            if (currentSession!.type === 'recording') {
                this.logInfo('æœƒè©±å·²ç¶“æ˜¯éŒ„éŸ³æ¨¡å¼ï¼Œè¿”å›ç¾æœ‰æœƒè©±', { sessionId })
                return currentSession!
            }

            const updatedSession = await sessionAPI.upgradeToRecording(sessionId)

            this.logSuccess('æœƒè©±å‡ç´šæˆåŠŸ', {
                sessionId: updatedSession.id,
                oldType: currentSession!.type,
                newType: updatedSession.type,
                status: updatedSession.status
            })

            return updatedSession
        } catch (error) {
            this.handleError('å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼', error)
        }
    }

    /**
     * å®Œæˆæœƒè©±
     * é‡ç”¨ sessionAPI.finishSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async finishSession(sessionId: string): Promise<void> {
        this.logInfo('å®Œæˆæœƒè©±', { sessionId })

        try {
            await sessionAPI.finishSession(sessionId)

            this.logSuccess('æœƒè©±å®ŒæˆæˆåŠŸ', { sessionId })
        } catch (error) {
            this.handleError('å®Œæˆæœƒè©±', error)
        }
    }

    /**
     * æª¢æŸ¥æ´»èºæœƒè©±
     * é‡ç”¨ sessionAPI.getActiveSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async checkActiveSession(): Promise<SessionResponse | null> {
        this.logInfo('æª¢æŸ¥æ´»èºæœƒè©±')

        try {
            const activeSession = await sessionAPI.getActiveSession()

            if (activeSession) {
                this.logSuccess('æ´»èºæœƒè©±æª¢æŸ¥', {
                    sessionId: activeSession.id,
                    type: activeSession.type,
                    status: activeSession.status
                })
                return activeSession
            } else {
                this.logInfo('æ²’æœ‰æ´»èºæœƒè©±')
                return null
            }
        } catch (error) {
            // ç¶²è·¯éŒ¯èª¤ä¸æ‡‰è©²æ‹‹å‡ºï¼Œåªè¨˜éŒ„è­¦å‘Š
            if (axios.isAxiosError(error) && error.code === 'ERR_NETWORK') {
                this.logWarning('Backend API é€£ç·šæš«æ™‚å¤±æ•—ï¼Œå°‡åœ¨å¾ŒçºŒé‡è©¦', error.message)
                return null
            }

            this.handleError('æª¢æŸ¥æ´»èºæœƒè©±', error)
        }
    }

    /**
     * ç­‰å¾…æœƒè©±åœ¨è³‡æ–™åº«ä¸­å®Œå…¨å¯è¦‹
     * ç”¨æ–¼è§£æ±ºæœƒè©±å‰µå»ºå¾Œç«‹å³æŸ¥è©¢å¯èƒ½å¤±æ•—çš„æ™‚åºå•é¡Œ
     */
    async waitForSessionReady(sessionId: string, maxWaitTime: number = 5000): Promise<boolean> {
        this.logInfo('ç­‰å¾…æœƒè©±æº–å‚™å°±ç·’', { sessionId, maxWaitTime })

        const startTime = Date.now()
        const checkInterval = 200 // æ¯ 200ms æª¢æŸ¥ä¸€æ¬¡

        while (Date.now() - startTime < maxWaitTime) {
            try {
                const activeSession = await this.checkActiveSession()

                if (activeSession && activeSession.id === sessionId) {
                    // é€²ä¸€æ­¥é©—è­‰æœƒè©±ç‹€æ…‹
                    if (activeSession.status === 'active' && activeSession.type === 'recording') {
                        this.logSuccess('æœƒè©±å·²æº–å‚™å°±ç·’', {
                            sessionId,
                            status: activeSession.status,
                            type: activeSession.type,
                            waitTime: Date.now() - startTime
                        })
                        return true
                    }
                }
            } catch (error) {
                // æª¢æŸ¥å¤±æ•—æ™‚ç¹¼çºŒç­‰å¾…ï¼Œä¸æ‹‹å‡ºéŒ¯èª¤
                this.logWarning('æœƒè©±ç‹€æ…‹æª¢æŸ¥å¤±æ•—ï¼Œç¹¼çºŒç­‰å¾…', {
                    sessionId,
                    error: error instanceof Error ? error.message : String(error)
                })
            }

            // ç­‰å¾…ä¸‹æ¬¡æª¢æŸ¥
            await new Promise(resolve => setTimeout(resolve, checkInterval))
        }

        this.logWarning('ç­‰å¾…æœƒè©±æº–å‚™å°±ç·’è¶…æ™‚', {
            sessionId,
            maxWaitTime,
            actualWaitTime: Date.now() - startTime
        })

        return false
    }

    /**
     * åˆªé™¤æœƒè©±
     * é‡ç”¨ sessionAPI.deleteSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async deleteSession(sessionId: string): Promise<void> {
        this.logInfo('åˆªé™¤æœƒè©±', { sessionId })

        try {
            const result = await sessionAPI.deleteSession(sessionId)

            this.logSuccess('æœƒè©±åˆªé™¤æˆåŠŸ', {
                sessionId,
                result
            })
        } catch (error) {
            this.handleError('åˆªé™¤æœƒè©±', error)
        }
    }

    /**
     * ç²å–æœå‹™ç‹€æ…‹æ‘˜è¦
     * æ“´å±•åŸºç¤ç‹€æ…‹ä¿¡æ¯ï¼ŒåŒ…å« API é€£æ¥ç‹€æ…‹
     */
    async getServiceStatus(): Promise<SessionServiceStatus> {
        const baseStatus = this.getStatus()

        // æª¢æŸ¥ API é€£æ¥ç‹€æ…‹
        let apiConnected = false
        let lastApiCheck: string | null = null

        try {
            await this.checkActiveSession()
            apiConnected = true
            lastApiCheck = new Date().toISOString()
        } catch {
            apiConnected = false
            lastApiCheck = new Date().toISOString()
        }

        return {
            ...baseStatus,
            apiConnected,
            lastApiCheck
        }
    }
}

/**
 * SessionService ç‹€æ…‹ä»‹é¢
 * æ“´å±•åŸºç¤æœå‹™ç‹€æ…‹ï¼ŒåŒ…å« API ç‰¹å®šä¿¡æ¯
 */
export interface SessionServiceStatus {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    timestamp: string
    apiConnected: boolean
    lastApiCheck: string | null
}


# END FILE CONTENTS


# File: frontend/e2e/transcript-integration.spec.ts

import { test, expect, Page } from '@playwright/test'

/**
 * é€å­—ç¨¿åŠŸèƒ½æ•´åˆæ¸¬è©¦
 * æ¸¬è©¦å®Œæ•´çš„éŒ„éŸ³å’Œé€å­—ç¨¿æµç¨‹ï¼ŒåŒ…æ‹¬æ–°èˆŠç³»çµ±çš„åˆ‡æ›
 */

// æ¸¬è©¦å‰çš„è¨­ç½®
test.beforeEach(async ({ page }) => {
  // å‰å¾€æ‡‰ç”¨ç¨‹å¼
  await page.goto('http://localhost:3000')

  // ç­‰å¾…é é¢è¼‰å…¥å®Œæˆ
  await page.waitForLoadState('networkidle')

  // æª¢æŸ¥é é¢æ˜¯å¦æ­£å¸¸è¼‰å…¥
  await expect(page).toHaveTitle(/study-scriber/)
})

test.describe('é€å­—ç¨¿åŠŸèƒ½æ¸¬è©¦', () => {
  test('æ‡‰è©²èƒ½å¤ å•Ÿç”¨æ–°çš„ç‹€æ…‹ç®¡ç†ç³»çµ±', async ({ page }) => {
    // åœ¨ç€è¦½å™¨æ§åˆ¶å°ä¸­å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      // å•Ÿç”¨æ‰€æœ‰æ–°åŠŸèƒ½
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })

    // é‡æ–°è¼‰å…¥é é¢ä»¥æ‡‰ç”¨æ–°è¨­ç½®
    await page.reload()
    await page.waitForLoadState('networkidle')

    // æª¢æŸ¥åŠŸèƒ½é–‹é—œæ˜¯å¦æ­£ç¢ºå•Ÿç”¨
    const featureFlags = await page.evaluate(() => {
      return (window as any).featureFlags?.getAll()
    })

    console.log('åŠŸèƒ½é–‹é—œç‹€æ…‹:', featureFlags)

    // é©—è­‰é—œéµåŠŸèƒ½å·²å•Ÿç”¨
    expect(featureFlags?.useNewStateManagement).toBe(true)
    expect(featureFlags?.useNewTranscriptHook).toBe(true)
  })

  test('æ‡‰è©²èƒ½å¤ é–‹å§‹éŒ„éŸ³æœƒè©±', async ({ page }) => {
    // å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })
    await page.reload()
    await page.waitForLoadState('networkidle')

    // å°‹æ‰¾éŒ„éŸ³æŒ‰éˆ•
    const recordButton = page.locator('button').filter({ hasText: /éŒ„éŸ³|Record|é–‹å§‹/ }).first()

    if (await recordButton.count() > 0) {
      // é»æ“ŠéŒ„éŸ³æŒ‰éˆ•
      await recordButton.click()

      // ç­‰å¾…éŒ„éŸ³ç‹€æ…‹è®Šæ›´
      await page.waitForTimeout(1000)

      // æª¢æŸ¥æ˜¯å¦æœ‰éŒ„éŸ³ç‹€æ…‹æŒ‡ç¤ºå™¨
      const recordingIndicator = page.locator('[data-testid="recording-indicator"]')
        .or(page.locator('text=/éŒ„éŸ³ä¸­|Recording/'))
        .or(page.locator('.recording'))

      // å¦‚æœæ‰¾åˆ°éŒ„éŸ³æŒ‡ç¤ºå™¨ï¼Œé©—è­‰éŒ„éŸ³ç‹€æ…‹
      if (await recordingIndicator.count() > 0) {
        await expect(recordingIndicator.first()).toBeVisible()
        console.log('âœ… éŒ„éŸ³åŠŸèƒ½å·²å•Ÿå‹•')
      } else {
        console.log('â„¹ï¸ æœªæ‰¾åˆ°æ˜é¡¯çš„éŒ„éŸ³æŒ‡ç¤ºå™¨ï¼Œä½†éŒ„éŸ³æŒ‰éˆ•å·²é»æ“Š')
      }
    } else {
      console.log('â„¹ï¸ æœªæ‰¾åˆ°éŒ„éŸ³æŒ‰éˆ•ï¼Œå¯èƒ½éœ€è¦å…ˆå»ºç«‹æœƒè©±')
    }
  })

  test('æ‡‰è©²èƒ½å¤ å»ºç«‹æ–°çš„ç­†è¨˜æœƒè©±', async ({ page }) => {
    // å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })
    await page.reload()
    await page.waitForLoadState('networkidle')

    // å°‹æ‰¾æ–°ç­†è¨˜æˆ–æ–°æœƒè©±æŒ‰éˆ•
    const newNoteButton = page.locator('button').filter({ hasText: /æ–°ç­†è¨˜|New Note|æ–°å¢|Add/ }).first()

    if (await newNoteButton.count() > 0) {
      await newNoteButton.click()
      await page.waitForTimeout(500)
      console.log('âœ… æ–°ç­†è¨˜æŒ‰éˆ•å·²é»æ“Š')
    } else {
      console.log('â„¹ï¸ æœªæ‰¾åˆ°æ–°ç­†è¨˜æŒ‰éˆ•')
    }

    // æª¢æŸ¥æ–‡å­—ç·¨è¼¯å™¨æ˜¯å¦å­˜åœ¨
    const editorLocator = page.locator('.CodeMirror').first();
    const editorVisible = await editorLocator.isVisible();

    if (editorVisible) {
      console.log('âœ… CodeMirror ç·¨è¼¯å™¨å·²æ‰¾åˆ°ä¸”å¯è¦‹');
      // ä½¿ç”¨ evaluate ç›´æ¥è¨­ç½®ç·¨è¼¯å™¨å…§å®¹
      await page.evaluate((text) => {
        const editor = (window as any).theEditor; // å‡è¨­ SimpleMDE å¯¦ä¾‹æš´éœ²åœ¨ window
        if (editor && editor.codemirror) {
          editor.codemirror.setValue(text);
        } else {
          // é™ç´šæ–¹æ¡ˆï¼šå°‹æ‰¾ textarea
          const textarea = document.querySelector('.CodeMirror textarea') as HTMLTextAreaElement | null;
          if (textarea) {
            textarea.value = text;
            textarea.dispatchEvent(new Event('input', { bubbles: true }));
          }
        }
      }, 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç­†è¨˜ï¼Œç”¨æ–¼é©—è­‰é€å­—ç¨¿åŠŸèƒ½ã€‚');

      // é©—è­‰æ–‡å­—å·²è¼¸å…¥
      await expect(editorLocator).toHaveText(/æ¸¬è©¦ç­†è¨˜/);
      console.log('âœ… ç·¨è¼¯å™¨åŠŸèƒ½æ­£å¸¸');
    } else {
      console.log('â„¹ï¸ æœªæ‰¾åˆ° CodeMirror ç·¨è¼¯å™¨æˆ–å…¶ä¸å¯è¦‹');
      // å˜—è©¦å°‹æ‰¾å‚™ç”¨çš„ textarea
      const fallbackEditor = page.locator('[data-testid="fallback-editor"]');
      if (await fallbackEditor.count() > 0) {
        console.log('â„¹ï¸ æ‰¾åˆ°å‚™ç”¨ç·¨è¼¯å™¨ï¼Œç¹¼çºŒæ¸¬è©¦...');
        await fallbackEditor.fill('é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç­†è¨˜ï¼Œç”¨æ–¼é©—è­‰é€å­—ç¨¿åŠŸèƒ½ã€‚');
        await expect(fallbackEditor).toHaveValue(/æ¸¬è©¦ç­†è¨˜/);
        console.log('âœ… å‚™ç”¨ç·¨è¼¯å™¨åŠŸèƒ½æ­£å¸¸');
      } else {
        console.log('âŒ ä¸»ç·¨è¼¯å™¨èˆ‡å‚™ç”¨ç·¨è¼¯å™¨çš†æœªæ‰¾åˆ°');
      }
    }
  })

  test('æ‡‰è©²èƒ½å¤ æª¢æŸ¥ WebSocket é€£æ¥ç‹€æ…‹', async ({ page }) => {
    // å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })
    await page.reload()
    await page.waitForLoadState('networkidle')

    // æª¢æŸ¥ WebSocket é€£æ¥ç‹€æ…‹
    const wsStatus = await page.evaluate(() => {
      const result: {
        exists: boolean;
        isConnected?: boolean;
        hasListeners?: boolean;
        websocketAvailable: boolean;
      } = {
        exists: false,
        websocketAvailable: typeof WebSocket !== 'undefined',
      };

      // æª¢æŸ¥æ˜¯å¦æœ‰ TranscriptManager
      const transcriptManager = (window as any).transcriptManager;
      if (transcriptManager) {
        result.exists = true;
        result.isConnected = transcriptManager.isConnected?.() || false;
        result.hasListeners = transcriptManager.listeners?.size > 0 || false;
      }
      return result;
    });

    console.log('WebSocket ç‹€æ…‹:', wsStatus)

    // é©—è­‰ WebSocket å¯ç”¨æ€§
    expect(wsStatus.websocketAvailable).toBe(true)

    if (wsStatus.exists) {
      console.log('âœ… TranscriptManager å·²æ‰¾åˆ°')
    } else {
      console.log('â„¹ï¸ TranscriptManager å°šæœªåˆå§‹åŒ–ï¼Œé€™å¯èƒ½æ˜¯æ­£å¸¸çš„')
    }
  })

  test('æ‡‰è©²èƒ½å¤ æ¸¬è©¦ç‹€æ…‹ç®¡ç†ç³»çµ±', async ({ page }) => {
    await page.waitForSelector('body', { timeout: 5000 });
    const hasBody = (await page.locator('body').count()) > 0;
    expect(hasBody).toBe(true);

    const appState = await page.evaluate(() => {
      return {
        hasFeatureFlags: !!(window as any).featureFlags,
        hasStateMachine: !!(window as any).stateMachine,
      };
    });

    // å•Ÿç”¨æ–°åŠŸèƒ½
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })
    await page.reload()
    await page.waitForLoadState('networkidle')

    console.log('ğŸ¬ é–‹å§‹æ¨¡æ“¬å®Œæ•´éŒ„éŸ³æµç¨‹...')

    // æ­¥é©Ÿ 1: æª¢æŸ¥åˆå§‹ç‹€æ…‹
    const initialState = await page.evaluate(() => {
      return {
        url: window.location.href,
        title: document.title,
        hasAudio: navigator.mediaDevices !== undefined
      }
    })

    console.log('åˆå§‹ç‹€æ…‹:', initialState)

    // æ­¥é©Ÿ 2: å°‹æ‰¾ä¸¦é»æ“Šé–‹å§‹éŒ„éŸ³çš„æŒ‰éˆ•
    const startButtons = [
      'button:has-text("é–‹å§‹éŒ„éŸ³")',
      'button:has-text("Start Recording")',
      'button:has-text("éŒ„éŸ³")',
      'button:has-text("Record")',
      '[data-testid="start-recording"]',
      '.record-button',
      'button[aria-label*="éŒ„éŸ³"]'
    ]

    let recordingStarted = false

    for (const selector of startButtons) {
      const button = page.locator(selector).first()
      if (await button.count() > 0 && await button.isVisible()) {
        console.log(`æ‰¾åˆ°éŒ„éŸ³æŒ‰éˆ•: ${selector}`)
        await button.click()
        await page.waitForTimeout(1000)
        recordingStarted = true
        break
      }
    }

    if (!recordingStarted) {
      console.log('â„¹ï¸ æœªæ‰¾åˆ°æ˜é¡¯çš„éŒ„éŸ³æŒ‰éˆ•ï¼Œå˜—è©¦å…¶ä»–æ–¹å¼...')

      // å˜—è©¦é€éç‹€æ…‹æ©Ÿç›´æ¥å•Ÿå‹•éŒ„éŸ³
      const stateMachineResult = await page.evaluate(() => {
        const sm = (window as any).stateMachine
        if (sm && sm.canTransition && sm.transition) {
          try {
            if (sm.canTransition('USER_START_RECORDING')) {
              const result = sm.transition('USER_START_RECORDING')
              return { success: true, result }
            }
          } catch (error) {
            return { success: false, error: error instanceof Error ? error.message : String(error) }
          }
        }
        return { success: false, reason: 'StateMachine not available' }
      })

      console.log('ç‹€æ…‹æ©ŸéŒ„éŸ³å˜—è©¦:', stateMachineResult)
    }

    // æ­¥é©Ÿ 3: ç­‰å¾…ä¸¦æª¢æŸ¥éŒ„éŸ³ç‹€æ…‹
    await page.waitForTimeout(2000)

    // æ­¥é©Ÿ 4: æª¢æŸ¥æ˜¯å¦æœ‰é€å­—ç¨¿å€åŸŸ
    const transcriptArea = page.locator('.transcript, [data-testid="transcript"], .transcription').first()

    if (await transcriptArea.count() > 0) {
      console.log('âœ… æ‰¾åˆ°é€å­—ç¨¿å€åŸŸ')
      await expect(transcriptArea).toBeVisible()
    } else {
      console.log('â„¹ï¸ æœªæ‰¾åˆ°æ˜é¡¯çš„é€å­—ç¨¿å€åŸŸ')
    }

    // æ­¥é©Ÿ 5: æ¨¡æ“¬é€å­—ç¨¿æ•¸æ“šï¼ˆå¦‚æœæœ‰ç›¸é—œ APIï¼‰
    const mockTranscriptResult = await page.evaluate(() => {
      // å˜—è©¦æ¨¡æ“¬é€å­—ç¨¿æ•¸æ“š
      const mockTranscript = {
        id: 'test-' + Date.now(),
        text: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦é€å­—ç¨¿',
        timestamp: new Date().toISOString(),
        confidence: 0.95
      }

      // å¦‚æœæœ‰ TranscriptManagerï¼Œå˜—è©¦æ·»åŠ æ¸¬è©¦æ•¸æ“š
      const tm = (window as any).transcriptManager
      if (tm && tm.addTranscript) {
        try {
          tm.addTranscript(mockTranscript)
          return { success: true, transcript: mockTranscript }
        } catch (error) {
          return { success: false, error: error instanceof Error ? error.message : String(error) }
        }
      }

      return { success: false, reason: 'TranscriptManager not available' }
    })

    console.log('æ¨¡æ“¬é€å­—ç¨¿çµæœ:', mockTranscriptResult)

    // æ­¥é©Ÿ 6: æª¢æŸ¥æœ€çµ‚ç‹€æ…‹
    const finalState = await page.evaluate(() => {
      return {
        featureFlags: (window as any).featureFlags?.getAll(),
        stateMachine: (window as any).stateMachine?.getCurrentState?.(),
        transcriptManager: !!(window as any).transcriptManager
      }
    })

    console.log('æœ€çµ‚ç‹€æ…‹:', finalState)

    // é©—è­‰æ¸¬è©¦çµæœ
    expect(finalState.featureFlags).toBeDefined()
    console.log('ğŸ‰ å®Œæ•´éŒ„éŸ³æµç¨‹æ¨¡æ“¬å®Œæˆ')
  })

  test('æ‡‰è©²èƒ½å¤ æ¸¬è©¦åŠŸèƒ½é–‹é—œåˆ‡æ›', async ({ page }) => {
    console.log('ğŸ”„ æ¸¬è©¦åŠŸèƒ½é–‹é—œåˆ‡æ›...')

    // æ¸¬è©¦é—œé–‰ç‹€æ…‹
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.disableAll()
      }
    })

    await page.reload()
    await page.waitForLoadState('networkidle')

    let flagsOff = await page.evaluate(() => {
      return (window as any).featureFlags?.getAll()
    })

    console.log('åŠŸèƒ½é–‹é—œé—œé–‰ç‹€æ…‹:', flagsOff)

    // æ¸¬è©¦é–‹å•Ÿç‹€æ…‹
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.enableAll()
      }
    })

    await page.reload()
    await page.waitForLoadState('networkidle')

    let flagsOn = await page.evaluate(() => {
      return (window as any).featureFlags?.getAll()
    })

    console.log('åŠŸèƒ½é–‹é—œé–‹å•Ÿç‹€æ…‹:', flagsOn)

    // é©—è­‰åˆ‡æ›æˆåŠŸ
    expect(flagsOff?.useNewStateManagement).toBe(false)
    expect(flagsOn?.useNewStateManagement).toBe(true)

    console.log('âœ… åŠŸèƒ½é–‹é—œåˆ‡æ›æ¸¬è©¦å®Œæˆ')
  })
})

test.describe('å›æ­¸æ¸¬è©¦', () => {
  test('æ‡‰è©²ç¢ºä¿ç¾æœ‰åŠŸèƒ½ä¸å—å½±éŸ¿', async ({ page }) => {
    console.log('ğŸ” åŸ·è¡Œå›æ­¸æ¸¬è©¦...')

    // ä½¿ç”¨é è¨­è¨­ç½®ï¼ˆæ–°åŠŸèƒ½é—œé–‰ï¼‰
    await page.evaluate(() => {
      if ((window as any).featureFlags) {
        (window as any).featureFlags.reset()
      }
    })

    await page.reload()
    await page.waitForLoadState('networkidle')
    await page.waitForSelector('body', { timeout: 5000 });
    const hasBody = (await page.locator('body').count()) > 0;
    expect(hasBody).toBe(true);

    const basicFunctions = await page.evaluate(() => {
      return {
        hasTitle: !!document.title,
        hasFeatureFlags: !!(window as any).featureFlags,
        canUseLocalStorage: !!window.localStorage,
        canUseWebSocket: !!window.WebSocket
      };
    });

    console.log('åŸºæœ¬åŠŸèƒ½æª¢æŸ¥:', basicFunctions)

    // é©—è­‰åŸºæœ¬åŠŸèƒ½
    expect(basicFunctions.hasTitle).toBe(true)
    expect(basicFunctions.hasFeatureFlags).toBe(true)
    expect(basicFunctions.canUseLocalStorage).toBe(true)
    expect(basicFunctions.canUseWebSocket).toBe(true)

    console.log('âœ… å›æ­¸æ¸¬è©¦é€šé')
  })
})


# END FILE CONTENTS


# File: frontend/lib/services/transcript-service-adapted.ts

"use client"

import { BaseService } from './base-service'
import { ITranscriptService, TranscriptMessage } from './interfaces'
import { getTranscriptManager, type ITranscriptManager } from '../transcript-manager-adapter'

/**
 * é€å­—ç¨¿æœå‹™è³‡è¨Šä»‹é¢
 */
interface TranscriptServiceInfo {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    connectedSessions: string[]
    activeListeners: Record<string, number>
    totalConnections: number
    transcriptManagerConnections: number
    implementationType: 'refactored' | 'legacy'
}

/**
 * TranscriptService - é©é…å™¨ç‰ˆæœ¬
 *
 * ä½¿ç”¨ TranscriptManager é©é…å™¨ï¼Œæ ¹æ“šåŠŸèƒ½æ——æ¨™è‡ªå‹•é¸æ“‡å¯¦ç¾ï¼š
 * - æ–°çš„é‡æ§‹å¯¦ç¾ï¼ˆtranscript-manager-new.tsï¼‰
 * - èˆŠçš„å¯¦ç¾ï¼ˆtranscript-manager.tsï¼‰
 */
export class TranscriptServiceAdapted extends BaseService implements ITranscriptService {
    protected readonly serviceName = 'TranscriptServiceAdapted'

    private connectedSessions: Set<string> = new Set()
    private sessionListeners: Map<string, Set<(message: TranscriptMessage) => void>> = new Map()
    private transcriptManager: ITranscriptManager | null = null

    /**
     * å–å¾— TranscriptManager å¯¦ä¾‹ï¼ˆæ ¹æ“šåŠŸèƒ½æ——æ¨™å‹•æ…‹é¸æ“‡ï¼‰
     */
    private async getManager(): Promise<ITranscriptManager> {
        if (!this.transcriptManager) {
            this.transcriptManager = await getTranscriptManager()
            this.logInfo(`å·²è¼‰å…¥ TranscriptManager (${this.getCurrentImplementationType()})`)
        }
        return this.transcriptManager
    }

    /**
 * å–å¾—ç•¶å‰å¯¦ç¾é¡å‹
 */
    private getCurrentImplementationType(): 'refactored' | 'legacy' {
        try {
            const { getCurrentImplementation } = require('../transcript-manager-adapter')
            return getCurrentImplementation()
        } catch (error) {
            console.warn('âš ï¸ [TranscriptServiceAdapted] ç„¡æ³•å–å¾—å¯¦ç¾é¡å‹ï¼Œé è¨­ç‚º legacy')
            return 'legacy'
        }
    }

    /**
     * åˆå§‹åŒ–æœå‹™
     */
    async initialize(): Promise<void> {
        this.logInfo('åˆå§‹åŒ–é€å­—ç¨¿æœå‹™ (é©é…å™¨ç‰ˆæœ¬)')

        // é å…ˆè¼‰å…¥ TranscriptManager å¯¦ä¾‹
        await this.getManager()
        this.logSuccess(`TranscriptManager å·²è¼‰å…¥ (${this.getCurrentImplementationType()})`)
    }

    /**
     * æ¸…ç†æœå‹™è³‡æº
     */
    async cleanup(): Promise<void> {
        this.logInfo('æ¸…ç†é€å­—ç¨¿æœå‹™è³‡æº')

        // æ–·é–‹æ‰€æœ‰é€£æ¥
        const sessionIds = Array.from(this.connectedSessions)
        for (const sessionId of sessionIds) {
            await this.disconnect(sessionId)
        }

        this.connectedSessions.clear()
        this.sessionListeners.clear()
        this.transcriptManager = null // é‡ç½®å¯¦ä¾‹
    }

    /**
     * é€£æ¥é€å­—ç¨¿æœå‹™
     */
    async connect(sessionId: string): Promise<void> {
        if (!this.isRunning) {
            throw new Error('TranscriptService å°šæœªå•Ÿå‹•ï¼Œè«‹å…ˆèª¿ç”¨ start()')
        }

        try {
            this.logInfo(`é€£æ¥é€å­—ç¨¿æœå‹™: ${sessionId}`)

            // ä½¿ç”¨é©é…å™¨ç²å– TranscriptManager ä¸¦å»ºç«‹é€£æ¥
            const manager = await this.getManager()
            await manager.connect(sessionId)

            // è¨˜éŒ„é€£æ¥ç‹€æ…‹
            this.connectedSessions.add(sessionId)

            this.logSuccess(`é€å­—ç¨¿æœå‹™é€£æ¥æˆåŠŸ: ${sessionId} (${this.getCurrentImplementationType()})`)
        } catch (error) {
            this.handleError(`é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—: ${sessionId}`, error)
            throw error
        }
    }

    /**
     * æ–·é–‹é€å­—ç¨¿æœå‹™
     */
    async disconnect(sessionId?: string): Promise<void> {
        try {
            const manager = await this.getManager()

            if (sessionId) {
                this.logInfo(`æ–·é–‹é€å­—ç¨¿æœå‹™: ${sessionId}`)

                // ç§»é™¤æ‰€æœ‰ç›£è½å™¨ï¼ˆåƒ…é©ç”¨æ–¼èˆŠå¯¦ç¾ï¼‰
                const listeners = this.sessionListeners.get(sessionId)
                if (listeners && (manager as any).removeListener) {
                    listeners.forEach(callback => {
                        (manager as any).removeListener(sessionId, callback)
                    })
                    this.sessionListeners.delete(sessionId)
                }

                // æ–·é–‹é€£æ¥
                await manager.disconnect(sessionId)
                this.connectedSessions.delete(sessionId)

                this.logSuccess(`é€å­—ç¨¿æœå‹™æ–·é–‹æˆåŠŸ: ${sessionId}`)
            } else {
                // æ–·é–‹æ‰€æœ‰é€£æ¥
                this.logInfo('æ–·é–‹æ‰€æœ‰é€å­—ç¨¿æœå‹™é€£æ¥')
                await manager.disconnectAll()
                this.connectedSessions.clear()
                this.sessionListeners.clear()
            }
        } catch (error) {
            this.handleError(`æ–·é–‹é€å­—ç¨¿æœå‹™å¤±æ•—: ${sessionId || 'all'}`, error)
            throw error
        }
    }

    /**
     * æ·»åŠ é€å­—ç¨¿ç›£è½å™¨
     */
    addTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
        if (!this.isRunning) {
            throw new Error('TranscriptService å°šæœªå•Ÿå‹•ï¼Œè«‹å…ˆèª¿ç”¨ start()')
        }

        this.logInfo(`æ·»åŠ é€å­—ç¨¿ç›£è½å™¨: ${sessionId}`)

        // è¨˜éŒ„ç›£è½å™¨
        if (!this.sessionListeners.has(sessionId)) {
            this.sessionListeners.set(sessionId, new Set())
        }
        this.sessionListeners.get(sessionId)!.add(callback)

        // ç‚ºå…¼å®¹æ€§ï¼Œå˜—è©¦æ·»åŠ ç›£è½å™¨ï¼ˆèˆŠå¯¦ç¾ï¼‰
        this.getManager().then(manager => {
            if ((manager as any).addListener && typeof (manager as any).addListener === 'function') {
                try {
                    (manager as any).addListener(sessionId, callback)
                    this.logInfo(`å·²æ·»åŠ ç›£è½å™¨ (legacy API): ${sessionId}`)
                } catch (error) {
                    this.logWarning('èˆŠå¯¦ç¾ addListener èª¿ç”¨å¤±æ•—:', error)
                }
            } else {
                // æ–°å¯¦ç¾ä½¿ç”¨äº‹ä»¶é©…å‹•ï¼Œä¸éœ€è¦æ‰‹å‹•æ·»åŠ ç›£è½å™¨
                this.logInfo('æ–°å¯¦ç¾ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼ï¼Œç„¡éœ€æ‰‹å‹•æ·»åŠ ç›£è½å™¨')
            }
        }).catch(error => {
            this.logWarning('æ·»åŠ ç›£è½å™¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error)
        })
    }

    /**
     * ç§»é™¤é€å­—ç¨¿ç›£è½å™¨
     */
    removeTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
        this.logInfo(`ç§»é™¤é€å­—ç¨¿ç›£è½å™¨: ${sessionId}`)

        // å¾è¨˜éŒ„ä¸­ç§»é™¤
        const listeners = this.sessionListeners.get(sessionId)
        if (listeners) {
            listeners.delete(callback)
            if (listeners.size === 0) {
                this.sessionListeners.delete(sessionId)
            }
        }

        // åªæœ‰èˆŠå¯¦ç¾æ‰æ”¯æ´ removeListener æ–¹æ³•
        this.getManager().then(manager => {
            if ((manager as any).removeListener) {
                (manager as any).removeListener(sessionId, callback)
            }
        })
    }

    /**
     * æª¢æŸ¥é€£æ¥ç‹€æ…‹
     */
    isConnected(sessionId: string): boolean {
        if (!this.transcriptManager) return false
        return this.transcriptManager.isConnected(sessionId)
    }

    /**
     * æ¸…é™¤é€å­—ç¨¿
     */
    clearTranscripts(sessionId: string): void {
        this.logInfo(`æ¸…é™¤é€å­—ç¨¿: ${sessionId}`)
        // TranscriptManager ä¸å„²å­˜é€å­—ç¨¿æ•¸æ“šï¼Œé€™å€‹æ–¹æ³•ä¸»è¦ç”¨æ–¼è§¸ç™¼ç‹€æ…‹æ¸…é™¤
        // å¯¦éš›çš„æ¸…é™¤é‚è¼¯æ‡‰è©²åœ¨ç‹€æ…‹ç®¡ç†å±¤å¯¦ç¾
    }

    /**
     * å–å¾—æœå‹™ç‹€æ…‹è³‡è¨Š
     */
    getServiceInfo(): TranscriptServiceInfo {
        return {
            serviceName: this.serviceName,
            isInitialized: this.isInitialized,
            isRunning: this.isRunning,
            connectedSessions: Array.from(this.connectedSessions),
            activeListeners: Object.fromEntries(
                Array.from(this.sessionListeners.entries()).map(([sessionId, listeners]) => [
                    sessionId,
                    listeners.size
                ])
            ),
            totalConnections: this.connectedSessions.size,
            transcriptManagerConnections: this.transcriptManager?.getConnectionCount() || 0,
            implementationType: this.getCurrentImplementationType()
        }
    }

    /**
     * å¼·åˆ¶é‡æ–°è¼‰å…¥ TranscriptManagerï¼ˆç”¨æ–¼åŠŸèƒ½æ——æ¨™è®Šæ›´å¾Œï¼‰
     */
    async reloadManager(): Promise<void> {
        this.logInfo('é‡æ–°è¼‰å…¥ TranscriptManager')

        // å…ˆæ–·é–‹æ‰€æœ‰é€£æ¥
        await this.cleanup()

        // é‡æ–°åˆå§‹åŒ–
        await this.initialize()

        this.logSuccess(`TranscriptManager å·²é‡æ–°è¼‰å…¥ (${this.getCurrentImplementationType()})`)
    }
}


# END FILE CONTENTS


# File: frontend/lib/typed-emitter.ts

/* ============================================================
 * è¼•é‡å‹åˆ¥å®‰å…¨ EventEmitterï¼ˆç„¡ Node polyfillï¼‰
 * ============================================================
 */
export type Listener<T> = (payload: T) => void

export class TypedEmitter<Events extends Record<string, any>> {
  private listeners: {
    [K in keyof Events]?: Set<Listener<Events[K]>>
  } = {}

  on<K extends keyof Events>(event: K, listener: Listener<Events[K]>): this {
    (this.listeners[event] ??= new Set()).add(listener)
    return this
  }

  off<K extends keyof Events>(event: K, listener: Listener<Events[K]>): this {
    this.listeners[event]?.delete(listener)
    return this
  }

  emit<K extends keyof Events>(event: K, payload: Events[K]): boolean {
    this.listeners[event]?.forEach((l) => l(payload))
    return !!this.listeners[event]?.size
  }

  removeAllListeners<K extends keyof Events>(event?: K): this {
    if (event) this.listeners[event]?.clear()
    else Object.values(this.listeners).forEach((s) => s?.clear())
    return this
  }
}

# END FILE CONTENTS


# File: .dockerignore

frontend/
.git/
node_modules/
__pycache__/
*.log
*.md
.venv
.serena
.cursor
.vscode


# END FILE CONTENTS


# File: app/core/container.py

"""
ä¸€å€‹ç°¡å–®çš„ä¾è³´æ³¨å…¥å®¹å™¨
"""
from typing import Dict, Any, Type, Callable

class Container:
    def __init__(self):
        self._providers: Dict[Type, Callable[[], Any]] = {}

    def register(self, type_hint: Type, provider: Callable[[], Any]):
        """è¨»å†Šä¸€å€‹æœå‹™æä¾›è€…"""
        self._providers[type_hint] = provider

    def resolve(self, type_hint: Type) -> Any:
        """è§£æä¸€å€‹æœå‹™å¯¦ä¾‹"""
        provider = self._providers.get(type_hint)
        if not provider:
            raise Exception(f"No provider registered for {type_hint}")
        return provider()

# å…¨åŸŸå®¹å™¨å¯¦ä¾‹
container = Container()


# END FILE CONTENTS


# File: frontend/components/ui/collapsible.tsx

"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }


# END FILE CONTENTS


# File: frontend/types/state-transitions.ts

import { AppState, SessionStatus, SessionType } from "./app-state"

// ç‹€æ…‹è½‰æ›è§¸ç™¼å™¨é¡å‹
export type StateTransitionTrigger =
  | "USER_START_RECORDING"          // ç”¨æˆ¶é–‹å§‹éŒ„éŸ³
  | "USER_STOP_RECORDING"           // ç”¨æˆ¶åœæ­¢éŒ„éŸ³
  | "FIRST_TRANSCRIPT_RECEIVED"     // æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿
  | "SESSION_CREATED"               // Session å»ºç«‹å®Œæˆ
  | "SESSION_UPGRADED"              // Session å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼
  | "PROCESSING_STARTED"            // é–‹å§‹è™•ç†å‰©é¤˜é€å­—ç¨¿
  | "PROCESSING_COMPLETED"          // è™•ç†å®Œæˆ
  | "ERROR_OCCURRED"                // ç™¼ç”ŸéŒ¯èª¤
  | "USER_NEW_NOTE"                 // ç”¨æˆ¶é–‹æ–°ç­†è¨˜
  | "TRANSCRIPT_COMPLETED"          // è½‰éŒ„å®Œå…¨å®Œæˆ

// ç‹€æ…‹è½‰æ›æ¢ä»¶
export interface StateTransitionCondition {
  currentState: AppState
  targetState: AppState
  trigger: StateTransitionTrigger

  // é¡å¤–æ¢ä»¶æª¢æŸ¥
  sessionExists?: boolean
  sessionStatus?: SessionStatus
  sessionType?: SessionType
  isRecording?: boolean
  hasTranscripts?: boolean

  // è‡ªå®šç¾©é©—è­‰å‡½æ•¸
  customValidator?: (context: StateTransitionContext) => boolean
}

// ç‹€æ…‹è½‰æ›ä¸Šä¸‹æ–‡
export interface StateTransitionContext {
  currentState: AppState
  isRecording: boolean
  transcriptCount: number
  session: {
    id: string
    status: SessionStatus
    type: SessionType
  } | null
  error: string | null
  pendingSessionTitle?: string  // å¾…å»ºç«‹æœƒè©±çš„æ¨™é¡Œ
}

// ç‹€æ…‹è½‰æ›çµæœ
export interface StateTransitionResult {
  success: boolean
  newState: AppState
  error?: string
  sideEffects?: StateTransitionSideEffect[]
}

// å‰¯ä½œç”¨é¡å‹
export type StateTransitionSideEffect =
  | { type: "CREATE_SESSION"; sessionType: SessionType; title?: string }
  | { type: "UPGRADE_SESSION" }
  | { type: "FINISH_SESSION" }
  | { type: "START_RECORDING" }
  | { type: "STOP_RECORDING" }
  | { type: "CONNECT_WEBSOCKET" }
  | { type: "DISCONNECT_WEBSOCKET" }
  | { type: "CLEAR_TRANSCRIPTS" }
  | { type: "SAVE_DRAFT" }
  | { type: "SHOW_ERROR"; message: string }

// ç‹€æ…‹è½‰æ›è¦å‰‡å®šç¾©
export const STATE_TRANSITION_RULES: StateTransitionCondition[] = [
  // å¾ default ç‹€æ…‹é–‹å§‹éŒ„éŸ³
  {
    currentState: "default",
    targetState: "recording_waiting",
    trigger: "USER_START_RECORDING",
    customValidator: (context) => {
      // ç¢ºä¿æ²’æœ‰å…¶ä»–æ´»èºçš„éŒ„éŸ³ session
      return !context.session || context.session.status === "completed" || context.session.status === "error"
    }
  },

  // å¾ recording_waiting é‡æ–°é–‹å§‹éŒ„éŸ³ï¼ˆè™•ç†é‡è©¦æƒ…æ³ï¼‰
  {
    currentState: "recording_waiting",
    targetState: "recording_waiting",
    trigger: "USER_START_RECORDING",
    customValidator: (context) => {
      // å…è¨±åœ¨æ²’æœ‰ session æˆ– session ç‹€æ…‹ç•°å¸¸æ™‚é‡æ–°é–‹å§‹
      return !context.session || context.session.status === "completed" || context.session.status === "error"
    }
  },

  // Session å»ºç«‹å®Œæˆå¾Œä¿æŒåœ¨ default ç‹€æ…‹
  {
    currentState: "default",
    targetState: "default",
    trigger: "SESSION_CREATED",
    sessionExists: true,
    sessionStatus: "draft"
  },

  // ä¿®å¾©ï¼šå¾ recording_waiting ç‹€æ…‹è™•ç† SESSION_CREATEDï¼Œä¿æŒåœ¨ recording_waiting ç­‰å¾… WebSocket é€£æ¥
  {
    currentState: "recording_waiting",
    targetState: "recording_waiting",
    trigger: "SESSION_CREATED",
    sessionExists: true,
    sessionStatus: "active",
    sessionType: "recording"
  },

  // å¾ recording_waiting æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿è½‰ç‚º recording_active
  {
    currentState: "recording_waiting",
    targetState: "recording_active",
    trigger: "FIRST_TRANSCRIPT_RECEIVED",
    sessionExists: true,
    sessionStatus: "active",
    sessionType: "recording",
    isRecording: true,
    hasTranscripts: true
  },

  // å¾ recording_waiting æˆ– recording_active åœæ­¢éŒ„éŸ³è½‰ç‚º processing
  {
    currentState: "recording_waiting",
    targetState: "processing",
    trigger: "USER_STOP_RECORDING",
    sessionExists: true,
    sessionType: "recording"
  },
  {
    currentState: "recording_active",
    targetState: "processing",
    trigger: "USER_STOP_RECORDING",
    sessionExists: true,
    sessionType: "recording"
  },

  // å¾ processing å®Œæˆè½‰éŒ„è½‰ç‚º finished
  {
    currentState: "processing",
    targetState: "finished",
    trigger: "PROCESSING_COMPLETED",
    sessionExists: true,
    sessionStatus: "completed"
  },

  // ä¿®å¾©ï¼šå¾ä»»ä½•ç‹€æ…‹ç™¼ç”ŸéŒ¯èª¤å›åˆ° default
  {
    currentState: "recording_waiting",
    targetState: "default",
    trigger: "ERROR_OCCURRED"
  },
  {
    currentState: "recording_active",
    targetState: "default",
    trigger: "ERROR_OCCURRED"
  },
  {
    currentState: "processing",
    targetState: "default",
    trigger: "ERROR_OCCURRED"
  },

  // å¾ finished æˆ–ä»»ä½•ç‹€æ…‹é–‹æ–°ç­†è¨˜å›åˆ° default
  {
    currentState: "finished",
    targetState: "default",
    trigger: "USER_NEW_NOTE"
  },
  {
    currentState: "recording_waiting",
    targetState: "default",
    trigger: "USER_NEW_NOTE"
  },
  {
    currentState: "recording_active",
    targetState: "default",
    trigger: "USER_NEW_NOTE"
  }
]

// ç‹€æ…‹è½‰æ›å‰¯ä½œç”¨æ˜ å°„
export const STATE_TRANSITION_SIDE_EFFECTS: Record<string, StateTransitionSideEffect[]> = {
  // default -> recording_waiting: å»ºç«‹æœƒè©±ã€é–‹å§‹éŒ„éŸ³ä¸¦é€£æ¥ WebSocket
  "default->recording_waiting->USER_START_RECORDING": [
    { type: "CREATE_SESSION", sessionType: "recording" },
    { type: "START_RECORDING" },
    { type: "CONNECT_WEBSOCKET" }
  ],

  // recording_waiting -> recording_waiting: é‡æ–°é–‹å§‹éŒ„éŸ³ï¼ˆé‡è©¦æƒ…æ³ï¼‰
  "recording_waiting->recording_waiting->USER_START_RECORDING": [
    { type: "CREATE_SESSION", sessionType: "recording" },
    { type: "START_RECORDING" },
    { type: "CONNECT_WEBSOCKET" }
  ],

  // recording_waiting/recording_active -> processing: åœæ­¢éŒ„éŸ³
  "recording_waiting->processing->USER_STOP_RECORDING": [
    { type: "STOP_RECORDING" }
  ],
  "recording_active->processing->USER_STOP_RECORDING": [
    { type: "STOP_RECORDING" }
  ],

  // processing -> finished: å®Œæˆ session
  "processing->finished->PROCESSING_COMPLETED": [
    { type: "FINISH_SESSION" }
  ],

  // ä»»ä½•ç‹€æ…‹ -> default (æ–°ç­†è¨˜): æ¸…ç†ç‹€æ…‹
  "finished->default->USER_NEW_NOTE": [
    { type: "CLEAR_TRANSCRIPTS" },
    { type: "SAVE_DRAFT" }
  ],
  "recording_waiting->default->USER_NEW_NOTE": [
    { type: "STOP_RECORDING" },
    { type: "DISCONNECT_WEBSOCKET" },
    { type: "CLEAR_TRANSCRIPTS" }
  ],
  "recording_active->default->USER_NEW_NOTE": [
    { type: "STOP_RECORDING" },
    { type: "DISCONNECT_WEBSOCKET" },
    { type: "CLEAR_TRANSCRIPTS" }
  ],

  // éŒ¯èª¤è™•ç†
  "recording_waiting->default->ERROR_OCCURRED": [
    { type: "STOP_RECORDING" },
    { type: "DISCONNECT_WEBSOCKET" },
    { type: "SHOW_ERROR", message: "éŒ„éŸ³éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤" }
  ],
  "recording_active->default->ERROR_OCCURRED": [
    { type: "STOP_RECORDING" },
    { type: "DISCONNECT_WEBSOCKET" },
    { type: "SHOW_ERROR", message: "éŒ„éŸ³éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤" }
  ],
  "processing->default->ERROR_OCCURRED": [
    { type: "SHOW_ERROR", message: "è™•ç†è½‰éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤" }
  ]
}


# END FILE CONTENTS


# File: frontend/components/theme-provider.tsx

'use client'

import * as React from 'react'
import {
  ThemeProvider as NextThemesProvider,
  type ThemeProviderProps,
} from 'next-themes'

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}


# END FILE CONTENTS


# File: frontend/components/ui/textarea.tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<"textarea">
>(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Textarea.displayName = "Textarea"

export { Textarea }


# END FILE CONTENTS


# File: docs/export-spec.md

# åŒ¯å‡ºåŠŸèƒ½ API è¦æ ¼ï¼ˆExport API Specï¼‰

## 1. API è·¯å¾‘

- `GET /api/export/{sid}?type=zip`
  - ä¸‹è¼‰æŒ‡å®š session çš„ç­†è¨˜èˆ‡é€å­—ç¨¿ï¼Œæ‰“åŒ…ç‚º zip æª”æ¡ˆ

## 2. è«‹æ±‚åƒæ•¸

- `sid` (path)ï¼šSession UUID
- `type` (query)ï¼šæª”æ¡ˆæ ¼å¼ï¼Œç›®å‰åƒ…æ”¯æ´ `zip`ï¼Œé ç•™ `csv`ã€`pdf` æ“´å……

## 3. å›æ‡‰æ ¼å¼

- æˆåŠŸï¼š
  - HTTP 200
  - Content-Type: `application/zip`
  - Content-Disposition: `attachment; filename="{sid}.zip"`
  - ZIP å…§å®¹ï¼š
    - `note.md`ï¼šMarkdown ç­†è¨˜å…§å®¹
    - `transcript.txt`ï¼šé€å­—ç¨¿ï¼ˆå¦‚æœ‰ï¼‰
    - ï¼ˆæœªä¾†å¯æ“´å……ï¼šéŸ³æª”ç­‰ï¼‰
- å¤±æ•—ï¼š
  - 400ï¼štype ä¸æ”¯æ´
  - 404ï¼šsession æˆ– note ä¸å­˜åœ¨
  - 409ï¼šsession å°šæœªå®Œæˆ

## 4. æµç¨‹èªªæ˜

1. å‰ç«¯å‘¼å« `/api/export/{sid}?type=zip`
2. å¾Œç«¯æª¢æŸ¥ session ç‹€æ…‹èˆ‡è³‡æ–™å­˜åœ¨æ€§
3. ç”¢ç”Ÿ zip ä¸¦ä»¥ StreamingResponse å›å‚³
4. å‰ç«¯æ”¶åˆ° zipï¼Œè§¸ç™¼ä¸‹è¼‰

## 5. æœªä¾†æ“´å……å»ºè­°

- æ”¯æ´å¤§æª”æ¡ˆæ™‚ï¼Œå¾Œç«¯å¯æ”¹ç”¨ zipstream-ng æµå¼å£“ç¸®
- type å¯æ“´å…… csvã€pdf ç­‰æ ¼å¼
- zip å…§å®¹å¯åŠ å…¥éŸ³æª”ã€åœ–ç‰‡ç­‰
- å»ºè­°æ‰€æœ‰ä¾è³´å¯«å…¥ pyproject.toml 


# END FILE CONTENTS


# File: frontend/hooks/use-session-adapter.ts

"use client"

import { useSession as useSessionLegacy } from './use-session'
import { useSessionNew } from './use-session-new'
import { isFeatureEnabled } from '../lib/feature-flags'
import { SessionResponse } from '../lib/api'

// çµ±ä¸€çš„ UseSession ä»‹é¢
interface UseSessionReturn {
    currentSession: SessionResponse | null
    isLoading: boolean
    error: string | null
    createNoteSession: (title: string, content?: string) => Promise<SessionResponse | null>
    createRecordingSession: (title: string, content?: string) => Promise<SessionResponse | null>
    upgradeToRecording: () => Promise<SessionResponse | null>
    finishSession: () => Promise<void>
    deleteSession: () => Promise<void>
    clearSession: () => void
    checkActiveSession: () => Promise<SessionResponse | null>
}

/**
 * useSession é©é…å™¨ Hook
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨æ–°èˆŠç‰ˆæœ¬çš„ useSession
 * ç¢ºä¿ API å®Œå…¨ç›¸å®¹ï¼Œç¾æœ‰çµ„ä»¶ç„¡éœ€ä¿®æ”¹
 */
export function useSession(): UseSessionReturn {
    const useNewSessionHook = isFeatureEnabled('useNewSessionHook')
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')

    console.log('ğŸ”„ [useSessionAdapter] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewSessionHook,
        useNewStateManagement,
        willUseNewVersion: useNewSessionHook || useNewStateManagement
    })

    // å¦‚æœå•Ÿç”¨æ–° Session Hook æˆ–æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬
    if (useNewSessionHook || useNewStateManagement) {
        console.log('ğŸ”„ [useSessionAdapter] ä½¿ç”¨æ–°ç‰ˆæœ¬ useSessionNew')
        return useSessionNew()
    }

    // å¦å‰‡ä½¿ç”¨èˆŠç‰ˆæœ¬
    console.log('ğŸ”„ [useSessionAdapter] ä½¿ç”¨èˆŠç‰ˆæœ¬ useSession')
    return useSessionLegacy()
}

// å°å‡ºèˆŠç‰ˆæœ¬ä¾›ç›´æ¥ä½¿ç”¨ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ç‰¹æ®Šæƒ…æ³ï¼‰
export { useSession as useSessionLegacy } from './use-session'
export { useSessionNew } from './use-session-new'


# END FILE CONTENTS


# File: frontend/components/ui/alert.tsx

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }


# END FILE CONTENTS


# File: frontend/components/ui/switch.tsx

"use client"

import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }


# END FILE CONTENTS


# File: frontend/components/recording-active-state.tsx

"use client"

import { useEffect, useRef, useState, useCallback } from "react"
import { ScrollArea } from "@/components/ui/scroll-area"
import { Button } from "@/components/ui/button"
import { Square, Clock } from "lucide-react"
import type { TranscriptEntry } from "../types/app-state"

interface RecordingActiveStateProps {
    transcriptEntries: TranscriptEntry[]
    recordingTime: number
    onStopRecording: () => void
}

// æ ¼å¼åŒ–éŒ„éŸ³æ™‚é–“ç‚º HH:MM:SS æ ¼å¼
function formatRecordingTime(seconds: number): string {
    const hours = Math.floor(seconds / 3600)
    const minutes = Math.floor((seconds % 3600) / 60)
    const secs = seconds % 60

    if (hours > 0) {
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
    }
    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
}

export function RecordingActiveState({ transcriptEntries, recordingTime, onStopRecording }: RecordingActiveStateProps) {
    const scrollAreaRef = useRef<HTMLDivElement>(null)
    const [isAutoScrollLocked, setIsAutoScrollLocked] = useState(true)
    const [userScrollTimeout, setUserScrollTimeout] = useState<NodeJS.Timeout | null>(null)

    // è‡ªå‹•æ²å‹•åˆ°åº•éƒ¨
    const autoScroll = useCallback(() => {
        if (isAutoScrollLocked && scrollAreaRef.current) {
            const scrollContainer = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]')
            if (scrollContainer) {
                scrollContainer.scrollTop = scrollContainer.scrollHeight
            }
        }
    }, [isAutoScrollLocked])

    // æª¢æ¸¬ä½¿ç”¨è€…æ²å‹•è¡Œç‚º
    const unlockOnScroll = useCallback(
        (event: Event) => {
            const target = event.target as HTMLElement
            if (target) {
                const { scrollTop, scrollHeight, clientHeight } = target
                const isAtBottom = Math.abs(scrollHeight - clientHeight - scrollTop) < 10

                if (!isAtBottom && isAutoScrollLocked) {
                    setIsAutoScrollLocked(false)
                } else if (isAtBottom && !isAutoScrollLocked) {
                    setIsAutoScrollLocked(true)
                }

                if (userScrollTimeout) clearTimeout(userScrollTimeout)

                const timeout = setTimeout(() => {
                    if (!isAutoScrollLocked) setIsAutoScrollLocked(true)
                }, 3000)

                setUserScrollTimeout(timeout)
            }
        },
        [isAutoScrollLocked, userScrollTimeout]
    )

    // æ‰‹å‹•åˆ‡æ›è‡ªå‹•æ²å‹•é–å®šç‹€æ…‹ï¼ˆä¿æŒåŠŸèƒ½ä½†ä¸é¡¯ç¤ºæŒ‰éˆ•ï¼‰
    const toggleAutoScrollLock = useCallback(() => setIsAutoScrollLocked(prev => !prev), [])

    // ç¦ç”¨åˆä½µæ®µè½é‚è¼¯ - ç”¨æˆ¶è¦æ±‚ä¸€å¥è©±ä¸€å€‹æ™‚é–“æˆ³
    const mergeSegments = useCallback((entries: TranscriptEntry[]): TranscriptEntry[] => {
        // ç›´æ¥è¿”å›åŸå§‹æ¢ç›®ï¼Œä¸é€²è¡Œä»»ä½•åˆä½µ
        return entries
    }, [])

    // è‡ªå‹•æ²å‹•
    useEffect(() => {
        autoScroll()
    }, [transcriptEntries, autoScroll])

    // ç›£è½æ²å‹•
    useEffect(() => {
        const scrollContainer = scrollAreaRef.current?.querySelector('[data-radix-scroll-area-viewport]')
        if (scrollContainer) {
            scrollContainer.addEventListener("scroll", unlockOnScroll)
            return () => scrollContainer.removeEventListener("scroll", unlockOnScroll)
        }
    }, [unlockOnScroll])

    // æ¸…ç†è¨ˆæ™‚å™¨
    useEffect(() => {
        return () => {
            if (userScrollTimeout) {
                clearTimeout(userScrollTimeout)
            }
        }
    }, [userScrollTimeout])

    const mergedEntries = mergeSegments(transcriptEntries)

    return (
        <div className="h-full flex flex-col">
            <ScrollArea className="flex-1" ref={scrollAreaRef}>
                <div className="p-6 space-y-4">
                    {mergedEntries.map((entry, index) => (
                        <div key={index} className="flex gap-4 text-sm">
                            <span className="text-muted-foreground font-mono text-xs mt-1 min-w-[40px] flex-shrink-0">
                                {entry.time}
                            </span>
                            <span className="text-foreground leading-relaxed flex-1">{entry.text}</span>
                        </div>
                    ))}
                </div>
            </ScrollArea>

            <div className="p-4 border-t border-border flex justify-between items-center">
                <div className="flex items-center gap-2 text-muted-foreground">
                    <Clock className="w-4 h-4" />
                    <span className="font-mono text-sm">
                        {formatRecordingTime(recordingTime)}
                    </span>
                </div>

                <Button onClick={onStopRecording} variant="destructive" size="sm" className="flex items-center gap-2">
                    <Square className="w-4 h-4" />
                    Stop
                </Button>
            </div>
        </div>
    )
}


# END FILE CONTENTS


# File: app/services/__init__.py



# END FILE CONTENTS


# File: frontend/types/websocket-messages.ts

/* ============================================================
 * å‹åˆ¥å®‰å…¨ï¼šæ‰€æœ‰ WS è¨Šæ¯çš„ Discriminated Union
 * ============================================================
 */

/** å…±ç”¨æ¬„ä½ï¼ˆå¯è¦–éœ€æ±‚å¢åˆªï¼‰ */
interface BaseMessage {
    /** ä¾†æºä¼ºæœå™¨æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰ */
    timestamp: number
}

/** é€å­—ç¨¿ç‰‡æ®µ */
export interface TranscriptSegmentMessage extends BaseMessage {
    type: 'transcript_segment'
    text: string
    start_time: number
    end_time: number
    confidence: number
}

/** é€£ç·šå»ºç«‹æˆåŠŸ */
export interface ConnectionEstablishedMessage extends BaseMessage {
    type: 'connection_established'
    message: string
}

/** æ•´æ®µé€å­—ç¨¿å®Œæˆ */
export interface TranscriptCompleteMessage extends BaseMessage {
    type: 'transcript_complete'
    message: string
}

/** å¿ƒè·³å›è¦† */
export interface HeartbeatAckMessage extends BaseMessage {
    type: 'heartbeat_ack'
}

/** Pong å›è¦† */
export interface PongMessage extends BaseMessage {
    type: 'pong'
}

/** ä¸€èˆ¬éŒ¯èª¤ */
export interface ErrorMessage extends BaseMessage {
    type: 'error'
    error_type: string
    error_message: string
    details?: unknown
}

/** è½‰éŒ„æœå‹™éŒ¯èª¤ */
export interface TranscriptionErrorMessage extends BaseMessage {
    type: 'transcription_error'
    error_type: string
    error_message: string
}

/** å¾Œç«¯ç‹€æ…‹åˆ‡æ›ï¼ˆç„¡ type æ¬„ä½ï¼Œå¦æ‹†ï¼‰ */
export interface PhaseMessage {
    phase: 'waiting' | 'active'
}

/** â†’ æœ€çµ‚ Union */
export type WSMessage =
    | TranscriptSegmentMessage
    | ConnectionEstablishedMessage
    | TranscriptCompleteMessage
    | HeartbeatAckMessage
    | PongMessage
    | ErrorMessage
    | TranscriptionErrorMessage
    | PhaseMessage


# END FILE CONTENTS


# File: app/api/sessions.py

"""
StudyScriber Session ç®¡ç† API ç«¯é»

ä½¿ç”¨ Supabase Client å¯¦ä½œæœƒè©±å»ºç«‹ã€å®Œæˆå’Œå‡ç´šåŠŸèƒ½
"""

from uuid import UUID
from typing import Dict, Any
from datetime import datetime
from fastapi import APIRouter, Depends, HTTPException, status
from supabase import Client
from app.core.config import get_settings

from app.db.database import get_supabase_client
from app.schemas.session import (
    SessionCreateRequest, SessionOut, SessionUpgradeRequest,
    SessionFinishRequest, SessionStatusResponse, SessionStatus, SessionType, LanguageCode,
    SessionProviderUpdateRequest
)

# å»ºç«‹è·¯ç”±å™¨
router = APIRouter(prefix="/api", tags=["æœƒè©±ç®¡ç†"])


@router.post("/session", response_model=SessionOut, status_code=status.HTTP_201_CREATED)
async def create_session(
    request: SessionCreateRequest,
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    å»ºç«‹æ–°æœƒè©± (B-001)

    - æ”¯æ´å…©ç¨®æ¨¡å¼ï¼šç´”ç­†è¨˜ (note_only) æˆ–éŒ„éŸ³æ¨¡å¼ (recording)
    - ç¢ºä¿åŒæ™‚åªæœ‰ä¸€å€‹æ´»èºæœƒè©±
    - è‡ªå‹•å»ºç«‹å°æ‡‰çš„ç©ºç™½ç­†è¨˜è¨˜éŒ„
    - æ”¯æ´ç²¾ç¢ºçš„éŒ„éŸ³é–‹å§‹æ™‚é–“æˆ³
    """
    try:
        # æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ´»èºæœƒè©±
        active_session_response = supabase.table("sessions").select("id").eq("status", "active").limit(1).execute()
        if active_session_response.data:
            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail="å·²æœ‰ä¸€å€‹æ´»èºçš„æœƒè©±ï¼Œç„¡æ³•å»ºç«‹æ–°æœƒè©±ã€‚"
            )

        session_data = {
            "title": request.title,
            "type": request.type.value,
            "language": request.language.value,
            "status": SessionStatus.ACTIVE.value,
            "stt_provider": request.stt_provider or get_settings().STT_PROVIDER_DEFAULT
        }

        # å¦‚æœæœ‰æä¾› start_tsï¼Œè½‰æ›ç‚º PostgreSQL æ™‚é–“æˆ³æ ¼å¼
        if request.start_ts is not None:
            started_at = datetime.fromtimestamp(request.start_ts / 1000).isoformat()
            session_data["started_at"] = started_at
            print(f"ğŸ• [SessionAPI] è¨­å®šéŒ„éŸ³é–‹å§‹æ™‚é–“: {started_at} (åŸå§‹æ™‚é–“æˆ³: {request.start_ts})")

        # è‹¥ç‚ºéŒ„éŸ³æ¨¡å¼ä¸”ä»æœªè¨­å®š started_atï¼Œå‰‡é è¨­ç‚ºç›®å‰æ™‚é–“ (UTC)
        if request.type == SessionType.RECORDING and "started_at" not in session_data:
            session_data["started_at"] = datetime.utcnow().isoformat()

        response = supabase.table("sessions").insert(session_data, returning="representation").execute()

        if not response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•å»ºç«‹æœƒè©±")

        new_session = response.data[0]
        session_id = new_session['id']

        note_data = {"session_id": session_id, "content": request.content or ""}
        supabase.table("notes").insert(note_data).execute()

        return SessionOut.model_validate(new_session)

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=500,
            detail={"error": "internal_error", "message": f"å»ºç«‹æœƒè©±æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.patch("/session/{session_id}/finish", response_model=SessionStatusResponse)
async def finish_session(
    session_id: UUID,
    supabase: Client = Depends(get_supabase_client)
) -> SessionStatusResponse:
    """
    å®Œæˆæœƒè©± (B-002)

    - å°‡æ´»èºæœƒè©±æ¨™è¨˜ç‚ºå®Œæˆ
    - è¨­å®šå®Œæˆæ™‚é–“
    - é‡‹æ”¾æœƒè©±é–å®šï¼Œå…è¨±å»ºç«‹æ–°æœƒè©±
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨ä¸”æ´»èº
        session_response = supabase.table("sessions").select("*").eq("id", str(session_id)).eq("status", "active").limit(1).execute()
        if not session_response.data:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="æ‰¾ä¸åˆ°æ´»èºçš„æœƒè©±æˆ–æœƒè©±å·²è¢«å®Œæˆã€‚"
            )

        # æº–å‚™æ›´æ–°æ•¸æ“š
        update_data = {
            "status": SessionStatus.COMPLETED.value,
            "completed_at": datetime.utcnow().isoformat()
        }

        # æ›´æ–°æœƒè©±ç‹€æ…‹
        response = supabase.table("sessions").update(update_data).eq("id", str(session_id)).execute()

        if not response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•æ›´æ–°æœƒè©±ç‹€æ…‹")

        updated_session = response.data[0]

        return SessionStatusResponse(
            success=True,
            message=f"æœƒè©± '{updated_session.get('title') or session_id}' å·²æˆåŠŸå®Œæˆ",
            session=SessionOut.model_validate(updated_session)
        )

    except HTTPException:
        # é‡æ–°æ‹‹å‡ºå·²è™•ç†çš„ HTTP ç•°å¸¸
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"å®Œæˆæœƒè©±æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.delete("/session/{session_id}", response_model=SessionStatusResponse)
async def delete_session(
    session_id: UUID,
    supabase: Client = Depends(get_supabase_client)
) -> SessionStatusResponse:
    """
    åˆªé™¤æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“š (B-020)

    - åˆªé™¤æŒ‡å®šçš„æœƒè©±åŠå…¶æ‰€æœ‰é—œè¯æ•¸æ“šï¼ˆç­†è¨˜ã€éŸ³æª”ã€é€å­—ç¨¿ç­‰ï¼‰
    - ç”±æ–¼è³‡æ–™åº«æœ‰ CASCADE DELETE ç´„æŸï¼Œæœƒè‡ªå‹•æ¸…ç†æ‰€æœ‰ç›¸é—œè¡¨æ ¼çš„æ•¸æ“š
    - æ­¤æ“ä½œä¸å¯é€†ï¼Œè«‹è¬¹æ…ä½¿ç”¨
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨
        session_response = supabase.table("sessions").select("*").eq("id", str(session_id)).limit(1).execute()
        if not session_response.data:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="æ‰¾ä¸åˆ°æŒ‡å®šçš„æœƒè©±ã€‚"
            )

        session_data = session_response.data[0]
        session_title = session_data.get('title', 'æœªå‘½åç­†è¨˜')

        # åˆªé™¤æœƒè©±ï¼ˆæœƒè‡ªå‹•ç´šè¯åˆªé™¤æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼‰
        delete_response = supabase.table("sessions").delete().eq("id", str(session_id)).execute()

        if not delete_response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•åˆªé™¤æœƒè©±")

        return SessionStatusResponse(
            success=True,
            message=f"æœƒè©± '{session_title}' ({session_id}) åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šå·²æˆåŠŸåˆªé™¤",
            session=None
        )

    except HTTPException:
        # é‡æ–°æ‹‹å‡ºå·²è™•ç†çš„ HTTP ç•°å¸¸
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"åˆªé™¤æœƒè©±æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.patch("/session/{session_id}/upgrade", response_model=SessionOut)
async def upgrade_session_to_recording(
    session_id: UUID,
    request: SessionUpgradeRequest,
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼ (B-015)

    - å°‡ç´”ç­†è¨˜æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼
    - åªæœ‰ active ç‹€æ…‹çš„ note_only æœƒè©±å¯ä»¥å‡ç´š
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å¯ä»¥å‡ç´š
        session_response = supabase.table("sessions").select("*").eq("id", str(session_id)).eq("status", "active").eq("type", "note_only").limit(1).execute()
        if not session_response.data:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="åªæœ‰æ´»èºçš„ç´”ç­†è¨˜æœƒè©±æ‰èƒ½å‡ç´šã€‚"
            )

        # æº–å‚™æ›´æ–°æ•¸æ“š
        update_data = {
            "type": SessionType.RECORDING.value,
            "language": request.language.value,
            "started_at": datetime.utcnow().isoformat(),
        }

        # åŸ·è¡Œå‡ç´š
        response = supabase.table("sessions").update(update_data).eq("id", str(session_id)).execute()

        if not response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•å‡ç´šæœƒè©±")

        updated_session = response.data[0]

        return SessionOut.model_validate(updated_session)

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"å‡ç´šæœƒè©±æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.get("/session/active", response_model=SessionOut, status_code=status.HTTP_200_OK)
async def get_active_session(
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    å–å¾—ç›®å‰æ´»èºçš„æœƒè©±

    - ç”¨æ–¼å‰ç«¯æª¢æŸ¥æ˜¯å¦æœ‰é€²è¡Œä¸­çš„æœƒè©±
    - å¦‚æœæ²’æœ‰æ´»èºæœƒè©±å‰‡è¿”å› 404
    """
    response = supabase.table("sessions").select("*").eq("status", "active").limit(1).execute()
    if not response.data:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail={"error": "no_active_session", "message": "ç›®å‰æ²’æœ‰æ´»èºçš„æœƒè©±"}
        )

    return SessionOut.model_validate(response.data[0])


@router.get("/session/{session_id}", response_model=SessionOut)
async def get_session(
    session_id: UUID,
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    å–å¾—æŒ‡å®šæœƒè©±çš„è©³ç´°è³‡è¨Š

    - ç”¨æ–¼æª¢è¦–æœƒè©±ç‹€æ…‹å’Œè³‡è¨Š
    """
    response = supabase.table("sessions").select("*").eq("id", str(session_id)).limit(1).execute()

    if not response.data:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail={"error": "session_not_found", "message": "æ‰¾ä¸åˆ°æŒ‡å®šçš„æœƒè©±"}
        )

    return SessionOut.model_validate(response.data[0])


@router.patch("/session/{session_id}/provider", response_model=SessionOut)
async def update_session_provider(
    session_id: UUID,
    request: SessionProviderUpdateRequest,
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    æ›´æ–°æœƒè©± STT Provider (B-016)

    - åƒ…åœ¨å°šæœªä¸Šå‚³éŸ³æª”æ™‚å…è¨±åˆ‡æ›
    - æ”¯æ´ whisper å’Œ gemini ä¹‹é–“çš„åˆ‡æ›
    - é©—è­‰ Provider çš„æœ‰æ•ˆæ€§
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨ä¸”ç‚ºæ´»èºç‹€æ…‹
        session_response = supabase.table("sessions").select("*").eq("id", str(session_id)).eq("status", "active").limit(1).execute()
        if not session_response.data:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="æ‰¾ä¸åˆ°æ´»èºçš„æœƒè©±ã€‚"
            )

        # æª¢æŸ¥æ˜¯å¦å·²æœ‰éŸ³æª”ä¸Šå‚³ï¼ˆé€é audio_files è¡¨ï¼‰
        audio_files_response = supabase.table("audio_files").select("id").eq("session_id", str(session_id)).limit(1).execute()
        if audio_files_response.data:
            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail="å·²é–‹å§‹éŒ„éŸ³ï¼Œç„¡æ³•æ›´æ”¹ STT Providerã€‚"
            )

        # é©—è­‰ Provider æœ‰æ•ˆæ€§
        valid_providers = ["whisper", "gemini"]
        if request.stt_provider not in valid_providers:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=f"ç„¡æ•ˆçš„ STT Providerã€‚æ”¯æ´çš„é¸é …ï¼š{', '.join(valid_providers)}"
            )

        # æ›´æ–° Provider
        update_data = {
            "stt_provider": request.stt_provider,
            "updated_at": datetime.utcnow().isoformat()
        }

        response = supabase.table("sessions").update(update_data).eq("id", str(session_id)).execute()

        if not response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•æ›´æ–° STT Provider")

        updated_session = response.data[0]

        logger.info(f"âœ… [SessionAPI] æˆåŠŸæ›´æ–° session {session_id} STT Provider: {request.stt_provider}")
        return SessionOut.model_validate(updated_session)

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"æ›´æ–° STT Provider æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


# END FILE CONTENTS


# File: frontend/tailwind.config.ts

import type { Config } from "tailwindcss";

const config: Config = {
    darkMode: ["class"],
    content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
    "*.{js,ts,jsx,tsx,mdx}"
  ],
  theme: {
  	extend: {
  		colors: {
  			background: 'hsl(var(--background))',
  			foreground: 'hsl(var(--foreground))',
  			card: {
  				DEFAULT: 'hsl(var(--card))',
  				foreground: 'hsl(var(--card-foreground))'
  			},
  			popover: {
  				DEFAULT: 'hsl(var(--popover))',
  				foreground: 'hsl(var(--popover-foreground))'
  			},
  			primary: {
  				DEFAULT: 'hsl(var(--primary))',
  				foreground: 'hsl(var(--primary-foreground))'
  			},
  			secondary: {
  				DEFAULT: 'hsl(var(--secondary))',
  				foreground: 'hsl(var(--secondary-foreground))'
  			},
  			muted: {
  				DEFAULT: 'hsl(var(--muted))',
  				foreground: 'hsl(var(--muted-foreground))'
  			},
  			accent: {
  				DEFAULT: 'hsl(var(--accent))',
  				foreground: 'hsl(var(--accent-foreground))'
  			},
  			destructive: {
  				DEFAULT: 'hsl(var(--destructive))',
  				foreground: 'hsl(var(--destructive-foreground))'
  			},
  			border: 'hsl(var(--border))',
  			input: 'hsl(var(--input))',
  			ring: 'hsl(var(--ring))',
  			chart: {
  				'1': 'hsl(var(--chart-1))',
  				'2': 'hsl(var(--chart-2))',
  				'3': 'hsl(var(--chart-3))',
  				'4': 'hsl(var(--chart-4))',
  				'5': 'hsl(var(--chart-5))'
  			},
  			sidebar: {
  				DEFAULT: 'hsl(var(--sidebar-background))',
  				foreground: 'hsl(var(--sidebar-foreground))',
  				primary: 'hsl(var(--sidebar-primary))',
  				'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
  				accent: 'hsl(var(--sidebar-accent))',
  				'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
  				border: 'hsl(var(--sidebar-border))',
  				ring: 'hsl(var(--sidebar-ring))'
  			}
  		},
  		borderRadius: {
  			lg: 'var(--radius)',
  			md: 'calc(var(--radius) - 2px)',
  			sm: 'calc(var(--radius) - 4px)'
  		},
  		keyframes: {
  			'accordion-down': {
  				from: {
  					height: '0'
  				},
  				to: {
  					height: 'var(--radix-accordion-content-height)'
  				}
  			},
  			'accordion-up': {
  				from: {
  					height: 'var(--radix-accordion-content-height)'
  				},
  				to: {
  					height: '0'
  				}
  			}
  		},
  		animation: {
  			'accordion-down': 'accordion-down 0.2s ease-out',
  			'accordion-up': 'accordion-up 0.2s ease-out'
  		}
  	}
  },
  plugins: [require("tailwindcss-animate")],
};
export default config;


# END FILE CONTENTS


# File: frontend/lib/services/service-registry.ts

"use client"

import { serviceContainer } from './service-container'
import { SessionService } from './session-service'
import { RecordingService } from './recording-service'
import { SimpleRecordingService } from './simple-recording-service'
import { TranscriptService } from './transcript-service'
import { RecordingFlowService } from './recording-flow-service'
import { SERVICE_KEYS } from './interfaces'
import { isFeatureEnabled } from '../feature-flags'

/**
 * æœå‹™è¨»å†Šç®¡ç†
 *
 * çµ±ä¸€ç®¡ç†æ‰€æœ‰æœå‹™çš„è¨»å†Šå’Œåˆå§‹åŒ–
 */
export class ServiceRegistry {
    private static isRegistered = false

    /**
     * è¨»å†Šæ‰€æœ‰æœå‹™
     *
     * ä½¿ç”¨ Singleton æ¨¡å¼ç¢ºä¿æœå‹™åªè¨»å†Šä¸€æ¬¡
     */
    static async registerServices(): Promise<void> {
        if (ServiceRegistry.isRegistered) {
            console.log('ğŸ”„ [ServiceRegistry] æœå‹™å·²è¨»å†Šï¼Œè·³éé‡è¤‡è¨»å†Š')
            return
        }

        try {
            console.log('ğŸš€ [ServiceRegistry] é–‹å§‹è¨»å†Šæœå‹™...')

            // è¨»å†Š SessionService
            serviceContainer.registerSingleton(SERVICE_KEYS.SESSION_SERVICE, () => new SessionService())
            console.log('âœ… [ServiceRegistry] SessionService è¨»å†Šå®Œæˆ')

            // è¨»å†Š RecordingServiceï¼ˆæ ¹æ“šåŠŸèƒ½é–‹é—œé¸æ“‡ï¼‰
            if (isFeatureEnabled('useSimpleRecordingService')) {
                serviceContainer.registerSingleton(SERVICE_KEYS.RECORDING_SERVICE, () => new SimpleRecordingService())
                console.log('âœ… [ServiceRegistry] SimpleRecordingService è¨»å†Šå®Œæˆ (Phase 2)')
            } else {
                serviceContainer.registerSingleton(SERVICE_KEYS.RECORDING_SERVICE, () => new RecordingService())
                console.log('âœ… [ServiceRegistry] RecordingService è¨»å†Šå®Œæˆ (Legacy)')
            }

            // è¨»å†Š TranscriptService
            serviceContainer.registerSingleton(SERVICE_KEYS.TRANSCRIPT_SERVICE, () => new TranscriptService())
            console.log('âœ… [ServiceRegistry] TranscriptService è¨»å†Šå®Œæˆ')

            // è¨»å†Š RecordingFlowService
            serviceContainer.registerSingleton(SERVICE_KEYS.RECORDING_FLOW_SERVICE, () => new RecordingFlowService())
            console.log('âœ… [ServiceRegistry] RecordingFlowService è¨»å†Šå®Œæˆ')

            ServiceRegistry.isRegistered = true
            console.log('âœ… [ServiceRegistry] æ‰€æœ‰æœå‹™è¨»å†Šå®Œæˆ')

        } catch (error) {
            console.error('âŒ [ServiceRegistry] æœå‹™è¨»å†Šå¤±æ•—:', error)
            throw error
        }
    }

    /**
     * åˆå§‹åŒ–æ‰€æœ‰æœå‹™
     *
     * å•Ÿå‹•æ‰€æœ‰å·²è¨»å†Šçš„æœå‹™
     */
    static async initializeServices(): Promise<void> {
        try {
            console.log('ğŸš€ [ServiceRegistry] é–‹å§‹åˆå§‹åŒ–æœå‹™...')

            // ç¢ºä¿æœå‹™å·²è¨»å†Š
            await ServiceRegistry.registerServices()

            // åˆå§‹åŒ– SessionService
            const sessionService = serviceContainer.resolve<SessionService>(SERVICE_KEYS.SESSION_SERVICE)
            await sessionService.start()

            // åˆå§‹åŒ– RecordingService
            const recordingService = serviceContainer.resolve<RecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
            await recordingService.start()

            // åˆå§‹åŒ– TranscriptService
            const transcriptService = serviceContainer.resolve<TranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)
            await transcriptService.start()

            // åˆå§‹åŒ– RecordingFlowService
            const recordingFlowService = serviceContainer.resolve<RecordingFlowService>(SERVICE_KEYS.RECORDING_FLOW_SERVICE)
            await recordingFlowService.start()

            console.log('âœ… [ServiceRegistry] æ‰€æœ‰æœå‹™åˆå§‹åŒ–å®Œæˆ')

        } catch (error) {
            console.error('âŒ [ServiceRegistry] æœå‹™åˆå§‹åŒ–å¤±æ•—:', error)
            throw error
        }
    }

    /**
     * åœæ­¢æ‰€æœ‰æœå‹™
     */
    static async stopServices(): Promise<void> {
        try {
            console.log('ğŸ›‘ [ServiceRegistry] é–‹å§‹åœæ­¢æœå‹™...')

            if (!ServiceRegistry.isRegistered) {
                console.log('â„¹ï¸ [ServiceRegistry] æœå‹™æœªè¨»å†Šï¼Œç„¡éœ€åœæ­¢')
                return
            }

            // æŒ‰ç›¸åé †åºåœæ­¢æœå‹™
            const recordingFlowService = serviceContainer.resolve<RecordingFlowService>(SERVICE_KEYS.RECORDING_FLOW_SERVICE)
            await recordingFlowService.stop()

            const transcriptService = serviceContainer.resolve<TranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)
            await transcriptService.stop()

            const recordingService = serviceContainer.resolve<RecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
            await recordingService.stop()

            const sessionService = serviceContainer.resolve<SessionService>(SERVICE_KEYS.SESSION_SERVICE)
            await sessionService.stop()

            console.log('âœ… [ServiceRegistry] æ‰€æœ‰æœå‹™åœæ­¢å®Œæˆ')

        } catch (error) {
            console.error('âŒ [ServiceRegistry] æœå‹™åœæ­¢å¤±æ•—:', error)
            throw error
        }
    }

    /**
     * å–å¾—æœå‹™è¨»å†Šç‹€æ…‹
     */
    static getRegistrationStatus(): {
        isRegistered: boolean
        registeredServices: string[]
    } {
        return {
            isRegistered: ServiceRegistry.isRegistered,
            registeredServices: serviceContainer.getRegisteredServices()
        }
    }
}

// è‡ªå‹•è¨»å†Šæœå‹™ï¼ˆåœ¨æ¨¡çµ„è¼‰å…¥æ™‚ï¼‰
ServiceRegistry.registerServices().catch(error => {
    console.error('âŒ [ServiceRegistry] è‡ªå‹•è¨»å†Šå¤±æ•—:', error)
})


# END FILE CONTENTS


# File: frontend/lib/stream/audio-uploader.ts

"use client"

/**
 * AudioUploader - éŸ³è¨Šä¸Šå‚³ WebSocket é¡åˆ¥
 *
 * è² è²¬å»ºç«‹ /ws/upload_audio/{sessionId} WebSocket é€£æ¥
 * ä¸¦ç™¼é€éŸ³è¨Šåˆ‡ç‰‡åˆ°å¾Œç«¯é€²è¡ŒèªéŸ³è¾¨è­˜
 */
export class AudioUploader {
    private ws: WebSocket | null = null
    private sessionId: string | null = null
    private sequenceNumber = 0  // éŸ³è¨Šåˆ‡ç‰‡åºè™Ÿ
    private reconnectAttempts = 0  // é‡é€£å˜—è©¦æ¬¡æ•¸
    private maxReconnectAttempts = 5  // æœ€å¤§é‡é€£æ¬¡æ•¸
    private reconnectDelay = 1000  // é‡é€£å»¶é²ï¼ˆæ¯«ç§’ï¼‰
    private pendingChunks: Map<number, Blob> = new Map()  // å¾…é‡ç™¼çš„éŸ³è¨Šåˆ‡ç‰‡

    /**
     * é€£æ¥éŸ³è¨Šä¸Šå‚³ WebSocket
     */
    async connect(sessionId: string): Promise<void> {
        this.sessionId = sessionId
        this.sequenceNumber = 0  // é‡ç½®åºè™Ÿ
        this.reconnectAttempts = 0  // é‡ç½®é‡é€£è¨ˆæ•¸
        this.pendingChunks.clear()  // æ¸…ç©ºå¾…è™•ç†åˆ‡ç‰‡

        const wsBaseUrl = process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000'
        const wsUrl = `${wsBaseUrl}/ws/upload_audio/${sessionId}`

        console.log('ğŸ”Œ [AudioUploader] æ­£åœ¨é€£æ¥:', wsUrl)

        this.ws = new WebSocket(wsUrl)

        return new Promise((resolve, reject) => {
            if (!this.ws) return reject(new Error('WebSocket å‰µå»ºå¤±æ•—'))

            this.ws.onopen = () => {
                console.log('âœ… [AudioUploader] WebSocket é€£æ¥æˆåŠŸ:', sessionId)
                resolve()
            }

            this.ws.onerror = (error) => {
                console.error('âŒ [AudioUploader] WebSocket éŒ¯èª¤:', error)
                reject(new Error('AudioUploader WebSocket é€£æ¥å¤±æ•—'))
            }

            this.ws.onclose = (event) => {
                console.log('ğŸ”Œ [AudioUploader] WebSocket é€£æ¥å·²é—œé–‰:', {
                    code: event.code,
                    reason: event.reason,
                    sessionId: this.sessionId,
                    wasClean: event.wasClean
                })

                // å¦‚æœä¸æ˜¯æ‰‹å‹•é—œé–‰ï¼Œå˜—è©¦é‡é€£
                if (!event.wasClean && this.sessionId && this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.attemptReconnect()
                }
            }

            this.ws.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data)
                    this.handleServerMessage(message)
                } catch (error) {
                    console.log('ğŸ“¥ [AudioUploader] æ”¶åˆ°é JSON æ¶ˆæ¯:', event.data)
                }
            }
        })
    }

    /**
     * è™•ç†ä¼ºæœå™¨æ¶ˆæ¯
     */
    private handleServerMessage(message: any): void {
        console.log('ğŸ“¥ [AudioUploader] æ”¶åˆ°ä¼ºæœå™¨æ¶ˆæ¯:', message)

        switch (message.type) {
            case 'ack':
                console.log(`âœ… [AudioUploader] éŸ³è¨Šåˆ‡ç‰‡ #${message.chunk_sequence} ç¢ºèªæ”¶åˆ°`)
                break
            case 'upload_error':
                console.error(`âŒ [AudioUploader] ä¸Šå‚³éŒ¯èª¤ #${message.chunk_sequence}:`, message.error)
                break
            case 'connection_established':
                console.log('âœ… [AudioUploader] é€£æ¥å·²å»ºç«‹')
                break
            default:
                console.log('ğŸ“¥ [AudioUploader] æœªçŸ¥æ¶ˆæ¯é¡å‹:', message.type)
        }
    }

    /**
     * ç™¼é€éŸ³è¨Šåˆ‡ç‰‡ï¼ˆä¿®æ­£çš„ 4-byte sequence + Blob æ ¼å¼ï¼‰
     * åˆä½µåºè™Ÿå’ŒéŸ³æª”æ•¸æ“šç‚ºä¸€å€‹äºŒé€²åˆ¶æ¶ˆæ¯ï¼Œä½¿ç”¨å°ç«¯åºèˆ‡å¾Œç«¯åŒ¹é…
     */
    async send(blob: Blob, sequence?: number): Promise<void> {
        if (this.ws?.readyState !== WebSocket.OPEN) {
            console.warn('âš ï¸ [AudioUploader] WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ç™¼é€éŸ³è¨Šæ•¸æ“š', {
                readyState: this.ws?.readyState,
                expectedState: WebSocket.OPEN,
                sessionId: this.sessionId,
                sequence: sequence ?? this.sequenceNumber
            })
            return
        }

        // ä½¿ç”¨å‚³å…¥çš„åºè™Ÿæˆ–å…§éƒ¨åºè™Ÿ
        const currentSequence = sequence ?? this.sequenceNumber

        console.log(`ğŸ“¤ [AudioUploader] æº–å‚™ç™¼é€éŸ³è¨Šåˆ‡ç‰‡ #${currentSequence}`, {
            blobSize: blob.size,
            mimeType: blob.type,
            sessionId: this.sessionId,
            timestamp: new Date().toISOString()
        })

        try {
            // ä¿®æ­£ï¼šå°‡åºè™Ÿå’ŒéŸ³æª”æ•¸æ“šåˆä½µç‚ºä¸€å€‹äºŒé€²åˆ¶æ¶ˆæ¯
            // 4-byte sequence (å°ç«¯åº) + Blob æ•¸æ“š
            const sequenceBuffer = new ArrayBuffer(4)
            const sequenceView = new DataView(sequenceBuffer)
            sequenceView.setUint32(0, currentSequence, true) // true = å°ç«¯åºï¼Œèˆ‡å¾Œç«¯åŒ¹é…

            // å°‡åºè™Ÿå’ŒéŸ³æª”æ•¸æ“šåˆä½µ
            const blobArrayBuffer = await blob.arrayBuffer()
            const combinedBuffer = new ArrayBuffer(4 + blobArrayBuffer.byteLength)
            const combinedView = new Uint8Array(combinedBuffer)

            // è¤‡è£½åºè™Ÿåˆ°åˆä½µç·©è¡å€
            combinedView.set(new Uint8Array(sequenceBuffer), 0)
            // è¤‡è£½éŸ³æª”æ•¸æ“šåˆ°åˆä½µç·©è¡å€
            combinedView.set(new Uint8Array(blobArrayBuffer), 4)

            // ä¸€æ¬¡æ€§ç™¼é€åˆä½µçš„äºŒé€²åˆ¶æ•¸æ“š
            this.ws.send(combinedBuffer)

            console.log(`âœ… [AudioUploader] éŸ³è¨Šåˆ‡ç‰‡ #${currentSequence} ç™¼é€æˆåŠŸ: ${blob.size} bytes (ç¸½è¨ˆ: ${combinedBuffer.byteLength} bytes)`)

            // DEV æ¨¡å¼è¨ºæ–·è¨ˆæ•¸
            if (process.env.NODE_ENV === 'development') {
                this.updateDevDiagnostics(currentSequence, blob.size)
            }

            // åªæœ‰ä½¿ç”¨å…§éƒ¨åºè™Ÿæ™‚æ‰éå¢
            if (sequence === undefined) {
                this.sequenceNumber++
            }

        } catch (error) {
            console.error(`âŒ [AudioUploader] ç™¼é€éŸ³è¨Šåˆ‡ç‰‡ #${currentSequence} å¤±æ•—:`, error)
            this.handleSendError(currentSequence, error)
        }
    }

    /**
     * è™•ç†ç™¼é€éŒ¯èª¤çš„é‡è©¦æ©Ÿåˆ¶
     */
    private handleSendError(sequence: number, error: any): void {
        console.error(`âŒ [AudioUploader] åºè™Ÿ #${sequence} ç™¼é€éŒ¯èª¤:`, error)
        // å¯ä»¥åœ¨é€™è£¡å¯¦ä½œé‡è©¦é‚è¼¯
        // ä¾‹å¦‚ï¼šå°‡å¤±æ•—çš„åºè™ŸåŠ å…¥é‡è©¦ä½‡åˆ—
    }

    /**
     * å˜—è©¦é‡æ–°é€£æ¥ WebSocket
     */
    private async attemptReconnect(): Promise<void> {
        this.reconnectAttempts++

        console.log(`ğŸ”„ [AudioUploader] å˜—è©¦é‡é€£ (#${this.reconnectAttempts}/${this.maxReconnectAttempts})`)

        // æ¼¸é€²å¼å»¶é²é‡é€£
        const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts - 1)

        setTimeout(async () => {
            try {
                if (this.sessionId) {
                    await this.connect(this.sessionId)
                    console.log('âœ… [AudioUploader] é‡é€£æˆåŠŸ')
                    this.reconnectAttempts = 0 // é‡ç½®é‡é€£è¨ˆæ•¸

                    // é‡æ–°ç™¼é€å¾…è™•ç†çš„éŸ³è¨Šåˆ‡ç‰‡
                    this.resendPendingChunks()
                }
            } catch (error) {
                console.error(`âŒ [AudioUploader] é‡é€£å¤±æ•— (#${this.reconnectAttempts}):`, error)

                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.attemptReconnect()
                } else {
                    console.error('âŒ [AudioUploader] å·²é”é‡é€£æœ€å¤§æ¬¡æ•¸ï¼Œåœæ­¢å˜—è©¦')
                }
            }
        }, delay)
    }

    /**
     * é‡æ–°ç™¼é€å¾…è™•ç†çš„éŸ³è¨Šåˆ‡ç‰‡
     */
    private resendPendingChunks(): void {
        if (this.pendingChunks.size === 0) return

        console.log(`ğŸ”„ [AudioUploader] é‡æ–°ç™¼é€ ${this.pendingChunks.size} å€‹å¾…è™•ç†åˆ‡ç‰‡`)

        for (const [sequence, blob] of this.pendingChunks.entries()) {
            this.send(blob, sequence)
        }

        // æ¸…ç©ºå¾…è™•ç†åˆ‡ç‰‡
        this.pendingChunks.clear()
    }

    /**
     * æ›´æ–°é–‹ç™¼æ¨¡å¼è¨ºæ–·ä¿¡æ¯
     */
    private updateDevDiagnostics(sequence: number, blobSize: number): void {
        if (!(window as any).__rec) {
            (window as any).__rec = {
                chunksSent: 0,
                totalBytes: 0,
                isRecording: false,
                sessionId: null,
                lastSequence: -1,
                errors: 0
            }
        }

        const rec = (window as any).__rec
        rec.chunksSent++
        rec.totalBytes += blobSize
        rec.sessionId = this.sessionId
        rec.isRecording = true
        rec.lastSequence = sequence

        console.log(`ğŸ” [AudioUploader] DEV è¨ºæ–·:`, {
            chunksSent: rec.chunksSent,
            totalBytes: rec.totalBytes,
            lastSequence: sequence,
            sessionId: this.sessionId
        })
    }

    /**
     * é‡ç½®åºè™Ÿï¼ˆé‡æ–°é–‹å§‹éŒ„éŸ³æ™‚ä½¿ç”¨ï¼‰
     */
    resetSequence(): void {
        this.sequenceNumber = 0
        console.log('ğŸ”„ [AudioUploader] åºè™Ÿå·²é‡ç½®')
    }

    /**
     * é—œé–‰ WebSocket é€£æ¥
     */
    close(): void {
        if (this.ws) {
            this.ws.close()
            this.ws = null
        }

        this.sessionId = null
        this.sequenceNumber = 0
        this.reconnectAttempts = 0
        this.pendingChunks.clear()

        // æ›´æ–° DEV æ¨¡å¼è¨ºæ–·ç‹€æ…‹
        if (process.env.NODE_ENV === 'development' && (window as any).__rec) {
            (window as any).__rec.isRecording = false
        }

        console.log('ğŸ”Œ [AudioUploader] WebSocket å·²é—œé–‰')
    }

    /**
     * æª¢æŸ¥é€£æ¥ç‹€æ…‹
     */
    get isConnected(): boolean {
        return this.ws?.readyState === WebSocket.OPEN
    }

    /**
     * ç²å–ç•¶å‰æœƒè©± ID
     */
    get currentSessionId(): string | null {
        return this.sessionId
    }

    /**
     * ç²å–ç•¶å‰åºè™Ÿ
     */
    get currentSequence(): number {
        return this.sequenceNumber
    }

    /**
     * ç²å– WebSocket ç‹€æ…‹
     */
    get connectionState(): string {
        if (!this.ws) return 'NOT_CREATED'

        switch (this.ws.readyState) {
            case WebSocket.CONNECTING: return 'CONNECTING'
            case WebSocket.OPEN: return 'OPEN'
            case WebSocket.CLOSING: return 'CLOSING'
            case WebSocket.CLOSED: return 'CLOSED'
            default: return 'UNKNOWN'
        }
    }
}

/**
 * é»˜èªçš„éŸ³è¨Šä¸Šå‚³å™¨å¯¦ä¾‹
 * å¯åœ¨æ•´å€‹æ‡‰ç”¨ä¸­å…±ç”¨
 */
export const audioUploader = new AudioUploader()


# END FILE CONTENTS


# File: frontend/lib/__tests__/network-restorer.test.ts

import { describe, expect, it, vi } from 'vitest'
import { emit } from '@/utils/event-bus'
import * as uploader from '@/lib/rest-audio-uploader'
import * as tm from '@/lib/transcript-manager'

describe('network restorer', () => {
    it('should retry and reconnect', async () => {
        const spyRetry = vi.spyOn(uploader.restAudioUploader, 'retryFailedSegments').mockResolvedValue({ uploaded: 1, remaining: 0 })
        const spyConnect = vi.spyOn(tm.transcriptManager, 'connect').mockReturnValue(Promise.resolve() as any)
        const spyIsConnected = vi.spyOn(tm.transcriptManager, 'isConnected').mockReturnValue(false)

        emit('network:restored')
        await vi.runAllTicks()

        expect(spyRetry).toHaveBeenCalled()
        expect(spyConnect).toHaveBeenCalled()
    })
})


# END FILE CONTENTS


# File: app/core/__init__.py



# END FILE CONTENTS


# File: .cursor/rules/python.mdc

---
description: Python best practices and patterns for modern software development with Flask and SQLite
globs: **/*.py, src/**/*.py, tests/**/*.py
alwaysApply: false
---
<!-- Source: https://github.com/sanjeed5/awesome-cursor-rules-mdc/tree/main/rules-mdc -->

# Python Best Practices

## Project Structure
- Use src-layout with `src/your_package_name/`
- Place tests in `tests/` directory parallel to `src/`
- Keep configuration in `config/` or as environment variables
- Store requirements in `requirements.txt` or `pyproject.toml`
- Place static files in `static/` directory
- Use `templates/` for Jinja2 templates

## Code Style
- Follow Black code formatting
- Use isort for import sorting
- Follow PEP 8 naming conventions:
  - snake_case for functions and variables
  - PascalCase for classes
  - UPPER_CASE for constants
- Maximum line length of 88 characters (Black default)
- Use absolute imports over relative imports

## Type Hints
- Use type hints for all function parameters and returns
- Import types from `typing` module
- Use `Optional[Type]` instead of `Type | None`
- Use `TypeVar` for generic types
- Define custom types in `types.py`
- Use `Protocol` for duck typing

## Flask Structure
- Use Flask factory pattern
- Organize routes using Blueprints
- Use Flask-SQLAlchemy for database
- Implement proper error handlers
- Use Flask-Login for authentication
- Structure views with proper separation of concerns

## Database
- Use SQLAlchemy ORM
- Implement database migrations with Alembic
- Use proper connection pooling
- Define models in separate modules
- Implement proper relationships
- Use proper indexing strategies

## Authentication
- Use Flask-Login for session management
- Implement Google OAuth using Flask-OAuth
- Hash passwords with bcrypt
- Use proper session security
- Implement CSRF protection
- Use proper role-based access control

## API Design
- Use Flask-RESTful for REST APIs
- Implement proper request validation
- Use proper HTTP status codes
- Handle errors consistently
- Use proper response formats
- Implement proper rate limiting

## Testing
- Use pytest for testing
- Write tests for all routes
- Use pytest-cov for coverage
- Implement proper fixtures
- Use proper mocking with pytest-mock
- Test all error scenarios

## Security
- Use HTTPS in production
- Implement proper CORS
- Sanitize all user inputs
- Use proper session configuration
- Implement proper logging
- Follow OWASP guidelines

## Performance
- Use proper caching with Flask-Caching
- Implement database query optimization
- Use proper connection pooling
- Implement proper pagination
- Use background tasks for heavy operations
- Monitor application performance

## Error Handling
- Create custom exception classes
- Use proper try-except blocks
- Implement proper logging
- Return proper error responses
- Handle edge cases properly
- Use proper error messages

## Documentation
- Use Google-style docstrings
- Document all public APIs
- Keep README.md updated
- Use proper inline comments
- Generate API documentation
- Document environment setup

## Development Workflow
- Always use virtual environments (uv)
- Implement pre-commit hooks
- Use proper Git workflow
- Follow semantic versioning
- Use proper CI/CD practices
- Implement proper logging

## Dependencies
- Pin dependency versions
- Use requirements.txt for production
- Separate dev dependencies
- Use proper package versions
- Regularly update dependencies
- Check for security vulnerabilities


# END FILE CONTENTS


# File: app/lib/prom_helpers.py

from prometheus_client import REGISTRY
from typing import Any

def metric_exists(name: str) -> bool:
    """åˆ¤æ–· default CollectorRegistry è£¡æ˜¯å¦å·²æœ‰åŒå metric"""
    return any(m.name == name for m in REGISTRY.collect())

def safe_counter(name: str, documentation: str, labelnames: list[str] | None = None) -> Any:
    from prometheus_client import Counter
    if name in REGISTRY._names_to_collectors:
        return REGISTRY._names_to_collectors[name]
    return Counter(name, documentation, labelnames or [])

def safe_gauge(name: str, documentation: str, labelnames: list[str] | None = None) -> Any:
    from prometheus_client import Gauge
    if name in REGISTRY._names_to_collectors:
        return REGISTRY._names_to_collectors[name]
    return Gauge(name, documentation, labelnames or [])

def safe_summary(name: str, documentation: str, labelnames: list[str] | None = None) -> Any:
    from prometheus_client import Summary
    if name in REGISTRY._names_to_collectors:
        return REGISTRY._names_to_collectors[name]
    return Summary(name, documentation, labelnames or [])


# END FILE CONTENTS


# File: frontend/components/ui/slider.tsx

"use client"

import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }


# END FILE CONTENTS


# File: frontend/lib/state-machine.ts

"use client"

import { AppState } from "../types/app-state"
import {
    StateTransitionTrigger,
    StateTransitionCondition,
    StateTransitionContext,
    StateTransitionResult,
    StateTransitionSideEffect,
    STATE_TRANSITION_RULES,
    STATE_TRANSITION_SIDE_EFFECTS
} from "../types/state-transitions"

// ç‹€æ…‹æ©Ÿé¡åˆ¥
export class StateMachine {
    private currentState: AppState = "default"
    private context: StateTransitionContext
    private listeners: Set<(newState: AppState, sideEffects: StateTransitionSideEffect[]) => void> = new Set()

    constructor(initialContext: StateTransitionContext) {
        this.context = initialContext
        this.currentState = initialContext.currentState
        this.exposeToWindow()
    }

    // æ›´æ–°ä¸Šä¸‹æ–‡
    updateContext(newContext: Partial<StateTransitionContext>): void {
        this.context = { ...this.context, ...newContext }
        console.log('ğŸ”„ [StateMachine] ä¸Šä¸‹æ–‡å·²æ›´æ–°:', this.context)
    }

    // å˜—è©¦ç‹€æ…‹è½‰æ›
    transition(trigger: StateTransitionTrigger): StateTransitionResult {
        const transitionKey = `${this.currentState}->${trigger}`
        console.log(`ğŸ”„ [StateMachine] å˜—è©¦ç‹€æ…‹è½‰æ›: ${transitionKey}`)

        // å°‹æ‰¾ç¬¦åˆçš„è½‰æ›è¦å‰‡
        const matchingRules = this.findMatchingRules(trigger)

        if (matchingRules.length === 0) {
            const error = `æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„è½‰æ›è¦å‰‡: ${transitionKey}`
            console.warn(`âš ï¸ [StateMachine] ${error}`)
            return {
                success: false,
                newState: this.currentState,
                error
            }
        }

        // é©—è­‰è½‰æ›æ¢ä»¶
        const validRule = this.validateTransitionRules(matchingRules)

        if (!validRule) {
            const error = `è½‰æ›æ¢ä»¶ä¸ç¬¦åˆ: ${transitionKey}`
            console.warn(`âš ï¸ [StateMachine] ${error}`)
            return {
                success: false,
                newState: this.currentState,
                error
            }
        }

        // åŸ·è¡Œç‹€æ…‹è½‰æ›
        const result = this.executeTransition(validRule, trigger)

        if (result.success) {
            this.currentState = result.newState
            console.log(`âœ… [StateMachine] ç‹€æ…‹è½‰æ›æˆåŠŸ: ${this.context.currentState} -> ${result.newState}`)

            // æ›´æ–°ä¸Šä¸‹æ–‡ä¸­çš„ç•¶å‰ç‹€æ…‹
            this.context.currentState = result.newState

            // é€šçŸ¥ç›£è½å™¨
            this.notifyListeners(result.newState, result.sideEffects || [])
        }

        return result
    }

    // å°‹æ‰¾åŒ¹é…çš„è½‰æ›è¦å‰‡
    private findMatchingRules(trigger: StateTransitionTrigger): StateTransitionCondition[] {
        return STATE_TRANSITION_RULES.filter(rule =>
            rule.currentState === this.currentState && rule.trigger === trigger
        )
    }

    // é©—è­‰è½‰æ›è¦å‰‡
    private validateTransitionRules(rules: StateTransitionCondition[]): StateTransitionCondition | null {
        for (const rule of rules) {
            if (this.isRuleValid(rule)) {
                return rule
            }
        }
        return null
    }

    // æª¢æŸ¥å–®ä¸€è¦å‰‡æ˜¯å¦æœ‰æ•ˆ
    private isRuleValid(rule: StateTransitionCondition): boolean {
        const context = this.context

        // æª¢æŸ¥ session å­˜åœ¨æ€§
        if (rule.sessionExists !== undefined) {
            const hasSession = context.session !== null
            if (rule.sessionExists !== hasSession) {
                console.log(`ğŸ” [StateMachine] Session å­˜åœ¨æ€§æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.sessionExists}, å¯¦éš› ${hasSession}`)
                return false
            }
        }

        // æª¢æŸ¥ session ç‹€æ…‹
        if (rule.sessionStatus !== undefined) {
            if (!context.session || context.session.status !== rule.sessionStatus) {
                console.log(`ğŸ” [StateMachine] Session ç‹€æ…‹æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.sessionStatus}, å¯¦éš› ${context.session?.status}`)
                return false
            }
        }

        // æª¢æŸ¥ session é¡å‹
        if (rule.sessionType !== undefined) {
            if (!context.session || context.session.type !== rule.sessionType) {
                console.log(`ğŸ” [StateMachine] Session é¡å‹æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.sessionType}, å¯¦éš› ${context.session?.type}`)
                return false
            }
        }

        // æª¢æŸ¥éŒ„éŸ³ç‹€æ…‹
        if (rule.isRecording !== undefined) {
            if (context.isRecording !== rule.isRecording) {
                console.log(`ğŸ” [StateMachine] éŒ„éŸ³ç‹€æ…‹æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.isRecording}, å¯¦éš› ${context.isRecording}`)
                return false
            }
        }

        // æª¢æŸ¥é€å­—ç¨¿å­˜åœ¨æ€§
        if (rule.hasTranscripts !== undefined) {
            const hasTranscripts = context.transcriptCount > 0
            if (rule.hasTranscripts !== hasTranscripts) {
                console.log(`ğŸ” [StateMachine] é€å­—ç¨¿å­˜åœ¨æ€§æª¢æŸ¥å¤±æ•—: æœŸæœ› ${rule.hasTranscripts}, å¯¦éš› ${hasTranscripts}`)
                return false
            }
        }

        // åŸ·è¡Œè‡ªå®šç¾©é©—è­‰
        if (rule.customValidator) {
            const isValid = rule.customValidator(context)
            if (!isValid) {
                console.log(`ğŸ” [StateMachine] è‡ªå®šç¾©é©—è­‰å¤±æ•—`)
                return false
            }
        }

        console.log(`âœ… [StateMachine] è¦å‰‡é©—è­‰é€šé: ${rule.currentState} -> ${rule.targetState}`)
        return true
    }

    // åŸ·è¡Œç‹€æ…‹è½‰æ›
    private executeTransition(rule: StateTransitionCondition, trigger: StateTransitionTrigger): StateTransitionResult {
        const sideEffectKey = `${rule.currentState}->${rule.targetState}->${trigger}`
        const sideEffects = STATE_TRANSITION_SIDE_EFFECTS[sideEffectKey] || []

        console.log(`ğŸ”„ [StateMachine] åŸ·è¡Œè½‰æ›: ${sideEffectKey}`)
        console.log(`ğŸ”„ [StateMachine] å‰¯ä½œç”¨:`, sideEffects)

        return {
            success: true,
            newState: rule.targetState,
            sideEffects
        }
    }

    // æ·»åŠ ç‹€æ…‹è®Šæ›´ç›£è½å™¨
    addListener(listener: (newState: AppState, sideEffects: StateTransitionSideEffect[]) => void): void {
        this.listeners.add(listener)
    }

    // ç§»é™¤ç‹€æ…‹è®Šæ›´ç›£è½å™¨
    removeListener(listener: (newState: AppState, sideEffects: StateTransitionSideEffect[]) => void): void {
        this.listeners.delete(listener)
    }

    // é€šçŸ¥æ‰€æœ‰ç›£è½å™¨
    private notifyListeners(newState: AppState, sideEffects: StateTransitionSideEffect[]): void {
        this.listeners.forEach(listener => {
            try {
                listener(newState, sideEffects)
            } catch (error) {
                console.error('ğŸ”„ [StateMachine] ç›£è½å™¨åŸ·è¡Œå¤±æ•—:', error)
            }
        })
    }

    // å–å¾—ç•¶å‰ç‹€æ…‹
    getCurrentState(): AppState {
        return this.currentState
    }

    // å–å¾—ç•¶å‰ä¸Šä¸‹æ–‡
    getContext(): StateTransitionContext {
        return { ...this.context }
    }

    // æª¢æŸ¥æ˜¯å¦å¯ä»¥åŸ·è¡Œç‰¹å®šè½‰æ›
    canTransition(trigger: StateTransitionTrigger): boolean {
        const matchingRules = this.findMatchingRules(trigger)
        return matchingRules.some(rule => this.isRuleValid(rule))
    }

    // å–å¾—å¯ç”¨çš„è½‰æ›
    getAvailableTransitions(): StateTransitionTrigger[] {
        const availableTransitions: StateTransitionTrigger[] = []

        // æª¢æŸ¥æ‰€æœ‰å¯èƒ½çš„è§¸ç™¼å™¨
        const allTriggers: StateTransitionTrigger[] = [
            "USER_START_RECORDING",
            "USER_STOP_RECORDING",
            "FIRST_TRANSCRIPT_RECEIVED",
            "SESSION_CREATED",
            "SESSION_UPGRADED",
            "PROCESSING_STARTED",
            "PROCESSING_COMPLETED",
            "ERROR_OCCURRED",
            "USER_NEW_NOTE",
            "TRANSCRIPT_COMPLETED"
        ]

        for (const trigger of allTriggers) {
            if (this.canTransition(trigger)) {
                availableTransitions.push(trigger)
            }
        }

        return availableTransitions
    }

    // é‡ç½®ç‹€æ…‹æ©Ÿ
    reset(newContext?: StateTransitionContext): void {
        this.currentState = "default"
        if (newContext) {
            this.context = newContext
        } else {
            this.context = {
                currentState: "default",
                isRecording: false,
                transcriptCount: 0,
                session: null,
                error: null
            }
        }
        console.log('ğŸ”„ [StateMachine] ç‹€æ…‹æ©Ÿå·²é‡ç½®')
    }

    // æš´éœ²åˆ° window ä¾›èª¿è©¦ä½¿ç”¨
    private exposeToWindow(): void {
        if (typeof window !== 'undefined') {
            (window as any).stateMachine = {
                getCurrentState: () => this.getCurrentState(),
                getContext: () => this.getContext(),
                canTransition: (trigger: StateTransitionTrigger) => this.canTransition(trigger),
                getAvailableTransitions: () => this.getAvailableTransitions(),
                transition: (trigger: StateTransitionTrigger) => this.transition(trigger),
                reset: () => this.reset(),

                // ä¾¿åˆ©æ–¹æ³•
                startRecording: () => this.transition("USER_START_RECORDING"),
                stopRecording: () => this.transition("USER_STOP_RECORDING"),
                newNote: () => this.transition("USER_NEW_NOTE"),
                firstTranscript: () => this.transition("FIRST_TRANSCRIPT_RECEIVED"),
                processingComplete: () => this.transition("PROCESSING_COMPLETED"),
                error: () => this.transition("ERROR_OCCURRED"),
            }

            console.log('ğŸ”„ [StateMachine] èª¿è©¦ä»‹é¢å·²æš´éœ²åˆ° window.stateMachine')
            console.log('   ä½¿ç”¨æ–¹æ³•: window.stateMachine.startRecording()')
            console.log('   æŸ¥çœ‹ç‹€æ…‹: window.stateMachine.getCurrentState()')
            console.log('   å¯ç”¨è½‰æ›: window.stateMachine.getAvailableTransitions()')
        }
    }
}

// å‰¯ä½œç”¨è™•ç†å™¨ä»‹é¢
export interface SideEffectHandler {
    handleSideEffect(effect: StateTransitionSideEffect): Promise<void> | void
}

// ç‹€æ…‹æ©Ÿç®¡ç†å™¨
export class StateMachineManager {
    private stateMachine: StateMachine
    private sideEffectHandlers: Map<string, SideEffectHandler> = new Map()

    constructor(initialContext: StateTransitionContext) {
        this.stateMachine = new StateMachine(initialContext)

        // ç›£è½ç‹€æ…‹è®Šæ›´ä¸¦è™•ç†å‰¯ä½œç”¨
        this.stateMachine.addListener((newState, sideEffects) => {
            this.handleSideEffects(sideEffects)
        })
    }

    // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨
    registerSideEffectHandler(effectType: string, handler: SideEffectHandler): void {
        this.sideEffectHandlers.set(effectType, handler)
        console.log(`ğŸ”„ [StateMachineManager] å‰¯ä½œç”¨è™•ç†å™¨å·²è¨»å†Š: ${effectType}`)
    }

    // è™•ç†å‰¯ä½œç”¨
    private async handleSideEffects(sideEffects: StateTransitionSideEffect[]): Promise<void> {
        for (const effect of sideEffects) {
            const handler = this.sideEffectHandlers.get(effect.type)
            if (handler) {
                try {
                    await handler.handleSideEffect(effect)
                    console.log(`âœ… [StateMachineManager] å‰¯ä½œç”¨è™•ç†å®Œæˆ: ${effect.type}`)
                } catch (error) {
                    console.error(`âŒ [StateMachineManager] å‰¯ä½œç”¨è™•ç†å¤±æ•—: ${effect.type}`, error)
                }
            } else {
                console.warn(`âš ï¸ [StateMachineManager] æœªæ‰¾åˆ°å‰¯ä½œç”¨è™•ç†å™¨: ${effect.type}`)
            }
        }
    }

    // å–å¾—ç‹€æ…‹æ©Ÿå¯¦ä¾‹
    getStateMachine(): StateMachine {
        return this.stateMachine
    }

    // æ›´æ–°ä¸Šä¸‹æ–‡ä¸¦è§¸ç™¼è‡ªå‹•è½‰æ›
    updateContextAndTransition(
        newContext: Partial<StateTransitionContext>,
        autoTrigger?: StateTransitionTrigger
    ): StateTransitionResult | null {
        this.stateMachine.updateContext(newContext)

        if (autoTrigger && this.stateMachine.canTransition(autoTrigger)) {
            return this.stateMachine.transition(autoTrigger)
        }

        return null
    }
}

// ä¾¿åˆ©å‡½æ•¸ï¼šå»ºç«‹ç‹€æ…‹æ©Ÿå¯¦ä¾‹
export function createStateMachine(initialContext: StateTransitionContext): StateMachineManager {
    return new StateMachineManager(initialContext)
}


# END FILE CONTENTS


# File: frontend/components/ui/use-mobile.tsx

import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}


# END FILE CONTENTS


# File: frontend/components/ui/calendar.tsx

"use client"

import * as React from "react"
import { ChevronLeft, ChevronRight } from "lucide-react"
import { DayPicker } from "react-day-picker"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

export type CalendarProps = React.ComponentProps<typeof DayPicker>

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  )
}
Calendar.displayName = "Calendar"

export { Calendar }


# END FILE CONTENTS


# File: frontend/public/placeholder-logo.svg

<svg xmlns="http://www.w3.org/2000/svg" width="215" height="48" fill="none"><path fill="#000" d="M57.588 9.6h6L73.828 38h-5.2l-2.36-6.88h-11.36L52.548 38h-5.2l10.24-28.4Zm7.16 17.16-4.16-12.16-4.16 12.16h8.32Zm23.694-2.24c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.486-7.72.12 3.4c.534-1.227 1.307-2.173 2.32-2.84 1.04-.693 2.267-1.04 3.68-1.04 1.494 0 2.76.387 3.8 1.16 1.067.747 1.827 1.813 2.28 3.2.507-1.44 1.294-2.52 2.36-3.24 1.094-.747 2.414-1.12 3.96-1.12 1.414 0 2.64.307 3.68.92s1.84 1.52 2.4 2.72c.56 1.2.84 2.667.84 4.4V38h-4.96V25.92c0-1.813-.293-3.187-.88-4.12-.56-.96-1.413-1.44-2.56-1.44-.906 0-1.68.213-2.32.64-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.84-.48 3.04V38h-4.56V25.92c0-1.2-.133-2.213-.4-3.04-.24-.827-.626-1.453-1.16-1.88-.506-.427-1.133-.64-1.88-.64-.906 0-1.68.227-2.32.68-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.827-.48 3V38h-4.96V16.8h4.48Zm26.723 10.6c0-2.24.427-4.187 1.28-5.84.854-1.68 2.067-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.84 0 3.494.413 4.96 1.24 1.467.827 2.64 2.08 3.52 3.76.88 1.653 1.347 3.693 1.4 6.12v1.32h-15.08c.107 1.813.614 3.227 1.52 4.24.907.987 2.134 1.48 3.68 1.48.987 0 1.88-.253 2.68-.76a4.803 4.803 0 0 0 1.84-2.2l5.08.36c-.64 2.027-1.84 3.64-3.6 4.84-1.733 1.173-3.733 1.76-6 1.76-2.08 0-3.906-.453-5.48-1.36-1.573-.907-2.786-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84Zm15.16-2.04c-.213-1.733-.76-3.013-1.64-3.84-.853-.827-1.893-1.24-3.12-1.24-1.44 0-2.6.453-3.48 1.36-.88.88-1.44 2.12-1.68 3.72h9.92ZM163.139 9.6V38h-5.04V9.6h5.04Zm8.322 7.2.24 5.88-.64-.36c.32-2.053 1.094-3.56 2.32-4.52 1.254-.987 2.787-1.48 4.6-1.48 2.32 0 4.107.733 5.36 2.2 1.254 1.44 1.88 3.387 1.88 5.84V38h-4.96V25.92c0-1.253-.12-2.28-.36-3.08-.24-.8-.64-1.413-1.2-1.84-.533-.427-1.253-.64-2.16-.64-1.44 0-2.573.48-3.4 1.44-.8.933-1.2 2.307-1.2 4.12V38h-4.96V16.8h4.48Zm30.003 7.72c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.443 8.16V38h-5.6v-5.32h5.6Z"/><path fill="#171717" fill-rule="evenodd" d="m7.839 40.783 16.03-28.054L20 6 0 40.783h7.839Zm8.214 0H40L27.99 19.894l-4.02 7.032 3.976 6.914H20.02l-3.967 6.943Z" clip-rule="evenodd"/></svg>

# END FILE CONTENTS


# File: app/api/export.py

from fastapi import APIRouter, HTTPException, status
from fastapi.responses import StreamingResponse
from uuid import UUID
import io, zipfile
from app.db.database import get_supabase_client

router = APIRouter(prefix="/api/export", tags=["export"])

def _sec_to_ts(sec: float) -> str:
    h = int(sec // 3600)
    m = int((sec % 3600) // 60)
    s = int(sec % 60)
    return f"[{h:02d}:{m:02d}:{s:02d}]"

@router.get("/{sid}", response_class=StreamingResponse)
async def export_resource(sid: UUID, type: str = "zip"):
    try:
        if type != "zip":
            raise HTTPException(status.HTTP_400_BAD_REQUEST, "unsupported type")

        sb = get_supabase_client()

        # 1. session å¿…é ˆ completed
        session = (
            sb.table("sessions")
            .select("status")
            .eq("id", str(sid))
            .limit(1)
            .execute()
            .data
        )
        if not session:
            raise HTTPException(status.HTTP_404_NOT_FOUND, "session not found")
        if session[0]["status"] != "completed":
            raise HTTPException(status.HTTP_202_ACCEPTED, "session not finished")

        # 2. è®€ noteï¼šæ¬„ä½åç¨±å¯èƒ½æ˜¯ markdown / body / content
        note_row = (
            sb.table("notes")
            .select("content, markdown, body")
            .eq("session_id", str(sid))
            .limit(1)
            .execute()
            .data
        )
        if not note_row:
            raise HTTPException(status.HTTP_404_NOT_FOUND, "note not found")
        note = note_row[0]
        note_md = note.get("content") or note.get("markdown") or note.get("body") or ""

        # 3. é€å­—ç¨¿ï¼šå„ªå…ˆç”¨æœ‰æ™‚é–“æˆ³çš„ segmentsï¼Œæ²’æœ‰å°±é€€å› full_text
        seg_rows = (
            sb.table("transcript_segments")
            .select("text, start_time")
            .eq("session_id", str(sid))
            .order("chunk_sequence")
            .execute()
            .data
        )

        if seg_rows:
            transcript_txt = "\n".join(
                f"{_sec_to_ts(seg.get('start_time', 0))} {seg.get('text', '').strip()}"
                for seg in seg_rows
            )
        else:
            # fallback è®€ transcripts.full_text
            full = (
                sb.table("transcripts")
                .select("full_text")
                .eq("session_id", str(sid))
                .limit(1)
                .execute()
                .data
            )
            transcript_txt = (full[0]["full_text"] if full else "").strip()

        # 4. æ‰“åŒ… ZIP
        buf = io.BytesIO()
        with zipfile.ZipFile(buf, "w", zipfile.ZIP_DEFLATED) as zf:
            zf.writestr("note.md", note_md.strip())
            zf.writestr("transcript.txt", transcript_txt)
        buf.seek(0)

        headers = {
            "Content-Disposition": f'attachment; filename="{sid}.zip"'
        }
        return StreamingResponse(buf, media_type="application/zip", headers=headers)
    except HTTPException as e:
        # FastAPI HTTPException ç›´æ¥ä¸Ÿå‡º
        raise e
    except Exception as e:
        import traceback
        print(f"[EXPORT ERROR] {e}")
        print(traceback.format_exc())
        raise HTTPException(status.HTTP_500_INTERNAL_SERVER_ERROR, detail=f"Export failed: {e}")


# END FILE CONTENTS


# File: .cursor/rules/react.mdc

---
description:
globs: *.js,*.jsx,*.ts,*.tsx
alwaysApply: false
---
<!-- Source: https://github.com/sanjeed5/awesome-cursor-rules-mdc/blob/main/rules-mdc/react.mdc -->

# React Best Practices: A Comprehensive Guide

This document outlines the best practices for developing React applications, covering various aspects from code organization to security and testing. Following these guidelines leads to more maintainable, scalable, and performant applications.

## 1. Code Organization and Structure

### 1.1 Directory Structure

A well-defined directory structure is crucial for maintainability. Here's a recommended structure:


src/
  â”œâ”€â”€ components/
  â”‚   â”œâ”€â”€ Button/
  â”‚   â”‚   â”œâ”€â”€ Button.jsx
  â”‚   â”‚   â”œâ”€â”€ Button.module.css
  â”‚   â”‚   â””â”€â”€ Button.test.jsx
  â”‚   â”œâ”€â”€ Input/
  â”‚   â”‚   â”œâ”€â”€ Input.jsx
  â”‚   â”‚   â”œâ”€â”€ Input.module.css
  â”‚   â”‚   â””â”€â”€ Input.test.jsx
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ contexts/
  â”‚   â”œâ”€â”€ AuthContext.jsx
  â”‚   â””â”€â”€ ThemeContext.jsx
  â”œâ”€â”€ hooks/
  â”‚   â”œâ”€â”€ useAuth.js
  â”‚   â””â”€â”€ useTheme.js
  â”œâ”€â”€ pages/
  â”‚   â”œâ”€â”€ Home.jsx
  â”‚   â”œâ”€â”€ About.jsx
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ services/
  â”‚   â”œâ”€â”€ api.js
  â”‚   â””â”€â”€ auth.js
  â”œâ”€â”€ utils/
  â”‚   â”œâ”€â”€ helpers.js
  â”‚   â””â”€â”€ validators.js
  â”œâ”€â”€ App.jsx
  â”œâ”€â”€ index.jsx
  â””â”€â”€ ...


-   **`components/`**: Reusable UI components.
    -   Each component has its own directory containing the component file, associated styles (using CSS modules), and tests.
-   **`contexts/`**: React context providers.
-   **`hooks/`**: Custom React hooks.
-   **`pages/`**: Top-level components representing different routes or views.
-   **`services/`**: API interaction logic.
-   **`utils/`**: Utility functions.

### 1.2 File Naming Conventions

-   **Components**: Use PascalCase (e.g., `MyComponent.jsx`).
-   **Hooks**: Use camelCase prefixed with `use` (e.g., `useMyHook.js`).
-   **Contexts**: Use PascalCase suffixed with `Context` (e.g., `MyContext.jsx`).
-   **Services/Utils**: Use camelCase (e.g., `apiService.js`, `stringUtils.js`).
-   **CSS Modules**: Use `.module.css` or `.module.scss` (e.g., `Button.module.css`).

### 1.3 Module Organization

-   **Co-location**: Keep related files (component, styles, tests) together in the same directory.
-   **Single Responsibility**: Each module should have a clear and specific purpose.
-   **Avoid Circular Dependencies**: Ensure modules don't depend on each other in a circular manner.

### 1.4 Component Architecture

-   **Atomic Design**: Consider using Atomic Design principles (Atoms, Molecules, Organisms, Templates, Pages) to structure components.
-   **Composition over Inheritance**: Favor component composition to reuse code and functionality.
-   **Presentational and Container Components**: Separate UI rendering (presentational) from state management and logic (container).

### 1.5 Code Splitting Strategies

-   **Route-Based Splitting**: Use `React.lazy` and `Suspense` to load components only when a specific route is accessed.  This is very common and improves initial load time.
-   **Component-Based Splitting**: Split large components into smaller chunks that can be loaded on demand.
-   **Bundle Analyzer**: Use a tool like `webpack-bundle-analyzer` to identify large dependencies and optimize bundle size.

## 2. Common Patterns and Anti-patterns

### 2.1 Design Patterns

-   **Higher-Order Components (HOCs)**: Reusable logic that wraps components (use with caution; prefer hooks).
-   **Render Props**: Sharing code using a prop whose value is a function.
-   **Compound Components**: Components that work together implicitly (e.g., `Tabs`, `Tab`).
-   **Hooks**: Reusable stateful logic that can be shared across functional components.

### 2.2 Recommended Approaches

-   **Form Handling**: Use controlled components with local state or a form library like Formik or React Hook Form.
-   **API Calls**: Use `useEffect` hook to make API calls and manage loading states.
-   **Conditional Rendering**: Use short-circuit evaluation (`&&`) or ternary operators for simple conditions; use separate components for complex scenarios.
-   **List Rendering**: Always provide a unique and stable `key` prop when rendering lists.

### 2.3 Anti-patterns and Code Smells

-   **Direct DOM Manipulation**: Avoid directly manipulating the DOM; let React handle updates.
-   **Mutating State Directly**: Always use `setState` or the state updater function to modify state.
-   **Inline Styles**: Use CSS modules or styled-components for maintainable styles.
-   **Over-Engineering**: Avoid using complex solutions for simple problems.
-   **Prop Drilling**: Passing props through multiple levels of components without them being used.

### 2.4 State Management Best Practices

-   **Local State**: Use `useState` for component-specific state.
-   **Context API**: Use `useContext` for global state accessible to many components, but avoid for very frequently updated data.
-   **Redux/Mobx**: Use these libraries for complex state management in large applications.
-   **Recoil/Zustand**: Lightweight alternatives to Redux, often easier to set up and use.
-   **Immutable Data**: Treat state as immutable to prevent unexpected side effects.

### 2.5 Error Handling Patterns

-   **Error Boundaries**: Wrap components with error boundaries to catch errors during rendering and prevent crashes.
-   **Try-Catch Blocks**: Use try-catch blocks for handling errors in asynchronous operations and event handlers.
-   **Centralized Error Logging**: Implement a centralized error logging service to track errors and improve application stability.

## 3. Performance Considerations

### 3.1 Optimization Techniques

-   **Memoization**: Use `React.memo`, `useMemo`, and `useCallback` to prevent unnecessary re-renders and recalculations.
-   **Virtualization**: Use libraries like `react-window` or `react-virtualized` to efficiently render large lists or tables.
-   **Debouncing/Throttling**: Limit the rate at which functions are executed (e.g., in input fields).
-   **Code Splitting**: Load code on demand using `React.lazy` and `Suspense`.

### 3.2 Memory Management

-   **Avoid Memory Leaks**: Clean up event listeners, timers, and subscriptions in `useEffect`'s cleanup function.
-   **Release Unused Objects**: Avoid holding onto large objects in memory when they are no longer needed.
-   **Garbage Collection**: Understand how JavaScript's garbage collection works and avoid creating unnecessary objects.

### 3.3 Rendering Optimization

-   **Minimize State Updates**: Avoid unnecessary state updates that trigger re-renders.
-   **Batch Updates**: Batch multiple state updates into a single update using `ReactDOM.unstable_batchedUpdates`.
-   **Keys**: Ensure that keys are unique and consistent across renders.

### 3.4 Bundle Size Optimization

-   **Tree Shaking**: Remove unused code during the build process.
-   **Minification**: Reduce the size of JavaScript and CSS files.
-   **Image Optimization**: Compress and optimize images to reduce file size.
-   **Dependency Analysis**: Use tools like `webpack-bundle-analyzer` to identify large dependencies.

### 3.5 Lazy Loading Strategies

-   **Route-Based Lazy Loading**: Load components when a user navigates to a specific route.
-   **Component-Based Lazy Loading**: Load components when they are about to be rendered.
-   **Intersection Observer**: Load components when they become visible in the viewport.

## 4. Security Best Practices

### 4.1 Common Vulnerabilities and Prevention

-   **Cross-Site Scripting (XSS)**: Sanitize user input to prevent malicious code injection.
-   **Cross-Site Request Forgery (CSRF)**: Use anti-CSRF tokens to protect against unauthorized requests.
-   **Denial of Service (DoS)**: Implement rate limiting and request validation to prevent abuse.
-   **Injection Attacks**: Avoid directly embedding user input into database queries or system commands.

### 4.2 Input Validation

-   **Client-Side Validation**: Validate user input in the browser to provide immediate feedback.
-   **Server-Side Validation**: Always validate user input on the server to prevent malicious data.
-   **Sanitize Input**: Sanitize user input to remove potentially harmful characters or code.

### 4.3 Authentication and Authorization

-   **Secure Authentication**: Use secure authentication mechanisms like OAuth 2.0 or JWT.
-   **Role-Based Access Control (RBAC)**: Implement RBAC to control access to resources based on user roles.
-   **Multi-Factor Authentication (MFA)**: Enable MFA to add an extra layer of security.

### 4.4 Data Protection Strategies

-   **Encryption**: Encrypt sensitive data at rest and in transit.
-   **Data Masking**: Mask sensitive data in logs and UI displays.
-   **Regular Backups**: Create regular backups of application data.

### 4.5 Secure API Communication

-   **HTTPS**: Use HTTPS to encrypt communication between the client and the server.
-   **API Keys**: Protect API keys and secrets.
-   **CORS**: Configure Cross-Origin Resource Sharing (CORS) to prevent unauthorized access to APIs.

## 5. Testing Approaches

### 5.1 Unit Testing

-   **Test Components**: Test individual components in isolation.
-   **Testing Library**: Use React Testing Library for UI testing, focusing on user behavior.
-   **Jest**: Use Jest as the test runner.

### 5.2 Integration Testing

-   **Test Component Interactions**: Test how components interact with each other.
-   **Mock API Calls**: Mock API calls to test component behavior in different scenarios.
-   **React Testing Library**: Effective for testing integration points in components.

### 5.3 End-to-End (E2E) Testing

-   **Test Full Application Flows**: Test complete user flows, such as login, registration, and checkout.
-   **Cypress/Playwright**: Use tools like Cypress or Playwright for E2E testing.
-   **Automated Browser Tests**: Automate browser tests to ensure application stability.

### 5.4 Test Organization

-   **Co-locate Tests**: Keep test files close to the components they test (e.g., `Button.test.jsx` in the `Button` directory).
-   **Descriptive Names**: Use descriptive names for test files and test cases.
-   **Test Suites**: Organize tests into logical suites.

### 5.5 Mocking and Stubbing

-   **Mock Modules**: Mock external modules or API calls to isolate components during testing.
-   **Stub Functions**: Stub function implementations to control component behavior.
-   **Jest Mocks**: Utilize Jest's mocking capabilities for effective unit testing.

## 6. Common Pitfalls and Gotchas

### 6.1 Frequent Mistakes

-   **Ignoring Keys in Lists**: Forgetting to provide unique and stable `key` props when rendering lists.
-   **Incorrect State Updates**: Mutating state directly instead of using `setState` or the state updater function.
-   **Missing Dependencies in `useEffect`**: Not including all dependencies in the dependency array of the `useEffect` hook.
-   **Over-Using State**: Storing derived data in state instead of calculating it on demand.

### 6.2 Edge Cases

-   **Asynchronous State Updates**: Handling state updates in asynchronous operations.
-   **Race Conditions**: Preventing race conditions when making multiple API calls.
-   **Handling Errors in Event Handlers**: Properly handling errors in event handlers to prevent crashes.

### 6.3 Version-Specific Issues

-   **React 16 vs. React 17/18**: Understanding differences in lifecycle methods, error handling, and concurrent mode.
-   **Deprecated Features**: Being aware of deprecated features and using recommended alternatives.

### 6.4 Compatibility Concerns

-   **Browser Compatibility**: Ensuring compatibility with different browsers and devices.
-   **Library Compatibility**: Ensuring compatibility between React and other libraries.

### 6.5 Debugging Strategies

-   **React DevTools**: Use React DevTools to inspect component hierarchies, props, and state.
-   **Console Logging**: Use console logging to debug code and track variables.
-   **Breakpoints**: Set breakpoints in the code to step through execution and inspect variables.

## 7. Tooling and Environment

### 7.1 Recommended Development Tools

-   **VS Code**: A popular code editor with excellent React support.
-   **Create React App**: A tool for quickly setting up a new React project.
-   **React DevTools**: A browser extension for inspecting React components.
-   **ESLint**: A linter for enforcing code style and preventing errors.
-   **Prettier**: A code formatter for automatically formatting code.

### 7.2 Build Configuration

-   **Webpack/Vite**: Configure Webpack or Vite to bundle and optimize code.
-   **Babel**: Configure Babel to transpile JavaScript code to older versions.
-   **Environment Variables**: Use environment variables to configure different environments.

### 7.3 Linting and Formatting

-   **ESLint**: Configure ESLint with recommended React rules.
-   **Prettier**: Configure Prettier to automatically format code.
-   **Husky/lint-staged**: Use Husky and lint-staged to run linters and formatters before committing code.

### 7.4 Deployment Best Practices

-   **Static Hosting**: Host static assets on a CDN.
-   **Server-Side Rendering (SSR)**: Use SSR to improve SEO and initial load time.
-   **Continuous Deployment**: Automate the deployment process using CI/CD.

### 7.5 CI/CD Integration

-   **GitHub Actions/GitLab CI**: Use GitHub Actions or GitLab CI to automate testing, linting, and deployment.
-   **Automated Testing**: Run automated tests on every commit or pull request.
-   **Automated Deployment**: Automatically deploy code to production after successful tests.

By following these best practices, React developers can build high-quality, maintainable, and scalable applications that meet the demands of modern web development. Continual education and adaptation to emerging trends in the React ecosystem are crucial for sustained success.


# END FILE CONTENTS


# File: frontend/lib/advanced-audio-recorder.ts

"use client"

import { getAudioChunkIntervalMs } from './config'

/**
 * AdvancedAudioRecorder - é€²éšåˆ†æ®µéŸ³è¨ŠéŒ„è£½å™¨
 *
 * Phase 2.5 WebM Header ä¿®å¾©ï¼šå¯¦ä½œç„¡ç¸« MediaRecorder åˆ‡æ›ç­–ç•¥
 * è§£æ±º MediaRecorder.start(timeslice) åªåœ¨ç¬¬ä¸€å€‹æ®µè½åŒ…å«å®Œæ•´ container header çš„å•é¡Œ
 *
 * æ ¸å¿ƒç­–ç•¥ï¼š
 * - å¯é…ç½®æ™‚é–“é‡æ–°å‰µå»º MediaRecorder å¯¦ä¾‹
 * - ä½¿ç”¨é å»ºç­–ç•¥ï¼šæå‰å‰µå»ºä¸‹ä¸€å€‹ MediaRecorderï¼Œé¿å…å»ºç«‹å»¶é²
 * - ç„¡ç¸«è§’è‰²è½‰æ›ï¼šstopâ†’start é–“éš™ â‰ˆ 1-3ms
 * - ç¢ºä¿æ¯å€‹æ®µè½éƒ½åŒ…å«å®Œæ•´ WebM EBML header
 * - æ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®åˆ‡ç‰‡æ™‚é–“
 */

export interface AudioSegment {
    blob: Blob
    timestamp: number
    duration: number
    sequence: number
}

export interface AdvancedAudioRecorderConfig {
    segmentDuration: number // æ®µè½æ™‚é•·ï¼ˆæ¯«ç§’ï¼‰
    mimeType: string
    audioBitsPerSecond: number
}

const DEFAULT_CONFIG: AdvancedAudioRecorderConfig = {
    segmentDuration: getAudioChunkIntervalMs(), // å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
    mimeType: 'audio/webm;codecs=opus',
    audioBitsPerSecond: 128000, // 128 kbps for configurable chunks
}

export class AdvancedAudioRecorder {
    private stream: MediaStream | null = null
    private config: AdvancedAudioRecorderConfig
    private isRecording: boolean = false
    private sequence: number = 0

    // é›™ MediaRecorder ç­–ç•¥
    private currentRecorder: MediaRecorder | null = null
    private nextRecorder: MediaRecorder | null = null
    private swapTimer: ReturnType<typeof setTimeout> | null = null

    // äº‹ä»¶å›èª¿
    private onSegmentCallback?: (segment: AudioSegment) => void
    private onErrorCallback?: (error: Error) => void

    constructor(config: Partial<AdvancedAudioRecorderConfig> = {}) {
        this.config = { ...DEFAULT_CONFIG, ...config }
    }

    /**
     * åˆå§‹åŒ–éŒ„éŸ³å™¨ - ç²å–éŸ³è¨Šæ¬Šé™
     */
    async initialize(): Promise<void> {
        if (this.stream) {
            return // å·²åˆå§‹åŒ–
        }

        try {
            this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })
            console.log('ğŸ¤ [AdvancedAudioRecorder] éŸ³è¨Šæ¬Šé™ç²å–æˆåŠŸ')
        } catch (error) {
            const errorMsg = error instanceof Error ? error.message : 'ç²å–éŸ³è¨Šæ¬Šé™å¤±æ•—'
            this.handleError(new Error(errorMsg))
            throw error
        }
    }

    /**
     * é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨é›™ MediaRecorder ç„¡ç¸«åˆ‡æ›ç­–ç•¥
     */
    async start(onSegmentAvailable: (segment: AudioSegment) => void): Promise<void> {
        if (this.isRecording) {
            throw new Error('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
        }

        if (!this.stream) {
            await this.initialize()
        }

        this.onSegmentCallback = onSegmentAvailable
        this.sequence = 0
        this.isRecording = true

        console.log('ğŸ¬ [AdvancedAudioRecorder] é–‹å§‹é€²éšéŒ„éŸ³', {
            segmentDuration: this.config.segmentDuration,
            mimeType: this.config.mimeType,
            audioBitsPerSecond: this.config.audioBitsPerSecond
        })

        // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦
        if (!this.checkMediaRecorderSupport()) {
            throw new Error('ç€è¦½å™¨ä¸æ”¯æ´æ‰€éœ€çš„éŸ³é »éŒ„è£½åŠŸèƒ½')
        }

        try {
            // å•Ÿå‹•é›™ MediaRecorder ç­–ç•¥
            await this.initializeRecorders()
            this.startCurrentRecorder()
            this.scheduleNextSwap()

            console.log('âœ… [AdvancedAudioRecorder] é›™ MediaRecorder ç­–ç•¥å•Ÿå‹•æˆåŠŸ')
        } catch (error) {
            this.isRecording = false
            this.handleError(error instanceof Error ? error : new Error('å•Ÿå‹•éŒ„éŸ³å¤±æ•—'))
            throw error
        }
    }

    /**
     * åœæ­¢éŒ„éŸ³
     */
    stop(): void {
        console.log('â¹ï¸ [AdvancedAudioRecorder] åœæ­¢é€²éšéŒ„éŸ³')

        this.isRecording = false

        // æ¸…é™¤åˆ‡æ›è¨ˆæ™‚å™¨
        if (this.swapTimer) {
            clearTimeout(this.swapTimer)
            this.swapTimer = null
        }

        // åœæ­¢ç•¶å‰éŒ„éŸ³å™¨
        if (this.currentRecorder && this.currentRecorder.state !== 'inactive') {
            this.currentRecorder.stop()
        }

        // æ¸…ç†ä¸‹ä¸€å€‹éŒ„éŸ³å™¨
        this.cleanupRecorder(this.nextRecorder)
        this.nextRecorder = null
    }

    /**
     * æ¸…ç†è³‡æº
     */
    cleanup(): void {
        this.stop()

        if (this.stream) {
            this.stream.getTracks().forEach(track => track.stop())
            this.stream = null
        }

        this.cleanupRecorder(this.currentRecorder)
        this.cleanupRecorder(this.nextRecorder)
        this.currentRecorder = null
        this.nextRecorder = null
        this.sequence = 0

        console.log('ğŸ§¹ [AdvancedAudioRecorder] å·²æ¸…ç†')
    }

    /**
     * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
     */
    get recording(): boolean {
        return this.isRecording
    }

    /**
     * ç²å–ç•¶å‰åºè™Ÿ
     */
    get currentSequence(): number {
        return this.sequence
    }

    /**
     * é‡ç½®åºè™Ÿ
     */
    resetSequence(): void {
        this.sequence = 0
        console.log('ğŸ”„ [AdvancedAudioRecorder] åºè™Ÿå·²é‡ç½®ç‚º 0')
    }

    /**
     * ç²å–ç•¶å‰é…ç½®
     */
    get currentConfig(): AdvancedAudioRecorderConfig {
        return { ...this.config }
    }

    // ============ ç§æœ‰æ–¹æ³• ============

    /**
     * æª¢æŸ¥ MediaRecorder æ”¯æ´åº¦
     */
    private checkMediaRecorderSupport(): boolean {
        if (!window.MediaRecorder) {
            this.handleError(new Error('ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API'))
            return false
        }

        if (!MediaRecorder.isTypeSupported(this.config.mimeType)) {
            this.handleError(new Error(`ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${this.config.mimeType}`))
            return false
        }

        return true
    }

    /**
     * åˆå§‹åŒ–é›™ MediaRecorder
     */
    private async initializeRecorders(): Promise<void> {
        try {
            this.currentRecorder = this.createMediaRecorder()
            this.nextRecorder = this.createMediaRecorder()
            console.log('ğŸ”„ [AdvancedAudioRecorder] é›™ MediaRecorder åˆå§‹åŒ–å®Œæˆ')
        } catch (error) {
            throw new Error(`MediaRecorder åˆå§‹åŒ–å¤±æ•—: ${error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'}`)
        }
    }

    /**
     * å‰µå»º MediaRecorder å¯¦ä¾‹
     */
    private createMediaRecorder(): MediaRecorder {
        if (!this.stream) {
            throw new Error('éŸ³è¨Šæµæœªåˆå§‹åŒ–')
        }

        const recorder = new MediaRecorder(this.stream, {
            mimeType: this.config.mimeType,
            audioBitsPerSecond: this.config.audioBitsPerSecond,
        })

        // è¨­å®šäº‹ä»¶è™•ç†
        recorder.ondataavailable = (event) => {
            if (event.data.size > 0 && this.isRecording) {
                console.log(`ğŸ“¦ [AdvancedAudioRecorder] æ®µè½ #${this.sequence} å®Œæˆ`, {
                    size: event.data.size,
                    mimeType: this.config.mimeType,
                    hasCompleteHeader: true // æ¯å€‹æ®µè½éƒ½æœ‰å®Œæ•´æª”é ­
                })

                const segment: AudioSegment = {
                    blob: event.data,
                    timestamp: Date.now(),
                    duration: this.config.segmentDuration,
                    sequence: this.sequence++,
                }

                // å›èª¿é€šçŸ¥æœ‰æ–°æ®µè½å¯ç”¨
                this.onSegmentCallback?.(segment)
            }
        }

        recorder.onerror = (event) => {
            console.error('âŒ [AdvancedAudioRecorder] MediaRecorder éŒ¯èª¤:', event)
            this.handleError(new Error(`MediaRecorder éŒ¯èª¤: ${event}`))
        }

        return recorder
    }

    /**
     * å•Ÿå‹•ç•¶å‰éŒ„éŸ³å™¨
     */
    private startCurrentRecorder(): void {
        if (!this.currentRecorder) {
            throw new Error('ç•¶å‰éŒ„éŸ³å™¨æœªåˆå§‹åŒ–')
        }

        console.log(`ğŸµ [AdvancedAudioRecorder] é–‹å§‹éŒ„éŸ³æ®µè½ #${this.sequence}`)
        this.currentRecorder.start() // ä¸ä½¿ç”¨ timesliceï¼Œè®“ stop() è§¸ç™¼å®Œæ•´æ®µè½
    }

    /**
     * æ’ç¨‹ä¸‹ä¸€æ¬¡åˆ‡æ›
     */
    private scheduleNextSwap(): void {
        if (!this.isRecording) return

        this.swapTimer = setTimeout(() => {
            if (this.isRecording) {
                this.swapRecorders()
            }
        }, this.config.segmentDuration)
    }

    /**
     * åŸ·è¡Œ MediaRecorder è§’è‰²è½‰æ›
     */
    private swapRecorders(): void {
        try {
            console.log('ğŸ”„ [AdvancedAudioRecorder] åŸ·è¡Œ MediaRecorder åˆ‡æ›')

            // æ­¥é©Ÿ 1: åœæ­¢ç•¶å‰éŒ„éŸ³å™¨ï¼ˆè§¸ç™¼ dataavailableï¼‰
            if (this.currentRecorder && this.currentRecorder.state === 'recording') {
                this.currentRecorder.stop()
            }

            // æ­¥é©Ÿ 2: å•Ÿå‹•å‚™ç”¨éŒ„éŸ³å™¨
            if (this.nextRecorder) {
                this.nextRecorder.start()
                console.log(`ğŸµ [AdvancedAudioRecorder] åˆ‡æ›åˆ°æ®µè½ #${this.sequence}`)
            }

            // æ­¥é©Ÿ 3: è§’è‰²è½‰æ›
            const oldRecorder = this.currentRecorder
            this.currentRecorder = this.nextRecorder

            // æ­¥é©Ÿ 4: æº–å‚™ä¸‹ä¸€å€‹éŒ„éŸ³å™¨
            try {
                this.nextRecorder = this.createMediaRecorder()
            } catch (error) {
                console.error('âŒ [AdvancedAudioRecorder] å‰µå»ºä¸‹ä¸€å€‹éŒ„éŸ³å™¨å¤±æ•—:', error)
                this.handleError(error instanceof Error ? error : new Error('å‰µå»ºéŒ„éŸ³å™¨å¤±æ•—'))
                return
            }

            // æ­¥é©Ÿ 5: æ¸…ç†èˆŠéŒ„éŸ³å™¨
            this.cleanupRecorder(oldRecorder)

            // æ­¥é©Ÿ 6: æ’ç¨‹ä¸‹ä¸€æ¬¡åˆ‡æ›
            if (this.isRecording) {
                this.scheduleNextSwap()
            }

        } catch (error) {
            console.error('âŒ [AdvancedAudioRecorder] åˆ‡æ›éŒ„éŸ³å™¨å¤±æ•—:', error)
            this.handleError(error instanceof Error ? error : new Error('åˆ‡æ›éŒ„éŸ³å™¨å¤±æ•—'))
        }
    }

    /**
     * æ¸…ç† MediaRecorder
     */
    private cleanupRecorder(recorder: MediaRecorder | null): void {
        if (!recorder) return

        try {
            if (recorder.state !== 'inactive') {
                recorder.stop()
            }
        } catch (error) {
            console.warn('âš ï¸ [AdvancedAudioRecorder] æ¸…ç†éŒ„éŸ³å™¨æ™‚ç™¼ç”Ÿè­¦å‘Š:', error)
        }
    }

    /**
     * éŒ¯èª¤è™•ç†
     */
    private handleError(error: Error): void {
        console.error('âŒ [AdvancedAudioRecorder] éŒ¯èª¤:', error)
        this.isRecording = false
        this.onErrorCallback?.(error)
    }

    // ============ äº‹ä»¶å›èª¿è¨­å®š ============

    onSegment(callback: (segment: AudioSegment) => void): void {
        this.onSegmentCallback = callback
    }

    onError(callback: (error: Error) => void): void {
        this.onErrorCallback = callback
    }
}

/**
 * æª¢æŸ¥é€²éšéŸ³è¨ŠéŒ„è£½æ”¯æ´
 */
export async function checkAdvancedAudioRecordingSupport(): Promise<{ isSupported: boolean; error?: string }> {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API' }
    }

    if (!window.MediaRecorder) {
        return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API' }
    }

    // æª¢æŸ¥ MIME é¡å‹æ”¯æ´
    if (!MediaRecorder.isTypeSupported(DEFAULT_CONFIG.mimeType)) {
        return { isSupported: false, error: `ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${DEFAULT_CONFIG.mimeType}` }
    }

    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
        // ç«‹å³åœæ­¢ä¸²æµä»¥é‡‹æ”¾è³‡æº
        stream.getTracks().forEach(track => track.stop())
        return { isSupported: true }
    } catch (error) {
        return { isSupported: false, error: `ç„¡æ³•ç²å–éº¥å…‹é¢¨æ¬Šé™: ${error}` }
    }
}


# END FILE CONTENTS


# File: frontend/lib/services/interfaces.ts

"use client"

import type { SessionResponse, STTProvider } from '../api'
import type { BaseService } from './base-service'

/**
 * æœå‹™å±¤ä»‹é¢å®šç¾©
 *
 * æä¾›çµ±ä¸€çš„æœå‹™å¥‘ç´„ï¼Œç¢ºä¿é¡å‹å®‰å…¨å’Œä¸€è‡´æ€§
 */

/**
 * éŒ„éŸ³æµç¨‹å•Ÿå‹•çµæœ
 *
 * RecordingFlowService.startRecordingFlow() çš„è¿”å›é¡å‹
 * æˆåŠŸæ™‚ç›´æ¥è¿”å› SessionResponseï¼Œå¤±æ•—æ™‚æ‹‹å‡º Error
 */
export type StartRecordingResult = SessionResponse

/**
 * æœƒè©±ç®¡ç†æœå‹™ä»‹é¢
 */
export interface ISessionService {
  /**
   * ç¢ºä¿éŒ„éŸ³æœƒè©±å­˜åœ¨ - å„ªé›…è™•ç†æœƒè©±è¡çª
   *
   * ç­–ç•¥ï¼š
   * 1. å„ªå…ˆå˜—è©¦å‰µå»ºæ–°çš„éŒ„éŸ³æœƒè©±
   * 2. è‹¥é‡åˆ° 409 è¡çªï¼Œæ”¹ç‚ºç²å–ç¾æœ‰æ´»èºæœƒè©±
   * 3. ç¢ºä¿è¿”å›å¯ç”¨çš„éŒ„éŸ³æœƒè©±
   */
  ensureRecordingSession(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse>

  /**
   * å‰µå»ºéŒ„éŸ³æœƒè©±
   */
  createRecordingSession(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse>

  /**
   * å‰µå»ºç´”ç­†è¨˜æœƒè©±
   */
  createNoteSession(title?: string, content?: string): Promise<SessionResponse>

  /**
   * å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼
   */
  upgradeToRecording(sessionId: string): Promise<SessionResponse>

  /**
   * å®Œæˆæœƒè©±
   */
  finishSession(sessionId: string): Promise<void>

  /**
   * æª¢æŸ¥æ´»èºæœƒè©±
   */
  checkActiveSession(): Promise<SessionResponse | null>

  /**
   * ç­‰å¾…æœƒè©±åœ¨è³‡æ–™åº«ä¸­å®Œå…¨å¯è¦‹
   */
  waitForSessionReady(sessionId: string, maxWaitTime?: number): Promise<boolean>

  /**
   * åˆªé™¤æœƒè©±
   */
  deleteSession(sessionId: string): Promise<void>
}

/**
 * éŒ„éŸ³ç‹€æ…‹
 */
export interface RecordingState {
  isRecording: boolean
  recordingTime: number
  currentSessionId: string | null
  error: string | null
}

/**
 * éŒ„éŸ³æœå‹™ä»‹é¢
 */
export interface IRecordingService extends BaseService {
  /**
   * é–‹å§‹éŒ„éŸ³
   */
  startRecording(sessionId: string): Promise<void>

  /**
   * åœæ­¢éŒ„éŸ³
   */
  stopRecording(): Promise<void>

  /**
   * å–å¾—ç•¶å‰éŒ„éŸ³ç‹€æ…‹
   */
  getRecordingState(): RecordingState

  /**
   * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
   */
  isRecording(): boolean

  /**
   * å–å¾—éŒ„éŸ³æ™‚é–“ï¼ˆç§’ï¼‰
   */
  getRecordingTime(): number

  /**
   * è«‹æ±‚éŒ„éŸ³æ¬Šé™
   */
  requestPermission(): Promise<boolean>
}

/**
 * é€å­—ç¨¿è¨Šæ¯é¡å‹
 */
export interface TranscriptMessage {
  type: string
  text?: string
  start_time?: number
  end_time?: number
  chunk_sequence?: number
  start_sequence?: number
  confidence?: number
  timestamp?: number
  phase?: string
  message?: string
  error_type?: string
  error_message?: string
  details?: any
}

/**
 * é€å­—ç¨¿é …ç›®
 */
export interface TranscriptEntry {
  startTime?: number
  time: string
  text: string
}

/**
 * é€å­—ç¨¿æœå‹™ä»‹é¢
 */
export interface ITranscriptService {
  /**
   * é€£æ¥é€å­—ç¨¿æœå‹™
   */
  connect(sessionId: string): Promise<void>

  /**
   * æ–·é–‹é€å­—ç¨¿æœå‹™
   */
  disconnect(sessionId?: string): Promise<void>

  /**
   * æ·»åŠ é€å­—ç¨¿ç›£è½å™¨
   */
  addTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void

  /**
   * ç§»é™¤é€å­—ç¨¿ç›£è½å™¨
   */
  removeTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void

  /**
   * æª¢æŸ¥é€£æ¥ç‹€æ…‹
   */
  isConnected(sessionId: string): boolean

  /**
   * æ¸…é™¤é€å­—ç¨¿
   */
  clearTranscripts(sessionId: string): void

  /**
   * é–‹å§‹éŒ„éŸ³
   */
  start(sessionId: string): Promise<void>
}

/**
 * æœå‹™å®¹å™¨ä»‹é¢
 */
export interface IServiceContainer {
  /**
   * è¨»å†Šæœå‹™
   */
  register<T>(key: string, factory: () => T): void

  /**
   * è¨»å†Šå–®ä¾‹æœå‹™
   */
  registerSingleton<T>(key: string, factory: () => T): void

  /**
   * è§£ææœå‹™
   */
  resolve<T>(key: string): T

  /**
   * æª¢æŸ¥æœå‹™æ˜¯å¦å·²è¨»å†Š
   */
  isRegistered(key: string): boolean

  /**
   * å–å¾—å·²è¨»å†Šçš„æœå‹™æ¸…å–®
   */
  getRegisteredServices(): string[]
}

/**
 * æœå‹™è¨»å†Šéµå€¼å¸¸æ•¸
 * é¿å…å­—ä¸²æ‹¼å¯«éŒ¯èª¤ï¼Œæä¾›é¡å‹å®‰å…¨çš„æœå‹™éµå€¼
 */
export const SERVICE_KEYS = {
  SESSION_SERVICE: 'SessionService',
  RECORDING_SERVICE: 'RecordingService',
  TRANSCRIPT_SERVICE: 'TranscriptService',
  RECORDING_FLOW_SERVICE: 'RecordingFlowService'
} as const

/**
 * æœå‹™éµå€¼é¡å‹
 */
export type ServiceKey = typeof SERVICE_KEYS[keyof typeof SERVICE_KEYS]

/**
 * åŒ¯å‡ºæœå‹™é¡å‹æ˜ å°„
 * æä¾›ç·¨è­¯æ™‚é¡å‹æª¢æŸ¥
 */
export interface ServiceTypeMap {
  [SERVICE_KEYS.SESSION_SERVICE]: ISessionService
  [SERVICE_KEYS.RECORDING_SERVICE]: IRecordingService
  [SERVICE_KEYS.TRANSCRIPT_SERVICE]: ITranscriptService
}


# END FILE CONTENTS


# File: app/services/transcript_feed.py

"""
é€å­—ç¨¿ WebSocket å»£æ’­æœå‹™ (ç°¡åŒ–ç‰ˆ InMemoryHub)

ç¶­æŒ sid â†’ set[WebSocket] æ˜ å°„ï¼Œæ”¯æ´å¤šå€‹å®¢æˆ¶ç«¯é€£æ¥
"""

import logging
import json
from typing import Dict, Set
from fastapi import WebSocket

logger = logging.getLogger(__name__)


class TranscriptHub:
    """
    é€å­—ç¨¿ WebSocket å»£æ’­ä¸­å¿ƒ (InMemoryHub æ¨¡å¼)

    åŠŸèƒ½ï¼š
    - ç®¡ç†æœƒè©± ID å°æ‡‰çš„ WebSocket é€£æ¥æ± 
    - æ”¯æ´ä¸€å°å¤šå»£æ’­
    - è‡ªå‹•æ¸…ç†æ–·é–‹çš„é€£æ¥
    """

    def __init__(self):
        """åˆå§‹åŒ–å»£æ’­ä¸­å¿ƒ"""
        self._subscribers: Dict[str, Set[WebSocket]] = {}
        logger.info("ğŸ”Œ TranscriptHub åˆå§‹åŒ–å®Œæˆ")

    async def subscribe(self, session_id: str, websocket: WebSocket):
        """
        è¨‚é–±æœƒè©±çš„è½‰éŒ„æ¨é€

        Args:
            session_id: æœƒè©± ID
            websocket: WebSocket é€£æ¥
        """
        if session_id not in self._subscribers:
            self._subscribers[session_id] = set()

        self._subscribers[session_id].add(websocket)
        logger.info(f"ğŸ“± æ–°è¨‚é–±è€…åŠ å…¥æœƒè©± {session_id} (ç›®å‰è¨‚é–±è€…: {len(self._subscribers[session_id])})")

    async def unsubscribe(self, session_id: str, websocket: WebSocket):
        """
        å–æ¶ˆè¨‚é–±

        Args:
            session_id: æœƒè©± ID
            websocket: WebSocket é€£æ¥
        """
        if session_id in self._subscribers:
            self._subscribers[session_id].discard(websocket)

            # å¦‚æœæ²’æœ‰è¨‚é–±è€…äº†ï¼Œæ¸…ç†æœƒè©±è¨˜éŒ„
            if not self._subscribers[session_id]:
                del self._subscribers[session_id]
                logger.info(f"ğŸ—‘ï¸ æœƒè©± {session_id} ç„¡è¨‚é–±è€…ï¼Œå·²æ¸…ç†")
            else:
                logger.info(f"ğŸ“± è¨‚é–±è€…é›¢é–‹æœƒè©± {session_id} (å‰©é¤˜è¨‚é–±è€…: {len(self._subscribers[session_id])})")

    async def broadcast(self, session_id: str, message: dict):
        """
        å»£æ’­è¨Šæ¯åˆ°æŒ‡å®šæœƒè©±çš„æ‰€æœ‰è¨‚é–±è€…

        Args:
            session_id: æœƒè©± ID
            message: è¦å»£æ’­çš„è¨Šæ¯å­—å…¸
        """
        if session_id not in self._subscribers:
            logger.debug(f"ğŸ“¡ æœƒè©± {session_id} ç„¡è¨‚é–±è€…ï¼Œè·³éå»£æ’­")
            return

        # ç²å–è¨‚é–±è€…å‰¯æœ¬ï¼Œé¿å…è¿­ä»£æ™‚ä¿®æ”¹
        subscribers = self._subscribers[session_id].copy()
        successful_broadcasts = 0
        failed_connections = set()

        for websocket in subscribers:
            try:
                await websocket.send_json(message)
                successful_broadcasts += 1
            except Exception as e:
                logger.warning(f"âš ï¸ å»£æ’­å¤±æ•—ï¼ŒWebSocket é€£æ¥ç•°å¸¸: {e}")
                failed_connections.add(websocket)

        # æ¸…ç†å¤±æ•—çš„é€£æ¥
        if failed_connections:
            for failed_ws in failed_connections:
                await self.unsubscribe(session_id, failed_ws)

            logger.info(f"ğŸ—‘ï¸ å·²æ¸…ç† {len(failed_connections)} å€‹ç•°å¸¸é€£æ¥")

        if successful_broadcasts > 0:
            logger.debug(f"ğŸ“¡ æˆåŠŸå»£æ’­åˆ°æœƒè©± {session_id} ({successful_broadcasts} å€‹è¨‚é–±è€…)")

    async def broadcast_error(self, session_id: str, error_type: str, message: str, seq: int = None):
        """
        å»£æ’­éŒ¯èª¤è¨Šæ¯

        Args:
            session_id: æœƒè©± ID
            error_type: éŒ¯èª¤é¡å‹
            message: éŒ¯èª¤è¨Šæ¯
            seq: åˆ‡ç‰‡åºè™Ÿï¼ˆå¯é¸ï¼‰
        """
        error_message = {
            "type": "error",
            "error_type": error_type,
            "message": message,
            "session_id": session_id,
            "timestamp": self._get_timestamp()
        }

        if seq is not None:
            error_message["seq"] = seq

        await self.broadcast(session_id, error_message)
        logger.error(f"âŒ å»£æ’­éŒ¯èª¤åˆ°æœƒè©± {session_id}: {error_type} - {message}")

    async def broadcast_transcript_segment(self, session_id: str, seq: int, text: str, start_time: float = None, end_time: float = None, confidence: float = None):
        """
        å»£æ’­è½‰éŒ„ç‰‡æ®µ

        Args:
            session_id: æœƒè©± ID
            seq: åˆ‡ç‰‡åºè™Ÿ
            text: è½‰éŒ„æ–‡å­—
            start_time: é–‹å§‹æ™‚é–“ï¼ˆç§’ï¼‰
            end_time: çµæŸæ™‚é–“ï¼ˆç§’ï¼‰
            confidence: ä¿¡å¿ƒåº¦
        """
        transcript_message = {
            "type": "transcript_segment",
            "session_id": session_id,
            "seq": seq,
            "text": text,
            "timestamp": self._get_timestamp()
        }

        if start_time is not None:
            transcript_message["start_time"] = start_time

        if end_time is not None:
            transcript_message["end_time"] = end_time

        if confidence is not None:
            transcript_message["confidence"] = confidence

        await self.broadcast(session_id, transcript_message)
        logger.info(f"ğŸ“ å»£æ’­è½‰éŒ„ç‰‡æ®µåˆ°æœƒè©± {session_id} seq={seq}: '{text[:50]}{'...' if len(text) > 50 else ''}'")

    async def broadcast_phase(self, session_id: str, phase: str):
        """
        å»£æ’­éšæ®µè®Šæ›´

        Args:
            session_id: æœƒè©± ID
            phase: éšæ®µåç¨± (waiting, active, processing, completed)
        """
        phase_message = {
            "type": "phase",
            "phase": phase,
            "session_id": session_id,
            "timestamp": self._get_timestamp()
        }

        await self.broadcast(session_id, phase_message)
        logger.info(f"ğŸ”„ å»£æ’­éšæ®µè®Šæ›´åˆ°æœƒè©± {session_id}: {phase}")

    def get_subscriber_count(self, session_id: str) -> int:
        """
        ç²å–æŒ‡å®šæœƒè©±çš„è¨‚é–±è€…æ•¸é‡

        Args:
            session_id: æœƒè©± ID

        Returns:
            int: è¨‚é–±è€…æ•¸é‡
        """
        return len(self._subscribers.get(session_id, set()))

    def get_total_subscribers(self) -> int:
        """
        ç²å–ç¸½è¨‚é–±è€…æ•¸é‡

        Returns:
            int: ç¸½è¨‚é–±è€…æ•¸é‡
        """
        return sum(len(subscribers) for subscribers in self._subscribers.values())

    def get_active_sessions(self) -> list:
        """
        ç²å–æœ‰è¨‚é–±è€…çš„æ´»èºæœƒè©± ID åˆ—è¡¨

        Returns:
            list: æ´»èºæœƒè©± ID åˆ—è¡¨
        """
        return list(self._subscribers.keys())

    def _get_timestamp(self) -> str:
        """ç²å–ç•¶å‰æ™‚é–“æˆ³"""
        from datetime import datetime
        return datetime.utcnow().isoformat()

    async def cleanup_session(self, session_id: str):
        """
        æ¸…ç†æŒ‡å®šæœƒè©±çš„æ‰€æœ‰é€£æ¥

        Args:
            session_id: æœƒè©± ID
        """
        if session_id in self._subscribers:
            subscribers = self._subscribers[session_id].copy()
            for websocket in subscribers:
                try:
                    await websocket.close()
                except:
                    pass  # å¿½ç•¥é—œé–‰æ™‚çš„éŒ¯èª¤

            del self._subscribers[session_id]
            logger.info(f"ğŸ—‘ï¸ å·²æ¸…ç†æœƒè©± {session_id} çš„æ‰€æœ‰é€£æ¥ ({len(subscribers)} å€‹)")


# å…¨åŸŸ Hub å¯¦ä¾‹
transcript_hub = TranscriptHub()


def get_transcript_hub() -> TranscriptHub:
    """ç²å–å…¨åŸŸè½‰éŒ„å»£æ’­ä¸­å¿ƒå¯¦ä¾‹"""
    return transcript_hub


# END FILE CONTENTS


# File: frontend/components/ui/button.tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }


# END FILE CONTENTS


# File: pytest.ini

[tool:pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts =
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --color=yes
    --durations=10
markers =
    asyncio: marks tests as async
    unit: marks tests as unit tests
    integration: marks tests as integration tests
    slow: marks tests as slow running
asyncio_mode = auto
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning


# END FILE CONTENTS


# File: frontend/hooks/use-session-new.ts

"use client"

import { useCallback, useMemo, useEffect } from 'react'
import { useAppStateContext } from './use-app-state-context'
import { isFeatureEnabled } from '../lib/feature-flags'
import { SERVICE_KEYS, serviceContainer } from '../lib/services'
import type { ISessionService } from '../lib/services'
import type { SessionResponse } from '../lib/api'

interface UseSessionNewReturn {
    currentSession: SessionResponse | null
    isLoading: boolean
    error: string | null
    createNoteSession: (title?: string, content?: string) => Promise<SessionResponse | null>
    createRecordingSession: (title?: string, content?: string) => Promise<SessionResponse | null>
    upgradeToRecording: () => Promise<SessionResponse | null>
    finishSession: () => Promise<void>
    deleteSession: () => Promise<void>
    clearSession: () => void
    checkActiveSession: () => Promise<SessionResponse | null>
}

/**
 * useSessionNew - æœƒè©±ç®¡ç† Hook (é©é…å™¨å±¤)
 *
 * é‡æ§‹ç‚ºé©é…å™¨å±¤ï¼š
 * - å…§éƒ¨èª¿ç”¨ SessionService è€Œéç›´æ¥èª¿ç”¨ sessionAPI
 * - ä¿æŒå°å¤–æ¥å£å®Œå…¨ä¸è®Šï¼Œç¢ºä¿çµ„ä»¶å±¤ç„¡æ„ŸçŸ¥è®Šæ›´
 * - ä½¿ç”¨æœå‹™å±¤å¯¦ç¾æ¸…æ™°çš„æ¶æ§‹åˆ†å±¤
 */
export function useSessionNew(): UseSessionNewReturn {
    const context = useAppStateContext()

    console.log('ğŸ”„ [useSessionNew] Hook åˆå§‹åŒ– (é©é…å™¨å±¤)ï¼ŒåŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewStateManagement: isFeatureEnabled('useNewStateManagement'),
        useNewSessionHook: isFeatureEnabled('useNewSessionHook'),
        contextSession: context.appData.session,
        contextError: context.error,
        contextLoading: context.isLoading,
    })

    // è§£ææœå‹™å¯¦ä¾‹ - ä½¿ç”¨æœå‹™å±¤
    const sessionService = useMemo(() => {
        try {
            return serviceContainer.resolve<ISessionService>(SERVICE_KEYS.SESSION_SERVICE)
        } catch (error) {
            console.error('âŒ [useSessionNew] ç„¡æ³•è§£æ SessionService:', error)
            throw new Error('æœƒè©±æœå‹™åˆå§‹åŒ–å¤±æ•—')
        }
    }, [])

    const clearError = useCallback(() => {
        context.setError(null)
    }, [context])

    const checkActiveSession = useCallback(async (): Promise<SessionResponse | null> => {
        context.setLoading(true)
        clearError()

        try {
            const activeSession = await sessionService.checkActiveSession()
            if (activeSession) {
                context.setSession({
                    id: activeSession.id,
                    status: activeSession.status,
                    type: activeSession.type,
                })
                console.log('âœ… [useSessionNew] å·²æ¢å¾©æ´»èºæœƒè©±ç‹€æ…‹:', activeSession)
                return activeSession
            } else {
                console.log('â„¹ï¸ [useSessionNew] æ²’æœ‰æ´»èºæœƒè©±ï¼Œä½¿ç”¨é è¨­ç‹€æ…‹')
                context.setSession(null)
                return null
            }
        } catch (err) {
            if (err instanceof Error && err.message.includes('Network Error')) {
                console.warn('âš ï¸ [useSessionNew] Backend API é€£ç·šæš«æ™‚å¤±æ•—ï¼Œå°‡åœ¨å¾ŒçºŒé‡è©¦:', err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const createNoteSession = useCallback(async (title?: string, content?: string): Promise<SessionResponse | null> => {
        context.setLoading(true)
        clearError()

        try {
            const session = await sessionService.createNoteSession(title, content)

            context.setSession({
                id: session.id,
                status: session.status,
                type: session.type,
            })

            console.log('âœ… [useSessionNew] ç´”ç­†è¨˜æœƒè©±å»ºç«‹æˆåŠŸ:', session)
            return session
        } catch (err) {
            // ä¿æŒåŸæœ‰çš„ 409 è¡çªéŒ¯èª¤è™•ç†é‚è¼¯
            if (err instanceof Error && err.message.includes('409')) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                context.setError(conflictMessage)
                console.error('âŒ [useSessionNew] æœƒè©±è¡çªéŒ¯èª¤ (409):', err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹æœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] å»ºç«‹ç´”ç­†è¨˜æœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const createRecordingSession = useCallback(async (title?: string, content?: string): Promise<SessionResponse | null> => {
        context.setLoading(true)
        clearError()

        try {
            const session = await sessionService.createRecordingSession(title, content)

            context.setSession({
                id: session.id,
                status: session.status,
                type: session.type,
            })

            console.log('âœ… [useSessionNew] éŒ„éŸ³æœƒè©±å»ºç«‹æˆåŠŸ:', session)
            return session
        } catch (err) {
            // ä¿æŒåŸæœ‰çš„ 409 è¡çªéŒ¯èª¤è™•ç†é‚è¼¯
            if (err instanceof Error && err.message.includes('409')) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                context.setError(conflictMessage)
                console.error('âŒ [useSessionNew] æœƒè©±è¡çªéŒ¯èª¤ (409):', err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const upgradeToRecording = useCallback(async (): Promise<SessionResponse | null> => {
        const currentSessionData = context.appData.session

        if (!currentSessionData) {
            context.setError('æ²’æœ‰æ´»èºçš„æœƒè©±å¯ä»¥å‡ç´š')
            return null
        }

        if (currentSessionData.type === 'recording') {
            console.log('ğŸ”„ [useSessionNew] æœƒè©±å·²ç¶“æ˜¯éŒ„éŸ³æ¨¡å¼')
            try {
                const activeSession = await sessionService.checkActiveSession()
                return activeSession
            } catch (err) {
                console.error('âŒ [useSessionNew] ç²å–æ´»èºæœƒè©±å¤±æ•—:', err)
                return null
            }
        }

        context.setLoading(true)
        clearError()

        try {
            const updatedSession = await sessionService.upgradeToRecording(currentSessionData.id)

            context.setSession({
                id: updatedSession.id,
                status: updatedSession.status,
                type: updatedSession.type,
            })

            console.log('âœ… [useSessionNew] æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼æˆåŠŸ:', updatedSession)
            return updatedSession
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å‡ç´šæœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] å‡ç´šæœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const finishSession = useCallback(async (): Promise<void> => {
        const currentSessionData = context.appData.session

        if (!currentSessionData) {
            console.log('ğŸ”„ [useSessionNew] æ²’æœ‰æ´»èºçš„æœƒè©±éœ€è¦å®Œæˆ')
            return
        }

        context.setLoading(true)
        clearError()

        try {
            await sessionService.finishSession(currentSessionData.id)
            console.log('âœ… [useSessionNew] æœƒè©±å®ŒæˆæˆåŠŸ:', currentSessionData.id)

            context.updateSessionStatus('completed')
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å®Œæˆæœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] å®Œæˆæœƒè©±å¤±æ•—:', err)
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const deleteSession = useCallback(async (): Promise<void> => {
        const currentSessionData = context.appData.session

        if (!currentSessionData) {
            console.log('ğŸ”„ [useSessionNew] æ²’æœ‰æ´»èºçš„æœƒè©±éœ€è¦åˆªé™¤')
            return
        }

        context.setLoading(true)
        clearError()

        try {
            await sessionService.deleteSession(currentSessionData.id)
            console.log('âœ… [useSessionNew] æœƒè©±åˆªé™¤æˆåŠŸ:', currentSessionData.id)
            context.setSession(null)
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'åˆªé™¤æœƒè©±å¤±æ•—'
            context.setError(errorMessage)
            console.error('âŒ [useSessionNew] åˆªé™¤æœƒè©±å¤±æ•—:', err)
        } finally {
            context.setLoading(false)
        }
    }, [clearError, context, sessionService])

    const clearSession = useCallback(() => {
        context.setSession(null)
        context.setError(null)
        console.log('ğŸ”„ [useSessionNew] æœƒè©±å·²æ¸…é™¤')
    }, [context])

    // å‘å¾Œç›¸å®¹çš„ currentSession æ ¼å¼
    const currentSession: SessionResponse | null = useMemo(() => {
        const sessionData = context.appData.session
        if (!sessionData) return null

        return {
            id: sessionData.id,
            title: '',
            type: sessionData.type,
            status: sessionData.status,
            language: 'zh-TW',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
        }
    }, [context.appData.session])

    // ç¢ºä¿æœå‹™å±¤å·²åˆå§‹åŒ–
    useEffect(() => {
        if (!sessionService) {
            console.error('âŒ [useSessionNew] SessionService æœªæ­£ç¢ºåˆå§‹åŒ–')
            context.setError('æœƒè©±æœå‹™åˆå§‹åŒ–å¤±æ•—')
        }
    }, [sessionService, context])

    return useMemo(() => ({
        currentSession,
        isLoading: context.isLoading,
        error: context.error,
        createNoteSession,
        createRecordingSession,
        upgradeToRecording,
        finishSession,
        deleteSession,
        clearSession,
        checkActiveSession,
    }), [
        currentSession,
        context.isLoading,
        context.error,
        createNoteSession,
        createRecordingSession,
        upgradeToRecording,
        finishSession,
        deleteSession,
        clearSession,
        checkActiveSession,
    ])
}


# END FILE CONTENTS


# File: frontend/components/ui/use-toast.ts

"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }


# END FILE CONTENTS


# File: frontend/types/app-state.ts

// å‰ç«¯æ‡‰ç”¨ç‹€æ…‹ - å°æ‡‰ PRD å››ç‹€æ…‹æµç¨‹
export type AppState =
  | "default"     // é è¨­ç•«é¢ï¼šå¯å¯«ç­†è¨˜ï¼Œé¡¯ç¤ºéŒ„éŸ³æŒ‰éˆ•
  | "recording_waiting" // éŒ„éŸ³ç•«é¢ï¼šéŒ„éŸ³ä¸­ï¼Œå°šæœªæ”¶åˆ°é€å­—ç¨¿
  | "recording_active"  // éŒ„éŸ³ç•«é¢ï¼šéŒ„éŸ³ä¸­ï¼Œå·²é¡¯ç¤ºé€å­—ç¨¿
  | "processing"  // è™•ç†ç•«é¢ï¼šåœæ­¢éŒ„éŸ³å¾Œï¼Œè™•ç†å‰©é¤˜é€å­—ç¨¿
  | "finished"    // å®Œæ•´é€å­—ç¨¿ç•«é¢ï¼šå¯ç·¨è¼¯ç­†è¨˜ã€åŒ¯å‡ºã€é–‹æ–°ç­†è¨˜

export interface TranscriptEntry {
  startTime?: number
  time: string
  text: string
  provider?: 'whisper' | 'gemini'  // STT Provider æ¨™è­˜
}

export interface AppData {
  state: AppState
  editorContent: string
  transcriptEntries: TranscriptEntry[]
  isRecording: boolean
  recordingTime: number
  session?: {
    id: string
    status: SessionStatus
    type: SessionType
  } | null
}

// å¾Œç«¯ Session ç‹€æ…‹å°æ‡‰å‰ç«¯ç‹€æ…‹
export type SessionStatus = "draft" | "active" | "processing" | "completed" | "error"
export type SessionType = "note_only" | "recording"

// ç‹€æ…‹æ˜ å°„ä»‹é¢
export interface StateMapping {
  frontendState: AppState
  backendStatus: SessionStatus
  sessionType: SessionType
}


# END FILE CONTENTS


# File: frontend/lib/segmented-audio-recorder.ts

"use client"

import { getAudioChunkIntervalMs } from './config'

// éŸ³è¨ŠéŒ„è£½ç‹€æ…‹
export type SegmentedAudioRecorderState = 'idle' | 'recording' | 'paused' | 'error'

// éŸ³è¨ŠéŒ„è£½é…ç½®
export interface SegmentedAudioRecorderConfig {
  segmentDuration: number // æ¯å€‹æ®µè½æ™‚é•·ï¼ˆæ¯«ç§’ï¼‰
  mimeType: string // éŸ³è¨Šæ ¼å¼
  audioBitsPerSecond?: number // éŸ³è¨Šä½å…ƒç‡
}

// éŸ³è¨Šæ®µè½è³‡æ–™
export interface AudioSegment {
  blob: Blob
  timestamp: number
  duration: number
  sequence: number
}

// é è¨­é…ç½®
const DEFAULT_CONFIG: SegmentedAudioRecorderConfig = {
  segmentDuration: getAudioChunkIntervalMs(), // å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
  mimeType: 'audio/webm;codecs=opus',
  audioBitsPerSecond: 64000, // 64 kbps for configurable chunksï¼ˆé™ä½ä½å…ƒç‡ï¼‰
}

/**
 * SegmentedAudioRecorder - åˆ†æ®µå¼éŸ³è¨ŠéŒ„è£½å™¨
 *
 * æ ¸å¿ƒç‰¹é»ï¼š
 * - ä½¿ç”¨éè¿´å•Ÿå‹•/åœæ­¢ MediaRecorder æ¨¡å¼
 * - æ¯å€‹ segment åŒ…å«å®Œæ•´ WebM Header
 * - æ”¯æ´å¯é…ç½®çš„åˆ‡ç‰‡æ™‚é•·ï¼ˆé è¨­ 5 ç§’ï¼‰
 * - è§£æ±º Azure OpenAI Whisper API æª”é ­å•é¡Œ
 */
export class SegmentedAudioRecorder {
  private stream: MediaStream | null = null
  private config: SegmentedAudioRecorderConfig
  private state: SegmentedAudioRecorderState = 'idle'
  private sequence: number = 0
  private recording = false
  private segmentTimeout: NodeJS.Timeout | null = null

  // äº‹ä»¶å›èª¿
  private onSegmentCallback?: (segment: AudioSegment) => void
  private onStateChangeCallback?: (state: SegmentedAudioRecorderState) => void
  private onErrorCallback?: (error: Error) => void
  private onStartCallback?: () => void

  constructor(config: Partial<SegmentedAudioRecorderConfig> = {}) {
    this.config = { ...DEFAULT_CONFIG, ...config }
  }

  /**
   * åˆå§‹åŒ–éŒ„éŸ³å™¨ - ç²å–éŸ³è¨Šæ¬Šé™
   */
  async initialize(): Promise<void> {
    if (this.stream) {
      return // å·²åˆå§‹åŒ–
    }

    try {
      this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })
      console.log('ğŸ¤ [SegmentedAudioRecorder] éŸ³è¨Šæ¬Šé™ç²å–æˆåŠŸ')
    } catch (error) {
      const errorMsg = error instanceof Error ? error.message : 'ç²å–éŸ³è¨Šæ¬Šé™å¤±æ•—'
      this.handleError(new Error(errorMsg))
      throw error
    }
  }

  /**
   * é–‹å§‹éŒ„éŸ³ - å•Ÿå‹•éè¿´åˆ†æ®µéŒ„éŸ³
   */
  async start(onSegmentAvailable: (segment: AudioSegment) => void): Promise<void> {
    if (this.recording) {
      throw new Error('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
    }

    if (!this.stream) {
      await this.initialize()
    }

    this.onSegmentCallback = onSegmentAvailable
    this.recording = true
    this.sequence = 0

    console.log('ğŸ¬ [SegmentedAudioRecorder] é–‹å§‹åˆ†æ®µéŒ„éŸ³', {
      segmentDuration: this.config.segmentDuration,
      mimeType: this.config.mimeType,
      audioBitsPerSecond: this.config.audioBitsPerSecond
    })

    this.setState('recording')
    this.startSegment()
  }

  /**
   * æ ¸å¿ƒéè¿´å‡½å¼ - å•Ÿå‹•å–®å€‹éŒ„éŸ³æ®µè½
   */
  private startSegment(): void {
    if (!this.recording || !this.stream) {
      return
    }

    console.log(`ğŸµ [SegmentedAudioRecorder] é–‹å§‹éŒ„éŸ³æ®µè½ #${this.sequence}`)

    // å»ºç«‹æ–°çš„ MediaRecorder å¯¦ä¾‹
    const mediaRecorder = new MediaRecorder(this.stream, {
      mimeType: this.config.mimeType,
      audioBitsPerSecond: this.config.audioBitsPerSecond,
    })

    // æ–°å¢ï¼šè¨­å®šéŒ„éŸ³é–‹å§‹äº‹ä»¶è™•ç†
    mediaRecorder.onstart = () => {
      console.log(`ğŸš€ [SegmentedAudioRecorder] æ®µè½ #${this.sequence} éŒ„éŸ³çœŸæ­£é–‹å§‹`)
      // åªåœ¨ç¬¬ä¸€å€‹æ®µè½è§¸ç™¼ onstart å›èª¿
      if (this.sequence === 0 && this.onStartCallback) {
        console.log('ğŸ¯ [SegmentedAudioRecorder] è§¸ç™¼éŒ„éŸ³é–‹å§‹å›èª¿')
        this.onStartCallback()
      }
    }

    // è¨­å®šè³‡æ–™æ¥æ”¶è™•ç†
    mediaRecorder.ondataavailable = (event) => {
      if (event.data.size > 0) {
        console.log(`ğŸ“¦ [SegmentedAudioRecorder] æ®µè½ #${this.sequence} å®Œæˆ`, {
          size: event.data.size,
          mimeType: this.config.mimeType,
          containsCompleteHeader: true // æ¯å€‹æ®µè½éƒ½æœ‰å®Œæ•´æª”é ­
        })

        const segment: AudioSegment = {
          blob: event.data,
          timestamp: Date.now(),
          duration: this.config.segmentDuration,
          sequence: this.sequence++,
        }

        // å›èª¿é€šçŸ¥æœ‰æ–°æ®µè½å¯ç”¨
        this.onSegmentCallback?.(segment)
      }
    }

    // éŒ¯èª¤è™•ç†
    mediaRecorder.onerror = (event) => {
      console.error(`âŒ [SegmentedAudioRecorder] æ®µè½ #${this.sequence} éŒ¯èª¤:`, event)
      this.handleError(new Error(`MediaRecorder éŒ¯èª¤: ${event}`))
    }

    // é–‹å§‹éŒ„è£½æ­¤æ®µè½
    mediaRecorder.start()

    // è¨­å®šè¨ˆæ™‚å™¨ï¼Œåœ¨æŒ‡å®šæ™‚é–“å¾ŒçµæŸæ­¤æ®µè½ä¸¦é–‹å§‹ä¸‹ä¸€æ®µ
    this.segmentTimeout = setTimeout(() => {
      if (mediaRecorder.state === 'recording') {
        // è«‹æ±‚æ•¸æ“šä¸¦åœæ­¢ MediaRecorder
        mediaRecorder.requestData() // è§¸ç™¼ ondataavailable
        mediaRecorder.stop()        // çµæŸæ­¤æ®µ

        // å¦‚æœä»åœ¨éŒ„éŸ³ç‹€æ…‹ï¼Œéè¿´é–‹å§‹ä¸‹ä¸€æ®µ
        if (this.recording) {
          // çŸ­æš«å»¶é²ç¢ºä¿å‰ä¸€æ®µå®Œå…¨çµæŸ
          setTimeout(() => {
            this.startSegment()
          }, 50)
        }
      }
    }, this.config.segmentDuration)
  }

  /**
   * åœæ­¢éŒ„éŸ³
   */
  stop(): void {
    console.log('â¹ï¸ [SegmentedAudioRecorder] åœæ­¢éŒ„éŸ³')

    this.recording = false

    // æ¸…é™¤è¨ˆæ™‚å™¨
    if (this.segmentTimeout) {
      clearTimeout(this.segmentTimeout)
      this.segmentTimeout = null
    }

    this.setState('idle')
  }

  /**
   * æ¸…ç†è³‡æº
   */
  cleanup(): void {
    this.stop()

    if (this.stream) {
      this.stream.getTracks().forEach(track => track.stop())
      this.stream = null
    }

    this.sequence = 0
    console.log('ğŸ§¹ SegmentedAudioRecorder å·²æ¸…ç†')
  }

  /**
   * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
   */
  get isRecording(): boolean {
    return this.recording
  }

  /**
   * ç²å–ç•¶å‰åºè™Ÿ
   */
  get currentSequence(): number {
    return this.sequence
  }

  /**
   * ç²å–ç•¶å‰ç‹€æ…‹
   */
  get currentState(): SegmentedAudioRecorderState {
    return this.state
  }

  /**
   * ç²å–ç•¶å‰é…ç½®
   */
  get currentConfig(): SegmentedAudioRecorderConfig {
    return { ...this.config }
  }

  // è¨­å®šç‹€æ…‹
  private setState(newState: SegmentedAudioRecorderState): void {
    this.state = newState
    this.onStateChangeCallback?.(newState)
  }

  // éŒ¯èª¤è™•ç†
  private handleError(error: Error): void {
    console.error('âŒ SegmentedAudioRecorder éŒ¯èª¤:', error)
    this.setState('error')
    this.recording = false
    this.onErrorCallback?.(error)
  }

  // äº‹ä»¶å›èª¿è¨­å®š
  onSegment(callback: (segment: AudioSegment) => void): void {
    this.onSegmentCallback = callback
  }

  onStateChange(callback: (state: SegmentedAudioRecorderState) => void): void {
    this.onStateChangeCallback = callback
  }

  onError(callback: (error: Error) => void): void {
    this.onErrorCallback = callback
  }

  onStart(callback: () => void): void {
    this.onStartCallback = callback
  }
}

// å·¥å» å‡½æ•¸
export const createSegmentedAudioRecorder = (config?: Partial<SegmentedAudioRecorderConfig>): SegmentedAudioRecorder => {
  return new SegmentedAudioRecorder(config)
}

/**
 * æª¢æŸ¥ç€è¦½å™¨åˆ†æ®µå¼éŸ³è¨ŠéŒ„è£½æ”¯æ´
 */
export async function checkSegmentedAudioRecordingSupport(): Promise<{ isSupported: boolean; error?: string }> {
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API' }
  }

  if (!window.MediaRecorder) {
    return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API' }
  }

  // æª¢æŸ¥ MIME é¡å‹æ”¯æ´
  if (!MediaRecorder.isTypeSupported(DEFAULT_CONFIG.mimeType)) {
    return { isSupported: false, error: `ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${DEFAULT_CONFIG.mimeType}` }
  }

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
    // ç«‹å³åœæ­¢ä¸²æµä»¥é‡‹æ”¾è³‡æº
    stream.getTracks().forEach(track => track.stop())
    return { isSupported: true }
  } catch (error) {
    return { isSupported: false, error: `ç„¡æ³•ç²å–éº¥å…‹é¢¨æ¬Šé™: ${error}` }
  }
}


# END FILE CONTENTS


# File: frontend/types/app-state-context.ts

import { AppData, AppState, SessionStatus, SessionType, TranscriptEntry } from "./app-state"
import { StateTransitionTrigger, StateTransitionResult } from './state-transitions';

// ç‹€æ…‹ç®¡ç† Actions
export type AppStateAction =
    | { type: "SET_STATE"; payload: AppState }
    | { type: "SET_APP_STATE"; payload: AppState }  // åˆ¥åï¼Œç‚ºäº†å‘å¾Œç›¸å®¹
    | { type: "SET_RECORDING"; payload: boolean }
    | { type: "SET_RECORDING_TIME"; payload: number }
    | { type: "SET_EDITOR_CONTENT"; payload: string }
    | { type: "SET_TRANSCRIPT_ENTRIES"; payload: TranscriptEntry[] }
    | { type: "ADD_TRANSCRIPT_ENTRY"; payload: TranscriptEntry }
    | { type: "SET_SESSION"; payload: { id: string; status: SessionStatus; type: SessionType } | null }
    | { type: "UPDATE_SESSION_STATUS"; payload: SessionStatus }
    | { type: "RESET_STATE" }
    | { type: "SET_LOADING"; payload: boolean }
    | { type: "SET_ERROR"; payload: string | null }
    | { type: "CLEAR_ERROR" }

// Context ç‹€æ…‹ä»‹é¢
export interface AppStateContextValue {
    // ç‹€æ…‹æ•¸æ“š
    appData: AppData
    isLoading: boolean
    error: string | null

    // ç‹€æ…‹æ›´æ–°å‡½æ•¸
    dispatch: (action: AppStateAction) => void

    // ä¾¿åˆ©æ–¹æ³•ï¼ˆå°è£å¸¸ç”¨çš„ dispatch æ“ä½œï¼‰
    setState: (state: AppState) => void
    setRecording: (isRecording: boolean) => void
    setRecordingTime: (time: number) => void
    setEditorContent: (content: string) => void
    setTranscriptEntries: (entries: TranscriptEntry[]) => void
    addTranscriptEntry: (entry: TranscriptEntry) => void
    setSession: (session: { id: string; status: SessionStatus; type: SessionType } | null) => void
    updateSessionStatus: (status: SessionStatus) => void
    resetState: () => void
    setLoading: (loading: boolean) => void
    setError: (error: string | null) => void
    transition: (trigger: StateTransitionTrigger) => StateTransitionResult | null
}

// åˆå§‹ç‹€æ…‹
export const initialAppData: AppData = {
    state: "default",
    transcriptEntries: [],
    editorContent: "",
    isRecording: false,
    recordingTime: 0,
    session: null,
}

export const initialContextState = {
    appData: initialAppData,
    isLoading: false,
    error: null,
}


# END FILE CONTENTS


# File: frontend/public/placeholder.svg

<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1200" fill="none"><rect width="1200" height="1200" fill="#EAEAEA" rx="3"/><g opacity=".5"><g opacity=".5"><path fill="#FAFAFA" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/></g><path stroke="url(#a)" stroke-width="2.418" d="M0-1.209h553.581" transform="scale(1 -1) rotate(45 1163.11 91.165)"/><path stroke="url(#b)" stroke-width="2.418" d="M404.846 598.671h391.726"/><path stroke="url(#c)" stroke-width="2.418" d="M599.5 795.742V404.017"/><path stroke="url(#d)" stroke-width="2.418" d="m795.717 796.597-391.441-391.44"/><path fill="#fff" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/><g clip-path="url(#e)"><path fill="#666" fill-rule="evenodd" d="M616.426 586.58h-31.434v16.176l3.553-3.554.531-.531h9.068l.074-.074 8.463-8.463h2.565l7.18 7.181V586.58Zm-15.715 14.654 3.698 3.699 1.283 1.282-2.565 2.565-1.282-1.283-5.2-5.199h-6.066l-5.514 5.514-.073.073v2.876a2.418 2.418 0 0 0 2.418 2.418h26.598a2.418 2.418 0 0 0 2.418-2.418v-8.317l-8.463-8.463-7.181 7.181-.071.072Zm-19.347 5.442v4.085a6.045 6.045 0 0 0 6.046 6.045h26.598a6.044 6.044 0 0 0 6.045-6.045v-7.108l1.356-1.355-1.282-1.283-.074-.073v-17.989h-38.689v23.43l-.146.146.146.147Z" clip-rule="evenodd"/></g><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/></g><defs><linearGradient id="a" x1="554.061" x2="-.48" y1=".083" y2=".087" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="b" x1="796.912" x2="404.507" y1="599.963" y2="599.965" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="c" x1="600.792" x2="600.794" y1="403.677" y2="796.082" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="d" x1="404.85" x2="796.972" y1="403.903" y2="796.02" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><clipPath id="e"><path fill="#fff" d="M581.364 580.535h38.689v38.689h-38.689z"/></clipPath></defs></svg>

# END FILE CONTENTS


# File: frontend/components/provider-context-menu.tsx

"use client"

import {
    DropdownMenu,
    DropdownMenuTrigger,
    DropdownMenuContent,
    DropdownMenuItem,
    DropdownMenuSub,
    DropdownMenuSubTrigger,
    DropdownMenuSubContent,
    DropdownMenuRadioGroup,
    DropdownMenuRadioItem,
    DropdownMenuPortal,
} from "@/components/ui/dropdown-menu"
import { Button } from "@/components/ui/button"
import { Settings, Mic, Zap } from "lucide-react"
import { STTProvider } from "@/lib/api"
import { PROVIDERS } from "../constants/providers"

interface ProviderContextMenuProps {
    currentProvider: STTProvider
    onProviderChange: (provider: STTProvider) => void
    disabled?: boolean
}

export function ProviderContextMenu({ currentProvider, onProviderChange, disabled = false }: ProviderContextMenuProps) {
    const providerDisplayName = Object.fromEntries(PROVIDERS.map(p => [p.code, p.label]))

    return (
        <DropdownMenu>
            <DropdownMenuTrigger asChild>
                <Button
                    variant="ghost"
                    size="icon"
                    className="h-8 w-8"
                    disabled={disabled}
                    data-testid="settings-button"
                >
                    <Settings className="w-4 h-4" />
                </Button>
            </DropdownMenuTrigger>
            <DropdownMenuPortal>
                <DropdownMenuContent side="bottom" sideOffset={4} className="bg-white rounded-md">
                    <DropdownMenuItem disabled>Config</DropdownMenuItem>
                    <DropdownMenuSub>
                        <DropdownMenuSubTrigger>Switch Provider</DropdownMenuSubTrigger>
                        <DropdownMenuSubContent className="bg-white rounded-md">
                            <DropdownMenuRadioGroup value={currentProvider} onValueChange={(value) => onProviderChange(value as STTProvider)}>
                                {PROVIDERS.map((p) => (
                                    <DropdownMenuRadioItem value={p.code} key={p.code}>
                                        {p.label}
                                    </DropdownMenuRadioItem>
                                ))}
                            </DropdownMenuRadioGroup>
                        </DropdownMenuSubContent>
                    </DropdownMenuSub>
                </DropdownMenuContent>
            </DropdownMenuPortal>
        </DropdownMenu>
    )
}


# END FILE CONTENTS


# File: app/__init__.py

"""
StudyScriber API Application

é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼šé‚ŠéŒ„é‚Šè½‰éŒ„ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³æ¨¡å¼
"""

__version__ = "0.1.0"


# END FILE CONTENTS


# File: app/core/webm_header_repairer.py

"""
WebM æª”é ­ä¿®å¾©æ ¸å¿ƒé‚è¼¯
æä¾›æª”é ­æå–ã€é©—è­‰å’Œé‡çµ„åŠŸèƒ½ï¼Œè§£æ±º MediaRecorder å¾ŒçºŒ chunk ç¼ºä¹ EBML æª”é ­çš„å•é¡Œ
"""

import logging
import time
from typing import Optional, Tuple
from dataclasses import dataclass

from .ffmpeg import detect_webm_header_info, is_webm_header_complete, WebMHeaderInfo

logger = logging.getLogger(__name__)


@dataclass
class HeaderRepairResult:
    """æª”é ­ä¿®å¾©çµæœ"""
    success: bool = False
    repaired_data: Optional[bytes] = None
    original_header_size: int = 0
    audio_data_size: int = 0
    repair_time_ms: float = 0.0
    error_message: Optional[str] = None


@dataclass
class HeaderExtractionResult:
    """æª”é ­æå–çµæœ"""
    success: bool = False
    header_data: Optional[bytes] = None
    header_info: Optional[WebMHeaderInfo] = None
    extraction_time_ms: float = 0.0
    error_message: Optional[str] = None


class WebMHeaderRepairer:
    """
    WebM æª”é ­ä¿®å¾©æ ¸å¿ƒå¼•æ“

    è² è²¬å¾ç¬¬ä¸€å€‹å®Œæ•´ chunk æå–æª”é ­æ¨¡æ¿ï¼Œä¸¦å°‡å…¶æ‡‰ç”¨åˆ°å¾ŒçºŒç¼ºä¹æª”é ­çš„ chunk ä¸­
    """

    def __init__(self):
        """åˆå§‹åŒ– WebM æª”é ­ä¿®å¾©å™¨"""
        self._repair_stats = {
            'total_extractions': 0,
            'successful_extractions': 0,
            'total_repairs': 0,
            'successful_repairs': 0,
            'total_repair_time_ms': 0.0
        }
        logger.info("WebMHeaderRepairer åˆå§‹åŒ–å®Œæˆ")

    def extract_header(self, complete_webm_chunk: bytes) -> HeaderExtractionResult:
        """
        å¾å®Œæ•´çš„ WebM chunk ä¸­æå–æª”é ­æ¨¡æ¿

        Args:
            complete_webm_chunk: åŒ…å«å®Œæ•´æª”é ­çš„ WebM chunk æ•¸æ“š

        Returns:
            HeaderExtractionResult: æª”é ­æå–çµæœ
        """
        start_time = time.time()
        result = HeaderExtractionResult()

        try:
            self._repair_stats['total_extractions'] += 1

            # 1. é©—è­‰è¼¸å…¥æ•¸æ“š
            if not complete_webm_chunk or len(complete_webm_chunk) < 32:
                result.error_message = "è¼¸å…¥æ•¸æ“šé•·åº¦ä¸è¶³"
                return result

            # 2. æª¢æ¸¬æª”é ­å®Œæ•´æ€§
            header_info = detect_webm_header_info(complete_webm_chunk)
            if not header_info.is_complete:
                result.error_message = f"æª”é ­ä¸å®Œæ•´: {header_info.error_message}"
                return result

            # 3. æå–æª”é ­æ•¸æ“šï¼ˆå¾é–‹å§‹åˆ°ç¬¬ä¸€å€‹ Clusterï¼‰
            if header_info.header_size > 0:
                header_data = complete_webm_chunk[:header_info.header_size]

                # 4. é©—è­‰æå–çš„æª”é ­
                if self._validate_extracted_header(header_data):
                    result.success = True
                    result.header_data = header_data
                    result.header_info = header_info
                    self._repair_stats['successful_extractions'] += 1

                    logger.debug(f"æˆåŠŸæå–æª”é ­: å¤§å°={len(header_data)} bytes, "
                               f"ç·¨ç¢¼å™¨={header_info.codec_type}, "
                               f"éŸ³è»Œæ•¸={header_info.track_count}")
                else:
                    result.error_message = "æå–çš„æª”é ­é©—è­‰å¤±æ•—"
            else:
                result.error_message = "ç„¡æ³•ç¢ºå®šæª”é ­å¤§å°"

        except Exception as e:
            result.error_message = f"æª”é ­æå–ç•°å¸¸: {str(e)}"
            logger.error(f"æª”é ­æå–ç™¼ç”ŸéŒ¯èª¤: {e}")

        finally:
            result.extraction_time_ms = (time.time() - start_time) * 1000

        return result

    def repair_chunk(self, header_template: bytes, incomplete_chunk: bytes) -> HeaderRepairResult:
        """
        ä½¿ç”¨æª”é ­æ¨¡æ¿ä¿®å¾©ä¸å®Œæ•´çš„ WebM chunk

        Args:
            header_template: å¾å®Œæ•´ chunk æå–çš„æª”é ­æ¨¡æ¿
            incomplete_chunk: ç¼ºä¹æª”é ­çš„ WebM chunk

        Returns:
            HeaderRepairResult: ä¿®å¾©çµæœ
        """
        start_time = time.time()
        result = HeaderRepairResult()

        try:
            self._repair_stats['total_repairs'] += 1

            # 1. é©—è­‰è¼¸å…¥
            if not header_template or not incomplete_chunk:
                result.error_message = "è¼¸å…¥åƒæ•¸ç„¡æ•ˆ"
                return result

            if len(header_template) < 32 or len(incomplete_chunk) < 8:
                result.error_message = "æ•¸æ“šé•·åº¦ä¸è¶³"
                return result

            # 2. æª¢æ¸¬ incomplete_chunk æ˜¯å¦å·²ç¶“æœ‰æª”é ­
            if is_webm_header_complete(incomplete_chunk):
                # å¦‚æœå·²ç¶“æœ‰å®Œæ•´æª”é ­ï¼Œç›´æ¥è¿”å›åŸæ•¸æ“š
                result.success = True
                result.repaired_data = incomplete_chunk
                result.original_header_size = 0
                result.audio_data_size = len(incomplete_chunk)
                logger.debug("Chunk å·²æœ‰å®Œæ•´æª”é ­ï¼Œç„¡éœ€ä¿®å¾©")
                return result

            # 3. æª¢æ¸¬ incomplete_chunk ä¸­çš„éŸ³é »æ•¸æ“šèµ·å§‹ä½ç½®
            audio_data_start = self._find_audio_data_start(incomplete_chunk)
            if audio_data_start == -1:
                result.error_message = "ç„¡æ³•åœ¨ incomplete chunk ä¸­æ‰¾åˆ°æœ‰æ•ˆçš„éŸ³é »æ•¸æ“š"
                return result

            # 4. æå–éŸ³é »æ•¸æ“š
            audio_data = incomplete_chunk[audio_data_start:]
            if len(audio_data) < 8:
                result.error_message = "éŸ³é »æ•¸æ“šé•·åº¦ä¸è¶³"
                return result

            # 5. ä¿®å¾©æª”é ­ä¸­çš„æ™‚é–“æˆ³ä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
            repaired_header = self._update_header_timestamps(header_template, incomplete_chunk)

            # 6. æ‹¼æ¥ä¿®å¾©å¾Œçš„æ•¸æ“š
            repaired_data = repaired_header + audio_data

            # 7. é©—è­‰ä¿®å¾©çµæœ
            if self.validate_repaired_chunk(repaired_data):
                result.success = True
                result.repaired_data = repaired_data
                result.original_header_size = len(repaired_header)
                result.audio_data_size = len(audio_data)
                self._repair_stats['successful_repairs'] += 1

                logger.debug(f"æˆåŠŸä¿®å¾© chunk: æª”é ­={len(repaired_header)} bytes, "
                           f"éŸ³é »={len(audio_data)} bytes, "
                           f"ç¸½è¨ˆ={len(repaired_data)} bytes")
            else:
                result.error_message = "ä¿®å¾©å¾Œçš„æ•¸æ“šé©—è­‰å¤±æ•—"

        except Exception as e:
            result.error_message = f"æª”é ­ä¿®å¾©ç•°å¸¸: {str(e)}"
            logger.error(f"æª”é ­ä¿®å¾©ç™¼ç”ŸéŒ¯èª¤: {e}")

        finally:
            repair_time_ms = (time.time() - start_time) * 1000
            result.repair_time_ms = repair_time_ms
            self._repair_stats['total_repair_time_ms'] += repair_time_ms

        return result

    def validate_repaired_chunk(self, repaired_chunk: bytes) -> bool:
        """
        é©—è­‰ä¿®å¾©å¾Œçš„ WebM chunk æ˜¯å¦æœ‰æ•ˆ

        Args:
            repaired_chunk: ä¿®å¾©å¾Œçš„ WebM æ•¸æ“š

        Returns:
            bool: True è¡¨ç¤ºé©—è­‰é€šéï¼ŒFalse è¡¨ç¤ºé©—è­‰å¤±æ•—
        """
        try:
            if not repaired_chunk or len(repaired_chunk) < 32:
                return False

            # 1. æª¢æŸ¥æ˜¯å¦æœ‰å®Œæ•´çš„æª”é ­
            if not is_webm_header_complete(repaired_chunk):
                logger.debug("ä¿®å¾©å¾Œçš„ chunk æª”é ­ä»ä¸å®Œæ•´")
                return False

            # 2. æª¢æ¸¬æª”é ­è³‡è¨Š
            header_info = detect_webm_header_info(repaired_chunk)
            if not header_info.is_complete:
                logger.debug(f"æª”é ­é©—è­‰å¤±æ•—: {header_info.error_message}")
                return False

            # 3. æª¢æŸ¥æ•¸æ“šé•·åº¦åˆç†æ€§
            if header_info.header_size >= len(repaired_chunk):
                logger.debug("æª”é ­å¤§å°ç•°å¸¸ï¼Œç­‰æ–¼æˆ–è¶…éç¸½æ•¸æ“šå¤§å°")
                return False

            # 4. æª¢æŸ¥æ˜¯å¦æœ‰éŸ³é »æ•¸æ“š
            audio_data_size = len(repaired_chunk) - header_info.header_size
            if audio_data_size < 8:
                logger.debug("éŸ³é »æ•¸æ“šé•·åº¦ä¸è¶³")
                return False

            logger.debug(f"ä¿®å¾©é©—è­‰é€šé: æª”é ­={header_info.header_size} bytes, "
                        f"éŸ³é »={audio_data_size} bytes, "
                        f"ç·¨ç¢¼å™¨={header_info.codec_type}")

            return True

        except Exception as e:
            logger.error(f"ä¿®å¾©é©—è­‰ç™¼ç”ŸéŒ¯èª¤: {e}")
            return False

    def get_repair_statistics(self) -> dict:
        """
        ç²å–ä¿®å¾©çµ±è¨ˆä¿¡æ¯

        Returns:
            dict: åŒ…å«ä¿®å¾©çµ±è¨ˆæ•¸æ“šçš„å­—å…¸
        """
        stats = self._repair_stats.copy()

        # è¨ˆç®—æˆåŠŸç‡
        if stats['total_extractions'] > 0:
            stats['extraction_success_rate'] = stats['successful_extractions'] / stats['total_extractions']
        else:
            stats['extraction_success_rate'] = 0.0

        if stats['total_repairs'] > 0:
            stats['repair_success_rate'] = stats['successful_repairs'] / stats['total_repairs']
            stats['average_repair_time_ms'] = stats['total_repair_time_ms'] / stats['total_repairs']
        else:
            stats['repair_success_rate'] = 0.0
            stats['average_repair_time_ms'] = 0.0

        return stats

    def _validate_extracted_header(self, header_data: bytes) -> bool:
        """
        é©—è­‰æå–çš„æª”é ­æ˜¯å¦æœ‰æ•ˆ

        Args:
            header_data: æå–çš„æª”é ­æ•¸æ“š

        Returns:
            bool: True è¡¨ç¤ºæœ‰æ•ˆï¼ŒFalse è¡¨ç¤ºç„¡æ•ˆ
        """
        try:
            # æª¢æŸ¥åŸºæœ¬é•·åº¦
            if len(header_data) < 32:
                return False

            # æª¢æŸ¥ EBML header æ¨™è¨˜
            if header_data[:4] != b'\x1A\x45\xDF\xA3':
                return False

            # ä½¿ç”¨ç¾æœ‰çš„æª”é ­æª¢æ¸¬åŠŸèƒ½é€²è¡Œæ·±åº¦é©—è­‰
            header_info = detect_webm_header_info(header_data)
            return header_info.has_ebml_header and header_info.has_segment

        except Exception:
            return False

    def _find_audio_data_start(self, incomplete_chunk: bytes) -> int:
        """
        åœ¨ä¸å®Œæ•´çš„ chunk ä¸­å°‹æ‰¾éŸ³é »æ•¸æ“šçš„èµ·å§‹ä½ç½®

        Args:
            incomplete_chunk: ä¸å®Œæ•´çš„ WebM chunk

        Returns:
            int: éŸ³é »æ•¸æ“šèµ·å§‹ä½ç½®ï¼Œ-1 è¡¨ç¤ºæœªæ‰¾åˆ°
        """
        try:
            # 1. æª¢æŸ¥æ˜¯å¦ä»¥ Cluster å…ƒç´ é–‹å§‹ (0x1F43B675)
            cluster_marker = b'\x1F\x43\xB6\x75'
            if incomplete_chunk.startswith(cluster_marker):
                return 0  # ç›´æ¥å¾ Cluster é–‹å§‹

            # 2. åœ¨å‰ 64 bytes ä¸­æœå°‹ Cluster æ¨™è¨˜
            search_range = min(len(incomplete_chunk), 64)
            for i in range(search_range - len(cluster_marker) + 1):
                if incomplete_chunk[i:i + len(cluster_marker)] == cluster_marker:
                    return i

            # 3. å¦‚æœæ²’æ‰¾åˆ° Clusterï¼Œæª¢æŸ¥æ˜¯å¦åŒ…å«å…¶ä»–éŸ³é »æ•¸æ“šæ¨™è¨˜
            # SimpleBlock (0xA3) æˆ– Block (0xA1)
            audio_markers = [b'\xA3', b'\xA1']
            for marker in audio_markers:
                for i in range(search_range):
                    if incomplete_chunk[i:i + len(marker)] == marker:
                        return max(0, i - 8)  # å¾€å‰ä¸€é»ä»¥åŒ…å«å¯èƒ½çš„é•·åº¦è³‡è¨Š

            # 4. å¦‚æœéƒ½æ²’æ‰¾åˆ°ï¼Œå‡è¨­å¾é–‹å§‹å°±æ˜¯éŸ³é »æ•¸æ“š
            logger.debug("æœªæ‰¾åˆ°æ˜ç¢ºçš„éŸ³é »æ•¸æ“šæ¨™è¨˜ï¼Œå‡è¨­å¾é ­é–‹å§‹")
            return 0

        except Exception as e:
            logger.debug(f"å°‹æ‰¾éŸ³é »æ•¸æ“šèµ·å§‹ä½ç½®æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
            return 0  # é è¨­å¾é–‹å§‹è™•ç†

    def _update_header_timestamps(self, header_template: bytes, incomplete_chunk: bytes) -> bytes:
        """
        æ›´æ–°æª”é ­ä¸­çš„æ™‚é–“æˆ³ä¿¡æ¯ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

        Args:
            header_template: åŸå§‹æª”é ­æ¨¡æ¿
            incomplete_chunk: ä¸å®Œæ•´çš„ chunkï¼ˆå¯èƒ½åŒ…å«æ™‚é–“æˆ³ä¿¡æ¯ï¼‰

        Returns:
            bytes: æ›´æ–°å¾Œçš„æª”é ­æ•¸æ“š
        """
        try:
            # ç›®å‰å…ˆè¿”å›åŸå§‹æª”é ­æ¨¡æ¿
            # æœªä¾†å¯ä»¥å¯¦ä½œæ›´è¤‡é›œçš„æ™‚é–“æˆ³æ›´æ–°é‚è¼¯
            return header_template

        except Exception as e:
            logger.debug(f"æ›´æ–°æª”é ­æ™‚é–“æˆ³æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
            return header_template


# END FILE CONTENTS


# File: frontend/components/ui/navigation-menu.tsx

import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}


# END FILE CONTENTS


# File: frontend/lib/services/recording-flow-service.ts

"use client"

import { BaseService } from './base-service'
import { serviceContainer } from './service-container'
import { SERVICE_KEYS, type ISessionService, type IRecordingService, type ITranscriptService, type TranscriptMessage } from './interfaces'
import type { SessionResponse } from '../api'
import type { AppState } from '../../types/app-state'
import { useAppStore } from '../app-store-zustand'
import { formatTime } from '../../utils/time'

/**
 * éŒ„éŸ³æµç¨‹ç®¡ç†æœå‹™
 *
 * æ•´åˆ SessionServiceã€RecordingService å’Œ TranscriptService
 * æä¾›çµ±ä¸€çš„éŒ„éŸ³æµç¨‹ç®¡ç†
 */
import { STTProvider } from '../api'

const AUDIO_CHUNK_SEC = Number(
  process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_SEC ?? "15"
);

export class RecordingFlowService extends BaseService {
  protected readonly serviceName = 'RecordingFlowService'

  // æœå‹™ä¾è³´
  private sessionService!: ISessionService
  private recordingService!: IRecordingService
  private transcriptService!: ITranscriptService

  // æµç¨‹ç‹€æ…‹
  private currentSession: SessionResponse | null = null
  private isFlowActive = false
  private labelIntervalSec = (() => {
    const raw = process.env.NEXT_PUBLIC_TRANSCRIPT_LABEL_INTERVAL
    const n = Number(raw)
    return Number.isFinite(n) && n > 0 ? Math.floor(n) : 15
  })()
  private lastLabelSec = 0
  private transcriptEntries: Array<{ time: string; text: string }> = []

  private setAppState: (s: AppState) => void

  constructor(setAppStateFn?: (s: AppState) => void) {
    super()
    if (setAppStateFn) {
      this.setAppState = setAppStateFn
    } else {
      this.setAppState = useAppStore.getState().setState
    }
  }

  /**
   * æœå‹™åˆå§‹åŒ–
   */
  async initialize(): Promise<void> {
    this.logInfo('åˆå§‹åŒ–éŒ„éŸ³æµç¨‹æœå‹™')

    // è§£ææœå‹™ä¾è³´
    this.sessionService = serviceContainer.resolve<ISessionService>(SERVICE_KEYS.SESSION_SERVICE)
    this.recordingService = serviceContainer.resolve<IRecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
    this.transcriptService = serviceContainer.resolve<ITranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)

    this.logSuccess('æœå‹™ä¾è³´è§£æå®Œæˆ')
    this.logSuccess('åˆå§‹åŒ–å®Œæˆ')
  }

  /**
   * æœå‹™æ¸…ç†
   */
  async cleanup(): Promise<void> {
    this.logInfo('æ¸…ç†éŒ„éŸ³æµç¨‹æœå‹™')

    // å¦‚æœæœ‰æ´»èºçš„æµç¨‹ï¼Œå…ˆåœæ­¢
    if (this.isFlowActive) {
      await this.stopRecordingFlow()
    }

    // é‡ç½®ç‹€æ…‹
    this.currentSession = null
    this.isFlowActive = false
    this.transcriptEntries = []

    this.logSuccess('æ¸…ç†å®Œæˆ')
  }

  /**
   * é–‹å§‹éŒ„éŸ³æµç¨‹
   */
  async startRecordingFlow(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse> {
    this.logInfo('é–‹å§‹éŒ„éŸ³æµç¨‹', { title, content, startTs })

    try {
      // â‘  å…ˆæ‹¿æ¬Šé™
      if (!(await this.recordingService.requestPermission())) {
        this.setAppState('default')
        throw new Error('éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’')
      }

      // === ğŸ›  è¿½åŠ : è‹¥æœ‰ç¾æœ‰æ´»èºæœƒè©±ï¼Œå…ˆçµæŸå®ƒï¼Œé¿å… Session æ‰“æ¶ ===
      const activeSession = await this.sessionService.checkActiveSession()
      if (activeSession) {
        this.logInfo('æª¢æ¸¬åˆ°ç¾æœ‰æ´»èºæœƒè©±ï¼Œå…ˆå®Œæˆå®ƒä»¥é¿å…è¡çª', {
          sessionId: activeSession.id,
          type: activeSession.type,
          status: activeSession.status
        })
        await this.sessionService.finishSession(activeSession.id)
        this.logSuccess('å·²å®Œæˆç¾æœ‰æ´»èºæœƒè©±', { sessionId: activeSession.id })
      }
      // === ğŸ›  è¿½åŠ çµæŸ ===

      // â‘¡ å»º Sessionï¼ˆPOST /sessionï¼‰
      const session = await this.sessionService.createRecordingSession(
        title || `éŒ„éŸ³ç­†è¨˜ ${new Date().toLocaleString()}`,
        content,
        startTs,
        sttProvider
      )
      if (!session) {
        this.setAppState('default')
        throw new Error('å»ºç«‹ Session å¤±æ•—')
      }

      // â‘¢ å•Ÿå‹•é€å­—ç¨¿æœå‹™
      await this.transcriptService.start(session.id)
      this.setAppState('processing')

      // æ­¥é©Ÿ 1: ä½¿ç”¨æ–°å»ºç«‹çš„æœƒè©±
      this.currentSession = session
      this.logSuccess('éŒ„éŸ³æœƒè©±å·²æº–å‚™', { sessionId: this.currentSession.id, withStartTs: !!startTs })

      // æ­¥é©Ÿ 2: ç­‰å¾…æœƒè©±åœ¨è³‡æ–™åº«ä¸­å®Œå…¨å¯è¦‹
      this.logInfo('æ­¥é©Ÿ 2: ç­‰å¾…æœƒè©±æº–å‚™å®Œæˆ')
      const isReady = await this.sessionService.waitForSessionReady(this.currentSession.id, 5000)
      if (!isReady) {
        throw new Error('æœƒè©±æº–å‚™è¶…æ™‚')
      }
      this.logSuccess('æœƒè©±æº–å‚™å®Œæˆ')

      // æ­¥é©Ÿ 3: é€£æ¥é€å­—ç¨¿æœå‹™
      this.logInfo('æ­¥é©Ÿ 3: é€£æ¥é€å­—ç¨¿æœå‹™')
      await this.transcriptService.connect(this.currentSession.id)
      this.setupTranscriptListener()
      this.logSuccess('é€å­—ç¨¿æœå‹™é€£æ¥æˆåŠŸ')

      // æ­¥é©Ÿ 4: é–‹å§‹éŒ„éŸ³
      this.logInfo('æ­¥é©Ÿ 4: é–‹å§‹éŒ„éŸ³')
      await this.recordingService.startRecording(this.currentSession.id)

      // é€šçŸ¥å…¨åŸŸç‹€æ…‹ï¼šè¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“ï¼Œå•Ÿå‹•è¨ˆæ™‚å™¨
      try {
        const setRecordingStart = (await import('../app-store-zustand')).useAppStore.getState().setRecordingStart
        setRecordingStart(Date.now())
        console.log('ğŸ• [RecordingFlowService] å·²é€é AppStore è¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“')
      } catch (e) {
        console.warn('âš ï¸ [RecordingFlowService] ç„¡æ³•è¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“:', e)
      }

      this.logSuccess('éŒ„éŸ³å•Ÿå‹•æˆåŠŸ')

      // æ¨™è¨˜æµç¨‹ç‚ºæ´»èº
      this.isFlowActive = true

      this.logSuccess('éŒ„éŸ³æµç¨‹å•Ÿå‹•å®Œæˆ', {
        sessionId: this.currentSession.id,
        isRecording: this.recordingService.isRecording(),
        transcriptConnected: this.transcriptService.isConnected(this.currentSession.id)
      })

      // è¨ºæ–·è³‡è¨Š
      console.log('ğŸ‰ [RecordingFlowService] éŒ„éŸ³æµç¨‹å·²å®Œå…¨å•Ÿå‹•', {
        sessionId: this.currentSession.id,
        audioRecording: this.recordingService.isRecording() ? 'âœ… éŒ„éŸ³ä¸­' : 'âŒ æœªéŒ„éŸ³',
        transcriptWS: this.transcriptService.isConnected(this.currentSession.id) ? 'âœ… å·²é€£æ¥' : 'âŒ æœªé€£æ¥',
        recordingState: this.recordingService.getRecordingState(),
        timestamp: new Date().toISOString()
      })

      console.log('ğŸ“‹ [RecordingFlowService] è«‹æª¢æŸ¥ï¼š')
      console.log('1. æ‡‰è©²æ¯ç§’çœ‹åˆ° [AudioRecorder] ondataavailable è§¸ç™¼')
      console.log('2. æ‡‰è©²æ¯ç§’çœ‹åˆ° [AudioUploadWebSocket] Binary frame å·²é€å‡º')
      console.log('3. DevTools > Network > WS > /ws/upload_audio æ‡‰è©²çœ‹åˆ° binary frames')
      console.log('4. DevTools > Network > WS > /ws/transcript_feed æ‡‰è©²æ”¶åˆ°é€å­—ç¨¿')

      return this.currentSession

    } catch (error) {
      await this.cleanupFlowResources()
      this.handleError('é–‹å§‹éŒ„éŸ³æµç¨‹', error)
      throw error
    }
  }

  /**
   * åœæ­¢éŒ„éŸ³æµç¨‹
   */
  async stopRecordingFlow(): Promise<void> {
    this.logInfo('åœæ­¢éŒ„éŸ³æµç¨‹')

    try {
      if (!this.isFlowActive || !this.currentSession) {
        this.logWarning('æ²’æœ‰æ´»èºçš„éŒ„éŸ³æµç¨‹')
        return
      }

      const sessionId = this.currentSession.id

      // æ­¥é©Ÿ 1: åœæ­¢éŒ„éŸ³
      this.logInfo('æ­¥é©Ÿ 1: åœæ­¢éŒ„éŸ³')
      if (this.recordingService.isRecording()) {
        await this.recordingService.stopRecording()
        this.logSuccess('éŒ„éŸ³å·²åœæ­¢')
      }

      // æ­¥é©Ÿ 2: æ–·é–‹é€å­—ç¨¿æœå‹™ï¼ˆä¿æŒé€£æ¥ä»¥æ¥æ”¶å‰©é¤˜è™•ç†çµæœï¼‰
      this.logInfo('æ­¥é©Ÿ 2: æ–·é–‹é€å­—ç¨¿æœå‹™')
      await this.transcriptService.disconnect(sessionId)
      this.logSuccess('é€å­—ç¨¿æœå‹™å·²æ–·é–‹')

      // æ­¥é©Ÿ 3: å®Œæˆæœƒè©±
      this.logInfo('æ­¥é©Ÿ 3: å®Œæˆæœƒè©±')
      await this.sessionService.finishSession(sessionId)
      this.logSuccess('æœƒè©±å·²å®Œæˆ')

      // é‡ç½®æµç¨‹ç‹€æ…‹
      this.isFlowActive = false

      this.logSuccess('éŒ„éŸ³æµç¨‹åœæ­¢å®Œæˆ', {
        sessionId,
        transcriptEntriesCount: this.transcriptEntries.length,
        finalRecordingTime: this.recordingService.getRecordingTime()
      })

    } catch (error) {
      this.handleError('åœæ­¢éŒ„éŸ³æµç¨‹', error)
      throw error
    } finally {
      // ç¢ºä¿è³‡æºæ¸…ç†
      await this.cleanupFlowResources()
    }
  }

  /**
   * å–å¾—ç•¶å‰æœƒè©±
   */
  getCurrentSession(): SessionResponse | null {
    return this.currentSession
  }

  /**
   * æª¢æŸ¥æµç¨‹æ˜¯å¦æ´»èº
   */
  isFlowRunning(): boolean {
    return this.isFlowActive
  }

  /**
   * å–å¾—é€å­—ç¨¿é …ç›®
   */
  getTranscriptEntries(): Array<{ time: string; text: string }> {
    return [...this.transcriptEntries]
  }

  /**
   * å–å¾—éŒ„éŸ³ç‹€æ…‹
   */
  getRecordingState() {
    return this.recordingService.getRecordingState()
  }

  /**
   * è¨­å®šé€å­—ç¨¿ç›£è½å™¨
   */
  private setupTranscriptListener(): void {
    if (!this.currentSession) return

    const sessionId = this.currentSession.id

    // ç§»é™¤ç¾æœ‰ç›£è½å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
    this.transcriptService.removeTranscriptListener(sessionId, this.handleTranscriptMessage)

    // æ·»åŠ æ–°çš„ç›£è½å™¨
    this.transcriptService.addTranscriptListener(sessionId, this.handleTranscriptMessage)

    this.logInfo('é€å­—ç¨¿ç›£è½å™¨å·²è¨­å®š', { sessionId })
  }

  /**
   * è™•ç†é€å­—ç¨¿è¨Šæ¯
   */
  private handleTranscriptMessage = (msg: TranscriptMessage): void => {
    try {
      // 1. åˆ¤æ–·è¨Šæ¯å‹åˆ¥
      if (
        (msg.type === 'transcript' || msg.type === 'transcript_segment') &&
        msg.text
      ) {
        /* 2. è¨ˆç®— startSec
           a. å¾Œç«¯è‹¥æœ‰ start_time â†’ ç”¨å®ƒ
           b. å¦å‰‡ç”¨ chunk_sequence Ã— åˆ‡ç‰‡é•·åº¦
        */
        const startSec =
          msg.start_time !== undefined
            ? msg.start_time
            : (msg.chunk_sequence ?? 0) * AUDIO_CHUNK_SEC;

        /* 3. æ¯éš” labelIntervalSec ç§’æ’å…¥ä¸€æ¢æ™‚é–“ç¢¼ */
        if (startSec - this.lastLabelSec >= this.labelIntervalSec) {
          this.transcriptEntries.push({
            time: formatTime(startSec),
            text: '',              // ç´”æ™‚é–“æ¨™ç±¤
          })
          this.lastLabelSec = startSec
        }

        /* 4. çœŸæ­£çš„é€å­—ç¨¿è¡Œ */
        this.transcriptEntries.push({
          time: formatTime(startSec),
          text: msg.text.trim(),
        })
      } else if (msg.type === 'error') {
        this.logWarning('é€å­—ç¨¿éŒ¯èª¤', msg)
      } else if (msg.type === 'transcript_complete') {
        this.setAppState('finished')
        if (this.currentSession) {
          this.transcriptService.disconnect(this.currentSession.id)
        }
        this.isFlowActive = false
        this.logSuccess('æ”¶åˆ° transcript_completeï¼Œæµç¨‹çµæŸ')
      }
    } catch (e) {
      this.logWarning('è™•ç†é€å­—ç¨¿è¨Šæ¯å¤±æ•—', e)
    }
  }

  /**
   * æ¸…ç†æµç¨‹è³‡æº
   */
  private async cleanupFlowResources(): Promise<void> {
    try {
      // åœæ­¢éŒ„éŸ³ï¼ˆå¦‚æœé‚„åœ¨éŒ„éŸ³ï¼‰
      if (this.recordingService?.isRecording()) {
        await this.recordingService.stopRecording()
      }

      // æ–·é–‹é€å­—ç¨¿æœå‹™
      if (this.currentSession && this.transcriptService?.isConnected(this.currentSession.id)) {
        await this.transcriptService.disconnect(this.currentSession.id)
      }

      // é‡ç½®ç‹€æ…‹
      this.currentSession = null
      this.isFlowActive = false

      this.logInfo('æµç¨‹è³‡æºæ¸…ç†å®Œæˆ')
    } catch (error) {
      this.logWarning('æ¸…ç†æµç¨‹è³‡æºæ™‚ç™¼ç”ŸéŒ¯èª¤', error)
    }
  }

  /**
   * å–å¾—æµç¨‹è©³ç´°ç‹€æ…‹
   */
  async getFlowStatus() {
    const baseStatus = this.getStatus()

    return {
      ...baseStatus,
      isFlowActive: this.isFlowActive,
      currentSession: this.currentSession,
      transcriptEntriesCount: this.transcriptEntries.length,
      recordingState: this.recordingService?.getRecordingState() || null,
      transcriptConnected: this.currentSession
        ? this.transcriptService?.isConnected(this.currentSession.id) || false
        : false
    }
  }
}


# END FILE CONTENTS


# File: frontend/components/ui/accordion.tsx

"use client"

import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }


# END FILE CONTENTS


# File: app/utils/validators.py

"""
æª”æ¡ˆé©—è­‰å·¥å…·

å¯¦ä½œå„ç¨®æª”æ¡ˆæ ¼å¼çš„åŸºæœ¬é©—è­‰åŠŸèƒ½
"""

import logging

logger = logging.getLogger(__name__)


def valid_webm(head: bytes) -> bool:
    """
    é©—è­‰ WebM æª”æ¡ˆæ ¼å¼

    æª¢æŸ¥ EBML header é­”è¡“æ•¸å­— 0x1A45DFA3
    WebM æ˜¯åŸºæ–¼ Matroska å®¹å™¨æ ¼å¼ï¼Œä½¿ç”¨ EBML ç·¨ç¢¼

    Args:
        head: æª”æ¡ˆé–‹é ­çš„ä½å…ƒçµ„è³‡æ–™ï¼ˆè‡³å°‘éœ€è¦ 4 bytesï¼‰

    Returns:
        bool: å¦‚æœæ˜¯æœ‰æ•ˆçš„ WebM æª”æ¡ˆå‰‡è¿”å› True
    """
    if len(head) < 4:
        logger.warning("æª”æ¡ˆéå°ï¼Œç„¡æ³•é€²è¡Œ WebM æ ¼å¼é©—è­‰")
        return False

    # EBML header é­”è¡“æ•¸å­—: 0x1A45DFA3
    ebml_header = b"\x1A\x45\xDF\xA3"

    is_valid = head.startswith(ebml_header)

    if is_valid:
        logger.debug("âœ… WebM æª”æ¡ˆæ ¼å¼é©—è­‰é€šé")
    else:
        logger.warning(f"âŒ WebM æª”æ¡ˆæ ¼å¼é©—è­‰å¤±æ•—: æœŸæœ› {ebml_header.hex()}, å¯¦éš› {head[:4].hex()}")

    return is_valid


def valid_audio_size(size_bytes: int, max_size: int = 5 * 1024 * 1024) -> bool:
    """
    é©—è­‰éŸ³æª”å¤§å°

    Args:
        size_bytes: æª”æ¡ˆå¤§å°ï¼ˆä½å…ƒçµ„ï¼‰
        max_size: æœ€å¤§å…è¨±å¤§å°ï¼ˆé è¨­ 5MBï¼‰

    Returns:
        bool: å¦‚æœæª”æ¡ˆå¤§å°åœ¨å…è¨±ç¯„åœå…§å‰‡è¿”å› True
    """
    is_valid = 0 < size_bytes <= max_size

    if is_valid:
        logger.debug(f"âœ… éŸ³æª”å¤§å°é©—è­‰é€šé: {size_bytes} bytes")
    else:
        logger.warning(f"âŒ éŸ³æª”å¤§å°é©—è­‰å¤±æ•—: {size_bytes} bytes (é™åˆ¶: {max_size} bytes)")

    return is_valid


def valid_sequence_number(seq: int, min_seq: int = 0, max_seq: int = 9999) -> bool:
    """
    é©—è­‰åºè™Ÿç¯„åœ

    Args:
        seq: åºè™Ÿ
        min_seq: æœ€å°åºè™Ÿï¼ˆé è¨­ 0ï¼‰
        max_seq: æœ€å¤§åºè™Ÿï¼ˆé è¨­ 9999ï¼‰

    Returns:
        bool: å¦‚æœåºè™Ÿåœ¨æœ‰æ•ˆç¯„åœå…§å‰‡è¿”å› True
    """
    is_valid = min_seq <= seq <= max_seq

    if is_valid:
        logger.debug(f"âœ… åºè™Ÿé©—è­‰é€šé: {seq}")
    else:
        logger.warning(f"âŒ åºè™Ÿé©—è­‰å¤±æ•—: {seq} (ç¯„åœ: {min_seq}-{max_seq})")

    return is_valid


# END FILE CONTENTS


# File: frontend/components/ui/input.tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }


# END FILE CONTENTS


# File: frontend/hooks/use-notes.ts

"use client"

import { useState, useCallback, useRef, useEffect, useMemo } from 'react'
import { notesAPI, type NoteUpdateRequest, type NoteResponse } from '../lib/api'
import { useLocalDraft } from './use-local-draft'

interface UseNotesReturn {
    noteContent: string
    lastSaved: Date | null
    isSaving: boolean
    error: string | null
    updateNote: (content: string) => void
    saveNote: (sessionId: string) => Promise<void>
    loadNote: (sessionId: string) => Promise<void>
    clearNote: () => void
    // æœ¬åœ°è‰ç¨¿ç›¸é—œ
    hasDraft: boolean
    lastDraftTime: Date | null
    restoreDraft: () => void
    clearDraft: () => void
}

export function useNotes(): UseNotesReturn {
    const [noteContent, setNoteContent] = useState('')
    const [lastSaved, setLastSaved] = useState<Date | null>(null)
    const [isSaving, setIsSaving] = useState(false)
    const [error, setError] = useState<string | null>(null)

    const autoSaveTimeoutRef = useRef<NodeJS.Timeout | null>(null)
    const lastContentRef = useRef('')
    const currentSessionIdRef = useRef<string | null>(null)

    // ä½¿ç”¨æœ¬åœ°è‰ç¨¿åŠŸèƒ½
    const localDraft = useLocalDraft(currentSessionIdRef.current || undefined)

    // æ¸…é™¤è‡ªå‹•å„²å­˜è¨ˆæ™‚å™¨
    const clearAutoSaveTimeout = useCallback(() => {
        if (autoSaveTimeoutRef.current) {
            clearTimeout(autoSaveTimeoutRef.current)
            autoSaveTimeoutRef.current = null
        }
    }, [])

    // åŸ·è¡Œå„²å­˜æ“ä½œ
    const performSave = useCallback(async (sessionId: string, content: string): Promise<void> => {
        if (!content.trim() || content === lastContentRef.current) {
            return // æ²’æœ‰è®Šæ›´ï¼Œä¸éœ€è¦å„²å­˜
        }

        setIsSaving(true)
        setError(null)

        try {
            const updateData: NoteUpdateRequest = {
                content,
                client_ts: new Date().toISOString()
            }

            await notesAPI.updateNote(sessionId, updateData)

            setLastSaved(new Date())
            lastContentRef.current = content
            console.log('âœ… ç­†è¨˜å„²å­˜æˆåŠŸ')

        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å„²å­˜ç­†è¨˜å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å„²å­˜ç­†è¨˜å¤±æ•—:', err)
        } finally {
            setIsSaving(false)
        }
    }, [])

    // æ‰‹å‹•å„²å­˜ç­†è¨˜
    const saveNote = useCallback(async (sessionId: string): Promise<void> => {
        clearAutoSaveTimeout()
        await performSave(sessionId, noteContent)
    }, [noteContent, performSave, clearAutoSaveTimeout])

    // æ›´æ–°ç­†è¨˜å…§å®¹ï¼ˆè§¸ç™¼è‡ªå‹•å„²å­˜ï¼‰
    const updateNote = useCallback((content: string): void => {
        setNoteContent(content)

        // ç«‹å³å„²å­˜æœ¬åœ°è‰ç¨¿
        localDraft.saveDraft(content)

        // å¦‚æœæœ‰ session IDï¼Œè¨­å®šè‡ªå‹•å„²å­˜åˆ°ä¼ºæœå™¨
        if (currentSessionIdRef.current) {
            clearAutoSaveTimeout()

            // 10 ç§’å¾Œè‡ªå‹•å„²å­˜åˆ°ä¼ºæœå™¨
            autoSaveTimeoutRef.current = setTimeout(() => {
                performSave(currentSessionIdRef.current!, content)
            }, 10000)
        }
    }, [performSave, clearAutoSaveTimeout, localDraft])

    // è¼‰å…¥ç­†è¨˜
    const loadNote = useCallback(async (sessionId: string): Promise<void> => {
        currentSessionIdRef.current = sessionId
        setError(null)

        try {
            const note = await notesAPI.getNote(sessionId)
            const serverContent = note.content
            const serverTimestamp = new Date(note.updated_at)

            // æª¢æŸ¥æ˜¯å¦æœ‰è¼ƒæ–°çš„æœ¬åœ°è‰ç¨¿
            if (localDraft.hasDraft && localDraft.isDraftNewer(serverTimestamp)) {
                console.log('âš ï¸ ç™¼ç¾è¼ƒæ–°çš„æœ¬åœ°è‰ç¨¿ï¼Œä½¿ç”¨è‰ç¨¿å…§å®¹')
                setNoteContent(localDraft.draftContent)
                lastContentRef.current = localDraft.draftContent
                // ä¸è¨­å®š lastSavedï¼Œå› ç‚ºè‰ç¨¿å…§å®¹å°šæœªåŒæ­¥åˆ°ä¼ºæœå™¨
            } else {
                setNoteContent(serverContent)
                lastContentRef.current = serverContent
                setLastSaved(serverTimestamp)
                // æ¸…é™¤éæ™‚çš„æœ¬åœ°è‰ç¨¿
                localDraft.clearDraft()
            }

            console.log('âœ… ç­†è¨˜è¼‰å…¥æˆåŠŸ')

        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'è¼‰å…¥ç­†è¨˜å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ è¼‰å…¥ç­†è¨˜å¤±æ•—:', err)

            // å¦‚æœç­†è¨˜ä¸å­˜åœ¨ï¼Œæª¢æŸ¥æ˜¯å¦æœ‰æœ¬åœ°è‰ç¨¿
            if (errorMessage.includes('404') || errorMessage.includes('not found')) {
                if (localDraft.hasDraft) {
                    console.log('ğŸ“ ä½¿ç”¨æœ¬åœ°è‰ç¨¿å…§å®¹')
                    setNoteContent(localDraft.draftContent)
                } else {
                    setNoteContent('')
                }
                lastContentRef.current = ''
                console.log('ğŸ”„ åˆå§‹åŒ–ç©ºç­†è¨˜')
            }
        }
    }, [localDraft])

    // æ¸…é™¤ç­†è¨˜
    const clearNote = useCallback(() => {
        clearAutoSaveTimeout()
        setNoteContent('')
        setLastSaved(null)
        setError(null)
        lastContentRef.current = ''
        currentSessionIdRef.current = null
        localDraft.clearDraft()
        console.log('ğŸ”„ ç­†è¨˜å·²æ¸…é™¤')
    }, [clearAutoSaveTimeout, localDraft])

    // é‚„åŸæœ¬åœ°è‰ç¨¿
    const restoreDraft = useCallback(() => {
        const draftContent = localDraft.loadDraft()
        if (draftContent) {
            setNoteContent(draftContent)
            console.log('ğŸ”„ å·²é‚„åŸæœ¬åœ°è‰ç¨¿')
        }
    }, [localDraft])

    // çµ„ä»¶å¸è¼‰æ™‚æ¸…ç†
    useEffect(() => {
        return () => {
            clearAutoSaveTimeout()
        }
    }, [clearAutoSaveTimeout])

    return useMemo(() => ({
        noteContent,
        lastSaved,
        isSaving,
        error,
        updateNote,
        saveNote,
        loadNote,
        clearNote,
        hasDraft: localDraft.hasDraft,
        lastDraftTime: localDraft.lastDraftTime,
        restoreDraft,
        clearDraft: localDraft.clearDraft,
    }), [
        noteContent,
        lastSaved,
        isSaving,
        error,
        updateNote,
        saveNote,
        loadNote,
        clearNote,
        localDraft.hasDraft,
        localDraft.lastDraftTime,
        restoreDraft,
        localDraft.clearDraft,
    ])
}


# END FILE CONTENTS


# File: frontend/hooks/use-transcript-new.ts

"use client"

import { useState, useCallback, useRef, useEffect } from 'react'
import { useAppStateContext } from './use-app-state-context'
import { isFeatureEnabled } from '../lib/feature-flags'
import { SERVICE_KEYS, serviceContainer } from '../lib/services'
import type { ITranscriptService, TranscriptMessage } from '../lib/services'

interface UseTranscriptNewReturn {
    transcripts: TranscriptMessage[]
    isConnected: boolean
    isCompleted: boolean
    error: string | null
    connect: (sessionId: string) => Promise<void>
    disconnect: () => void
    clearTranscripts: () => void
    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    autoScrollEnabled: boolean
    enableAutoScroll: () => void
    disableAutoScroll: () => void
    scrollToLatest: () => void
    setScrollContainer: (element: HTMLElement | null) => void
}

/**
 * useTranscriptNew - é€å­—ç¨¿ç®¡ç† Hook (é©é…å™¨å±¤)
 *
 * é‡æ§‹ç‚ºé©é…å™¨å±¤ï¼š
 * - å…§éƒ¨èª¿ç”¨ TranscriptService è€Œéç›´æ¥ä½¿ç”¨ transcriptManager
 * - ä¿æŒå°å¤–æ¥å£å®Œå…¨ä¸è®Šï¼Œç¢ºä¿çµ„ä»¶å±¤ç„¡æ„ŸçŸ¥è®Šæ›´
 * - ä¿æŒ TranscriptManager çš„ç¨ç«‹æ€§å’Œ WebSocket é‡é€£æ©Ÿåˆ¶
 */
export function useTranscriptNew(): UseTranscriptNewReturn {
    // ä½¿ç”¨æ–°çš„ Context ç‹€æ…‹ç®¡ç†
    const context = useAppStateContext()

    // æœ¬åœ°ç‹€æ…‹ï¼ˆä¿æŒ TranscriptService ç¨ç«‹æ€§ï¼Œé¿å…å½±éŸ¿ WebSocket é‡é€£æ©Ÿåˆ¶ï¼‰
    const [isConnected, setIsConnected] = useState(false)
    const [isCompleted, setIsCompleted] = useState(false)
    const [localError, setLocalError] = useState<string | null>(null)
    const [autoScrollEnabled, setAutoScrollEnabled] = useState(true)

    const containerRef = useRef<HTMLElement | null>(null)
    const currentSessionIdRef = useRef<string | null>(null)
    const transcriptServiceRef = useRef<ITranscriptService | null>(null)

    console.log('ğŸ”„ [useTranscriptNew] Hook åˆå§‹åŒ– (é©é…å™¨å±¤)', {
        useNewStateManagement: isFeatureEnabled('useNewStateManagement'),
        useNewTranscriptHook: isFeatureEnabled('useNewTranscriptHook'),
        contextTranscriptCount: context.appData.transcriptEntries.length,
    })

    // åˆå§‹åŒ–æœå‹™å¯¦ä¾‹
    const initializeService = useCallback(() => {
        if (!transcriptServiceRef.current) {
            try {
                transcriptServiceRef.current = serviceContainer.resolve<ITranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)
                console.log('âœ… [useTranscriptNew] TranscriptService åˆå§‹åŒ–æˆåŠŸ')
            } catch (error) {
                console.error('âŒ [useTranscriptNew] ç„¡æ³•è§£æ TranscriptService:', error)
                throw new Error('é€å­—ç¨¿æœå‹™åˆå§‹åŒ–å¤±æ•—')
            }
        }
    }, [])

    // è™•ç†é€å­—ç¨¿æ¥æ”¶èˆ‡åˆä½µé‚è¼¯ - æ•´åˆ Context
    const handleTranscript = useCallback((transcript: TranscriptMessage) => {
        if (transcript.type === 'transcript_complete') {
            setIsCompleted(true)
            // è§¸ç™¼ç‹€æ…‹è½‰æ›
            context.transition('PROCESSING_COMPLETED')
            return
        }

        const anyMessage = transcript as any
        if (anyMessage.type === 'error') {
            const errorMessage = anyMessage.error_message || 'è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤'
            setLocalError(errorMessage)
            context.setError(errorMessage)
            return
        }

        if (transcript.type === 'transcript_segment' && transcript.text) {
            const startTime = transcript.start_time ?? 0
            const hours = Math.floor(startTime / 3600)
            const minutes = Math.floor((startTime % 3600) / 60)
            const seconds = Math.floor(startTime % 60)
            const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

            context.addTranscriptEntry({
                time: timeStr,
                text: transcript.text,
            })
        }
    }, [context])

    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    const scrollToLatest = useCallback(() => {
        if (containerRef.current && autoScrollEnabled) {
            containerRef.current.scrollTop = containerRef.current.scrollHeight
        }
    }, [autoScrollEnabled])

    // æª¢æ¸¬ä½¿ç”¨è€…æ»¾å‹• - é›¢åº•éƒ¨ >60px æ™‚ç¦ç”¨è‡ªå‹•æ²å‹•
    const handleScroll = useCallback((event: Event) => {
        const container = event.target as HTMLElement
        if (!container) return

        const { scrollTop, scrollHeight, clientHeight } = container
        const distanceFromBottom = scrollHeight - scrollTop - clientHeight

        if (distanceFromBottom > 60) {
            setAutoScrollEnabled(false)
        } else if (distanceFromBottom <= 10) {
            setAutoScrollEnabled(true)
        }
    }, [])

    // è¨­å®šè‡ªå‹•æ²å‹•å®¹å™¨
    const setScrollContainer = useCallback((element: HTMLElement | null) => {
        if (containerRef.current) {
            containerRef.current.removeEventListener('scroll', handleScroll)
        }

        containerRef.current = element

        if (element) {
            element.addEventListener('scroll', handleScroll)
        }
    }, [handleScroll])

    // å•Ÿç”¨è‡ªå‹•æ²å‹•
    const enableAutoScroll = useCallback(() => {
        setAutoScrollEnabled(true)
        scrollToLatest()
    }, [scrollToLatest])

    // ç¦ç”¨è‡ªå‹•æ²å‹•
    const disableAutoScroll = useCallback(() => {
        setAutoScrollEnabled(false)
    }, [])

    // é€£æ¥ TranscriptService - ä½¿ç”¨æœå‹™å±¤
    const connect = useCallback(async (sessionId: string): Promise<void> => {
        try {
            setLocalError(null)
            context.setError(null)
            setIsCompleted(false)

            console.log('ğŸ”Œ [useTranscriptNew] é€£æ¥é€å­—ç¨¿æœå‹™ (é©é…å™¨å±¤):', sessionId)

            // åˆå§‹åŒ–æœå‹™
            initializeService()
            const transcriptService = transcriptServiceRef.current!

            // å…ˆç§»é™¤ä¹‹å‰çš„ç›£è½å™¨
            if (currentSessionIdRef.current) {
                transcriptService.removeTranscriptListener(currentSessionIdRef.current, handleTranscript)
            }

            // ä½¿ç”¨æœå‹™å±¤é€£æ¥
            await transcriptService.connect(sessionId)
            transcriptService.addTranscriptListener(sessionId, handleTranscript)

            currentSessionIdRef.current = sessionId
            setIsConnected(transcriptService.isConnected(sessionId))

            console.log('âœ… [useTranscriptNew] é€å­—ç¨¿æœå‹™é€£æ¥æˆåŠŸ (æœå‹™å±¤):', sessionId)

        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'é€£æ¥é€å­—ç¨¿æœå‹™å¤±æ•—'
            setLocalError(errorMessage)
            context.setError(errorMessage)
            setIsConnected(false)
            console.error('âŒ [useTranscriptNew] é€£æ¥é€å­—ç¨¿æœå‹™å¤±æ•—:', err)
        }
    }, [handleTranscript, context, initializeService])

    // æ–·é–‹é€£æ¥ - ä½¿ç”¨æœå‹™å±¤
    const disconnect = useCallback(() => {
        console.log('ğŸ”Œ [useTranscriptNew] æ–·é–‹é€å­—ç¨¿æœå‹™ (é©é…å™¨å±¤)')

        const transcriptService = transcriptServiceRef.current
        if (currentSessionIdRef.current && transcriptService) {
            transcriptService.removeTranscriptListener(currentSessionIdRef.current, handleTranscript)

            // ä½¿ç”¨æœå‹™å±¤æ–·é–‹é€£æ¥ï¼ˆå¦‚æœæœ‰æœƒè©±IDï¼‰
            transcriptService.disconnect(currentSessionIdRef.current)

            currentSessionIdRef.current = null
        }

        setIsConnected(false)
        console.log('âœ… [useTranscriptNew] é€å­—ç¨¿æœå‹™æ–·é–‹æˆåŠŸ (æœå‹™å±¤)')
    }, [handleTranscript])

    // æ¸…ç©ºé€å­—ç¨¿ - ä½¿ç”¨ Context
    const clearTranscripts = useCallback(() => {
        context.setTranscriptEntries([])
        setIsCompleted(false)
        console.log('ğŸ”„ [useTranscriptNew] é€å­—ç¨¿å·²æ¸…é™¤ (é©é…å™¨å±¤)')
    }, [context])

    // è‡ªå‹•æ²å‹•æ•ˆæœ
    useEffect(() => {
        if (context.appData.transcriptEntries.length > 0) {
            scrollToLatest()
        }
    }, [context.appData.transcriptEntries, scrollToLatest])

    // æ¸…ç†è³‡æº
    useEffect(() => {
        return () => {
            const transcriptService = transcriptServiceRef.current
            if (currentSessionIdRef.current && transcriptService) {
                transcriptService.removeTranscriptListener(currentSessionIdRef.current, handleTranscript)
            }

            if (containerRef.current) {
                containerRef.current.removeEventListener('scroll', handleScroll)
            }
        }
    }, [handleTranscript, handleScroll])

    // è½‰æ› Context ä¸­çš„ transcriptEntries ç‚º TranscriptMessage æ ¼å¼ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
    const compatibleTranscripts: TranscriptMessage[] = context.appData.transcriptEntries.map((entry, index) => ({
        type: 'transcript_segment',
        text: entry.text,
        start_time: 0,
        end_time: 0,
        start_sequence: index,
        confidence: 1.0,
        timestamp: Date.now(),
    }))

    return {
        transcripts: compatibleTranscripts,
        isConnected,
        isCompleted,
        error: context.error || localError,
        connect,
        disconnect,
        clearTranscripts,
        autoScrollEnabled,
        enableAutoScroll,
        disableAutoScroll,
        scrollToLatest,
        setScrollContainer,
    }
}


# END FILE CONTENTS


# File: app/db/__init__.py



# END FILE CONTENTS


# File: e2e/export-api.spec.ts

const TEST_SESSION_ID = 'EE002F79-B1C1-4900-A0BA-C81FDA4F89FD'


# END FILE CONTENTS


# File: main.py

"""
StudyScriber FastAPI æ‡‰ç”¨ç¨‹å¼ä¸»å…¥å£

é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼šé‚ŠéŒ„é‚Šè½‰éŒ„ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³æ¨¡å¼
"""

import os
import uvicorn
from contextlib import asynccontextmanager
from fastapi import FastAPI, HTTPException, WebSocket
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import JSONResponse, Response
from datetime import datetime
import logging

# Task 5: Prometheus ç›£æ§æ”¯æ´
try:
    from prometheus_client import generate_latest, CONTENT_TYPE_LATEST
    PROMETHEUS_AVAILABLE = True
except ImportError:
    PROMETHEUS_AVAILABLE = False

from app.db.database import auto_init_database, check_database_connection, check_tables_exist, get_database_stats, get_database_mode
from app.api.sessions import router as sessions_router
from app.api.notes import router as notes_router
from app.api.segments import router as segments_router
from app.ws.upload_audio import router as upload_audio_router
from app.ws.transcript_feed import router as transcript_feed_router
from app.core.ffmpeg import check_ffmpeg_health
from app.core.config import settings
from app.core.container import container
from app.services.stt.factory import get_provider
from app.services.azure_openai_v2 import queue_manager

# é…ç½®æ—¥èªŒ
logging.basicConfig(level=settings.LOG_LEVEL, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

@asynccontextmanager
async def lifespan(app: FastAPI):
    """
    æ‡‰ç”¨ç¨‹å¼ç”Ÿå‘½é€±æœŸç®¡ç†

    å•Ÿå‹•æ™‚åˆå§‹åŒ–è³‡æ–™åº«ï¼Œé—œé–‰æ™‚æ¸…ç†è³‡æº
    """
    # å•Ÿå‹•æ™‚åŸ·è¡Œ
    logger.info("ğŸš€ StudyScriber æ­£åœ¨å•Ÿå‹•...")
    check_ffmpeg_health()
    await check_database_connection()

    # Task 3: å•Ÿå‹•éšŠåˆ—ç®¡ç†å™¨
    try:
        await queue_manager.start_workers()
        logger.info("âœ… è½‰éŒ„éšŠåˆ—ç®¡ç†å™¨å•Ÿå‹•æˆåŠŸ")
    except Exception as e:
        logger.error(f"âŒ éšŠåˆ—ç®¡ç†å™¨å•Ÿå‹•å¤±æ•—: {e}")

    yield

    # é—œé–‰æ™‚åŸ·è¡Œ
    logger.info("ğŸ”„ StudyScriber æ­£åœ¨é—œé–‰...")

    # Task 3: åœæ­¢éšŠåˆ—ç®¡ç†å™¨
    try:
        await queue_manager.stop_workers()
        logger.info("âœ… è½‰éŒ„éšŠåˆ—ç®¡ç†å™¨å·²åœæ­¢")
    except Exception as e:
        logger.warning(f"âš ï¸ éšŠåˆ—ç®¡ç†å™¨åœæ­¢æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")

# å»ºç«‹ FastAPI æ‡‰ç”¨ç¨‹å¼
app = FastAPI(
    title="StudyScriber API",
    description="é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼šé‚ŠéŒ„é‚Šè½‰éŒ„ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³æ¨¡å¼",
    version="0.1.0",
    lifespan=lifespan
)

# CORS è¨­å®š
cors_origins = os.getenv("CORS_ORIGINS", "http://localhost:3000").split(",")
app.add_middleware(
    CORSMiddleware,
    allow_origins=cors_origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# è¨»å†Šè·¯ç”±
app.include_router(sessions_router)
app.include_router(notes_router)
app.include_router(segments_router)
app.include_router(upload_audio_router)
app.include_router(transcript_feed_router)


@app.get("/")
async def root():
    """æ ¹è·¯ç”± - API ç‹€æ…‹æª¢æŸ¥"""
    return {
        "message": "StudyScriber API is running",
        "version": "0.1.0",
        "status": "healthy"
    }


@app.get("/debug/container")
async def debug_container():
    """é™¤éŒ¯ç«¯é» - æª¢æŸ¥ provider ç‹€æ…‹"""
    try:
        # æŸ¥è©¢ provider ç‹€æ…‹
        # é€™è£¡åƒ…ç¤ºç¯„æŸ¥è©¢ä¸€å€‹ sessionï¼ˆå¯æ ¹æ“šå¯¦éš›éœ€æ±‚èª¿æ•´ï¼‰
        from uuid import UUID
        test_session_id = UUID("00000000-0000-0000-0000-000000000000")  # TODO: æ”¹ç‚ºå¯¦éš› session id
        provider = get_provider(test_session_id)
        return {
            "status": "success",
            "provider": provider.name(),
            "class_name": type(provider).__name__,
        }
    except Exception as e:
        return {
            "status": "error",
            "error": str(e)
        }


@app.get("/health")
async def health_check():
    """å¥åº·æª¢æŸ¥ç«¯é»"""
    try:
        db_ok = await check_database_connection()
        if not db_ok:
            raise HTTPException(status_code=503, detail="Database connection failed")
        tables_ok = await check_tables_exist()
        if not tables_ok:
            raise HTTPException(status_code=503, detail="Database tables missing")
        ffmpeg_health = check_ffmpeg_health()
        # æŸ¥è©¢ provider ç‹€æ…‹
        from uuid import UUID
        test_session_id = UUID("00000000-0000-0000-0000-000000000000")  # TODO: æ”¹ç‚ºå¯¦éš› session id
        try:
            provider = get_provider(test_session_id)
            provider_available = provider is not None
        except Exception as e:
            logger.warning(f"Provider è§£æå¤±æ•—: {e}")
            provider_available = False
        return {
            "status": "healthy",
            "database": "connected",
            "tables": "available",
            "services": {
                "ffmpeg": {
                    "available": ffmpeg_health['ffmpeg_available'],
                    "status": ffmpeg_health['status'],
                    "version": ffmpeg_health.get('version', 'N/A'),
                    "processes": {
                        "active": ffmpeg_health.get('active_processes', 0),
                        "pooled": ffmpeg_health.get('pooled_processes', 0),
                        "max": ffmpeg_health.get('max_processes', 3)
                    }
                },
                "provider": {
                    "available": provider_available,
                    "service": provider.name() if provider_available else "Disabled"
                }
            }
        }
    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(status_code=503, detail=f"Health check failed: {str(e)}")


@app.get("/database")
async def database_info():
    """è³‡æ–™åº«è³‡è¨Šç«¯é»"""
    try:
        # å–å¾—è³‡æ–™åº«çµ±è¨ˆ
        db_stats = await get_database_stats()

        # å–å¾—é€£æ¥æ¨¡å¼
        connection_mode = get_database_mode()

        # æª¢æŸ¥é€£æ¥ç‹€æ…‹
        connection_ok = await check_database_connection()

        # æª¢æŸ¥è¡¨æ ¼ç‹€æ…‹
        tables_ok = await check_tables_exist()

        return {
            "status": "success",
            "timestamp": datetime.utcnow().isoformat(),
            "connection": {
                "mode": connection_mode,
                "status": "connected" if connection_ok else "disconnected",
                "tables_available": tables_ok
            },
            "statistics": db_stats
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ç„¡æ³•å–å¾—è³‡æ–™åº«è³‡è¨Š: {str(e)}")


@app.get("/performance")
async def performance_stats():
    """æ•ˆèƒ½çµ±è¨ˆç«¯é»"""
    try:
        # å–å¾—è½‰éŒ„æœå‹™æ•ˆèƒ½çµ±è¨ˆ
        # é€™è£¡éœ€è¦æ ¹æ“šå¯¦éš›çš„ provider æ¶æ§‹ä¾†èª¿æ•´ï¼Œ
        # ä¾‹å¦‚ï¼Œå¦‚æœ provider æœ¬èº«æœ‰ get_performance_report æ–¹æ³•
        # å‰‡å¯ä»¥å¾ provider ç²å–ï¼Œå¦å‰‡è¿”å›é è¨­å€¼ã€‚
        # ç›®å‰ï¼Œæˆ‘å€‘åªä¿ç•™äº† queue_manager çš„å•Ÿå‹•/é—œé–‰ï¼Œ
        # æ‰€ä»¥é€™è£¡è¿”å›ä¸€å€‹é è¨­å€¼ã€‚
        return {
            "status": "success",
            "timestamp": datetime.utcnow().isoformat(),
            "transcription_service": {"status": "no_stats_available"},
            "ffmpeg_service": {
                "status": "N/A",
                "available": False,
                "active_processes": 0,
                "pooled_processes": 0
            }
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ç„¡æ³•å–å¾—æ•ˆèƒ½çµ±è¨ˆ: {str(e)}")


@app.get("/debug/queue")
async def debug_queue():
    """Task 3 & 4: é™¤éŒ¯ç«¯é» - æª¢æŸ¥éšŠåˆ—ç‹€æ…‹"""
    try:
        stats = queue_manager.get_stats()
        return {
            "status": "success",
            "queue_stats": stats,
            "timestamp": datetime.utcnow().isoformat()
        }
    except Exception as e:
        return {
            "status": "error",
            "queue_stats": {
                "error": str(e)
            }
        }


@app.get("/metrics")
async def metrics():
    """Task 5: Prometheus ç›£æ§æŒ‡æ¨™ç«¯é»"""
    if not PROMETHEUS_AVAILABLE:
        raise HTTPException(
            status_code=503,
            detail="Prometheus metrics not available - prometheus-client not installed"
        )

    try:
        # ç”Ÿæˆ Prometheus æ ¼å¼çš„ç›£æ§æŒ‡æ¨™
        metrics_data = generate_latest()
        return Response(
            content=metrics_data,
            media_type=CONTENT_TYPE_LATEST,
            headers={
                "Content-Type": CONTENT_TYPE_LATEST,
                "Cache-Control": "no-cache, no-store, must-revalidate",
                "Pragma": "no-cache",
                "Expires": "0"
            }
        )
    except Exception as e:
        logger.error(f"Failed to generate metrics: {e}")
        raise HTTPException(
            status_code=500,
            detail=f"Failed to generate metrics: {str(e)}"
        )


# å…¨åŸŸä¾‹å¤–è™•ç†å™¨
@app.exception_handler(Exception)
async def global_exception_handler(request, exc):
    """å…¨åŸŸä¾‹å¤–è™•ç†"""
    return JSONResponse(
        status_code=500,
        content={
            "error": "Internal server error",
            "message": str(exc),
            "path": str(request.url)
        }
    )


if __name__ == "__main__":
    # è¨­ç½® workers=1 ç¢ºä¿åœ¨å–®ä¸€é€²ç¨‹ä¸­é‹è¡Œï¼Œ
    # é€™å°æ–¼ä½¿ç”¨å…§å­˜å­˜å„² WebSocket é€£æ¥ç‹€æ…‹è‡³é—œé‡è¦ã€‚
    # å¤šé€²ç¨‹æœƒå°è‡´æ¯å€‹é€²ç¨‹æœ‰ç¨ç«‹çš„ ConnectionManager å¯¦ä¾‹ã€‚
    uvicorn.run(
        "main:app",
        host="0.0.0.0",
        port=8000,
        reload=True,
        workers=1
    )


# END FILE CONTENTS


# File: app/services/stt/lang_map.py

"""Convert canonical BCP-47 lang_code â‡„ provider-specific code."""

_CANONICAL_TO_SHORT = {
    "zh-TW": "zh",
    "zh":    "zh",
    "en-US": "en",
    "en":    "en",
}

def to_whisper(code: str) -> str:
    """Whisper ç«¯é»èªè¨€ç¢¼ï¼ˆISO-639-1ï¼Œå°å¯«ï¼›æœªçŸ¥â†’'auto')."""
    return _CANONICAL_TO_SHORT.get(code, "auto")

def to_gpt4o(code: str) -> str:
    """GPT-4o speech-transcribe èªè¨€ç¢¼ï¼ˆåŒ Whisperï¼‰"""
    return _CANONICAL_TO_SHORT.get(code, "auto")


# END FILE CONTENTS


# File: frontend/components/ui/aspect-ratio.tsx

"use client"

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }


# END FILE CONTENTS


# File: app/services/stt/gpt4o_provider.py

# app/services/stt/gpt4o_provider.py
from __future__ import annotations

import logging
from datetime import datetime
from io import BytesIO
from typing import Any, Dict
from uuid import UUID

from openai import AsyncAzureOpenAI, RateLimitError

from app.core.config import get_settings
from app.core.ffmpeg import detect_audio_format, webm_to_wav
from app.db.database import get_supabase_client
from app.services.stt.interfaces import ISTTProvider
from app.services.stt.lang_map import to_gpt4o
from app.utils.timer import PerformanceTimer
from app.utils.timing import calc_times

settings = get_settings()
logger = logging.getLogger(__name__)


class GPT4oProvider(ISTTProvider):
    """Azure GPT-4o Audio Transcriptions"""

    name = "gpt4o"
    _client: AsyncAzureOpenAI | None = None

    # ---------- client singleton ------------------------------------
    @classmethod
    def _client_lazy(cls) -> AsyncAzureOpenAI:
        if cls._client is None:
            api_key_raw = settings.AZURE_OPENAI_API_KEY
            api_key = (
                api_key_raw.get_secret_value()
                if hasattr(api_key_raw, "get_secret_value")
                else api_key_raw
            )
            cls._client = AsyncAzureOpenAI(
                api_key=api_key,
                azure_endpoint=settings.AZURE_OPENAI_ENDPOINT,
                api_version="2024-06-01",
                timeout=(5, 55),          # connect / read
                max_retries=2,
            )
        return cls._client

    # ---------- main -------------------------------------------------
    async def transcribe(
        self,
        audio: bytes,
        session_id: UUID,
        chunk_seq: int,
    ) -> Dict[str, Any] | None:
        """
        â€¢ å°‡ WebMâ†’WAVï¼ˆ16 kHz monoï¼‰
        â€¢ å‘¼å« GPT-4o å–å¾— text
        â€¢ å›å‚³çµ±ä¸€æ¬„ä½ï¼›None ä»£è¡¨è·³é
        """

        # 1. å–å¾— canonical lang_code â†’ zh / en / auto
        supa = get_supabase_client()
        row = (
            supa.table("sessions").select("lang_code")
            .eq("id", str(session_id)).single().execute()
        )
        canonical = (row.data or {}).get("lang_code", "zh-TW")
        api_lang = to_gpt4o(canonical)

        # 2. è½‰ WAV
        fmt = detect_audio_format(audio)
        if fmt not in ("webm", "wav"):
            logger.error("GPT4o ä¸æ”¯æ´æ ¼å¼ %s", fmt)
            return None

        wav_bytes = await webm_to_wav(audio) if fmt == "webm" else audio
        if not wav_bytes:
            logger.error("WebMâ†’WAV è½‰æ›å¤±æ•— %s seq=%s", session_id, chunk_seq)
            return None

        # 3. å‘¼å« GPT-4o
        client = self._client_lazy()
        with PerformanceTimer(f"gpt4o chunk {chunk_seq}"):
            try:
                # (filename, bytes/IO, mime)
                file_tuple = ("chunk.wav", wav_bytes, "audio/wav")
                resp = await client.audio.transcriptions.create(
                    model=settings.GPT4O_DEPLOYMENT_NAME,
                    file=file_tuple,
                    language=api_lang,
                    response_format="json",
                    prompt=settings.GPT4O_TRANSCRIBE_PROMPT or None,
                )
            except RateLimitError as e:
                logger.warning("GPT4o 429: %s", e)
                raise
            except Exception as e:
                logger.error("GPT4o API error: %s", e, exc_info=True)
                return None

        text = getattr(resp, "text", "").strip()
        if not text:
            logger.info("GPT4o ç©ºç™½æ–‡å­— %s seq=%s", session_id, chunk_seq)
            return None

        # 4. æ™‚é–“æˆ³ = chunk_seq Ã— D
        start_time, end_time = calc_times(chunk_seq)

        return {
            "text": text,
            "chunk_sequence": chunk_seq,
            "session_id": str(session_id),
            "lang_code": canonical,
            "start_time": start_time,
            "end_time": end_time,
            "timestamp": datetime.utcnow().isoformat(),
            "duration": settings.AUDIO_CHUNK_DURATION_SEC,
        }

    # ---------- meta -----------------------------------------------
    def max_rpm(self) -> int:
        return getattr(settings, "GPT4O_MAX_REQUESTS", 60)


# END FILE CONTENTS


# File: frontend/components/ui/badge.tsx

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }


# END FILE CONTENTS


# File: app/schemas/note.py

"""
StudyScriber Note Pydantic æ¨¡å‹

å®šç¾©ç­†è¨˜ç›¸é—œçš„è«‹æ±‚å’ŒéŸ¿æ‡‰æ¨¡å‹
"""

from datetime import datetime
from typing import Optional
from uuid import UUID
from pydantic import BaseModel, Field, ConfigDict, field_validator


class NoteSaveRequest(BaseModel):
    """å„²å­˜ç­†è¨˜è«‹æ±‚"""
    content: str = Field(description="ç­†è¨˜å…§å®¹ï¼ˆMarkdown æ ¼å¼ï¼‰")
    client_ts: Optional[datetime] = Field(None, description="å®¢æˆ¶ç«¯æ™‚é–“æˆ³")

    @field_validator('content')
    @classmethod
    def validate_content_length(cls, v: str) -> str:
        """é©—è­‰ç­†è¨˜å…§å®¹é•·åº¦ï¼ˆé™åˆ¶ 1MBï¼‰"""
        if len(v.encode('utf-8')) > 1024 * 1024:  # 1MB limit
            raise ValueError('ç­†è¨˜å…§å®¹è¶…é 1MB é™åˆ¶')
        return v


class NoteOut(BaseModel):
    """ç­†è¨˜è¼¸å‡ºæ¨¡å‹"""
    model_config = ConfigDict(
        from_attributes=True,
        json_encoders={UUID: str}  # æ·»åŠ  UUID åˆ°å­—ä¸²çš„åºåˆ—åŒ–å™¨
    )

    session_id: UUID = Field(description="æœƒè©± ID")
    content: str = Field(description="ç­†è¨˜å…§å®¹")
    updated_at: datetime = Field(description="ä¼ºæœå™¨æ›´æ–°æ™‚é–“")
    client_ts: Optional[datetime] = Field(None, description="å®¢æˆ¶ç«¯æ™‚é–“æˆ³")


class NoteSaveResponse(BaseModel):
    """ç­†è¨˜å„²å­˜éŸ¿æ‡‰"""
    success: bool = Field(description="å„²å­˜æ˜¯å¦æˆåŠŸ")
    message: str = Field(description="å›æ‡‰è¨Šæ¯")
    server_ts: datetime = Field(description="ä¼ºæœå™¨æ™‚é–“æˆ³")
    note: Optional[NoteOut] = Field(None, description="æ›´æ–°å¾Œçš„ç­†è¨˜è³‡æ–™")


class NoteConflictError(BaseModel):
    """ç­†è¨˜è¡çªéŒ¯èª¤ï¼ˆå®¢æˆ¶ç«¯æ™‚é–“æˆ³è¼ƒèˆŠï¼‰"""
    model_config = ConfigDict(json_encoders={UUID: str})

    error: str = Field("note_conflict", description="éŒ¯èª¤é¡å‹")
    message: str = Field(description="éŒ¯èª¤è¨Šæ¯")
    server_note: NoteOut = Field(description="ä¼ºæœå™¨ç«¯è¼ƒæ–°çš„ç­†è¨˜è³‡æ–™")
    client_ts: Optional[datetime] = Field(None, description="å®¢æˆ¶ç«¯æ™‚é–“æˆ³")
    server_ts: datetime = Field(description="ä¼ºæœå™¨æ™‚é–“æˆ³")


# END FILE CONTENTS


# File: frontend/hooks/use-mobile.tsx

import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}


# END FILE CONTENTS


# File: frontend/__tests__/integration/app-state-provider.test.tsx

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { render, screen, act } from '@testing-library/react'
import { createElement } from 'react'
import { AppStateProviderWrapper } from '../../providers/app-state-provider-wrapper'
import { useAppState } from '../../hooks/use-app-state-adapter'
import { featureFlagManager } from '../../lib/feature-flags'

// Mock å¤–éƒ¨ä¾è³´
vi.mock('../../hooks/use-session-adapter', () => ({
    useSession: vi.fn(() => ({
        currentSession: null,
        isLoading: false,
        error: null,
        createNoteSession: vi.fn(),
        createRecordingSession: vi.fn(),
        upgradeToRecording: vi.fn(),
        finishSession: vi.fn(),
        deleteSession: vi.fn(),
        checkActiveSession: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-recording-adapter', () => ({
    useRecording: vi.fn(() => ({
        isRecording: false,
        recordingTime: 0,
        transcripts: [],
        error: null,
        startRecording: vi.fn(),
        stopRecording: vi.fn(),
        clearTranscripts: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-notes', () => ({
    useNotes: vi.fn(() => ({
        noteContent: '',
        loadNote: vi.fn(),
        clearNote: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-transcript-adapter', () => ({
    useTranscript: vi.fn(() => ({
        isConnected: false,
        error: null,
        autoScrollEnabled: true,
        disconnect: vi.fn(),
        clearTranscripts: vi.fn(),
        enableAutoScroll: vi.fn(),
        disableAutoScroll: vi.fn(),
        scrollToLatest: vi.fn(),
    }))
}))

vi.mock('@/components/ui/use-toast', () => ({
    useToast: vi.fn(() => ({
        toast: vi.fn(),
    }))
}))

// æ¸¬è©¦çµ„ä»¶
function TestComponent() {
    const { appData, isLoading, error } = useAppState()

    return createElement('div', { 'data-testid': 'test-component' }, [
        createElement('div', { 'data-testid': 'app-state', key: 'state' }, appData.state),
        createElement('div', { 'data-testid': 'is-recording', key: 'recording' }, String(appData.isRecording)),
        createElement('div', { 'data-testid': 'is-loading', key: 'loading' }, String(isLoading)),
        createElement('div', { 'data-testid': 'error', key: 'error' }, error || 'null'),
    ])
}

describe('AppStateProvider æ•´åˆæ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        // é‡ç½®åŠŸèƒ½é–‹é—œ
        featureFlagManager.reset()
        // æ¸…é™¤ localStorage
        localStorage.clear()
    })

    test('åœ¨åŠŸèƒ½é–‹é—œé—œé–‰æ™‚æ‡‰è©²ä½¿ç”¨èˆŠç³»çµ±', () => {
        // ç¢ºä¿åŠŸèƒ½é–‹é—œé—œé–‰
        featureFlagManager.disable('useNewStateManagement')
        featureFlagManager.disable('useNewAppStateHook')

        render(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥çµ„ä»¶æ˜¯å¦æ­£å¸¸æ¸²æŸ“
        expect(screen.getByTestId('test-component')).toBeInTheDocument()
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')
        expect(screen.getByTestId('is-recording')).toHaveTextContent('false')
        // æ³¨æ„ï¼šèˆŠç³»çµ±åœ¨åˆå§‹åŒ–æ™‚å¯èƒ½æœƒæœ‰ loading ç‹€æ…‹ï¼Œé€™æ˜¯æ­£å¸¸çš„
        expect(screen.getByTestId('is-loading')).toBeInTheDocument()
        expect(screen.getByTestId('error')).toHaveTextContent('null')
    })

    test('åœ¨å•Ÿç”¨ useNewStateManagement æ™‚æ‡‰è©²ä½¿ç”¨æ–°ç³»çµ±', () => {
        // å•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç†
        featureFlagManager.enable('useNewStateManagement')

        render(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥çµ„ä»¶æ˜¯å¦æ­£å¸¸æ¸²æŸ“
        expect(screen.getByTestId('test-component')).toBeInTheDocument()
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')
        expect(screen.getByTestId('is-recording')).toHaveTextContent('false')
        expect(screen.getByTestId('is-loading')).toHaveTextContent('false')
        expect(screen.getByTestId('error')).toHaveTextContent('null')
    })

    test('åœ¨å•Ÿç”¨ useNewAppStateHook æ™‚æ‡‰è©²ä½¿ç”¨æ–°ç³»çµ±', () => {
        // å•Ÿç”¨æ–° AppState Hook
        featureFlagManager.enable('useNewAppStateHook')

        render(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥çµ„ä»¶æ˜¯å¦æ­£å¸¸æ¸²æŸ“
        expect(screen.getByTestId('test-component')).toBeInTheDocument()
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')
        expect(screen.getByTestId('is-recording')).toHaveTextContent('false')
        expect(screen.getByTestId('is-loading')).toHaveTextContent('false')
        expect(screen.getByTestId('error')).toHaveTextContent('null')
    })

    test('Provider æ‡‰è©²èƒ½å¤ åŒ…è£å¤šå€‹å­çµ„ä»¶', () => {
        featureFlagManager.enable('useNewStateManagement')

        function MultipleChildrenTest() {
            return createElement('div', null, [
                createElement(TestComponent, { key: 'child1' }),
                createElement(TestComponent, { key: 'child2' }),
            ])
        }

        render(
            createElement(AppStateProviderWrapper, null,
                createElement(MultipleChildrenTest)
            )
        )

        // æª¢æŸ¥æ‰€æœ‰å­çµ„ä»¶éƒ½èƒ½æ­£å¸¸å­˜å–ç‹€æ…‹
        const components = screen.getAllByTestId('test-component')
        expect(components).toHaveLength(2)

        components.forEach(component => {
            expect(component).toBeInTheDocument()
        })
    })

    test('åŠŸèƒ½é–‹é—œåˆ‡æ›æ‡‰è©²ä¸æœƒå½±éŸ¿çµ„ä»¶æ¸²æŸ“', () => {
        // é–‹å§‹æ™‚é—œé–‰åŠŸèƒ½é–‹é—œ
        featureFlagManager.disable('useNewStateManagement')
        featureFlagManager.disable('useNewAppStateHook')

        const { rerender } = render(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥åˆå§‹ç‹€æ…‹
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')

        // å•Ÿç”¨åŠŸèƒ½é–‹é—œä¸¦é‡æ–°æ¸²æŸ“
        act(() => {
            featureFlagManager.enable('useNewStateManagement')
        })

        rerender(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥ç‹€æ…‹ä»ç„¶æ­£å¸¸
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')
        expect(screen.getByTestId('is-recording')).toHaveTextContent('false')
    })
})


# END FILE CONTENTS


# File: frontend/__tests__/integration/state-transitions.test.tsx

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { renderHook, act } from '@testing-library/react'
import { createElement } from 'react'
import { AppStateProvider } from '../../hooks/use-app-state-context'
import { StateMachine } from '../../lib/state-machine'
import { featureFlagManager } from '../../lib/feature-flags'
import type { ReactNode } from 'react'
import type { AppState } from '../../types/app-state'

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
    clear: vi.fn(),
}

Object.defineProperty(window, 'localStorage', {
    value: localStorageMock
})

function TestWrapper({ children }: { children: ReactNode }) {
    return createElement(AppStateProvider, null, children)
}

describe('ç‹€æ…‹è½‰æ›æ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        featureFlagManager.reset()
        featureFlagManager.enable('useNewStateManagement')
        localStorageMock.getItem.mockReturnValue(null)
    })

    describe('åŸºæœ¬ç‹€æ…‹è½‰æ›', () => {
        test('æ‡‰è©²æ”¯æ´ default â†’ recording_waiting è½‰æ›', () => {
            const stateMachine = new StateMachine('default')

            const canTransition = stateMachine.canTransition('START_RECORDING')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('START_RECORDING')
            expect(newState).toBe('recording_waiting')
        })

        test('æ‡‰è©²æ”¯æ´ recording_waiting â†’ recording_active è½‰æ›', () => {
            const stateMachine = new StateMachine('recording_waiting')

            const canTransition = stateMachine.canTransition('RECORDING_STARTED')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('RECORDING_STARTED')
            expect(newState).toBe('recording_active')
        })

        test('æ‡‰è©²æ”¯æ´ recording_active â†’ processing è½‰æ›', () => {
            const stateMachine = new StateMachine('recording_active')

            const canTransition = stateMachine.canTransition('STOP_RECORDING')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('STOP_RECORDING')
            expect(newState).toBe('processing')
        })

        test('æ‡‰è©²æ”¯æ´ processing â†’ finished è½‰æ›', () => {
            const stateMachine = new StateMachine('processing')

            const canTransition = stateMachine.canTransition('PROCESSING_COMPLETE')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('PROCESSING_COMPLETE')
            expect(newState).toBe('finished')
        })
    })

    describe('ç‹€æ…‹è½‰æ›é™åˆ¶', () => {
        test('ä¸æ‡‰è©²å…è¨±ç„¡æ•ˆçš„ç‹€æ…‹è½‰æ›', () => {
            const stateMachine = new StateMachine('default')

            // ä¸èƒ½ç›´æ¥å¾ default è·³åˆ° recording_active
            const canTransition = stateMachine.canTransition('RECORDING_STARTED')
            expect(canTransition).toBe(false)

            // å˜—è©¦ç„¡æ•ˆè½‰æ›æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
            expect(() => {
                stateMachine.transition('RECORDING_STARTED')
            }).toThrow()
        })

        test('finished ç‹€æ…‹æ‡‰è©²åªèƒ½é‡ç½®åˆ° default', () => {
            const stateMachine = new StateMachine('finished')

            // åªèƒ½é‡ç½®
            expect(stateMachine.canTransition('RESET')).toBe(true)
            expect(stateMachine.canTransition('START_RECORDING')).toBe(false)
            expect(stateMachine.canTransition('STOP_RECORDING')).toBe(false)

            const newState = stateMachine.transition('RESET')
            expect(newState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´å¾ä»»ä½•ç‹€æ…‹é‡ç½®åˆ° default', () => {
            const states: AppState[] = ['default', 'recording_waiting', 'recording_active', 'processing', 'finished']

            states.forEach(state => {
                const stateMachine = new StateMachine(state)
                expect(stateMachine.canTransition('RESET')).toBe(true)
                expect(stateMachine.transition('RESET')).toBe('default')
            })
        })
    })

    describe('å®Œæ•´ç‹€æ…‹æµç¨‹', () => {
        test('æ‡‰è©²æ”¯æ´å®Œæ•´çš„éŒ„éŸ³æµç¨‹', () => {
            const stateMachine = new StateMachine('default')

            // å®Œæ•´æµç¨‹ï¼šdefault â†’ recording_waiting â†’ recording_active â†’ processing â†’ finished
            expect(stateMachine.getCurrentState()).toBe('default')

            // é–‹å§‹éŒ„éŸ³
            const waitingState = stateMachine.transition('START_RECORDING')
            expect(waitingState).toBe('recording_waiting')

            // éŒ„éŸ³é–‹å§‹
            const activeState = stateMachine.transition('RECORDING_STARTED')
            expect(activeState).toBe('recording_active')

            // åœæ­¢éŒ„éŸ³
            const processingState = stateMachine.transition('STOP_RECORDING')
            expect(processingState).toBe('processing')

            // è™•ç†å®Œæˆ
            const finishedState = stateMachine.transition('PROCESSING_COMPLETE')
            expect(finishedState).toBe('finished')

            // é‡ç½®
            const resetState = stateMachine.transition('RESET')
            expect(resetState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´ç­†è¨˜æ¨¡å¼æµç¨‹', () => {
            const stateMachine = new StateMachine('default')

            // ç­†è¨˜æ¨¡å¼ï¼šdefault â†’ finished (ç›´æ¥å®Œæˆ)
            expect(stateMachine.getCurrentState()).toBe('default')

            const finishedState = stateMachine.transition('FINISH_SESSION')
            expect(finishedState).toBe('finished')
        })
    })

    describe('éŒ¯èª¤æ¢å¾©', () => {
        test('æ‡‰è©²æ”¯æ´éŒ¯èª¤ç‹€æ…‹æ¢å¾©', () => {
            const stateMachine = new StateMachine('recording_active')

            // å¾éŒ„éŸ³ä¸­ç™¼ç”ŸéŒ¯èª¤
            const errorState = stateMachine.transition('ERROR')
            expect(errorState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´æœƒè©±å‡ç´š', () => {
            const stateMachine = new StateMachine('default')

            // å‡ç´šåˆ°éŒ„éŸ³æ¨¡å¼
            const upgradedState = stateMachine.transition('UPGRADE_TO_RECORDING')
            expect(upgradedState).toBe('recording_waiting')
        })
    })

    describe('ä¸¦ç™¼ç‹€æ…‹è®Šæ›´', () => {
        test('ç‹€æ…‹æ©Ÿæ‡‰è©²æ˜¯ç·šç¨‹å®‰å…¨çš„', () => {
            const stateMachine = new StateMachine('default')
            const results: AppState[] = []

            // æ¨¡æ“¬ä¸¦ç™¼è½‰æ›
            const transitions = [
                'START_RECORDING',
                'RESET',
                'START_RECORDING',
                'RESET'
            ]

            transitions.forEach(trigger => {
                try {
                    const newState = stateMachine.transition(trigger as any)
                    results.push(newState)
                } catch (error) {
                    // æŸäº›è½‰æ›å¯èƒ½å¤±æ•—ï¼Œé€™æ˜¯é æœŸçš„
                }
            })

            // æœ€å¾Œç‹€æ…‹æ‡‰è©²æ˜¯æœ‰æ•ˆçš„
            const finalState = stateMachine.getCurrentState()
            const validStates: AppState[] = ['default', 'recording_waiting', 'recording_active', 'processing', 'finished']
            expect(validStates).toContain(finalState)
        })
    })

    describe('ç‹€æ…‹æ­·å²', () => {
        test('æ‡‰è©²è¨˜éŒ„ç‹€æ…‹è½‰æ›æ­·å²', () => {
            const stateMachine = new StateMachine('default')

            stateMachine.transition('START_RECORDING')
            stateMachine.transition('RECORDING_STARTED')
            stateMachine.transition('STOP_RECORDING')

            const history = stateMachine.getHistory()
            expect(history).toHaveLength(4) // åŒ…å«åˆå§‹ç‹€æ…‹
            expect(history[0]).toBe('default')
            expect(history[1]).toBe('recording_waiting')
            expect(history[2]).toBe('recording_active')
            expect(history[3]).toBe('processing')
        })

        test('æ‡‰è©²æ”¯æ´å›åˆ°ä¸Šä¸€å€‹ç‹€æ…‹', () => {
            const stateMachine = new StateMachine('default')

            stateMachine.transition('START_RECORDING')
            stateMachine.transition('RECORDING_STARTED')

            const canGoBack = stateMachine.canGoBack()
            expect(canGoBack).toBe(true)

            const previousState = stateMachine.goBack()
            expect(previousState).toBe('recording_waiting')
            expect(stateMachine.getCurrentState()).toBe('recording_waiting')
        })
    })
})


# END FILE CONTENTS


# File: frontend/components/ui/resizable.tsx

"use client"

import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }


# END FILE CONTENTS


# File: frontend/postcss.config.mjs

/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

export default config;


# END FILE CONTENTS


# File: .cursor/rules/frontend.mdc

---
description:
globs:
alwaysApply: false
---
<!-- Source: https://github.com/arthow4n/live-language-mate/blob/master/CLAUDE.md -->

### Development Notes

- Uses shadcn/ui component library extensively
- In the default state without a specified style, the tweakcn clean-slate style is applied first: `npx shadcn@latest add https://tweakcn.com/r/themes/clean-slate.json`
- Responsive design with mobile-first approach
- Settings stored in localStorage with versioning


## TypeScript coding style and conventions

- Prefer named import/export over default import/export.
- Early return, early throw.
- In frontend Vitest test files, import explicitly the test helpers e.g. `import { beforeEach, describe, expect, `test`, vi } from 'vitest';`.
- Use Zod to validate and cast type as early as possible, this includes but not limit to handling the following scenarios: `any`, `unknown`, `DefaultBodyType`.
- Always assign unknown type to `const x: unknown = JSON.parse()`, `cosnt x: unknown = await request.json()`, `cosnt x: unknown = await response.json()`, then validate with Zod.
- Zod schemas are shared between frontend and backend.
- Zod schemas are in `frontend/schemas/`, you should find in there first to see if there's a schema you can reuse. You should not create Zod schemas outside of `frontend/schemas/`.
- Never use `any`, `as` type assertion or `!` non-null assertion operator, you should instead use type narrowing, for example in test you can use `expectToBeInstanceOf`, `expectToNotBeNull`, `expectToNotBeUndefined`, and outside of test `instanceof` or do a proper object validation with Zod.
- If you would declare an untyped object, instead you should either type it with e.g. `const x: X = {}` or `{} satisfies X`.
- Avoid optional function parameter, optional property, and default values. If you are about to add one or you see any of such usages, try to look around the related code paths and see if you can refactor to remove it. Default values should only be used when it's absolutely necessary.
- Throw if a logic not really optional:

```ts
// Bad: Is Y optional?
if (x instaceof X) { x.Y(); }

// Bad: Is Y optional?
x?.Y();

// Good: Type narrowing and early throw
if (!x instanceof X) { throw new Error(); }
x.Y();

// Best: Zod type narrowing and early throw, prefer .parse over .safeParse when possible.
zodSchema.parse(x);
x.Y();

// Compromise: Explain why Y is optional if Y is really optional.
x?.Y(); // Y is optional because ...
```

### In fronted, instead of X use Y

- `as` operator -> use Zod
- `console.error` -> `logError`
- `JSX.Element` -> `React.JSX.Element`
- `toBeTruthy`, `.not.toBeNull`, `toBeDefined`, `toBeInstanceOf` or `if (instanceof)` -> use the type narrowing expect helpers in `frontend/__tests__/typedExpectHelpers.ts`
- `getAllBy*()[*]` -> `getByTestId` or `getByText`
- `() => {}` empty mock -> `vi.fn()`
- `JSON.stringify(x)` if x is not typed -> `const x: X = {}; JSON.stringify(x)` or `JSON.stringify({} satisfies X)`
- `fireEvent` -> `userEvent`
- `vi.mock` -> never mock imported code, we write integration test and should not mock any decendant imports.



## Test

- When writing test, write integration test.
- Write integration test to cover business logic, if something can be clicked, input or be interacted in any other ways by the user, it should be covered by a test.
- When writing new test, make sure the test is genuinely new and not testing what another test has already covered. You should look for other existing test cases to understand if the test you are about to write is already covered by another test.
- Use Playwright to test end-to-end frontend with @playwright-e2e-testing.mdc
- Focus on testing the component/function's integrated behaviour, for example, if the import tree looks like A -> B -> C, you should not mock any of A/B/C, instead you should focus on testing if interacting with A as a whole gives you the expected result; in B's test you should not mock B/C and instead test interacting with B; and so on.
- You should only change a test file if you are fixing lint/type errors, or you made a change that requires update that test file.
- If you are only editing test, you should not change the existing code logic that in the test. If refactoring would make writing test easier, explain to the user and wait for feedback. You may add testid yourself if needed.
- If an action will make an API request, you should test whether the API will get the correctly formed request.
- Before you write or change any test code, make sure you step back and get a full picture first, by reading through the related code paths from beginning to end, and understanding how the code and data flows.
- Instead of fixing many test cases in one go, focus on fixing 1 test at a time, each test case should have its own todo item.
- `DragEvent`, `DataTransferItemList`, `DataTransfer`, `DOMRect` are polyfilled and can be used in test:

```ts
const event = new DragEvent('dragenter', {
  cancelable: true,
  bubbles: true,
});
event.dataTransfer?.items.add('hello world', 'text/plain');
```

## Lint

- If you would eslint disable anything, think again and see if there's a better approach to fix it, if you still need to eslint disable, make sure you add -- comment after it to explain why you chose to disable.

### Instead of command X, use Y

- `rg`, `grep` -> use Search tool
- `find` -> `git ls-files` or your own List tool
- `rm` -> try `git rm` first, if fail then try `git clean`
- `head`/`tail`/`cat` -> read the file with tool instead
- `npx tsc` -> `npm run typecheck`
- Don't chain or pipe commands, chained and piped commands will be denied.


# END FILE CONTENTS


# File: SPEC.md

# Technical Specification


## Frontend Stack

- pnpm for Package manager
- React 18 with TypeScript
- Next.js for framework
- Tailwind CSS + shadcn/ui components
- Zustand-like context for state management
- Zod 4, therefore the imports should be `from "zod/v4"`, you may fetch `https://zod.dev/v4/changelog` if you are unsure how to write.
- Playwright MCP for e2e test

```ts
// Bad: Zod 3
import { z } from 'zod';
z.object({ name: z.string() }).strict();
z.object({ name: z.string() }).passthrough();

// Good: Zod 4
import { z } from 'zod/v4';
z.strictObject({ name: z.string() });
z.looseObject({ name: z.string() });
```


## Backend Stack

- Python version 3.10+
  - Use `uv` for virtual environment management
  - Pin all dependency versions in requirements.txt or pyproject.toml
- Separate production and development dependencies
- FastAPI for web framework with async support
- Pydantic v2 for data validation and settings management
- Supabase as database
- Azure OpenAI for transcription services
- WebSocket for real-time communication
- Cloudflare R2 for audio storage
- FFmpeg for audio processing


## File Structure

- Frontend File organization
  - Components in `frontend/components/(ui)/`
  - Custom hooks in `frontend/hooks/`
  - Utilities in `frontend/lib/`
  - Type definitions in `frontend/types/`
  - Services in `frontend/lib/services/`
  - Constants in `frontend/constants/`


- Backend File organization
  - Models in `app/schemas/`
  - Services in `app/services/`
  - API routes in `app/api/`
  - Core utilities in `app/core/`
  - Database related in `app/db/`
  - WebSocket handlers in `app/ws/`
  


### 1. å¾Œç«¯ FastAPI (ç°¡åŒ–æ¶æ§‹ - REST API æ¨¡å¼)

| #     | å‡½å¼ / å”ç¨‹                                              | æ‰€å±¬æ¨¡çµ„              | è²¬ä»»                                         | I/O                                                |
| ----- | -------------------------------------------------------- | --------------------- | -------------------------------------------- | -------------------------------------------------- |
| B-001 | `create_session(title:str=None, type:str) -> SessionOut` | api.sessions          | POST /api/session                            | in: type, title(å¯é¸)ï¼›out: sid, status, type      |
| B-002 | `finish_session(sid:UUID)`                               | api.sessions          | PATCH /api/session/{sid}/finish              | in: sidï¼›204                                       |
| B-015 | `upgrade_session_to_recording(sid:UUID)`                 | api.sessions          | PATCH /api/session/{sid}/upgrade             | in: sidï¼›out: updated session                      |
| B-003 | `save_note(sid:UUID, content:str, client_ts:datetime)`   | api.notes             | PUT /api/notes/{sid}                         | in: content, client_ts(å¯é¸)ï¼›out: server_ts, note |
| B-004 | `export_resource(sid:UUID, type:str)`                    | api.export            | GET /api/export/{sid}?type=                  | StreamingResponse                                  |
| B-020 | `upload_segment(sid:UUID, seq:int, file:UploadFile)`     | api.segments          | POST /api/segment - ä¸Šå‚³ 10s WebM éŸ³æª”åˆ‡ç‰‡   | in: WebM fileï¼›out: {"ack": seq}                   |
| B-006 | `ws_transcript_feed(ws:WebSocket, sid:UUID)`             | ws.transcript_feed    | æ¨é€ Azure OpenAI é€å­—ç¨¿çµæœ                 | â†“ {"text","timestamp",...}                         |
| B-007 | `store_segment_blob(sid, seq, blob)`                     | services.storage      | ä¸Šå‚³åˆ° Cloudflare R2 + æ›´æ–° DB `audio_files` | â€”                                                  |
| B-021 | `ffmpeg_webm_to_pcm(webm_bytes) -> bytes`                | core.ffmpeg           | WebMâ†’16k mono PCM (è™•ç†å®Œæ•´ 10s æª”æ¡ˆ)        | in: WebM blobï¼›out: PCM bytes                      |
| B-010 | `azure_openai_client() -> OpenAI`                        | services.azure_openai | å»ºç«‹ Azure OpenAI å®¢æˆ¶ç«¯                     | return client                                      |
| B-022 | `whisper_transcribe(pcm_bytes) -> str`                   | services.azure_openai | å–®æª”è½‰éŒ„ï¼šWebM/PCM â†’ Azure OpenAI Whisper    | in: audio bytesï¼›out: transcript text              |
| B-023 | `process_and_transcribe(sid, seq, webm)`                 | api.segments          | èƒŒæ™¯ä»»å‹™ï¼šè½‰æª” + STT + å„²å­˜ + å»£æ’­           | BackgroundTasks                                    |
| B-013 | `mark_session_error(sid, reason)`                        | db.crud               | æ›´æ–° sessions.status=error                   | â€”                                                  |
| B-014 | `single_active_guard()`                                  | middleware            | ä¿è­‰åŒæ™‚åƒ… 1 active session                  | 429 on violation                                   |
| B-016 | `check_tables_exist()`                                   | db.database           | æª¢æŸ¥æ ¸å¿ƒè¡¨æ ¼æ˜¯å¦å­˜åœ¨                         | return bool                                        |
| B-017 | `auto_init_database()`                                   | db.database           | è‡ªå‹•æª¢æ¸¬ä¸¦åˆå§‹åŒ–è³‡æ–™åº«                       | å•Ÿå‹•æ™‚åŸ·è¡Œ                                         |
| B-018 | `init_r2_client() -> S3Client`                           | services.r2_client    | åˆå§‹åŒ– Cloudflare R2 å®¢æˆ¶ç«¯                  | return S3Client                                    |
| B-019 | `generate_r2_presigned_url(bucket, key, expires)`        | services.r2_client    | ç”Ÿæˆ R2 é ç°½å URL                           | return presigned_url                               |

### âš ï¸ ç§»é™¤çš„åŠŸèƒ½ (ç°¡åŒ–æ¶æ§‹)
- âŒ `ws_upload_audio` - æ”¹ç”¨ REST API
- âŒ `handle_ack_missing` - ä¸å†éœ€è¦ chunk ack/missing æ©Ÿåˆ¶
- âŒ `ffmpeg_spawn` - æ”¹ç‚ºè™•ç†å®Œæ•´æª”æ¡ˆï¼Œä¸éœ€è¦ä¸²æµ
- âŒ `transcribe_audio_batch` - æ”¹ç‚ºå–®æª”è™•ç†

### 2. å‰ç«¯ Reactï¼ˆHook / Utilityï¼‰

| #     | å‡½å¼                                 | æ¨¡çµ„                | è²¬ä»»                                                                                       | I/O                                                                          |
| ----- | ------------------------------------ | ------------------- | ------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------- |
| F-001 | `useAppState.setState(state)`        | hooks/useAppState   | ç®¡ç†å‰ç«¯æ‡‰ç”¨ç‹€æ…‹è½‰æ›                                                                       | 'default'\|'recording_waiting'\|'recording_active'\|'processing'\|'finished' |
| F-002 | `useSession.createNoteSession()`     | hooks/useSession    | POST /session (type=note_only)                                                             | return sid                                                                   |
| F-003 | `useSession.upgradeToRecording(sid)` | hooks/useSession    | PATCH /session/{sid}/upgrade                                                               | return updated session                                                       |
| F-004 | `useRecorder.startRecording()`       | hooks/useRecorder   | a. å»ºç«‹/å‡ç´š session<br>b. ç‹€æ…‹è½‰ç‚º recording_waiting<br>c. å•Ÿ MediaRecorder timeslice=10s | return sid                                                                   |
| F-005 | `useRecorder.stopRecording()`        | hooks/useRecorder   | a. åœæ­¢éŒ„éŸ³<br>b. ç‹€æ…‹è½‰ç‚º processing<br>c. ç­‰å¾…è½‰éŒ„å®Œæˆ                                   | â€”                                                                            |
| F-024 | `uploadSegment(seq, blob)`           | hooks/useRecorder   | fetch POST /api/segment ä¸Šå‚³ 10s WebM æª”æ¡ˆ                                                 | â€”                                                                            |
| F-025 | `handleUploadError(seq, blob)`       | hooks/useRecorder   | ä¸Šå‚³å¤±æ•—è™•ç†ï¼Œæš«å­˜åˆ° IndexedDB                                                             | â€”                                                                            |
| F-008 | `useTranscript.connect(sid)`         | hooks/useTranscript | å»º `/ws/transcript_feed` é€£ç·š                                                              | â€”                                                                            |
| F-009 | `mergeSegment(seg)`                  | hooks/useTranscript | ç›¸é„° â‰¤1 s åˆä½µæ®µè½                                                                         | æ›´æ–° segments state                                                          |
| F-010 | `onTranscriptComplete()`             | hooks/useTranscript | è½‰éŒ„å®Œæˆå›èª¿ï¼Œç‹€æ…‹è½‰ç‚º finished                                                            | â€”                                                                            |
| F-011 | `autoScroll()`                       | hooks/useTranscript | è‹¥é–å®šåˆ°åº•å‰‡æ²åº•                                                                           | â€”                                                                            |
| F-012 | `unlockOnScroll()`                   | hooks/useTranscript | ä½¿ç”¨è€…æ»¾å‹•é›¢åº• >60 px                                                                      | set locked=false                                                             |
| F-013 | `toLatest()`                         | hooks/useTranscript | smooth scroll bottomï¼›é–å®š                                                                 | â€”                                                                            |
| F-014 | `useLocalDraft(field,val)`           | hooks/useLocalDraft | 5 s debounce å­˜ localStorage                                                               | â€”                                                                            |
| F-015 | `loadDraft()`                        | hooks/useLocalDraft | è¼‰å…¥ draft_note                                                                            | return {note}                                                                |
| F-016 | `clearDraft()`                       | hooks/useLocalDraft | removeItem('draft_*')                                                                      | â€”                                                                            |
| F-017 | `useAutoSave(sid, content)`          | hooks/useAutoSave   | æ¯ 10 s PUT /notes                                                                         | â€”                                                                            |
| F-018 | `newNote()`                          | hooks/useAppState   | æ¸…ç©ºç•¶å‰è³‡æ–™ï¼Œç‹€æ…‹å›åˆ° default<br>å¦‚æœå­˜åœ¨æ´»èºæœƒè©±ï¼Œå…ˆåˆªé™¤è©²æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“š           | â€”                                                                            |
| F-019 | `downloadZip(sid)`                   | utils/export        | GET /export/{sid}?type=zip                                                                 | è§¸ç™¼ download                                                                |
| F-020 | `showToast(text,type)`               | utils/ui            | çµ±ä¸€éŒ¯èª¤ï¼æç¤º                                                                             | â€”                                                                            |

### 3. å‰ç«¯ UI Component Methodsï¼ˆç‹€æ…‹å°æ‡‰ï¼‰

| #     | å…ƒä»¶                | å‡ºç¾ç‹€æ…‹                                                  | ä¸»è¦æ–¹æ³• / callback                    |
| ----- | ------------------- | --------------------------------------------------------- | -------------------------------------- |
| C-001 | `RecordButton`      | default, recording_waiting, recording_active              | `onClick => startRecording()           | stopRecording()` |
| C-002 | `MarkdownEditor`    | default, recording_waiting, recording_active, finished    | `onChange => saveDraft() / autoSave()` |
| C-003 | `TranscriptPane`    | recording_waiting, recording_active, processing, finished | `onScroll => unlockOnScroll()`         |
| C-004 | `ToLatestButton`    | recording_waiting, finished                               | `onClick => toLatest()`                |
| C-005 | `ProcessingOverlay` | processing                                                | é¡¯ç¤ºè½‰éŒ„é€²åº¦èˆ‡ç­‰å¾…å‹•ç•«                 |
| C-006 | `ExportButton`      | finished                                                  | `onClick => downloadZip()`             |
| C-007 | `NewNoteButton`     | finished                                                  | `onClick => newNote()`                 |
| C-008 | `StatusIndicator`   | all states                                                | é¡¯ç¤ºç•¶å‰ç‹€æ…‹ï¼ˆéŒ„éŸ³ä¸­/è™•ç†ä¸­/å·²å®Œæˆï¼‰   |

**å„ç‹€æ…‹ç•«é¢çµ„æˆ**ï¼š

| ç‹€æ…‹              | é¡¯ç¤ºå…ƒä»¶                                                                              |
| ----------------- | ------------------------------------------------------------------------------------- |
| default           | MarkdownEditor + RecordButton + NewNoteButton                                         |
| recording_waiting | MarkdownEditor + TranscriptPane + NewNoteButton + RecordButton(åœæ­¢) + ToLatestButton |
| recording_active  | MarkdownEditor + TranscriptPane + NewNoteButton + RecordButton(åœæ­¢) + ToLatestButton |
| processing        | MarkdownEditor + TranscriptPane + ProcessingOverlay                                   |
| finished          | MarkdownEditor + TranscriptPane + ExportButton + NewNoteButton + ToLatestButton       |

**NewNoteButton åœ¨ä¸åŒç‹€æ…‹çš„è¡Œç‚º**ï¼š

| ç‹€æ…‹              | NewNoteButton è¡Œç‚º       | èªªæ˜                                                                                           |
| ----------------- | ------------------------ | ---------------------------------------------------------------------------------------------- |
| default           | æ¸…ç©ºç•¶å‰æœƒè©±ä¸¦é–‹å§‹æ–°ç­†è¨˜ | å¦‚æœå­˜åœ¨æ´»èºæœƒè©±ï¼Œæœƒå…ˆåˆªé™¤è©²æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼›æ¸…ç©ºç·¨è¼¯å™¨å…§å®¹å’Œæœ¬åœ°è‰ç¨¿ï¼›ç‹€æ…‹ä¿æŒåœ¨ default |
| recording_waiting | åœæ­¢éŒ„éŸ³ä¸¦æ¸…ç©ºç•¶å‰æœƒè©±   | åœæ­¢éŒ„éŸ³ï¼Œåˆªé™¤ç•¶å‰æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼Œå›åˆ° default ç‹€æ…‹                                      |
| recording_active  | åœæ­¢éŒ„éŸ³ä¸¦æ¸…ç©ºç•¶å‰æœƒè©±   | åœæ­¢éŒ„éŸ³ï¼Œåˆªé™¤ç•¶å‰æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼Œå›åˆ° default ç‹€æ…‹                                      |
| finished          | æ¸…ç©ºç•¶å‰æœƒè©±ä¸¦é–‹å§‹æ–°ç­†è¨˜ | åˆªé™¤å·²å®Œæˆçš„æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼Œæ¸…ç©ºç·¨è¼¯å™¨å…§å®¹ï¼Œå›åˆ° default ç‹€æ…‹                            |

### 4. Supabase PostgreSQL è³‡æ–™åº«æ¶æ§‹

**æ¶æ§‹ç‰¹è‰²**ï¼š
- âœ… **é›²ç«¯åŸç”Ÿ**ï¼šå°ˆç‚º Supabase è¨­è¨ˆï¼Œäº«å—å®Œæ•´é›²ç«¯æœå‹™
- âœ… **æª”æ¡ˆåˆ†é›¢**ï¼šéŸ³è¨Šæª”æ¡ˆä½¿ç”¨å…è²»çš„ Cloudflare R2 å„²å­˜ï¼Œé™ä½æˆæœ¬
- âœ… **è‡ªå‹•åˆå§‹åŒ–**ï¼šæä¾›å®Œæ•´ SQL è…³æœ¬ï¼Œä¸€éµå»ºç«‹æ‰€æœ‰è¡¨æ ¼
- âœ… **é«˜å¯ç”¨æ€§**ï¼šSupabase æä¾› 99.9% å¯ç”¨æ€§ä¿è­‰


```Mermaid

sequenceDiagram
    %% ==== Participants ====
    actor User as ğŸ‘¤ ä½¿ç”¨è€…
    participant Browser as ğŸŒ ç€è¦½å™¨
    participant BE as âš¡ FastAPI
    participant R2 as â˜ï¸ R2 Storage
    participant DB as ğŸ’¾ Supabase
    participant STT as ğŸ¤– STT Model
    participant WS as ğŸ”Œ Websocket

    %% ==== å³æ™‚éŒ„éŸ³æµç¨‹ ====
    rect rgb(240,248,255)
        Note over User,WS: ğŸ™ï¸ å³æ™‚éŒ„éŸ³èˆ‡è½‰éŒ„
        User ->> Browser: é»æ“Šé–‹å§‹éŒ„éŸ³
        Browser ->>+ BE: é–‹æ–° Session 

        par å„²å­˜èˆ‡è½‰éŒ„
            BE ->>+ R2: å„²å­˜ WebM
            BE ->>+ STT: WebM â†’ Whisper
            STT -->> BE: å›è¦† Transcript JSON
            BE -->> WS: å‚³å…¥é€å­—ç¨¿
            BE ->>+ DB: INSERT transcript_segments
        end

        WS -->> Browser: é€å‡ºé€å­—ç¨¿
        Browser -->> User: æ›´æ–°é€å­—ç¨¿
    end
        WS -->> Browser: é€å‡ºé€å­—ç¨¿
        Browser -->> User: æ›´æ–°é€å­—ç¨¿
    end

    %% ==== åŒ¯å‡ºåŠŸèƒ½ ====
    rect rgb(248,255,248)
        Note over User,WS: ğŸ“¥ åŒ¯å‡ºç­†è¨˜èˆ‡é€å­—ç¨¿
        User ->> Browser: é»æ“ŠåŒ¯å‡º
        Browser ->>+ BE: GET /api/export?type=zip
        BE ->>+ DB: SELECT note & transcript
        DB -->>- BE: æ–‡å­—å…§å®¹
        BE ->>+ R2: è®€å–éŸ³è¨Šæª”æ¡ˆ
        R2 -->>- BE: WebM files
        BE -->>- Browser: ZIP æª”æ¡ˆ
        Browser -->> User: ä¸‹è¼‰å®Œæˆ
    end

```

```mermaid
erDiagram
    sessions {
        UUID id PK "gen_random_uuid()"
        VARCHAR title "æœƒè©±æ¨™é¡Œ(å¯é¸)"
        session_type type "note_only/recording"
        session_status status "active/completed/error"
        lang_code language "zh-TW/en-US"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
        TIMESTAMPZ updated_at "æ›´æ–°æ™‚é–“"
        TIMESTAMPTZ completed_at "å®Œæˆæ™‚é–“"
    }

    audio_files {
        UUID id PK "gen_random_uuid()"
        UUID session_id FK "é—œè¯æœƒè©±ID"
        INT chunk_sequence "éŸ³æª”åˆ‡ç‰‡åºè™Ÿ"
        TEXT r2_key "Cloudflare R2 ç‰©ä»¶éµå€¼"
        TEXT r2_bucket "Cloudflare R2 å„²å­˜æ¡¶åç¨±"
        INT file_size "æª”æ¡ˆå¤§å°"
        DECIMAL duration_seconds "æ™‚é•·(ç§’)"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
    }

    transcript_segments {
        UUID id PK "gen_random_uuid()"
        UUID session_id FK "é—œè¯æœƒè©±ID"
        INT chunk_sequence "é€å­—ç¨¿ç‰‡æ®µåºè™Ÿ"
        DECIMAL start_time "é–‹å§‹æ™‚é–“(ç§’)"
        DECIMAL end_time "çµæŸæ™‚é–“(ç§’)"
        TEXT text "é€å­—ç¨¿å…§å®¹"
        DECIMAL confidence "ä¿¡å¿ƒåº¦"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
    }

    transcripts {
        UUID id PK "gen_random_uuid()"
        UUID session_id FK "é—œè¯æœƒè©±ID(UNIQUE)"
        TEXT full_text "å®Œæ•´é€å­—ç¨¿"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
        TIMESTAMPTZ updated_at "æ›´æ–°æ™‚é–“"
    }

    notes {
        UUID id PK "gen_random_uuid()"
        UUID session_id FK "é—œè¯æœƒè©±ID(UNIQUE)"
        TEXT content "ç­†è¨˜å…§å®¹(Markdown)"
        TIMESTAMPTZ client_ts "å®¢æˆ¶ç«¯æ™‚é–“æˆ³(å¯é¸)"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
        TIMESTAMPTZ updated_at "æ›´æ–°æ™‚é–“"
    }

    sessions ||--o{ audio_files : "ä¸€å°å¤š(å¯é¸)<br/>ç´”ç­†è¨˜æ¨¡å¼ç„¡éŸ³æª”"
    sessions ||--o{ transcript_segments : "ä¸€å°å¤š(å¯é¸)<br/>ç´”ç­†è¨˜æ¨¡å¼ç„¡é€å­—ç¨¿"
    sessions ||--o| transcripts : "ä¸€å°ä¸€(å¯é¸)<br/>ç´”ç­†è¨˜æ¨¡å¼ç„¡é€å­—ç¨¿"
    sessions ||--|| notes : "ä¸€å°ä¸€(å¿…é ˆ)<br/>æ‰€æœ‰æœƒè©±éƒ½æœ‰ç­†è¨˜"
```

### 5. å‰ç«¯ç‹€æ…‹ç®¡ç†

**å‰ç«¯æ‡‰ç”¨ç‹€æ…‹ (AppState)**ï¼š
```typescript
type AppState = 
  | 'default'           // é è¨­ç•«é¢ï¼šå¯å¯«ç­†è¨˜ï¼Œé¡¯ç¤ºéŒ„éŸ³æŒ‰éˆ•
  | 'recording_waiting' // éŒ„éŸ³ä¸­ï¼Œå°šæœªæ”¶åˆ°é€å­—ç¨¿
  | 'recording_active'  // éŒ„éŸ³ä¸­ï¼Œå·²æ”¶åˆ°é€å­—ç¨¿ä¸¦å³æ™‚é¡¯ç¤º
  | 'processing'        // è™•ç†ç•«é¢ï¼šåœæ­¢éŒ„éŸ³å¾Œï¼Œè™•ç†å‰©é¤˜é€å­—ç¨¿
  | 'finished'          // å®Œæ•´é€å­—ç¨¿ç•«é¢ï¼šå¯ç·¨è¼¯ç­†è¨˜ã€åŒ¯å‡ºã€é–‹æ–°ç­†è¨˜
```

**ç‹€æ…‹è½‰æ›è¦å‰‡**ï¼š
```
default â†’ recording_waiting           // æŒ‰ä¸‹éŒ„éŸ³æŒ‰éˆ•
recording_waiting â†’ recording_active  // æ”¶åˆ°ç¬¬ä¸€æ®µé€å­—ç¨¿
recording_active â†’ processing         // æŒ‰ä¸‹åœæ­¢éŒ„éŸ³
processing â†’ finished                 // é€å­—ç¨¿è™•ç†å®Œæˆ
finished â†’ default                    // æŒ‰ä¸‹ New note
default â†’ finished                    // ç´”ç­†è¨˜æ¨¡å¼ç›´æ¥å®Œæˆï¼ˆæœªä¾†åŠŸèƒ½ï¼‰
```

**å„ç‹€æ…‹åŠŸèƒ½å°ç…§**ï¼š

| ç‹€æ…‹              | ç­†è¨˜ç·¨è¼¯ | éŒ„éŸ³åŠŸèƒ½ | é€å­—ç¨¿é¡¯ç¤º | åŒ¯å‡ºåŠŸèƒ½ | ç‰¹æ®ŠåŠŸèƒ½   |
| ----------------- | -------- | -------- | ---------- | -------- | ---------- |
| default           | âœ… å¯ç·¨è¼¯ | âœ… å¯é–‹å§‹ | âŒ ç„¡       | âŒ ç„¡     | draft æš«å­˜ |
| recording_waiting | âœ… å¯ç·¨è¼¯ | âœ… å¯åœæ­¢ | â³ ç­‰å¾…ä¸­   | âŒ ç„¡     | è¨ˆæ™‚å™¨     |
| recording_active  | âœ… å¯ç·¨è¼¯ | âœ… å¯åœæ­¢ | âœ… å³æ™‚é¡¯ç¤º | âŒ ç„¡     | éŸ³æª”ä¸Šå‚³   |
| processing        | âŒ é–å®š   | âŒ ç„¡     | âœ… æ›´æ–°ä¸­   | âŒ ç„¡     | ç­‰å¾…å‹•ç•«   |
| finished          | âœ… å¯ç·¨è¼¯ | âŒ ç„¡     | âœ… å®Œæ•´é¡¯ç¤º | âœ… å¯åŒ¯å‡º | New note   |

**å¾Œç«¯ Session ç‹€æ…‹å°æ‡‰**ï¼š

| å‰ç«¯ç‹€æ…‹          | å¾Œç«¯ Session Status | Session Type        | èªªæ˜                           |
| ----------------- | ------------------- | ------------------- | ------------------------------ |
| default           | draft               | note_only           | è‰ç¨¿ç‹€æ…‹ï¼Œå°šæœªæ­£å¼å»ºç«‹ session |
| default (å·²å»ºç«‹)  | active              | note_only           | ç´”ç­†è¨˜ session                 |
| recording_waiting | active              | recording           | éŒ„éŸ³ä¸­ï¼Œå°šæœªæ”¶åˆ°é€å­—ç¨¿         |
| recording_active  | active              | recording           | éŒ„éŸ³ä¸­ï¼Œå·²æ”¶åˆ°é€å­—ç¨¿ä¸¦å³æ™‚é¡¯ç¤º |
| processing        | active              | recording           | éŒ„éŸ³çµæŸï¼Œè½‰éŒ„è™•ç†ä¸­           |
| finished          | completed           | note_only/recording | å¯åŒ¯å‡ºå®Œæ•´è³‡æ–™                 |

### 6. Azure OpenAI æ•´åˆæ¶æ§‹ (REST API ç°¡åŒ–ç‰ˆ)

**æŠ€è¡“é¸æ“‡ç†ç”±**ï¼š
- âœ… **ä¼æ¥­ç´šå“è³ª**ï¼šAzure OpenAI æä¾›ç©©å®šçš„ Whisper æ¨¡å‹æœå‹™
- âœ… **å¤šèªè¨€æ”¯æ´**ï¼šå„ªç§€çš„ä¸­æ–‡èªéŸ³è­˜åˆ¥æº–ç¢ºåº¦
- âœ… **API æ•´åˆ**ï¼šæ¨™æº– OpenAI SDKï¼Œé–‹ç™¼ç°¡å–®
- âœ… **è³‡æ–™å®‰å…¨**ï¼šMicrosoft æä¾›ä¼æ¥­ç´šè³‡æ–™ä¿è­·
- âœ… **æ¶æ§‹ç°¡åŒ–**ï¼šä½¿ç”¨å®Œæ•´ 10s æª”æ¡ˆï¼Œæé«˜æˆåŠŸç‡

**å·¥ä½œæµç¨‹**ï¼š
```
å‰ç«¯éŒ„éŸ³ (10s WebM) â†’ REST API ä¸Šå‚³å®Œæ•´æª”æ¡ˆ â†’ å„²å­˜åˆ° R2 â†’ 
FFmpeg è½‰æ› â†’ Azure OpenAI Whisper API â†’ WebSocket æ¨é€è½‰éŒ„çµæœ
```

---

## 8. ä½¿ç”¨å ´æ™¯èˆ‡ç‹€æ…‹æµç¨‹

### å ´æ™¯ 1ï¼šç´”ç­†è¨˜æ¨¡å¼ï¼ˆä¸éŒ„éŸ³ï¼‰

- **ç›®æ¨™**ï¼šè®“ä½¿ç”¨è€…èƒ½å¿«é€Ÿé–‹å§‹åšç­†è¨˜ï¼Œç„¡éœ€é€²è¡Œç¹ç‘£çš„è¨­å®šã€‚
- **æµç¨‹**ï¼š
  1. **é€²å…¥é é¢**ï¼šä½¿ç”¨è€…æ‰“é–‹æ‡‰ç”¨ï¼Œçœ‹åˆ°é è¨­ç•«é¢ï¼ˆ`default` ç‹€æ…‹ï¼‰ã€‚
  2. **è¼¸å…¥å…§å®¹**ï¼š
     - åœ¨ `MarkdownEditor` ä¸­è¼¸å…¥ç­†è¨˜ï¼Œå…§å®¹æš«å­˜æ–¼ `localStorage`ï¼ˆ`draft_note`ï¼‰ã€‚
  3. **å»ºç«‹æœƒè©±**ï¼š
     - ä½¿ç”¨è€…é¦–æ¬¡è¼¸å…¥æ™‚ï¼Œè‡ªå‹•è§¸ç™¼ `createNoteSession()`ï¼Œåœ¨å¾Œç«¯å»ºç«‹ä¸€å€‹ `note_only` é¡å‹çš„ sessionã€‚
     - æˆåŠŸå¾Œï¼Œ`useAutoSave` hook å•Ÿå‹•ï¼Œæ¯ 10 ç§’å°‡ç­†è¨˜å…§å®¹åŒæ­¥åˆ°å¾Œç«¯ã€‚
  4. **å®Œæˆç­†è¨˜**ï¼š
     - ä½¿ç”¨è€…å¯ä»¥éš¨æ™‚é›¢é–‹ï¼Œç­†è¨˜å·²å„²å­˜ã€‚
     - ï¼ˆæœªä¾†åŠŸèƒ½ï¼‰å¯æ‰‹å‹•é»æ“Šã€Œå®Œæˆã€ï¼Œå°‡ session ç‹€æ…‹æ”¹ç‚º `completed`ã€‚

```mermaid
graph TD
    A((ä½¿ç”¨è€…é€²å…¥é é¢)) --> B[é è¨­ç•«é¢<br/>default ç‹€æ…‹]
    
    B --> C[è¼¸å…¥ç­†è¨˜å…§å®¹]
    
    C --> D[æš«å­˜è‡³ localStorage<br/>draft_note]
    
    D --> E{é¦–æ¬¡è¼¸å…¥ï¼Ÿ}
    
    E -->|æ˜¯| F[è‡ªå‹•è§¸ç™¼<br/>createNoteSession]
    E -->|å¦| G[ç¹¼çºŒç·¨è¼¯]
    
    F --> H[å»ºç«‹ note_only<br/>é¡å‹ session]
    
    H --> I[å•Ÿå‹• useAutoSave hook]
    
    I --> J[æ¯ 10 ç§’åŒæ­¥<br/>ç­†è¨˜è‡³å¾Œç«¯]
    
    G --> J
    J --> K[ä½¿ç”¨è€…é›¢é–‹<br/>ç­†è¨˜å·²å„²å­˜]
    J --> L[æ‰‹å‹•é»æ“Šå®Œæˆ<br/>æœªä¾†åŠŸèƒ½]
    
    L --> M[session ç‹€æ…‹<br/>æ”¹ç‚º completed]
    
    %% æ¨£å¼å®šç¾©
    classDef startEndStyle fill:#e8f5e8,stroke:#4caf50,stroke-width:3px,color:#000
    classDef processStyle fill:#e3f2fd,stroke:#2196f3,stroke-width:2px,color:#000
    classDef decisionStyle fill:#fff3e0,stroke:#ff9800,stroke-width:2px,color:#000
    classDef dataStyle fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,color:#000
    classDef autoStyle fill:#e8f5e8,stroke:#4caf50,stroke-width:2px,color:#000
    classDef futureStyle fill:#f5f5f5,stroke:#9e9e9e,stroke-width:2px,color:#666,stroke-dasharray: 5 5
    
    %% æ‡‰ç”¨æ¨£å¼
    class A,K startEndStyle
    class B,C,F,H,I processStyle
    class E decisionStyle
    class D,J dataStyle
    class G autoStyle
    class L,M futureStyle

```

### å ´æ™¯ 2ï¼šå…ˆç­†è¨˜å¾ŒéŒ„éŸ³

- **ç›®æ¨™**ï¼šå…è¨±ä½¿ç”¨è€…åœ¨å·²æœ‰ç­†è¨˜çš„åŸºç¤ä¸Šï¼Œéš¨æ™‚é–‹å§‹éŒ„éŸ³ã€‚
- **æµç¨‹**ï¼š
  1. **é–‹å§‹ç­†è¨˜**ï¼šåŒã€Œå ´æ™¯ 1ã€ï¼Œä½¿ç”¨è€…å·²å»ºç«‹ä¸€å€‹ `note_only` æœƒè©±ä¸¦æœ‰ä¸€äº›ç­†è¨˜å…§å®¹ã€‚
  2. **é»æ“ŠéŒ„éŸ³**ï¼šä½¿ç”¨è€…é»æ“Š `RecordButton`ã€‚
  3. **å‡ç´šæœƒè©±**ï¼š
     - å‘¼å« `upgradeToRecording()`ï¼Œå°‡å¾Œç«¯ session type å¾ `note_only` æ”¹ç‚º `recording`ã€‚
     - å‰ç«¯ç‹€æ…‹å¾ `default` è½‰ç‚º `recording_waiting`ã€‚
  4. **é–‹å§‹éŒ„éŸ³**ï¼šåŒã€Œå ´æ™¯ 3ã€çš„éŒ„éŸ³æµç¨‹ã€‚

### å ´æ™¯ 3ï¼šé‚ŠéŒ„é‚Šè¨˜æ¨¡å¼

- **ç›®æ¨™**ï¼šæä¾›æœ€æ ¸å¿ƒçš„ã€ŒéŒ„éŸ³ + å³æ™‚é€å­—ç¨¿ + ç­†è¨˜ã€æ•´åˆé«”é©—ã€‚
- **æµç¨‹**ï¼š
  1. **å»ºç«‹æœƒè©±**ï¼š
     - ä½¿ç”¨è€…åœ¨ `default` ç‹€æ…‹ä¸‹ï¼Œç›´æ¥é»æ“Š `RecordButton`ã€‚
     - å‘¼å« `createRecordingSession()` å»ºç«‹ `recording` é¡å‹çš„ sessionã€‚
     - å‰ç«¯ç‹€æ…‹ç«‹å³è½‰ç‚º `recording_waiting`ã€‚
  2. **éŒ„éŸ³èˆ‡ä¸Šå‚³**ï¼š
     - `MediaRecorder` é–‹å§‹éŒ„éŸ³ï¼Œä½¿ç”¨ `timeslice=10000`ï¼Œæ¯ 10 ç§’ç”¢ç”Ÿä¸€å€‹å®Œæ•´ WebM æª”æ¡ˆã€‚
     - `ondataavailable` äº‹ä»¶è§¸ç™¼ï¼Œä½¿ç”¨ `fetch` POST åˆ° `/api/segment` ä¸Šå‚³æª”æ¡ˆã€‚
     - å¾Œç«¯ç«‹å³å›æ‡‰ `{"ack": seq}`ï¼Œå‰ç«¯è™•ç†éŒ¯èª¤æ™‚æš«å­˜åˆ° IndexedDBã€‚
  3. **å³æ™‚é€å­—ç¨¿**ï¼š
     - `ws_transcript_feed` WebSocket é€£ç·šå»ºç«‹ã€‚
     - å¾Œç«¯æ”¶åˆ°æª”æ¡ˆå¾Œï¼Œåœ¨èƒŒæ™¯åŸ·è¡Œ FFmpeg è½‰æ› + Whisper API è½‰éŒ„ã€‚
     - Whisper API è¿”å›è½‰éŒ„çµæœï¼Œå¾Œç«¯é€é WebSocket æ¨é€çµ¦å‰ç«¯ã€‚
     - `TranscriptPane` æ¯ 10 ç§’æ”¶åˆ°ä¸€æ‰¹é€å­—ç¨¿ç‰‡æ®µã€‚
  4. **åŒæ­¥ç­†è¨˜**ï¼š
     - ä½¿ç”¨è€…å¯ä»¥åœ¨ `MarkdownEditor` ä¸­éš¨æ™‚è¼¸å…¥ç­†è¨˜ï¼Œ`useAutoSave` æœƒå®šæœŸå„²å­˜ã€‚
  5. **åœæ­¢éŒ„éŸ³**ï¼š
     - ä½¿ç”¨è€…é»æ“Š `RecordButton` (æ­¤æ™‚ç‚ºåœæ­¢åœ–ç¤º)ã€‚
     - `stopRecording()` è¢«å‘¼å«ï¼Œ`MediaRecorder` åœæ­¢ã€‚
     - å‰ç«¯ç‹€æ…‹è½‰ç‚º `processing`ã€‚
  6. **ç­‰å¾…è½‰éŒ„å®Œæˆ**ï¼š
     - `ProcessingOverlay` é¡¯ç¤ºï¼Œé–å®šç·¨è¼¯å€ã€‚
     - å¾Œç«¯è™•ç†å‰©é¤˜çš„éŸ³æª”åˆ‡ç‰‡ï¼Œä¸¦å°‡æœ€å¾Œçš„é€å­—ç¨¿æ¨é€å›ä¾†ã€‚
  7. **å®Œæˆ**ï¼š
     - ç•¶å¾Œç«¯æ¨é€ `transcript_complete` è¨Šæ¯æ™‚ï¼Œå‰ç«¯ç‹€æ…‹è½‰ç‚º `finished`ã€‚
     - `ProcessingOverlay` æ¶ˆå¤±ï¼Œä½¿ç”¨è€…å¯ä»¥æª¢è¦–å®Œæ•´é€å­—ç¨¿ã€ç·¨è¼¯ç­†è¨˜ã€ä¸¦åŒ¯å‡ºã€‚
  8. **åŒ¯å‡ºèˆ‡æ–°ç­†è¨˜**ï¼š
     - `ExportButton` å¯ç”¨ï¼Œé»æ“Šä¸‹è¼‰åŒ…å« `.mp4`ã€`transcript.txt` å’Œ `note.md` çš„ ZIP æª”ã€‚
     - `NewNoteButton` å¯ç”¨ï¼Œé»æ“Šæ¸…ç©ºç•¶å‰ç•«é¢ï¼Œå›åˆ° `default` ç‹€æ…‹ï¼Œé–‹å§‹æ–°çš„ç­†è¨˜ã€‚


# END FILE CONTENTS


# File: app/ws/upload_audio.py

"""
WebSocket éŸ³æª”ä¸Šå‚³æœå‹™

å¯¦ä½œéŸ³æª”åˆ‡ç‰‡å³æ™‚ä¸Šå‚³ã€é‡å‚³æ©Ÿåˆ¶èˆ‡ Cloudflare R2 æ•´åˆ
"""

import json
import logging
import asyncio
import struct
from typing import Dict, Set, Optional, List
from uuid import UUID
from datetime import datetime, timedelta

from fastapi import APIRouter, WebSocket, WebSocketDisconnect, WebSocketException, status, Path, Depends
from supabase import Client
from fastapi import HTTPException
from app.core.container import container
from app.services.stt.factory import get_provider
from ..db.database import get_supabase_client
from ..services.r2_client import get_r2_client, R2ClientError

logger = logging.getLogger(__name__)

router = APIRouter()

class AudioUploadManager:
    """éŸ³æª”ä¸Šå‚³ç®¡ç†å™¨"""

    def __init__(self, websocket: WebSocket, session_id: UUID, supabase_client: Client):
        self.websocket = websocket
        self.session_id = session_id
        self.supabase_client = supabase_client
        self.r2_client = get_r2_client()

        # ç‹€æ…‹ç®¡ç†
        self.is_connected = False
        self.received_chunks: Set[int] = set()  # å·²æ”¶åˆ°çš„åˆ‡ç‰‡åºè™Ÿ
        self.last_heartbeat = datetime.utcnow()
        self.upload_tasks: Dict[int, asyncio.Task] = {}  # ä¸Šå‚³ä»»å‹™è¿½è¹¤

        # è¨­å®š
        self.heartbeat_interval = 30  # å¿ƒè·³é–“éš”ï¼ˆç§’ï¼‰
        self.chunk_timeout = 10  # åˆ‡ç‰‡è™•ç†è¶…æ™‚ï¼ˆç§’ï¼‰
        self.max_pending_uploads = 5  # æœ€å¤§ä¸¦è¡Œä¸Šå‚³æ•¸

    async def _initialize_received_chunks(self):
        """å¾è³‡æ–™åº«åˆå§‹åŒ–å·²æ”¶åˆ°çš„åˆ‡ç‰‡é›†åˆ"""
        try:
            response = self.supabase_client.table("audio_files").select("chunk_sequence").eq("session_id", str(self.session_id)).execute()
            if response.data:
                self.received_chunks = {item['chunk_sequence'] for item in response.data}
                logger.info(f"å¾è³‡æ–™åº«æ¢å¾© {len(self.received_chunks)} å€‹å·²å­˜åœ¨çš„åˆ‡ç‰‡è¨˜éŒ„ for session {self.session_id}")
        except Exception as e:
            logger.error(f"å¾è³‡æ–™åº«åˆå§‹åŒ– received_chunks å¤±æ•—: {e}")
            # å³ä½¿åˆå§‹åŒ–å¤±æ•—ï¼Œä¹Ÿç¹¼çºŒåŸ·è¡Œï¼Œä½†ä½¿ç”¨ç©ºçš„é›†åˆ
            self.received_chunks = set()

    async def handle_connection(self):
        """è™•ç† WebSocket é€£æ¥"""
        logger.info("<<<<< RUNNING UPLOAD_AUDIO.PY CODE (v5) >>>>>")
        try:
            # æ¥å—é€£æ¥
            await self.websocket.accept()
            self.is_connected = True
            logger.info(f"WebSocket é€£æ¥å»ºç«‹: session_id={self.session_id}")

            # å¾è³‡æ–™åº«åŠ è¼‰å·²æœ‰çš„åˆ‡ç‰‡ï¼Œä»¥è™•ç†é‡é€£æƒ…æ³
            await self._initialize_received_chunks()

            # é©—è­‰æœƒè©±ç‹€æ…‹
            if not await self._validate_session():
                await self._send_error("Invalid session or session not in recording mode")
                return

            # ç™¼é€é€£æ¥ç¢ºèª
            await self._send_message({
                "type": "connection_established",
                "session_id": str(self.session_id),
                "timestamp": datetime.utcnow().isoformat()
            })

            # å•Ÿå‹•å¿ƒè·³æª¢æ¸¬
            heartbeat_task = asyncio.create_task(self._heartbeat_monitor())

            try:
                # ä¸»è¦æ¶ˆæ¯è™•ç†å¾ªç’°
                await self._message_loop()
            finally:
                # æ¸…ç†è³‡æº
                heartbeat_task.cancel()
                await self._cleanup()

        except WebSocketDisconnect:
            logger.info(f"WebSocket é€£æ¥æ–·é–‹: session_id={self.session_id}")
        except Exception as e:
            logger.error(f"WebSocket è™•ç†ç•°å¸¸: {e}")
            await self._send_error(f"Connection error: {str(e)}")
        finally:
            self.is_connected = False

    async def _validate_session(self) -> bool:
        """é©—è­‰æœƒè©±å­˜åœ¨ä¸”è™•æ–¼éŒ„éŸ³æ¨¡å¼"""
        try:
            response = self.supabase_client.table("sessions").select("*").eq("id", str(self.session_id)).single().execute()

            if not response.data:
                logger.warning(f"æœƒè©±ä¸å­˜åœ¨: {self.session_id}")
                return False

            session = response.data

            if session.get('status') != 'active':
                logger.warning(f"æœƒè©±éæ´»èºç‹€æ…‹: {self.session_id}, status={session.get('status')}")
                return False

            if session.get('type') != 'recording':
                logger.warning(f"æœƒè©±ééŒ„éŸ³æ¨¡å¼: {self.session_id}, type={session.get('type')}")
                return False

            return True
        except Exception as e:
            logger.error(f"æœƒè©±é©—è­‰æ™‚ç™¼ç”Ÿç•°å¸¸: {self.session_id}, error: {e}")
            return False

    async def _message_loop(self):
        """ä¸»è¦æ¶ˆæ¯è™•ç†å¾ªç’°"""
        while self.is_connected:
            try:
                # æ¥æ”¶æ¶ˆæ¯ï¼ˆäºŒé€²åˆ¶æˆ–æ–‡æœ¬ï¼‰
                data = await self.websocket.receive()

                if "bytes" in data:
                    # è™•ç†äºŒé€²åˆ¶éŸ³æª”åˆ‡ç‰‡
                    await self._handle_audio_chunk(data["bytes"])
                elif "text" in data:
                    # è™•ç†æ–‡æœ¬æ¶ˆæ¯ï¼ˆå¿ƒè·³ã€æ§åˆ¶æŒ‡ä»¤ç­‰ï¼‰
                    await self._handle_text_message(data["text"])

            except WebSocketDisconnect:
                # Case 1: å®¢æˆ¶ç«¯æ­£å¸¸ã€ä¹¾æ·¨åœ°é—œé–‰é€£æ¥
                logger.info("WebSocket gracefully disconnected by client.")
                self.is_connected = False # ç¢ºä¿è¿´åœˆçµ‚æ­¢
                break # ä¹¾æ·¨åœ°é€€å‡ºè¿´åœˆ

            except RuntimeError as e:
                # Case 2: é€£æ¥æ„å¤–ä¸­æ–·ï¼Œå°è‡´ receive() å¤±æ•—
                # æ³¨æ„ï¼šé€™è£¡çš„ "receive" å¿…é ˆæ˜¯é›™å¼•è™Ÿï¼Œæ‰èƒ½åŒ¹é…ç•°å¸¸æ¶ˆæ¯
                if 'Cannot call "receive" once a disconnect message has been received' in str(e):
                    logger.info(f"WebSocket connection closed (RuntimeError on receive), breaking loop: {e}")
                    self.is_connected = False # ç¢ºä¿è¿´åœˆçµ‚æ­¢
                    break # ä¹¾æ·¨åœ°é€€å‡ºè¿´åœˆ
                else:
                    # è™•ç†å…¶ä»–é¡å‹çš„ RuntimeError
                    logger.error(f"An unexpected runtime error occurred in message loop: {e}", exc_info=True)
                    await self._send_error(f"Message processing runtime error: {str(e)}")
                    # å³ä½¿ç™¼é€éŒ¯èª¤ï¼Œä¹Ÿè¦ä¸­æ–·è¿´åœˆ
                    self.is_connected = False
                    break

            except Exception as e:
                # Case 3: è™•ç†æ‰€æœ‰å…¶ä»–æœªé æœŸçš„éŒ¯èª¤
                logger.error(f"An unexpected error occurred in message loop: {e}", exc_info=True)
                await self._send_error(f"Message processing error: {str(e)}")
                # ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤å¾Œä¹Ÿä¸­æ–·è¿´åœˆï¼Œé¿å…ç„¡é™å¾ªç’°
                self.is_connected = False
                break

    async def _handle_audio_chunk(self, chunk_data: bytes):
        """è™•ç†éŸ³æª”åˆ‡ç‰‡æ•¸æ“š"""
        try:
            # è§£æåˆ‡ç‰‡æ ¼å¼ï¼š4å­—ç¯€åºè™Ÿ + éŸ³æª”æ•¸æ“š
            if len(chunk_data) < 4:
                await self._send_error("Invalid chunk format: too short")
                return

            # è§£åŒ…åºè™Ÿï¼ˆå°ç«¯åº unsigned intï¼‰
            chunk_sequence = struct.unpack('<I', chunk_data[:4])[0]
            audio_data = chunk_data[4:]

            if len(audio_data) == 0:
                await self._send_error(f"Empty audio data for chunk {chunk_sequence}")
                return

            logger.debug(f"æ”¶åˆ°éŸ³æª”åˆ‡ç‰‡: seq={chunk_sequence}, size={len(audio_data)}")

            # æª¢æŸ¥æ˜¯å¦ç‚ºé‡è¤‡åˆ‡ç‰‡
            if chunk_sequence in self.received_chunks:
                logger.debug(f"å¿½ç•¥é‡è¤‡åˆ‡ç‰‡: seq={chunk_sequence}")
                await self._send_ack(chunk_sequence)
                return

            # è¨˜éŒ„å·²æ”¶åˆ°çš„åˆ‡ç‰‡
            self.received_chunks.add(chunk_sequence)

            # é™åˆ¶ä¸¦è¡Œä¸Šå‚³æ•¸é‡
            if len(self.upload_tasks) >= self.max_pending_uploads:
                # ç­‰å¾…æœ€èˆŠçš„ä¸Šå‚³å®Œæˆ
                oldest_task = min(self.upload_tasks.values(), key=lambda t: t.get_name())
                await oldest_task

            # éåŒæ­¥ä¸Šå‚³åˆ° R2
            upload_task = asyncio.create_task(
                self._upload_chunk_to_r2(chunk_sequence, audio_data)
            )
            self.upload_tasks[chunk_sequence] = upload_task

        except Exception as e:
            logger.error(f"éŸ³æª”åˆ‡ç‰‡è™•ç†å¤±æ•—: {e}")
            await self._send_error(f"Chunk processing error: {str(e)}")

    async def _upload_chunk_to_r2(self, chunk_sequence: int, audio_data: bytes):
        """ä¸Šå‚³éŸ³æª”åˆ‡ç‰‡åˆ° R2 ä¸¦è§¸ç™¼è½‰éŒ„"""
        try:
            result = await self.r2_client.store_chunk_blob(
                session_id=self.session_id,
                chunk_sequence=chunk_sequence,
                blob_data=audio_data,
                supabase_client=self.supabase_client
            )

            if result['success']:
                # ä¸Šå‚³æˆåŠŸï¼Œç™¼é€ ACK
                await self._send_ack(chunk_sequence)
                logger.debug(f"åˆ‡ç‰‡ä¸Šå‚³æˆåŠŸ: seq={chunk_sequence}, size={len(audio_data)}")

                # è½‰éŒ„å‘¼å«
                provider = get_provider(self.session_id)
                logger.info(f"ğŸ¯ [WSè½‰éŒ„] é–‹å§‹è½‰éŒ„ seq={chunk_sequence} (provider={provider.name()})")
                result = await provider.transcribe(audio_data, self.session_id, chunk_sequence)
                if result:
                    logger.info(f"âœ… [WSè½‰éŒ„] seq={chunk_sequence} è½‰éŒ„æˆåŠŸ")
                    # TODO: å¾ŒçºŒå„²å­˜/æ¨æ’­ result
                else:
                    logger.warning(f"âš ï¸ [WSè½‰éŒ„] seq={chunk_sequence} è½‰éŒ„å¤±æ•—")
            else:
                # ä¸Šå‚³å¤±æ•—
                error_message = result.get('error', 'Unknown R2 upload error')
                await self._send_upload_error(chunk_sequence, error_message)
                # å¾ received_chunks ç§»é™¤ï¼Œå…è¨±é‡è©¦
                self.received_chunks.discard(chunk_sequence)
                logger.error(f"åˆ‡ç‰‡ä¸Šå‚³å¤±æ•—: seq={chunk_sequence}, error={error_message}")

        except Exception as e:
            logger.error(f"ä¸Šå‚³åˆ° R2 å¤±æ•—: seq={chunk_sequence}, error: {e}")
            await self._send_upload_error(chunk_sequence, str(e))
            # å¾ received_chunks ç§»é™¤ï¼Œå…è¨±é‡è©¦
            self.received_chunks.discard(chunk_sequence)
        finally:
            # æ¸…ç†è¿½è¹¤å­—å…¸ä¸­çš„ä»»å‹™
            self.upload_tasks.pop(chunk_sequence, None)

    async def _handle_text_message(self, message_text: str):
        """è™•ç†æ–‡æœ¬æ¶ˆæ¯"""
        try:
            message = json.loads(message_text)
            msg_type = message.get("type")

            if msg_type == "heartbeat":
                # æ›´æ–°å¿ƒè·³æ™‚é–“
                self.last_heartbeat = datetime.utcnow()
                await self._send_message({"type": "heartbeat_ack"})

            elif msg_type == "request_missing":
                # å®¢æˆ¶ç«¯è«‹æ±‚ç¼ºå¤±åˆ‡ç‰‡åˆ—è¡¨
                await self._send_missing_chunks()

            elif msg_type == "upload_complete":
                # å®¢æˆ¶ç«¯è¡¨ç¤ºä¸Šå‚³å®Œæˆ
                await self._handle_upload_complete()

            else:
                logger.warning(f"æœªçŸ¥æ¶ˆæ¯é¡å‹: {msg_type}")

        except json.JSONDecodeError:
            logger.error(f"JSON è§£æå¤±æ•—: {message_text}")
            await self._send_error("Invalid JSON message")
        except Exception as e:
            logger.error(f"æ–‡æœ¬æ¶ˆæ¯è™•ç†å¤±æ•—: {e}")
            await self._send_error(f"Text message error: {str(e)}")

    async def _send_ack(self, chunk_sequence: int):
        """ç™¼é€åˆ‡ç‰‡ç¢ºèª"""
        await self._send_message({
            "type": "ack",
            "chunk_sequence": chunk_sequence,
            "timestamp": datetime.utcnow().isoformat()
        })

    async def _send_upload_error(self, chunk_sequence: int, error_msg: str):
        """ç™¼é€ä¸Šå‚³éŒ¯èª¤"""
        await self._send_message({
            "type": "upload_error",
            "chunk_sequence": chunk_sequence,
            "error": error_msg,
            "timestamp": datetime.utcnow().isoformat()
        })

    async def _send_missing_chunks(self):
        """ç™¼é€ç¼ºå¤±åˆ‡ç‰‡åˆ—è¡¨ï¼ˆå¯¦ä½œé‡å‚³æ©Ÿåˆ¶ï¼‰"""
        # é€™è£¡å¯ä»¥å¯¦ä½œæ›´è¤‡é›œçš„ç¼ºå¤±æª¢æ¸¬é‚è¼¯
        # ç›®å‰ç°¡å–®è¿”å›å·²æ”¶åˆ°çš„åˆ‡ç‰‡åˆ—è¡¨
        await self._send_message({
            "type": "chunk_status",
            "received_chunks": sorted(list(self.received_chunks)),
            "total_received": len(self.received_chunks),
            "timestamp": datetime.utcnow().isoformat()
        })

    async def _handle_upload_complete(self):
        """è™•ç†ä¸Šå‚³å®Œæˆ"""
        # ç­‰å¾…æ‰€æœ‰é€²è¡Œä¸­çš„ä¸Šå‚³å®Œæˆ
        if self.upload_tasks:
            logger.info(f"ç­‰å¾… {len(self.upload_tasks)} å€‹ä¸Šå‚³ä»»å‹™å®Œæˆ")
            await asyncio.gather(*self.upload_tasks.values(), return_exceptions=True)

        # å‘å®¢æˆ¶ç«¯ç¢ºèªå…¨éƒ¨åˆ‡ç‰‡å·²æ¥æ”¶
        await self._send_message({
            "type": "all_chunks_received"
        })
        await self._send_message({
            "type": "upload_complete_ack",
            "total_chunks": len(self.received_chunks),
            "timestamp": datetime.utcnow().isoformat()
        })

        logger.info(f"éŸ³æª”ä¸Šå‚³å®Œæˆ: session_id={self.session_id}, chunks={len(self.received_chunks)}")

    async def _heartbeat_monitor(self):
        """å¿ƒè·³ç›£æ§å™¨ï¼Œè¶…æ™‚å‰‡é—œé–‰é€£æ¥"""
        while self.is_connected:
            await asyncio.sleep(self.heartbeat_interval)
            if datetime.utcnow() - self.last_heartbeat > timedelta(seconds=self.heartbeat_interval * 2):
                logger.warning(f"å¿ƒè·³è¶…æ™‚ï¼Œé—œé–‰é€£æ¥: session_id={self.session_id}")
                await self._send_error("Heartbeat timeout")
                await self.websocket.close(code=status.WS_1008_POLICY_VIOLATION)
                break

    async def _send_message(self, message: dict):
        """å®‰å…¨åœ°ç™¼é€æ¶ˆæ¯ï¼ˆå³ä½¿ is_connected ç‚º False äº¦å˜—è©¦å‚³é€ï¼Œä¾¿æ–¼å–®å…ƒæ¸¬è©¦é©—è­‰ï¼‰"""
        try:
            await self.websocket.send_text(json.dumps(message))
        except (WebSocketDisconnect, RuntimeError) as e:
            logger.warning(f"ç™¼é€æ¶ˆæ¯å¤±æ•—ï¼Œé€£æ¥å¯èƒ½å·²é—œé–‰: {e}")
            self.is_connected = False  # æ¨™è¨˜ç‚ºå·²æ–·é–‹

    async def _send_error(self, error_msg: str):
        """å®‰å…¨åœ°ç™¼é€éŒ¯èª¤æ¶ˆæ¯"""
        logger.error(f"WebSocket éŒ¯èª¤ç™¼é€è‡³å®¢æˆ¶ç«¯: {error_msg}")
        await self._send_message({
            "type": "error",
            "message": error_msg
        })

    async def _cleanup(self):
        """æ¸…ç†è³‡æºï¼Œä¾‹å¦‚ç­‰å¾…ä¸­çš„ä¸Šå‚³ä»»å‹™"""
        if self.upload_tasks:
            logger.info(f"ç­‰å¾… {len(self.upload_tasks)} å€‹ä¸Šå‚³ä»»å‹™å®Œæˆ...")
            await asyncio.gather(*self.upload_tasks.values())
        logger.info(f"æ¸…ç†å®Œæˆ: session_id={self.session_id}")


@router.websocket("/ws/upload_audio/{session_id}")
async def websocket_endpoint(
    websocket: WebSocket,
    session_id: UUID = Path(...),
    supabase_client: Client = Depends(get_supabase_client)
):
    """
    WebSocket ç«¯é»ï¼šè™•ç†éŸ³æª”ä¸Šå‚³

    - B-005: å»ºç«‹ WebSocket ç«¯é»
    - B-012: å¯¦ä½œ ACK/Missing é‡å‚³æ©Ÿåˆ¶
    - æ•´åˆ Cloudflare R2 ä¸Šå‚³èˆ‡ Azure OpenAI è½‰éŒ„
    """
    manager = AudioUploadManager(websocket, session_id, supabase_client)
    await manager.handle_connection()


def handle_ack_missing(received_chunks: Set[int], expected_total: Optional[int] = None) -> dict:
    """
    æ ¹æ“šå·²æ”¶åˆ°çš„åˆ‡ç‰‡åˆ—è¡¨ï¼Œç”¢ç”Ÿ ack/missing å ±å‘Š (B-012)

    Args:
        received_chunks: å·²æ”¶åˆ°çš„åˆ‡ç‰‡åºè™Ÿé›†åˆ
        expected_total: é æœŸçš„ç¸½åˆ‡ç‰‡æ•¸ï¼ˆå¯é¸ï¼‰

    Returns:
        dict: ACK/Missing ç‹€æ…‹éŸ¿æ‡‰
    """
    if not received_chunks:
        return {
            "type": "status",
            "received_count": 0,
            "missing_chunks": [],
            "status": "waiting"
        }

    # è¨ˆç®—ç¼ºå¤±çš„åˆ‡ç‰‡
    min_chunk = min(received_chunks)
    max_chunk = max(received_chunks)

    # å¦‚æœæœ‰æŒ‡å®šç¸½æ•¸ï¼Œä½¿ç”¨ç¸½æ•¸ï¼›å¦å‰‡åŸºæ–¼æœ€å¤§åºè™Ÿæ¨æ¸¬
    total_expected = expected_total or (max_chunk + 1)

    expected_chunks = set(range(total_expected))
    missing_chunks = sorted(list(expected_chunks - received_chunks))

    return {
        "type": "status",
        "received_count": len(received_chunks),
        "expected_total": total_expected,
        "missing_chunks": missing_chunks,
        "status": "complete" if not missing_chunks else "incomplete"
    }


# END FILE CONTENTS


# File: frontend/components/NetworkRestorerClient.tsx

"use client"
import { useNetworkRestorer } from '@/hooks/useNetworkRestorer'

export function NetworkRestorerClient() {
    useNetworkRestorer()
    return null
}


# END FILE CONTENTS


# File: frontend/hooks/use-recording-new.ts

"use client"

import { useState, useCallback, useRef, useEffect } from 'react'
import { useAppStateContext } from './use-app-state-context'
import { isFeatureEnabled } from '../lib/feature-flags'
import { SERVICE_KEYS, serviceContainer } from '../lib/services'
import type { IRecordingService, ITranscriptService, TranscriptMessage } from '../lib/services'

interface UseRecordingNewReturn {
  isRecording: boolean
  recordingTime: number
  transcripts: TranscriptMessage[]
  transcriptCompleted: boolean
  error: string | null
  startRecording: (sessionId: string) => Promise<void>
  stopRecording: () => void
  clearTranscripts: () => void
}

/**
 * useRecordingNew - éŒ„éŸ³ç®¡ç† Hook (é©é…å™¨å±¤)
 *
 * é‡æ§‹ç‚ºé©é…å™¨å±¤ï¼š
 * - å…§éƒ¨èª¿ç”¨ RecordingService å’Œ TranscriptService è€Œéç›´æ¥ç®¡ç†éŸ³é »éŒ„è£½å™¨
 * - ä¿æŒå°å¤–æ¥å£å®Œå…¨ä¸è®Šï¼Œç¢ºä¿çµ„ä»¶å±¤ç„¡æ„ŸçŸ¥è®Šæ›´
 * - ç°¡åŒ–è¤‡é›œçš„éŒ„éŸ³é‚è¼¯ï¼Œå§”è¨—çµ¦æœå‹™å±¤è™•ç†
 */
export function useRecordingNew(): UseRecordingNewReturn {
  // ä½¿ç”¨æ–°çš„ Context ç‹€æ…‹ç®¡ç†
  const context = useAppStateContext()

  // æœ¬åœ°ç‹€æ…‹ï¼ˆå°‡é€æ¼¸é·ç§»åˆ° Contextï¼‰
  const [localError, setLocalError] = useState<string | null>(null)
  const [localTranscriptCompleted, setLocalTranscriptCompleted] = useState(false)

  // æœå‹™å¼•ç”¨
  const recordingServiceRef = useRef<IRecordingService | null>(null)
  const transcriptServiceRef = useRef<ITranscriptService | null>(null)
  const currentSessionIdRef = useRef<string | null>(null)

  // å…¨åŸŸå”¯ä¸€éŒ„éŸ³è¨ˆæ™‚å™¨ - ä½¿ç”¨ useRef ä¿æŒç©©å®šå¼•ç”¨
  const recTimerRef = useRef<ReturnType<typeof setInterval> | null>(null)
  const recordingStartedAtRef = useRef<number | null>(null)

  // waitingâ†’active è¶…æ™‚ä¿éšª
  const waitingTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null)

  console.log('ğŸ”„ [useRecordingNew] Hook åˆå§‹åŒ– (é©é…å™¨å±¤)ï¼ŒåŠŸèƒ½é–‹é—œç‹€æ…‹:', {
    useNewStateManagement: isFeatureEnabled('useNewStateManagement'),
    useNewRecordingHook: isFeatureEnabled('useNewRecordingHook'),
    contextState: context.appData.state,
    contextIsRecording: context.appData.isRecording,
    contextRecordingTime: context.appData.recordingTime,
    timestamp: new Date().toISOString()
  })

  // æ¸…é™¤ waiting è¶…æ™‚
  const clearWaitingTimeout = useCallback(() => {
    if (waitingTimeoutRef.current) {
      clearTimeout(waitingTimeoutRef.current)
      waitingTimeoutRef.current = null
      console.log('â° [useRecordingNew] Waiting è¶…æ™‚å·²æ¸…é™¤')
    }
  }, [])

  // åˆå§‹åŒ–æœå‹™å¯¦ä¾‹
  const initializeServices = useCallback(() => {
    if (!recordingServiceRef.current) {
      try {
        recordingServiceRef.current = serviceContainer.resolve<IRecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
        console.log('âœ… [useRecordingNew] RecordingService åˆå§‹åŒ–æˆåŠŸ')
      } catch (error) {
        console.error('âŒ [useRecordingNew] ç„¡æ³•è§£æ RecordingService:', error)
        throw new Error('éŒ„éŸ³æœå‹™åˆå§‹åŒ–å¤±æ•—')
      }
    }

    if (!transcriptServiceRef.current) {
      try {
        transcriptServiceRef.current = serviceContainer.resolve<ITranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)
        console.log('âœ… [useRecordingNew] TranscriptService åˆå§‹åŒ–æˆåŠŸ')
      } catch (error) {
        console.error('âŒ [useRecordingNew] ç„¡æ³•è§£æ TranscriptService:', error)
        throw new Error('é€å­—ç¨¿æœå‹™åˆå§‹åŒ–å¤±æ•—')
      }
    }
  }, [])

  // è™•ç†é€å­—ç¨¿æ¥æ”¶ - æ•´åˆ Context
  const handleTranscript = useCallback((transcript: TranscriptMessage) => {
    console.log('ğŸ“ [useRecordingNew] æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯:', {
      type: transcript.type,
      text: transcript.text,
      textLength: transcript.text?.length || 0,
      start_time: transcript.start_time,
      end_time: transcript.end_time,
      start_sequence: transcript.start_sequence,
      confidence: transcript.confidence,
      sessionId: currentSessionIdRef.current,
      timestamp: new Date().toISOString(),
    })

    // è™•ç†è½‰éŒ„å®Œæˆé€šçŸ¥
    if (transcript.type === 'transcript_complete' || transcript.message === 'transcription_complete') {
      console.log('âœ… [useRecordingNew] é€å­—ç¨¿è½‰éŒ„å®Œæˆï¼Œè¨­å®š transcriptCompleted=true')
      setLocalTranscriptCompleted(true)
      return
    }

    // è™•ç† active phase è¨Šæ¯ï¼ˆé‡è¦ï¼šé€™æœƒè§¸ç™¼ç‹€æ…‹è½‰æ›ï¼‰
    if (transcript.type === 'active' || transcript.phase === 'active') {
      console.log('ğŸš€ [useRecordingNew] æ”¶åˆ° active phase è¨Šæ¯ï¼Œè½‰éŒ„é–‹å§‹')
      // æ¸…é™¤ waiting è¶…æ™‚
      clearWaitingTimeout()
      // ä½¿ç”¨ç‹€æ…‹æ©Ÿè§¸ç™¼è½‰æ›
      const result = context.transition('FIRST_TRANSCRIPT_RECEIVED')
      if (result?.success) {
        console.log('âœ… [useRecordingNew] ç‹€æ…‹æ©Ÿè½‰æ›æˆåŠŸ: recording_waiting â†’ recording_active')
      }
      return
    }

    // åªè™•ç†é€å­—ç¨¿ç‰‡æ®µé¡å‹çš„è¨Šæ¯
    if (transcript.type !== 'transcript_segment') {
      console.log('âš ï¸ [useRecordingNew] è·³ééé€å­—ç¨¿ç‰‡æ®µè¨Šæ¯:', transcript.type)
      return
    }

    if (!transcript.text) {
      console.log('âš ï¸ [useRecordingNew] è·³éç©ºæ–‡å­—é€å­—ç¨¿')
      return
    }

    console.log('ğŸ”„ [useRecordingNew] é–‹å§‹è™•ç†é€å­—ç¨¿ç‰‡æ®µ...', {
      text: transcript.text,
      textPreview: transcript.text.substring(0, 50) + '...',
      sequence: transcript.start_sequence,
      startTime: transcript.start_time,
      endTime: transcript.end_time
    })

    // ä½¿ç”¨ Context æ›´æ–°é€å­—ç¨¿ - è½‰æ›ç‚º TranscriptEntry æ ¼å¼
    const startTime = transcript.start_time ?? 0
    const hours = Math.floor(startTime / 3600)
    const minutes = Math.floor((startTime % 3600) / 60)
    const seconds = Math.floor(startTime % 60)
    const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

    const transcriptEntry = {
      time: timeStr,
      text: transcript.text ?? '',
    }

    // å¦‚æœæ˜¯ç¬¬ä¸€å€‹é€å­—ç¨¿ç‰‡æ®µä¸”ç‹€æ…‹é‚„æ˜¯ waitingï¼Œå…ˆè§¸ç™¼ç‹€æ…‹è½‰æ›
    const isFirstTranscript = context.appData.state === 'recording_waiting' && context.appData.transcriptEntries.length === 0

    context.addTranscriptEntry(transcriptEntry)
    console.log('âœ… [useRecordingNew] é€å­—ç¨¿å·²æ·»åŠ åˆ° Context')

    if (isFirstTranscript) {
      // æ¸…é™¤ waiting è¶…æ™‚
      clearWaitingTimeout()
      const result = context.transition('FIRST_TRANSCRIPT_RECEIVED')
      if (result?.success) {
        console.log('âœ… [useRecordingNew] æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿ç‰‡æ®µï¼Œç‹€æ…‹æ©Ÿè½‰æ›: recording_waiting â†’ recording_active')
      } else {
        console.warn('âš ï¸ [useRecordingNew] ç‹€æ…‹æ©Ÿè½‰æ›å¤±æ•—:', result?.error)
      }
    }
  }, [context, clearWaitingTimeout])

  // é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨æœå‹™å±¤
  const startRecording = useCallback(async (sessionId: string): Promise<void> => {
    try {
      setLocalError(null)
      context.setError(null)
      setLocalTranscriptCompleted(false)
      currentSessionIdRef.current = sessionId

      // ç«‹å³å•Ÿå‹•è¨ˆæ™‚å™¨
      if (recTimerRef.current) {
        clearInterval(recTimerRef.current)
        recTimerRef.current = null
      }
      recordingStartedAtRef.current = Date.now()
      context.setRecordingTime(0)
      recTimerRef.current = setInterval(() => {
        if (recordingStartedAtRef.current) {
          const sec = Math.floor((Date.now() - recordingStartedAtRef.current) / 1000)
          context.setRecordingTime(sec)
        }
      }, 1000)

      context.setRecording(true)
      console.log('â±ï¸ [useRecordingNew] è¨ˆæ™‚å™¨ç«‹å³å•Ÿå‹•')

      // è¨­ç½® waitingâ†’active è¶…æ™‚ä¿éšªï¼ˆ20ç§’ï¼‰
      clearWaitingTimeout()
      waitingTimeoutRef.current = setTimeout(() => {
        if (context.appData.state === 'recording_waiting') {
          console.warn('âš ï¸ [useRecordingNew] 20ç§’å…§æœªæ”¶åˆ°é€å­—ç¨¿ï¼Œå¼·åˆ¶è½‰æ›åˆ° recording_active')
          const result = context.transition('FIRST_TRANSCRIPT_RECEIVED')
          if (result?.success) {
            console.log('âœ… [useRecordingNew] è¶…æ™‚ä¿éšªè§¸ç™¼: recording_waiting â†’ recording_active')
          } else {
            console.error('âŒ [useRecordingNew] è¶…æ™‚ä¿éšªè½‰æ›å¤±æ•—:', result?.error)
          }
        }
      }, 20000)
      console.log('â° [useRecordingNew] å·²è¨­ç½® 20 ç§’ waiting è¶…æ™‚ä¿éšª')

      // åˆå§‹åŒ–æœå‹™
      initializeServices()
      const recordingService = recordingServiceRef.current!
      console.log('Recorder instance', recordingService)
      const transcriptService = transcriptServiceRef.current!

      // ç¢ºä¿å…ˆå»ºç«‹ WebSocket é€£ç·šå†è¨»å†Šç›£è½å™¨ï¼Œé¿å…æ¼æ¥è¨Šæ¯
      await transcriptService.connect(sessionId)

      // è¨­ç½®éŒ„éŸ³ç‹€æ…‹ç›£è½ï¼ˆä¿ç•™åŸæœ¬ interval ä½œç‚ºå‚™ç”¨ï¼‰
      const checkRecordingState = () => {
        const state = recordingService.getRecordingState()
        context.setRecording(state.isRecording)
        // context.setRecordingTime(state.recordingTime) // ç”± recTimer ä¸»å°
        if (state.error) {
          setLocalError(state.error)
          context.setError(state.error)
        }
      }
      const stateCheckInterval = setInterval(checkRecordingState, 1000)

      transcriptService.addTranscriptListener(sessionId, handleTranscript)
      await recordingService.startRecording(sessionId)

      const cleanup = () => {
        clearInterval(stateCheckInterval)
        transcriptService.removeTranscriptListener(sessionId, handleTranscript)
        if (recTimerRef.current) {
          clearInterval(recTimerRef.current)
          recTimerRef.current = null
          recordingStartedAtRef.current = null
          console.log('â¹ï¸ [useRecordingNew] è¨ˆæ™‚å™¨å·²æ¸…é™¤')
        }
        // æ¸…é™¤ waiting è¶…æ™‚
        clearWaitingTimeout()
      }
      (globalThis as any).currentRecordingCleanup = cleanup
      console.log('âœ… [useRecordingNew] éŒ„éŸ³é–‹å§‹æˆåŠŸ (æœå‹™å±¤)ï¼ŒSession ID:', sessionId)
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      setLocalError(errorMessage)
      context.setError(errorMessage)
      console.error('âŒ [useRecordingNew] é–‹å§‹éŒ„éŸ³å¤±æ•—:', err)
      // æ¸…é™¤ waiting è¶…æ™‚
      clearWaitingTimeout()
    }
  }, [initializeServices, handleTranscript, context, clearWaitingTimeout])

  // åœæ­¢éŒ„éŸ³ - ä½¿ç”¨æœå‹™å±¤
  const stopRecording = useCallback(() => {
    try {
      console.log('ğŸ›‘ [useRecordingNew] åœæ­¢éŒ„éŸ³ (é©é…å™¨å±¤)')
      // æ¸…é™¤ recTimer
      if (recTimerRef.current) {
        clearInterval(recTimerRef.current)
        recTimerRef.current = null
        recordingStartedAtRef.current = null
        console.log('â¹ï¸ [useRecordingNew] è¨ˆæ™‚å™¨å·²æ¸…é™¤')
      }
      // æ¸…é™¤ waiting è¶…æ™‚
      clearWaitingTimeout()
      // åŸ·è¡Œæ¸…ç†å‡½æ•¸
      const cleanup = (globalThis as any).currentRecordingCleanup
      if (cleanup) {
        cleanup()
        delete (globalThis as any).currentRecordingCleanup
      }
      // ä½¿ç”¨æœå‹™å±¤åœæ­¢éŒ„éŸ³
      const recordingService = recordingServiceRef.current
      if (recordingService) {
        recordingService.stopRecording()
      }

      // æ›´æ–° Context ç‹€æ…‹
      context.setRecording(false)

      console.log('âœ… [useRecordingNew] éŒ„éŸ³åœæ­¢æˆåŠŸ (æœå‹™å±¤)ï¼Œç­‰å¾…è½‰éŒ„å®Œæˆ')

    } catch (err) {
      console.error('âŒ [useRecordingNew] åœæ­¢éŒ„éŸ³å¤±æ•—:', err)
      const errorMessage = 'åœæ­¢éŒ„éŸ³æ™‚ç™¼ç”ŸéŒ¯èª¤'
      setLocalError(errorMessage)
      context.setError(errorMessage)
    }
  }, [context, clearWaitingTimeout])

  // æ¸…ç©ºé€å­—ç¨¿ - æ•´åˆ Context
  const clearTranscripts = useCallback(() => {
    context.setTranscriptEntries([])
    setLocalTranscriptCompleted(false)
    console.log('ğŸ”„ [useRecordingNew] é€å­—ç¨¿å·²æ¸…é™¤ (é©é…å™¨å±¤)')
  }, [context])

  // æ¸…ç†è³‡æº
  useEffect(() => {
    return () => {
      // æ¸…ç†é€å­—ç¨¿ç›£è½å™¨
      if (currentSessionIdRef.current && transcriptServiceRef.current) {
        transcriptServiceRef.current.removeTranscriptListener(currentSessionIdRef.current, handleTranscript)
      }

      // æ¸…ç†éŒ„éŸ³ç‹€æ…‹æª¢æŸ¥
      const cleanup = (globalThis as any).currentRecordingCleanup
      if (cleanup) {
        cleanup()
        delete (globalThis as any).currentRecordingCleanup
      }

      // æ¸…ç†è¨ˆæ™‚å™¨
      if (recTimerRef.current) {
        clearInterval(recTimerRef.current)
        recTimerRef.current = null
        recordingStartedAtRef.current = null
        console.log('ğŸ”š [useRecordingNew] useEffect cleanup: è¨ˆæ™‚å™¨å·²æ¸…é™¤')
      }

      // æ¸…ç† waiting è¶…æ™‚
      clearWaitingTimeout()
    }
  }, [handleTranscript, clearWaitingTimeout])

  // çµ„ä»¶çœŸæ­£å¸è¼‰æ™‚çš„æ¸…ç†ï¼ˆä¾‹å¦‚é é¢åˆ‡æ›ï¼‰
  useEffect(() => {
    const handleUnload = () => {
      console.log('ğŸ”š [useRecordingNew] é é¢å¸è¼‰ï¼Œæ¸…ç†æ‰€æœ‰è³‡æº (é©é…å™¨å±¤)')
      const cleanup = (globalThis as any).currentRecordingCleanup
      if (cleanup) {
        cleanup()
        delete (globalThis as any).currentRecordingCleanup
      }

      const recordingService = recordingServiceRef.current
      if (recordingService) {
        recordingService.stopRecording()
      }
    }

    window.addEventListener('beforeunload', handleUnload)
    return () => {
      window.removeEventListener('beforeunload', handleUnload)
    }
  }, [])

  // è½‰æ› TranscriptMessage[] ç‚ºå‘å¾Œç›¸å®¹æ ¼å¼
  const compatibleTranscripts: TranscriptMessage[] = context.appData.transcriptEntries.map((entry, index) => ({
    type: 'transcript_segment',
    text: entry.text,
    start_time: 0, // ç°¡åŒ–è™•ç†ï¼Œå¯¦éš›æ‡‰è©²å¾ time å­—ä¸²è§£æ
    end_time: 0,
    start_sequence: index,
    confidence: 1.0,
    timestamp: Date.now(),
  }))

  // è¿”å›ä»‹é¢ä¿æŒèˆ‡èˆŠç‰ˆç›¸å®¹
  return {
    isRecording: context.appData.isRecording,
    recordingTime: context.appData.recordingTime,
    transcripts: compatibleTranscripts,
    transcriptCompleted: localTranscriptCompleted,
    error: context.error || localError,
    startRecording,
    stopRecording,
    clearTranscripts,
  }
}


# END FILE CONTENTS


# File: frontend/lib/feature-flags.ts

"use client"

// åŠŸèƒ½é–‹é—œé…ç½®
export interface FeatureFlags {
  useNewStateManagement: boolean
  useNewRecordingHook: boolean
  useNewSessionHook: boolean
  useNewTranscriptHook: boolean
  useNewAppStateHook: boolean
  useSimpleRecordingService: boolean  // ğŸ”§ Phase 2.5: ä½¿ç”¨é€²éšéŒ„éŸ³æœå‹™ (AdvancedAudioRecorder)
  enableStateSync: boolean
  enableDebugLogging: boolean
}

// é è¨­åŠŸèƒ½é–‹é—œè¨­å®šï¼ˆæ–°æ¨¡å¼å•Ÿç”¨ï¼‰
const defaultFeatureFlags: FeatureFlags = {
  useNewStateManagement: true,   // ğŸ†• å•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç†
  useNewRecordingHook: true,     // ğŸ†• å•Ÿç”¨æ–° recording hook
  useNewSessionHook: true,       // ğŸ†• å•Ÿç”¨æ–° session hook
  useNewTranscriptHook: true,    // ğŸ†• å•Ÿç”¨æ–° transcript hook
  useNewAppStateHook: true,      // ğŸ†• å•Ÿç”¨æ–° app state hook
  useSimpleRecordingService: true, // ğŸ”§ Phase 2.5: å•Ÿç”¨é€²éšéŒ„éŸ³æœå‹™ (ä¿®å¾© WebM Header)
  enableStateSync: true,         // é è¨­é–‹å•Ÿç‹€æ…‹åŒæ­¥
  enableDebugLogging: true,      // é è¨­é–‹å•Ÿèª¿è©¦æ—¥èªŒ
}

// å¾ localStorage è®€å–åŠŸèƒ½é–‹é—œè¨­å®š
function loadFeatureFlags(): FeatureFlags {
  if (typeof window === 'undefined') {
    return defaultFeatureFlags
  }

  try {
    const stored = localStorage.getItem('study-scriber-feature-flags')
    if (stored) {
      const parsed = JSON.parse(stored)
      return { ...defaultFeatureFlags, ...parsed }
    }
  } catch (error) {
    console.warn('ğŸš© [FeatureFlags] è®€å–åŠŸèƒ½é–‹é—œå¤±æ•—:', error)
  }

  return defaultFeatureFlags
}

// å„²å­˜åŠŸèƒ½é–‹é—œè¨­å®šåˆ° localStorage
function saveFeatureFlags(flags: Partial<FeatureFlags>): void {
  if (typeof window === 'undefined') return

  try {
    const current = loadFeatureFlags()
    const updated = { ...current, ...flags }
    localStorage.setItem('study-scriber-feature-flags', JSON.stringify(updated))
    console.log('ğŸš© [FeatureFlags] åŠŸèƒ½é–‹é—œå·²æ›´æ–°:', updated)
  } catch (error) {
    console.error('ğŸš© [FeatureFlags] å„²å­˜åŠŸèƒ½é–‹é—œå¤±æ•—:', error)
  }
}

// åŠŸèƒ½é–‹é—œç®¡ç†å™¨
class FeatureFlagManager {
  private flags: FeatureFlags

  constructor() {
    this.flags = loadFeatureFlags()
    this.exposeToWindow()
  }

  // æª¢æŸ¥åŠŸèƒ½æ˜¯å¦å•Ÿç”¨
  isEnabled(flag: keyof FeatureFlags): boolean {
    return this.flags[flag]
  }

  // å•Ÿç”¨åŠŸèƒ½
  enable(flag: keyof FeatureFlags): void {
    this.updateFlag(flag, true)
  }

  // åœç”¨åŠŸèƒ½
  disable(flag: keyof FeatureFlags): void {
    this.updateFlag(flag, false)
  }

  // åˆ‡æ›åŠŸèƒ½ç‹€æ…‹
  toggle(flag: keyof FeatureFlags): void {
    this.updateFlag(flag, !this.flags[flag])
  }

  // æ›´æ–°å–®ä¸€åŠŸèƒ½é–‹é—œ
  private updateFlag(flag: keyof FeatureFlags, value: boolean): void {
    this.flags = { ...this.flags, [flag]: value }
    saveFeatureFlags({ [flag]: value })

    console.log(`ğŸš© [FeatureFlags] ${flag}: ${value ? 'å•Ÿç”¨' : 'åœç”¨'}`)

    // å¦‚æœæ˜¯é—œéµåŠŸèƒ½ï¼Œçµ¦äºˆè­¦å‘Š
    if (flag === 'useNewStateManagement' && value) {
      console.warn('âš ï¸ [FeatureFlags] æ–°ç‹€æ…‹ç®¡ç†ç³»çµ±å·²å•Ÿç”¨ï¼Œè«‹ç¢ºä¿å·²å®Œæˆæ¸¬è©¦')
    }
  }

  // æ‰¹æ¬¡æ›´æ–°åŠŸèƒ½é–‹é—œ
  updateFlags(updates: Partial<FeatureFlags>): void {
    this.flags = { ...this.flags, ...updates }
    saveFeatureFlags(updates)
    console.log('ğŸš© [FeatureFlags] æ‰¹æ¬¡æ›´æ–°å®Œæˆ:', updates)
  }

  // é‡ç½®æ‰€æœ‰åŠŸèƒ½é–‹é—œ
  reset(): void {
    this.flags = defaultFeatureFlags
    if (typeof window !== 'undefined') {
      localStorage.removeItem('study-scriber-feature-flags')
    }
    console.log('ğŸš© [FeatureFlags] å·²é‡ç½®ç‚ºé è¨­å€¼')
  }

  // å–å¾—ç•¶å‰æ‰€æœ‰åŠŸèƒ½é–‹é—œç‹€æ…‹
  getAll(): FeatureFlags {
    return { ...this.flags }
  }

  // æš´éœ²åˆ° window ä¾›èª¿è©¦ä½¿ç”¨
  private exposeToWindow(): void {
    if (typeof window !== 'undefined') {
      (window as any).featureFlags = {
        enable: (flag: keyof FeatureFlags) => this.enable(flag),
        disable: (flag: keyof FeatureFlags) => this.disable(flag),
        toggle: (flag: keyof FeatureFlags) => this.toggle(flag),
        isEnabled: (flag: keyof FeatureFlags) => this.isEnabled(flag),
        getAll: () => this.getAll(),
        reset: () => this.reset(),

        // ä¾¿åˆ©æ–¹æ³•
        enableNewState: () => this.enable('useNewStateManagement'),
        disableNewState: () => this.disable('useNewStateManagement'),
        enableAll: () => this.updateFlags({
          useNewStateManagement: true,
          useNewRecordingHook: true,
          useNewSessionHook: true,
          useNewTranscriptHook: true,
          useNewAppStateHook: true,
        }),
        disableAll: () => this.updateFlags({
          useNewStateManagement: false,
          useNewRecordingHook: false,
          useNewSessionHook: false,
          useNewTranscriptHook: false,
          useNewAppStateHook: false,
        }),
      }

      console.log('ğŸš© [FeatureFlags] èª¿è©¦ä»‹é¢å·²æš´éœ²åˆ° window.featureFlags')
      console.log('   ä½¿ç”¨æ–¹æ³•: window.featureFlags.enableNewState()')
      console.log('   æŸ¥çœ‹ç‹€æ…‹: window.featureFlags.getAll()')
    }
  }
}

// å–®ä¾‹æ¨¡å¼
export const featureFlagManager = new FeatureFlagManager()

// ä¾¿åˆ©å‡½æ•¸
export const isFeatureEnabled = (flag: keyof FeatureFlags): boolean =>
  featureFlagManager.isEnabled(flag)

export const enableFeature = (flag: keyof FeatureFlags): void =>
  featureFlagManager.enable(flag)

export const disableFeature = (flag: keyof FeatureFlags): void =>
  featureFlagManager.disable(flag)


# END FILE CONTENTS


# File: frontend/components/ui/radio-group.tsx

"use client"

import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/session-service-409.test.ts

/**
 * SessionService 409 è¡çªè™•ç†æ¸¬è©¦
 *
 * æ¸¬è©¦ ensureRecordingSession æ–¹æ³•åœ¨é‡åˆ°æœƒè©±è¡çªæ™‚çš„è™•ç†é‚è¼¯
 */

import { describe, test, expect, vi, beforeEach, afterEach } from 'vitest'
import { SessionService } from '../session-service'
import { sessionAPI } from '../../api'
import type { SessionResponse } from '../../api'

// Mock sessionAPI
vi.mock('../../api', () => ({
    sessionAPI: {
        createSession: vi.fn(),
        getActiveSession: vi.fn(),
        upgradeToRecording: vi.fn(),
        finishSession: vi.fn(),
        deleteSession: vi.fn()
    }
}))

describe('SessionService - 409 è¡çªè™•ç†', () => {
    let sessionService: SessionService
    const mockSessionAPI = sessionAPI as any

    // æ¸¬è©¦ç”¨çš„æœƒè©±æ•¸æ“š
    const mockExistingSession: SessionResponse = {
        id: 'existing-session-123',
        title: 'ç¾æœ‰éŒ„éŸ³æœƒè©±',
        type: 'recording',
        status: 'active',
        language: 'zh-TW',
        created_at: '2024-01-01T00:00:00Z',
        updated_at: '2024-01-01T00:00:00Z'
    }

    const mockNewSession: SessionResponse = {
        id: 'new-session-456',
        title: 'æ–°éŒ„éŸ³æœƒè©±',
        type: 'recording',
        status: 'active',
        language: 'zh-TW',
        created_at: '2024-01-01T01:00:00Z',
        updated_at: '2024-01-01T01:00:00Z'
    }

    const mockNoteSession: SessionResponse = {
        id: 'note-session-789',
        title: 'ç¾æœ‰ç­†è¨˜æœƒè©±',
        type: 'note_only',
        status: 'active',
        language: 'zh-TW',
        created_at: '2024-01-01T02:00:00Z',
        updated_at: '2024-01-01T02:00:00Z'
    }

    beforeEach(() => {
        sessionService = new SessionService()
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('ensureRecordingSession - æˆåŠŸæƒ…å¢ƒ', () => {
        test('ç•¶æ²’æœ‰ç¾æœ‰æœƒè©±æ™‚ï¼Œæ‡‰è©²æˆåŠŸå‰µå»ºæ–°çš„éŒ„éŸ³æœƒè©±', async () => {
            // Arrange
            mockSessionAPI.createSession.mockResolvedValueOnce(mockNewSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(result).toEqual(mockNewSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'æ¸¬è©¦æ¨™é¡Œ',
                type: 'recording',
                content: undefined
            })
            expect(mockSessionAPI.getActiveSession).not.toHaveBeenCalled()
        })
    })

    describe('ensureRecordingSession - 409 è¡çªè™•ç†', () => {
        test('ç•¶å‰µå»ºæœƒè©±é‡åˆ° 409 è¡çªæ™‚ï¼Œæ‡‰è©²ç²å–ç¾æœ‰çš„éŒ„éŸ³æœƒè©±', async () => {
            // Arrange
            const conflictError = {
                response: {
                    status: 409,
                    data: { detail: 'å·²æœ‰æ´»èºæœƒè©±' }
                },
                isAxiosError: true
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockExistingSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(result).toEqual(mockExistingSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'æ¸¬è©¦æ¨™é¡Œ',
                type: 'recording',
                content: undefined
            })
            expect(mockSessionAPI.getActiveSession).toHaveBeenCalledOnce()
        })

        test('ç•¶é‡åˆ° 409 ä½†ç¾æœ‰æœƒè©±æ˜¯ç­†è¨˜æœƒè©±æ™‚ï¼Œæ‡‰è©²å‡ç´šç‚ºéŒ„éŸ³æœƒè©±', async () => {
            // Arrange
            const conflictError = {
                response: { status: 409 },
                isAxiosError: true
            }

            const upgradedSession: SessionResponse = {
                ...mockNoteSession,
                type: 'recording'
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            // ç¬¬ä¸€æ¬¡èª¿ç”¨ - ensureRecordingSession ä¸­æª¢æŸ¥ç¾æœ‰æœƒè©±
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockNoteSession)
            // ç¬¬äºŒæ¬¡èª¿ç”¨ - upgradeToRecording ä¸­æª¢æŸ¥æœƒè©±ç‹€æ…‹
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockNoteSession)
            mockSessionAPI.upgradeToRecording.mockResolvedValueOnce(upgradedSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(result).toEqual(upgradedSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalled()
            expect(mockSessionAPI.getActiveSession).toHaveBeenCalledTimes(2)
            expect(mockSessionAPI.upgradeToRecording).toHaveBeenCalledWith(mockNoteSession.id)
        })

        test('ç•¶é‡åˆ° 409 ä½†ç„¡æ³•ç²å–ç¾æœ‰æœƒè©±æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            const conflictError = {
                response: { status: 409 },
                isAxiosError: true
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(null)

            // Act & Assert
            await expect(
                sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')
            ).rejects.toThrow('æœƒè©±è¡çªä½†ç„¡æ³•ç²å–ç¾æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢')

            expect(mockSessionAPI.createSession).toHaveBeenCalled()
            expect(mockSessionAPI.getActiveSession).toHaveBeenCalledOnce()
        })

        test('ç•¶é‡åˆ°é 409 éŒ¯èª¤æ™‚ï¼Œæ‡‰è©²ç›´æ¥æ‹‹å‡ºåŸéŒ¯èª¤', async () => {
            // Arrange
            const networkError = new Error('ç¶²è·¯é€£æ¥å¤±æ•—')
            mockSessionAPI.createSession.mockRejectedValueOnce(networkError)

            // Act & Assert
            await expect(
                sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')
            ).rejects.toThrow()

            expect(mockSessionAPI.createSession).toHaveBeenCalled()
            expect(mockSessionAPI.getActiveSession).not.toHaveBeenCalled()
        })
    })

    describe('ensureRecordingSession - é‚Šç·£æƒ…æ³', () => {
        test('ç•¶æ¨™é¡Œç‚ºç©ºæ™‚ï¼Œæ‡‰è©²ä½¿ç”¨é è¨­æ¨™é¡Œ', async () => {
            // Arrange
            mockSessionAPI.createSession.mockResolvedValueOnce(mockNewSession)

            // Act
            const result = await sessionService.ensureRecordingSession()

            // Assert
            expect(result).toEqual(mockNewSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: expect.stringMatching(/éŒ„éŸ³ç­†è¨˜ \d{1,2}\/\d{1,2}\/\d{4}/),
                type: 'recording',
                content: undefined
            })
        })

        test('ç•¶æä¾›å…§å®¹æ™‚ï¼Œæ‡‰è©²æ­£ç¢ºå‚³éçµ¦ API', async () => {
            // Arrange
            mockSessionAPI.createSession.mockResolvedValueOnce(mockNewSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ', 'æ¸¬è©¦å…§å®¹')

            // Assert
            expect(result).toEqual(mockNewSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'æ¸¬è©¦æ¨™é¡Œ',
                type: 'recording',
                content: 'æ¸¬è©¦å…§å®¹'
            })
        })
    })

    describe('ensureRecordingSession - æ•´åˆæµç¨‹æ¸¬è©¦', () => {
        test('å®Œæ•´çš„ 409 è¡çªè™•ç†æµç¨‹ï¼šå‰µå»ºå¤±æ•— â†’ ç²å–ç¾æœ‰æœƒè©± â†’ å‡ç´šæœƒè©±', async () => {
            // Arrange
            const conflictError = {
                response: { status: 409 },
                isAxiosError: true
            }

            const upgradedSession: SessionResponse = {
                ...mockNoteSession,
                type: 'recording'
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            // ç¬¬ä¸€æ¬¡èª¿ç”¨ - ensureRecordingSession ä¸­æª¢æŸ¥ç¾æœ‰æœƒè©±
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockNoteSession)
            // ç¬¬äºŒæ¬¡èª¿ç”¨ - upgradeToRecording ä¸­æª¢æŸ¥æœƒè©±ç‹€æ…‹
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockNoteSession)
            mockSessionAPI.upgradeToRecording.mockResolvedValueOnce(upgradedSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ•´åˆæ¸¬è©¦')

            // Assert - é©—è­‰èª¿ç”¨é †åºå’Œåƒæ•¸
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'æ•´åˆæ¸¬è©¦',
                type: 'recording',
                content: undefined
            })
            expect(mockSessionAPI.getActiveSession).toHaveBeenCalledAfter(
                mockSessionAPI.createSession as any
            )
            expect(mockSessionAPI.upgradeToRecording).toHaveBeenCalledWith(mockNoteSession.id)
            expect(result).toEqual(upgradedSession)
        })

        test('å„ªé›…çš„éŒ¯èª¤æ¢å¾©ï¼šAPI èª¿ç”¨é †åºæ­£ç¢ºä¸”éŒ¯èª¤è™•ç†é©ç•¶', async () => {
            // Arrange
            const conflictError = {
                response: { status: 409 },
                isAxiosError: true
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockExistingSession)

            // Act
            const result = await sessionService.ensureRecordingSession('éŒ¯èª¤æ¢å¾©æ¸¬è©¦')

            // Assert - é©—è­‰æœ€çµ‚çµæœæ­£ç¢º
            expect(result).toEqual(mockExistingSession)
            expect(result.type).toBe('recording')
            expect(result.status).toBe('active')

            // é©—è­‰ä¸éœ€è¦å‡ç´šï¼ˆå› ç‚ºç¾æœ‰æœƒè©±å·²ç¶“æ˜¯éŒ„éŸ³æœƒè©±ï¼‰
            expect(mockSessionAPI.upgradeToRecording).not.toHaveBeenCalled()
        })
    })
})


# END FILE CONTENTS


# File: frontend/components/ui/pagination.tsx

import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}


# END FILE CONTENTS


# File: frontend/lib/utils.ts

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}


# END FILE CONTENTS


# File: frontend/e2e/export-api.spec.ts

import { test, expect, Page } from '@playwright/test'
import JSZip from 'jszip'

// æ¸¬è©¦ç”¨å‡ session idï¼Œè«‹ç¢ºä¿å¾Œç«¯æœ‰å°æ‡‰ completed session æˆ–æ‰‹å‹•è¨­ç½®
const TEST_SESSION_ID = 'test-session-completed-001'

// ä¸‹è¼‰ä¸¦è§£å£“ zipï¼Œé©—è­‰å…§å®¹
async function fetchAndUnzipZip(page: Page, sid: string) {
    const response = await page.request.get(`/api/export/${sid}?type=zip`)
    expect(response.status()).toBe(200)
    const buffer = await response.body()
    const zip = await JSZip.loadAsync(buffer)
    const note = await zip.file('note.md')?.async('string')
    const transcript = await zip.file('transcript.txt')?.async('string')
    return { note, transcript }
}

test.describe('åŒ¯å‡º API Proxy æ¸¬è©¦', () => {
    test('æ‡‰è©²æ­£ç¢º proxy /api/export/<sid> åˆ° FastAPI', async ({ page }) => {
        // ç›´æ¥ç™¼é€ fetch è«‹æ±‚
        const response = await page.request.get(`/api/export/${TEST_SESSION_ID}?type=zip`)
        // æ‡‰è©²ä¸æ˜¯ 404
        expect(response.status()).not.toBe(404)
        // æ‡‰è©²ä¸æ˜¯ Next.js é è¨­ 404 é é¢
        const text = await response.text()
        expect(text).not.toContain('This page could not be found')
        // æ¨™é ­æ‡‰æœ‰ FastAPI æ¨™è¨˜ï¼ˆå¦‚ server: uvicornï¼‰
        const serverHeader = response.headers()['server'] || ''
        expect(serverHeader.toLowerCase()).toContain('uvicorn')
    })

    test('æ‡‰è©²èƒ½ä¸‹è¼‰ä¸¦é©—è­‰ zip å…§å®¹', async ({ page }) => {
        const { note, transcript } = await fetchAndUnzipZip(page, TEST_SESSION_ID)
        expect(note).toBeDefined()
        expect(transcript).toBeDefined()
        expect(note?.length).toBeGreaterThan(0)
        expect(transcript?.length).toBeGreaterThan(0)
        // å¯æ ¹æ“šå¯¦éš›å…§å®¹åŠ å¼·é©—è­‰
        expect(note).toMatch(/.+/) // è‡³å°‘æœ‰å…§å®¹
        expect(transcript).toMatch(/\[\d{2}:\d{2}:\d{2}\]/) // æœ‰æ™‚é–“æˆ³
    })
})


# END FILE CONTENTS


# File: frontend/lib/__tests__/state-management.test.ts

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { renderHook, act } from '@testing-library/react'
import { createElement } from 'react'
import { AppStateProvider, useAppStateContext } from '../../hooks/use-app-state-context'
import { useAppStateNew } from '../../hooks/use-app-state-new'
import { featureFlagManager } from '../feature-flags'
import { InitialStateLoader } from '../initial-state-loader'
import type { ReactNode } from 'react'

// Mock å¤–éƒ¨ä¾è³´
vi.mock('../../hooks/use-session-adapter', () => ({
    useSession: vi.fn(() => ({
        currentSession: null,
        isLoading: false,
        error: null,
        createNoteSession: vi.fn(),
        createRecordingSession: vi.fn(),
        upgradeToRecording: vi.fn(),
        finishSession: vi.fn(),
        deleteSession: vi.fn(),
        checkActiveSession: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-recording-adapter', () => ({
    useRecording: vi.fn(() => ({
        isRecording: false,
        recordingTime: 0,
        transcripts: [],
        error: null,
        startRecording: vi.fn(),
        stopRecording: vi.fn(),
        clearTranscripts: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-notes', () => ({
    useNotes: vi.fn(() => ({
        noteContent: '',
        loadNote: vi.fn(),
        clearNote: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-transcript-adapter', () => ({
    useTranscript: vi.fn(() => ({
        isConnected: false,
        error: null,
        autoScrollEnabled: true,
        disconnect: vi.fn(),
        clearTranscripts: vi.fn(),
        enableAutoScroll: vi.fn(),
        disableAutoScroll: vi.fn(),
        scrollToLatest: vi.fn(),
    }))
}))

vi.mock('@/components/ui/use-toast', () => ({
    useToast: vi.fn(() => ({
        toast: vi.fn(),
    }))
}))

// Mock InitialStateLoader
vi.mock('../../initial-state-loader', () => ({
    InitialStateLoader: {
        loadInitialAppData: vi.fn(() => ({
            state: 'default',
            transcriptEntries: [],
            editorContent: '',
            isRecording: false,
            recordingTime: 0,
            session: null,
        })),
        saveAppState: vi.fn(),
        clearPersistedState: vi.fn(),
        hasPersistedState: vi.fn(() => false),
    }
}))

function TestWrapper({ children }: { children: ReactNode }) {
    return createElement(AppStateProvider, null, children)
}

describe('ç‹€æ…‹ç®¡ç†æ•´åˆæ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        featureFlagManager.reset()
        featureFlagManager.enable('useNewStateManagement')
    })

    describe('Context èˆ‡ Hook å”ä½œ', () => {
        test('Context æ‡‰è©²ç‚º Hook æä¾›æ­£ç¢ºçš„ç‹€æ…‹', () => {
            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            expect(result.current.appData).toBeDefined()
            expect(result.current.appData.state).toBe('default')
            expect(result.current.appData.isRecording).toBe(false)
            expect(result.current.appData.transcriptEntries).toEqual([])
        })

        test('Hook çš„ç‹€æ…‹è®Šæ›´æ‡‰è©²æ›´æ–° Context', async () => {
            const { result } = renderHook(() => {
                const context = useAppStateContext()
                const hook = useAppStateNew()
                return { context, hook }
            }, {
                wrapper: TestWrapper
            })

            // æ¸¬è©¦ç·¨è¼¯å™¨å…§å®¹æ›´æ–°
            await act(async () => {
                result.current.hook.saveLocalDraft('æ¸¬è©¦å…§å®¹')
            })

            expect(result.current.context.appData.editorContent).toBe('æ¸¬è©¦å…§å®¹')
        })

        test('Context dispatch æ‡‰è©²è§¸ç™¼ Hook é‡æ–°æ¸²æŸ“', async () => {
            const { result } = renderHook(() => {
                const context = useAppStateContext()
                const hook = useAppStateNew()
                return { context, hook }
            }, {
                wrapper: TestWrapper
            })

            const initialIsRecording = result.current.hook.appData.isRecording

            // ç›´æ¥é€é Context dispatch æ›´æ–°ç‹€æ…‹
            await act(async () => {
                result.current.context.dispatch({
                    type: 'SET_RECORDING',
                    payload: true
                })
            })

            // Hook æ‡‰è©²é‡æ–°æ¸²æŸ“ä¸¦åæ˜ æ–°ç‹€æ…‹
            expect(result.current.hook.appData.isRecording).toBe(true)
            expect(result.current.hook.appData.isRecording).not.toBe(initialIsRecording)
        })
    })

    describe('ç‹€æ…‹ä¸€è‡´æ€§æ¸¬è©¦', () => {
        test('å¤šå€‹ Hook å¯¦ä¾‹æ‡‰è©²å…±äº«ç›¸åŒç‹€æ…‹', () => {
            const { result: result1 } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })
            const { result: result2 } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // å…©å€‹ Hook å¯¦ä¾‹æ‡‰è©²æœ‰ç›¸åŒçš„ç‹€æ…‹
            expect(result1.current.appData.state).toBe(result2.current.appData.state)
            expect(result1.current.appData.isRecording).toBe(result2.current.appData.isRecording)
        })

        test('ç‹€æ…‹è®Šæ›´æ‡‰è©²åŒæ­¥åˆ°æ‰€æœ‰ Hook å¯¦ä¾‹', async () => {
            const { result: result1 } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })
            const { result: result2 } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // é€éç¬¬ä¸€å€‹ Hook æ›´æ–°ç‹€æ…‹
            await act(async () => {
                result1.current.saveLocalDraft('åŒæ­¥æ¸¬è©¦')
            })

            // ç¬¬äºŒå€‹ Hook æ‡‰è©²åæ˜ ç›¸åŒçš„è®Šæ›´
            expect(result2.current.appData.editorContent).toBe('åŒæ­¥æ¸¬è©¦')
        })
    })

    describe('åˆå§‹ç‹€æ…‹è¼‰å…¥æ•´åˆ', () => {
        test('Provider å•Ÿå‹•æ™‚æ‡‰è©²è¼‰å…¥åˆå§‹ç‹€æ…‹', () => {
            const mockInitialData = {
                state: 'recording_active' as const,
                transcriptEntries: [{ time: '00:01', text: 'æ¸¬è©¦é€å­—ç¨¿' }],
                editorContent: 'æ¸¬è©¦å…§å®¹',
                isRecording: true,
                recordingTime: 30,
                session: { id: 'test-session', status: 'active' as const, type: 'recording' as const }
            }

            vi.mocked(InitialStateLoader.loadInitialAppData).mockReturnValue(mockInitialData)

            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // æ‡‰è©²è¼‰å…¥åˆå§‹ç‹€æ…‹
            expect(InitialStateLoader.loadInitialAppData).toHaveBeenCalled()
            // æ³¨æ„ï¼šç”±æ–¼ useEffect çš„ç•°æ­¥ç‰¹æ€§ï¼Œåˆå§‹ç‹€æ…‹å¯èƒ½éœ€è¦é¡å¤–çš„æ¸²æŸ“é€±æœŸ
        })

        test('ç‹€æ…‹è®Šæ›´æ‡‰è©²è§¸ç™¼æŒä¹…åŒ–', async () => {
            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            await act(async () => {
                result.current.saveLocalDraft('éœ€è¦æŒä¹…åŒ–çš„å…§å®¹')
            })

            // ç­‰å¾…æŒä¹…åŒ–é‚è¼¯åŸ·è¡Œ
            await new Promise(resolve => setTimeout(resolve, 1100)) // ç­‰å¾…è¶…é 1 ç§’çš„å»¶é²

            expect(InitialStateLoader.saveAppState).toHaveBeenCalled()
        })
    })

    describe('éŒ¯èª¤è™•ç†æ•´åˆ', () => {
        test('åˆå§‹ç‹€æ…‹è¼‰å…¥å¤±æ•—æ‡‰è©²ä½¿ç”¨é è¨­ç‹€æ…‹', () => {
            vi.mocked(InitialStateLoader.loadInitialAppData).mockImplementation(() => {
                throw new Error('è¼‰å…¥å¤±æ•—')
            })

            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // æ‡‰è©²å›é€€åˆ°é è¨­ç‹€æ…‹
            expect(result.current.appData.state).toBe('default')
            expect(result.current.appData.transcriptEntries).toEqual([])
        })

        test('æŒä¹…åŒ–å¤±æ•—ä¸æ‡‰è©²å½±éŸ¿æ‡‰ç”¨é‹ä½œ', async () => {
            vi.mocked(InitialStateLoader.saveAppState).mockImplementation(() => {
                throw new Error('å„²å­˜å¤±æ•—')
            })

            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // ç‹€æ…‹è®Šæ›´æ‡‰è©²ä»ç„¶æ­£å¸¸å·¥ä½œ
            await act(async () => {
                result.current.saveLocalDraft('æ¸¬è©¦å…§å®¹')
            })

            expect(result.current.appData.editorContent).toBe('æ¸¬è©¦å…§å®¹')
        })
    })

    describe('è¨˜æ†¶é«”ç®¡ç†', () => {
        test('Hook unmount ä¸æ‡‰è©²å°è‡´è¨˜æ†¶é«”æ´©æ¼', () => {
            const { unmount } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            // unmount æ‡‰è©²æ­£å¸¸åŸ·è¡Œè€Œä¸æ‹‹å‡ºéŒ¯èª¤
            expect(() => unmount()).not.toThrow()
        })

        test('å¤šæ¬¡ mount/unmount æ‡‰è©²ç©©å®š', () => {
            for (let i = 0; i < 5; i++) {
                const { unmount } = renderHook(() => useAppStateNew(), {
                    wrapper: TestWrapper
                })
                unmount()
            }

            // æœ€å¾Œä¸€æ¬¡æ‡‰è©²ä»ç„¶æ­£å¸¸å·¥ä½œ
            const { result } = renderHook(() => useAppStateNew(), {
                wrapper: TestWrapper
            })

            expect(result.current.appData).toBeDefined()
        })
    })
})


# END FILE CONTENTS


# File: app/schemas/session.py

"""
StudyScriber Session Pydantic æ¨¡å‹

å®šç¾©æœƒè©±ç›¸é—œçš„è«‹æ±‚å’ŒéŸ¿æ‡‰æ¨¡å‹
"""
import enum
from datetime import datetime
from typing import Optional
from uuid import UUID
from pydantic import BaseModel, Field, ConfigDict

class SessionType(str, enum.Enum):
    """æœƒè©±é¡å‹"""
    NOTE_ONLY = "note_only"
    RECORDING = "recording"

class SessionStatus(str, enum.Enum):
    """æœƒè©±ç‹€æ…‹"""
    ACTIVE = "active"
    COMPLETED = "completed"
    ERROR = "error"

class LanguageCode(str, enum.Enum):
    """æ”¯æ´çš„èªè¨€ä»£ç¢¼"""
    ZH_TW = "zh-TW"
    EN_US = "en-US"


class SessionCreateRequest(BaseModel):
    """å»ºç«‹æœƒè©±è«‹æ±‚"""
    title: Optional[str] = Field(None, max_length=150, description="æœƒè©±æ¨™é¡Œ")
    type: SessionType = Field(SessionType.NOTE_ONLY, description="æœƒè©±é¡å‹")
    language: LanguageCode = Field(LanguageCode.ZH_TW, description="èªè¨€è¨­å®š")
    stt_provider: Optional[str] = Field(None, description="èªéŸ³è½‰æ–‡å­— Provider ('whisper' or 'gemini')")
    content: Optional[str] = Field(None, description="åˆå§‹ç­†è¨˜å…§å®¹")
    start_ts: Optional[int] = Field(None, description="éŒ„éŸ³é–‹å§‹æ™‚é–“æˆ³ï¼ˆæ¯«ç§’ï¼‰")


class SessionOut(BaseModel):
    """æœƒè©±è¼¸å‡ºæ¨¡å‹"""
    id: UUID
    type: SessionType
    status: SessionStatus
    title: Optional[str] = None
    language: LanguageCode
    created_at: datetime
    updated_at: datetime
    completed_at: Optional[datetime] = None

    class Config:
        from_attributes = True


class SessionUpgradeRequest(BaseModel):
    """æœƒè©±å‡ç´šè«‹æ±‚ï¼ˆç´”ç­†è¨˜ â†’ éŒ„éŸ³ï¼‰"""
    language: Optional[LanguageCode] = Field(None, description="éŒ„éŸ³èªè¨€è¨­å®š")


class SessionFinishRequest(BaseModel):
    """å®Œæˆæœƒè©±è«‹æ±‚"""
    duration: Optional[int] = Field(None, ge=0, description="æœ€çµ‚éŒ„éŸ³æ™‚é•·ï¼ˆç§’ï¼‰")


class SessionStatusResponse(BaseModel):
    """æœƒè©±ç‹€æ…‹éŸ¿æ‡‰"""
    success: bool = Field(description="æ“ä½œæ˜¯å¦æˆåŠŸ")
    message: str = Field(description="å›æ‡‰è¨Šæ¯")
    session: Optional[SessionOut] = Field(None, description="æœƒè©±è³‡æ–™")


class ActiveSessionError(BaseModel):
    """æ´»èºæœƒè©±è¡çªéŒ¯èª¤"""
    model_config = ConfigDict(json_encoders={UUID: str})

    error: str = Field("active_session_exists", description="éŒ¯èª¤é¡å‹")
    message: str = Field(description="éŒ¯èª¤è¨Šæ¯")
    active_session_id: UUID = Field(description="ç›®å‰æ´»èºæœƒè©± ID")


class SessionProviderUpdateRequest(BaseModel):
    """æ›´æ–°æœƒè©± STT Provider è«‹æ±‚"""
    stt_provider: str = Field(..., description="èªéŸ³è½‰æ–‡å­— Provider ('whisper' or 'gemini')")
    
    class Config:
        json_schema_extra = {
            "example": {
                "stt_provider": "gemini"
            }
        }


# END FILE CONTENTS


# File: frontend/lib/transcript-manager.ts

"use client"

import { TranscriptWebSocket, TranscriptMessage, WebSocketManager } from './websocket'
import { useAppStore } from './app-store-zustand'
import type { TranscriptEntry } from '../types/app-state'

/**
 * TranscriptManager - çµ±ä¸€ç®¡ç† transcript WebSocket é€£æ¥çš„ Singleton
 *
 * åŠŸèƒ½ï¼š
 * - ç¢ºä¿æ¯å€‹ session åªæœ‰ä¸€å€‹ transcript é€£æ¥
 * - çµ±ä¸€ç®¡ç†é€£æ¥ç‹€æ…‹ã€å¿ƒè·³ã€é‡é€£
 * - æä¾›ç°¡æ½”çš„ API çµ¦å…¶ä»–çµ„ä»¶ä½¿ç”¨
 */
export class TranscriptManager {
  private static instance: TranscriptManager | null = null
  private connections: Map<string, TranscriptWebSocket> = new Map()
  private listeners: Map<string, Set<(message: TranscriptMessage) => void>> = new Map()
  private connectionStates: Map<string, boolean> = new Map()
  private heartbeatIntervals: Map<string, NodeJS.Timeout> = new Map()
  private reconnectAttempts: Map<string, number> = new Map()
  private maxReconnectAttempts = 5
  private heartbeatInterval = 10000 // 10ç§’ï¼Œé¿å…ä¼ºæœå™¨éæ—©åˆ¤å®šé€¾æ™‚
  private reconnectDelay = 2000 // 2ç§’

  private constructor() {
    // Singleton pattern - ç§æœ‰å»ºæ§‹å­

    // é–‹ç™¼æ¨¡å¼ä¸‹å°‡å¯¦ä¾‹æ›åˆ°å…¨åŸŸä»¥åˆ©é™¤éŒ¯
    if (typeof window !== 'undefined') {
      // @ts-ignore
      ; (window as any).transcriptManager = this
    }
  }

  /**
   * å–å¾— TranscriptManager å¯¦ä¾‹
   */
  static getInstance(): TranscriptManager {
    if (!TranscriptManager.instance) {
      TranscriptManager.instance = new TranscriptManager()
    }
    return TranscriptManager.instance
  }

  /**
   * é€£æ¥åˆ°æŒ‡å®š session çš„ transcript feed
   */
  async connect(sessionId: string): Promise<void> {
    // å¦‚æœå·²ç¶“æœ‰é€£æ¥ï¼Œç›´æ¥è¿”å›
    if (this.connections.has(sessionId) && this.connectionStates.get(sessionId)) {
      console.log(`ğŸ“± [TranscriptManager] Session ${sessionId} å·²é€£æ¥ï¼Œè·³éé‡è¤‡é€£æ¥`)
      return
    }

    try {
      console.log(`ğŸ“± [TranscriptManager] é–‹å§‹é€£æ¥ session ${sessionId}`)

      // æ¸…ç†èˆŠé€£æ¥ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      await this.disconnect(sessionId)

      // é‡ç½®é‡é€£è¨ˆæ•¸
      this.reconnectAttempts.set(sessionId, 0)

      // å»ºç«‹æ–°é€£æ¥
      await this.establishConnection(sessionId)

      // ç­‰å¾…é€£ç·šå®Œå…¨å°±ç·’
      await this.waitForConnectionReady(sessionId)

      console.log(`âœ… [TranscriptManager] Session ${sessionId} é€£æ¥ä¸¦å°±ç·’`)

    } catch (error) {
      console.error(`âŒ [TranscriptManager] Session ${sessionId} é€£æ¥å¤±æ•—:`, error)
      this.connectionStates.set(sessionId, false)

      // å˜—è©¦é‡é€£
      this.scheduleReconnect(sessionId)
      throw error
    }
  }

  /**
   * ç­‰å¾…é€£ç·šå®Œå…¨å°±ç·’
   */
  private async waitForConnectionReady(sessionId: string, timeout: number = 5000): Promise<void> {
    return new Promise((resolve, reject) => {
      const startTime = Date.now()

      const checkReady = () => {
        const ws = this.connections.get(sessionId)
        const isConnected = this.connectionStates.get(sessionId)

        console.log(`ğŸ” [TranscriptManager] æª¢æŸ¥é€£ç·šå°±ç·’ç‹€æ…‹:`, {
          sessionId,
          hasWebSocket: !!ws,
          isConnected: !!isConnected,
          wsReadyState: ws?.readyState,
          wsIsConnected: ws?.isConnected || false,
          elapsedTime: Date.now() - startTime
        })

        // å„ªåŒ–ï¼šæ›´å¯é çš„ WebSocket å°±ç·’ç‹€æ…‹æª¢æ¸¬
        const wsReady = ws && (
          ws.isConnected ||
          ws.readyState === WebSocket.OPEN ||
          (typeof window !== 'undefined' && window.WebSocket && ws.readyState === 1) // æ¸¬è©¦ç’°å¢ƒå…¼å®¹
        )

        // å³æ™‚åŒæ­¥ç‹€æ…‹ï¼Œç¢ºä¿ä¸€è‡´æ€§
        if (ws && wsReady) {
          const actualConnected = true
          if (this.connectionStates.get(sessionId) !== actualConnected) {
            console.log(`ğŸ”„ [TranscriptManager] å³æ™‚åŒæ­¥é€£æ¥ç‹€æ…‹: ${sessionId} â†’ ${actualConnected}`)
            this.connectionStates.set(sessionId, actualConnected)
          }

          console.log(`âœ… [TranscriptManager] Session ${sessionId} é€£ç·šå°±ç·’`)
          resolve()
          return
        } else if (ws && !wsReady) {
          // WebSocket å­˜åœ¨ä½†æœªå°±ç·’ï¼ŒåŒæ­¥ç‹€æ…‹ç‚º false
          const actualConnected = false
          if (this.connectionStates.get(sessionId) !== actualConnected) {
            console.log(`ğŸ”„ [TranscriptManager] å³æ™‚åŒæ­¥é€£æ¥ç‹€æ…‹: ${sessionId} â†’ ${actualConnected}`)
            this.connectionStates.set(sessionId, actualConnected)
          }
        }

        // æª¢æŸ¥è¶…æ™‚
        if (Date.now() - startTime > timeout) {
          console.error(`â° [TranscriptManager] Session ${sessionId} é€£ç·šå°±ç·’ç­‰å¾…è¶…æ™‚`)
          console.error(`   æœ€çµ‚ç‹€æ…‹: ws=${!!ws}, isConnected=${!!isConnected}, wsReady=${!!wsReady}`)
          reject(new Error(`é€£ç·šå°±ç·’ç­‰å¾…è¶…æ™‚ (${timeout}ms)`))
          return
        }

        // ç¹¼çºŒç­‰å¾…
        setTimeout(checkReady, 100)
      }

      checkReady()
    })
  }

  /**
   * å»ºç«‹ WebSocket é€£æ¥
   */
  private async establishConnection(sessionId: string): Promise<void> {
    const ws = new TranscriptWebSocket(sessionId)

    // ğŸ§ª æ¸¬è©¦ï¼šè·³é TranscriptWebSocket æŠ½è±¡å±¤ï¼Œç›´æ¥ä½¿ç”¨ WebSocketManager çš„ onMessage
    // è¨»é‡‹åŸä¾†çš„è¨­å®šï¼Œä½¿ç”¨ç›´æ¥çš„åŸç”Ÿ WebSocket è™•ç†
    // ws.onMessage((message) => {
    //   this.handleMessage(sessionId, message)
    // })

    // è¨­å®šé€£æ¥é—œé–‰è™•ç†
    this.setupConnectionHandlers(ws, sessionId)

    // é€£æ¥ WebSocket
    await ws.connect()

    // ç›´æ¥ä½¿ç”¨ WebSocketManager çš„ onMessage ä¾†è¨­ç½®åŸç”Ÿ onmessage
    WebSocketManager.prototype.onMessage.call(ws, (evt: MessageEvent) => {
      console.log('[WS] raw frame', evt.data?.slice?.(0, 100))
      try {
        const message = JSON.parse(evt.data)
        console.log('[WS] parsed', message.type, message.text?.slice?.(0, 20))
        this.handleMessage(sessionId, message)
      } catch (error) {
        console.error('[WS] parse error', error)
      }
    })

    // å„²å­˜é€£æ¥
    this.connections.set(sessionId, ws)
    this.connectionStates.set(sessionId, true)

    // ç™¼é€åˆå§‹ ping å•Ÿå‹•å¾Œç«¯è™•ç†å¾ªç’°
    this.sendPing(sessionId)

    // å•Ÿå‹•å¿ƒè·³
    this.startHeartbeat(sessionId)

    console.log(`âœ… TranscriptManager: Session ${sessionId} é€£æ¥æˆåŠŸ`)
  }

  /**
* è¨­å®šé€£æ¥è™•ç†å™¨
*/
  private setupConnectionHandlers(ws: TranscriptWebSocket, sessionId: string): void {
    // ç›£è½ WebSocket é—œé–‰äº‹ä»¶
    ws.onClose((event) => {
      console.log(`ğŸ”Œ TranscriptManager: Session ${sessionId} é€£æ¥é—œé–‰:`, event.code, event.reason)

      // æ›´æ–°ç‹€æ…‹
      this.connectionStates.set(sessionId, false)
      this.stopHeartbeat(sessionId)

      // å¦‚æœä¸æ˜¯æ‰‹å‹•é—œé–‰ï¼Œå˜—è©¦é‡é€£
      if (event.code !== 1000) { // 1000 = æ­£å¸¸é—œé–‰
        this.scheduleReconnect(sessionId)
      }
    })
  }

  /**
   * è™•ç†æ”¶åˆ°çš„è¨Šæ¯
   */
  private handleMessage(sessionId: string, message: any): void {
    console.log('[T] raw', message.type, message.text?.slice(0, 20))

    console.log('ğŸš¨ [TranscriptManager] handleMessage è¢«èª¿ç”¨!', {
      sessionId,
      rawMessage: message,
      messageType: typeof message,
      messageKeys: Object.keys(message || {}),
      timestamp: new Date().toISOString()
    })

    console.log('ğŸ“¨ [TranscriptManager] æ”¶åˆ°è¨Šæ¯:', {
      sessionId,
      type: message.type,
      message: message,
      timestamp: new Date().toISOString(),
      listenerCount: this.listeners.get(sessionId)?.size || 0
    })

    // è™•ç†ä¸åŒé¡å‹çš„è¨Šæ¯
    if (message.type === 'transcript_entry') {
      console.log('ğŸ“ [TranscriptManager] æ”¶åˆ°é€å­—ç¨¿æ¢ç›®:', {
        sessionId,
        payload: message.payload,
        timestamp: new Date().toISOString()
      })

      // æ¨é€åˆ° Zustand store
      const raw = message.payload
      if (raw && raw.text) {
        const parseTime = (t: string | undefined): number => {
          if (!t) return 0
          const parts = t.split(':').map(Number)
          return parts.length === 3
            ? parts[0] * 3600 + parts[1] * 60 + parts[2]
            : parts[0] * 60 + parts[1]
        }

        const startTime = (typeof raw.start_time === 'number') ? raw.start_time : (raw.startTime ?? parseTime(raw.time))

        const entry = {
          startTime,
          time: raw.time ?? `${Math.floor(startTime / 60).toString().padStart(2, '0')}:${(startTime % 60).toString().padStart(2, '0')}`,
          text: raw.text
        }

        console.log('ğŸ¯ [TranscriptManager] æº–å‚™æ¨é€ transcript_segment åˆ° store:', {
          originalStartTime: raw.start_time,
          startTimeInSeconds: startTime,
          formattedTime: entry.time,
          text: entry.text.substring(0, 50) + '...'
        })

        console.log('[T] before push', useAppStore.getState().appState)
        useAppStore.getState().addTranscriptEntry(entry)
        console.log('âœ… [TranscriptManager] transcript_segment å·²æ¨é€åˆ° store:', entry)

        // æª¢æŸ¥ç‹€æ…‹æ˜¯å¦æœ‰è®ŠåŒ–
        const currentState = useAppStore.getState()
        console.log('ğŸ“Š [TranscriptManager] Store ç‹€æ…‹æª¢æŸ¥:', {
          appState: currentState.appState,
          transcriptCount: currentState.transcriptEntries.length,
          latestEntry: currentState.transcriptEntries[currentState.transcriptEntries.length - 1]
        })

      } else {
        console.warn('âš ï¸ [TranscriptManager] ç„¡æ•ˆçš„é€å­—ç¨¿æ¢ç›®:', raw)
      }

      this.broadcastToListeners(sessionId, message)
    } else if (message.type === 'transcript_segment') {
      console.log('ğŸ“ [TranscriptManager] é€å­—ç¨¿ç‰‡æ®µè©³æƒ…:', {
        sessionId,
        text: message.text,
        textLength: message.text?.length || 0,
        textPreview: message.text?.substring(0, 50) + (message.text?.length > 50 ? '...' : ''),
        start_time: message.start_time,
        end_time: message.end_time,
        confidence: message.confidence
      })

      // ğŸ¯ è½‰æ› transcript_segment ç‚º TranscriptEntry æ ¼å¼ä¸¦æ¨é€åˆ° store
      if (message.text) {
        try {
          // ä½¿ç”¨ start_time è€Œä¸æ˜¯ timestampï¼Œä¸¦è½‰æ›ç‚º HH:MM:SS æ ¼å¼
          const startTimeInSeconds = message.start_time ?? 0
          const hours = Math.floor(startTimeInSeconds / 3600)
          const minutes = Math.floor((startTimeInSeconds % 3600) / 60)
          const seconds = Math.floor(startTimeInSeconds % 60)

          const entry = {
            startTime: startTimeInSeconds,
            time: `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`,
            text: message.text
          }

          console.log('ğŸ¯ [TranscriptManager] æº–å‚™æ¨é€ transcript_segment åˆ° store:', {
            originalStartTime: message.start_time,
            startTimeInSeconds,
            formattedTime: entry.time,
            text: entry.text.substring(0, 50) + '...'
          })

          console.log('[T] before push', useAppStore.getState().appState)
          useAppStore.getState().addTranscriptEntry(entry)
          console.log('âœ… [TranscriptManager] transcript_segment å·²æ¨é€åˆ° store:', entry)

          // æª¢æŸ¥ç‹€æ…‹æ˜¯å¦æœ‰è®ŠåŒ–
          const currentState = useAppStore.getState()
          console.log('ğŸ“Š [TranscriptManager] Store ç‹€æ…‹æª¢æŸ¥:', {
            appState: currentState.appState,
            transcriptCount: currentState.transcriptEntries.length,
            latestEntry: currentState.transcriptEntries[currentState.transcriptEntries.length - 1]
          })

        } catch (error) {
          console.error('âŒ [TranscriptManager] è™•ç† transcript_segment æ™‚ç™¼ç”ŸéŒ¯èª¤:', error)
        }
      }

      this.broadcastToListeners(sessionId, message)
    } else if (message.type === 'connection_established') {
      console.log('âœ… [TranscriptManager] é€£æ¥å·²å»ºç«‹:', {
        sessionId,
        message: message.message,
        timestamp: message.timestamp
      })
    } else if (message.type === 'transcript_complete') {
      console.log('ğŸ¯ [TranscriptManager] è½‰éŒ„å®Œæˆ:', {
        sessionId,
        message: message.message,
        timestamp: message.timestamp
      })
      this.broadcastToListeners(sessionId, message)
    } else if (message.type === 'heartbeat_ack') {
      console.log('ğŸ’“ [TranscriptManager] å¿ƒè·³å›æ‡‰:', {
        sessionId,
        timestamp: message.timestamp
      })
    } else if (message.type === 'pong') {
      console.log('ğŸ“ [TranscriptManager] Pong å›æ‡‰:', {
        sessionId,
        timestamp: message.timestamp
      })
    } else if (message.phase === 'waiting') {
      console.log('â³ [TranscriptManager] æ”¶åˆ° waiting phase:', {
        sessionId,
        phase: message.phase,
        timestamp: new Date().toISOString()
      })
    } else if (message.phase === 'active') {
      console.log('âœ… [TranscriptManager] æ”¶åˆ° active phaseï¼Œè½‰éŒ„å·²é–‹å§‹:', {
        sessionId,
        phase: message.phase,
        timestamp: new Date().toISOString()
      })
      // å»£æ’­ active phase è¨Šæ¯çµ¦ç›£è½å™¨
      this.broadcastToListeners(sessionId, message)
    } else if (message.type === 'error' || message.type === 'transcription_error') {
      console.error('ğŸš¨ [TranscriptManager] æ”¶åˆ°è½‰éŒ„éŒ¯èª¤:', {
        sessionId,
        type: message.type,
        error_type: message.error_type,
        error_message: message.error_message,
        details: message.details,
        timestamp: new Date().toISOString()
      })
      // å»£æ’­éŒ¯èª¤è¨Šæ¯çµ¦ç›£è½å™¨
      this.broadcastToListeners(sessionId, message)
    } else {
      console.log('ğŸ“¨ [TranscriptManager] æœªçŸ¥è¨Šæ¯é¡å‹:', {
        sessionId,
        type: message.type,
        fullMessage: message
      })
    }
  }

  /**
   * å»£æ’­è¨Šæ¯çµ¦æ‰€æœ‰ç›£è½å™¨
   */
  private broadcastToListeners(sessionId: string, message: TranscriptMessage): void {
    const sessionListeners = this.listeners.get(sessionId)
    console.log('ğŸ“¡ [TranscriptManager] å»£æ’­è¨Šæ¯çµ¦ç›£è½å™¨:', {
      sessionId,
      messageType: message.type,
      listenerCount: sessionListeners?.size || 0,
      hasListeners: !!sessionListeners
    })

    if (sessionListeners) {
      let successCount = 0
      let errorCount = 0

      sessionListeners.forEach(callback => {
        try {
          callback(message)
          successCount++
          console.log(`âœ… [TranscriptManager] ç›£è½å™¨å›èª¿æˆåŠŸ (${successCount}/${sessionListeners.size})`)
        } catch (error) {
          errorCount++
          console.error(`âŒ [TranscriptManager] ç›£è½å™¨å›èª¿éŒ¯èª¤ (${errorCount}/${sessionListeners.size}):`, error)
        }
      })

      console.log(`ğŸ“¡ [TranscriptManager] å»£æ’­å®Œæˆ: ${successCount} æˆåŠŸ, ${errorCount} å¤±æ•—`)
    } else {
      console.warn(`âš ï¸ [TranscriptManager] æ²’æœ‰æ‰¾åˆ° session ${sessionId} çš„ç›£è½å™¨`)
    }
  }

  /**
   * ç™¼é€ ping
   */
  private sendPing(sessionId: string): void {
    const ws = this.connections.get(sessionId)
    if (ws && ws.isConnected) {
      ws.sendJson({ type: 'ping' })
      console.log(`ğŸ“ TranscriptManager: å‘ session ${sessionId} ç™¼é€ ping`)
    }
  }

  /**
   * ç™¼é€å¿ƒè·³ - å¢å¼·ç‹€æ…‹åŒæ­¥
   */
  private sendHeartbeat(sessionId: string): void {
    // å…ˆåŒæ­¥ç‹€æ…‹
    const isActuallyConnected = this.syncConnectionState(sessionId)

    const ws = this.connections.get(sessionId)
    if (ws && isActuallyConnected) {
      try {
        ws.sendJson({
          type: 'heartbeat',
          timestamp: Date.now()
        })
        console.log(`ğŸ’“ TranscriptManager: å‘ session ${sessionId} ç™¼é€å¿ƒè·³`)
      } catch (error) {
        console.error(`âŒ TranscriptManager: ç™¼é€å¿ƒè·³å¤±æ•— ${sessionId}:`, error)
        // å¿ƒè·³ç™¼é€å¤±æ•—ï¼Œå¯èƒ½é€£æ¥å·²æ–·é–‹
        this.connectionStates.set(sessionId, false)
        this.scheduleReconnect(sessionId)
      }
    } else {
      // é€£æ¥å·²æ–·é–‹ï¼Œåœæ­¢å¿ƒè·³ä¸¦å˜—è©¦é‡é€£
      console.warn(`âš ï¸ TranscriptManager: å¿ƒè·³æª¢æ¸¬åˆ°é€£æ¥æ–·é–‹ ${sessionId}`)
      this.stopHeartbeat(sessionId)
      this.connectionStates.set(sessionId, false)
      this.scheduleReconnect(sessionId)
    }
  }

  /**
   * å•Ÿå‹•å¿ƒè·³æ©Ÿåˆ¶
   */
  private startHeartbeat(sessionId: string): void {
    this.stopHeartbeat(sessionId)

    const interval = setInterval(() => {
      this.sendHeartbeat(sessionId)
    }, this.heartbeatInterval)

    this.heartbeatIntervals.set(sessionId, interval)
    console.log(`ğŸ’“ TranscriptManager: ç‚º session ${sessionId} å•Ÿå‹•å¿ƒè·³`)
  }

  /**
   * åœæ­¢å¿ƒè·³æ©Ÿåˆ¶
   */
  private stopHeartbeat(sessionId: string): void {
    const interval = this.heartbeatIntervals.get(sessionId)
    if (interval) {
      clearInterval(interval)
      this.heartbeatIntervals.delete(sessionId)
      console.log(`ğŸ’“ TranscriptManager: ç‚º session ${sessionId} åœæ­¢å¿ƒè·³`)
    }
  }

  /**
   * å®‰æ’é‡é€£
   */
  private scheduleReconnect(sessionId: string): void {
    const attempts = this.reconnectAttempts.get(sessionId) ?? 0

    if (attempts >= this.maxReconnectAttempts) {
      console.error(`âŒ TranscriptManager: Session ${sessionId} é‡é€£æ¬¡æ•¸å·²é”ä¸Šé™`)
      return
    }

    this.reconnectAttempts.set(sessionId, attempts + 1)

    const delay = this.reconnectDelay * Math.pow(2, attempts) // æŒ‡æ•¸é€€é¿
    console.log(`ğŸ”„ TranscriptManager: Session ${sessionId} å°‡åœ¨ ${delay}ms å¾Œé‡é€£ (ç¬¬ ${attempts + 1} æ¬¡)`)

    setTimeout(async () => {
      try {
        await this.establishConnection(sessionId)
        this.reconnectAttempts.set(sessionId, 0) // é‡é€£æˆåŠŸï¼Œé‡ç½®è¨ˆæ•¸
      } catch (error) {
        console.error(`âŒ TranscriptManager: Session ${sessionId} é‡é€£å¤±æ•—:`, error)
      }
    }, delay)
  }

  /**
   * æ–·é–‹æŒ‡å®š session çš„é€£æ¥
   */
  async disconnect(sessionId: string): Promise<void> {
    console.log(`ğŸ“± TranscriptManager: æ–·é–‹ session ${sessionId}`)

    // åœæ­¢å¿ƒè·³
    this.stopHeartbeat(sessionId)

    // æ–·é–‹ WebSocket
    const ws = this.connections.get(sessionId)
    if (ws) {
      ws.disconnect()
      this.connections.delete(sessionId)
    }

    // æ›´æ–°ç‹€æ…‹
    this.connectionStates.set(sessionId, false)

    // æ¸…ç†ç›£è½å™¨
    this.listeners.delete(sessionId)

    // æ¸…ç†é‡é€£è¨ˆæ•¸
    this.reconnectAttempts.delete(sessionId)
  }

  /**
   * æ·»åŠ è¨Šæ¯ç›£è½å™¨
   */
  addListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
    if (!this.listeners.has(sessionId)) {
      this.listeners.set(sessionId, new Set())
    }
    this.listeners.get(sessionId)!.add(callback)
    console.log(`ğŸ“± TranscriptManager: ç‚º session ${sessionId} æ·»åŠ ç›£è½å™¨`)
  }

  /**
   * ç§»é™¤è¨Šæ¯ç›£è½å™¨
   */
  removeListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
    const sessionListeners = this.listeners.get(sessionId)
    if (sessionListeners) {
      sessionListeners.delete(callback)
      if (sessionListeners.size === 0) {
        this.listeners.delete(sessionId)
      }
    }
    console.log(`ğŸ“± TranscriptManager: ç‚º session ${sessionId} ç§»é™¤ç›£è½å™¨`)
  }

  /**
   * æª¢æŸ¥é€£æ¥ç‹€æ…‹ - å„ªåŒ–ç‰ˆï¼Œç¢ºä¿å³æ™‚ç‹€æ…‹åŒæ­¥
   */
  isConnected(sessionId: string): boolean {
    const ws = this.connections.get(sessionId)
    const stateConnected = this.connectionStates.get(sessionId) ?? false

    // å¯¦ä½œæ›´å¯é çš„å³æ™‚ç‹€æ…‹æª¢æ¸¬
    let actualConnected = false

    if (ws) {
      // å¤šé‡æª¢æŸ¥ç¢ºä¿æº–ç¢ºæ€§
      actualConnected = ws.isConnected && (
        ws.readyState === WebSocket.OPEN ||
        (typeof window !== 'undefined' && window.WebSocket && ws.readyState === 1)
      )
    }

    console.log(`ğŸ” [TranscriptManager] é€£æ¥ç‹€æ…‹æª¢æŸ¥:`, {
      sessionId,
      hasWebSocket: !!ws,
      wsReadyState: ws?.readyState,
      wsIsConnected: ws?.isConnected ?? false,
      stateConnected,
      actualConnected,
      needsSync: stateConnected !== actualConnected,
      timestamp: Date.now()
    })

    // å³æ™‚åŒæ­¥ç‹€æ…‹ï¼Œç¢ºä¿ connectionStates èˆ‡å¯¦éš› WebSocket ç‹€æ…‹ä¸€è‡´
    if (stateConnected !== actualConnected) {
      console.log(`ğŸ”„ [TranscriptManager] ç‹€æ…‹ä¸ä¸€è‡´ï¼Œå³æ™‚åŒæ­¥: ${sessionId} ${stateConnected} â†’ ${actualConnected}`, {
        previousState: stateConnected,
        newState: actualConnected,
        wsDetails: {
          isConnected: ws?.isConnected,
          readyState: ws?.readyState
        }
      })
      this.connectionStates.set(sessionId, actualConnected)

      // å¦‚æœé€£æ¥æ–·é–‹ä½†ç‹€æ…‹é¡¯ç¤ºé€£æ¥ï¼Œè§¸ç™¼é‡é€£
      if (stateConnected && !actualConnected) {
        console.warn(`âš ï¸ [TranscriptManager] æª¢æ¸¬åˆ°é€£æ¥æ–·é–‹ï¼Œå°‡è§¸ç™¼é‡é€£: ${sessionId}`)
        this.scheduleReconnect(sessionId)
      }
    }

    return actualConnected
  }

  /**
   * å¼·åŒ–çš„é€£æ¥ç‹€æ…‹ä¸€è‡´æ€§æª¢æŸ¥
   */
  private syncConnectionState(sessionId: string): boolean {
    const ws = this.connections.get(sessionId)
    const currentState = this.connectionStates.get(sessionId) ?? false

    if (!ws) {
      // æ²’æœ‰ WebSocketï¼Œç‹€æ…‹æ‡‰è©²æ˜¯ false
      if (currentState !== false) {
        console.log(`ğŸ”„ [TranscriptManager] åŒæ­¥ç‹€æ…‹ (ç„¡WebSocket): ${sessionId} â†’ false`)
        this.connectionStates.set(sessionId, false)
      }
      return false
    }

    // æœ‰ WebSocketï¼Œæª¢æŸ¥å¯¦éš›é€£æ¥ç‹€æ…‹
    const actualConnected = ws.isConnected && (
      ws.readyState === WebSocket.OPEN ||
      (typeof window !== 'undefined' && window.WebSocket && ws.readyState === 1)
    )

    if (currentState !== actualConnected) {
      console.log(`ğŸ”„ [TranscriptManager] åŒæ­¥ç‹€æ…‹: ${sessionId} ${currentState} â†’ ${actualConnected}`)
      this.connectionStates.set(sessionId, actualConnected)
    }

    return actualConnected
  }

  /**
   * å–å¾—é€£æ¥æ•¸é‡
   */
  getConnectionCount(): number {
    return Array.from(this.connections.values()).filter(ws => ws.isConnected).length
  }

  /**
   * æ¸…ç†æ‰€æœ‰é€£æ¥
   */
  async disconnectAll(): Promise<void> {
    console.log('ğŸ“± TranscriptManager: æ¸…ç†æ‰€æœ‰é€£æ¥')

    const sessionIds = Array.from(this.connections.keys())
    await Promise.all(sessionIds.map(sessionId => this.disconnect(sessionId)))
  }
}

// åŒ¯å‡º Singleton å¯¦ä¾‹
export const transcriptManager = TranscriptManager.getInstance()

// åŒ¯å‡ºé¡å‹
export type { TranscriptMessage }


# END FILE CONTENTS


# File: README.md

# StudyScriber

> é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼šé‚ŠéŒ„é‚Šè½‰éŒ„ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³æ¨¡å¼

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

StudyScriber æ˜¯ä¸€å€‹å…ˆé€²çš„é›²ç«¯ç­†è¨˜æ‡‰ç”¨ç¨‹å¼ï¼Œå°ˆç‚ºå­¸ç¿’è€…å’Œå°ˆæ¥­äººå£«è¨­è¨ˆã€‚å®ƒæä¾›å…©ç¨®ä¸»è¦æ¨¡å¼ï¼š

- **ç´”ç­†è¨˜æ¨¡å¼**ï¼šå°ˆæ³¨æ–¼ Markdown ç­†è¨˜ç·¨è¼¯ï¼Œæ”¯æ´è‡ªå‹•å„²å­˜
- **éŒ„éŸ³æ¨¡å¼**ï¼šé‚ŠéŒ„éŸ³é‚Šåšç­†è¨˜ï¼Œå³æ™‚è½‰éŒ„ç‚ºé€å­—ç¨¿

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### å¾Œç«¯
- **FastAPI** - ç¾ä»£ Python Web æ¡†æ¶
- **Supabase PostgreSQL** - é›²ç«¯è³‡æ–™åº«å¹³å°
- **SQLAlchemy 2.0** - ORM èˆ‡è³‡æ–™åº«æŠ½è±¡å±¤
- **Supabase Python SDK** - å®˜æ–¹å®¢æˆ¶ç«¯
- **Azure OpenAI** - Whisper èªéŸ³è½‰éŒ„æœå‹™
- **Google Vertex AI** - Gemini 2.5 Pro èªéŸ³è½‰éŒ„æœå‹™
- **Cloudflare R2** - éŸ³æª”é›²ç«¯å„²å­˜

#### ğŸ¯ é›™ STT Provider æ¶æ§‹
StudyScriber æ”¯æ´å¤šç¨®èªéŸ³è½‰æ–‡å­—å¼•æ“ï¼Œä½¿ç”¨è€…å¯è‡ªç”±é¸æ“‡ï¼š

- **Whisper (Azure OpenAI)**ï¼šé«˜ç²¾ç¢ºåº¦ã€å¤šèªè¨€æ”¯æ´ã€å¿«é€ŸéŸ¿æ‡‰
- **Gemini 2.5 Pro (Vertex AI)**ï¼šæœ€æ–° AI æŠ€è¡“ã€ä¸Šä¸‹æ–‡ç†è§£ã€é«˜å“è³ªè½‰éŒ„

##### æŠ€è¡“ç‰¹è‰²ï¼š
- **çµ±ä¸€ä»‹é¢**ï¼šæ‰€æœ‰ STT Provider å¯¦ä½œç›¸åŒçš„ `ISTTProvider` ä»‹é¢
- **Factory æ¨¡å¼**ï¼šæ ¹æ“šæœƒè©±è¨­å®šå‹•æ…‹é¸æ“‡ Provider
- **ç‹€æ…‹ç®¡ç†**ï¼šæ¯å€‹æœƒè©±çš„ STT Provider ç¨ç«‹ç®¡ç†
- **å‰ç«¯æ•´åˆ**ï¼šçµ±ä¸€çš„ UI å…ƒä»¶æ”¯æ´ Provider åˆ‡æ›

#### ğŸš€ WebM ç›´æ¥è½‰éŒ„æ¶æ§‹ (v2)
StudyScriber æ¡ç”¨é©å‘½æ€§çš„ **WebM ç›´æ¥è½‰éŒ„æ¶æ§‹**ï¼Œå¤§å¹…æå‡æ•ˆèƒ½ï¼š

- **ç›´æ¥è½‰éŒ„æµç¨‹**ï¼šå‰ç«¯éŒ„éŸ³ (WebM) â†’ ç›´æ¥ç™¼é€åˆ° Whisper API â†’ å³æ™‚è½‰éŒ„
- **æ¶ˆé™¤è½‰æ›ç“¶é ¸**ï¼šè·³éæ¯å€‹ chunk çš„ FFmpeg è½‰æ›æ­¥é©Ÿï¼Œç¯€çœ 60% è™•ç†æ™‚é–“
- **éŒ¯èª¤ç‡é™ä½ 80%**ï¼šç§»é™¤ FFmpeg ç›¸é—œè½‰æ›éŒ¯èª¤é»
- **å‘å¾Œç›¸å®¹**ï¼šä¿ç•™ FFmpeg é‚è¼¯ç”¨æ–¼éŒ„éŸ³çµæŸå¾Œçš„ WAV æª”æ¡ˆç”Ÿæˆ

### å‰ç«¯
- **React** - ä½¿ç”¨è€…ä»‹é¢æ¡†æ¶
- **React Hooks** - ç‹€æ…‹ç®¡ç†
- **Socket.IO** - å³æ™‚é€šè¨Š
- **Markdown Editor** - ç­†è¨˜ç·¨è¼¯å™¨

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

- Python 3.12+
- **Supabase å¸³æˆ¶** 
- **Azure OpenAI å¸³æˆ¶** (å¿…é ˆï¼ŒWhisper èªéŸ³è½‰éŒ„æœå‹™)
- **Google Cloud å¸³æˆ¶** (å¯é¸ï¼ŒGemini 2.5 Pro èªéŸ³è½‰éŒ„æœå‹™)
- **Cloudflare å¸³æˆ¶** (å¯é¸ï¼ŒéŸ³æª”å„²å­˜)
- Node.js 18+ (å‰ç«¯é–‹ç™¼ç”¨)

### 1. å»ºç«‹ Supabase å°ˆæ¡ˆ

1. å‰å¾€ [Supabase](https://supabase.com) è¨»å†Šå¸³æˆ¶
2. å»ºç«‹æ–°å°ˆæ¡ˆï¼Œè¨˜ä¸‹ï¼š
   - **Project URL**: `https://your-project-ref.supabase.co`
   - **API Key**: åœ¨ Settings > API ä¸­æ‰¾åˆ° `anon public` é‡‘é‘°

### 2. è¨­å®šå°ˆæ¡ˆ

```bash
# å…‹éš†å°ˆæ¡ˆ
git clone <repository-url>
cd study-scriber

# å»ºç«‹è™›æ“¬ç’°å¢ƒ
python -m venv .venv
source .venv/bin/activate  # macOS/Linux
# æˆ– .venv\Scripts\activate  # Windows

# å®‰è£ä¾è³´
uv sync  # æˆ– pip install -e .
```

### 3. é…ç½®ç’°å¢ƒè®Šæ•¸

è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬ï¼š
```bash
cp .env.example .env
```

ç·¨è¼¯ `.env` æª”æ¡ˆï¼š
```env
# === Supabase è¨­å®š (å¿…é ˆ) ===
DB_MODE=supabase
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your-anon-public-key

# === Azure OpenAI æœå‹™ (Whisper STT - å¿…é ˆ) ===
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-01
WHISPER_DEPLOYMENT_NAME=whisper-1

# === Google Vertex AI æœå‹™ (Gemini STT - å¯é¸) ===
STT_PROVIDER_DEFAULT=whisper  # é è¨­ STT Provider: whisper æˆ– gemini
GEMINI_ENDPOINT=us-central1-aiplatform.googleapis.com  # Vertex AI ç«¯é»
GEMINI_API_KEY=your-gcp-service-account-key  # GCP æœå‹™å¸³æˆ¶ API Key
GEMINI_PROMPT=è«‹è¼¸å‡ºé€å­—ç¨¿ï¼š  # è‡ªè¨‚ Gemini æç¤ºè©
GEMINI_MAX_REQUESTS=90  # æ¯åˆ†é˜æœ€å¤§è«‹æ±‚æ•¸

# === Cloudflare R2 å„²å­˜ (å¯é¸) ===
R2_ACCOUNT_ID=your-account-id
R2_API_TOKEN=your-r2-api-token
R2_BUCKET_NAME=studyscriber-audio
```

### 4. åˆå§‹åŒ– Supabase è³‡æ–™åº«

#### æ–¹æ³• A: ä½¿ç”¨ Supabase Dashboard (æ¨è–¦)

1. é–‹å•Ÿ [Supabase Dashboard](https://supabase.com/dashboard)
2. é¸æ“‡æ‚¨çš„å°ˆæ¡ˆ
3. é»é¸å·¦å´é¸å–®çš„ **SQL Editor**
4. è¤‡è£½ `app/db/supabase_init.sql` æª”æ¡ˆçš„å®Œæ•´å…§å®¹
5. è²¼ä¸Šåˆ° SQL Editor ä¸­
6. é»é¸ **Run** åŸ·è¡Œ

#### æ–¹æ³• B: ä½¿ç”¨æŒ‡ä»¤è¡Œå·¥å…·

```bash
# å®‰è£ Supabase CLI (å¯é¸)
npm install -g supabase

# ç™»å…¥ä¸¦é€£æ¥å°ˆæ¡ˆ
supabase login
supabase link --project-ref your-project-ref

# åŸ·è¡Œåˆå§‹åŒ–è…³æœ¬
supabase db reset --linked
```

### 5. é©—è­‰è¨­å®š

åŸ·è¡Œæ•´åˆæ¸¬è©¦ï¼š
```bash
python test_final_integration.py
```

å¦‚æœçœ‹åˆ°ä»¥ä¸‹è¼¸å‡ºï¼Œè¡¨ç¤ºè¨­å®šæˆåŠŸï¼š
```
ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼StudyScriber T1 + T2 æ•´åˆå®Œå…¨æˆåŠŸï¼
âœ¨ ç¾åœ¨å¯ä»¥é–‹å§‹é–‹ç™¼ T3 (éŸ³æª”è™•ç†) å’Œ T4 (é€å­—ç¨¿) åŠŸèƒ½äº†ï¼
```

### 6. è¨­å®šå‰ç«¯ç’°å¢ƒè®Šæ•¸

```bash
cd frontend
cp .env.example .env.local
```

ç·¨è¼¯ `frontend/.env.local` æª”æ¡ˆï¼š
```env
# StudyScriber Frontend Environment Variables
NEXT_PUBLIC_API_URL=http://127.0.0.1:8000
NEXT_PUBLIC_WS_URL=ws://127.0.0.1:8000
NODE_ENV=development
```

### 7. é…ç½® STT Provider (å¯é¸)

StudyScriber æ”¯æ´å…©ç¨®èªéŸ³è½‰æ–‡å­—å¼•æ“ï¼š

#### Whisper (Azure OpenAI) - é è¨­
- é«˜ç²¾ç¢ºåº¦è½‰éŒ„
- å¤šèªè¨€æ”¯æ´
- å¿«é€ŸéŸ¿æ‡‰æ™‚é–“
- è¨­å®šï¼šåƒ…éœ€ Azure OpenAI ç›¸é—œç’°å¢ƒè®Šæ•¸

#### Gemini 2.5 Pro (Vertex AI) - å¯é¸
- æœ€æ–° AI æŠ€è¡“
- å„ªç§€çš„ä¸Šä¸‹æ–‡ç†è§£
- é«˜å“è³ªè½‰éŒ„çµæœ
- è¨­å®šï¼šéœ€é¡å¤–é…ç½® Google Cloud æœå‹™

##### å•Ÿç”¨ Gemini çš„æ­¥é©Ÿï¼š

1. **å»ºç«‹ Google Cloud å°ˆæ¡ˆ**
   - å‰å¾€ [Google Cloud Console](https://console.cloud.google.com/)
   - å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ
   - å•Ÿç”¨ Vertex AI API

2. **å»ºç«‹æœå‹™å¸³æˆ¶**
   - å‰å¾€ IAM & Admin > Service Accounts
   - å»ºç«‹æ–°çš„æœå‹™å¸³æˆ¶
   - ä¸‹è¼‰ JSON é‡‘é‘°æª”æ¡ˆ
   - å°‡é‡‘é‘°å…§å®¹è½‰æ›ç‚º API Key æ ¼å¼

3. **è¨­å®šç’°å¢ƒè®Šæ•¸**
   ```env
   STT_PROVIDER_DEFAULT=gemini
   GEMINI_ENDPOINT=us-central1-aiplatform.googleapis.com
   GEMINI_API_KEY=your-gcp-service-account-key
   ```

4. **UI ä¸­åˆ‡æ› Provider**
   - åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­é»æ“Šè¨­å®šæŒ‰éˆ•
   - é¸æ“‡ã€ŒèªéŸ³è½‰æ–‡å­—å¼•æ“ã€
   - åˆ‡æ›åˆ° Gemini 2.5 Pro

### 8. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

**é‡è¦ï¼šè«‹æŒ‰é †åºå•Ÿå‹•ï¼Œé¿å…åˆå§‹åŒ–ç«¶é€Ÿå•é¡Œ**

#### å¾Œç«¯ (Terminal 1) - å…ˆå•Ÿå‹•
```bash
uv run python main.py
```
ç­‰å¾…çœ‹åˆ°ä»¥ä¸‹è¨Šæ¯è¡¨ç¤º Backend å®Œå…¨å•Ÿå‹•ï¼š
```
ğŸš€ StudyScriber æ­£åœ¨å•Ÿå‹•...
âœ… Transcription service initialized and registered.
INFO:     Application startup complete.
```

#### å‰ç«¯ (Terminal 2) - å¾Œå•Ÿå‹•
```bash
cd frontend
pnpm install  # é¦–æ¬¡é‹è¡Œ
pnpm dev
```

- å¾Œç«¯ API æœå‹™ï¼š`http://localhost:8000`
- å‰ç«¯æ‡‰ç”¨ç¨‹å¼ï¼š`http://localhost:3000`

> **æ³¨æ„**: å¦‚æœå‰ç«¯å•Ÿå‹•æ™‚å‡ºç¾ç¶²è·¯éŒ¯èª¤ï¼Œé€™é€šå¸¸æ˜¯å› ç‚º Backend é‚„åœ¨å•Ÿå‹•ä¸­ã€‚æ–°ç‰ˆæœ¬å·²åŠ å…¥é‡è©¦æ©Ÿåˆ¶ï¼Œæœƒè‡ªå‹•è™•ç†é€™å€‹å•é¡Œã€‚

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
study-scriber/
â”œâ”€â”€ app/                          # FastAPI æ‡‰ç”¨ç¨‹å¼
â”‚   â”œâ”€â”€ api/                     # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ sessions.py         # Session ç®¡ç† API
â”‚   â”‚   â””â”€â”€ notes.py            # ç­†è¨˜ API
â”‚   â”œâ”€â”€ ws/                      # WebSocket ç«¯é»
â”‚   â”œâ”€â”€ services/                # æ¥­å‹™é‚è¼¯æœå‹™
â”‚   â”‚   â””â”€â”€ stt/                # STT Provider æœå‹™
â”‚   â”‚       â”œâ”€â”€ base.py         # ISTTProvider ä»‹é¢
â”‚   â”‚       â”œâ”€â”€ whisper_provider.py  # Whisper STT Provider
â”‚   â”‚       â”œâ”€â”€ gemini_provider.py   # Gemini STT Provider
â”‚   â”‚       â””â”€â”€ factory.py      # Provider Factory
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåŠŸèƒ½ (FFmpeg, etc.)
â”‚   â”œâ”€â”€ db/                      # è³‡æ–™åº«é…ç½®èˆ‡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ supabase_config.py  # Supabase é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ supabase_init.sql   # è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
â”‚   â”‚   â”œâ”€â”€ database.py         # è³‡æ–™åº«é€£æ¥
â”‚   â”‚   â””â”€â”€ models.py           # SQLAlchemy æ¨¡å‹
â”‚   â”œâ”€â”€ middleware/              # ä¸­ä»‹è»Ÿé«”
â”‚   â””â”€â”€ schemas/                 # Pydantic æ¨¡å‹
â”œâ”€â”€ test_final_integration.py    # æ•´åˆæ¸¬è©¦è…³æœ¬
â”œâ”€â”€ main.py                      # æ‡‰ç”¨ç¨‹å¼å…¥å£é»
â”œâ”€â”€ .env.example                 # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â””â”€â”€ pyproject.toml              # å°ˆæ¡ˆé…ç½®
```

## ğŸ¯ STT Provider åŠŸèƒ½

StudyScriber æ”¯æ´å¤šç¨®èªéŸ³è½‰æ–‡å­—å¼•æ“ï¼Œæä¾›æ›´å¤šé¸æ“‡å’Œéˆæ´»æ€§ï¼š

### æ”¯æ´çš„ STT Provider

| Provider | å¼•æ“ | ç‰¹è‰² | è¨­å®šé›£åº¦ |
|----------|------|------|----------|
| **Whisper** | Azure OpenAI | é«˜ç²¾ç¢ºåº¦ã€å¤šèªè¨€æ”¯æ´ã€å¿«é€ŸéŸ¿æ‡‰ | ç°¡å–® |
| **Gemini 2.5 Pro** | Google Vertex AI | æœ€æ–° AI æŠ€è¡“ã€ä¸Šä¸‹æ–‡ç†è§£ã€é«˜å“è³ªè½‰éŒ„ | ä¸­ç­‰ |

### åŠŸèƒ½ç‰¹è‰²

- **UI å³æ™‚åˆ‡æ›**ï¼šåœ¨è¨­å®šä¸­éš¨æ™‚åˆ‡æ› STT Provider
- **æœƒè©±ç´šåˆ¥ç®¡ç†**ï¼šæ¯å€‹æœƒè©±å¯ä½¿ç”¨ä¸åŒçš„ STT Provider
- **ç‹€æ…‹é¡¯ç¤º**ï¼šé€å­—ç¨¿ä¸­é¡¯ç¤º Provider å¾½ç«  (W/G)
- **çµ±ä¸€ä»‹é¢**ï¼šæ‰€æœ‰ Provider å›å‚³ç›¸åŒæ ¼å¼çš„è½‰éŒ„çµæœ
- **éŒ¯èª¤è™•ç†**ï¼šå„ Provider ç¨ç«‹çš„éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶

### ä½¿ç”¨æ–¹å¼

1. **é–‹å§‹éŒ„éŸ³å‰**ï¼šåœ¨è¨­å®šä¸­é¸æ“‡åå¥½çš„ STT Provider
2. **å»ºç«‹æœƒè©±**ï¼šç³»çµ±æœƒä½¿ç”¨æ‚¨é¸æ“‡çš„ Provider
3. **éŒ„éŸ³éç¨‹**ï¼šé€å­—ç¨¿æœƒé¡¯ç¤ºå°æ‡‰çš„ Provider å¾½ç« 
4. **æœƒè©±åˆ‡æ›**ï¼šä¸åŒæœƒè©±å¯ä½¿ç”¨ä¸åŒçš„ Provider

## ğŸ—„ï¸ Supabase è³‡æ–™åº«æ¶æ§‹

### ä¸»è¦è¡¨æ ¼

- **sessions** - æœƒè©±ç®¡ç†ï¼ˆç´”ç­†è¨˜æˆ–éŒ„éŸ³æ¨¡å¼ï¼‰ï¼Œæ”¯æ´ active/completed/error ç‹€æ…‹
- **notes** - Markdown ç­†è¨˜å…§å®¹ï¼Œæ”¯æ´å®¢æˆ¶ç«¯æ™‚é–“æˆ³è¡çªæª¢æ¸¬
- **audio_files** - éŸ³æª”åˆ‡ç‰‡è¨˜éŒ„
- **transcript_segments** - é€å­—ç¨¿ç‰‡æ®µ
- **transcripts** - å®Œæ•´é€å­—ç¨¿

### é—œéµç‰¹æ€§

- **UUID ä¸»éµ** - ä½¿ç”¨ `gen_random_uuid()` è‡ªå‹•ç”Ÿæˆ
- **è‡ªå‹•æ™‚é–“æˆ³** - é€éè§¸ç™¼å™¨è‡ªå‹•æ›´æ–° `updated_at`
- **å–®ä¸€æ´»èºæœƒè©±** - è³‡æ–™åº«å±¤ç´šä¿è­‰åŒæ™‚åªæœ‰ä¸€å€‹ active session
- **å®Œæ•´ç´„æŸ** - å¤–éµã€æª¢æŸ¥ç´„æŸã€å”¯ä¸€ç´„æŸç¢ºä¿è³‡æ–™å®Œæ•´æ€§
- **ç´šè¯åˆªé™¤** - åˆªé™¤ session æ™‚è‡ªå‹•æ¸…ç†é—œè¯è³‡æ–™

### è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬èªªæ˜

`app/db/supabase_init.sql` åŒ…å«ï¼š

1. **è‡ªå®šç¾©é¡å‹ (Enum)**
   - `session_type`: `'note_only'`, `'recording'`
   - `session_status`: `'active'`, `'completed'`, `'error'`
   - `lang_code`: `'zh-TW'`, `'en-US'`

2. **è¡¨æ ¼å»ºç«‹**
   - æ‰€æœ‰å¿…è¦çš„è¡¨æ ¼å’Œæ¬„ä½
   - é©ç•¶çš„è³‡æ–™é¡å‹å’Œç´„æŸ

3. **ç´¢å¼•å»ºç«‹**
   - æŸ¥è©¢æ•ˆèƒ½æœ€ä½³åŒ–
   - å”¯ä¸€ç´„æŸç¢ºä¿è³‡æ–™å®Œæ•´æ€§

4. **è§¸ç™¼å™¨è¨­å®š**
   - è‡ªå‹•æ›´æ–°æ™‚é–“æˆ³
   - å–®ä¸€æ´»èºæœƒè©±ä¿è­·

## ğŸ§ª æ¸¬è©¦

### å‰ç«¯å–®å…ƒæ¸¬è©¦

å°ˆæ¡ˆå·²æ•´åˆ **Vitest** æ¸¬è©¦æ¡†æ¶ï¼Œæä¾› API å±¤èˆ‡æ ¸å¿ƒåŠŸèƒ½çš„å–®å…ƒæ¸¬è©¦ã€‚

```bash
cd frontend

# åŸ·è¡Œæ¸¬è©¦
pnpm test

# åŸ·è¡Œæ¸¬è©¦ä¸¦é¡¯ç¤º UI
pnpm test:ui

# å–®æ¬¡åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pnpm test:run
```

### æ¸¬è©¦è¦†è“‹ç¯„åœ

- âœ… **API é…ç½®æ¸¬è©¦** - é©—è­‰ç’°å¢ƒè®Šæ•¸é…ç½®
- âœ… **WebSocket URL å»ºæ§‹** - ç¢ºä¿ URL æ­£ç¢ºç”Ÿæˆ
- âœ… **API æ–¹æ³•å­˜åœ¨æ€§** - é©—è­‰æ‰€æœ‰å¿…è¦çš„ API æ–¹æ³•

### æ–°å¢æ¸¬è©¦

æ¸¬è©¦æª”æ¡ˆä½æ–¼ï¼š
- `frontend/lib/api.test.ts` - API å±¤æ¸¬è©¦
- `frontend/src/test-setup.ts` - æ¸¬è©¦ç’°å¢ƒè¨­å®š

## ğŸ”§ é–‹ç™¼æŒ‡å—

### æ¸¬è©¦è³‡æ–™åº«é€£æ¥

```bash
# å®Œæ•´æ•´åˆæ¸¬è©¦
python test_final_integration.py

# å¿«é€Ÿé€£æ¥æ¸¬è©¦
python -c "
from app.db.supabase_config import get_supabase_client
client = get_supabase_client()
response = client.table('sessions').select('*').execute()
print(f'âœ… é€£æ¥æˆåŠŸï¼Œæ‰¾åˆ° {len(response.data)} å€‹ sessions')
"
```

### API æ–‡ä»¶

å•Ÿå‹•æœå‹™å¾Œï¼Œè¨ªå•ä»¥ä¸‹ç¶²å€æŸ¥çœ‹ API æ–‡ä»¶ï¼š

- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`

### å¥åº·æª¢æŸ¥

```bash
curl http://localhost:8000/health
```

## ğŸ› ï¸ Supabase ç®¡ç†

### æŸ¥çœ‹è³‡æ–™

åœ¨ Supabase Dashboard ä¸­ï¼š
1. é»é¸ **Table Editor**
2. ç€è¦½å„å€‹è¡¨æ ¼çš„è³‡æ–™
3. å¯ä»¥ç›´æ¥åœ¨ Dashboard ä¸­ç·¨è¼¯è³‡æ–™

### ç›£æ§æ•ˆèƒ½

åœ¨ Supabase Dashboard ä¸­ï¼š
1. é»é¸ **Logs**
2. æŸ¥çœ‹ API è«‹æ±‚è¨˜éŒ„
3. ç›£æ§è³‡æ–™åº«æ•ˆèƒ½æŒ‡æ¨™

### å‚™ä»½èˆ‡é‚„åŸ

Supabase è‡ªå‹•æä¾›ï¼š
- æ¯æ—¥è‡ªå‹•å‚™ä»½
- æ™‚é–“é»é‚„åŸ (Point-in-time recovery)
- å¯åœ¨ Dashboard çš„ **Settings > Database** ä¸­ç®¡ç†

## ğŸš¨ å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼é¸æ“‡ Supabaseï¼Ÿ

A: Supabase æä¾›ï¼š
- **å…è²»é¡åº¦å……è¶³** - é©åˆé–‹ç™¼å’Œå°å‹å°ˆæ¡ˆ
- **PostgreSQL å®Œæ•´åŠŸèƒ½** - æ”¯æ´è¤‡é›œæŸ¥è©¢å’Œç´„æŸ
- **å…§å»ºèªè­‰** - æœªä¾†æ“´å±•ä½¿ç”¨è€…ç³»çµ±
- **å³æ™‚åŠŸèƒ½** - æ”¯æ´ WebSocket å’Œå³æ™‚åŒæ­¥
- **å„²å­˜æœå‹™** - æ•´åˆéŸ³æª”å„²å­˜
- **99.9% å¯ç”¨æ€§** - ç”Ÿç”¢ç´šåˆ¥ç©©å®šæ€§

### Q: å¦‚ä½•é‡ç½®è³‡æ–™åº«ï¼Ÿ

A: åœ¨ Supabase Dashboard çš„ SQL Editor ä¸­åŸ·è¡Œï¼š
```sql
-- åˆªé™¤æ‰€æœ‰è¡¨æ ¼
DROP TABLE IF EXISTS notes CASCADE;
DROP TABLE IF EXISTS transcripts CASCADE;
DROP TABLE IF EXISTS transcript_segments CASCADE;
DROP TABLE IF EXISTS audio_files CASCADE;
DROP TABLE IF EXISTS sessions CASCADE;

-- åˆªé™¤è‡ªå®šç¾©é¡å‹
DROP TYPE IF EXISTS session_type CASCADE;
DROP TYPE IF EXISTS session_status CASCADE;
DROP TYPE IF EXISTS lang_code CASCADE;
```
ç„¶å¾Œé‡æ–°åŸ·è¡Œ `supabase_init.sql`ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹è©³ç´°éŒ¯èª¤ï¼Ÿ

A: åœ¨ `.env` ä¸­è¨­å®šï¼š
```env
DEBUG=true
```
é€™å°‡å•Ÿç”¨è©³ç´°çš„ SQL æŸ¥è©¢æ—¥èªŒã€‚

## ğŸ¤ è²¢ç»æŒ‡å—

1. Fork å°ˆæ¡ˆ
2. å»ºç«‹ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. ç¢ºä¿æ‰€æœ‰æ¸¬è©¦é€šé (`python test_final_integration.py`)
4. æäº¤è®Šæ›´ (`git commit -m 'Add amazing feature'`)
5. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
6. é–‹å•Ÿ Pull Request

## ğŸ“„ æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ã€‚è©³æƒ…è«‹è¦‹ [LICENSE](LICENSE) æª”æ¡ˆã€‚

## ğŸ”— ç›¸é—œé€£çµ

- **[ğŸ”§ éŸ³é »åˆ‡ç‰‡é…ç½®æŒ‡å—](AUDIO_CHUNK_CONFIG.md)** - ç’°å¢ƒè®Šæ•¸é…ç½®éŒ„éŸ³åˆ‡ç‰‡æ™‚é–“
- [å°ˆæ¡ˆéœ€æ±‚æ–‡ä»¶ (PRD)](PRD.md)
- [æŠ€è¡“è¦æ ¼æ›¸ (SPEC)](SPEC.md)
- [æ¸¬è©¦å ±å‘Š](T1_T4_Test_Final_Report.md)
- [é–‹ç™¼ä»»å‹™æ¸…å–®](Todos.md)
- [Supabase å®˜æ–¹æ–‡ä»¶](https://supabase.com/docs)
- [API æ–‡ä»¶](http://localhost:8000/docs)

---

**StudyScriber** - è®“å­¸ç¿’æ›´æœ‰æ•ˆç‡ ğŸš€


# END FILE CONTENTS


# File: frontend/components.json

{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}

# END FILE CONTENTS


# File: Todos.md

## ğŸ¯ ç•¶å‰ä»»å‹™ï¼šç§»é™¤ä½¿ç”¨è€…å…ˆéœ€è¦å¯«æ¨™é¡Œçš„åŠŸèƒ½

### ç›®æ¨™
æ ¹æ“š SPEC.md ä¿®æ”¹ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ç›´æ¥é–‹å§‹éŒ„éŸ³æˆ–åšç­†è¨˜ï¼Œç„¡éœ€å…ˆè¼¸å…¥æ¨™é¡Œï¼Œæä¾›æ›´ç°¡æ½”çš„ä½¿ç”¨é«”é©—ã€‚éµå¾ª TDD åŸå‰‡ï¼Œå¾å¾Œç«¯é©—è­‰é–‹å§‹ï¼Œé€æ­¥æ¨é€²åˆ°å‰ç«¯å„å±¤ã€‚

### å¯¦ä½œä»»å‹™

- [ ] **Task 1: å¾Œç«¯ API æ¸¬è©¦ï¼šé©—è­‰å¯é¸æ¨™é¡ŒåŠŸèƒ½**
  - ğŸ“ æª”æ¡ˆï¼š`tests/test_session_optional_title.py`
  - ğŸ¯ ç·¨å¯«æ¸¬è©¦é©—è­‰å¾Œç«¯ create_session API åœ¨ä¸æä¾› title æ™‚çš„è¡Œç‚ºæ˜¯å¦æ­£ç¢º
  - ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼š
    - æ¸¬è©¦ POST /api/session ä¸å‚³ title åƒæ•¸çš„æƒ…æ³
    - æ¸¬è©¦ POST /api/session å‚³ title=null çš„æƒ…æ³
    - é©—è­‰å›æ‡‰åŒ…å«æ­£ç¢ºçš„ session çµæ§‹
    - ç¢ºä¿è³‡æ–™åº«ä¸­ title æ¬„ä½ç‚º NULL
  - ğŸ”„ ä¾è³´ï¼šç„¡ï¼ˆåŸºç¤é©—è­‰ä»»å‹™ï¼‰
  - âš ï¸ é—œéµæŠ€è¡“æŒ‘æˆ°ï¼šç¢ºèªå¾Œç«¯å·²å®Œæ•´æ”¯æ´å¯é¸æ¨™é¡Œï¼Œç‚ºå‰ç«¯ä¿®æ”¹å¥ å®šåŸºç¤
  - âœ… é©—è­‰æ¨™æº–ï¼šæ¸¬è©¦å…¨é¢è¦†è“‹ã€API å›æ‡‰æ­£ç¢ºã€è³‡æ–™åº«ç‹€æ…‹é©—è­‰

- [ ] **Task 2: å‰ç«¯ API å±¤æ›´æ–°ï¼šSessionCreateRequest ä»‹é¢èª¿æ•´**
  - ğŸ“ æª”æ¡ˆï¼š`frontend/lib/api.ts`, `frontend/types/app-state.ts`
  - ğŸ¯ ä¿®æ”¹ SessionCreateRequest ä»‹é¢ï¼Œè®“ title åƒæ•¸è®Šæˆå¯é¸
  - ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼š
    - æ›´æ–° TypeScript ä»‹é¢å®šç¾© title ç‚ºå¯é¸
    - ä¿®æ”¹ API å‘¼å«é‚è¼¯ï¼Œå…è¨±ä¸å‚³é title
    - æ›´æ–°ç›¸é—œé¡å‹å®šç¾©
  - ğŸ”„ ä¾è³´ï¼šTask 1 å®Œæˆ
  - âš ï¸ é—œéµæŠ€è¡“æŒ‘æˆ°ï¼šç¢ºä¿é¡å‹å®‰å…¨æ€§ï¼Œé¿å…ç ´å£ç¾æœ‰åŠŸèƒ½
  - âœ… é©—è­‰æ¨™æº–ï¼šTypeScript ç·¨è­¯ç„¡éŒ¯èª¤ã€ä»‹é¢å®šç¾©æ­£ç¢ºã€API å‘¼å«æˆåŠŸ

- [ ] **Task 3: æœå‹™å±¤æ›´æ–°ï¼šSessionService æ–¹æ³•èª¿æ•´**
  - ğŸ“ æª”æ¡ˆï¼š`frontend/lib/services/session-service.ts`, `frontend/lib/services/interfaces.ts`
  - ğŸ¯ ä¿®æ”¹ SessionService çš„ createSession æ–¹æ³•ï¼Œè®“ title åƒæ•¸è®Šæˆå¯é¸
  - ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼š
    - æ›´æ–° createSession æ–¹æ³•ç°½å
    - ä¿®æ”¹æœå‹™å¯¦ç¾é‚è¼¯
    - æ›´æ–°ä»‹é¢å®šç¾©
  - ğŸ”„ ä¾è³´ï¼šTask 2 å®Œæˆ
  - âš ï¸ é—œéµæŠ€è¡“æŒ‘æˆ°ï¼šä¿æŒæœå‹™å±¤ä»‹é¢ä¸€è‡´æ€§ï¼Œç¢ºä¿éŒ¯èª¤è™•ç†æ­£ç¢º
  - âœ… é©—è­‰æ¨™æº–ï¼šæœå‹™æ–¹æ³•æ­£ç¢ºã€ä»‹é¢ç›¸å®¹ã€éŒ¯èª¤è™•ç†å®Œæ•´

- [ ] **Task 4: Hook å±¤æ›´æ–°ï¼šuseSession ç³»åˆ— Hook èª¿æ•´**
  - ğŸ“ æª”æ¡ˆï¼š`frontend/hooks/use-session.ts`, `frontend/hooks/use-session-new.ts`
  - ğŸ¯ ä¿®æ”¹ useSession å’Œ useSessionNew hooks çš„ createNoteSession å’Œ createRecordingSession æ–¹æ³•
  - ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼š
    - ç§»é™¤ title å¿…å¡«åƒæ•¸ç´„æŸ
    - æ›´æ–°å‡½å¼ç°½åå’Œå¯¦ç¾
    - ç¢ºä¿å‘å¾Œç›¸å®¹æ€§
  - ğŸ”„ ä¾è³´ï¼šTask 3 å®Œæˆ
  - âš ï¸ é—œéµæŠ€è¡“æŒ‘æˆ°ï¼šHook ç‹€æ…‹ç®¡ç†ä¸€è‡´æ€§ï¼Œé¿å…ç ´å£ç¾æœ‰å‘¼å«
  - âœ… é©—è­‰æ¨™æº–ï¼šHook åŠŸèƒ½æ­£å¸¸ã€ç‹€æ…‹ç®¡ç†æ­£ç¢ºã€å‘å¾Œç›¸å®¹

- [ ] **Task 5: æ‡‰ç”¨ç‹€æ…‹å±¤æ›´æ–°ï¼šuseAppState ç³»åˆ— Hook èª¿æ•´**
  - ğŸ“ æª”æ¡ˆï¼š`frontend/hooks/use-app-state.ts`, `frontend/hooks/use-app-state-new.ts`
  - ğŸ¯ ä¿®æ”¹ useAppState å’Œ useAppStateNew hooks ä¸­å‘¼å« session å»ºç«‹çš„ç›¸é—œé‚è¼¯
  - ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼š
    - æ›´æ–° startNewNoteSession å’Œ startRecording æ–¹æ³•
    - ç§»é™¤å¼·åˆ¶è¦æ±‚ title çš„é‚è¼¯
    - ç¢ºä¿ç‹€æ…‹è½‰æ›æ­£ç¢º
  - ğŸ”„ ä¾è³´ï¼šTask 4 å®Œæˆ
  - âš ï¸ é—œéµæŠ€è¡“æŒ‘æˆ°ï¼šæ‡‰ç”¨ç‹€æ…‹ç®¡ç†è¤‡é›œæ€§ï¼Œç¢ºä¿ç‹€æ…‹æ©Ÿæ­£ç¢ºé‹ä½œ
  - âœ… é©—è­‰æ¨™æº–ï¼šç‹€æ…‹è½‰æ›æ­£ç¢ºã€æ‡‰ç”¨é‚è¼¯å®Œæ•´ã€ç„¡å‰¯ä½œç”¨

- [ ] **Task 6: UI å±¤èª¿æ•´ï¼šç§»é™¤ draftTitle ç›¸é—œé‚è¼¯**
  - ğŸ“ æª”æ¡ˆï¼š`frontend/study-scriber.tsx`, `frontend/hooks/use-local-draft.ts`
  - ğŸ¯ å¾ä¸»è¦ UI çµ„ä»¶å’Œæœ¬åœ°è‰ç¨¿ hook ä¸­ç§»é™¤ draftTitle ç›¸é—œçš„ç‹€æ…‹å’Œé‚è¼¯
  - ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼š
    - ç§»é™¤ draftTitle ç‹€æ…‹è®Šæ•¸
    - æ›´æ–° useLocalDraft hookï¼Œç§»é™¤ title è‰ç¨¿åŠŸèƒ½
    - ç¢ºä¿ UI æ¸²æŸ“é‚è¼¯æ­£ç¢º
  - ğŸ”„ ä¾è³´ï¼šTask 5 å®Œæˆ
  - âš ï¸ é—œéµæŠ€è¡“æŒ‘æˆ°ï¼šUI ä¸€è‡´æ€§ï¼Œç¢ºä¿ç§»é™¤ title å¾Œä»‹é¢ä»ç„¶å®Œæ•´
  - âœ… é©—è­‰æ¨™æº–ï¼šUI æ­£å¸¸é¡¯ç¤ºã€ç„¡ title ç›¸é—œéŒ¯èª¤ã€ä½¿ç”¨è€…é«”é©—æµæš¢

- [ ] **Task 7: æ•´åˆæ¸¬è©¦ï¼šç«¯åˆ°ç«¯æµç¨‹é©—è­‰**
  - ğŸ“ æª”æ¡ˆï¼šå‰ç«¯æ¸¬è©¦æª”æ¡ˆã€æ•´åˆæ¸¬è©¦
  - ğŸ¯ åŸ·è¡Œå®Œæ•´çš„ç«¯åˆ°ç«¯æ¸¬è©¦ï¼Œé©—è­‰ç§»é™¤æ¨™é¡ŒåŠŸèƒ½å¾Œçš„å®Œæ•´ä½¿ç”¨æµç¨‹
  - ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼š
    - æ¸¬è©¦ç´”ç­†è¨˜æ¨¡å¼ï¼ˆç„¡æ¨™é¡Œï¼‰
    - æ¸¬è©¦éŒ„éŸ³æ¨¡å¼ï¼ˆç„¡æ¨™é¡Œï¼‰
    - é©—è­‰æœƒè©±å»ºç«‹å’Œå„²å­˜
    - ç¢ºèªå‰å¾Œç«¯è³‡æ–™ä¸€è‡´æ€§
  - ğŸ”„ ä¾è³´ï¼šTask 6 å®Œæˆ
  - âš ï¸ é—œéµæŠ€è¡“æŒ‘æˆ°ï¼šç«¯åˆ°ç«¯æµç¨‹è¤‡é›œæ€§ï¼Œç¢ºä¿æ‰€æœ‰ä¿®æ”¹å”åŒå·¥ä½œ
  - âœ… é©—è­‰æ¨™æº–ï¼šå®Œæ•´åŠŸèƒ½æ­£å¸¸ã€ç„¡è¿´æ­¸å•é¡Œã€ä½¿ç”¨è€…é«”é©—ç¬¦åˆé æœŸ

### ğŸ¯ é æœŸæ•ˆæœ
- âœ… **ä½¿ç”¨é«”é©—ç°¡åŒ–**ï¼šä½¿ç”¨è€…å¯ç›´æ¥é–‹å§‹éŒ„éŸ³æˆ–åšç­†è¨˜
- âœ… **å‘å¾Œç›¸å®¹æ€§**ï¼šç¾æœ‰åŠŸèƒ½ä¸å—å½±éŸ¿
- âœ… **è³‡æ–™ä¸€è‡´æ€§**ï¼šå‰å¾Œç«¯ API å®Œå…¨å°æ‡‰
- âœ… **æ¸¬è©¦è¦†è“‹**ï¼šTDD æµç¨‹ç¢ºä¿å“è³ª

### ğŸ“Š å¯¦ä½œç­–ç•¥
| éšæ®µ    | ç¯„åœ              | é¢¨éšª | å°ç­–         |
| ------- | ----------------- | ---- | ------------ |
| Phase 1 | å¾Œç«¯é©—è­‰          | ä½   | ç¢ºèªç¾æœ‰æ”¯æ´ |
| Phase 2 | å‰ç«¯ API + æœå‹™å±¤ | ä¸­   | æ¼¸é€²å¼ä¿®æ”¹   |
| Phase 3 | Hook + ç‹€æ…‹å±¤     | ä¸­   | ä¿æŒä»‹é¢ç›¸å®¹ |
| Phase 4 | UI + æ•´åˆæ¸¬è©¦     | ä½   | ç«¯åˆ°ç«¯é©—è­‰   |

## ğŸš€ å„ªå…ˆä»»å‹™ï¼šæ»‘å‹•è¦–çª— Rate Limiting æ”¹é€²é€å­—ç¨¿å»¶é²

### ç›®æ¨™
å°‡ç¾æœ‰çš„å–®ä¸¦ç™¼ + æŒ‡æ•¸é€€é¿æ¶æ§‹å‡ç´šç‚ºç²¾ç¢ºçš„æ¯åˆ†é˜ 3 æ¬¡ Whisper API å‘¼å«æ§åˆ¶ï¼Œç›®æ¨™å°‡å¹³å‡å»¶é²å¾ 3-5 åˆ†é˜é™ä½åˆ° 1-2 åˆ†é˜ã€‚

### å¯¦ä½œä»»å‹™

- [x] **Task 1: å¯¦ä½œæ»‘å‹•è¦–çª—é »ç‡é™åˆ¶å™¨æ ¸å¿ƒæ¨¡çµ„**
  - ğŸ“ æª”æ¡ˆï¼š`app/services/azure_openai_v2.py`
  - ğŸ¯ å¯¦ä½œ `SlidingWindowRateLimiter` é¡åˆ¥ï¼Œä½¿ç”¨ `Semaphore + asyncio.call_later()` æ©Ÿåˆ¶
  - ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼š
    - `async def acquire()` - å–å¾— API å‘¼å«è¨±å¯
    - `def _release_permit()` - 60ç§’å¾Œè‡ªå‹•é‡‹æ”¾è¨±å¯
    - `def get_stats()` - å›å‚³ç•¶å‰ç‹€æ…‹çµ±è¨ˆ
  - âš ï¸ é—œéµæŠ€è¡“æŒ‘æˆ°ï¼šç¢ºä¿ `call_later()` æ­£ç¢ºé‡‹æ”¾ semaphoreï¼Œç„¡è¨˜æ†¶é«”æ´©æ¼
  - âœ… é©—è­‰æ¨™æº–ï¼šæ­£ç¢ºæ§åˆ¶ä½µç™¼æ•¸ã€è‡ªå‹•é‡‹æ”¾æ©Ÿåˆ¶ã€çµ±è¨ˆæº–ç¢ºæ€§

- [x] **Task 2: æ“´å±•é…ç½®ç³»çµ±æ”¯æ´æ»‘å‹•è¦–çª—åƒæ•¸**
  - ğŸ“ æª”æ¡ˆï¼š`app/core/config.py`, `.env.local`
  - ğŸ¯ æ–°å¢ç’°å¢ƒè®Šæ•¸é…ç½®å’Œ Feature Flag æ©Ÿåˆ¶
  - ğŸ“‹ é…ç½®é …ï¼š
    ```python
    USE_SLIDING_WINDOW_RATE_LIMIT: bool = Field(False)
    SLIDING_WINDOW_MAX_REQUESTS: int = Field(3) 
    SLIDING_WINDOW_SECONDS: int = Field(60)
    ```
  - ğŸ”„ å¯¦ä½œ `get_rate_limiter()` å·¥å» å‡½æ•¸æ”¯æ´ç­–ç•¥åˆ‡æ›
  - âœ… é©—è­‰æ¨™æº–ï¼šç’°å¢ƒè®Šæ•¸æ­£ç¢ºè®€å–ã€Feature Flag æ­£å¸¸åˆ‡æ›ã€å‘å¾Œç›¸å®¹

- [x] **Task 3: æ•´åˆæ»‘å‹•è¦–çª—åˆ°ç¾æœ‰è½‰éŒ„æœå‹™æ¶æ§‹**
  - ğŸ“ æª”æ¡ˆï¼š`app/services/azure_openai_v2.py` ä¸­çš„ `_transcribe_audio()` æ–¹æ³•
  - ğŸ¯ ä¿®æ”¹ç¾æœ‰çš„ `rate_limit.wait()` ä½¿ç”¨ï¼Œæ”¯æ´å‹•æ…‹ Rate Limiter åˆ‡æ›
  - ğŸ“‹ æ•´åˆè¦é»ï¼š
    - ä¿æŒ `await rate_limit.wait()` ä»‹é¢ä¸è®Š
    - å„ªåŒ– RateLimitError è™•ç†ï¼Œæ ¹æ“š Rate Limiter é¡å‹æä¾›é©ç•¶éŒ¯èª¤è¨Šæ¯
    - ç¢ºä¿ `backoff()` å’Œ `reset()` æ–¹æ³•åœ¨å…©ç¨®æ¨¡å¼ä¸‹éƒ½æ­£å¸¸å·¥ä½œ
    - ç¶­æŒèˆ‡ç¾æœ‰ Prometheus æŒ‡æ¨™çš„ç›¸å®¹æ€§
  - ğŸ”„ å®ŒæˆåŠŸèƒ½ï¼š
    - âœ… æ–°å¢ `SlidingWindowRateLimiter.backoff()` å’Œ `._delay` å±¬æ€§ç›¸å®¹
    - âœ… å„ªåŒ– RateLimitError è™•ç†é‚è¼¯ï¼Œæ ¹æ“šé¡å‹é¡¯ç¤ºä¸åŒéŒ¯èª¤è¨Šæ¯
    - âœ… ä¿æŒèˆ‡ç¾æœ‰æ¶æ§‹å®Œå…¨ç›¸å®¹
  - âœ… é©—è­‰æ¨™æº–ï¼šç„¡ç¸«åˆ‡æ›ã€éŒ¯èª¤è™•ç†ä¸€è‡´ã€Prometheus æŒ‡æ¨™æ­£å¸¸ã€ä»‹é¢ç›¸å®¹æ€§å®Œæ•´

- [x] **Task 4: ä¿®æ”¹ _transcribe_audio æ–¹æ³•ä½¿ç”¨ verbose_json ä¸¦å¯¦ä½œéæ¿¾**
  - ğŸ“ æª”æ¡ˆï¼š`app/services/azure_openai_v2.py`
  - ğŸ¯ ä¿®æ”¹ `_transcribe_audio` æ–¹æ³•ï¼Œå°‡ `response_format` æ”¹ç‚º "verbose_json"
  - ğŸ“‹ åŠŸèƒ½ï¼š
    - ä½¿ç”¨ `_keep` å‡½æ•¸éæ¿¾å¹»è¦ºæ®µè½
    - å¢åŠ è©³ç´°çš„æ—¥èªŒè¨˜éŒ„
    - æ›´æ–°ç›£æ§æŒ‡æ¨™
  - ğŸ”„ ä¾è³´ï¼šTask 3 å®Œæˆ
  - ğŸ†” TaskID: `f9e4060d-f2ec-4882-9529-211b1f9aca64`
  - âœ… é©—è­‰æ¨™æº–ï¼šAPI èª¿ç”¨æ­£ç¢ºã€éæ¿¾åŠŸèƒ½é‹ä½œã€æ—¥èªŒå®Œæ•´
  - ğŸ‰ **å·²å®Œæˆ**ï¼šæˆåŠŸä¿®æ”¹ `_transcribe_audio` æ–¹æ³•æ”¯æ´ `verbose_json` æ ¼å¼ï¼Œæ•´åˆ `_keep` å‡½æ•¸éæ¿¾å¹»è¦ºæ®µè½ï¼Œæ·»åŠ è©³ç´°çš„æ®µè½éæ¿¾çµ±è¨ˆæ—¥èªŒï¼ˆç¸½æ•¸ã€ä¿ç•™ã€éæ¿¾ï¼‰ï¼Œå¢å¼·è½‰éŒ„çµæœåŒ…å«æ®µè½çµ±è¨ˆè³‡è¨Šï¼Œä¸¦é€šé 7 å€‹å®Œæ•´çš„å–®å…ƒæ¸¬è©¦ï¼Œæ¶µè“‹æˆåŠŸéæ¿¾ã€å…¨æ®µè½éæ¿¾ã€ç©ºæ®µè½ã€API éŒ¯èª¤ã€é »ç‡é™åˆ¶ã€æ—¥èªŒè¨˜éŒ„å’Œ Prometheus æŒ‡æ¨™æ›´æ–°ç­‰æƒ…æ³

- [x] **Task 5: ç‚º _keep å‡½æ•¸å’Œéæ¿¾é‚è¼¯æ’°å¯«å–®å…ƒæ¸¬è©¦**
  - ğŸ“ æª”æ¡ˆï¼šæ¸¬è©¦æª”æ¡ˆ (éµå¾ªå°ˆæ¡ˆæ¸¬è©¦çµæ§‹)
  - ğŸ¯ ç‚ºæ–°å¯¦ä½œçš„ `_keep` å‡½æ•¸å’Œä¿®æ”¹å¾Œçš„ `_transcribe_audio` æ–¹æ³•æ’°å¯«å®Œæ•´çš„å–®å…ƒæ¸¬è©¦
  - ğŸ“‹ åŠŸèƒ½ï¼šä½¿ç”¨ç”¨æˆ¶æä¾›çš„æ¸¬è©¦ç¯„ä¾‹ï¼Œç¢ºä¿éæ¿¾é‚è¼¯åœ¨å„ç¨®é‚Šç•Œæ¢ä»¶ä¸‹éƒ½èƒ½æ­£ç¢ºé‹ä½œ
  - ğŸ”„ ä¾è³´ï¼šTask 4 å®Œæˆ
  - ğŸ†” TaskID: `bfbd159c-8774-4a17-a984-cb7fa388c359`
  - âœ… é©—è­‰æ¨™æº–ï¼šéµå¾ª TDD åŸå‰‡ï¼Œæ¸¬è©¦è¦†è“‹å®Œæ•´
  - ğŸ‰ **å·²å®Œæˆ**ï¼šå®Œæ•´çš„æ¸¬è©¦å·²åœ¨ Task 3 å’Œ Task 4 ä¸­å¯¦ä½œå®Œæˆ - Task 3 åŒ…å« `_keep` å‡½æ•¸çš„ 9 å€‹å®Œæ•´æ¸¬è©¦ï¼ˆæ¶µè“‹æœ‰æ•ˆæ®µè½ã€é«˜éœéŸ³æ©Ÿç‡ã€ä½ç½®ä¿¡åº¦ã€é«˜é‡è¤‡æ¯”ç‡ã€é‚Šç•Œå€¼ã€ç¼ºå°‘æ¬„ä½ã€Prometheus è¨ˆæ•¸å™¨ã€å¤šé‡éæ¿¾æ¢ä»¶ã€è‡ªå®šç¾©é–€æª»å€¼ï¼‰ï¼ŒTask 4 åŒ…å« `_transcribe_audio` verbose_json åŠŸèƒ½çš„ 7 å€‹å®Œæ•´æ¸¬è©¦ï¼ˆæ¶µè“‹æˆåŠŸéæ¿¾ã€å…¨æ®µè½éæ¿¾ã€ç©ºæ®µè½ã€API éŒ¯èª¤ã€é »ç‡é™åˆ¶ã€æ—¥èªŒè¨˜éŒ„ã€Prometheus æŒ‡æ¨™æ›´æ–°ï¼‰

- [x] **Task 6: æ›´æ–° .env.example æª”æ¡ˆæ·»åŠ éæ¿¾é–€æª»é…ç½®ç¯„ä¾‹**
  - ğŸ“ æª”æ¡ˆï¼š`.env.example`
  - ğŸ¯ åœ¨ Azure OpenAI å€æ®µæ–°å¢ Whisper æ®µè½éæ¿¾é–€æª»çš„é…ç½®ç¯„ä¾‹å’Œè©³ç´°èªªæ˜
  - ğŸ“‹ åŠŸèƒ½ï¼š
    - æä¾›æ¸…æ¥šçš„ä¸­æ–‡è¨»è§£èªªæ˜å„åƒæ•¸ç”¨é€”å’Œå»ºè­°å€¼
    - è®“ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è¤‡è£½åˆ°è‡ªå·±çš„ .env æª”æ¡ˆä¸­
  - ğŸ”„ ä¾è³´ï¼šTask 1 å®Œæˆ
  - ğŸ†” TaskID: `e609aecd-faa9-4b2c-bd39-cf97042f4256`
  - âœ… é©—è­‰æ¨™æº–ï¼šæ–‡ä»¶æ¸…æ¥šæ˜“æ‡‚ã€é…ç½®ç¯„ä¾‹å¯¦ç”¨
  - ğŸ‰ **å·²å®Œæˆ**ï¼šåœ¨ `.env.example` æª”æ¡ˆä¸­æ–°å¢å®Œæ•´çš„ã€ŒWhisper å¹»è¦ºéæ¿¾è¨­å®šã€å€æ®µï¼ŒåŒ…å«ä¸‰å€‹éæ¿¾åƒæ•¸ï¼ˆ`FILTER_NO_SPEECH=0.8`ã€`FILTER_LOGPROB=-1.0`ã€`FILTER_COMPRESSION=2.4`ï¼‰çš„è©³ç´°ä¸­æ–‡èªªæ˜ï¼Œæ¶µè“‹åƒæ•¸ç”¨é€”ã€æ•¸å€¼ç¯„åœã€å»ºè­°å€¼å’Œå¯¦éš›æ•ˆæœï¼Œè®“ä½¿ç”¨è€…èƒ½å¤ è¼•é¬†ç†è§£å’Œé…ç½®å¹»è¦ºéæ¿¾åŠŸèƒ½

## ğŸš€ ç·Šæ€¥ä»»å‹™ï¼šä¸¦ç™¼è™•ç†å„ªåŒ–è§£æ±ºé€å­—ç¨¿å»¶é²å•é¡Œ

### ç›®æ¨™
è§£æ±ºç•¶å‰éŒ„éŸ³å…©åˆ†é˜ä½†åªé¡¯ç¤ºä¸€æ®µé€å­—ç¨¿çš„åš´é‡å»¶é²å•é¡Œã€‚ä¸»è¦åŸå› æ˜¯ç¡¬ç·¨ç¢¼çš„å–®ä¸¦ç™¼é™åˆ¶ï¼ˆ`MAX_CONCURRENT_TRANSCRIPTIONS = 1`ï¼‰ï¼Œå°è‡´æ‰€æœ‰éŸ³æª”åˆ‡ç‰‡å¿…é ˆæ’éšŠç­‰å¾…è™•ç†ã€‚ç›®æ¨™å°‡è½‰éŒ„å»¶é²å¾ 60 ç§’+ é™è‡³ 15 ç§’å…§ï¼Œæ”¯æ´ 3-5 å€‹éŸ³æª”åˆ‡ç‰‡ä¸¦ç™¼è™•ç†ã€‚

### ğŸ“‹ å„ªåŒ–æ–¹æ¡ˆï¼ˆåŸºæ–¼ç¾æœ‰æ¶æ§‹ï¼‰
ç”¨æˆ¶æå‡ºçš„ä¸‰å±¤æ§åˆ¶æ©Ÿåˆ¶èˆ‡ç¾æœ‰ç³»çµ±é«˜åº¦å»åˆï¼š
1. **Queueé˜²ä¸Ÿå¤±** âœ… ç¾æœ‰ï¼š`PriorityQueue`ï¼ˆæ›´å¼·å¤§ï¼‰
2. **æ»‘å‹•è¦–çª—APIæ§åˆ¶** âœ… ç¾æœ‰ï¼š`SlidingWindowRateLimiter`ï¼ˆæ›´å®Œå–„ï¼‰  
3. **Semaphoreä½µç™¼æ§åˆ¶** âœ… **å·²å®Œæˆï¼šå¾1èª¿æ•´åˆ°3**

**æ ¸å¿ƒæµç¨‹**ï¼š`queue.get() â†’ sem.acquire() â†’ sliding.acquire() â†’ call_whisper()`

### ğŸ”¥ **CRITICAL UPDATE - ç«‹å³æ¸¬è©¦æ•ˆæœ**
**Task 1 å·²å®Œæˆä¸”é…ç½®å…¨éƒ¨ç”Ÿæ•ˆï¼**
- âœ… ä½µç™¼è™•ç†ï¼š1 â†’ 3 (300%æå‡)  
- âœ… æ»‘å‹•è¦–çª—ï¼šå•Ÿç”¨ (APIå„ªåŒ–ç”Ÿæ•ˆ)
- âœ… ç›£æ§å„ªåŒ–ï¼šéŸ¿æ‡‰é€Ÿåº¦2å€æå‡

**ğŸš¨ å»ºè­°ç«‹å³æ¸¬è©¦éŒ„éŸ³è½‰éŒ„æ•ˆæœ - æ‡‰è©²èƒ½çœ‹åˆ°é¡¯è‘—æ”¹å–„ï¼**

### å¯¦ä½œä»»å‹™

- [x] **Task 1: å¤–éƒ¨åŒ–ä¸¦ç™¼æ§åˆ¶åƒæ•¸é…ç½®ï¼ˆâœ… å·²å®Œæˆä¸¦ç”Ÿæ•ˆï¼‰**
  - ğŸ“ æª”æ¡ˆï¼š`app/core/config.py`, `app/services/azure_openai_v2.py`, `.env.local`
  - ğŸ¯ æ¡ç”¨ç”¨æˆ¶å»ºè­°çš„åƒæ•¸é…ç½®ï¼ŒåŸºæ–¼ç¾æœ‰æ¶æ§‹å„ªåŒ–è€Œéé‡å¯«
  - ğŸ“‹ **å®Œæˆç‹€æ…‹**ï¼š
    - âœ… ä¸¦ç™¼æ•¸æå‡ï¼šMAX_CONCURRENT_TRANSCRIPTIONS = 3
    - âœ… Workerå„ªåŒ–ï¼šTRANSCRIPTION_WORKERS_COUNT = 3
    - âœ… ç›£æ§æ”¹å–„ï¼šQUEUE_BACKLOG_THRESHOLD = 10, MONITOR_INTERVAL = 5
    - âœ… æ»‘å‹•è¦–çª—å•Ÿç”¨ï¼šUSE_SLIDING_WINDOW_RATE_LIMIT = True
    - âœ… é…ç½®æ–‡ä»¶å•é¡Œè§£æ±ºï¼š.env æ–‡ä»¶æ­£ç¢ºè®€å–
    - âœ… æœå‹™é‡å•Ÿï¼šæ‰€æœ‰é…ç½®ç”Ÿæ•ˆ
  - ğŸ†” TaskID: `7346d0d6-cc90-4996-b812-e1d476fb1614` âœ… **å·²å®Œæˆ**
  - âœ… **å¯¦æ¸¬å»ºè­°**ï¼šéŒ„éŸ³æ¸¬è©¦æ‡‰èƒ½çœ‹åˆ°3å€è™•ç†é€Ÿåº¦æå‡

- [ ] **Task 2: å„ªåŒ–æ»‘å‹•è¦–çª—APIé…é¡é…ç½®ï¼ˆå¯èƒ½ä¸éœ€è¦ï¼‰**
  - ğŸ“ æª”æ¡ˆï¼š`.env.local`, `app/core/config.py`
  - ğŸ¯ **ç‹€æ…‹æ›´æ–°**ï¼šæ»‘å‹•è¦–çª—å·²å•Ÿç”¨ï¼Œ3 requests/60sé…ç½®å·²ç”Ÿæ•ˆ
  - âš¡ **å»ºè­°**ï¼šå…ˆæ¸¬è©¦ Task 1 æ•ˆæœï¼Œå¦‚æœå»¶é²å·²è§£æ±ºå¯è·³éæ­¤ä»»å‹™
  - ğŸ†” TaskID: `8a2b5c9d-ef12-4567-9abc-def123456789`

- [ ] **Task 3: èª¿æ•´éšŠåˆ—ç®¡ç†å’Œç›£æ§åƒæ•¸ï¼ˆå·²éƒ¨åˆ†å®Œæˆï¼‰**
  - ğŸ“ æª”æ¡ˆï¼š`app/services/azure_openai_v2.py`
  - ğŸ¯ **ç‹€æ…‹æ›´æ–°**ï¼šç›£æ§é–“éš”å·²å„ªåŒ–ï¼ˆ10sâ†’5sï¼‰ï¼Œç©å£“é–¾å€¼å·²èª¿æ•´ï¼ˆ30â†’10ï¼‰
  - âš¡ **å»ºè­°**ï¼šå…ˆæ¸¬è©¦æ•ˆæœï¼Œå¯èƒ½ç„¡éœ€é€²ä¸€æ­¥èª¿æ•´
  - ğŸ†” TaskID: `7f3e2d1c-8b5a-4567-9def-abc987654321`

- [ ] **Task 4: æ¸¬è©¦å’Œé©—è­‰å„ªåŒ–æ•ˆæœï¼ˆç«‹å³åŸ·è¡Œï¼‰**
  - ğŸ“ æª”æ¡ˆï¼šæ•´é«”ç³»çµ±æ¸¬è©¦
  - ğŸ¯ **ç«‹å³è¡Œå‹•**ï¼šéŒ„éŸ³æ¸¬è©¦ï¼Œé©—è­‰å»¶é²æ”¹å–„æ•ˆæœ
  - ğŸ“‹ æ¸¬è©¦é‡é»ï¼š
    - éŒ„éŸ³2åˆ†é˜å…§æ˜¯å¦èƒ½çœ‹åˆ°å¤šæ®µé€å­—ç¨¿
    - è™•ç†å»¶é²æ˜¯å¦å¾60s+é™è‡³15så…§
    - ä½µç™¼è™•ç†æ˜¯å¦æ­£å¸¸é‹ä½œ
    - API 429éŒ¯èª¤æ˜¯å¦æ¸›å°‘
  - ğŸ†” TaskID: `9e4d3c2b-1a98-7654-3210-fedcba987654`

### ğŸš€ ç«‹å³è¡Œå‹•ï¼ˆ5åˆ†é˜è§£æ±ºï¼‰âœ… **å·²å®Œæˆ**
```bash
# æ ¸å¿ƒé…ç½®å·²ç”Ÿæ•ˆï¼š
MAX_CONCURRENT_TRANSCRIPTIONS=3      âœ… ç”Ÿæ•ˆ
USE_SLIDING_WINDOW_RATE_LIMIT=true   âœ… ç”Ÿæ•ˆ  
QUEUE_BACKLOG_THRESHOLD=10           âœ… ç”Ÿæ•ˆ
QUEUE_MONITOR_INTERVAL=5             âœ… ç”Ÿæ•ˆ

# æœå‹™å·²é‡å•Ÿï¼Œé…ç½®å…¨éƒ¨è¼‰å…¥ âœ…
```

### ğŸ¯ é æœŸæ•ˆæœï¼ˆåŸºæ–¼ç”¨æˆ¶æ–¹æ¡ˆï¼‰
- âœ… **å»¶é²å„ªåŒ–**ï¼šå¾ 60 ç§’+ é™è‡³ 10-15 ç§’ï¼ˆç”¨æˆ¶æ–¹æ¡ˆç›®æ¨™ï¼‰
- âœ… **ä½µç™¼æå‡**ï¼šæ”¯æ´ 3 å€‹éŸ³æª”åˆ‡ç‰‡ä¸¦ç™¼è™•ç†ï¼ˆ`sem.acquire()`ï¼‰  
- âœ… **APIæ§åˆ¶**ï¼šæ°¸ä¸ 429 éŒ¯èª¤ï¼ˆ`sliding.acquire()`ï¼‰
- âœ… **éšŠåˆ—é˜²è­·**ï¼šä¿è­‰ä¸ä¸Ÿæª”ï¼ˆ`queue.get()`ï¼‰
- âœ… **æ¶æ§‹å„ªå‹¢**ï¼šä¿ç•™ç¾æœ‰éŒ¯èª¤è™•ç†ã€ç›£æ§ã€æ®µè½éæ¿¾æ©Ÿåˆ¶

### ğŸ“Š æ–¹æ¡ˆå°æ¯”

| æŒ‡æ¨™     | ç¾æ³         | ç”¨æˆ¶æ–¹æ¡ˆ | ç¾æœ‰æ¶æ§‹å„ªåŒ–å¾Œ |
| -------- | ------------ | -------- | -------------- |
| ä½µç™¼è™•ç† | 1å€‹          | 3å€‹      | 3å€‹ âœ…          |
| APIæ§åˆ¶  | æ‰‹å‹•         | æ»‘å‹•è¦–çª— | æ»‘å‹•è¦–çª— âœ…     |
| å»¶é²æ™‚é–“ | 60s+         | 10-15s   | 10-15s âœ…       |
| éŒ¯èª¤è™•ç† | å®Œæ•´         | ç°¡åŒ–     | å®Œæ•´ âœ…         |
| ç›£æ§ç³»çµ± | Prometheus   | åŸºç¤å»£æ’­ | Prometheus âœ…   |
| æ®µè½éæ¿¾ | verbose_json | ç„¡       | verbose_json âœ… |

### ğŸš€ ç«‹å³è¡Œå‹•ï¼ˆ5åˆ†é˜è§£æ±ºï¼‰
```bash
# åœ¨ .env.local ä¸­ä¿®æ”¹é€™å¹¾è¡Œå³å¯ç«‹å³ç”Ÿæ•ˆ
MAX_CONCURRENT_TRANSCRIPTIONS=3
USE_SLIDING_WINDOW_RATE_LIMIT=true  
QUEUE_BACKLOG_THRESHOLD=10
QUEUE_MONITOR_INTERVAL=5

# ç„¶å¾Œé‡å•Ÿ
make restart
```

### æ³¨æ„äº‹é …
- ğŸ”¬ **åŸºæ–¼ç¾æœ‰æ¶æ§‹**ï¼šç„¡éœ€é‡å¯«ï¼Œåªéœ€åƒæ•¸èª¿å„ª
- ğŸ“Š **ä¿ç•™ä¼æ¥­ç´šåŠŸèƒ½**ï¼šéŒ¯èª¤è™•ç†ã€ç›£æ§ã€æ®µè½éæ¿¾
- ğŸ”„ **å¯å¿«é€Ÿå›æ»¾**ï¼šå¦‚é‡å•é¡Œå¯ç«‹å³æ¢å¾©å–®ä¸¦ç™¼
- ğŸ“ **æ•ˆæœç›£æ§**ï¼šPrometheusæŒ‡æ¨™å¯å³æ™‚è§€æ¸¬å„ªåŒ–æ•ˆæœ

## ğŸ”¥ ç·Šæ€¥å•é¡Œï¼šWaiting ç‹€æ…‹è¨ˆæ™‚å™¨ä¸æ›´æ–° & ç„¡æ³•è½‰æ›åˆ° Active ç‹€æ…‹

### ğŸš¨ å•é¡Œæè¿°
ç”¨æˆ¶å ±å‘ŠéŒ„éŸ³é€²å…¥ Waiting ç‹€æ…‹å¾Œï¼š
1. **è¨ˆæ™‚å™¨ä¸æœƒå‹•** - éŒ„éŸ³æ™‚é–“é¡¯ç¤ºåœæ»¯ï¼Œä¸æœƒæ¯ç§’æ›´æ–°
2. **ä¸æœƒé€²åˆ° active ç‹€æ…‹** - ç„¡æ³•å¾ `recording_waiting` è½‰æ›åˆ° `recording_active` ç‹€æ…‹é¡¯ç¤ºé€å­—ç¨¿

### ğŸ” å•é¡Œæ ¹æºåˆ†æ
**åŸºæ–¼ä»£ç¢¼æ·±åº¦åˆ†æçš„ç™¼ç¾ï¼š**

#### 1. è¨ˆæ™‚å™¨å•é¡Œï¼ˆuseRecordingNew.ts:174ï¼‰
- **åŸå› **ï¼šéŒ„éŸ³æ™‚é–“æ›´æ–°ä¾è³´æ–¼ `stateCheckInterval` æ¯ç§’æª¢æŸ¥ `recordingService.getRecordingState()` ä¸¦æ›´æ–° Context
- **å•é¡Œé»**ï¼šé€™å€‹ interval åªåœ¨ `startRecording` æˆåŠŸæ™‚å»ºç«‹ï¼Œå¦‚æœéŒ„éŸ³å•Ÿå‹•æµç¨‹ä¸­ä»»ä½•æ­¥é©Ÿå¤±æ•—ï¼Œè¨ˆæ™‚å™¨å°±ä¸æœƒå»ºç«‹æˆ–é‹è¡Œ
- **å½±éŸ¿**ï¼šUI ä¸Šçš„éŒ„éŸ³æ™‚é–“åœæ»¯ä¸å‹•ï¼Œç”¨æˆ¶ç„¡æ³•çœ‹åˆ°éŒ„éŸ³é€²åº¦

#### 2. ç‹€æ…‹è½‰æ›å•é¡Œï¼ˆuseRecordingNew.ts:96-103ï¼‰
- **åŸå› **ï¼šå¾ `recording_waiting` è½‰æ›åˆ° `recording_active` éœ€è¦è§¸ç™¼ `FIRST_TRANSCRIPT_RECEIVED` äº‹ä»¶
- **è§¸ç™¼æ¢ä»¶**ï¼šæ”¶åˆ° WebSocket çš„ `active` phase è¨Šæ¯æˆ–ç¬¬ä¸€å€‹é€å­—ç¨¿ç‰‡æ®µ
- **å•é¡Œé»**ï¼šå¦‚æœ WebSocket é€£æ¥å¤±æ•—æˆ–æ²’æœ‰æ”¶åˆ°ç›¸æ‡‰è¨Šæ¯ï¼Œç‹€æ…‹è½‰æ›å°±ä¸æœƒç™¼ç”Ÿ
- **å½±éŸ¿**ï¼šç”¨æˆ¶ä¸€ç›´åœç•™åœ¨ waiting ç‹€æ…‹ï¼Œçœ‹ä¸åˆ°ä»»ä½•é€å­—ç¨¿å…§å®¹

#### 3. æ¶æ§‹ä¾è³´å•é¡Œ
- **è¤‡é›œä¾è³´éˆ**ï¼šstartRecording â†’ RecordingService â†’ TranscriptService â†’ WebSocket â†’ ç‹€æ…‹è½‰æ›
- **å–®é»å¤±æ•—**ï¼šä»»ä½•ä¸€å€‹ç’°ç¯€å¤±æ•—éƒ½æœƒå°è‡´æ•´å€‹æµç¨‹åœæ»¯
- **ç¼ºä¹å®¹éŒ¯**ï¼šæ²’æœ‰è¶…æ™‚æ©Ÿåˆ¶æˆ–é‡è©¦é‚è¼¯ä¾†è™•ç†ç•°å¸¸æƒ…æ³

### ğŸ“‹ ä¿®å¾©ä»»å‹™æ¸…å–®

#### Task 1: è¨ºæ–·ä¸¦ä¿®å¾©éŒ„éŸ³è¨ˆæ™‚å™¨ä¸æ›´æ–°å•é¡Œ
- **æª”æ¡ˆ**ï¼š`frontend/hooks/use-recording-new.ts`
- **ç›®æ¨™**ï¼šç¢ºä¿éŒ„éŸ³è¨ˆæ™‚å™¨åœ¨æ‰€æœ‰æƒ…æ³ä¸‹éƒ½èƒ½æ­£å¸¸é‹è¡Œ
- **é—œéµä¿®å¾©é»**ï¼š
  - æª¢æŸ¥ line 174 è™•çš„ `stateCheckInterval` å»ºç«‹é‚è¼¯
  - ç¢ºä¿å³ä½¿ `startRecording` éƒ¨åˆ†å¤±æ•—ï¼Œè¨ˆæ™‚å™¨ä¹Ÿèƒ½æ­£ç¢ºé‹è¡Œ
  - æ·»åŠ å®¹éŒ¯æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
  - å¢å¼·æ—¥èªŒè¨˜éŒ„ä¾†è¿½è¹¤è¨ˆæ™‚å™¨ç‹€æ…‹
- **é©—è­‰æ¨™æº–**ï¼š
  - é€²å…¥ recording_waiting ç‹€æ…‹å¾Œï¼Œè¨ˆæ™‚å™¨æ‡‰è©²ç«‹å³é–‹å§‹æ›´æ–°
  - å³ä½¿éŒ„éŸ³å•Ÿå‹•éç¨‹ä¸­å‡ºç¾éŒ¯èª¤ï¼Œè¨ˆæ™‚å™¨ä»æ‡‰é¡¯ç¤ºæ­£ç¢ºæ™‚é–“
  - æ§åˆ¶å°æ‡‰æœ‰æ¸…æ™°çš„æ—¥èªŒè¨˜éŒ„è¨ˆæ™‚å™¨ç‹€æ…‹
  - UI ä¸Šçš„éŒ„éŸ³æ™‚é–“æ‡‰æ¯ç§’æ›´æ–°ä¸€æ¬¡
- **ç‹€æ…‹**ï¼šâ³ å¾…åŸ·è¡Œ

#### Task 2: ä¿®å¾©ç‹€æ…‹è½‰æ›å•é¡Œ - recording_waiting åˆ° recording_active
- **æª”æ¡ˆ**ï¼š`frontend/hooks/use-recording-new.ts`ã€`frontend/hooks/use-transcript-new.ts`
- **ç›®æ¨™**ï¼šç¢ºä¿ `FIRST_TRANSCRIPT_RECEIVED` äº‹ä»¶èƒ½æ­£ç¢ºè§¸ç™¼
- **é—œéµä¿®å¾©é»**ï¼š
  - æª¢æŸ¥ line 96-103 ä¸­çš„ `handleTranscript` é‚è¼¯
  - ç¢ºä¿ WebSocket é€£æ¥æ­£å¸¸ä¸”èƒ½æ”¶åˆ° active phase è¨Šæ¯
  - æ·»åŠ è¶…æ™‚æ©Ÿåˆ¶ï¼Œå¦‚æœé•·æ™‚é–“æ²’æ”¶åˆ° active è¨Šæ¯ï¼Œè‡ªå‹•è§¸ç™¼ç‹€æ…‹è½‰æ›
  - å¢å¼· WebSocket é€£æ¥çš„éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
  - æª¢æŸ¥ç‹€æ…‹æ©Ÿçš„è½‰æ›æ¢ä»¶æ˜¯å¦æ­£ç¢º
- **é©—è­‰æ¨™æº–**ï¼š
  - é–‹å§‹éŒ„éŸ³å¾Œï¼Œæ‡‰èƒ½æ­£ç¢ºå¾ recording_waiting è½‰æ›åˆ° recording_active
  - å¦‚æœ WebSocket é€£æ¥å¤±æ•—ï¼Œæ‡‰æœ‰é©ç•¶çš„éŒ¯èª¤è™•ç†å’Œé‡è©¦
  - å¦‚æœé•·æ™‚é–“æ²’æ”¶åˆ°é€å­—ç¨¿ï¼Œæ‡‰æœ‰è¶…æ™‚æ©Ÿåˆ¶è§¸ç™¼ç‹€æ…‹è½‰æ›
  - ç‹€æ…‹è½‰æ›éç¨‹æ‡‰æœ‰æ¸…æ™°çš„æ—¥èªŒè¨˜éŒ„
  - è½‰æ›åˆ° recording_active å¾Œï¼Œæ‡‰èƒ½æ­£ç¢ºé¡¯ç¤ºé€å­—ç¨¿å…§å®¹
- **ä¾è³´**ï¼šTask 1 å®Œæˆ
- **ç‹€æ…‹**ï¼šâ³ å¾…åŸ·è¡Œ

#### Task 3: å¢å¼·éŒ¯èª¤è™•ç†å’Œè¨ºæ–·å·¥å…·
- **æª”æ¡ˆ**ï¼š`frontend/hooks/use-recording-new.ts`ã€`frontend/lib/state-machine.ts`
- **ç›®æ¨™**ï¼šæ·»åŠ è©³ç´°çš„è¨ºæ–·å·¥å…·å¹«åŠ©è¿½è¹¤å•é¡Œ
- **é—œéµåŠŸèƒ½**ï¼š
  - åœ¨ useRecordingNew.ts ä¸­æ·»åŠ è©³ç´°çš„æ—¥èªŒè¨˜éŒ„
  - åœ¨ç€è¦½å™¨æ§åˆ¶å°æ·»åŠ èª¿è©¦ä»‹é¢
  - ä½¿ç”¨ç‹€æ…‹æ©Ÿçš„èª¿è©¦åŠŸèƒ½ä¾†æª¢æŸ¥è½‰æ›æ¢ä»¶
  - æ·»åŠ  WebSocket é€£æ¥ç‹€æ…‹çš„å¯¦æ™‚ç›£æ§
  - å‰µå»ºå•é¡Œè¨ºæ–·çš„ä¾¿åˆ©æ–¹æ³•
- **é©—è­‰æ¨™æº–**ï¼š
  - æ§åˆ¶å°æ‡‰æœ‰æ¸…æ™°çš„æ—¥èªŒè¨˜éŒ„æ‰€æœ‰é—œéµäº‹ä»¶
  - é–‹ç™¼è€…å·¥å…·ä¸­æ‡‰æœ‰ä¾¿åˆ©çš„èª¿è©¦ä»‹é¢
  - èƒ½å¤ å¯¦æ™‚ç›£æ§ WebSocket é€£æ¥ç‹€æ…‹
  - ç‹€æ…‹æ©Ÿè½‰æ›éç¨‹æ‡‰æœ‰è©³ç´°è¨˜éŒ„
  - éŒ¯èª¤ç™¼ç”Ÿæ™‚æ‡‰æœ‰è¶³å¤ çš„è¨ºæ–·ä¿¡æ¯
- **ä¾è³´**ï¼šTask 1, Task 2 å®Œæˆ
- **ç‹€æ…‹**ï¼šâ³ å¾…åŸ·è¡Œ

#### Task 4: æ¸¬è©¦å’Œé©—è­‰ä¿®å¾©çµæœ
- **æª”æ¡ˆ**ï¼šæ•´é«”ç³»çµ±æ¸¬è©¦
- **ç›®æ¨™**ï¼šå…¨é¢é©—è­‰ä¿®å¾©æ•ˆæœ
- **æ¸¬è©¦ç¯„åœ**ï¼š
  - æ¸¬è©¦æ­£å¸¸éŒ„éŸ³æµç¨‹ï¼šé–‹å§‹éŒ„éŸ³ â†’ ç­‰å¾…ç‹€æ…‹ â†’ æ´»èºç‹€æ…‹ â†’ åœæ­¢éŒ„éŸ³
  - æ¸¬è©¦éŒ¯èª¤å ´æ™¯ï¼šWebSocket é€£æ¥å¤±æ•—ã€éº¥å…‹é¢¨æ¬Šé™æ‹’çµ•ã€ç¶²è·¯æ–·ç·šç­‰
  - é©—è­‰è¨ˆæ™‚å™¨åœ¨å„ç¨®æƒ…æ³ä¸‹çš„æº–ç¢ºæ€§
  - ç¢ºèªç‹€æ…‹è½‰æ›çš„æ™‚æ©Ÿå’Œæ¢ä»¶
  - æ¸¬è©¦é€å­—ç¨¿çš„æ­£ç¢ºæ¥æ”¶å’Œé¡¯ç¤º
- **é©—è­‰æ¨™æº–**ï¼š
  - éŒ„éŸ³è¨ˆæ™‚å™¨æ‡‰åœ¨æ‰€æœ‰å ´æ™¯ä¸‹æ­£å¸¸å·¥ä½œ
  - ç‹€æ…‹è½‰æ›æ‡‰æº–ç¢ºåŠæ™‚
  - é€å­—ç¨¿æ‡‰æ­£ç¢ºæ¥æ”¶å’Œé¡¯ç¤º
  - éŒ¯èª¤è™•ç†æ‡‰æ°ç•¶ä¸”ç”¨æˆ¶å‹å¥½
  - æ•´å€‹éŒ„éŸ³æµç¨‹æ‡‰ç©©å®šå¯é 
- **ä¾è³´**ï¼šå‰é¢æ‰€æœ‰ä»»å‹™å®Œæˆ
- **ç‹€æ…‹**ï¼šâ³ å¾…åŸ·è¡Œ

### ğŸ¯ ä¿®å¾©å„ªå…ˆé †åº
1. **Task 1** - å…ˆè§£æ±ºè¨ˆæ™‚å™¨å•é¡Œï¼ˆåŸºç¤åŠŸèƒ½ï¼‰
2. **Task 2** - ä¿®å¾©ç‹€æ…‹è½‰æ›é‚è¼¯ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
3. **Task 3** - å¢å¼·è¨ºæ–·å·¥å…·ï¼ˆé–‹ç™¼æ”¯æ´ï¼‰
4. **Task 4** - å…¨é¢æ¸¬è©¦é©—è­‰ï¼ˆå“è³ªä¿è­‰ï¼‰

### ğŸ”§ æŠ€è¡“å‚µå‹™è¨˜éŒ„
- **ç¾æœ‰æ¶æ§‹éåº¦è¤‡é›œ**ï¼šéŒ„éŸ³åŠŸèƒ½æ¶‰åŠå¤ªå¤šå±¤ç´šå’Œä¾è³´
- **ç¼ºä¹å®¹éŒ¯æ©Ÿåˆ¶**ï¼šæ²’æœ‰é©ç•¶çš„è¶…æ™‚å’Œé‡è©¦é‚è¼¯
- **è¨ºæ–·å·¥å…·ä¸è¶³**ï¼šå•é¡Œç™¼ç”Ÿæ™‚é›£ä»¥å¿«é€Ÿå®šä½åŸå› 
- **ç‹€æ…‹ç®¡ç†è¤‡é›œ**ï¼šContext + ç‹€æ…‹æ©Ÿ + æœå‹™å±¤çš„å¤šé‡ç‹€æ…‹ç®¡ç†

### ğŸ’¡ é•·æœŸæ”¹é€²å»ºè­°
- ç°¡åŒ–éŒ„éŸ³åŠŸèƒ½çš„æ¶æ§‹å±¤ç´š
- å¢åŠ æ›´å¤šçš„å®¹éŒ¯å’Œé‡è©¦æ©Ÿåˆ¶
- å»ºç«‹å®Œæ•´çš„éŒ¯èª¤ç›£æ§å’Œé è­¦ç³»çµ±
- è€ƒæ…®é‡æ§‹ç‹€æ…‹ç®¡ç†é‚è¼¯

## ğŸ› ï¸ éŒ„éŸ³æµç¨‹ç©©å®šæ€§ä¿®æ­£ï¼ˆä¾ç”¨æˆ¶å»ºè­°ç´°åŒ–ï¼‰

### Task 1: è¨ˆæ™‚å™¨ç«‹å³å•Ÿå‹•èˆ‡æ­£ç¢ºæ¸…é™¤
- [x] hooks/use-recording-new.ts
  - [x] æŒ‰ä¸‹ startRecording æ™‚ç«‹å³å»ºç«‹ interval
  - [x] stopRecording æ™‚æ­£ç¢ºæ¸…é™¤ interval
  - [x] ç‹€æ…‹ç®¡ç†ç”¨å…¨åŸŸ refï¼Œç¢ºä¿å”¯ä¸€
  - [x] ä½¿ç”¨ useRef ä¿æŒç©©å®šå¼•ç”¨ï¼Œé¿å… re-render æ™‚ä¸Ÿå¤±
  - [x] åœ¨ useEffect cleanup ä¸­æ¸…ç†è¨ˆæ™‚å™¨

### Task 2: waitingâ†’active 20 ç§’è¶…æ™‚ä¿éšª
- [ ] é€²å…¥ waiting ç‹€æ…‹æ™‚è¨­ç½® 20 ç§’ timeout
- [ ] æ”¶åˆ°ç¬¬ä¸€å¥é€å­—ç¨¿æˆ– active phase æ™‚æ¸…é™¤ timeout
- [ ] è¶…æ™‚è‡ªå‹• setState('recording_active') ä¸¦è¨˜éŒ„è­¦å‘Š

### Task 3: WebSocket å¤±æ•—è‡ªå‹•é€² active
- [ ] ws.onclose æ™‚åˆ¤æ–·ç‹€æ…‹
- [ ] è‹¥åœ¨ waiting ç‹€æ…‹ï¼Œtoast æç¤ºä¸¦ setState('recording_active')

---


# END FILE CONTENTS


# File: frontend/lib/services/simple-recording-service.ts

"use client"

import { BaseService } from './base-service'
import { IRecordingService, RecordingState } from './interfaces'
import { AdvancedAudioRecorder, AudioSegment, checkAdvancedAudioRecordingSupport } from '../advanced-audio-recorder'
import { RestAudioUploader, UploadSegmentResponse } from '../rest-audio-uploader'
import { getAudioChunkIntervalMs } from '../config'
import { toast } from '@/hooks/use-toast'

/**
 * SimpleRecordingService - ç°¡åŒ–éŒ„éŸ³ç®¡ç†æœå‹™
 *
 * Phase 2.5 é‡æ§‹ï¼šä½¿ç”¨ AdvancedAudioRecorder ä¿®å¾© WebM Header å•é¡Œ
 * æ•´åˆ AdvancedAudioRecorder + RestAudioUploader
 *
 * ç‰¹é»ï¼š
 * - ä½¿ç”¨ AdvancedAudioRecorderï¼ˆé›™ MediaRecorder ç„¡ç¸«åˆ‡æ›ç­–ç•¥ï¼‰
 * - ä½¿ç”¨ RestAudioUploaderï¼ˆREST API ä¸Šå‚³ï¼‰
 * - ç§»é™¤ ack/missing é‡å‚³æ©Ÿåˆ¶
 * - ç°¡åŒ–éŒ¯èª¤è™•ç†å’Œç‹€æ…‹ç®¡ç†
 * - æ”¯æ´å¤±æ•—æª”æ¡ˆæš«å­˜åˆ° IndexedDB
 */
export class SimpleRecordingService extends BaseService implements IRecordingService {
    protected readonly serviceName = 'SimpleRecordingService'

    // éŒ„éŸ³å™¨å’Œä¸Šå‚³å™¨å¼•ç”¨
    private audioRecorder: AdvancedAudioRecorder | null = null
    private audioUploader: RestAudioUploader | null = null

    // éŒ„éŸ³ç‹€æ…‹
    private recordingState: RecordingState = {
        isRecording: false,
        recordingTime: 0,
        currentSessionId: null,
        error: null
    }

    // è¨ˆæ™‚å™¨
    private recordingTimer: ReturnType<typeof setInterval> | null = null
    private uploadedSegments = new Set<number>()
    private failedSegments = new Set<number>()

    // åœ¨ class SimpleRecordingService å…§éƒ¨åŠ ä¸Šï¼š
    public stream: MediaStream | null = null
    private sessionId: string | null = null
    private timerStart: number | null = null

    /**
     * æœå‹™åˆå§‹åŒ–
     */
    async initialize(): Promise<void> {
        this.logInfo('æœå‹™åˆå§‹åŒ–é–‹å§‹')

        // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦
        const supportCheck = await checkAdvancedAudioRecordingSupport()
        if (!supportCheck.isSupported) {
            const errorMessage = `éŸ³é »éŒ„è£½ä¸æ”¯æ´: ${supportCheck.error || 'æœªçŸ¥éŒ¯èª¤'}`
            this.logWarning('ç€è¦½å™¨æ”¯æ´åº¦æª¢æŸ¥å¤±æ•—', supportCheck.error)
            throw new Error(errorMessage)
        }

        this.logSuccess('ç€è¦½å™¨æ”¯æ´åº¦æª¢æŸ¥é€šé')
        this.logSuccess('åˆå§‹åŒ–å®Œæˆ')
    }

    /**
     * æœå‹™æ¸…ç†
     */
    async cleanup(): Promise<void> {
        this.logInfo('æœå‹™æ¸…ç†é–‹å§‹')

        // å¦‚æœæ­£åœ¨éŒ„éŸ³ï¼Œå…ˆåœæ­¢
        if (this.recordingState.isRecording) {
            await this.stopRecording()
        }

        // æ¸…ç†éŸ³é »éŒ„è£½å™¨
        if (this.audioRecorder) {
            this.audioRecorder.cleanup()
            this.audioRecorder = null
        }

        // æ¸…ç†ä¸Šå‚³å™¨
        if (this.audioUploader) {
            this.audioUploader.cleanup()
            this.audioUploader = null
        }

        // æ¸…ç†è¨ˆæ™‚å™¨
        this.clearRecordingTimer()

        // é‡ç½®ç‹€æ…‹
        this.resetRecordingState()

        this.logSuccess('æ¸…ç†å®Œæˆ')
    }

    /**
     * é–‹å§‹éŒ„éŸ³
     */
    async startRecording(sessionId: string): Promise<void> {
        try {
            this.logInfo(`é–‹å§‹éŒ„éŸ³ - sessionId: ${sessionId}`)

            // å¦‚æœå·²ç¶“åœ¨éŒ„éŸ³ï¼Œå…ˆåœæ­¢
            if (this.recordingState.isRecording) {
                this.logWarning('å·²åœ¨éŒ„éŸ³ä¸­ï¼Œå…ˆåœæ­¢ç¾æœ‰éŒ„éŸ³')
                await this.stopRecording()
            }

            this.sessionId = sessionId
            this.recordingState.currentSessionId = sessionId

            // è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™
            await this.ensureStarted()

            // åˆå§‹åŒ–éŒ„éŸ³å™¨å’Œä¸Šå‚³å™¨
            await this.initMediaRecorder()

            // æ›´æ–°ç‹€æ…‹
            this.recordingState.isRecording = true
            this.recordingState.error = null

            // å•Ÿå‹•è¨ˆæ™‚å™¨
            this.timerStart = Date.now()
            this.startRecordingTimer()

            this.logSuccess(`éŒ„éŸ³å·²é–‹å§‹ - sessionId: ${sessionId}`)
        } catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
            this.recordingState.error = errorMessage
            this.handleError('é–‹å§‹éŒ„éŸ³', error)
            throw error
        }
    }

    /**
     * åœæ­¢éŒ„éŸ³
     */
    async stopRecording(): Promise<void> {
        this.logInfo('åœæ­¢éŒ„éŸ³')

        try {
            // æ›´æ–°ç‹€æ…‹
            this.recordingState.isRecording = false

            // åœæ­¢éŸ³é »éŒ„è£½å™¨
            if (this.audioRecorder) {
                this.audioRecorder.stop()
                this.logInfo('éŸ³é »éŒ„è£½å™¨å·²åœæ­¢')
            }

            // åœæ­¢è¨ˆæ™‚å™¨
            this.clearRecordingTimer()

            // æ¸…ç†éŸ³é »éŒ„è£½å™¨
            if (this.audioRecorder) {
                this.audioRecorder.cleanup()
                this.audioRecorder = null
            }

            this.logSuccess('éŒ„éŸ³åœæ­¢æˆåŠŸ', {
                sessionId: this.recordingState.currentSessionId,
                recordingTime: this.recordingState.recordingTime,
                uploadedSegments: this.uploadedSegments.size,
                failedSegments: this.failedSegments.size
            })

        } catch (error) {
            this.recordingState.error = error instanceof Error ? error.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
            this.handleError('åœæ­¢éŒ„éŸ³', error)
        }
    }

    /**
     * å–å¾—ç•¶å‰éŒ„éŸ³ç‹€æ…‹
     */
    getRecordingState(): RecordingState {
        return { ...this.recordingState }
    }

    /**
     * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
     */
    isRecording(): boolean {
        return this.recordingState.isRecording
    }

    /**
     * å–å¾—éŒ„éŸ³æ™‚é–“ï¼ˆç§’ï¼‰
     */
    getRecordingTime(): number {
        return this.timerStart ? (Date.now() - this.timerStart) / 1000 | 0 : 0
    }

    /**
     * è¨­å®šéŸ³é »éŒ„è£½å™¨äº‹ä»¶è™•ç†
     */
    private setupAudioRecorderEvents(): void {
        if (!this.audioRecorder) return

        // è™•ç†éŒ„è£½éŒ¯èª¤
        this.audioRecorder.onError((error: Error) => {
            this.logWarning('éŸ³é »éŒ„è£½å™¨éŒ¯èª¤', error.message)
            this.recordingState.error = error.message
        })
    }

    /**
     * è¨­å®šä¸Šå‚³å™¨äº‹ä»¶è™•ç†
     */
    private setupUploaderEvents(): void {
        if (!this.audioUploader) return

        // è™•ç†ä¸Šå‚³æˆåŠŸ
        this.audioUploader.onUploadSuccess((seq: number, response: UploadSegmentResponse) => {
            this.uploadedSegments.add(seq)
            this.logInfo('éŸ³é »æ®µè½ä¸Šå‚³æˆåŠŸ', {
                sequence: seq,
                size: response.size,
                totalUploaded: this.uploadedSegments.size
            })
        })

        // è™•ç†ä¸Šå‚³éŒ¯èª¤
        this.audioUploader.onUploadError((seq: number, error: string) => {
            this.failedSegments.add(seq)
            this.logWarning('éŸ³é »æ®µè½ä¸Šå‚³å¤±æ•—', {
                sequence: seq,
                error,
                totalFailed: this.failedSegments.size
            })
        })

        // è™•ç†æš«å­˜åˆ°æœ¬åœ°
        this.audioUploader.onCacheStored((seq: number) => {
            this.logInfo('éŸ³é »æ®µè½å·²æš«å­˜åˆ°æœ¬åœ°', {
                sequence: seq,
                message: 'å¯ç¨å¾Œé‡æ–°ä¸Šå‚³'
            })
        })
    }

    /**
     * è™•ç†éŸ³é »æ®µè½
     */
    private async handleAudioSegment(segment: any): Promise<void> {
        console.log('ğŸ¤ [SimpleRecordingService] æ”¶åˆ°éŸ³é »æ®µè½', {
            sequence: segment.sequence,
            size: segment.blob.size,
            duration: segment.duration,
            timestamp: new Date().toISOString()
        })

        this.logInfo(`æ”¶åˆ°éŸ³é »æ®µè½ - sequence: ${segment.sequence}, size: ${segment.blob.size}, duration: ${segment.duration}`)

        // ä½¿ç”¨ REST API ä¸Šå‚³
        if (this.audioUploader) {
            try {
                await this.audioUploader.uploadSegment(segment.sequence, segment.blob)
            } catch (error) {
                // éŒ¯èª¤å·²ç”± audioUploader è™•ç†ï¼ˆé‡è©¦æˆ–æš«å­˜ï¼‰
                console.log(`âš ï¸ [SimpleRecordingService] æ®µè½ #${segment.sequence} ä¸Šå‚³è™•ç†ä¸­`)
            }
        } else {
            this.logWarning(`éŸ³é »ä¸Šå‚³å™¨æœªåˆå§‹åŒ– - sequence: ${segment.sequence}`)
        }
    }

    /**
     * é‡æ–°ä¸Šå‚³æš«å­˜çš„å¤±æ•—æ®µè½
     */
    async retryFailedUploads(): Promise<void> {
        this.logInfo('é–‹å§‹é‡æ–°ä¸Šå‚³æš«å­˜çš„å¤±æ•—æ®µè½')

        if (this.audioUploader) {
            try {
                await this.audioUploader.retryFailedSegments()
                this.logSuccess('æš«å­˜æ®µè½é‡æ–°ä¸Šå‚³å®Œæˆ')
            } catch (error) {
                this.logWarning('é‡æ–°ä¸Šå‚³æš«å­˜æ®µè½å¤±æ•—', error)
            }
        }
    }

    /**
     * å–å¾—æš«å­˜çš„å¤±æ•—æ®µè½æ•¸é‡
     */
    async getCachedSegmentsCount(): Promise<number> {
        if (this.audioUploader) {
            return await this.audioUploader.getCachedSegmentsCount()
        }
        return 0
    }

    /**
     * å•Ÿå‹•éŒ„éŸ³è¨ˆæ™‚å™¨
     */
    private startRecordingTimer(): void {
        this.clearRecordingTimer()
        this.recordingState.recordingTime = 0

        console.log('â±ï¸ [SimpleRecordingService] è¨ˆæ™‚å™¨å•Ÿå‹•')
        this.recordingTimer = setInterval(() => {
            this.recordingState.recordingTime += 1

            // æ¯ 30 ç§’è¨˜éŒ„ä¸€æ¬¡éŒ„éŸ³æ™‚é–“
            if (this.recordingState.recordingTime % 30 === 0) {
                this.logInfo('éŒ„éŸ³é€²è¡Œä¸­', {
                    recordingTime: this.recordingState.recordingTime,
                    minutes: Math.floor(this.recordingState.recordingTime / 60),
                    uploadedSegments: this.uploadedSegments.size,
                    failedSegments: this.failedSegments.size
                })
            }
        }, 1000)
    }

    /**
     * æ¸…ç†éŒ„éŸ³è¨ˆæ™‚å™¨
     */
    private clearRecordingTimer(): void {
        if (this.recordingTimer) {
            clearInterval(this.recordingTimer)
            this.recordingTimer = null
            console.log('â¹ï¸ [SimpleRecordingService] è¨ˆæ™‚å™¨æ¸…é™¤')
        }
    }

    /**
     * é‡ç½®éŒ„éŸ³ç‹€æ…‹
     */
    private resetRecordingState(): void {
        this.recordingState = {
            isRecording: false,
            recordingTime: 0,
            currentSessionId: null,
            error: null
        }
        this.uploadedSegments.clear()
        this.failedSegments.clear()
    }

    /**
     * æ¸…ç†éŒ„éŸ³ç›¸é—œè³‡æº
     */
    private async cleanupRecordingResources(): Promise<void> {
        try {
            // åœæ­¢éŸ³é »éŒ„è£½å™¨
            if (this.audioRecorder) {
                this.audioRecorder.stop()
                this.audioRecorder.cleanup()
                this.audioRecorder = null
            }

            // æ¸…ç†ä¸Šå‚³å™¨
            if (this.audioUploader) {
                this.audioUploader.cleanup()
                this.audioUploader = null
            }

            // æ¸…ç†è¨ˆæ™‚å™¨
            this.clearRecordingTimer()

            // é‡ç½®ç‹€æ…‹
            this.recordingState.isRecording = false

            this.logInfo('éŒ„éŸ³è³‡æºæ¸…ç†å®Œæˆ')
        } catch (error) {
            this.logWarning('æ¸…ç†éŒ„éŸ³è³‡æºæ™‚ç™¼ç”ŸéŒ¯èª¤', error)
        }
    }

    /**
     * ç²å–æœå‹™è©³ç´°ç‹€æ…‹
     */
    async getDetailedStatus(): Promise<SimpleRecordingServiceStatus> {
        const baseStatus = this.getStatus()
        const supportCheck = await checkAdvancedAudioRecordingSupport()
        const cachedCount = await this.getCachedSegmentsCount()

        return {
            ...baseStatus,
            recordingState: this.getRecordingState(),
            audioSupport: {
                supported: supportCheck.isSupported,
                errors: supportCheck.error ? [supportCheck.error] : []
            },
            audioRecorderState: this.audioRecorder?.recording ? 'recording' : 'idle',
            uploadStats: {
                uploaded: this.uploadedSegments.size,
                failed: this.failedSegments.size,
                cached: cachedCount
            }
        }
    }

    async requestPermission(): Promise<boolean> {
        try {
            this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })
            return true
        } catch (e) {
            toast({ title: 'éœ€è¦éº¥å…‹é¢¨æ¬Šé™æ‰èƒ½éŒ„éŸ³', variant: 'destructive' })
            return false
        }
    }

    private async ensureStarted() {
        if (!this.stream) await this.start()
    }

    /**
     * åˆå§‹åŒ– MediaRecorder å’Œç›¸é—œå…ƒä»¶
     */
    private async initMediaRecorder(): Promise<void> {
        try {
            this.logInfo('åˆå§‹åŒ– MediaRecorder')

            if (!this.stream) {
                throw new Error('éŸ³è¨Šä¸²æµæœªåˆå§‹åŒ–')
            }

            if (!this.sessionId) {
                throw new Error('Session ID æœªè¨­å®š')
            }

            // å‰µå»ºéŸ³é »éŒ„è£½å™¨
            const chunkInterval = (await import('../config')).getAudioChunkIntervalMs()
            const { AdvancedAudioRecorder } = await import('../advanced-audio-recorder')
            this.audioRecorder = new AdvancedAudioRecorder({
                segmentDuration: chunkInterval,
                mimeType: 'audio/webm;codecs=opus',
                audioBitsPerSecond: 128000
            })

            // è¨­å®šéŒ„è£½å™¨äº‹ä»¶ï¼ˆéŒ¯èª¤è™•ç†ï¼‰
            this.setupAudioRecorderEvents()

            // å‰µå»ºä¸Šå‚³å™¨
            const { RestAudioUploader } = await import('../rest-audio-uploader')
            this.audioUploader = new RestAudioUploader()
            this.audioUploader.setSessionId(this.sessionId)

            // è¨­å®šä¸Šå‚³å™¨äº‹ä»¶
            this.setupUploaderEvents()

            // é–‹å§‹éŒ„éŸ³ä¸¦å‚³å…¥æ®µè½è™•ç† callback
            await this.audioRecorder.start(async (segment) => {
                await this.handleAudioSegment(segment)
            })

            this.logSuccess(`MediaRecorder åˆå§‹åŒ–å®Œæˆä¸¦é–‹å§‹éŒ„éŸ³ - sessionId: ${this.sessionId}, chunkInterval: ${chunkInterval}ms`)
        } catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
            this.logWarning(`åˆå§‹åŒ– MediaRecorder å¤±æ•—: ${errorMessage}`)
            throw error
        }
    }

    // è‹¥æœ‰ sessionId è®Šå‹•éœ€æ±‚ï¼Œå¯åŠ ä¸Šï¼š
    private updateSessionId(newSessionId: string): void {
        this.sessionId = newSessionId
        this.recordingState.currentSessionId = newSessionId
        if (this.audioUploader) {
            this.audioUploader.setSessionId(newSessionId)
        }
    }
}

/**
 * SimpleRecordingService è©³ç´°ç‹€æ…‹ä»‹é¢
 */
export interface SimpleRecordingServiceStatus {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    timestamp: string
    recordingState: RecordingState
    audioSupport: {
        supported: boolean
        errors: string[]
    }
    audioRecorderState: string
    uploadStats: {
        uploaded: number
        failed: number
        cached: number
    }
}


# END FILE CONTENTS


# File: frontend/lib/migration-adapter.ts

"use client"

import { useEffect, useRef, useCallback } from "react"
import { AppData, AppState, SessionStatus, SessionType, TranscriptEntry } from "../types/app-state"
import { AppStateContextValue } from "../types/app-state-context"
import { isFeatureEnabled } from "./feature-flags"

// Legacy Hook ä»‹é¢å®šç¾©
export interface LegacyAppStateHook {
    appData: AppData
    isLoading: boolean
    error: string | null
    startRecording: (title?: string) => Promise<void>
    stopRecording: () => Promise<void>
    newNote: () => Promise<void>
    saveLocalDraft: (content: string) => void
    session: { id: string; status: SessionStatus; type: SessionType } | null
    recordingError: string | null
    transcriptError: string | null
    createNoteSession: (title?: string) => Promise<void>
    sessionLoading: boolean
}

// ç‹€æ…‹åŒæ­¥æ©‹æ¥å™¨
export class StateSyncBridge {
    private newContext: AppStateContextValue | null = null
    private legacyHook: LegacyAppStateHook | null = null
    private syncEnabled: boolean = true
    private lastSyncTimestamp: number = 0
    private syncInProgress: boolean = false

    constructor() {
        this.exposeToWindow()
    }

    // è¨»å†Šæ–° Context
    registerNewContext(context: AppStateContextValue): void {
        this.newContext = context
        console.log('ğŸ”„ [StateSyncBridge] æ–° Context å·²è¨»å†Š')
        this.performSync('new-context-registered')
    }

    // è¨»å†ŠèˆŠ Hook
    registerLegacyHook(hook: LegacyAppStateHook): void {
        this.legacyHook = hook
        console.log('ğŸ”„ [StateSyncBridge] èˆŠ Hook å·²è¨»å†Š')
        this.performSync('legacy-hook-registered')
    }

    // åŸ·è¡Œç‹€æ…‹åŒæ­¥
    private performSync(trigger: string): void {
        if (!this.syncEnabled || this.syncInProgress) return
        if (!this.newContext || !this.legacyHook) return

        this.syncInProgress = true
        const syncTimestamp = Date.now()

        try {
            // é¿å…éæ–¼é »ç¹çš„åŒæ­¥
            if (syncTimestamp - this.lastSyncTimestamp < 100) {
                this.syncInProgress = false
                return
            }

            console.log(`ğŸ”„ [StateSyncBridge] åŸ·è¡Œç‹€æ…‹åŒæ­¥ (è§¸ç™¼: ${trigger})`)

            // æ±ºå®šåŒæ­¥æ–¹å‘ï¼šæ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šèª°æ˜¯ä¸»è¦æ•¸æ“šæº
            const useNewAsSource = isFeatureEnabled('useNewStateManagement')

            if (useNewAsSource) {
                this.syncFromNewToLegacy()
            } else {
                this.syncFromLegacyToNew()
            }

            this.lastSyncTimestamp = syncTimestamp
        } catch (error) {
            console.error('ğŸ”„ [StateSyncBridge] åŒæ­¥å¤±æ•—:', error)
        } finally {
            this.syncInProgress = false
        }
    }

    // å¾æ–°ç³»çµ±åŒæ­¥åˆ°èˆŠç³»çµ±
    private syncFromNewToLegacy(): void {
        if (!this.newContext || !this.legacyHook) return

        const newData = this.newContext.appData
        const legacyData = this.legacyHook.appData

        // æª¢æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
        const needsSync = this.detectDifferences(newData, legacyData)

        if (needsSync.length > 0) {
            console.log('ğŸ”„ [StateSyncBridge] å¾æ–°ç³»çµ±åŒæ­¥åˆ°èˆŠç³»çµ±:', needsSync)
            // æ³¨æ„ï¼šé€™è£¡ä¸èƒ½ç›´æ¥ä¿®æ”¹ legacyDataï¼Œéœ€è¦é€é legacy hook çš„æ–¹æ³•
            // å¯¦éš›å¯¦ä½œæ™‚éœ€è¦æ ¹æ“š legacy hook çš„ API ä¾†åŒæ­¥
        }
    }

    // å¾èˆŠç³»çµ±åŒæ­¥åˆ°æ–°ç³»çµ±
    private syncFromLegacyToNew(): void {
        if (!this.newContext || !this.legacyHook) return

        const legacyData = this.legacyHook.appData
        const newData = this.newContext.appData

        // æª¢æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
        const needsSync = this.detectDifferences(legacyData, newData)

        if (needsSync.length > 0) {
            console.log('ğŸ”„ [StateSyncBridge] å¾èˆŠç³»çµ±åŒæ­¥åˆ°æ–°ç³»çµ±:', needsSync)

            // åŒæ­¥å„å€‹æ¬„ä½
            if (needsSync.includes('state')) {
                this.newContext.setState(legacyData.state)
            }
            if (needsSync.includes('isRecording')) {
                this.newContext.setRecording(legacyData.isRecording)
            }
            if (needsSync.includes('recordingTime')) {
                this.newContext.setRecordingTime(legacyData.recordingTime)
            }
            if (needsSync.includes('editorContent')) {
                this.newContext.setEditorContent(legacyData.editorContent)
            }
            if (needsSync.includes('transcriptEntries')) {
                this.newContext.setTranscriptEntries(legacyData.transcriptEntries)
            }
            if (needsSync.includes('session')) {
                this.newContext.setSession(legacyData.session || null)
            }
        }
    }

    // æª¢æ¸¬å…©å€‹ç‹€æ…‹ä¹‹é–“çš„å·®ç•°
    private detectDifferences(source: AppData, target: AppData): string[] {
        const differences: string[] = []

        if (source.state !== target.state) {
            differences.push('state')
        }
        if (source.isRecording !== target.isRecording) {
            differences.push('isRecording')
        }
        if (source.recordingTime !== target.recordingTime) {
            differences.push('recordingTime')
        }
        if (source.editorContent !== target.editorContent) {
            differences.push('editorContent')
        }
        if (source.transcriptEntries.length !== target.transcriptEntries.length) {
            differences.push('transcriptEntries')
        }
        if (JSON.stringify(source.session) !== JSON.stringify(target.session)) {
            differences.push('session')
        }

        return differences
    }

    // å•Ÿç”¨/åœç”¨åŒæ­¥
    enableSync(): void {
        this.syncEnabled = true
        console.log('ğŸ”„ [StateSyncBridge] ç‹€æ…‹åŒæ­¥å·²å•Ÿç”¨')
    }

    disableSync(): void {
        this.syncEnabled = false
        console.log('ğŸ”„ [StateSyncBridge] ç‹€æ…‹åŒæ­¥å·²åœç”¨')
    }

    // æ‰‹å‹•è§¸ç™¼åŒæ­¥
    manualSync(): void {
        this.performSync('manual-trigger')
    }

    // å–å¾—åŒæ­¥ç‹€æ…‹
    getSyncStatus(): { enabled: boolean; lastSync: number; inProgress: boolean } {
        return {
            enabled: this.syncEnabled,
            lastSync: this.lastSyncTimestamp,
            inProgress: this.syncInProgress,
        }
    }

    // æš´éœ²åˆ° window ä¾›èª¿è©¦ä½¿ç”¨
    private exposeToWindow(): void {
        if (typeof window !== 'undefined') {
            (window as any).stateSyncBridge = {
                enableSync: () => this.enableSync(),
                disableSync: () => this.disableSync(),
                manualSync: () => this.manualSync(),
                getStatus: () => this.getSyncStatus(),
            }

            console.log('ğŸ”„ [StateSyncBridge] èª¿è©¦ä»‹é¢å·²æš´éœ²åˆ° window.stateSyncBridge')
        }
    }
}

// å–®ä¾‹æ¨¡å¼
export const stateSyncBridge = new StateSyncBridge()

// Legacy Hook é©é…å™¨
export function useLegacyHookAdapter(legacyHook: LegacyAppStateHook): LegacyAppStateHook {
    const hasRegistered = useRef(false)

    useEffect(() => {
        if (!hasRegistered.current && isFeatureEnabled('enableStateSync')) {
            stateSyncBridge.registerLegacyHook(legacyHook)
            hasRegistered.current = true
        }
    }, [legacyHook])

    // å¦‚æœå•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç†ï¼Œè¿”å›é©é…å¾Œçš„ç‰ˆæœ¬
    if (isFeatureEnabled('useNewStateManagement')) {
        // TODO: è¿”å›é©é…å¾Œçš„ç‰ˆæœ¬ï¼Œé€™è£¡æš«æ™‚è¿”å›åŸç‰ˆæœ¬
        return legacyHook
    }

    return legacyHook
}

// New Context é©é…å™¨
export function useNewContextAdapter(newContext: AppStateContextValue): AppStateContextValue {
    const hasRegistered = useRef(false)

    useEffect(() => {
        if (!hasRegistered.current && isFeatureEnabled('enableStateSync')) {
            stateSyncBridge.registerNewContext(newContext)
            hasRegistered.current = true
        }
    }, [newContext])

    return newContext
}

// æ··åˆæ¨¡å¼ Hook - æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨å“ªå€‹ç³»çµ±
export function useHybridState(
    legacyHook: LegacyAppStateHook,
    newContext: AppStateContextValue
): LegacyAppStateHook {
    const useNew = isFeatureEnabled('useNewStateManagement')

    // è¨»å†Šåˆ°åŒæ­¥æ©‹æ¥å™¨
    useEffect(() => {
        if (isFeatureEnabled('enableStateSync')) {
            stateSyncBridge.registerLegacyHook(legacyHook)
            stateSyncBridge.registerNewContext(newContext)
        }
    }, [legacyHook, newContext])

    if (useNew) {
        // å°‡æ–° Context é©é…ç‚º Legacy Hook ä»‹é¢
        return {
            appData: newContext.appData,
            isLoading: newContext.isLoading,
            error: newContext.error,
            // TODO: å¯¦ä½œå…¶ä»–æ–¹æ³•çš„é©é…
            startRecording: legacyHook.startRecording,
            stopRecording: legacyHook.stopRecording,
            newNote: legacyHook.newNote,
            saveLocalDraft: legacyHook.saveLocalDraft,
            session: newContext.appData.session || null,
            recordingError: legacyHook.recordingError,
            transcriptError: legacyHook.transcriptError,
            createNoteSession: legacyHook.createNoteSession,
            sessionLoading: legacyHook.sessionLoading,
        }
    }

    return legacyHook
}


# END FILE CONTENTS


# File: app/services/azure_openai_v2.py

#!/usr/bin/env python3
"""
éŸ³è¨Šè½‰éŒ„æœå‹™ v2
ä½¿ç”¨å¤§åˆ‡ç‰‡ï¼ˆ10-15ç§’ï¼‰+ ç›´æ¥è½‰æ›çš„æ¶æ§‹ï¼Œé¿å…è¤‡é›œçš„ WebM åˆä½µ
"""

import asyncio
import logging
import subprocess
import tempfile
import time
from datetime import datetime
from pathlib import Path
from typing import Dict, Optional, Any, Set
from uuid import UUID
import json
import os
from asyncio import PriorityQueue, Semaphore

from openai import AsyncAzureOpenAI, RateLimitError
from httpx import Timeout

# Task 5: Prometheus ç›£æ§ä¾è³´
try:
    import prometheus_client as prom
    PROMETHEUS_AVAILABLE = True
except ImportError:
    PROMETHEUS_AVAILABLE = False
    logger.warning("prometheus-client æœªå®‰è£ï¼Œç›£æ§æŒ‡æ¨™å°‡è¢«åœç”¨")

from ..db.database import get_supabase_client
from app.core.config import settings
from app.core.ffmpeg import detect_audio_format
from app.core.webm_header_repairer import WebMHeaderRepairer
from app.ws.transcript_feed import manager as transcript_manager
from app.services.r2_client import R2Client

logger = logging.getLogger(__name__)

# Task 5: Prometheus ç›£æ§æŒ‡æ¨™
if PROMETHEUS_AVAILABLE:
    # è½‰éŒ„è«‹æ±‚è¨ˆæ•¸å™¨
    WHISPER_REQ_TOTAL = prom.Counter(
        "whisper_requests_total",
        "Total Whisper API requests",
        ["status", "deployment"]
    )

    # è½‰éŒ„å»¶é²æŒ‡æ¨™
    WHISPER_LATENCY_SECONDS = prom.Summary(
        "whisper_latency_seconds",
        "Whisper API latency",
        ["deployment"]
    )

    # éšŠåˆ—ç©å£“æŒ‡æ¨™
    WHISPER_BACKLOG_GAUGE = prom.Gauge(
        "whisper_backlog_size",
        "Current queue backlog size"
    )

    # éšŠåˆ—è™•ç†çµ±è¨ˆ
    QUEUE_PROCESSED_TOTAL = prom.Counter(
        "queue_processed_total",
        "Total processed jobs",
        ["status"]
    )

    # éšŠåˆ—ç­‰å¾…æ™‚é–“
    QUEUE_WAIT_SECONDS = prom.Summary(
        "queue_wait_seconds",
        "Time jobs spend waiting in queue"
    )

    # ä½µç™¼è™•ç†æ•¸é‡
    CONCURRENT_JOBS_GAUGE = prom.Gauge(
        "concurrent_transcription_jobs",
        "Current number of concurrent transcription jobs"
    )

    # æ»‘å‹•è¦–çª—å°ˆç”¨æŒ‡æ¨™
    SLIDING_WINDOW_PERMITS = prom.Gauge(
        "sliding_window_available_permits",
        "Available permits in sliding window rate limiter"
    )

    SLIDING_WINDOW_ACTIVE_REQUESTS = prom.Gauge(
        "sliding_window_active_requests",
        "Current active requests in sliding window"
    )

    SLIDING_WINDOW_QUEUE_TIME = prom.Summary(
        "sliding_window_queue_seconds",
        "Time spent waiting for sliding window permit"
    )

    API_QUOTA_UTILIZATION = prom.Gauge(
        "azure_api_quota_utilization_percent",
        "Azure API quota utilization percentage"
    )

    RATE_LIMITER_TYPE = prom.Gauge(
        "rate_limiter_type",
        "Type of rate limiter in use (0=traditional, 1=sliding_window)",
        ["limiter_type"]
    )

    # æ®µè½éæ¿¾æŒ‡æ¨™
    WHISPER_SEGMENTS_FILTERED = prom.Counter(
        "whisper_segments_filtered_total",
        "Total number of segments filtered by quality checks",
        ["reason", "deployment"]
    )

    logger.info("ğŸ“Š [Metrics] Prometheus ç›£æ§æŒ‡æ¨™å·²åˆå§‹åŒ–")
else:
    # å¦‚æœ Prometheus ä¸å¯ç”¨ï¼Œå‰µå»ºç©ºçš„ä½”ä½ç¬¦
    class NoOpMetric:
        def inc(self, *args, **kwargs): pass
        def set(self, *args, **kwargs): pass
        def time(self): return self
        def __enter__(self): return self
        def __exit__(self, *args): pass
        def labels(self, *args, **kwargs): return self

    WHISPER_REQ_TOTAL = NoOpMetric()
    WHISPER_LATENCY_SECONDS = NoOpMetric()
    WHISPER_BACKLOG_GAUGE = NoOpMetric()
    QUEUE_PROCESSED_TOTAL = NoOpMetric()
    QUEUE_WAIT_SECONDS = NoOpMetric()
    CONCURRENT_JOBS_GAUGE = NoOpMetric()
    SLIDING_WINDOW_PERMITS = NoOpMetric()
    SLIDING_WINDOW_ACTIVE_REQUESTS = NoOpMetric()
    SLIDING_WINDOW_QUEUE_TIME = NoOpMetric()
    API_QUOTA_UTILIZATION = NoOpMetric()
    RATE_LIMITER_TYPE = NoOpMetric()
    WHISPER_SEGMENTS_FILTERED = NoOpMetric()

# å…¨åŸŸæ•ˆèƒ½ç›£æ§é–‹é—œ
ENABLE_PERFORMANCE_LOGGING = os.getenv("ENABLE_PERFORMANCE_LOGGING", "true").lower() == "true"

# Task 1: å„ªåŒ–çš„ timeout é…ç½®
TIMEOUT = Timeout(connect=5, read=55, write=30, pool=5)

# Task 3: ä½µç™¼æ§åˆ¶èˆ‡ä»»å‹™å„ªå…ˆç´šé…ç½®ï¼ˆä½¿ç”¨settingsé…ç½®å€¼ï¼‰
# æ”¹ç‚ºå¾ settings å‹•æ…‹è®€å–ï¼Œæ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®
QUEUE_HIGH_PRIORITY = 0  # é‡è©¦ä»»å‹™é«˜å„ªå…ˆç´š
QUEUE_NORMAL_PRIORITY = 1  # æ­£å¸¸ä»»å‹™

# Task 4: éŸ³è¨Šæ®µè½é…ç½® - ç§»é™¤ç¡¬ç·¨ç¢¼ï¼Œä½¿ç”¨é…ç½®å€¼
# CHUNK_DURATION ç¾åœ¨åœ¨ç¬¬ 751 è¡Œå¾ settings.AUDIO_CHUNK_DURATION_SEC è®€å–
PROCESSING_TIMEOUT = 60  # è™•ç†è¶…æ™‚æ™‚é–“ï¼ˆç§’ï¼‰

class PerformanceTimer:
    """æ•ˆèƒ½è¨ˆæ™‚å™¨"""

    def __init__(self, operation_name: str):
        self.operation_name = operation_name
        self.start_time = None
        self.end_time = None

    def __enter__(self):
        self.start_time = time.time()
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.end_time = time.time()
        duration = self.get_duration()

        if ENABLE_PERFORMANCE_LOGGING:
            if duration > 1.0:  # è¨˜éŒ„è¶…é1ç§’çš„æ“ä½œ
                logger.warning(f"âš ï¸  {self.operation_name} took {duration:.2f}s (slow)")
            else:
                logger.info(f"â±ï¸  {self.operation_name} completed in {duration:.2f}s")

    def get_duration(self) -> float:
        if self.start_time and self.end_time:
            return self.end_time - self.start_time
        return 0.0

# Task 2: æ™ºèƒ½é »ç‡é™åˆ¶è™•ç†å™¨
class RateLimitHandler:
    """æ™ºèƒ½é »ç‡é™åˆ¶è™•ç†å™¨ - é¿å…éé•·ç­‰å¾…"""

    def __init__(self):
        self._delay = 0
        logger.info("ğŸš¦ [RateLimitHandler] é »ç‡é™åˆ¶è™•ç†å™¨å·²åˆå§‹åŒ–")

    async def wait(self):
        """ç­‰å¾…ç•¶å‰å»¶é²æ™‚é–“"""
        if self._delay:
            logger.info(f"â³ [RateLimitHandler] ç­‰å¾… {self._delay}s é¿å…é »ç‡é™åˆ¶")
            await asyncio.sleep(self._delay)

    def backoff(self):
        """å¢åŠ é€€é¿å»¶é²ï¼ˆæŒ‡æ•¸é€€é¿ï¼Œæœ€å¤§ 60 ç§’ï¼‰"""
        previous_delay = self._delay
        self._delay = min((self._delay or 5) * 2, 60)  # æœ€å¤§ 60 ç§’
        logger.warning(f"ğŸ“ˆ [RateLimitHandler] é€€é¿å»¶é²ï¼š{previous_delay}s â†’ {self._delay}s")

    def reset(self):
        """é‡ç½®å»¶é²ï¼ˆAPI å‘¼å«æˆåŠŸæ™‚ï¼‰"""
        if self._delay > 0:
            logger.info(f"âœ… [RateLimitHandler] é‡ç½®å»¶é²ï¼š{self._delay}s â†’ 0s")
            self._delay = 0

# æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶è™•ç†å™¨
class SlidingWindowRateLimiter:
    """æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶è™•ç†å™¨ - ç²¾ç¢ºæ§åˆ¶ API é…é¡ä½¿ç”¨"""

    def __init__(self, max_requests: int = 3, window_seconds: int = 60):
        """
        åˆå§‹åŒ–æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶å™¨

        Args:
            max_requests: æ»‘å‹•è¦–çª—å…§æœ€å¤§è«‹æ±‚æ•¸ï¼ˆé è¨­ 3ï¼‰
            window_seconds: æ»‘å‹•è¦–çª—æ™‚é–“é•·åº¦ï¼ˆé è¨­ 60 ç§’ï¼‰
        """
        self.max_requests = max_requests
        self.window_seconds = window_seconds
        self.semaphore = Semaphore(max_requests)
        self.active_requests = 0
        self.total_acquired = 0
        self.total_released = 0
        self._lock = asyncio.Lock()  # ä¿è­·çµ±è¨ˆæ•¸æ“šçš„ä¸€è‡´æ€§

        logger.info(f"ğŸªŸ [SlidingWindow] åˆå§‹åŒ–å®Œæˆï¼š{max_requests} requests/{window_seconds}s")

    async def acquire(self) -> None:
        """
        å–å¾— API å‘¼å«è¨±å¯

        ä½¿ç”¨ semaphore æ§åˆ¶ä½µç™¼æ•¸ï¼Œä¸¦é€šé call_later å¯¦ç¾æ»‘å‹•è¦–çª—è‡ªå‹•é‡‹æ”¾
        """
        logger.debug(f"ğŸ« [SlidingWindow] è«‹æ±‚è¨±å¯ï¼Œç•¶å‰æ´»èº: {self.active_requests}/{self.max_requests}")

        # è¨˜éŒ„ç­‰å¾…é–‹å§‹æ™‚é–“ï¼ˆç”¨æ–¼ Prometheus æŒ‡æ¨™ï¼‰
        wait_start_time = time.time()

        # ç­‰å¾… semaphore è¨±å¯
        await self.semaphore.acquire()

        # è¨ˆç®—ç­‰å¾…æ™‚é–“ä¸¦æ›´æ–° Prometheus æŒ‡æ¨™
        wait_duration = time.time() - wait_start_time
        SLIDING_WINDOW_QUEUE_TIME.observe(wait_duration)

        # æ›´æ–°çµ±è¨ˆæ•¸æ“šï¼ˆä½¿ç”¨é–ä¿è­·ï¼‰
        async with self._lock:
            self.active_requests += 1
            self.total_acquired += 1

        # æ›´æ–° Prometheus æŒ‡æ¨™
        SLIDING_WINDOW_ACTIVE_REQUESTS.set(self.active_requests)
        SLIDING_WINDOW_PERMITS.set(self.max_requests - self.active_requests)

        # æ›´æ–°é…é¡åˆ©ç”¨ç‡æŒ‡æ¨™
        utilization = (self.active_requests / self.max_requests) * 100
        API_QUOTA_UTILIZATION.set(utilization)

        # å®‰æ’ window_seconds å¾Œè‡ªå‹•é‡‹æ”¾è¨±å¯
        try:
            loop = asyncio.get_event_loop()
            loop.call_later(self.window_seconds, self._release_permit)
            logger.debug(f"âœ… [SlidingWindow] è¨±å¯å·²å–å¾—ï¼Œæ´»èºè«‹æ±‚: {self.active_requests}, å°‡åœ¨ {self.window_seconds}s å¾Œè‡ªå‹•é‡‹æ”¾")
        except Exception as e:
            # å¦‚æœ call_later å¤±æ•—ï¼Œç«‹å³é‡‹æ”¾è¨±å¯é¿å…æ­»é–
            logger.error(f"âŒ [SlidingWindow] call_later è¨­å®šå¤±æ•—: {e}")
            self.semaphore.release()
            async with self._lock:
                self.active_requests = max(0, self.active_requests - 1)
            # å›æ»¾ Prometheus æŒ‡æ¨™
            SLIDING_WINDOW_ACTIVE_REQUESTS.set(self.active_requests)
            SLIDING_WINDOW_PERMITS.set(self.max_requests - self.active_requests)
            utilization = (self.active_requests / self.max_requests) * 100
            API_QUOTA_UTILIZATION.set(utilization)
            raise

    def _release_permit(self) -> None:
        """
        é‡‹æ”¾è¨±å¯ï¼ˆç§æœ‰æ–¹æ³•ï¼Œç”± call_later èª¿ç”¨ï¼‰

        æ³¨æ„ï¼šæ­¤æ–¹æ³•åœ¨äº‹ä»¶å¾ªç’°çš„å›èª¿ä¸­åŸ·è¡Œï¼Œå¿…é ˆæ˜¯åŒæ­¥çš„
        """
        try:
            self.semaphore.release()

            # æ›´æ–°çµ±è¨ˆæ•¸æ“šï¼ˆæ³¨æ„ï¼šæ­¤è™•ç„¡æ³•ä½¿ç”¨ async lockï¼‰
            # ä½¿ç”¨åŸå­æ“ä½œç¢ºä¿ä¸€è‡´æ€§
            self.active_requests = max(0, self.active_requests - 1)
            self.total_released += 1

            # æ›´æ–° Prometheus æŒ‡æ¨™
            SLIDING_WINDOW_ACTIVE_REQUESTS.set(self.active_requests)
            SLIDING_WINDOW_PERMITS.set(self.max_requests - self.active_requests)

            # æ›´æ–°é…é¡åˆ©ç”¨ç‡æŒ‡æ¨™
            utilization = (self.active_requests / self.max_requests) * 100
            API_QUOTA_UTILIZATION.set(utilization)

            logger.debug(f"ğŸ« [SlidingWindow] è¨±å¯å·²è‡ªå‹•é‡‹æ”¾ï¼Œæ´»èºè«‹æ±‚: {self.active_requests}")
        except Exception as e:
            logger.error(f"âŒ [SlidingWindow] é‡‹æ”¾è¨±å¯æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")

    async def wait(self) -> None:
        """
        ç­‰å¾…è¨±å¯ï¼ˆç›¸å®¹æ–¼ RateLimitHandler ä»‹é¢ï¼‰

        æ­¤æ–¹æ³•æä¾›èˆ‡ç¾æœ‰ RateLimitHandler.wait() ç›¸åŒçš„ä»‹é¢
        """
        await self.acquire()

    def get_stats(self) -> dict:
        """
        ç²å–æ»‘å‹•è¦–çª—çµ±è¨ˆè³‡è¨Š

        Returns:
            dict: åŒ…å«ç•¶å‰ç‹€æ…‹çš„çµ±è¨ˆè³‡è¨Š
        """
        return {
            'type': 'sliding_window',
            'max_requests': self.max_requests,
            'window_seconds': self.window_seconds,
            'active_requests': self.active_requests,
            'available_permits': self.max_requests - self.active_requests,
            'total_acquired': self.total_acquired,
            'total_released': self.total_released,
            'utilization_percent': (self.active_requests / self.max_requests) * 100 if self.max_requests > 0 else 0,
            'is_at_capacity': self.active_requests >= self.max_requests
        }

    def reset(self) -> None:
        """
        é‡ç½®çµ±è¨ˆæ•¸æ“šï¼ˆä¿æŒèˆ‡ RateLimitHandler ä»‹é¢ä¸€è‡´ï¼‰

        æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸æœƒå½±éŸ¿ç•¶å‰çš„ semaphore ç‹€æ…‹æˆ–æ´»èºè«‹æ±‚
        """
        logger.info(f"ğŸ”„ [SlidingWindow] é‡ç½®çµ±è¨ˆæ•¸æ“š")
        self.total_acquired = 0
        self.total_released = 0

    def backoff(self) -> None:
        """
        é€€é¿è™•ç†ï¼ˆç›¸å®¹æ–¼ RateLimitHandler ä»‹é¢ï¼‰

        å°æ–¼æ»‘å‹•è¦–çª— Rate Limiterï¼Œé€€é¿å¯¦éš›ä¸Šæ˜¯ç”±è‡ªå‹•æ’éšŠæ©Ÿåˆ¶è™•ç†ï¼Œ
        æ­¤æ–¹æ³•ä¸»è¦ç”¨æ–¼è¨˜éŒ„å’Œçµ±è¨ˆç›®çš„
        """
        logger.warning(f"ğŸš¦ [SlidingWindow] é‡åˆ° 429 éŒ¯èª¤ï¼Œæ»‘å‹•è¦–çª—å°‡è‡ªå‹•è™•ç†é€€é¿")

    @property
    def _delay(self) -> int:
        """
        æ¨¡æ“¬å»¶é²å±¬æ€§ï¼ˆç›¸å®¹æ–¼ RateLimitHandler ä»‹é¢ï¼‰

        å°æ–¼æ»‘å‹•è¦–çª—ï¼Œ"å»¶é²"æ¦‚å¿µæ˜¯åŸºæ–¼å¯ç”¨è¨±å¯æ•¸é‡è¨ˆç®—çš„é ä¼°ç­‰å¾…æ™‚é–“
        """
        if self.active_requests >= self.max_requests:
            # å¦‚æœå·²é”å®¹é‡ä¸Šé™ï¼Œä¼°ç®—éœ€è¦ç­‰å¾…çš„æ™‚é–“
            return max(1, self.window_seconds // 4)  # ä¼°ç®—ç­‰å¾…æ™‚é–“
        return 0

    def __str__(self) -> str:
        """å­—ä¸²è¡¨ç¤º"""
        return f"SlidingWindowRateLimiter({self.max_requests}/{self.window_seconds}s, active={self.active_requests})"

    def __repr__(self) -> str:
        """è©³ç´°å­—ä¸²è¡¨ç¤º"""
        return f"SlidingWindowRateLimiter(max_requests={self.max_requests}, window_seconds={self.window_seconds}, active_requests={self.active_requests})"

# Task 3: è½‰éŒ„ä»»å‹™ä½‡åˆ—ç®¡ç†å™¨
class TranscriptionQueueManager:
    """å„ªå…ˆç´šéšŠåˆ—ç®¡ç†å™¨ - ç¢ºä¿é †åºè™•ç†ä¸¦é¿å…ç©å£“"""

    def __init__(self):
        # å„ªå…ˆç´šéšŠåˆ— (priority, timestamp, job_data)
        self.queue: PriorityQueue = PriorityQueue(maxsize=settings.MAX_QUEUE_SIZE)
        # ä½µç™¼æ§åˆ¶ä¿¡è™Ÿé‡ï¼ˆä½¿ç”¨é…ç½®å€¼ï¼‰
        self.semaphore = Semaphore(settings.MAX_CONCURRENT_TRANSCRIPTIONS)
        # Worker ä»»å‹™
        self.workers: list[asyncio.Task] = []
        # Task 4: ç©å£“ç›£æ§ä»»å‹™
        self.backlog_monitor_task: Optional[asyncio.Task] = None
        # çµ±è¨ˆæ•¸æ“š
        self.total_processed = 0
        self.total_failed = 0
        self.total_retries = 0
        # Task 4: ç©å£“é–¾å€¼å’Œç›£æ§é–“éš”ï¼ˆä½¿ç”¨é…ç½®å€¼ï¼‰
        self.backlog_threshold = settings.QUEUE_BACKLOG_THRESHOLD
        self.monitor_interval = settings.QUEUE_MONITOR_INTERVAL
        self.last_backlog_alert = 0  # ä¸Šæ¬¡ç©å£“è­¦å ±æ™‚é–“
        self.backlog_alert_cooldown = settings.QUEUE_ALERT_COOLDOWN
        # é‹è¡Œç‹€æ…‹
        self.is_running = False

        logger.info(f"ğŸ¯ [QueueManager] åˆå§‹åŒ–å®Œæˆï¼šmax_concurrent={settings.MAX_CONCURRENT_TRANSCRIPTIONS}, max_queue={settings.MAX_QUEUE_SIZE}")

    async def start_workers(self, num_workers: int = None):
        """å•Ÿå‹• Worker ä»»å‹™"""
        if self.is_running:
            logger.warning("âš ï¸ [QueueManager] Workers already running")
            return

        # ä½¿ç”¨é…ç½®å€¼ä½œç‚ºé»˜èªå€¼
        if num_workers is None:
            num_workers = settings.TRANSCRIPTION_WORKERS_COUNT

        self.is_running = True
        logger.info(f"ğŸš€ [QueueManager] å•Ÿå‹• {num_workers} å€‹ Workersï¼ˆé…ç½®å€¼ï¼š{settings.TRANSCRIPTION_WORKERS_COUNT}ï¼‰")

        # å•Ÿå‹•å·¥ä½œç·šç¨‹
        for i in range(num_workers):
            worker_task = asyncio.create_task(self._worker(f"Worker-{i+1}"))
            self.workers.append(worker_task)

        # Task 4: å•Ÿå‹•ç©å£“ç›£æ§
        self.backlog_monitor_task = asyncio.create_task(self._backlog_monitor())
        logger.info("ğŸ“Š [QueueManager] ç©å£“ç›£æ§å·²å•Ÿå‹•")

    async def stop_workers(self):
        """åœæ­¢æ‰€æœ‰ Workers"""
        if not self.is_running:
            return

        logger.info("â¹ï¸ [QueueManager] åœæ­¢æ‰€æœ‰ Workers")
        self.is_running = False

        # Task 4: åœæ­¢ç©å£“ç›£æ§
        if self.backlog_monitor_task:
            self.backlog_monitor_task.cancel()
            try:
                await self.backlog_monitor_task
            except asyncio.CancelledError:
                pass

        # å–æ¶ˆæ‰€æœ‰ worker ä»»å‹™
        for worker in self.workers:
            worker.cancel()

        # ç­‰å¾…æ‰€æœ‰ä»»å‹™å®Œæˆ
        await asyncio.gather(*self.workers, return_exceptions=True)
        self.workers.clear()

    async def enqueue_job(self, session_id: UUID, chunk_sequence: int, webm_data: bytes, priority: int = QUEUE_NORMAL_PRIORITY):
        """å°‡è½‰éŒ„ä»»å‹™åŠ å…¥éšŠåˆ—"""
        timestamp = time.time()
        job_data = {
            'session_id': session_id,
            'chunk_sequence': chunk_sequence,
            'webm_data': webm_data,
            'timestamp': timestamp,
            'retry_count': 0
        }

        try:
            # ä½¿ç”¨ put_nowait é¿å…é˜»å¡ï¼Œå¦‚æœéšŠåˆ—æ»¿äº†æœƒæ‹‹å‡ºç•°å¸¸
            self.queue.put_nowait((priority, timestamp, job_data))

            # Task 5: æ›´æ–°éšŠåˆ—å¤§å°æŒ‡æ¨™
            queue_size = self.queue.qsize()
            WHISPER_BACKLOG_GAUGE.set(queue_size)

            priority_name = "HIGH" if priority == QUEUE_HIGH_PRIORITY else "NORMAL"
            logger.info(f"ğŸ“¥ [QueueManager] ä»»å‹™å·²å…¥éšŠï¼šsession={session_id}, chunk={chunk_sequence}, priority={priority_name}, queue_size={queue_size}")

        except asyncio.QueueFull:
            logger.error(f"âŒ [QueueManager] éšŠåˆ—å·²æ»¿ ({settings.MAX_QUEUE_SIZE})ï¼Œä¸Ÿæ£„ä»»å‹™ï¼šsession={session_id}, chunk={chunk_sequence}")
            # å¯ä»¥è€ƒæ…®å»£æ’­éšŠåˆ—æ»¿çš„éŒ¯èª¤åˆ°å‰ç«¯
            await self._broadcast_queue_full_error(session_id, chunk_sequence)
            raise Exception(f"Transcription queue is full ({settings.MAX_QUEUE_SIZE}), please try again later")

    async def _worker(self, worker_name: str):
        """Worker å”ç¨‹ - è™•ç†éšŠåˆ—ä¸­çš„ä»»å‹™"""
        logger.info(f"ğŸ‘· [QueueManager] {worker_name} é–‹å§‹å·¥ä½œ")

        while self.is_running:
            try:
                # ç­‰å¾…ä»»å‹™
                try:
                    priority, timestamp, job_data = await asyncio.wait_for(
                        self.queue.get(),
                        timeout=1.0  # 1ç§’è¶…æ™‚ï¼Œè®“ worker èƒ½å®šæœŸæª¢æŸ¥é‹è¡Œç‹€æ…‹
                    )
                except asyncio.TimeoutError:
                    continue  # è¶…æ™‚å¾Œç¹¼çºŒæª¢æŸ¥é‹è¡Œç‹€æ…‹

                # æª¢æŸ¥ä»»å‹™æ˜¯å¦éæœŸ
                age = time.time() - timestamp
                if age > settings.QUEUE_TIMEOUT_SECONDS:
                    logger.warning(f"â° [QueueManager] {worker_name} ä¸Ÿæ£„éæœŸä»»å‹™ï¼šage={age:.1f}s, session={job_data['session_id']}, chunk={job_data['chunk_sequence']}")
                    self.queue.task_done()
                    continue

                # Task 5: è¨˜éŒ„éšŠåˆ—ç­‰å¾…æ™‚é–“
                wait_time = time.time() - timestamp
                QUEUE_WAIT_SECONDS.observe(wait_time)

                # ç²å–ä½µç™¼æ§åˆ¶æ¬Š
                async with self.semaphore:
                    session_id = job_data['session_id']
                    chunk_sequence = job_data['chunk_sequence']

                    logger.info(f"ğŸ”§ [QueueManager] {worker_name} è™•ç†ä»»å‹™ï¼šsession={session_id}, chunk={chunk_sequence}, age={age:.1f}s, wait={wait_time:.1f}s")

                    try:
                        # åŸ·è¡Œè½‰éŒ„
                        result = await self._process_transcription_job(job_data)

                        if result is True:
                            self.total_processed += 1
                            # Task 5: è¨˜éŒ„æˆåŠŸè™•ç†çš„ä»»å‹™
                            QUEUE_PROCESSED_TOTAL.labels(status="success").inc()
                            logger.info(f"âœ… [QueueManager] {worker_name} ä»»å‹™å®Œæˆï¼šsession={session_id}, chunk={chunk_sequence}")
                        elif result == "filtered":
                            self.total_processed += 1
                            # Task 5: è¨˜éŒ„è¢«éæ¿¾çš„ä»»å‹™
                            QUEUE_PROCESSED_TOTAL.labels(status="filtered").inc()
                            logger.info(f"ğŸ”‡ [QueueManager] {worker_name} ä»»å‹™è¢«éæ¿¾ï¼ˆéœéŸ³ï¼‰ï¼Œè·³éé‡è©¦ï¼šsession={session_id}, chunk={chunk_sequence}")
                        else:
                            # è™•ç†å¤±æ•—ï¼Œæ±ºå®šæ˜¯å¦é‡è©¦
                            # Task 5: è¨˜éŒ„å¤±æ•—è™•ç†çš„ä»»å‹™
                            QUEUE_PROCESSED_TOTAL.labels(status="failed").inc()
                            await self._handle_job_failure(job_data, worker_name)

                    except Exception as e:
                        logger.error(f"ğŸ’¥ [QueueManager] {worker_name} ä»»å‹™ç•°å¸¸ï¼šsession={session_id}, chunk={chunk_sequence}, error={e}")
                        # Task 5: è¨˜éŒ„ç•°å¸¸è™•ç†çš„ä»»å‹™
                        QUEUE_PROCESSED_TOTAL.labels(status="exception").inc()
                        await self._handle_job_failure(job_data, worker_name)

                # æ¨™è¨˜ä»»å‹™å®Œæˆ
                self.queue.task_done()

            except Exception as e:
                logger.error(f"ğŸ’¥ [QueueManager] {worker_name} Worker ç•°å¸¸ï¼š{e}")
                await asyncio.sleep(1)  # çŸ­æš«ä¼‘æ¯å¾Œç¹¼çºŒ

        logger.info(f"ğŸ‘· [QueueManager] {worker_name} åœæ­¢å·¥ä½œ")

    async def _process_transcription_job(self, job_data: dict) -> bool:
        """è™•ç†å–®å€‹è½‰éŒ„ä»»å‹™"""
        session_id = job_data['session_id']
        chunk_sequence = job_data['chunk_sequence']
        webm_data = job_data['webm_data']

        try:
            # ç²å–è½‰éŒ„æœå‹™
            service = await initialize_transcription_service_v2()
            if not service:
                logger.error(f"âŒ [QueueManager] è½‰éŒ„æœå‹™ä¸å¯ç”¨ï¼šsession={session_id}, chunk={chunk_sequence}")
                return False

            # åŸ·è¡Œè½‰éŒ„
            result = await service._transcribe_audio(webm_data, session_id, chunk_sequence)
            if result:
                # æª¢æŸ¥æ˜¯å¦ç‚ºè¢«éæ¿¾çš„çµæœ
                if isinstance(result, dict) and result.get("filtered"):
                    logger.info(f"ğŸ”‡ [QueueManager] Chunk {chunk_sequence} è¢«éœéŸ³éæ¿¾ï¼Œè·³éé‡è©¦ï¼šsession={session_id}")
                    return "filtered"  # è¿”å›ç‰¹æ®Šæ¨™è¨˜ï¼Œè¡¨ç¤ºä¸éœ€è¦é‡è©¦
                else:
                    # å„²å­˜ä¸¦å»£æ’­æ­£å¸¸çµæœ
                    await service._save_and_push_result(session_id, chunk_sequence, result)
                    return True
            else:
                logger.warning(f"âš ï¸ [QueueManager] è½‰éŒ„ç„¡çµæœï¼šsession={session_id}, chunk={chunk_sequence}")
                return False

        except RateLimitError as e:
            logger.warning(f"ğŸš¦ [é »ç‡é™åˆ¶] Chunk {chunk_sequence} é‡åˆ° 429 éŒ¯èª¤ï¼š{str(e)}")
            # æ³¨æ„ï¼šé€™è£¡ä¸èª¿ç”¨ rate_limit.backoff()ï¼Œå› ç‚ºå®ƒæ˜¯åœ¨è½‰éŒ„æœå‹™ä¸­è™•ç†çš„
            return False
        except Exception as e:
            logger.error(f"âŒ [QueueManager] è½‰éŒ„å¤±æ•—ï¼šsession={session_id}, chunk={chunk_sequence}, error={e}")
            return False

    async def _handle_job_failure(self, job_data: dict, worker_name: str):
        """è™•ç†ä»»å‹™å¤±æ•—ï¼ˆæš«æ™‚ä¸ Retryï¼‰"""
        session_id = job_data['session_id']
        chunk_sequence = job_data['chunk_sequence']
        # retry_count = job_data.get('retry_count', 0)

        # ç›´æ¥è¨˜éŒ„å¤±æ•—ï¼Œä¸å†é‡è©¦
        self.total_failed += 1
        logger.error(f"âŒ [QueueManager] {worker_name} ä»»å‹™æœ€çµ‚å¤±æ•—ï¼šsession={session_id}, chunk={chunk_sequence}, no_retry")

        # å»£æ’­æœ€çµ‚å¤±æ•—é€šçŸ¥
        await self._broadcast_final_failure(session_id, chunk_sequence)

    async def _broadcast_queue_full_error(self, session_id: UUID, chunk_sequence: int):
        """å»£æ’­éšŠåˆ—æ»¿éŒ¯èª¤"""
        try:
            error_data = {
                "type": "transcription_error",
                "error_type": "queue_full",
                "message": f"è½‰éŒ„éšŠåˆ—å·²æ»¿ ({settings.MAX_QUEUE_SIZE})ï¼Œè«‹ç¨å¾Œé‡è©¦",
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "timestamp": datetime.utcnow().isoformat()
            }
            await transcript_manager.broadcast(
                json.dumps(error_data),
                str(session_id)
            )
        except Exception as e:
            logger.error(f"Failed to broadcast queue full error: {e}")

    async def _broadcast_final_failure(self, session_id: UUID, chunk_sequence: int):
        """å»£æ’­æœ€çµ‚å¤±æ•—é€šçŸ¥"""
        try:
            error_data = {
                "type": "transcription_error",
                "error_type": "final_failure",
                "message": f"æ®µè½ {chunk_sequence} è½‰éŒ„æœ€çµ‚å¤±æ•—ï¼Œå·²é”æœ€å¤§é‡è©¦æ¬¡æ•¸",
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "timestamp": datetime.utcnow().isoformat()
            }
            await transcript_manager.broadcast(
                json.dumps(error_data),
                str(session_id)
            )
        except Exception as e:
            logger.error(f"Failed to broadcast final failure: {e}")

    # Task 4: ç©å£“ç›£æ§å™¨
    async def _backlog_monitor(self):
        """ç©å£“ç›£æ§å”ç¨‹ - å®šæœŸæª¢æŸ¥éšŠåˆ—ç©å£“ä¸¦é€šçŸ¥å‰ç«¯"""
        logger.info("ğŸ“Š [BacklogMonitor] ç©å£“ç›£æ§é–‹å§‹")

        while self.is_running:
            try:
                queue_size = self.queue.qsize()
                current_time = time.time()

                # æª¢æŸ¥æ˜¯å¦è¶…éç©å£“é–¾å€¼
                if queue_size > self.backlog_threshold:
                    # æª¢æŸ¥å†·å»æ™‚é–“ï¼Œé¿å…é »ç¹é€šçŸ¥
                    if current_time - self.last_backlog_alert > self.backlog_alert_cooldown:
                        await self._broadcast_backlog_alert(queue_size)
                        self.last_backlog_alert = current_time
                        logger.warning(f"âš ï¸ [BacklogMonitor] éšŠåˆ—ç©å£“è­¦å ±ï¼šqueue_size={queue_size}, threshold={self.backlog_threshold}")

                # è¨˜éŒ„éšŠåˆ—ç‹€æ…‹ï¼ˆèª¿è©¦ç”¨ï¼‰
                if queue_size > 0:
                    logger.debug(f"ğŸ“Š [BacklogMonitor] éšŠåˆ—ç‹€æ…‹ï¼šsize={queue_size}, processed={self.total_processed}, failed={self.total_failed}")

                # ç­‰å¾…ä¸‹æ¬¡æª¢æŸ¥
                await asyncio.sleep(self.monitor_interval)

            except Exception as e:
                logger.error(f"ğŸ’¥ [BacklogMonitor] ç›£æ§ç•°å¸¸ï¼š{e}")
                await asyncio.sleep(self.monitor_interval)

        logger.info("ğŸ“Š [BacklogMonitor] ç©å£“ç›£æ§åœæ­¢")

    async def _broadcast_backlog_alert(self, queue_size: int):
        """å»£æ’­ç©å£“è­¦å ±åˆ°æ‰€æœ‰æ´»èºæœƒè©±"""
        try:
            # è¨ˆç®—é ä¼°ç­‰å¾…æ™‚é–“
            estimated_wait_minutes = (queue_size * 12) // 60  # å‡è¨­æ¯å€‹ä»»å‹™å¹³å‡ 12 ç§’

            alert_data = {
                "event": "stt_backlog",
                "type": "backlog_alert",
                "queue_size": queue_size,
                "threshold": self.backlog_threshold,
                "estimated_wait_minutes": estimated_wait_minutes,
                "message": f"è½‰éŒ„éšŠåˆ—ç©å£“ï¼š{queue_size} å€‹ä»»å‹™ç­‰å¾…è™•ç†ï¼Œé ä¼°å»¶é² {estimated_wait_minutes} åˆ†é˜",
                "timestamp": datetime.utcnow().isoformat(),
                "level": "warning" if queue_size < self.backlog_threshold * 2 else "critical"
            }

            # å»£æ’­åˆ°æ‰€æœ‰æ´»èºé€£æ¥
            active_connections = getattr(transcript_manager, 'active_connections', {})
            if active_connections:
                broadcast_message = json.dumps(alert_data)

                # å»£æ’­åˆ°æ‰€æœ‰æœƒè©±
                for session_id in list(active_connections.keys()):
                    try:
                        await transcript_manager.broadcast(broadcast_message, session_id)
                    except Exception as e:
                        logger.warning(f"Failed to broadcast backlog alert to session {session_id}: {e}")

                logger.info(f"ğŸ“¢ [BacklogMonitor] ç©å£“è­¦å ±å·²å»£æ’­åˆ° {len(active_connections)} å€‹æœƒè©±")
            else:
                logger.debug("ğŸ“¢ [BacklogMonitor] ç„¡æ´»èºæœƒè©±ï¼Œè·³éç©å£“è­¦å ±å»£æ’­")

        except Exception as e:
            logger.error(f"Failed to broadcast backlog alert: {e}")

    async def _broadcast_queue_recovery(self, queue_size: int):
        """å»£æ’­éšŠåˆ—æ¢å¾©æ­£å¸¸é€šçŸ¥"""
        try:
            recovery_data = {
                "event": "stt_recovery",
                "type": "queue_recovery",
                "queue_size": queue_size,
                "message": f"è½‰éŒ„éšŠåˆ—å·²æ¢å¾©æ­£å¸¸ï¼šç•¶å‰ {queue_size} å€‹ä»»å‹™",
                "timestamp": datetime.utcnow().isoformat(),
                "level": "info"
            }

            # å»£æ’­åˆ°æ‰€æœ‰æ´»èºé€£æ¥
            active_connections = getattr(transcript_manager, 'active_connections', {})
            if active_connections:
                broadcast_message = json.dumps(recovery_data)

                for session_id in list(active_connections.keys()):
                    try:
                        await transcript_manager.broadcast(broadcast_message, session_id)
                    except Exception as e:
                        logger.warning(f"Failed to broadcast recovery to session {session_id}: {e}")

                logger.info(f"ğŸ“¢ [BacklogMonitor] æ¢å¾©é€šçŸ¥å·²å»£æ’­åˆ° {len(active_connections)} å€‹æœƒè©±")

        except Exception as e:
            logger.error(f"Failed to broadcast queue recovery: {e}")

    def get_stats(self) -> dict:
        """ç²å–éšŠåˆ—çµ±è¨ˆä¿¡æ¯"""
        queue_size = self.queue.qsize()
        return {
            'queue_size': queue_size,
            'max_queue_size': settings.MAX_QUEUE_SIZE,
            'total_processed': self.total_processed,
            'total_failed': self.total_failed,
            'total_retries': self.total_retries,
            'workers_count': len(self.workers),
            'is_running': self.is_running,
            # Task 4: ç©å£“ç›£æ§çµ±è¨ˆ
            'backlog_threshold': self.backlog_threshold,
            'is_backlogged': queue_size > self.backlog_threshold,
            'monitor_interval': self.monitor_interval,
            'last_backlog_alert': self.last_backlog_alert,
            'estimated_wait_seconds': queue_size * 12 if queue_size > 0 else 0
        }

# é…ç½®å¸¸æ•¸
CHUNK_DURATION = settings.AUDIO_CHUNK_DURATION_SEC  # å¾é…ç½®è®€å–åˆ‡ç‰‡æ™‚é•·
PROCESSING_TIMEOUT = 30  # è™•ç†è¶…æ™‚ï¼ˆç§’ï¼‰
MAX_RETRIES = 3  # æœ€å¤§é‡è©¦æ¬¡æ•¸

# å…¨åŸŸé›†åˆè¿½è¹¤å·²å»£æ’­ active ç›¸ä½çš„ session
_active_phase_sent: Set[str] = set()

# Rate Limiter å·¥å» å‡½æ•¸
def get_rate_limiter():
    """
    Rate Limiter å·¥å» å‡½æ•¸ - æ ¹æ“šé…ç½®é¸æ“‡é©ç•¶çš„é »ç‡é™åˆ¶ç­–ç•¥

    Returns:
        RateLimitHandler æˆ– SlidingWindowRateLimiter å¯¦ä¾‹
    """
    if settings.USE_SLIDING_WINDOW_RATE_LIMIT:
        logger.info(f"ğŸªŸ [é…ç½®] ä½¿ç”¨æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶ï¼š{settings.SLIDING_WINDOW_MAX_REQUESTS} requests/{settings.SLIDING_WINDOW_SECONDS}s")

        # æ›´æ–° Rate Limiter é¡å‹æŒ‡æ¨™
        RATE_LIMITER_TYPE.labels(limiter_type="sliding_window").set(1)
        RATE_LIMITER_TYPE.labels(limiter_type="traditional").set(0)

        return SlidingWindowRateLimiter(
            max_requests=settings.SLIDING_WINDOW_MAX_REQUESTS,
            window_seconds=settings.SLIDING_WINDOW_SECONDS
        )
    else:
        logger.info("ğŸš¦ [é…ç½®] ä½¿ç”¨å‚³çµ±æŒ‡æ•¸é€€é¿é »ç‡é™åˆ¶")

        # æ›´æ–° Rate Limiter é¡å‹æŒ‡æ¨™
        RATE_LIMITER_TYPE.labels(limiter_type="traditional").set(1)
        RATE_LIMITER_TYPE.labels(limiter_type="sliding_window").set(0)

        return RateLimitHandler()

# å…¨åŸŸé »ç‡é™åˆ¶è™•ç†å™¨ï¼ˆå‹•æ…‹é¸æ“‡ï¼‰
rate_limit = get_rate_limiter()

# Task 3: å…¨åŸŸéšŠåˆ—ç®¡ç†å™¨
queue_manager = TranscriptionQueueManager()

class SimpleAudioTranscriptionService:
    """ç°¡åŒ–çš„éŸ³è¨Šè½‰éŒ„æœå‹™"""

    def __init__(self, azure_client: AsyncAzureOpenAI, deployment_name: str):
        self.client = azure_client
        self.deployment_name = deployment_name
        self.processing_tasks: Dict[str, asyncio.Task] = {}

    def _keep(self, segment: dict) -> bool:
        """
        æ ¹æ“š Whisper verbose_json å›æ‡‰åˆ¤æ–·æ˜¯å¦ä¿ç•™è½‰éŒ„æ®µè½

        ä½¿ç”¨ no_speech_probã€avg_logprobã€compression_ratio ç­‰æŒ‡æ¨™éæ¿¾å¹»è¦ºå…§å®¹

        Args:
            segment: Whisper verbose_json æ ¼å¼çš„æ®µè½è³‡æ–™

        Returns:
            bool: True è¡¨ç¤ºä¿ç•™æ®µè½ï¼ŒFalse è¡¨ç¤ºéæ¿¾æ‰
        """
        try:
            # æª¢æŸ¥å¿…è¦æ¬„ä½æ˜¯å¦å­˜åœ¨
            required_fields = ['no_speech_prob', 'avg_logprob', 'compression_ratio']
            for field in required_fields:
                if field not in segment:
                    logger.warning(f"ğŸ” [æ®µè½éæ¿¾] æ®µè½ç¼ºå°‘å¿…è¦æ¬„ä½ '{field}'ï¼Œéæ¿¾æ‰")
                    WHISPER_SEGMENTS_FILTERED.labels(
                        reason="missing_field",
                        deployment=self.deployment_name
                    ).inc()
                    return False

            # æå–éæ¿¾æŒ‡æ¨™
            no_speech_prob = segment['no_speech_prob']
            avg_logprob = segment['avg_logprob']
            compression_ratio = segment['compression_ratio']

            # éæ¿¾æ¢ä»¶ 1: éœéŸ³æª¢æ¸¬ - no_speech_prob éé«˜
            if no_speech_prob >= settings.FILTER_NO_SPEECH:
                logger.debug(f"ğŸ”‡ [æ®µè½éæ¿¾] éœéŸ³æ©Ÿç‡éé«˜: {no_speech_prob:.3f} >= {settings.FILTER_NO_SPEECH}")
                WHISPER_SEGMENTS_FILTERED.labels(
                    reason="no_speech",
                    deployment=self.deployment_name
                ).inc()
                return False

            # éæ¿¾æ¢ä»¶ 2: ç½®ä¿¡åº¦æª¢æ¸¬ - avg_logprob éä½
            if avg_logprob < settings.FILTER_LOGPROB:
                logger.debug(f"ğŸ“‰ [æ®µè½éæ¿¾] ç½®ä¿¡åº¦éä½: {avg_logprob:.3f} < {settings.FILTER_LOGPROB}")
                WHISPER_SEGMENTS_FILTERED.labels(
                    reason="low_confidence",
                    deployment=self.deployment_name
                ).inc()
                return False

            # éæ¿¾æ¢ä»¶ 3: é‡è¤‡å…§å®¹æª¢æ¸¬ - compression_ratio éé«˜
            if compression_ratio > settings.FILTER_COMPRESSION:
                logger.debug(f"ğŸ”„ [æ®µè½éæ¿¾] é‡è¤‡æ¯”ç‡éé«˜: {compression_ratio:.3f} > {settings.FILTER_COMPRESSION}")
                WHISPER_SEGMENTS_FILTERED.labels(
                    reason="high_compression",
                    deployment=self.deployment_name
                ).inc()
                return False

            # æ‰€æœ‰æª¢æŸ¥é€šéï¼Œä¿ç•™æ®µè½
            logger.debug(f"âœ… [æ®µè½éæ¿¾] æ®µè½å“è³ªè‰¯å¥½ï¼Œä¿ç•™")
            logger.debug(f"   - éœéŸ³æ©Ÿç‡: {no_speech_prob:.3f} < {settings.FILTER_NO_SPEECH}")
            logger.debug(f"   - ç½®ä¿¡åº¦: {avg_logprob:.3f} >= {settings.FILTER_LOGPROB}")
            logger.debug(f"   - é‡è¤‡æ¯”ç‡: {compression_ratio:.3f} <= {settings.FILTER_COMPRESSION}")
            return True

        except Exception as e:
            logger.error(f"âŒ [æ®µè½éæ¿¾] éæ¿¾é‚è¼¯ç•°å¸¸: {e}")
            # ç•°å¸¸æƒ…æ³ä¸‹é è¨­éæ¿¾æ‰ï¼Œé¿å…ç”¢å‡ºéŒ¯èª¤å…§å®¹
            WHISPER_SEGMENTS_FILTERED.labels(
                reason="filter_error",
                deployment=self.deployment_name
            ).inc()
            return False

    # def _get_header_repairer(self) -> WebMHeaderRepairer:
    #     """å»¶é²åˆå§‹åŒ– WebM æª”é ­ä¿®å¾©å™¨ - å·²åœç”¨ï¼Œä¸å†éœ€è¦æª”é ­ä¿®å¾©"""
    #     if self._header_repairer is None:
    #         self._header_repairer = WebMHeaderRepairer()
    #     return self._header_repairer

    # def _extract_and_cache_header(self, session_id: str, chunk_0_data: bytes) -> bool:
    #     """æª”é ­æå–å’Œç·©å­˜ - å·²åœç”¨ï¼Œæ¯å€‹ chunk éƒ½æœ‰å®Œæ•´æª”é ­"""
    #     # ä¸å†éœ€è¦ï¼Œæ¯å€‹ chunk éƒ½åŒ…å«å®Œæ•´ WebM Header
    #     return True

    # def _get_cached_header(self, session_id: str) -> Optional[bytes]:
    #     """ç²å–ç·©å­˜æª”é ­ - å·²åœç”¨ï¼Œä¸å†éœ€è¦æª”é ­ç·©å­˜"""
    #     # ä¸å†éœ€è¦ï¼Œæ¯å€‹ chunk éƒ½åŒ…å«å®Œæ•´ WebM Header
    #     return None

    # def _clear_session_cache(self, session_id: str) -> None:
    #     """æ¸…ç†æœƒè©±ç·©å­˜ - å·²åœç”¨"""
    #     # ä¸å†éœ€è¦ç·©å­˜
    #     pass

    # def _cleanup_expired_cache(self) -> None:
    #     """æ¸…ç†éæœŸç·©å­˜ - å·²åœç”¨"""
    #     # ä¸å†éœ€è¦ç·©å­˜ç®¡ç†
    #     pass

    async def process_audio_chunk(self, session_id: UUID, chunk_sequence: int, webm_data: bytes) -> bool:
        """
        è™•ç†å–®ä¸€éŸ³è¨Šåˆ‡ç‰‡ - Task 3: ä½¿ç”¨éšŠåˆ—ç³»çµ±

        Args:
            session_id: æœƒè©± ID
            chunk_sequence: åˆ‡ç‰‡åºè™Ÿ
            webm_data: WebM éŸ³è¨Šæ•¸æ“š

        Returns:
            bool: è™•ç†æ˜¯å¦æˆåŠŸï¼ˆå…¥éšŠæˆåŠŸå³è¦–ç‚ºæˆåŠŸï¼‰
        """
        try:
            logger.info(f"ğŸš€ [TranscriptionService] æäº¤è½‰éŒ„ä»»å‹™ï¼šsession={session_id}, chunk={chunk_sequence}, size={len(webm_data)} bytes")

            # Task 3: å°‡ä»»å‹™æäº¤åˆ°éšŠåˆ—è€Œéç›´æ¥è™•ç†
            await queue_manager.enqueue_job(session_id, chunk_sequence, webm_data)

            # è¿”å› True è¡¨ç¤ºæˆåŠŸæäº¤åˆ°éšŠåˆ—
            return True

        except Exception as e:
            logger.error(f"âŒ [TranscriptionService] æäº¤ä»»å‹™å¤±æ•—ï¼šsession={session_id}, chunk={chunk_sequence}, error={e}")
            return False

    async def _process_chunk_async(self, session_id: UUID, chunk_sequence: int, webm_data: bytes):
        """éåŒæ­¥è™•ç†éŸ³è¨Šåˆ‡ç‰‡ (WebM ç›´æ¥è½‰éŒ„æ¶æ§‹ v2 + æª”é ­ä¿®å¾©)"""
        try:
            with PerformanceTimer(f"Process chunk {chunk_sequence} for session {session_id}"):
                session_id_str = str(session_id)
                logger.info(f"ï¿½ï¿½ [WebM ç›´æ¥è½‰éŒ„] é–‹å§‹è™•ç†éŸ³è¨Šåˆ‡ç‰‡ {chunk_sequence} (session: {session_id}, size: {len(webm_data)} bytes)")

                # æ­¥é©Ÿ 1: é©—è­‰å’Œä¿®å¾© WebM æ•¸æ“šï¼ˆæ•´åˆæª”é ­ä¿®å¾©é‚è¼¯ï¼‰
                processed_webm_data = await self._validate_and_repair_webm_data(session_id, chunk_sequence, webm_data)
                if processed_webm_data is None:
                    logger.error(f"âŒ [é©—è­‰å¤±æ•—] Chunk {chunk_sequence} é©—è­‰å¤±æ•—ï¼Œè·³éè™•ç†")
                    return

                # æ­¥é©Ÿ 3: WebM ç›´æ¥è½‰éŒ„ (ä½¿ç”¨ä¿®å¾©å¾Œçš„æ•¸æ“š)
                logger.info(f"âš¡ [æ¶æ§‹å„ªåŒ–] è·³é FFmpeg è½‰æ›ï¼Œç›´æ¥è½‰éŒ„ WebM (chunk {chunk_sequence})")
                transcript_result = await self._transcribe_audio(processed_webm_data, session_id, chunk_sequence)
                if not transcript_result:
                    logger.error(f"Failed to transcribe WebM chunk {chunk_sequence}")
                    return

                # æ­¥é©Ÿ 4: å„²å­˜ä¸¦æ¨é€çµæœ
                await self._save_and_push_result(session_id, chunk_sequence, transcript_result)

                logger.info(f"âœ… æˆåŠŸè™•ç†éŸ³è¨Šåˆ‡ç‰‡ {chunk_sequence}: '{transcript_result.get('text', '')[:50]}...'")

        except Exception as e:
            logger.error(f"Error processing chunk {chunk_sequence} for session {session_id}: {e}", exc_info=True)

    async def _validate_and_repair_webm_data(self, session_id: UUID, chunk_sequence: int, webm_data: bytes) -> Optional[bytes]:
        """
        ç°¡åŒ–çš„ WebM æ•¸æ“šé©—è­‰ï¼ˆå„ªåŒ–å¾Œæ¶æ§‹ï¼‰

        ç”±æ–¼ SegmentedAudioRecorder æ¯å€‹ chunk éƒ½åŒ…å«å®Œæ•´ WebM Headerï¼Œ
        ä¸å†éœ€è¦è¤‡é›œçš„æª”é ­ä¿®å¾©é‚è¼¯ï¼Œåªéœ€åŸºæœ¬é©—è­‰å³å¯ã€‚

        Args:
            session_id: æœƒè©± ID
            chunk_sequence: åˆ‡ç‰‡åºè™Ÿ
            webm_data: åŸå§‹ WebM éŸ³è¨Šæ•¸æ“š

        Returns:
            Optional[bytes]: é©—è­‰å¾Œçš„ WebM æ•¸æ“šï¼Œé©—è­‰å¤±æ•—æ™‚è¿”å› None
        """
        start_time = time.time()

        try:
            # æ­¥é©Ÿ 1: åŸºæœ¬æ•¸æ“šé©—è­‰
            if not webm_data or len(webm_data) < 50:
                logger.warning(f"WebM chunk {chunk_sequence} too small: {len(webm_data) if webm_data else 0} bytes")
                return None

            # æ­¥é©Ÿ 2: ç°¡åŒ–é©—è­‰ - æ¯å€‹ chunk éƒ½æ‡‰è©²æœ‰å®Œæ•´æª”é ­
            logger.debug(f"ğŸ¯ [ç°¡åŒ–é©—è­‰] Chunk {chunk_sequence} æ•¸æ“šå¤§å°: {len(webm_data)} bytes (session: {session_id})")

            # æª¢æŸ¥æ˜¯å¦ç‚º WebM æ ¼å¼ï¼ˆç°¡å–®æª¢æŸ¥ EBML headerï¼‰
            if webm_data[:4] == b'\x1A\x45\xDF\xA3':
                logger.debug(f"âœ… [æª”é ­æª¢æŸ¥] Chunk {chunk_sequence} åŒ…å«å®Œæ•´ WebM EBML header")
            else:
                logger.warning(f"âš ï¸ [æª”é ­æª¢æŸ¥] Chunk {chunk_sequence} å¯èƒ½ä¸æ˜¯æ¨™æº– WebM æ ¼å¼ï¼Œä½†ç¹¼çºŒè™•ç†")

            # æ­¥é©Ÿ 3: æ•ˆèƒ½çµ±è¨ˆ
            total_time = (time.time() - start_time) * 1000  # ms
            logger.debug(f"ğŸ“Š [ç°¡åŒ–è™•ç†] Chunk {chunk_sequence} é©—è­‰å®Œæˆ - ç¸½è¨ˆ: {total_time:.1f}ms")

            # æ•ˆèƒ½è­¦å‘Šï¼ˆæ‡‰è©²å¾ˆå¿«ï¼‰
            if total_time > 10:  # è¶…é10msè­¦å‘Šï¼ˆç°¡åŒ–å¾Œæ‡‰è©²æ›´å¿«ï¼‰
                logger.warning(f"âš ï¸ [æ•ˆèƒ½è­¦å‘Š] Chunk {chunk_sequence} ç°¡åŒ–é©—è­‰æ™‚é–“éé•·: {total_time:.1f}ms")

            return webm_data  # ç›´æ¥è¿”å›åŸå§‹æ•¸æ“š

        except Exception as e:
            logger.error(f"âŒ [ç°¡åŒ–é©—è­‰] Chunk {chunk_sequence} è™•ç†ç•°å¸¸: {e}")
            return webm_data  # é™ç´šä½¿ç”¨åŸå§‹æ•¸æ“š

    async def _convert_webm_to_wav(self, webm_data: bytes, chunk_sequence: int, session_id: UUID) -> Optional[bytes]:
        """
        å°‡ WebM / fMP4 è½‰æ›ç‚º WAV (ä¿ç•™ç”¨æ–¼æœ€çµ‚ä¸‹è¼‰æª”æ¡ˆ)

        æ³¨æ„ï¼šåœ¨ WebM ç›´æ¥è½‰éŒ„æ¶æ§‹ v2 ä¸­ï¼Œæ­¤æ–¹æ³•ä¸å†ç”¨æ–¼å³æ™‚è½‰éŒ„æµç¨‹ï¼Œ
        è€Œæ˜¯ä¿ç•™ä½œç‚ºæœ€çµ‚åŒ¯å‡ºæ™‚ç”Ÿæˆ WAV æª”æ¡ˆçš„å‚™é¸æ–¹æ¡ˆã€‚
        """

        async def _broadcast_error(error_type: str, error_message: str, details: str = None):
            """é€é WebSocket å»£æ’­éŒ¯èª¤è¨Šæ¯åˆ°å‰ç«¯"""
            try:
                from app.ws.transcript_feed import manager as transcript_manager

                # ç”ŸæˆéŸ³æª”è¨ºæ–·è³‡è¨Š
                hex_header = webm_data[:32].hex(' ', 8).upper() if webm_data else "ç„¡æ•¸æ“š"
                audio_format = detect_audio_format(webm_data)

                # æ ¹æ“šæª¢æ¸¬åˆ°çš„æ ¼å¼æä¾›å»ºè­°
                def get_format_suggestion(audio_format: str) -> str:
                    suggestions = {
                        'fmp4': 'å»ºè­°æª¢æŸ¥ç€è¦½å™¨éŒ„éŸ³è¨­å®šï¼Œæˆ–å˜—è©¦ä½¿ç”¨ WebM æ ¼å¼',
                        'mp4': 'å»ºè­°ç¢ºèªéŸ³æª”å®Œæ•´æ€§ï¼Œæˆ–å˜—è©¦ä½¿ç”¨ WebM æ ¼å¼',
                        'webm': 'å»ºè­°æª¢æŸ¥ WebM ç·¨ç¢¼å™¨è¨­å®š',
                        'unknown': 'å»ºè­°æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´éŸ³è¨ŠéŒ„è£½ï¼Œæˆ–å˜—è©¦é‡æ–°æ•´ç†é é¢'
                    }
                    return suggestions.get(audio_format, 'å»ºè­°æª¢æŸ¥éŸ³æª”æ ¼å¼æ˜¯å¦æ”¯æ´')

                error_data = {
                    "type": "conversion_error",
                    "error_type": error_type,
                    "message": error_message,
                    "details": details,
                    "session_id": str(session_id),
                    "chunk_sequence": chunk_sequence,
                    "timestamp": datetime.utcnow().isoformat(),
                    "diagnostics": {
                        "detected_format": audio_format,
                        "file_size": len(webm_data) if webm_data else 0,
                        "header_hex": hex_header,
                        "suggestion": get_format_suggestion(audio_format)
                    }
                }
                await transcript_manager.broadcast(
                    json.dumps(error_data),
                    str(session_id)
                )
                logger.info(f"ğŸš¨ [éŒ¯èª¤å»£æ’­] å·²é€šçŸ¥å‰ç«¯è½‰æ›éŒ¯èª¤: {error_type}")
                logger.debug(f"   - æ ¼å¼è¨ºæ–·: {audio_format}, å¤§å°: {len(webm_data) if webm_data else 0} bytes")
                logger.debug(f"   - é ­éƒ¨æ•¸æ“š: {hex_header}")
            except Exception as e:
                logger.error(f"Failed to broadcast error message: {e}")

        try:
            audio_format = detect_audio_format(webm_data)
            logger.info(f"ğŸµ [æ ¼å¼æª¢æ¸¬] æª¢æ¸¬åˆ°éŸ³æª”æ ¼å¼: {audio_format} (chunk {chunk_sequence}, å¤§å°: {len(webm_data)} bytes)")

            with PerformanceTimer(f"{audio_format.upper()} to WAV conversion for chunk {chunk_sequence}"):

                # åŸºæœ¬ FFmpeg åƒæ•¸
                cmd = ['ffmpeg']

                # ä¾ä¾†æºæ ¼å¼æ±ºå®šè¼¸å…¥åƒæ•¸
                if audio_format == 'mp4':
                    # Safari ç”¢å‡ºçš„ fragmented MP4 - è®“ FFmpeg è‡ªå‹•æª¢æ¸¬æ ¼å¼
                    # ä¸æŒ‡å®š -f åƒæ•¸ï¼Œèƒ½æ›´å¥½è™•ç†å„ç¨® MP4 è®Šé«”
                    pass
                elif audio_format == 'webm':
                    cmd += ['-f', 'webm']
                elif audio_format == 'ogg':
                    cmd += ['-f', 'ogg']
                elif audio_format == 'wav':
                    cmd += ['-f', 'wav']

                # é€šç”¨æ——æ¨™ï¼šç”Ÿæˆæ™‚é–“æˆ³è™•ç†ä¸å®Œæ•´æµ
                cmd += ['-fflags', '+genpts', '-i', 'pipe:0', '-ac', '1', '-ar', '16000', '-f', 'wav', '-y', 'pipe:1']

                logger.debug(f"ğŸ”§ [FFmpeg] åŸ·è¡Œå‘½ä»¤: {' '.join(cmd)}")

                process = await asyncio.create_subprocess_exec(
                    *cmd,
                    stdin=asyncio.subprocess.PIPE,
                    stdout=asyncio.subprocess.PIPE,
                    stderr=asyncio.subprocess.PIPE
                )

                stdout, stderr = await asyncio.wait_for(
                    process.communicate(input=webm_data),
                    timeout=PROCESSING_TIMEOUT
                )

                if process.returncode != 0:
                    error_msg = stderr.decode('utf-8', errors='ignore') if stderr else "Unknown error"
                    logger.error(f"âŒ [FFmpeg éŒ¯èª¤] è½‰æ›å¤±æ•— chunk {chunk_sequence}")
                    logger.error(f"   - æ ¼å¼: {audio_format}")
                    logger.error(f"   - è¿”å›ç¢¼: {process.returncode}")
                    logger.error(f"   - éŒ¯èª¤è¨Šæ¯: {error_msg}")
                    logger.error(f"   - è¼¸å…¥å¤§å°: {len(webm_data)} bytes")

                    # å¢å¼·éŒ¯èª¤åˆ†æï¼Œç‰¹åˆ¥é‡å° fragmented MP4 éŒ¯èª¤
                    if "could not find corresponding trex" in error_msg.lower():
                        error_reason = "Fragmented MP4 æ ¼å¼éŒ¯èª¤ï¼šç¼ºå°‘ Track Extends (trex) ç›’ï¼Œéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„ movflags åƒæ•¸"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. æª¢æ¸¬åˆ° fragmented MP4 æ ¼å¼ï¼Œå»ºè­°é‡æ–°æ•´ç†é é¢\n"
                            "2. å¦‚æœå•é¡ŒæŒçºŒï¼Œè«‹å˜—è©¦ä½¿ç”¨ä¸åŒç€è¦½å™¨\n"
                            "3. Safari ç”¨æˆ¶å»ºè­°åˆ‡æ›è‡³ Chrome æˆ– Firefox"
                        )
                    elif "trun track id unknown" in error_msg.lower():
                        error_reason = "Fragmented MP4 è¿½è¹¤ ID éŒ¯èª¤ï¼šTrack Run (trun) ç›’ä¸­çš„è»Œé“ ID ç„¡æ³•è­˜åˆ¥"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. é€™æ˜¯ fragmented MP4 ç‰¹æœ‰éŒ¯èª¤\n"
                            "2. å»ºè­°é‡æ–°éŒ„éŸ³æˆ–é‡å•Ÿç€è¦½å™¨\n"
                            "3. è€ƒæ…®é™ä½éŒ„éŸ³å“è³ªè¨­å®š"
                        )
                    elif "Invalid data found when processing input" in error_msg:
                        error_reason = f"éŸ³æª”æ ¼å¼ {audio_format} èˆ‡ FFmpeg ä¸å…¼å®¹ï¼Œå¯èƒ½æ˜¯ç·¨ç¢¼å•é¡Œ"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. æª¢æŸ¥éŸ³æª”æ˜¯å¦å®Œæ•´ä¸‹è¼‰\n"
                            "2. ç¢ºèªç€è¦½å™¨éŒ„éŸ³æ ¼å¼è¨­å®š\n"
                            "3. å˜—è©¦é‡æ–°é–‹å§‹éŒ„éŸ³"
                        )
                    elif "No such file or directory" in error_msg:
                        error_reason = "FFmpeg ç¨‹å¼æœªæ‰¾åˆ°æˆ–é…ç½®éŒ¯èª¤"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. è«‹è¯ç¹«æŠ€è¡“æ”¯æ´\n"
                            "2. é€™æ˜¯ä¼ºæœå™¨é…ç½®å•é¡Œ"
                        )
                    elif "Permission denied" in error_msg:
                        error_reason = "FFmpeg æ¬Šé™ä¸è¶³"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. è«‹è¯ç¹«æŠ€è¡“æ”¯æ´\n"
                            "2. é€™æ˜¯ä¼ºæœå™¨æ¬Šé™å•é¡Œ"
                        )
                    else:
                        error_reason = f"FFmpeg è™•ç† {audio_format} æ ¼å¼æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. å˜—è©¦é‡æ–°éŒ„éŸ³\n"
                            "2. æª¢æŸ¥ç¶²è·¯é€£ç·šæ˜¯å¦ç©©å®š\n"
                            "3. å¦‚æœå•é¡ŒæŒçºŒï¼Œè«‹è¯ç¹«æŠ€è¡“æ”¯æ´"
                        )

                    # è¨˜éŒ„è©³ç´°è¨ºæ–·è³‡è¨Š
                    logger.error(f"   - è¨ºæ–·çµæœ: {error_reason}")
                    logger.error(f"   - å»ºè­°æ–¹æ¡ˆ: {detailed_suggestion}")

                    await _broadcast_error("ffmpeg_conversion_failed", error_reason, detailed_suggestion)
                    return None

                if not stdout or len(stdout) < 100:
                    error_msg = f"FFmpeg ç”¢ç”Ÿçš„ WAV æ•¸æ“šä¸è¶³: {len(stdout) if stdout else 0} bytes"
                    logger.error(f"âŒ [FFmpeg è­¦å‘Š] {error_msg}")
                    await _broadcast_error("insufficient_output", "è½‰æ›å¾Œçš„éŸ³æª”æ•¸æ“šä¸è¶³ï¼Œå¯èƒ½æ˜¯éœéŸ³æˆ–æå£", error_msg)
                    return None

                logger.info(f"âœ… [FFmpeg æˆåŠŸ] {audio_format.upper()} ({len(webm_data)} bytes) â†’ WAV ({len(stdout)} bytes)")
                return stdout

        except asyncio.TimeoutError:
            error_msg = f"FFmpeg è½‰æ›è¶…æ™‚ (>{PROCESSING_TIMEOUT}ç§’)"
            logger.error(f"â° [FFmpeg è¶…æ™‚] {error_msg}")
            await _broadcast_error("conversion_timeout", "éŸ³æª”è½‰æ›è™•ç†æ™‚é–“éé•·", error_msg)
            return None
        except Exception as e:
            error_msg = f"FFmpeg è½‰æ›ç•°å¸¸: {str(e)}"
            logger.error(f"ğŸ’¥ [FFmpeg ç•°å¸¸] {error_msg}")
            await _broadcast_error("conversion_exception", "éŸ³æª”è½‰æ›éç¨‹ä¸­ç™¼ç”Ÿç•°å¸¸éŒ¯èª¤", error_msg)
            return None

    async def _transcribe_audio(self, webm_data: bytes, session_id: UUID, chunk_sequence: int) -> Optional[Dict[str, Any]]:
        """ä½¿ç”¨ Azure OpenAI Whisper ç›´æ¥è½‰éŒ„ WebM éŸ³è¨Š (ç°¡åŒ–: åªè™•ç† text)"""
        from app.services.stt.factory import get_provider
        alt_provider = get_provider(session_id)
        if alt_provider and alt_provider.name() != "whisper":
            return await alt_provider.transcribe(webm_data, session_id, chunk_sequence)

        await rate_limit.wait()
        CONCURRENT_JOBS_GAUGE.inc()

        try:
            with WHISPER_LATENCY_SECONDS.labels(deployment=self.deployment_name).time():
                with PerformanceTimer(f"Whisper WebM transcription for chunk {chunk_sequence}"):
                    with tempfile.NamedTemporaryFile(suffix='.webm', delete=False) as temp_file:
                        temp_file.write(webm_data)
                        temp_file.flush()
                        try:
                            with open(temp_file.name, 'rb') as audio_file:
                                transcript = await self.client.audio.transcriptions.create(
                                    model=self.deployment_name,
                                    file=audio_file,
                                    language=getattr(settings, 'WHISPER_LANGUAGE', 'zh'),
                                    response_format="json",
                                    temperature=0
                                )
                            Path(temp_file.name).unlink(missing_ok=True)

                            # åªè™•ç† {"text": ...} çµæœ
                            text = getattr(transcript, "text", None) or (transcript.get("text") if isinstance(transcript, dict) else None)
                            if not text or not text.strip():
                                WHISPER_REQ_TOTAL.labels(status="empty", deployment=self.deployment_name).inc()
                                return None
                            combined_text = text.strip()

                            # API å‘¼å«æˆåŠŸï¼Œé‡ç½®é »ç‡é™åˆ¶å»¶é²
                            rate_limit.reset()
                            WHISPER_REQ_TOTAL.labels(status="success", deployment=self.deployment_name).inc()

                            return {
                                "text": combined_text,
                                "chunk_sequence": chunk_sequence,
                                "session_id": str(session_id),
                                "timestamp": datetime.utcnow().isoformat(),
                                "language": getattr(settings, 'WHISPER_LANGUAGE', 'zh-TW'),
                                "start_offset": 0.0,
                                "end_offset": settings.AUDIO_CHUNK_DURATION_SEC
                            }
                        finally:
                            Path(temp_file.name).unlink(missing_ok=True)
        except RateLimitError as e:
            logger.warning(f"ğŸš¦ [é »ç‡é™åˆ¶] Chunk {chunk_sequence} é‡åˆ° 429 éŒ¯èª¤ï¼š{str(e)}")
            rate_limit.backoff()
            WHISPER_REQ_TOTAL.labels(status="rate_limit", deployment=self.deployment_name).inc()
            if isinstance(rate_limit, SlidingWindowRateLimiter):
                stats = rate_limit.get_stats()
                if stats['is_at_capacity']:
                    error_msg = f"API é…é¡å·²æ»¿ï¼ˆ{stats['active_requests']}/{stats['max_requests']}ï¼‰ï¼Œè«‹ç­‰å¾…ç´„ {rate_limit._delay}s"
                else:
                    error_msg = f"API é »ç‡é™åˆ¶ï¼Œæ»‘å‹•è¦–çª—æ’éšŠè™•ç†ä¸­ï¼ˆ{stats['available_permits']} å€‹è¨±å¯å¯ç”¨ï¼‰"
            else:
                error_msg = f"API é »ç‡é™åˆ¶ï¼Œå°‡åœ¨ {rate_limit._delay}s å¾Œé‡è©¦"
            await self._broadcast_transcription_error(
                session_id,
                chunk_sequence,
                "rate_limit_error",
                error_msg
            )
            return None
        except Exception as e:
            logger.error(f"WebM direct transcription failed for chunk {chunk_sequence}: {e}")
            WHISPER_REQ_TOTAL.labels(status="error", deployment=self.deployment_name).inc()
            await self._broadcast_transcription_error(session_id, chunk_sequence, "whisper_api_error", f"Azure OpenAI Whisper WebM è½‰éŒ„å¤±æ•—: {str(e)}")
            return None
        finally:
            CONCURRENT_JOBS_GAUGE.dec()

    async def _save_and_push_result(self, session_id: UUID, chunk_sequence: int, transcript_result: Dict[str, Any]):
        """å„²å­˜è½‰éŒ„çµæœä¸¦æ¨é€åˆ°å‰ç«¯"""
        try:
            supabase = get_supabase_client()
            session_response = supabase.table("sessions").select("started_at").eq("id", str(session_id)).limit(1).execute()
            started_at = None
            if session_response.data and session_response.data[0].get('started_at'):
                started_at = session_response.data[0]['started_at']
            chunk_start_seconds = chunk_sequence * settings.AUDIO_CHUNK_DURATION_SEC
            start_time = chunk_start_seconds + transcript_result.get('start_offset', 0)
            end_time = chunk_start_seconds + transcript_result.get('end_offset', settings.AUDIO_CHUNK_DURATION_SEC)
            if started_at:
                logger.info(
                    f"ğŸ• [æ™‚é–“è¨ˆç®— v2] ç²¾ç¢ºé–‹å§‹æ™‚é–“: {started_at}, "
                    f"chunk={chunk_sequence}, chunk_start={chunk_start_seconds}s, "
                    f"offset=({transcript_result.get('start_offset', 0)}s-{transcript_result.get('end_offset', 0)}s) â†’ "
                    f"absolute=({start_time}s-{end_time}s)"
                )
            else:
                logger.info(
                    f"ğŸ• [æ™‚é–“è¨ˆç®— v2] æœªæª¢æ¸¬åˆ° started_atï¼Œä½¿ç”¨ fallback ç›¸å°æ™‚é–“ã€‚" \
                    f"chunk={chunk_sequence}, chunk_start={chunk_start_seconds}s, " \
                    f"offset=({transcript_result.get('start_offset', 0)}s-{transcript_result.get('end_offset', 0)}s) â†’ " \
                    f"relative=({start_time}s-{end_time}s)"
                )
            segment_data = {
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "text": transcript_result['text'],
                "start_time": start_time,
                "end_time": end_time,
                "confidence": 1.0,
                "lang_code": transcript_result.get('language', 'zh-TW'),
                "created_at": transcript_result['timestamp']
            }
            response = supabase.table("transcript_segments").insert(segment_data).execute()
            if response.data:
                segment_id = response.data[0]['id']
                logger.debug(f"Saved transcript segment {segment_id} for chunk {chunk_sequence}")
                if str(session_id) not in _active_phase_sent:
                    logger.info(f"ğŸš€ [è½‰éŒ„æ¨é€] é¦–æ¬¡å»£æ’­ active ç›¸ä½åˆ° session {session_id}")
                    await transcript_manager.broadcast(
                        json.dumps({"phase": "active"}),
                        str(session_id)
                    )
                    _active_phase_sent.add(str(session_id))
                    logger.info(f"âœ… [è½‰éŒ„æ¨é€] Active ç›¸ä½å»£æ’­å®Œæˆ for session {session_id}")
                transcript_message = {
                    "type": "transcript_segment",
                    "session_id": str(session_id),
                    "segment_id": segment_id,
                    "text": transcript_result['text'],
                    "chunk_sequence": chunk_sequence,
                    "start_sequence": chunk_sequence,
                    "start_time": segment_data['start_time'],
                    "end_time": segment_data['end_time'],
                    "confidence": segment_data['confidence'],
                    "timestamp": segment_data['created_at']
                }
                logger.info(f"ğŸ“¡ [è½‰éŒ„æ¨é€] å»£æ’­é€å­—ç¨¿ç‰‡æ®µåˆ° session {session_id}:")
                logger.info(f"   - æ–‡å­—: '{transcript_result['text'][:50]}{'...' if len(transcript_result['text']) > 50 else ''}'")
                logger.info(f"   - åºè™Ÿ: {chunk_sequence}")
                logger.info(f"   - æ™‚é–“: {segment_data['start_time']}s - {segment_data['end_time']}s")
                await transcript_manager.broadcast(
                    json.dumps(transcript_message),
                    str(session_id)
                )
                logger.info(f"âœ… [è½‰éŒ„æ¨é€] é€å­—ç¨¿ç‰‡æ®µå»£æ’­å®Œæˆ for session {session_id}")
                logger.info(f"å»£æ’­è½‰éŒ„å®Œæˆè¨Šæ¯åˆ° session {session_id}")
                await transcript_manager.broadcast(
                    json.dumps({
                        "type": "transcript_complete",
                        "session_id": str(session_id),
                        "message": "Transcription completed for the batch."
                    }),
                    str(session_id)
                )
                logger.info(f"è½‰éŒ„ä»»å‹™å®Œæˆ for session: {session_id}, chunk: {chunk_sequence}")
        except Exception as e:
            logger.error(f"Failed to save/push transcript for chunk {chunk_sequence}: {e}")
            await self._broadcast_transcription_error(session_id, chunk_sequence, "database_error", f"è³‡æ–™åº«æ“ä½œå¤±æ•—: {str(e)}")

    async def _broadcast_transcription_error(self, session_id: UUID, chunk_sequence: int, error_type: str, error_message: str):
        """å»£æ’­è½‰éŒ„éŒ¯èª¤åˆ°å‰ç«¯"""
        try:
            from app.ws.transcript_feed import manager as transcript_manager
            error_data = {
                "type": "transcription_error",
                "error_type": error_type,
                "message": error_message,
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "timestamp": datetime.utcnow().isoformat()
            }
            await transcript_manager.broadcast(
                json.dumps(error_data),
                str(session_id)
            )
            logger.info(f"ğŸš¨ [è½‰éŒ„éŒ¯èª¤å»£æ’­] å·²é€šçŸ¥å‰ç«¯è½‰éŒ„éŒ¯èª¤: {error_type}")
        except Exception as e:
            logger.error(f"Failed to broadcast transcription error: {e}")

    # TODO: åœ¨æ­¤è™•å¯¦ç¾æ›´å„ªé›…çš„é—œé–‰é‚è¼¯
    logger.info("Transcription service is shutting down...")

# ----------------------
# å…¼å®¹èˆŠæ¸¬è©¦çš„å·¥å» å‡½å¼èˆ‡å…¨åŸŸè®Šæ•¸
# ----------------------

_transcription_service_v2: Optional[SimpleAudioTranscriptionService] = None


def get_azure_openai_client() -> Optional[AsyncAzureOpenAI]:
    """Task 1: å»ºç«‹ç•°æ­¥ AzureOpenAI ç”¨æˆ¶ç«¯ï¼ŒåŒ…å«å„ªåŒ–çš„ timeout å’Œé‡è©¦é…ç½®"""
    api_key = os.getenv("AZURE_OPENAI_API_KEY")
    endpoint = os.getenv("AZURE_OPENAI_ENDPOINT")
    if not api_key or not endpoint:
        logger.warning("âš ï¸ [å®¢æˆ¶ç«¯åˆå§‹åŒ–] Azure OpenAI ç’°å¢ƒè®Šæ•¸ç¼ºå¤±")
        return None

    # Task 1: å‰µå»ºç•°æ­¥å®¢æˆ¶ç«¯ï¼ŒåŒ…å« timeout å’Œæ¸›å°‘é‡è©¦æ¬¡æ•¸
    client = AsyncAzureOpenAI(
        api_key=api_key,
        azure_endpoint=endpoint,
        api_version="2024-06-01",
        timeout=TIMEOUT,
        max_retries=2,  # ç”± 5 æ¬¡é™åˆ° 2 æ¬¡ï¼Œé¿å…ç©å£“
    )

    logger.info("âœ… [å®¢æˆ¶ç«¯åˆå§‹åŒ–] AsyncAzureOpenAI å®¢æˆ¶ç«¯å·²å‰µå»º")
    logger.info(f"   - Timeout: connect={TIMEOUT.connect}s, read={TIMEOUT.read}s")
    logger.info(f"   - Max retries: 2 (å„ªåŒ–å¾Œ)")

    return client


def get_whisper_deployment_name() -> Optional[str]:
    """å–å¾— Whisper éƒ¨ç½²åç¨±ï¼Œç’°å¢ƒè®Šæ•¸ç¼ºå€¼æ™‚å›å‚³ Noneã€‚"""
    return os.getenv("WHISPER_DEPLOYMENT_NAME")


async def initialize_transcription_service_v2() -> Optional[SimpleAudioTranscriptionService]:
    """åˆå§‹åŒ–ä¸¦å¿«å– SimpleAudioTranscriptionService å¯¦ä¾‹ã€‚è‹¥è¨­å®šä¸è¶³å‰‡å›å‚³ Noneã€‚"""
    global _transcription_service_v2
    if _transcription_service_v2 is not None:
        return _transcription_service_v2

    client = get_azure_openai_client()
    deployment = get_whisper_deployment_name()
    if not client or not deployment:
        logger.warning("Azure OpenAI è¨­å®šä¸è¶³ï¼Œç„¡æ³•åˆå§‹åŒ–è½‰éŒ„æœå‹™ v2")
        return None

    _transcription_service_v2 = SimpleAudioTranscriptionService(client, deployment)
    logger.info("âœ… Transcription service v2 initialized with async client")
    return _transcription_service_v2


def cleanup_transcription_service_v2():
    """æ¸…ç†å…¨åŸŸè½‰éŒ„æœå‹™å¯¦ä¾‹ã€‚"""
    global _transcription_service_v2
    _transcription_service_v2 = None


# END FILE CONTENTS


# File: frontend/components/ui/sonner.tsx

"use client"

import { useTheme } from "next-themes"
import { Toaster as Sonner } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster }


# END FILE CONTENTS


# File: .env.example

# StudyScriber ç’°å¢ƒè®Šæ•¸

# ============================================
# Supabase è³‡æ–™åº«é…ç½® (å¿…é ˆ)
# ============================================
DB_MODE=supabase
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your-anon-public-key

# ============================================
# èªéŸ³è½‰æ–‡å­— Provider è¨­å®š
# ============================================
# é è¨­ STT Providerï¼šwhisper (Azure OpenAI) æˆ– gemini (Google Vertex AI)
STT_PROVIDER_DEFAULT=whisper

# ============================================
# Azure OpenAI æœå‹™ (Whisper STT - å¿…é ˆ)
# ============================================
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-01
WHISPER_DEPLOYMENT_NAME=whisper-1

# ============================================
# Google Vertex AI æœå‹™ (Gemini STT - å¯é¸)
# ============================================
# å–æ¶ˆè¨»é‡‹ä»¥ä¸‹è¨­å®šä»¥å•Ÿç”¨ Gemini 2.5 Pro STT
# GEMINI_ENDPOINT=us-central1-aiplatform.googleapis.com
# GEMINI_API_KEY=your-gcp-service-account-key
# GEMINI_PROMPT=è«‹è¼¸å‡ºé€å­—ç¨¿ï¼š
# GEMINI_MAX_REQUESTS=90


# ============================================
# Azure OpenAI æ‰¹æ¬¡è™•ç†è¨­å®š (å„ªåŒ–ç‚ºä½å»¶é²)
# ============================================

# æ‰¹æ¬¡è™•ç†è¨­å®š (å„ªåŒ–ç‚ºä½å»¶é²)
# æ‰¹æ¬¡å¤§å°ï¼š2å€‹éŸ³æª”åˆ‡ç‰‡
WHISPER_BATCH_SIZE=2
# æ‰¹æ¬¡è¶…æ™‚ï¼š3ç§’ (ç›®æ¨™å»¶é² â‰¤5ç§’)
WHISPER_BATCH_TIMEOUT=3

# æ•ˆèƒ½ç›£æ§è¨­å®š
# å•Ÿç”¨æ•ˆèƒ½æ—¥èªŒè¨˜éŒ„
ENABLE_PERFORMANCE_LOGGING=true

# ============================================
# Whisper å¹»è¦ºéæ¿¾è¨­å®š (æå‡è½‰éŒ„å“è³ª)
# ============================================
# é€™äº›åƒæ•¸ç”¨æ–¼éæ¿¾ Azure Whisper API ç”¢ç”Ÿçš„ä½å“è³ªæˆ–å¹»è¦ºæ®µè½
# ä½¿ç”¨ verbose_json æ ¼å¼çš„å›æ‡‰é€²è¡Œå¾Œç«¯è‡ªå‹•éæ¿¾

# éœéŸ³æª¢æ¸¬é–€æª» - éæ¿¾é«˜éœéŸ³æ©Ÿç‡çš„æ®µè½
# ç¯„åœï¼š0.0-1.0ï¼Œå€¼è¶Šé«˜è¶Šåš´æ ¼
# å»ºè­°å€¼ï¼š0.8 (éæ¿¾ 80% ä»¥ä¸ŠéœéŸ³æ©Ÿç‡çš„æ®µè½)
# ç”¨é€”ï¼šç§»é™¤ã€Œå—¯ã€ã€ã€Œå‘ƒã€ç­‰å¡«å……è©å’ŒéœéŸ³ç‰‡æ®µ
FILTER_NO_SPEECH=0.8

# ç½®ä¿¡åº¦éæ¿¾é–€æª» - éæ¿¾ä½ç½®ä¿¡åº¦çš„æ®µè½
# ç¯„åœï¼š-5.0 åˆ° 0.0ï¼Œå€¼è¶Šé«˜è¶Šåš´æ ¼
# å»ºè­°å€¼ï¼š-1.0 (éæ¿¾å¹³å‡å°æ•¸æ©Ÿç‡ä½æ–¼ -1.0 çš„æ®µè½)
# ç”¨é€”ï¼šç§»é™¤æ¨¡å‹ä¸ç¢ºå®šçš„è½‰éŒ„çµæœ
FILTER_LOGPROB=-1.0

# é‡è¤‡å…§å®¹æª¢æ¸¬é–€æª» - éæ¿¾é«˜é‡è¤‡æ¯”ç‡çš„æ®µè½
# ç¯„åœï¼š1.0+ï¼Œå€¼è¶Šä½è¶Šåš´æ ¼
# å»ºè­°å€¼ï¼š2.4 (éæ¿¾å£“ç¸®æ¯”å¤§æ–¼ 2.4 çš„æ®µè½)
# ç”¨é€”ï¼šç§»é™¤é‡è¤‡æ–‡å­—ã€è¿´åœˆå¹»è¦ºç­‰å…§å®¹
FILTER_COMPRESSION=2.4

# ============================================
# éŸ³é »åˆ‡ç‰‡é…ç½® (å½±éŸ¿å‰å¾Œç«¯éŒ„éŸ³åˆ‡ç‰‡æ™‚é–“)
# ============================================
# éŸ³é »åˆ‡ç‰‡æ™‚é•·ï¼ˆç§’ï¼‰- åŒæ™‚å½±éŸ¿å‰å¾Œç«¯éŒ„éŸ³é–“éš”
# å»ºè­°å€¼ï¼š5-30ç§’ï¼Œé è¨­10ç§’
AUDIO_CHUNK_DURATION_SEC=5

# ============================================
# Cloudflare R2 å„²å­˜é…ç½® (å¿…é ˆ - ç”¨æ–¼éŸ³æª”å„²å­˜)
# ============================================
# å¸³æˆ¶ ID - åœ¨ Cloudflare æ§åˆ¶å°ä¸­å¯ä»¥æ‰¾åˆ°
R2_ACCOUNT_ID=your-account-id

# API Token - åœ¨ Cloudflare æ§åˆ¶å° > API æ¬Šæ–ä¸­å»ºç«‹
# éœ€è¦çš„æ¬Šé™: Zone:Zone:Read, Account:Cloudflare R2:Edit
R2_API_TOKEN=your-r2-api-token

# å„²å­˜æ¡¶åç¨±
R2_BUCKET_NAME=studyscriber-audio

# R2_ENDPOINT_URL æœƒè‡ªå‹•ç”Ÿæˆ: https://{R2_ACCOUNT_ID}.r2.cloudflarestorage.com
# å¦‚éœ€è‡ªè¨‚ç«¯é»ï¼Œè«‹å–æ¶ˆè¨»é‡‹ä¸‹é¢é€™è¡Œ
# R2_ENDPOINT_URL=https://your-custom-endpoint.com

# ============================================
# æ‡‰ç”¨ç¨‹å¼è¨­å®š (å¯é¸)
# ============================================
DEBUG=false
LOG_LEVEL=INFO


# END FILE CONTENTS


# File: frontend/components/ui/chart.tsx

"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([_, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}


# END FILE CONTENTS


# File: frontend/app/layout.tsx

import type { Metadata } from 'next'
import './globals.css'
import { AppStateProviderWrapper } from '../providers/app-state-provider-wrapper'

export const metadata: Metadata = {
  title: 'study-scriber',
  description: 'study-scriber',
  generator: 'study-scriber',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en" data-testid="html-root">
      <body>
        <AppStateProviderWrapper>
          {children}
        </AppStateProviderWrapper>
      </body>
    </html>
  )
}


# END FILE CONTENTS


# File: frontend/styles/globals.css

@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  font-family: Arial, Helvetica, sans-serif;
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 0 0% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 3.9%;
    --primary: 0 0% 9%;
    --primary-foreground: 0 0% 98%;
    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 9%;
    --muted: 0 0% 96.1%;
    --muted-foreground: 0 0% 45.1%;
    --accent: 0 0% 96.1%;
    --accent-foreground: 0 0% 9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 89.8%;
    --input: 0 0% 89.8%;
    --ring: 0 0% 3.9%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
  .dark {
    --background: 0 0% 3.9%;
    --foreground: 0 0% 98%;
    --card: 0 0% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 0 0% 98%;
    --primary-foreground: 0 0% 9%;
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;
    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 83.1%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}


# END FILE CONTENTS


# File: frontend/lib/rest-audio-uploader.ts

"use client"

/**
 * RestAudioUploader - REST API éŸ³é »ä¸Šå‚³å™¨
 *
 * Phase 2 é‡æ§‹ï¼šæ›¿æ› WebSocket ç‚º REST API ä¸Šå‚³
 *
 * ç‰¹é»ï¼š
 * - ä½¿ç”¨ fetch POST `/api/segment` ä¸Šå‚³å®Œæ•´ 10s æª”æ¡ˆ
 * - å¯¦ä½œä¸Šå‚³éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
 * - ä½¿ç”¨ IndexedDB æš«å­˜å¤±æ•—çš„æª”æ¡ˆ
 * - ç°¡åŒ–çš„éŒ¯èª¤è™•ç†æµç¨‹
 */

import { appConfig } from './config'

export interface UploadSegmentResponse {
    ack: number
    size: number
    status: 'success' | 'error'
    error?: string
}

export interface FailedSegment {
    sessionId: string
    sequence: number
    blob: Blob
    timestamp: number
    retryCount: number
}

export class RestAudioUploader {
    private sessionId: string | null = null
    private uploadQueue: Map<number, Blob> = new Map()
    private retryCount: Map<number, number> = new Map()
    private maxRetries = 3

    // äº‹ä»¶å›èª¿
    private onUploadSuccessCallback?: (seq: number, response: UploadSegmentResponse) => void
    private onUploadErrorCallback?: (seq: number, error: string) => void
    private onCacheStoredCallback?: (seq: number) => void

    constructor() {
        if (typeof window !== 'undefined') {
            this.initIndexedDB()
        }
    }

    /**
     * åˆå§‹åŒ– IndexedDB å­˜å„²
     */
    private async initIndexedDB(): Promise<void> {
        if (typeof window === 'undefined' || !window.indexedDB) {
            console.warn('âš ï¸ [RestAudioUploader] IndexedDB ä¸å¯ç”¨ï¼ˆæœå‹™å™¨ç«¯æ¸²æŸ“ï¼‰')
            return
        }

        return new Promise((resolve, reject) => {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onerror = () => {
                console.error('âŒ [RestAudioUploader] IndexedDB é–‹å•Ÿå¤±æ•—')
                reject(new Error('IndexedDB åˆå§‹åŒ–å¤±æ•—'))
            }

            request.onsuccess = () => {
                console.log('âœ… [RestAudioUploader] IndexedDB åˆå§‹åŒ–æˆåŠŸ')
                resolve()
            }

            request.onupgradeneeded = (event) => {
                const db = (event.target as IDBOpenDBRequest).result

                if (!db.objectStoreNames.contains('failedSegments')) {
                    const store = db.createObjectStore('failedSegments', { keyPath: 'id' })
                    store.createIndex('sessionId', 'sessionId', { unique: false })
                    store.createIndex('timestamp', 'timestamp', { unique: false })
                }
            }
        })
    }

    /**
     * è¨­å®š session ID
     */
    setSessionId(sessionId: string): void {
        this.sessionId = sessionId
        console.log('ğŸ¯ [RestAudioUploader] Session ID è¨­å®š:', sessionId)
    }

    /**
     * é‡ç½®åºè™Ÿå’Œä¸Šå‚³ç‹€æ…‹
     */
    resetSequence(): void {
        this.uploadQueue.clear()
        this.retryCount.clear()
        console.log('ğŸ”„ [RestAudioUploader] ä¸Šå‚³ç‹€æ…‹å·²é‡ç½®')
    }

    /**
     * ä¸Šå‚³éŸ³é »æ®µè½
     */
    async uploadSegment(sequence: number, blob: Blob): Promise<UploadSegmentResponse> {
        if (!this.sessionId) {
            throw new Error('Session ID æœªè¨­å®š')
        }

        console.log(`ğŸ“¤ [RestAudioUploader] æº–å‚™ä¸Šå‚³æ®µè½ #${sequence}`, {
            size: blob.size,
            mimeType: blob.type,
            sessionId: this.sessionId
        })

        try {
            const formData = new FormData()
            formData.append('file', blob, `seg${sequence}.webm`)

            const response = await fetch(`${appConfig.apiUrl}/api/segment?sid=${this.sessionId}&seq=${sequence}`, {
                method: 'POST',
                body: formData
            })

            if (!response.ok) {
                if (response.status === 409) {
                    // 409 è¦–ç‚ºå†ªç­‰æˆåŠŸ
                    console.log(`âœ… [RestAudioUploader] æ®µè½ #${sequence} å·²å­˜åœ¨ï¼Œè¦–ç‚ºä¸Šå‚³æˆåŠŸ`)
                    const successResponse = { ack: sequence, size: blob.size, status: 'success' as const }
                    
                    // é‡ç½®é‡è©¦è¨ˆæ•¸
                    this.retryCount.delete(sequence)
                    
                    // è§¸ç™¼æˆåŠŸå›èª¿
                    this.onUploadSuccessCallback?.(sequence, successResponse)
                    
                    return successResponse
                }
                throw new Error(`HTTP ${response.status}: ${response.statusText}`)
            }

            const result: UploadSegmentResponse = await response.json()

            console.log(`âœ… [RestAudioUploader] æ®µè½ #${sequence} ä¸Šå‚³æˆåŠŸ`, result)

            // é‡ç½®é‡è©¦è¨ˆæ•¸
            this.retryCount.delete(sequence)

            // è§¸ç™¼æˆåŠŸå›èª¿
            this.onUploadSuccessCallback?.(sequence, result)

            return result

        } catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'ä¸Šå‚³å¤±æ•—'
            console.error(`âŒ [RestAudioUploader] æ®µè½ #${sequence} ä¸Šå‚³å¤±æ•—:`, errorMessage)

            // è™•ç†é‡è©¦é‚è¼¯
            await this.handleUploadFailure(sequence, blob, errorMessage)

            throw new Error(errorMessage)
        }
    }

    /**
     * è™•ç†ä¸Šå‚³å¤±æ•— - é‡è©¦æˆ–æš«å­˜
     */
    private async handleUploadFailure(sequence: number, blob: Blob, error: string): Promise<void> {
        const currentRetries = this.retryCount.get(sequence) || 0

        if (currentRetries < this.maxRetries) {
            // å˜—è©¦é‡è©¦
            this.retryCount.set(sequence, currentRetries + 1)
            console.log(`ğŸ”„ [RestAudioUploader] æ®µè½ #${sequence} æº–å‚™é‡è©¦ (${currentRetries + 1}/${this.maxRetries})`)

            // å»¶é²é‡è©¦ï¼ˆæ¼¸é€²å¼å»¶é²ï¼‰
            const delay = Math.pow(2, currentRetries) * 1000 // 1s, 2s, 4s
            setTimeout(() => {
                this.retryUpload(sequence, blob)
            }, delay)

        } else {
            // é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼Œæš«å­˜åˆ° IndexedDB
            console.warn(`âš ï¸ [RestAudioUploader] æ®µè½ #${sequence} é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼Œæš«å­˜åˆ°æœ¬åœ°`)
            await this.cacheFailedSegment(sequence, blob)

            // è§¸ç™¼éŒ¯èª¤å›èª¿
            this.onUploadErrorCallback?.(sequence, `é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸: ${error}`)
        }
    }

    /**
     * é‡è©¦ä¸Šå‚³
     */
    private async retryUpload(sequence: number, blob: Blob): Promise<void> {
        try {
            await this.uploadSegment(sequence, blob)
        } catch (error) {
            // é‡è©¦å¤±æ•—æœƒå†æ¬¡è§¸ç™¼ handleUploadFailure
            console.log(`âš ï¸ [RestAudioUploader] æ®µè½ #${sequence} é‡è©¦å¤±æ•—`)
        }
    }

    /**
     * æš«å­˜å¤±æ•—çš„æ®µè½åˆ° IndexedDB
     */
    private async cacheFailedSegment(sequence: number, blob: Blob): Promise<void> {
        if (!this.sessionId || typeof window === 'undefined' || !window.indexedDB) return

        try {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onsuccess = () => {
                const db = request.result
                const transaction = db.transaction(['failedSegments'], 'readwrite')
                const store = transaction.objectStore('failedSegments')

                const failedSegment: FailedSegment = {
                    sessionId: this.sessionId!,
                    sequence,
                    blob,
                    timestamp: Date.now(),
                    retryCount: this.retryCount.get(sequence) || 0
                }

                const addRequest = store.put({
                    id: `${this.sessionId}_${sequence}`,
                    ...failedSegment
                })

                addRequest.onsuccess = () => {
                    console.log(`ğŸ’¾ [RestAudioUploader] æ®µè½ #${sequence} å·²æš«å­˜åˆ°æœ¬åœ°`)
                    this.onCacheStoredCallback?.(sequence)
                }

                addRequest.onerror = () => {
                    console.error(`âŒ [RestAudioUploader] æ®µè½ #${sequence} æš«å­˜å¤±æ•—`)
                }
            }

        } catch (error) {
            console.error('âŒ [RestAudioUploader] IndexedDB æš«å­˜éŒ¯èª¤:', error)
        }
    }

    /**
     * é‡æ–°ä¸Šå‚³æš«å­˜çš„å¤±æ•—æ®µè½
     */
    async retryFailedSegments(): Promise<void> {
        if (!this.sessionId || typeof window === 'undefined' || !window.indexedDB) return

        try {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onsuccess = () => {
                const db = request.result
                const transaction = db.transaction(['failedSegments'], 'readonly')
                const store = transaction.objectStore('failedSegments')
                const index = store.index('sessionId')
                const getRequest = index.getAll(this.sessionId)

                getRequest.onsuccess = async () => {
                    const failedSegments = getRequest.result

                    if (failedSegments.length === 0) {
                        console.log('âœ… [RestAudioUploader] æ²’æœ‰æš«å­˜çš„å¤±æ•—æ®µè½')
                        return
                    }

                    console.log(`ğŸ”„ [RestAudioUploader] ç™¼ç¾ ${failedSegments.length} å€‹æš«å­˜æ®µè½ï¼Œé–‹å§‹é‡æ–°ä¸Šå‚³`)

                    for (const segment of failedSegments) {
                        try {
                            await this.uploadSegment(segment.sequence, segment.blob)

                            // ä¸Šå‚³æˆåŠŸï¼Œå¾ IndexedDB ä¸­ç§»é™¤
                            await this.removeFailedSegment(`${segment.sessionId}_${segment.sequence}`)

                        } catch (error) {
                            console.warn(`âš ï¸ [RestAudioUploader] æš«å­˜æ®µè½ #${segment.sequence} é‡æ–°ä¸Šå‚³å¤±æ•—`)
                        }
                    }
                }
            }

        } catch (error) {
            console.error('âŒ [RestAudioUploader] é‡æ–°ä¸Šå‚³æš«å­˜æ®µè½å¤±æ•—:', error)
        }
    }

    /**
     * å¾ IndexedDB ä¸­ç§»é™¤æˆåŠŸä¸Šå‚³çš„æ®µè½
     */
    private async removeFailedSegment(id: string): Promise<void> {
        if (typeof window === 'undefined' || !window.indexedDB) return

        try {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onsuccess = () => {
                const db = request.result
                const transaction = db.transaction(['failedSegments'], 'readwrite')
                const store = transaction.objectStore('failedSegments')

                const deleteRequest = store.delete(id)
                deleteRequest.onsuccess = () => {
                    console.log(`ğŸ—‘ï¸ [RestAudioUploader] å·²ç§»é™¤æš«å­˜æ®µè½: ${id}`)
                }
            }

        } catch (error) {
            console.error('âŒ [RestAudioUploader] ç§»é™¤æš«å­˜æ®µè½å¤±æ•—:', error)
        }
    }

    /**
     * ç²å–æš«å­˜çš„å¤±æ•—æ®µè½æ•¸é‡
     */
    async getCachedSegmentsCount(): Promise<number> {
        if (!this.sessionId || typeof window === 'undefined' || !window.indexedDB) return 0

        return new Promise((resolve) => {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onsuccess = () => {
                const db = request.result
                const transaction = db.transaction(['failedSegments'], 'readonly')
                const store = transaction.objectStore('failedSegments')
                const index = store.index('sessionId')
                const countRequest = index.count(this.sessionId!)

                countRequest.onsuccess = () => {
                    resolve(countRequest.result)
                }

                countRequest.onerror = () => {
                    resolve(0)
                }
            }

            request.onerror = () => {
                resolve(0)
            }
        })
    }

    /**
     * æ¸…ç†è³‡æº
     */
    cleanup(): void {
        this.sessionId = null
        this.uploadQueue.clear()
        this.retryCount.clear()
        console.log('ğŸ§¹ [RestAudioUploader] å·²æ¸…ç†')
    }

    // äº‹ä»¶å›èª¿è¨­å®š
    onUploadSuccess(callback: (seq: number, response: UploadSegmentResponse) => void): void {
        this.onUploadSuccessCallback = callback
    }

    onUploadError(callback: (seq: number, error: string) => void): void {
        this.onUploadErrorCallback = callback
    }

    onCacheStored(callback: (seq: number) => void): void {
        this.onCacheStoredCallback = callback
    }
}

// é è¨­å¯¦ä¾‹
export const restAudioUploader = new RestAudioUploader()


# END FILE CONTENTS


# File: app/services/stt/gemini_provider.py

from __future__ import annotations

import base64
import logging
from datetime import datetime
from typing import Dict, Any
from uuid import UUID

import google.generativeai as genai

from app.core.config import get_settings
from app.core.ffmpeg import webm_to_pcm
from .base import ISTTProvider

logger = logging.getLogger(__name__)
settings = get_settings()


class GeminiProvider(ISTTProvider):
    """ä½¿ç”¨ Vertex AI Gemini 2.5 Pro çš„èªéŸ³è½‰æ–‡å­— Providerã€‚"""

    def __init__(self) -> None:
        # å»¶é²è¼‰å…¥ï¼Œé¿å…æœªè¨­å®š API Key ä»å»ºç«‹ç‰©ä»¶
        self._model: genai.GenerativeModel | None = None

    # ------------- ä»‹é¢å¯¦ä½œ -------------
    def name(self) -> str:  # type: ignore[override]
        return "gemini"

    def max_rpm(self) -> int:  # type: ignore[override]
        return settings.GEMINI_MAX_REQUESTS if hasattr(settings, "GEMINI_MAX_REQUESTS") else 60

    async def transcribe(self, webm: bytes, session_id: UUID, chunk_seq: int) -> Dict[str, Any]:  # type: ignore[override]
        """å°‡ WebM è½‰ç‚º PCMï¼Œé€è‡³ Gemini å–å¾—çµæœã€‚"""
        logger.info(f"ğŸ™ï¸ [Gemini] é–‹å§‹è½‰éŒ„ chunk {chunk_seq} (session {session_id})")

        # åˆå§‹åŒ–æ¨¡å‹
        if self._model is None:
            try:
                # ä½¿ç”¨æ–°ç‰ˆ google-generativeai éœ€è¦å…ˆå…¨åŸŸè¨­å®š API Key
                genai.configure(api_key=settings.GEMINI_API_KEY)
                # å»ºç«‹æ¨¡å‹ï¼Œä¸å†æ¥å— api_key/base_url åƒæ•¸
                self._model = genai.GenerativeModel("gemini-2.5-pro-preview")
            except Exception as e:
                logger.error(f"[Gemini] åˆå§‹åŒ–æ¨¡å‹å¤±æ•—: {e}")
                raise

        # 1. è½‰æª”
        pcm_bytes = await webm_to_pcm(webm)

        # 2. çµ„ prompt
        prompt = getattr(settings, "GEMINI_PROMPT", "è«‹è¼¸å‡ºé€å­—ç¨¿ï¼š")

        # 3. å‘¼å« API - ä½¿ç”¨ inline_data æ–¹å¼å‚³ééŸ³è¨Š (ç¬¦åˆæ–°ç‰ˆ google-generativeai SDK)
        try:
            from google.generativeai import types as genai_types  # type: ignore

            parts = [
                {"text": prompt},
                genai_types.Part.from_bytes(data=pcm_bytes, mime_type="audio/wav"),
            ]

            res = await self._model.generate_content_async(contents=parts)

            text = res.text.strip() if hasattr(res, "text") else ""
        except Exception as e:
            logger.error(f"[Gemini] è½‰éŒ„å¤±æ•—: {e}")
            raise

        logger.info(f"âœ… [Gemini] chunk {chunk_seq} è½‰éŒ„å®Œæˆï¼Œé•·åº¦ {len(text)} å­—")
        return {
            "text": text,
            "chunk_sequence": chunk_seq,
            "session_id": str(session_id),
            "timestamp": datetime.utcnow().isoformat(),
            "start_time": chunk_seq * settings.AUDIO_CHUNK_DURATION_SEC,
            "end_time": (chunk_seq + 1) * settings.AUDIO_CHUNK_DURATION_SEC,
            "provider": self.name(),
        }


# END FILE CONTENTS


# File: docs/export-tdd-tasks.md

# Export åŠŸèƒ½ TDD ä»»å‹™ç´°é …

## ç›®æ¨™
- ä¾æ“š export-spec.mdã€export-transcript-format.mdã€export-wait-until-completed-20240608.mdï¼Œå¯¦ä½œä¸¦å®Œå–„ Exportï¼ˆåŒ¯å‡ºï¼‰åŠŸèƒ½ï¼Œç¢ºä¿å‰å¾Œç«¯æµç¨‹å®Œæ•´ã€å¯æ¸¬è©¦ã€‚

## ä¸»è¦è¦æ ¼ä¾æ“š
- `GET /api/export/{sid}?type=zip`ï¼Œä¸‹è¼‰ session ç­†è¨˜èˆ‡é€å­—ç¨¿ï¼Œæ‰“åŒ…ç‚º zipã€‚
- éœ€ç­‰å¾… session ç‹€æ…‹ç‚º completed æ‰èƒ½åŒ¯å‡ºã€‚
- zip å…§å®¹ï¼šnote.mdã€transcript.txtï¼ˆæ ¼å¼è©³è¦‹ export-transcript-format.mdï¼‰ã€‚
- å‰ç«¯éœ€æœ‰ç­‰å¾…æç¤ºã€éŒ¯èª¤æç¤ºã€åŒ¯å‡ºæŒ‰éˆ•ã€‚

## TDD æ­¥é©Ÿ
1. å…ˆå¯«æ¸¬è©¦ï¼ˆå‰ç«¯/å¾Œç«¯ï¼‰ï¼Œè¦†è“‹æˆåŠŸã€å¤±æ•—ã€ç•°å¸¸æƒ…å¢ƒã€‚
2. è£œé½Šæœ€å°å¯¦ä½œï¼Œè®“æ¸¬è©¦é€šéã€‚
3. ç¶­æŒçµæ§‹èˆ‡è¡Œç‚ºåˆ†é›¢ï¼Œå¿…è¦æ™‚å…ˆ tidy firstã€‚
4. æ¯æ­¥é©Ÿçš†éœ€é€šéæ¸¬è©¦å†é€²è¡Œä¸‹ä¸€æ­¥ã€‚

## ç´°é …ä»»å‹™
- [ ] å‰ç«¯ï¼šå°‡ Export æŒ‰éˆ•åŠŸèƒ½ä¸²æ¥åˆ° ExportButton å…ƒä»¶ï¼Œä¸¦æ–¼ finished ç‹€æ…‹é¡¯ç¤ºã€‚
- [ ] å‰ç«¯ï¼šè£œé½Š useSession hook çš„ waitUntilCompleted è¡Œç‚ºæ¸¬è©¦ã€‚
- [ ] å‰ç«¯ï¼šè£œé½Š ExportButton çš„æ•´åˆæ¸¬è©¦ï¼Œé©—è­‰æµç¨‹èˆ‡éŒ¯èª¤æç¤ºã€‚
- [ ] å¾Œç«¯ï¼šè£œé½Š /api/export/{sid} API å–®å…ƒæ¸¬è©¦ï¼Œæ¶µè“‹æˆåŠŸã€404ã€409ã€400 ç­‰æƒ…å¢ƒã€‚

---

> æœ¬æ–‡ä»¶ä¾ TDD èˆ‡ tidy first åŸå‰‡ï¼Œé€æ­¥è¿½è¹¤ Export åŠŸèƒ½é–‹ç™¼é€²åº¦ã€‚ 


# END FILE CONTENTS


# File: frontend/components/ui/breadcrumb.tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:w-3.5 [&>svg]:h-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}


# END FILE CONTENTS


# File: frontend/utils/time.ts

export const formatTime = (sec: number): string => {
    const minutes = Math.floor(sec / 60)
    const seconds = Math.floor(sec % 60)
    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
}


# END FILE CONTENTS


# File: frontend/components/ui/input-otp.tsx

"use client"

import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }


# END FILE CONTENTS


# File: frontend/components/ui/dropdown-menu.tsx

"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}


# END FILE CONTENTS


# File: frontend/app/page.tsx

"use client"

import dynamic from "next/dynamic"
import Component from "../study-scriber"

// æ·»åŠ å…¨å±€é™¤éŒ¯åŠŸèƒ½
if (typeof window !== 'undefined') {
  // ç«‹å³åˆå§‹åŒ– TranscriptManagerï¼Œç¢ºä¿åœ¨æ¸¬è©¦ç’°å¢ƒä¸­å¯ç”¨
  import('../lib/transcript-manager').then(({ transcriptManager }) => {
    // ç¢ºä¿ TranscriptManager å·²æš´éœ²åˆ° window
    ; (window as any).transcriptManager = transcriptManager
    console.log('âœ… TranscriptManager å·²åˆå§‹åŒ–ä¸¦æš´éœ²åˆ° window')
  });

  (window as any).debugTranscript = () => {
    const testMessage = {
      type: 'transcript_segment',
      text: 'æ¸¬è©¦é€å­—ç¨¿å…§å®¹ - å¦‚æœçœ‹åˆ°é€™å€‹è¡¨ç¤ºå‰ç«¯å¯ä»¥æ­£å¸¸è™•ç†',
      start_time: 0,
      end_time: 12,
      start_sequence: 0,
      confidence: 0.95
    };

    // å–å¾—ç•¶å‰ session ID
    const appData = (window as any).appData;
    const sessionId = appData?.session?.id || '861f8cee-1f57-476c-8819-0ffe9ec084c8';

    console.log('ğŸ” æ¸¬è©¦é€å­—ç¨¿æ¥æ”¶ï¼ŒSession ID:', sessionId);

    // ç›´æ¥è§¸ç™¼ TranscriptManager çš„è¨Šæ¯è™•ç†
    const manager = (window as any).transcriptManager;
    if (manager) {
      const listeners = manager.listeners.get(sessionId);
      if (listeners && listeners.size > 0) {
        console.log(`ğŸ“¡ æ‰¾åˆ° ${listeners.size} å€‹ç›£è½å™¨ï¼Œé–‹å§‹å»£æ’­æ¸¬è©¦è¨Šæ¯`);
        listeners.forEach((callback: any) => {
          try {
            callback(testMessage);
            console.log('âœ… æ¸¬è©¦è¨Šæ¯å·²ç™¼é€');
          } catch (error) {
            console.error('âŒ ç™¼é€æ¸¬è©¦è¨Šæ¯å¤±æ•—:', error);
          }
        });
      } else {
        console.error('âŒ æ²’æœ‰æ‰¾åˆ°ç›£è½å™¨ï¼Œè«‹ç¢ºèª WebSocket å·²é€£æ¥');
      }
    } else {
      console.error('âŒ TranscriptManager æœªåˆå§‹åŒ–');
    }
  };

  // æ–°å¢ï¼šè¨ºæ–·å‡½æ•¸
  (window as any).debugState = () => {
    const appData = (window as any).appData;
    console.log('ğŸ” å®Œæ•´æ‡‰ç”¨ç‹€æ…‹è¨ºæ–·ï¼š');
    console.log('1. AppData:', appData);
    console.log('2. Session:', appData?.session);
    console.log('3. éŒ„éŸ³ç‹€æ…‹:', {
      isRecording: appData?.isRecording,
      recordingTime: appData?.recordingTime,
      state: appData?.state
    });
    console.log('4. é€å­—ç¨¿:', {
      transcriptEntries: appData?.transcriptEntries,
      count: appData?.transcriptEntries?.length || 0
    });

    // æª¢æŸ¥ transcriptManager çš„å…§éƒ¨ç‹€æ…‹
    const manager = (window as any).transcriptManager;
    if (manager) {
      console.log('5. TranscriptManager:');
      console.log('   - é€£æ¥æ•¸:', manager.getConnectionCount());
      console.log('   - é€£æ¥Map:', manager.connections);
      console.log('   - ç›£è½å™¨Map:', manager.listeners);
    }

    // æª¢æŸ¥ç‚ºä»€éº¼ç‹€æ…‹æ˜¯ default
    console.log('6. ç‹€æ…‹æ˜ å°„æ¢ä»¶:');
    console.log('   - hasSession:', !!appData?.session);
    console.log('   - sessionStatus:', appData?.session?.status);
    console.log('   - sessionType:', appData?.session?.type);
    console.log('   - isRecording:', appData?.isRecording);
    console.log('   - transcriptCount:', appData?.transcriptEntries?.length || 0);
  };

  // æ–°å¢ï¼šç›£è½é€å­—ç¨¿æ›´æ–°
  (window as any).watchTranscripts = () => {
    const sessionId = '861f8cee-1f57-476c-8819-0ffe9ec084c8';

    // æ·»åŠ ä¸€å€‹æ¸¬è©¦ç›£è½å™¨
    const testListener = (message: any) => {
      console.log('ğŸ¯ [æ¸¬è©¦ç›£è½å™¨] æ”¶åˆ°è¨Šæ¯:', {
        type: message.type,
        text: message.text,
        time: new Date().toISOString()
      });
    };

    const manager = (window as any).transcriptManager;
    if (manager) {
      manager.addListener(sessionId, testListener);
      console.log('âœ… æ¸¬è©¦ç›£è½å™¨å·²æ·»åŠ ï¼Œç­‰å¾…é€å­—ç¨¿è¨Šæ¯...');

      // è¿”å›ç§»é™¤å‡½æ•¸
      return () => {
        manager.removeListener(sessionId, testListener);
        console.log('âŒ æ¸¬è©¦ç›£è½å™¨å·²ç§»é™¤');
      };
    } else {
      console.error('âŒ TranscriptManager æœªåˆå§‹åŒ–');
      return () => { };
    }
  };

  // æ–°å¢ï¼šæ‰‹å‹•æ¨é€é€å­—ç¨¿
  (window as any).pushTranscript = (text: string, startTime: number = 0) => {
    const appData = (window as any).appData;
    if (!appData) {
      console.error('âŒ appData æœªå®šç¾©');
      return;
    }

    // è¨ˆç®—æ™‚é–“æ ¼å¼
    const hours = Math.floor(startTime / 3600);
    const minutes = Math.floor((startTime % 3600) / 60);
    const seconds = Math.floor(startTime % 60);
    const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

    // å‰µå»ºæ–°çš„é€å­—ç¨¿é …ç›®
    const newEntry = {
      time: timeStr,
      text: text
    };

    // æ›´æ–° appData
    const currentEntries = appData.transcriptEntries || [];
    const newEntries = [...currentEntries, newEntry];

    // æ‰‹å‹•è§¸ç™¼ç‹€æ…‹æ›´æ–°
    console.log('ğŸ“ æ‰‹å‹•æ¨é€é€å­—ç¨¿:', newEntry);
    console.log('ğŸ“Š æ›´æ–°å‰:', currentEntries.length, 'æ¢');
    console.log('ğŸ“Š æ›´æ–°å¾Œ:', newEntries.length, 'æ¢');

    // æ›´æ–°ç‹€æ…‹
    appData.transcriptEntries = newEntries;

    // å¦‚æœç‹€æ…‹é‚„æ˜¯ recording_waitingï¼Œæ”¹ç‚º recording_active
    if (appData.state === 'recording_waiting' && newEntries.length > 0) {
      appData.state = 'recording_active';
      console.log('âœ… ç‹€æ…‹æ›´æ–°: recording_waiting â†’ recording_active');
    }

    // å¼·åˆ¶é‡æ–°æ¸²æŸ“
    window.location.reload();
  };

  // æ–°å¢ï¼šè¨ºæ–· WebSocket å’Œç‹€æ…‹
  (window as any).diagnose = () => {
    console.log('ğŸ” ========== è¨ºæ–·é–‹å§‹ ==========');

    // 1. æª¢æŸ¥ appData ç‹€æ…‹
    const appData = (window as any).appData;
    console.log('ğŸ“Š [1] appData ç‹€æ…‹:', {
      state: appData?.state,
      isRecording: appData?.isRecording,
      transcriptEntries: appData?.transcriptEntries?.length || 0,
      session: appData?.session ? {
        id: appData.session.id,
        status: appData.session.status,
        type: appData.session.type
      } : undefined
    });

    // 2. æª¢æŸ¥ recording hook ç‹€æ…‹
    const recordingHook = (window as any).recordingHook;
    if (recordingHook) {
      console.log('ğŸ¤ [2] recording hook ç‹€æ…‹:', {
        isRecording: recordingHook.isRecording,
        transcriptsCount: recordingHook.transcripts?.length || 0,
        transcripts: recordingHook.transcripts
      });
    } else {
      console.error('âŒ [2] recording hook æœªæ‰¾åˆ°');
    }

    // 2.5 æª¢æŸ¥ session hook ç‹€æ…‹
    const sessionHook = (window as any).sessionHook;
    if (sessionHook) {
      console.log('ğŸ” [2.5] session hook ç‹€æ…‹:', {
        currentSession: sessionHook.currentSession,
        isLoading: sessionHook.isLoading,
        error: sessionHook.error
      });
    } else {
      console.error('âŒ [2.5] session hook æœªæ‰¾åˆ°');
    }

    // 3. æª¢æŸ¥ TranscriptManager ç‹€æ…‹
    const manager = (window as any).transcriptManager;
    const sessionId = appData?.session?.id || sessionHook?.currentSession?.id;

    if (manager && sessionId) {
      console.log('ğŸ’¬ [3] TranscriptManager ç‹€æ…‹:', {
        isConnected: manager.isConnected(sessionId),
        listeners: manager.listeners.size,
        websocket: manager.websocket ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨',
        sessionId: sessionId
      });
    } else {
      console.error('âŒ [3] session ID æœªå®šç¾© æˆ– TranscriptManager æœªæ‰¾åˆ°', {
        manager: !!manager,
        sessionId: sessionId
      });
    }

    // 4. æª¢æŸ¥ WebSocket è©³æƒ…
    if (manager && sessionId) {
      const connections = manager.connections;
      const ws = connections.get(sessionId);
      if (ws) {
        console.log('ğŸ”Œ [4] WebSocket è©³æƒ…:', {
          readyState: ws.readyState,
          readyStateText: ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'][ws.readyState],
          url: ws.url || ws.wsUrl,
          isConnected: ws.isConnected,
          bufferedAmount: ws.bufferedAmount || 'N/A',
          protocol: ws.protocol || 'N/A'
        });
      } else {
        console.error('âŒ [4] WebSocket é€£æ¥æœªæ‰¾åˆ° for session:', sessionId);
      }
    } else {
      console.error('âŒ [4] TranscriptManager æˆ– sessionId æœªå®šç¾©');
    }

    // 5. æª¢æŸ¥ localStorage
    console.log('ğŸ’¾ [5] localStorage å…§å®¹:', {
      draft_note: localStorage.getItem('draft_note')?.substring(0, 100) + '...',
      hasOtherSessionKeys: Object.keys(localStorage).filter(k => k.includes('session')).length > 0
    });

    // 6. æ‰‹å‹•å»ºç«‹ WebSocket é€£æ¥æ¸¬è©¦
    console.log('ğŸ§ª [6] æ¸¬è©¦ WebSocket é€£æ¥...');
    const testSessionId = sessionId || '23f6bbfe-a846-44db-ba1b-2751adafe0bc'; // ä½¿ç”¨å¾Œç«¯æ—¥èªŒä¸­çš„ session ID
    const wsUrl = `ws://localhost:8000/ws/transcript_feed/${testSessionId}`;
    console.log('ğŸ§ª æ¸¬è©¦ URL:', wsUrl);

    // 7. æª¢æŸ¥ appData ä¸­æ‰€æœ‰å¯ç”¨çš„å±¬æ€§
    console.log('ğŸ” [7] appData å®Œæ•´å…§å®¹:', appData);

    console.log('ğŸ” ========== è¨ºæ–·çµæŸ ==========');
  };

  // æ–°å¢ï¼šå¼·åˆ¶åŒæ­¥ç‹€æ…‹
  (window as any).syncStates = () => {
    console.log('ğŸ”„ å¼·åˆ¶åŒæ­¥æ‰€æœ‰ç‹€æ…‹...');

    const recordingHook = (window as any).recordingHook;
    const sessionHook = (window as any).sessionHook;
    const appData = (window as any).appData;

    if (recordingHook && sessionHook && appData) {
      console.log('ğŸ”„ [åŒæ­¥å‰] ç‹€æ…‹å°æ¯”:', {
        'appData.isRecording': appData.isRecording,
        'recording.isRecording': recordingHook.isRecording,
        'appData.state': appData.state,
        'session.status': sessionHook.currentSession?.status,
        'session.type': sessionHook.currentSession?.type,
        'recording.transcripts.length': recordingHook.transcripts?.length || 0,
        'appData.transcriptEntries.length': appData.transcriptEntries?.length || 0
      });

      // å¼·åˆ¶è§¸ç™¼ç‹€æ…‹é‡æ–°è¨ˆç®—
      const forceUpdate = () => {
        // è§¸ç™¼ä¸€å€‹å¾®å°çš„ç‹€æ…‹è®ŠåŒ–ä¾†å¼·åˆ¶é‡æ–°æ¸²æŸ“
        const currentTime = appData.recordingTime || 0;
        appData.recordingTime = currentTime + 0.001;

        setTimeout(() => {
          appData.recordingTime = currentTime;
          console.log('âœ… å¼·åˆ¶åŒæ­¥å®Œæˆ');
        }, 50);
      };

      forceUpdate();
    } else {
      console.error('âŒ ç„¡æ³•æ‰¾åˆ°å¿…è¦çš„ hooks');
    }
  };

  // æ–°å¢ï¼šä¿®å¾©ç‹€æ…‹ä¸ä¸€è‡´
  (window as any).fixStates = () => {
    console.log('ğŸ”§ æ‰‹å‹•ä¿®å¾©ç‹€æ…‹ä¸ä¸€è‡´...');

    const recordingHook = (window as any).recordingHook;
    const appData = (window as any).appData;

    if (recordingHook && appData) {
      console.log('ğŸ”§ [ä¿®å¾©å‰] ç‹€æ…‹:', {
        'appData.isRecording': appData.isRecording,
        'recording.isRecording': recordingHook.isRecording,
        'appData.state': appData.state
      });

      // å¼·åˆ¶ä¿®å¾© isRecording ç‹€æ…‹
      if (appData.isRecording !== recordingHook.isRecording) {
        console.log('ğŸ”§ ä¿®å¾© isRecording ç‹€æ…‹ä¸ä¸€è‡´');
        appData.isRecording = recordingHook.isRecording;

        // å¦‚æœéŒ„éŸ³å·²åœæ­¢ä½†ç‹€æ…‹é‚„æ˜¯ recording_waitingï¼Œæ”¹ç‚º default
        if (!recordingHook.isRecording && appData.state === 'recording_waiting') {
          console.log('ğŸ”§ ä¿®å¾©ç‹€æ…‹: recording_waiting â†’ default');
          appData.state = 'default';
        }

        // è§¸ç™¼é‡æ–°æ¸²æŸ“
        window.location.reload();
      } else {
        console.log('âœ… ç‹€æ…‹å·²ä¸€è‡´ï¼Œç„¡éœ€ä¿®å¾©');
      }
    } else {
      console.error('âŒ ç„¡æ³•æ‰¾åˆ°å¿…è¦çš„ hooks');
    }
  };

  // æ–°å¢ï¼šå¼·åˆ¶ React é‡æ–°æ¸²æŸ“
  (window as any).forceUpdate = () => {
    console.log('ğŸ”„ å¼·åˆ¶ React é‡æ–°æ¸²æŸ“...');

    // æ–¹æ³• 1ï¼šå‰µå»ºä¸€å€‹å¾®å°çš„ç‹€æ…‹è®ŠåŒ–ä¾†è§¸ç™¼é‡æ–°æ¸²æŸ“
    const appData = (window as any).appData;
    if (appData) {
      const originalRecordingTime = appData.recordingTime;
      appData.recordingTime = originalRecordingTime + 0.1;

      setTimeout(() => {
        appData.recordingTime = originalRecordingTime;
        console.log('âœ… å¼·åˆ¶æ›´æ–°å®Œæˆ');
      }, 100);
    }

    // æ–¹æ³• 2ï¼šå¦‚æœä¸Šé¢ä¸å·¥ä½œï¼Œé‡æ–°è¼‰å…¥é é¢
    console.log('å¦‚æœUIé‚„æ˜¯æ²’æœ‰æ›´æ–°ï¼Œå°‡åœ¨3ç§’å¾Œé‡æ–°è¼‰å…¥é é¢...');
    setTimeout(() => {
      if (confirm('UI æ²’æœ‰æ›´æ–°ï¼Œæ˜¯å¦é‡æ–°è¼‰å…¥é é¢ï¼Ÿ')) {
        window.location.reload();
      }
    }, 3000);
  };
}

export default function Page() {
  return <Component />
}


# END FILE CONTENTS


# File: .cursor/rules/backend.mdc

---
description:
globs:
alwaysApply: false
---
## Development Notes

- Dependency-Injection everywhere (container + FastAPI `Depends`)
- Strict TDD workflow: **Red â†’ Green â†’ Refactor** for every ticket
- Clean, layered architecture (API / Services / Domain / Infra / Core)
- Async-first, non-blocking I/O only (`httpx`, `aioboto3`, SQLAlchemy 2.0 async)
- Structured JSON logging with `structlog`
- Environment-based, typed configuration (`pydantic-settings`, Pydantic v2)
- OpenTelemetry tracing + Prometheus metrics
- Graceful startup/shutdown with FastAPI lifespan
- Health, metrics & readiness endpoints for orchestration
- Blue-green/containerised deployment (uvicorn + uvloop)

---

- Async context managers for resources

```python
# Good
async with aiofiles.open(file_path, "rb") as f:
    content = await f.read()

# Bad
f = await aiofiles.open(file_path, "rb")
content = await f.read()
f.close()
```

- Always use structured logging (never `print`)

```python
# Good
logger.info(
    "processing_chunk",
    extra={"chunk_id": chunk_id, "size": len(data)}
)
```

---

## Error-Handling Patterns

```python
# Good
try:
    result = await some_operation()
except ValidationError as e:
    raise HTTPException(status_code=422, detail=e.errors())
except ResourceNotFound as e:
    raise HTTPException(status_code=404, detail=str(e))
except Exception as e:
    logger.error("unexpected_error", exc_info=True)
    raise HTTPException(status_code=500, detail="Internal server error")
```

## WebSocket Patterns

```python
class ConnectionManager:
    def __init__(self):
        self.active: dict[str, WebSocket] = {}

    async def connect(self, ws: WebSocket, client_id: str):
        await ws.accept()
        self.active[client_id] = ws
        logger.info("ws_connected", client_id=client_id)

    async def disconnect(self, client_id: str):
        if client_id in self.active:
            del self.active[client_id]
            logger.info("ws_disconnected", client_id=client_id)

    async def broadcast(self, msg: str, client_id: str):
        if ws := self.active.get(client_id):
            try:
                await ws.send_text(msg)
            except WebSocketDisconnect:
                await self.disconnect(client_id)
```

---

## Database Patterns

```python
async def get_db():
    async with AsyncSession(engine) as session, session.begin():
        yield session
```

---

# Tests

- pytest + pytest-asyncio
- tests/ mirrors source tree
- Fixtures for common data/deps
- Mock external services (OpenAI, R2, Supabase)
- Test success & failure paths
- Coverage â‰¥ 90%

```python
@pytest.mark.asyncio
async def test_process_audio_chunk_success(azure_client_mock, supabase_mock):
    svc = AudioTranscriptionService(azure_client_mock, "deployment")
    ok = await svc.process_audio_chunk(uuid4(), 0, b"webm")
    assert ok is True
    azure_client_mock.audio.transcriptions.create.assert_called_once()
```

---

# Performance Considerations

- DB connection pooling
- Async cache (aioredis TTL)
- Background tasks for heavy CPU work
- Stream files with StreamingResponse
- Proper DB indexes
- PerformanceTimer wrapper for critical paths

---

# Security

- No secrets in code (use env or secret manager)
- Validate all inputs with Pydantic
- CORS allow list, never "*" in prod
- Rate-limit APIs (SlowAPI / gateway)
- Sanitize file uploads
- Secure WebSockets (wss) in production

---

# Logging Levels

- **DEBUG** detailed diagnostics
- **INFO** high-level flow
- **WARNING** unusual situations
- **ERROR** request failed, with stack
- **CRITICAL** service unusable

---

# Deployment
- uvicorn[standard] with `--loop uvloop --http httptools`
- Workers = (2 Ã— CPU) + 1
- Env-specific `.env.*` files
- /healthz & /metrics endpoints
- Graceful shutdown hooks
- Memory monitoring & cleanup tasks


# END FILE CONTENTS


# File: frontend/lib/services/base-service.ts

"use client"

/**
 * BaseService - æœå‹™å±¤åŸºç¤æŠ½è±¡é¡
 *
 * æä¾›çµ±ä¸€çš„æœå‹™åŸºç¤è¨­æ–½ï¼š
 * - çµ±ä¸€æ—¥èªŒä»‹é¢
 * - ç”Ÿå‘½é€±æœŸç®¡ç† (initialize/cleanup)
 * - éŒ¯èª¤è™•ç†æ¨¡å¼
 * - æœå‹™ç‹€æ…‹ç®¡ç†
 */
export abstract class BaseService {
    /**
     * æ—¥èªŒå·¥å…· - é‡ç”¨ç¾æœ‰çš„ console æ¨¡å¼
     */
    protected readonly logger = console

    /**
     * æœå‹™åç¨±ï¼Œç”¨æ–¼æ—¥èªŒå’Œèª¿è©¦
     */
    protected abstract readonly serviceName: string

    /**
     * æœå‹™åˆå§‹åŒ–ç‹€æ…‹
     */
    private _isInitialized = false

    /**
     * æœå‹™æ˜¯å¦æ­£åœ¨é‹è¡Œ
     */
    private _isRunning = false

    /**
     * åˆå§‹åŒ–æœå‹™
     * å­é¡å¿…é ˆå¯¦ç¾å…·é«”çš„åˆå§‹åŒ–é‚è¼¯
     */
    abstract initialize(): Promise<void>

    /**
     * æ¸…ç†æœå‹™è³‡æº
     * å­é¡å¿…é ˆå¯¦ç¾å…·é«”çš„æ¸…ç†é‚è¼¯
     */
    abstract cleanup(): Promise<void>

    /**
     * å•Ÿå‹•æœå‹™
     * çµ±ä¸€çš„å•Ÿå‹•æµç¨‹ï¼šæª¢æŸ¥ç‹€æ…‹ â†’ åˆå§‹åŒ– â†’ æ¨™è¨˜ç‚ºé‹è¡Œä¸­
     */
    async start(): Promise<void> {
        if (this._isRunning) {
            this.logger.warn(`ğŸ”„ [${this.serviceName}] æœå‹™å·²åœ¨é‹è¡Œä¸­ï¼Œè·³éå•Ÿå‹•`)
            return
        }

        try {
            this.logger.log(`ğŸš€ [${this.serviceName}] é–‹å§‹å•Ÿå‹•æœå‹™...`)

            if (!this._isInitialized) {
                await this.initialize()
                this._isInitialized = true
                this.logger.log(`âœ… [${this.serviceName}] æœå‹™åˆå§‹åŒ–å®Œæˆ`)
            }

            this._isRunning = true
            this.logger.log(`âœ… [${this.serviceName}] æœå‹™å•Ÿå‹•æˆåŠŸ`)
        } catch (error) {
            this.logger.error(`âŒ [${this.serviceName}] æœå‹™å•Ÿå‹•å¤±æ•—:`, error)
            throw error
        }
    }

    /**
     * åœæ­¢æœå‹™
     * çµ±ä¸€çš„åœæ­¢æµç¨‹ï¼šæª¢æŸ¥ç‹€æ…‹ â†’ æ¸…ç†è³‡æº â†’ æ¨™è¨˜ç‚ºåœæ­¢
     */
    async stop(): Promise<void> {
        if (!this._isRunning) {
            this.logger.warn(`ğŸ”„ [${this.serviceName}] æœå‹™æœªåœ¨é‹è¡Œä¸­ï¼Œè·³éåœæ­¢`)
            return
        }

        try {
            this.logger.log(`ğŸ›‘ [${this.serviceName}] é–‹å§‹åœæ­¢æœå‹™...`)

            await this.cleanup()
            this._isRunning = false

            this.logger.log(`âœ… [${this.serviceName}] æœå‹™åœæ­¢å®Œæˆ`)
        } catch (error) {
            this.logger.error(`âŒ [${this.serviceName}] æœå‹™åœæ­¢å¤±æ•—:`, error)
            throw error
        }
    }

    /**
     * é‡å•Ÿæœå‹™
     * å…ˆåœæ­¢ï¼Œå†å•Ÿå‹•
     */
    async restart(): Promise<void> {
        this.logger.log(`ğŸ”„ [${this.serviceName}] é–‹å§‹é‡å•Ÿæœå‹™...`)
        await this.stop()
        await this.start()
        this.logger.log(`âœ… [${this.serviceName}] æœå‹™é‡å•Ÿå®Œæˆ`)
    }

    /**
     * æª¢æŸ¥æœå‹™æ˜¯å¦å·²åˆå§‹åŒ–
     */
    get isInitialized(): boolean {
        return this._isInitialized
    }

    /**
     * æª¢æŸ¥æœå‹™æ˜¯å¦æ­£åœ¨é‹è¡Œ
     */
    get isRunning(): boolean {
        return this._isRunning
    }

    /**
     * ç²å–æœå‹™ç‹€æ…‹æ‘˜è¦
     */
    getStatus(): ServiceStatus {
        return {
            serviceName: this.serviceName,
            isInitialized: this._isInitialized,
            isRunning: this._isRunning,
            timestamp: new Date().toISOString()
        }
    }

    /**
     * çµ±ä¸€éŒ¯èª¤è™•ç†
     * æä¾›ä¸€è‡´çš„éŒ¯èª¤æ—¥èªŒæ ¼å¼å’ŒéŒ¯èª¤åŒ…è£
     */
    protected handleError(operation: string, error: unknown): never {
        const errorMessage = error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
        const fullMessage = `${this.serviceName} ${operation} å¤±æ•—: ${errorMessage}`

        this.logger.error(`âŒ [${this.serviceName}] ${operation} å¤±æ•—:`, error)

        throw new ServiceError(fullMessage, {
            serviceName: this.serviceName,
            operation,
            originalError: error,
            timestamp: new Date().toISOString()
        })
    }

    /**
     * çµ±ä¸€æˆåŠŸæ—¥èªŒ
     */
    protected logSuccess(operation: string, details?: any): void {
        this.logger.log(`âœ… [${this.serviceName}] ${operation} æˆåŠŸ`, details ? details : '')
    }

    /**
     * çµ±ä¸€è³‡è¨Šæ—¥èªŒ
     */
    protected logInfo(message: string, details?: any): void {
        this.logger.log(`â„¹ï¸ [${this.serviceName}] ${message}`, details ? details : '')
    }

    /**
     * çµ±ä¸€è­¦å‘Šæ—¥èªŒ
     */
    protected logWarning(message: string, details?: any): void {
        this.logger.warn(`âš ï¸ [${this.serviceName}] ${message}`, details ? details : '')
    }
}

/**
 * æœå‹™ç‹€æ…‹ä»‹é¢
 */
export interface ServiceStatus {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    timestamp: string
}

/**
 * æœå‹™éŒ¯èª¤é¡åˆ¥
 * æä¾›çµæ§‹åŒ–çš„éŒ¯èª¤è¨Šæ¯å’Œä¸Šä¸‹æ–‡
 */
export class ServiceError extends Error {
    readonly serviceName: string
    readonly operation: string
    readonly originalError: unknown
    readonly timestamp: string

    constructor(message: string, context: {
        serviceName: string
        operation: string
        originalError: unknown
        timestamp: string
    }) {
        super(message)
        this.name = 'ServiceError'
        this.serviceName = context.serviceName
        this.operation = context.operation
        this.originalError = context.originalError
        this.timestamp = context.timestamp
    }
}


# END FILE CONTENTS


# File: docs/stop-processing-finish-flow.md

# Stop â†’ Processing â†’ Finished ç‹€æ…‹æµè¦æ ¼

## 1. éŒ„éŸ³æµç¨‹ç‹€æ…‹æµ
- ä½¿ç”¨è€…æŒ‰ä¸‹ Stop åœæ­¢éŒ„éŸ³å¾Œï¼ŒAppState é€²å…¥ `processing` ç‹€æ…‹ï¼Œé¡¯ç¤º ProcessingOverlayï¼ŒWebSocket é€£ç·šä¿æŒã€‚
- å¾Œç«¯æœƒå°‡å°šæœªå®Œæˆçš„éŸ³è¨Šåˆ‡ç‰‡å…¨éƒ¨è™•ç†å®Œç•¢ï¼Œé€ä¸€æ¨é€ transcript_segmentã€‚
- æœ€å¾Œä¸€å€‹åˆ‡ç‰‡è™•ç†å®Œç•¢å¾Œï¼Œå¾Œç«¯å»£æ’­ `{type: "transcript_complete"}`ã€‚
- å‰ç«¯æ”¶åˆ° `transcript_complete`ï¼š
  - AppState è½‰ç‚º `finished`
  - æ–·é–‹ WS é€£ç·š
  - é—œé–‰ ProcessingOverlay

## 2. WebSocket ä¿æŒåŸå‰‡
- åœæ­¢éŒ„éŸ³å¾Œï¼Œå‰ç«¯ä¸ç«‹å³æ–·é–‹ transcript WebSocketï¼Œå¿…é ˆç­‰æ”¶åˆ° `transcript_complete` æ‰æ–·ç·šã€‚
- é€™æ¨£å¯ç¢ºä¿æ‰€æœ‰é€å­—ç¨¿ç‰‡æ®µéƒ½èƒ½å®Œæ•´æ”¶åˆ°ã€‚

## 3. transcript_complete è™•ç†
- å‰ç«¯ handleTranscriptMessage éœ€æ–°å¢ `transcript_complete` åˆ†æ”¯ï¼š
  - è½‰æ›ç‹€æ…‹ç‚º finished
  - æ–·é–‹ WS
  - æ¨™è¨˜æµç¨‹çµæŸ

## 4. ProcessingOverlay é¡¯ç¤ºè¦å‰‡
- åªåœ¨ AppState = `processing` æ™‚é¡¯ç¤ºã€‚
- Stop â†’ processing â†’ (æ”¶åˆ° complete) â†’ finishedï¼ŒOverlay è‡ªå‹•æ¶ˆå¤±ã€‚

## 5. ç›¸é—œç’°å¢ƒè®Šæ•¸ fallback
- `labelIntervalSec` éœ€æ­£ç¢º fallbackï¼Œé¿å… undefinedã€‚

## 6. å¾Œç«¯è¡Œç‚º
- æ‰€æœ‰ STT providerï¼ˆwhisper/gpt4o/geminiï¼‰éƒ½éœ€åœ¨æœ€å¾Œä¸€ç‰‡æ®µå¾Œå»£æ’­ `transcript_complete`ã€‚
- å·²ç¢ºèª save_and_push_result() æœƒå»£æ’­æ­¤è¨Šæ¯ã€‚

---

## æ¸¬è©¦é‡é»
- Stop å¾Œé€²å…¥ processingï¼Œæ”¶åˆ° transcript_complete é€²å…¥ finished
- Overlay åªåœ¨ processing é¡¯ç¤º
- provider è·¯å¾‘çš†æœƒå»£æ’­ transcript_complete 


# END FILE CONTENTS


# File: frontend/e2e/offline-recovery.spec.ts

import { test, expect } from '@playwright/test'

test('offline 30s then online resumes', async ({ page }) => {
    await page.goto('/')
    await page.evaluate(() => window.dispatchEvent(new Event('offline')))
    await page.waitForTimeout(30_000)        // éŒ„éŸ³ & æ–·ç¶²
    await page.evaluate(() => window.dispatchEvent(new Event('online')))

    await expect(page.getByText('æš«å­˜æ®µè½å·²å…¨éƒ¨ä¸Šå‚³å®Œæˆ')).toBeVisible()
})


# END FILE CONTENTS


# File: .cursor/rules/ui-rules/create-prototype.mdc

---
description:
globs:
alwaysApply: false
---
# Prototype Creation Rule (for Cursor)

Trigger phrases (case-insensitive)
â€¢ â€œcreate a new prototypeâ€
â€¢ â€œmake a new prototypeâ€
â€¢ â€œcreate prototypeâ€
â€¢ â€œmake prototypeâ€
â€¢ any similar wording

---

## Workflow

1. **Ask for a name (if missing)**
   If the request does **not** include a prototype name, prompt:
   > â€œWhat should the prototype be called?â€

2. **Copy the template**
   Duplicate `app/prototypes/_template` â†’ `app/prototypes/<prototype-name>`.

3. **Create / modify core files** inside the new folder:
   â€¢ `page.tsx`
   â€¢ `styles.module.css`
   â€¢ any additional components or utilities required

4. **Install dependencies** (only if new packages are needed)
   ```bash
   pnpm add <package>
   # or: npm i <package> / yarn add <package>
5.	Register on the homepage
In â app/page.tsx (or wherever the prototypes array lives), append:
{
  path: "/prototypes/<prototype-name>",
  label: "<Prototype Name>"
}
6.	Manual test
â€¢ Start the dev server
â€¢ Confirm the homepage link works
â€¢ Confirm the prototype page renders with no TypeScript / ESLint errors

---

All steps must succeed without errors before the task is considered complete.


# END FILE CONTENTS


# File: app/core/ffmpeg.py

"""
FFmpeg éŸ³è¨Šè½‰æ›æœå‹™ (REST API ç°¡åŒ–æ¶æ§‹)

å¯¦ä½œ WebM åˆ° 16kHz mono PCM çš„è½‰æ›ï¼Œå°ˆé–€è™•ç†å®Œæ•´ 10s æª”æ¡ˆ
"""

import asyncio
import subprocess
import shlex
import logging
from typing import Optional
from dataclasses import dataclass

logger = logging.getLogger(__name__)

# FFmpeg å‘½ä»¤ï¼šWebM è¼¸å…¥ â†’ 16kHz å–®è²é“ PCM è¼¸å‡º
FFMPEG_CMD = "ffmpeg -i pipe:0 -ac 1 -ar 16000 -f s16le pipe:1 -loglevel error"


@dataclass
class WebMHeaderInfo:
    """WebM æª”é ­ä¿¡æ¯æ•¸æ“šé¡"""
    is_complete: bool = False
    has_ebml_header: bool = False
    has_segment: bool = False
    header_size: int = 0
    codec_type: str = "unknown"
    track_count: int = 0
    error_message: Optional[str] = None


def detect_webm_header_info(data: bytes) -> WebMHeaderInfo:
    """
    æª¢æ¸¬ WebM æª”é ­ä¿¡æ¯

    Args:
        data: WebM éŸ³é »äºŒé€²åˆ¶æ•¸æ“š

    Returns:
        WebMHeaderInfo: æª”é ­ä¿¡æ¯
    """
    info = WebMHeaderInfo()

    if not data or len(data) < 16:
        info.error_message = "æ•¸æ“šé•·åº¦ä¸è¶³"
        return info

    try:
        # æª¢æŸ¥ EBML æ¨™é ­ (0x1A45DFA3)
        if data[:4] == b'\x1A\x45\xDF\xA3':
            info.has_ebml_header = True

            # ç°¡å–®æª¢æ¸¬ Segment å…ƒç´  (0x18538067)
            if b'\x18\x53\x80\x67' in data[:1024]:
                info.has_segment = True

                # ä¼°ç®—æª”é ­å¤§å°ï¼ˆç°¡åŒ–ç‰ˆæœ¬ï¼‰
                cluster_pos = data.find(b'\x1F\x43\xB6\x75')  # Cluster æ¨™è¨˜
                if cluster_pos > 0:
                    info.header_size = cluster_pos
                else:
                    info.header_size = min(len(data), 512)  # é è¨­ä¼°ç®—

                info.is_complete = True
                info.codec_type = "opus" if b'Opus' in data[:1024] else "vorbis"
                info.track_count = 1  # ç°¡åŒ–å‡è¨­åªæœ‰ä¸€å€‹éŸ³è»Œ
            else:
                info.error_message = "ç¼ºå°‘ Segment å…ƒç´ "
        else:
            info.error_message = "ç¼ºå°‘ EBML æª”é ­"

    except Exception as e:
        info.error_message = f"æª¢æ¸¬ç•°å¸¸: {str(e)}"

    return info


def is_webm_header_complete(data: bytes) -> bool:
    """
    æª¢æŸ¥ WebM æª”é ­æ˜¯å¦å®Œæ•´

    Args:
        data: WebM éŸ³é »äºŒé€²åˆ¶æ•¸æ“š

    Returns:
        bool: å¦‚æœæª”é ­å®Œæ•´å‰‡è¿”å› True
    """
    if not data or len(data) < 16:
        return False

    # æª¢æŸ¥ EBML æª”é ­
    if data[:4] != b'\x1A\x45\xDF\xA3':
        return False

    # æª¢æŸ¥æ˜¯å¦åŒ…å« Segment å…ƒç´ 
    return b'\x18\x53\x80\x67' in data[:1024]


def detect_audio_format(audio_data: bytes) -> str:
    """
    æª¢æ¸¬éŸ³é »æ ¼å¼

    Args:
        audio_data: éŸ³é »äºŒé€²åˆ¶æ•¸æ“š

    Returns:
        str: æª¢æ¸¬åˆ°çš„éŸ³é »æ ¼å¼ ('webm', 'mp4', 'ogg', 'wav', 'unknown')
    """
    if not audio_data or len(audio_data) < 16:
        return 'unknown'

    # æª¢æŸ¥æª”æ¡ˆé ­ç°½å
    header = audio_data[:16]

    # WebM æ ¼å¼ (EBML header)
    if header.startswith(b'\x1A\x45\xDF\xA3'):
        return 'webm'

    # MP4 æ ¼å¼ (ftypMSNV for fragmented MP4, ftyp for regular MP4)
    if b'ftyp' in header[:8] or header[4:8] == b'ftyp':
        return 'mp4'

    # OGG æ ¼å¼
    if header.startswith(b'OggS'):
        return 'ogg'

    # WAV æ ¼å¼ (RIFF header)
    if header.startswith(b'RIFF') and header[8:12] == b'WAVE':
        return 'wav'

    # æª¢æŸ¥æ›´å¤§ç¯„åœå…§çš„ MP4 æ ¼å¼æ¨™è­˜
    search_range = min(len(audio_data), 64)
    for i in range(search_range - 4):
        if audio_data[i:i+4] == b'ftyp':
            return 'mp4'

    logger.debug(f"Unknown audio format, header: {header.hex()}")
    return 'unknown'


def check_ffmpeg_health() -> dict:
    """
    æª¢æŸ¥ FFmpeg å¥åº·ç‹€æ…‹

    Returns:
        dict: åŒ…å« FFmpeg ç‹€æ…‹ä¿¡æ¯çš„å­—å…¸
    """
    try:
        # æª¢æŸ¥ FFmpeg æ˜¯å¦å¯ç”¨
        result = subprocess.run(['ffmpeg', '-version'],
                              capture_output=True, text=True, timeout=5)

        if result.returncode == 0:
            # è§£æç‰ˆæœ¬ä¿¡æ¯
            version_line = result.stdout.split('\n')[0]
            version = version_line.split(' ')[2] if len(version_line.split(' ')) > 2 else 'unknown'

            return {
                'ffmpeg_available': True,
                'status': 'healthy',
                'version': version,
                'active_processes': 0,  # ç°¡åŒ–ç‰ˆæœ¬ï¼Œä¸è¿½è¸ªæ´»èºé€²ç¨‹
                'pooled_processes': 0,
                'max_processes': 3
            }
        else:
            return {
                'ffmpeg_available': False,
                'status': 'error',
                'error': 'FFmpeg command failed'
            }

    except FileNotFoundError:
        return {
            'ffmpeg_available': False,
            'status': 'not_found',
            'error': 'FFmpeg not installed'
        }
    except subprocess.TimeoutExpired:
        return {
            'ffmpeg_available': False,
            'status': 'timeout',
            'error': 'FFmpeg version check timeout'
        }
    except Exception as e:
        return {
            'ffmpeg_available': False,
            'status': 'error',
            'error': str(e)
        }


async def webm_to_pcm(webm: bytes) -> bytes:
    """
    å°‡ WebM éŸ³è¨Šè½‰æ›ç‚º PCM æ ¼å¼

    è½‰æ›åƒæ•¸ï¼š
    - è¼¸å…¥ï¼šWebM æ ¼å¼éŸ³è¨Šè³‡æ–™
    - è¼¸å‡ºï¼š16kHz å–®è²é“ signed 16-bit little-endian PCM
    - é©ç”¨æ–¼ Azure OpenAI Whisper API

    Args:
        webm: WebM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Returns:
        bytes: PCM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Raises:
        RuntimeError: FFmpeg è½‰æ›å¤±æ•—æ™‚æ‹‹å‡º
    """
    try:
        logger.debug(f"ğŸµ [FFmpeg] é–‹å§‹è½‰æ› WebM â†’ PCM (size: {len(webm)} bytes)")

        # å»ºç«‹ FFmpeg å­ç¨‹åº
        proc = await asyncio.create_subprocess_exec(
            *shlex.split(FFMPEG_CMD),
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )

        # åŸ·è¡Œè½‰æ›
        stdout, stderr = await proc.communicate(webm)

        # æª¢æŸ¥è½‰æ›çµæœ
        if proc.returncode != 0:
            error_msg = stderr.decode('utf-8') if stderr else "Unknown FFmpeg error"
            logger.error(f"âŒ [FFmpeg] è½‰æ›å¤±æ•— (è¿”å›ç¢¼: {proc.returncode}): {error_msg}")
            raise RuntimeError(f"FFmpeg convert failed: {error_msg}")

        if not stdout:
            logger.error("âŒ [FFmpeg] è½‰æ›çµæœç‚ºç©º")
            raise RuntimeError("FFmpeg convert produced no output")

        logger.info(f"âœ… [FFmpeg] WebM â†’ PCM è½‰æ›æˆåŠŸ ({len(webm)} â†’ {len(stdout)} bytes)")
        return stdout

    except asyncio.TimeoutError:
        logger.error("âŒ [FFmpeg] è½‰æ›è¶…æ™‚")
        raise RuntimeError("FFmpeg convert timeout")
    except FileNotFoundError:
        logger.error("âŒ [FFmpeg] FFmpeg ç¨‹åºæœªæ‰¾åˆ°ï¼Œè«‹ç¢ºèªå·²å®‰è£ FFmpeg")
        raise RuntimeError("FFmpeg not found. Please install FFmpeg.")
    except Exception as e:
        logger.error(f"âŒ [FFmpeg] è½‰æ›ç•°å¸¸: {str(e)}")
        raise RuntimeError(f"FFmpeg convert error: {str(e)}")


async def webm_to_wav(webm: bytes) -> Optional[bytes]:
    """
    å°‡ WebM éŸ³è¨Šè½‰æ›ç‚º 16kHz mono 16-bit RIFF-WAV æ ¼å¼

    Args:
        webm: WebM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Returns:
        Optional[bytes]: WAV æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™ï¼Œå¤±æ•—æ™‚å›å‚³ None
    """
    ffmpeg_cmd = "ffmpeg -f webm -i pipe:0 -ac 1 -ar 16000 -f wav -y pipe:1 -loglevel error"
    try:
        logger.debug(f"ğŸµ [FFmpeg] é–‹å§‹è½‰æ› WebM â†’ WAV (size: {len(webm)} bytes)")
        proc = await asyncio.create_subprocess_exec(
            *shlex.split(ffmpeg_cmd),
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )
        stdout, stderr = await proc.communicate(webm)
        if proc.returncode != 0:
            error_msg = stderr.decode('utf-8') if stderr else "Unknown FFmpeg error"
            logger.error(f"âŒ [FFmpeg] WebM â†’ WAV è½‰æ›å¤±æ•— (è¿”å›ç¢¼: {proc.returncode}): {error_msg}")
            return None
        if not stdout:
            logger.error("âŒ [FFmpeg] WebM â†’ WAV è½‰æ›çµæœç‚ºç©º")
            return None
        logger.info(f"âœ… [FFmpeg] WebM â†’ WAV è½‰æ›æˆåŠŸ ({len(webm)} â†’ {len(stdout)} bytes)")
        return stdout
    except asyncio.TimeoutError:
        logger.error("âŒ [FFmpeg] WebM â†’ WAV è½‰æ›è¶…æ™‚")
        return None
    except FileNotFoundError:
        logger.error("âŒ [FFmpeg] FFmpeg ç¨‹åºæœªæ‰¾åˆ°ï¼Œè«‹ç¢ºèªå·²å®‰è£ FFmpeg")
        return None
    except Exception as e:
        logger.error(f"âŒ [FFmpeg] WebM â†’ WAV è½‰æ›ç•°å¸¸: {str(e)}")
        return None


async def validate_webm_audio(webm: bytes) -> bool:
    """
    é©—è­‰ WebM éŸ³è¨Šæª”æ¡ˆæ˜¯å¦æœ‰æ•ˆ

    ä½¿ç”¨ FFmpeg ä¾†æª¢æŸ¥éŸ³è¨Šæª”æ¡ˆçš„å®Œæ•´æ€§å’Œæ ¼å¼

    Args:
        webm: WebM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Returns:
        bool: å¦‚æœéŸ³è¨Šæª”æ¡ˆæœ‰æ•ˆå‰‡è¿”å› True
    """
    try:
        # ä½¿ç”¨ FFmpeg é©—è­‰æ¨¡å¼ï¼ˆä¸ç”¢ç”Ÿè¼¸å‡ºï¼Œåªæª¢æŸ¥æ ¼å¼ï¼‰
        validate_cmd = "ffmpeg -v error -i pipe:0 -f null -"

        proc = await asyncio.create_subprocess_exec(
            *shlex.split(validate_cmd),
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )

        stdout, stderr = await proc.communicate(webm)

        if proc.returncode == 0:
            logger.debug("âœ… [FFmpeg] WebM éŸ³è¨Šæª”æ¡ˆé©—è­‰é€šé")
            return True
        else:
            error_msg = stderr.decode('utf-8') if stderr else "Unknown validation error"
            logger.warning(f"âš ï¸ [FFmpeg] WebM éŸ³è¨Šæª”æ¡ˆé©—è­‰å¤±æ•—: {error_msg}")
            return False

    except Exception as e:
        logger.warning(f"âš ï¸ [FFmpeg] éŸ³è¨Šæª”æ¡ˆé©—è­‰ç•°å¸¸: {str(e)}")
        return False


async def get_audio_info(webm: bytes) -> Optional[dict]:
    """
    ç²å–éŸ³è¨Šæª”æ¡ˆè³‡è¨Š

    Args:
        webm: WebM æ ¼å¼çš„éŸ³è¨ŠäºŒé€²åˆ¶è³‡æ–™

    Returns:
        dict: åŒ…å«éŸ³è¨Šè³‡è¨Šçš„å­—å…¸ï¼Œå¦‚æœå¤±æ•—å‰‡è¿”å› None
    """
    try:
        # ä½¿ç”¨ ffprobe ç²å–éŸ³è¨Šè³‡è¨Š
        probe_cmd = "ffprobe -v quiet -print_format json -show_format -show_streams pipe:0"

        proc = await asyncio.create_subprocess_exec(
            *shlex.split(probe_cmd),
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )

        stdout, stderr = await proc.communicate(webm)

        if proc.returncode == 0 and stdout:
            import json
            info = json.loads(stdout.decode('utf-8'))
            logger.debug(f"ğŸ“Š [FFprobe] éŸ³è¨Šè³‡è¨Š: {info}")
            return info
        else:
            logger.warning("âš ï¸ [FFprobe] ç„¡æ³•ç²å–éŸ³è¨Šè³‡è¨Š")
            return None

    except Exception as e:
        logger.warning(f"âš ï¸ [FFprobe] ç²å–éŸ³è¨Šè³‡è¨Šç•°å¸¸: {str(e)}")
        return None


# END FILE CONTENTS


# File: frontend/components/ui/scroll-area.tsx

"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }


# END FILE CONTENTS


# File: docs/webm-to-wav-gpt4o.md

# WebM â†’ WAV + GPT4oProvider ä¸Šå‚³è¦æ ¼

## ç›®æ¨™
- å°‡ 16-bit mono 16kHz WebM éŸ³è¨Šè½‰æª”ç‚º RIFF-WAV
- ç”± GPT4oProvider ä¸Šå‚³ wav bytes çµ¦ OpenAI APIï¼ˆgpt-4o-transcribeï¼‰
- æ”¯æ´ R2 å¿«å–

## è½‰æª”æµç¨‹
1. å‘¼å« `webm_to_wav(webm: bytes) -> bytes`ï¼š
   - ä½¿ç”¨ ffmpeg è½‰ webm â†’ 16-bit mono 16kHz RIFF-WAV
   - å¤±æ•—æ™‚å›å‚³ None
2. GPT4oProvider:
   - å…ˆæª¢æŸ¥æ ¼å¼ï¼Œåƒ…æ”¯æ´ webm/wav
   - å‘¼å« webm_to_wav å–å¾— wav bytes
   - å¤±æ•—æ™‚ log error ä¸¦ return None
   - æˆåŠŸæ™‚å¯é¸æ“‡æ€§å¿«å–åˆ° R2ï¼ˆput_object, content_type='audio/wav'ï¼‰
   - ä¸Šå‚³æ ¼å¼ï¼š
     ```python
     file_tuple = ("audio.wav", BytesIO(wav_bytes), "audio/wav")
     response = await client.audio.transcriptions.create(
         model=model_name,
         file=file_tuple,
         language="zh-TW",
         response_format="json",
     )
     ```
   - å›å‚³ response['text']

## æ¸¬è©¦é‡é»
- webm_to_wav æœƒæ­£ç¢ºç”¢ç”Ÿ RIFF headerã€16kHzã€monoã€16-bit
- å¤±æ•—æ™‚å›å‚³ None
- GPT4oProvider æœƒå‘¼å« webm_to_wavï¼Œä¸¦æ­£ç¢ºå‚³é€ (filename, BytesIO, mime)
- R2 cache è¡Œç‚ºæ­£ç¢º
- å¤±æ•—æ™‚ log error ä¸¦ return None

## å¯¦ä½œç¾æ³
- `webm_to_wav(webm: bytes) -> Optional[bytes]` å·²å¯¦ä½œæ–¼ `app/core/ffmpeg.py`
- å¤±æ•—æ™‚å›å‚³ None ä¸¦ log error
- å–®å…ƒæ¸¬è©¦å·²è¦†è“‹æˆåŠŸèˆ‡å¤±æ•—æƒ…å¢ƒï¼Œæ¸¬è©¦æª”æ¡ˆï¼š`tests/unit/test_ffmpeg.py`ï¼Œclass: `TestWebMToWav`

## è½‰éŒ„æ¬„ä½å®Œæ•´æ€§è¦æ ¼ï¼ˆ2024-06ï¼‰

### 1. gpt4o_provider.py transcribe() å›å‚³æ ¼å¼
- å¿…é ˆå›å‚³ dictï¼Œä¸”æ¬„ä½é½Šå…¨ï¼š
  - text
  - chunk_sequence
  - timestamp
  - language
  - start_offset
  - end_offset

### 2. SimpleAudioTranscriptionService._save_and_push_result æ¬„ä½æª¢æŸ¥
- å¿…è¦æ¬„ä½ï¼š{"text","chunk_sequence","timestamp","start_offset","end_offset"}
- è‹¥ç¼ºæ¬„ä½ï¼šlog error ä¸¦ returnï¼Œä¸å¯«å…¥ DBã€ä¸æ¨é€ WebSocket
- æ¸¬è©¦è¦†è“‹ï¼špytest é©—è­‰ç¼ºæ¬„ä½æ™‚åª log errorï¼Œä¸æ‹‹ä¾‹å¤–

## ç›¸é—œæª”æ¡ˆ
- app/core/ffmpeg.py
- app/services/stt/gpt4o_provider.py
- tests/unit/test_ffmpeg.py
- tests/test_stt_providers.py 


# END FILE CONTENTS


# File: frontend/lib/api.test.ts

import { describe, it, expect, vi } from 'vitest'

// æ¨¡æ“¬ axios å®Œæ•´é…ç½®
vi.mock('axios', () => ({
    default: {
        create: vi.fn(() => ({
            post: vi.fn().mockResolvedValue({ data: {} }),
            get: vi.fn().mockResolvedValue({ data: {} }),
            patch: vi.fn().mockResolvedValue({ data: {} }),
            put: vi.fn().mockResolvedValue({ data: {} }),
            interceptors: {
                request: {
                    use: vi.fn(),
                },
                response: {
                    use: vi.fn(),
                },
            },
        })),
        isAxiosError: vi.fn(),
    },
}))

describe('API Configuration', () => {
    it('should use environment variables for API_BASE_URL', () => {
        // æ¸¬è©¦ç’°å¢ƒè®Šæ•¸é…ç½®
        const expectedURL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000'
        expect(expectedURL).toBe('http://localhost:8000')
    })

    it('should construct WebSocket URL correctly', async () => {
        // å‹•æ…‹ import ä»¥é¿å…æ¨¡çµ„è¼‰å…¥æ™‚çš„éŒ¯èª¤
        const { getWebSocketURL } = await import('./api')

        const wsURL = getWebSocketURL('/test/path')
        const expectedURL = (process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000') + '/test/path'
        expect(wsURL).toBe(expectedURL)
    })
})

describe('API Methods', () => {
    it('should have all required sessionAPI methods', async () => {
        const { sessionAPI } = await import('./api')

        expect(typeof sessionAPI.createSession).toBe('function')
        expect(typeof sessionAPI.getActiveSession).toBe('function')
        expect(typeof sessionAPI.finishSession).toBe('function')
        expect(typeof sessionAPI.upgradeToRecording).toBe('function')
    })

    it('should have all required notesAPI methods', async () => {
        const { notesAPI } = await import('./api')

        expect(typeof notesAPI.updateNote).toBe('function')
        expect(typeof notesAPI.getNote).toBe('function')
    })
})


# END FILE CONTENTS


# File: frontend/next.config.mjs

/** @type {import('next').NextConfig} */
const nextConfig = {
  eslint: {
    ignoreDuringBuilds: true,
  },
  typescript: {
    ignoreBuildErrors: true,
  },
  images: {
    unoptimized: true,
  },
}

export default nextConfig

# END FILE CONTENTS


# File: frontend/hooks/use-app-state.ts

"use client"

import { useState, useCallback, useEffect, useRef } from "react"
import type { AppData, AppState, SessionStatus, SessionType } from "../types/app-state"
import { useSession } from "./use-session"
import { useRecording } from "./use-recording"
import { useNotes } from "./use-notes"
import { useTranscript } from "./use-transcript"
import { TranscriptMessage } from "../lib/websocket"
import { useToast } from "@/components/ui/use-toast"

// å‰å¾Œç«¯ç‹€æ…‹æ˜ å°„è¦å‰‡
const mapBackendToFrontendState = (
  status: SessionStatus,
  type: SessionType,
  isRecording: boolean,
  transcriptsPresent: boolean
): AppState => {
  const timestamp = Date.now()
  const isoTimestamp = new Date().toISOString()

  console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] è¼¸å…¥åƒæ•¸ (è©³ç´°æ™‚åº):', {
    status,
    type,
    isRecording,
    transcriptsPresent,
    timestamp,
    isoTimestamp,
    note: 'æª¢æŸ¥æ™‚åºå’Œé‚è¼¯æµç¨‹'
  })

  let resultState: AppState

  // è©³ç´°çš„ç‹€æ…‹è½‰æ›é‚è¼¯å’Œæ™‚åºè¿½è¹¤
  switch (status) {
    case "draft":
      resultState = "default"
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] draft â†’ default (æ™‚åºæ­£å¸¸)')
      break
    case "active":
      if (type === "recording") {
        if (!isRecording) {
          resultState = "default"
          console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] recording session ä½† isRecording=false â†’ default (æ™‚åºæª¢æŸ¥é€šé)', {
            timestamp,
            reason: 'recording session inactive'
          })
        } else {
          // é—œéµçš„ç‹€æ…‹è½‰æ›é‚è¼¯ï¼šrecording_waiting â†’ recording_active
          if (transcriptsPresent) {
            resultState = "recording_active"
            console.log(`ğŸ”„ [ç‹€æ…‹æ˜ å°„] âœ… é—œéµè½‰æ›: recording_waiting â†’ recording_active (æ™‚åºæˆåŠŸ)`, {
              transcriptsPresent,
              timestamp,
              trigger: 'first_transcript_received'
            })
          } else {
            resultState = "recording_waiting"
            console.log(`ğŸ”„ [ç‹€æ…‹æ˜ å°„] ä¿æŒ recording_waiting ç‹€æ…‹ (ç­‰å¾…é€å­—ç¨¿)`, {
              transcriptsPresent,
              timestamp,
              waiting: 'for_first_transcript'
            })
          }
        }
      } else {
        resultState = "default"
        console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] active session ä½† type != recording â†’ default', {
          type,
          timestamp
        })
      }
      break
    case "processing":
      resultState = "processing"
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] processing â†’ processing (æ™‚åºæ­£å¸¸)', { timestamp })
      break
    case "completed":
      resultState = "finished"
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] completed â†’ finished (æ™‚åºæ­£å¸¸)', { timestamp })
      break
    case "error":
      resultState = "default" // éŒ¯èª¤æ™‚å›åˆ°é è¨­ç‹€æ…‹
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] error â†’ default (éŒ¯èª¤æ¢å¾©)', {
        timestamp,
        recovery: true
      })
      break
    default:
      resultState = "default"
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] unknown â†’ default (å®‰å…¨å›é€€)', {
        unknownStatus: status,
        timestamp
      })
      break
  }

  console.log(`ğŸ”„ [ç‹€æ…‹æ˜ å°„] æœ€çµ‚çµæœ (æ™‚åºè¿½è¹¤): ${status}(${type}) â†’ ${resultState}`, {
    inputParams: { status, type, isRecording, transcriptsPresent },
    output: resultState,
    timestamp,
    duration: Date.now() - timestamp
  })

  return resultState
}

export function useAppState() {
  const [appData, setAppData] = useState<AppData>({
    state: "default",
    transcriptEntries: [],
    editorContent: "",
    isRecording: false,
    recordingTime: 0,
    session: null,
  })

  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  // ä½¿ç”¨å„å€‹å°ˆé–€çš„ hooks
  const session = useSession()
  const recording = useRecording()
  const notes = useNotes()
  const transcript = useTranscript()
  const { toast } = useToast()

  // ä½¿ç”¨ useRef è¿½è¹¤å‰ä¸€å€‹ç‹€æ…‹å€¼ï¼Œé¿å…å¾ªç’°ä¾è³´
  const prevStateRef = useRef<AppState>('default')
  const prevTranscriptCompletedRef = useRef(false)
  const prevErrorStateRef = useRef<{ recording: string | null, transcript: string | null }>({
    recording: null,
    transcript: null
  })

  // å„ªåŒ–çš„ç‹€æ…‹æ˜ å°„å‡½æ•¸ï¼Œç¢ºä¿æ™‚åºå¯é æ¸¬æ€§
  const mapStateFromSession = useCallback((
    currentSession: any,
    isRecording: boolean,
    transcripts: any[]
  ) => {
    const executionTimestamp = Date.now()

    if (!currentSession) {
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] ç„¡æ´»èºæœƒè©± â†’ default', { executionTimestamp })
      return 'default'
    }

    // å¯¦ä½œæ›´å¯é çš„ transcriptsPresent è¨ˆç®—
    const transcriptsPresent = Array.isArray(transcripts) && transcripts.length > 0

    console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] åŸ·è¡Œæ™‚åºæª¢æŸ¥:', {
      sessionId: currentSession.id,
      sessionStatus: currentSession.status,
      sessionType: currentSession.type,
      isRecording,
      transcriptCount: transcripts.length,
      transcriptsPresent,
      executionTimestamp,
      transcriptsSample: transcripts.slice(0, 2).map(t => ({
        text: t.text?.substring(0, 30) + '...',
        start_time: t.start_time,
        type: t.type
      })),
      note: 'æ™‚åºåŒæ­¥æª¢æŸ¥å®Œæˆ'
    })

    const result = mapBackendToFrontendState(
      currentSession.status,
      currentSession.type,
      isRecording,
      transcriptsPresent
    )

    console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] åŸ·è¡Œçµæœ:', {
      input: {
        sessionStatus: currentSession.status,
        sessionType: currentSession.type,
        isRecording,
        transcriptsPresent
      },
      output: result,
      executionTimestamp,
      executionDuration: Date.now() - executionTimestamp
    })

    return result
  }, [])

  // ç‹€æ…‹åŒæ­¥ï¼šå‰ç«¯ç‹€æ…‹èˆ‡å¾Œç«¯ session status å°æ‡‰ - å¼·åŒ–ä¸€è‡´æ€§
  useEffect(() => {
    const activeSession = session.currentSession
    const effectExecutionTime = Date.now()

    console.log('ğŸ”„ [ç‹€æ…‹åŒæ­¥] useEffect è§¸ç™¼ (å¼·åŒ–ä¸€è‡´æ€§ç‰ˆ):', {
      hasActiveSession: !!activeSession,
      sessionId: activeSession?.id,
      sessionStatus: activeSession?.status,
      sessionType: activeSession?.type,
      recordingIsRecording: recording.isRecording,
      appDataIsRecording: appData.isRecording,
      isRecordingConsistent: recording.isRecording === appData.isRecording,
      transcriptCount: transcript.transcripts.length,
      recordingTranscriptCount: recording.transcripts.length,
      currentAppState: prevStateRef.current,
      effectExecutionTime,
      note: 'å¼·åŒ–éŒ„éŸ³ç‹€æ…‹ä¸€è‡´æ€§æª¢æŸ¥'
    })

    if (activeSession) {
      // ç¢ºä¿ä½¿ç”¨æœ€æ–°çš„ recording.transcripts ç‹€æ…‹
      const latestTranscripts = recording.transcripts
      const transcriptsPresent = Array.isArray(latestTranscripts) && latestTranscripts.length > 0

      console.log('ğŸ”„ [ç‹€æ…‹åŒæ­¥] é€å­—ç¨¿ç‹€æ…‹è¨ˆç®— (æ™‚åºä¿è­‰):', {
        recordingTranscriptCount: latestTranscripts.length,
        transcriptsPresent,
        latestTranscriptTime: latestTranscripts[latestTranscripts.length - 1]?.start_time,
        latestTranscriptText: latestTranscripts[latestTranscripts.length - 1]?.text?.substring(0, 30) + '...',
        effectExecutionTime,
        note: 'å·²ç¢ºä¿æ™‚åºåŒæ­¥'
      })

      // é—œéµä¿®å¾©ï¼šå¼·åˆ¶ä½¿ç”¨ recording.isRecording è€Œä¸æ˜¯ appData.isRecording
      // é€™ç¢ºä¿ç‹€æ…‹æ˜ å°„é‚è¼¯ä½¿ç”¨æœ€æ–°çš„éŒ„éŸ³ç‹€æ…‹
      const frontendState = mapStateFromSession(
        activeSession,
        recording.isRecording, // ç›´æ¥ä½¿ç”¨ recording hook çš„ç‹€æ…‹
        latestTranscripts
      )

      // æª¢æŸ¥æ˜¯å¦éœ€è¦åŒæ™‚æ›´æ–° isRecording å’Œ state
      const needsIsRecordingUpdate = appData.isRecording !== recording.isRecording
      const needsStateUpdate = frontendState !== prevStateRef.current

      if (needsIsRecordingUpdate || needsStateUpdate) {
        console.log(`ğŸ”„ [ç‹€æ…‹åŒæ­¥] åŸ·è¡Œç‹€æ…‹æ›´æ–°:`, {
          needsIsRecordingUpdate,
          needsStateUpdate,
          appDataIsRecording: appData.isRecording,
          recordingIsRecording: recording.isRecording,
          previousState: prevStateRef.current,
          newState: frontendState,
          stateChangeTimestamp: Date.now(),
          executionDuration: Date.now() - effectExecutionTime,
          triggerSource: 'comprehensive_state_sync'
        })

        setAppData(prev => ({
          ...prev,
          state: frontendState,
          isRecording: recording.isRecording, // åŒæ™‚å¼·åˆ¶åŒæ­¥ isRecording
        }))

        prevStateRef.current = frontendState
      } else {
        console.log('ğŸ”„ [ç‹€æ…‹åŒæ­¥] æ‰€æœ‰ç‹€æ…‹ä¸€è‡´ï¼Œè·³éæ›´æ–°', {
          currentState: frontendState,
          isRecording: recording.isRecording,
          executionTime: Date.now() - effectExecutionTime
        })
      }
    }
  }, [session.currentSession, recording.isRecording, recording.transcripts, mapStateFromSession])
  // ä¾è³´æ–¼ recording.transcripts è€Œé lengthï¼Œç¢ºä¿å…§å®¹è®ŠåŒ–æ™‚è§¸ç™¼ç‹€æ…‹åŒæ­¥

  // åˆå§‹åŒ–æ‡‰ç”¨ç‹€æ…‹ - åªåœ¨çµ„ä»¶æ›è¼‰æ™‚åŸ·è¡Œä¸€æ¬¡
  useEffect(() => {
    let isMounted = true

    const initializeApp = async () => {
      console.log('ğŸš€ åˆå§‹åŒ–æ‡‰ç”¨ç‹€æ…‹...')
      setIsLoading(true)

      try {
        // æª¢æŸ¥æ˜¯å¦æœ‰æ´»èºæœƒè©±
        const activeSession = await session.checkActiveSession()
        if (!isMounted) return // çµ„ä»¶å·²å¸è¼‰ï¼Œåœæ­¢åŸ·è¡Œ

        if (activeSession) {
          // è¼‰å…¥ç­†è¨˜å…§å®¹
          await notes.loadNote(activeSession.id)
        } else {
          // æª¢æŸ¥æ˜¯å¦æœ‰æœ¬åœ°è‰ç¨¿
          const draftContent = localStorage.getItem('draft_note')
          if (draftContent) {
            setAppData(prev => ({ ...prev, editorContent: draftContent }))
            console.log('ğŸ“ è¼‰å…¥æœ¬åœ°è‰ç¨¿')
          }
        }
      } catch (error) {
        if (!isMounted) return // çµ„ä»¶å·²å¸è¼‰ï¼Œåœæ­¢åŸ·è¡Œ

        // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œä¸è¦æ‹‹å‡ºéŒ¯èª¤ï¼Œè®“ç”¨æˆ¶æ­£å¸¸ä½¿ç”¨æ‡‰ç”¨
        if (error instanceof Error && error.message.includes('Network Error')) {
          console.warn('âš ï¸ åˆå§‹åŒ–æ™‚ Backend é€£ç·šå¤±æ•—ï¼Œä½¿ç”¨é›¢ç·šæ¨¡å¼:', error.message)

          // æª¢æŸ¥æ˜¯å¦æœ‰æœ¬åœ°è‰ç¨¿
          const draftContent = localStorage.getItem('draft_note')
          if (draftContent) {
            setAppData(prev => ({ ...prev, editorContent: draftContent }))
            console.log('ğŸ“ é›¢ç·šæ¨¡å¼ï¼šè¼‰å…¥æœ¬åœ°è‰ç¨¿')
          }
        } else {
          console.error('âŒ åˆå§‹åŒ–å¤±æ•—:', error)
          setError(error instanceof Error ? error.message : 'åˆå§‹åŒ–å¤±æ•—')
        }
      } finally {
        if (isMounted) {
          setIsLoading(false)
        }
      }
    }

    initializeApp()

    return () => {
      isMounted = false
    }
  }, []) // ç©ºä¾è³´é …ï¼Œåªåœ¨çµ„ä»¶æ›è¼‰æ™‚åŸ·è¡Œä¸€æ¬¡

  // åŒæ­¥éŒ„éŸ³ç‹€æ…‹ - å¼·åŒ–ä¸€è‡´æ€§æª¢æŸ¥
  useEffect(() => {
    console.log('ğŸ”„ [éŒ„éŸ³ç‹€æ…‹åŒæ­¥] æ›´æ–° appData.isRecording:', {
      from: appData.isRecording,
      to: recording.isRecording,
      recordingTime: recording.recordingTime,
      timestamp: Date.now(),
      needsUpdate: appData.isRecording !== recording.isRecording
    })

    // å¼·åˆ¶åŒæ­¥éŒ„éŸ³ç‹€æ…‹ï¼Œç¢ºä¿ä¸€è‡´æ€§
    setAppData(prev => {
      const needsUpdate = prev.isRecording !== recording.isRecording || prev.recordingTime !== recording.recordingTime

      if (needsUpdate) {
        console.log('ğŸ”„ [éŒ„éŸ³ç‹€æ…‹åŒæ­¥] åŸ·è¡Œç‹€æ…‹æ›´æ–°:', {
          prevIsRecording: prev.isRecording,
          newIsRecording: recording.isRecording,
          prevRecordingTime: prev.recordingTime,
          newRecordingTime: recording.recordingTime
        })
      }

      return {
        ...prev,
        isRecording: recording.isRecording,
        recordingTime: recording.recordingTime,
      }
    })
  }, [recording.isRecording, recording.recordingTime])

  // ç§»é™¤é‡è¤‡çš„ç‹€æ…‹ä¸€è‡´æ€§æª¢æŸ¥ï¼Œå·²æ•´åˆåˆ°ä¸»è¦ç‹€æ…‹åŒæ­¥é‚è¼¯ä¸­

  // åŒæ­¥ç­†è¨˜å…§å®¹
  useEffect(() => {
    setAppData(prev => ({
      ...prev,
      editorContent: notes.noteContent,
    }))
  }, [notes.noteContent])

  // è™•ç†é€å­—ç¨¿æ›´æ–° - çµ±ä¸€ä½¿ç”¨ recording.transcripts
  useEffect(() => {
    console.log('ğŸ“ [é€å­—ç¨¿æ›´æ–°] useEffect è§¸ç™¼:', {
      recordingTranscriptCount: recording.transcripts.length,
      recordingTranscripts: recording.transcripts,
      currentState: appData.state,
      isRecording: appData.isRecording,
      note: 'çµ±ä¸€ä½¿ç”¨ recording.transcriptsï¼Œé¿å…é›™é‡ç®¡ç†'
    })

    const transcriptEntries = recording.transcripts.map((transcriptMsg: TranscriptMessage) => {
      // ä½¿ç”¨ start_time ä¸¦è½‰æ›ç‚º HH:MM:SS æ ¼å¼
      const startTime = transcriptMsg.start_time ?? 0
      const hours = Math.floor(startTime / 3600)
      const minutes = Math.floor((startTime % 3600) / 60)
      const seconds = Math.floor(startTime % 60)
      const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

      console.log('ğŸ“ [é€å­—ç¨¿è½‰æ›] å–®å€‹ç‰‡æ®µ:', {
        text: transcriptMsg.text,
        timeStr,
        startTime,
        type: transcriptMsg.type
      })

      return {
        time: timeStr,
        text: transcriptMsg.text ?? '',
      }
    })

    console.log('ğŸ“ [é€å­—ç¨¿æ›´æ–°] è½‰æ›å®Œæˆ:', {
      entriesCount: transcriptEntries.length,
      entries: transcriptEntries,
      firstEntry: transcriptEntries[0]?.text?.substring(0, 30) + '...',
      appDataBefore: appData.transcriptEntries
    })

    setAppData(prev => {
      console.log('ğŸ“ [é€å­—ç¨¿æ›´æ–°] setAppData åŸ·è¡Œ:', {
        prevTranscriptEntries: prev.transcriptEntries,
        newTranscriptEntries: transcriptEntries,
        isChanged: prev.transcriptEntries !== transcriptEntries
      })
      return {
        ...prev,
        transcriptEntries,
      }
    })
  }, [recording.transcripts])

  // ç›£è½è½‰éŒ„å®Œæˆï¼Œè‡ªå‹•è½‰ç‚º finished ç‹€æ…‹
  useEffect(() => {
    const currentCompleted = transcript.isCompleted
    const wasCompleted = prevTranscriptCompletedRef.current

    // åªåœ¨è½‰éŒ„ç‹€æ…‹å¾ false è®Šç‚º true æ™‚è™•ç†
    if (currentCompleted && !wasCompleted && prevStateRef.current === "processing") {
      console.log('ğŸ”„ [è½‰éŒ„å®Œæˆ] è½‰éŒ„å®Œæˆï¼Œè½‰ç‚º finished ç‹€æ…‹')

      setAppData(prev => {
        const newState = "finished"
        prevStateRef.current = newState
        return { ...prev, state: newState }
      })

      // å®Œæˆæœƒè©±
      if (session.currentSession) {
        session.finishSession().catch(console.error)
      }
    }

    prevTranscriptCompletedRef.current = currentCompleted
  }, [
    transcript.isCompleted,
    session.currentSession,
    session.finishSession
  ])

  // ç›£è½éŒ„éŸ³å’Œè½‰éŒ„éŒ¯èª¤ï¼Œè™•ç†éŒ¯èª¤ç‹€æ…‹
  useEffect(() => {
    const recordingError = recording.error
    const transcriptError = transcript.error
    const prevErrors = prevErrorStateRef.current

    // åªåœ¨éŒ¯èª¤ç‹€æ…‹çœŸæ­£æ”¹è®Šæ™‚è™•ç†ï¼ˆé¿å…é‡è¤‡è™•ç†åŒæ¨£çš„éŒ¯èª¤ï¼‰
    if ((recordingError !== prevErrors.recording) || (transcriptError !== prevErrors.transcript)) {
      if (recordingError || transcriptError) {
        console.log('ğŸš¨ [éŒ¯èª¤è™•ç†] æª¢æ¸¬åˆ°éŒ¯èª¤:', {
          recordingError,
          transcriptError,
          currentState: prevStateRef.current,
          sessionId: session.currentSession?.id
        })

        const currentState = prevStateRef.current

        // å¦‚æœæ˜¯éŒ„éŸ³ç›¸é—œéŒ¯èª¤ï¼Œåœæ­¢éŒ„éŸ³ä¸¦å›åˆ°é è¨­ç‹€æ…‹
        if (currentState === "recording_waiting" || currentState === "recording_active") {
          console.log('ğŸš¨ [éŒ¯èª¤è™•ç†] éŒ„éŸ³ç‹€æ…‹éŒ¯èª¤ï¼Œåœæ­¢éŒ„éŸ³ä¸¦å›åˆ°é è¨­ç‹€æ…‹')

          // åœæ­¢éŒ„éŸ³
          recording.stopRecording()

          // æ¸…ç†é€£ç·š
          transcript.disconnect()

          // å›åˆ°é è¨­ç‹€æ…‹
          setAppData(prev => {
            prevStateRef.current = "default"
            return { ...prev, state: "default" }
          })

          // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const errorMessage = recordingError || transcriptError || 'éŒ„éŸ³æˆ–è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤'
          toast({
            title: 'éŒ„éŸ³éŒ¯èª¤',
            description: errorMessage,
            variant: 'destructive',
          })
        }

        // å¦‚æœæ˜¯è™•ç†ç‹€æ…‹çš„éŒ¯èª¤ï¼Œä¹Ÿå›åˆ°é è¨­ç‹€æ…‹
        if (currentState === "processing") {
          console.log('ğŸš¨ [éŒ¯èª¤è™•ç†] è™•ç†ç‹€æ…‹éŒ¯èª¤ï¼Œå›åˆ°é è¨­ç‹€æ…‹')

          setAppData(prev => {
            prevStateRef.current = "default"
            return { ...prev, state: "default" }
          })

          const errorMessage = transcriptError || recordingError || 'è™•ç†è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤'
          toast({
            title: 'è™•ç†éŒ¯èª¤',
            description: errorMessage,
            variant: 'destructive',
          })
        }
      }

      // æ›´æ–°éŒ¯èª¤ç‹€æ…‹è¿½è¹¤
      prevErrorStateRef.current = {
        recording: recordingError,
        transcript: transcriptError
      }
    }
  }, [recording.error, transcript.error, session.currentSession, recording, transcript, toast])

  // å»ºç«‹ç´”ç­†è¨˜æœƒè©±
  const createNoteSession = useCallback(async (title?: string) => {
    setIsLoading(true)
    setError(null)

    try {
      const newSession = await session.createNoteSession(title)
      if (newSession) {
        // è¼‰å…¥ç­†è¨˜å…§å®¹
        await notes.loadNote(newSession.id)

        // æ¸…é™¤æœ¬åœ°è‰ç¨¿
        localStorage.removeItem('draft_note')

        console.log('âœ… ç´”ç­†è¨˜æœƒè©±å»ºç«‹æˆåŠŸ')

        toast({
          title: 'ç­†è¨˜æœƒè©±å·²å»ºç«‹',
          description: `æœƒè©± "${title}" å»ºç«‹æˆåŠŸ`,
        })
      }
    } catch (err) {
      // ç‰¹åˆ¥è™•ç†æœƒè©±è¡çªéŒ¯èª¤
      if (err instanceof Error && err.message.includes('æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çª')) {
        const conflictMsg = 'åµæ¸¬åˆ°æœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
        console.error("ğŸ¤ startRecording: æœƒè©±è¡çªéŒ¯èª¤:", err.message)
        setError(conflictMsg)
        toast({
          title: 'æœƒè©±è¡çª',
          description: 'ç›®å‰å·²æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–ç­‰å¾…ç•¶å‰æœƒè©±çµæŸ',
          variant: 'destructive'
        })
        return
      }

      const msg = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      console.error("ğŸ¤ startRecording: æµç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:", msg)
      setError(msg)
      toast({ title: 'éŒ„éŸ³å¤±æ•—', description: msg, variant: 'destructive' })
    } finally {
      setIsLoading(false)
      console.log("ğŸ¤ startRecording: æµç¨‹çµæŸ")
    }
  }, [session, recording, transcript, appData.editorContent, toast])

  // å»ºç«‹éŒ„éŸ³æœƒè©±
  const createRecordingSession = useCallback(async (title?: string) => {
    setIsLoading(true)
    setError(null)

    try {
      const newSession = await session.createRecordingSession(title, appData.editorContent)
      if (newSession) {
        // è¼‰å…¥ç­†è¨˜å…§å®¹
        await notes.loadNote(newSession.id)

        // æ¸…é™¤æœ¬åœ°è‰ç¨¿
        localStorage.removeItem('draft_note')

        console.log('âœ… éŒ„éŸ³æœƒè©±å»ºç«‹æˆåŠŸ')

        toast({
          title: 'éŒ„éŸ³æœƒè©±å·²å»ºç«‹',
          description: `æœƒè©± "${title}" å»ºç«‹æˆåŠŸ`,
        })
      }
    } catch (err) {
      // ç‰¹åˆ¥è™•ç†æœƒè©±è¡çªéŒ¯èª¤
      if (err instanceof Error && err.message.includes('æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çª')) {
        const conflictMsg = 'åµæ¸¬åˆ°æœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
        console.error("ğŸ¤ createRecordingSession: æœƒè©±è¡çªéŒ¯èª¤:", err.message)
        setError(conflictMsg)
        toast({
          title: 'æœƒè©±è¡çª',
          description: 'ç›®å‰å·²æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–ç­‰å¾…ç•¶å‰æœƒè©±çµæŸ',
          variant: 'destructive'
        })
        return
      }

      const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å»ºç«‹å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [session, notes, toast, appData.editorContent])

  // é–‹å§‹éŒ„éŸ³ - æ”¯æ´å››ç‹€æ…‹æµç¨‹
  const startRecording = useCallback(async (title?: string) => {
    console.log("ğŸ¤ startRecording: æµç¨‹é–‹å§‹")
    setIsLoading(true)
    try {
      // å…ˆæª¢æŸ¥æ˜¯å¦æœ‰æ´»èºæœƒè©±ï¼Œç¢ºä¿å‰ç«¯ç‹€æ…‹èˆ‡å¾Œç«¯åŒæ­¥
      console.log("ğŸ¤ startRecording: æª¢æŸ¥æ´»èºæœƒè©±ç‹€æ…‹")
      const latestActiveSession = await session.checkActiveSession()

      let sessionToRecord = latestActiveSession || session.currentSession
      console.log("ğŸ¤ startRecording: æœƒè©±ç‹€æ…‹æª¢æŸ¥çµæœ:", {
        latestActiveSession: latestActiveSession?.id,
        currentSession: session.currentSession?.id,
        finalSessionToUse: sessionToRecord?.id
      })

      if (latestActiveSession && !session.currentSession) {
        console.log("ğŸ¤ startRecording: æª¢æ¸¬åˆ°æ´»èºæœƒè©±ï¼ŒåŒæ­¥å‰ç«¯ç‹€æ…‹")
      }

      if (!sessionToRecord) {
        console.log("ğŸ¤ startRecording: æ²’æœ‰ sessionï¼Œå»ºç«‹æ–°çš„éŒ„éŸ³ session")
        const newSession = await session.createRecordingSession(title, appData.editorContent)
        if (!newSession) {
          console.error("ğŸ¤ startRecording: å»ºç«‹ session å¤±æ•—ï¼Œå›å‚³å€¼ç‚º null")
          throw new Error('ç„¡æ³•å»ºç«‹æ–°çš„éŒ„éŸ³æœƒè©±')
        }
        console.log("ğŸ¤ startRecording: Session å»ºç«‹æˆåŠŸ:", newSession)
        sessionToRecord = newSession
        localStorage.removeItem('draft_note')
      } else if (sessionToRecord.type === 'note_only') {
        console.log("ğŸ¤ startRecording: åµæ¸¬åˆ° note_only sessionï¼Œé€²è¡Œå‡ç´š")
        const upgradedSession = await session.upgradeToRecording()
        if (!upgradedSession) {
          console.error("ğŸ¤ startRecording: å‡ç´š session å¤±æ•—ï¼Œå›å‚³å€¼ç‚º null")
          throw new Error('ç„¡æ³•å‡ç´šæœƒè©±')
        }
        console.log("ğŸ¤ startRecording: Session å‡ç´šæˆåŠŸ:", upgradedSession)
        sessionToRecord = upgradedSession
      } else if (sessionToRecord.type === 'recording') {
        console.log("ğŸ¤ startRecording: ä½¿ç”¨ç¾æœ‰çš„éŒ„éŸ³æœƒè©±:", sessionToRecord.id)
      }

      console.log("ğŸ¤ startRecording: æº–å‚™å‘¼å« recording.startRecording")
      // recording.startRecording ä½¿ç”¨ TranscriptManagerï¼Œçµ±ä¸€ç®¡ç†é€å­—ç¨¿é€£æ¥
      await recording.startRecording(sessionToRecord.id)
      console.log("ğŸ¤ startRecording: recording.startRecording å‘¼å«å®Œç•¢")

      console.log("ğŸ¤ startRecording: è·³é transcript.connectï¼Œé¿å…é›™é‡ç›£è½å™¨")
      // ç§»é™¤é‡è¤‡é€£æ¥ï¼šuseRecording å·²ç¶“é€é TranscriptManager é€£æ¥é€å­—ç¨¿
      // é¿å… useTranscript å’Œ useRecording åŒæ™‚æ·»åŠ ç›£è½å™¨å°è‡´ç«¶çˆ­æ¢ä»¶
      console.log("ğŸ¤ startRecording: é€å­—ç¨¿å°‡ç”± useRecording hook çµ±ä¸€ç®¡ç†")

      toast({ title: 'éŒ„éŸ³é–‹å§‹' })
    } catch (err) {
      // ç‰¹åˆ¥è™•ç†æœƒè©±è¡çªéŒ¯èª¤
      if (err instanceof Error && err.message.includes('æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çª')) {
        const conflictMsg = 'åµæ¸¬åˆ°æœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
        console.error("ğŸ¤ startRecording: æœƒè©±è¡çªéŒ¯èª¤:", err.message)
        setError(conflictMsg)
        toast({
          title: 'æœƒè©±è¡çª',
          description: 'ç›®å‰å·²æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–ç­‰å¾…ç•¶å‰æœƒè©±çµæŸ',
          variant: 'destructive'
        })
        return
      }

      const msg = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      console.error("ğŸ¤ startRecording: æµç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:", msg)
      setError(msg)
      toast({ title: 'éŒ„éŸ³å¤±æ•—', description: msg, variant: 'destructive' })
    } finally {
      setIsLoading(false)
      console.log("ğŸ¤ startRecording: æµç¨‹çµæŸ")
    }
  }, [session, recording, transcript, appData.editorContent, toast])

  // å‡ç´šæœƒè©±ç‚ºéŒ„éŸ³æ¨¡å¼
  const upgradeToRecording = useCallback(async () => {
    setIsLoading(true)
    setError(null)

    try {
      const updatedSession = await session.upgradeToRecording()
      if (updatedSession) {
        console.log('âœ… æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼æˆåŠŸ')

        toast({
          title: 'å‡ç´šæˆåŠŸ',
          description: 'æœƒè©±å·²å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼',
        })
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å‡ç´šæœƒè©±å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ å‡ç´šæœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å‡ç´šå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [session, toast])

  // åœæ­¢éŒ„éŸ³ - è‡ªå‹•è½‰ç‚º processing ç‹€æ…‹
  const stopRecording = useCallback(async () => {
    setIsLoading(true)
    setError(null)

    try {
      await recording.stopRecording()

      // æ–·é–‹ transcript é€£æ¥
      transcript.disconnect()

      // ç‹€æ…‹è½‰ç‚º processing
      setAppData(prev => ({ ...prev, state: "processing" }))

      console.log('âœ… éŒ„éŸ³åœæ­¢ï¼Œé–‹å§‹è™•ç†é€å­—ç¨¿')

      toast({
        title: 'è™•ç†ä¸­',
        description: 'æ­£åœ¨è™•ç†éŒ„éŸ³å…§å®¹ï¼Œè«‹ç¨å€™...',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ åœæ­¢éŒ„éŸ³å¤±æ•—:', err)

      toast({
        title: 'åœæ­¢å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [recording, toast])

  // å®Œæˆæœƒè©±
  const finishSession = useCallback(async () => {
    setIsLoading(true)
    setError(null)

    try {
      await session.finishSession()
      console.log('âœ… æœƒè©±å®Œæˆ')

      toast({
        title: 'æœƒè©±å®Œæˆ',
        description: 'æ‚¨å¯ä»¥åŒ¯å‡ºç­†è¨˜æˆ–é–‹å§‹æ–°çš„ç­†è¨˜',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å®Œæˆæœƒè©±å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ å®Œæˆæœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å®Œæˆå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [session, toast])

  // é–‹æ–°ç­†è¨˜ - æ¸…ç©ºç•¶å‰è³‡æ–™ï¼Œç‹€æ…‹å›åˆ° default
  const newNote = useCallback(async () => {
    setIsLoading(true)
    setError(null)

    try {
      // å¦‚æœæœ‰æ´»èºæœƒè©±ï¼Œå…ˆåˆªé™¤å®ƒ
      if (session.currentSession) {
        console.log('ğŸ—‘ï¸ åˆªé™¤ç•¶å‰æ´»èºæœƒè©±:', session.currentSession.id)
        await session.deleteSession()
        console.log('âœ… æœƒè©±åˆªé™¤æˆåŠŸ')
      }

      // æ¸…ç©ºç•¶å‰è³‡æ–™
      setAppData({
        state: "default",
        transcriptEntries: [],
        editorContent: "",
        isRecording: false,
        recordingTime: 0,
      })

      // æ¸…é™¤éŒ„éŸ³å’Œé€å­—ç¨¿ç‹€æ…‹
      recording.clearTranscripts()
      transcript.clearTranscripts()
      notes.clearNote()

      // æ¸…é™¤æœ¬åœ°è‰ç¨¿
      localStorage.removeItem('draft_note')

      console.log('ğŸ”„ å·²é–‹å§‹æ–°ç­†è¨˜')

      toast({
        title: 'æ–°ç­†è¨˜',
        description: 'å·²æ¸…ç©ºå…§å®¹ï¼Œå¯ä»¥é–‹å§‹æ–°çš„ç­†è¨˜',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'é–‹å§‹æ–°ç­†è¨˜å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ é–‹å§‹æ–°ç­†è¨˜å¤±æ•—:', err)

      toast({
        title: 'æ“ä½œå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [session, recording, transcript, notes, toast])

  // è‡ªå‹•å„²å­˜ç­†è¨˜å…§å®¹åˆ°æœ¬åœ°è‰ç¨¿
  const saveLocalDraft = useCallback((content: string) => {
    if (!session.currentSession && content.trim()) {
      localStorage.setItem('draft_note', content)
    }
  }, [session.currentSession])

  return {
    // æ‡‰ç”¨ç‹€æ…‹
    appData,
    isLoading,
    error,

    // æœƒè©±ç®¡ç†
    createNoteSession,
    createRecordingSession,
    upgradeToRecording,
    finishSession,
    newNote,

    // éŒ„éŸ³æ§åˆ¶
    startRecording,
    stopRecording,

    // æœ¬åœ°è‰ç¨¿
    saveLocalDraft,

    // å¤–éƒ¨ç‹€æ…‹
    session: session.currentSession,
    sessionLoading: session.isLoading,
    sessionError: session.error,

    // éŒ„éŸ³ç‹€æ…‹
    recordingError: recording.error,

    // é€å­—ç¨¿ç‹€æ…‹
    transcriptConnected: transcript.isConnected,
    transcriptError: transcript.error,
    transcriptAutoScroll: transcript.autoScrollEnabled,
    enableAutoScroll: transcript.enableAutoScroll,
    disableAutoScroll: transcript.disableAutoScroll,
    scrollToLatest: transcript.scrollToLatest,
  }
}

export { mapBackendToFrontendState }


# END FILE CONTENTS


# File: app/utils/timer.py

import time, logging
logger = logging.getLogger(__name__)

class PerformanceTimer:
    """with PerformanceTimer("name"): ..."""

    def __init__(self, label: str):
        self.label = label
        self._t0: float | None = None

    def __enter__(self):
        self._t0 = time.perf_counter()
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        t_spent = (time.perf_counter() - self._t0) * 1000
        logger.debug("â±ï¸  %s took %.1f ms", self.label, t_spent)


# END FILE CONTENTS


# File: app/utils/timing.py

from app.core.config import get_settings
_CHUNK = get_settings().AUDIO_CHUNK_DURATION_SEC

def calc_times(seq: int):
    start = seq * _CHUNK
    return start, start + _CHUNK


# END FILE CONTENTS


# File: frontend/components/ui/label.tsx

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }


# END FILE CONTENTS


# File: frontend/lib/services/recording-service.ts

"use client"

import { BaseService } from './base-service'
import { IRecordingService, RecordingState } from './interfaces'
import { AudioRecorder, AudioChunk, checkAudioRecordingSupport } from '../audio-recorder'
import { AudioUploadWebSocket, AckMissingMessage } from '../websocket'
import { getAudioChunkIntervalMs, getAudioConfigInfo } from '../config'

/**
 * RecordingService - éŒ„éŸ³ç®¡ç†æœå‹™
 *
 * æ•´åˆç¾æœ‰çš„éŒ„éŸ³ç›¸é—œé‚è¼¯ï¼Œæä¾›ï¼š
 * - éŸ³é »éŒ„è£½ç®¡ç†ï¼ˆé‡ç”¨ AudioRecorderï¼‰
 * - WebSocket éŸ³é »ä¸Šå‚³ï¼ˆé‡ç”¨ AudioUploadWebSocketï¼‰
 * - éŒ„éŸ³ç‹€æ…‹ç®¡ç†
 * - éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
 * - å¿ƒè·³ç›£æ¸¬
 */
export class RecordingService extends BaseService implements IRecordingService {
  protected readonly serviceName = 'RecordingService'

  // éŒ„éŸ³å™¨å’Œ WebSocket å¼•ç”¨
  private audioRecorder: AudioRecorder | null = null
  private audioUploadWs: AudioUploadWebSocket | null = null

  // éŒ„éŸ³ç‹€æ…‹
  private recordingState: RecordingState = {
    isRecording: false,
    recordingTime: 0,
    currentSessionId: null,
    error: null
  }

  // è¨ˆæ™‚å™¨å’Œé‡è©¦æ©Ÿåˆ¶
  private recordingTimer: ReturnType<typeof setInterval> | null = null
  private heartbeatTimer: ReturnType<typeof setInterval> | null = null
  private audioChunks: AudioChunk[] = []
  private retryCounts = new Map<number, number>()

  /**
   * æœå‹™åˆå§‹åŒ–
   * æª¢æŸ¥éŸ³é »éŒ„è£½æ”¯æ´åº¦
   */
  async initialize(): Promise<void> {
    this.logInfo('æœå‹™åˆå§‹åŒ–é–‹å§‹')

    // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦
    const supportCheck = await checkAudioRecordingSupport()
    if (!supportCheck.isSupported) {
      const errorMessage = `éŸ³é »éŒ„è£½ä¸æ”¯æ´: ${supportCheck.error || 'æœªçŸ¥éŒ¯èª¤'}`
      this.logWarning('ç€è¦½å™¨æ”¯æ´åº¦æª¢æŸ¥å¤±æ•—', supportCheck.error)
      throw new Error(errorMessage)
    }

    this.logSuccess('ç€è¦½å™¨æ”¯æ´åº¦æª¢æŸ¥é€šé')
    this.logSuccess('åˆå§‹åŒ–å®Œæˆ')
  }

  /**
   * æœå‹™æ¸…ç†
   */
  async cleanup(): Promise<void> {
    this.logInfo('æœå‹™æ¸…ç†é–‹å§‹')

    // å¦‚æœæ­£åœ¨éŒ„éŸ³ï¼Œå…ˆåœæ­¢
    if (this.recordingState.isRecording) {
      await this.stopRecording()
    }

    // æ¸…ç†éŸ³é »éŒ„è£½å™¨
    if (this.audioRecorder) {
      this.audioRecorder.cleanup()
      this.audioRecorder = null
    }

    // æ¸…ç†è¨ˆæ™‚å™¨
    this.clearTimers()

    // é‡ç½®ç‹€æ…‹
    this.resetRecordingState()

    this.logSuccess('æ¸…ç†å®Œæˆ')
  }

  /**
   * é–‹å§‹éŒ„éŸ³
   * é‡ç”¨ç¾æœ‰çš„éŸ³é »éŒ„è£½å’Œ WebSocket ä¸Šå‚³é‚è¼¯
   */
  async startRecording(sessionId: string): Promise<void> {
    this.logInfo('é–‹å§‹éŒ„éŸ³', { sessionId })

    try {
      // æª¢æŸ¥æ˜¯å¦å·²åœ¨éŒ„éŸ³
      if (this.recordingState.isRecording) {
        this.logWarning('å·²åœ¨éŒ„éŸ³ä¸­ï¼Œè·³éé‡è¤‡å•Ÿå‹•')
        return
      }

      // é‡ç½®ç‹€æ…‹
      this.resetRecordingState()
      this.recordingState.currentSessionId = sessionId

      // æ­¥é©Ÿ 1: åˆå§‹åŒ–éŸ³é »éŒ„è£½å™¨
      this.logInfo('æ­¥é©Ÿ 1: åˆå§‹åŒ–éŸ³é »éŒ„è£½å™¨')
      const chunkInterval = getAudioChunkIntervalMs()

      console.log('ğŸ¯ [RecordingService] éŸ³é »é…ç½®', {
        chunkInterval: `${chunkInterval}ms (${chunkInterval / 1000}ç§’)`,
        mimeType: 'audio/webm;codecs=opus',
        configInfo: getAudioConfigInfo()
      })

      this.audioRecorder = new AudioRecorder({
        chunkInterval, // ä½¿ç”¨ç’°å¢ƒè®Šæ•¸é…ç½®çš„åˆ‡ç‰‡é–“éš”
        mimeType: 'audio/webm;codecs=opus'
      })

      this.logInfo(`éŸ³è¨Šé…ç½®: ${getAudioConfigInfo()}`)

      // è¨­å®šéŸ³é »éŒ„è£½å™¨äº‹ä»¶è™•ç†
      this.setupAudioRecorderEvents()

      // æ­¥é©Ÿ 2: é–‹å§‹éŸ³é »éŒ„è£½ï¼ˆåŒ…å«ç²å–æ¬Šé™ï¼‰
      this.logInfo('æ­¥é©Ÿ 2: é–‹å§‹éŸ³é »éŒ„è£½ï¼ˆåŒ…å«ç²å–æ¬Šé™ï¼‰')

      // æ­¥é©Ÿ 3: å»ºç«‹éŸ³é »ä¸Šå‚³ WebSocket
      this.logInfo('æ­¥é©Ÿ 3: å»ºç«‹éŸ³é »ä¸Šå‚³ WebSocket')
      this.audioUploadWs = new AudioUploadWebSocket(sessionId)

      // è¨­å®š WebSocket äº‹ä»¶è™•ç†
      this.setupWebSocketEvents()

      // é€£æ¥ WebSocket
      await this.audioUploadWs.connect()

      // é©—è­‰ WebSocket é€£æ¥
      if (!this.audioUploadWs.isConnected) {
        throw new Error('éŸ³é »ä¸Šå‚³ WebSocket é€£æ¥å¤±æ•—')
      }

      // æ­¥é©Ÿ 4: å•Ÿå‹•å¿ƒè·³æ©Ÿåˆ¶
      this.logInfo('æ­¥é©Ÿ 4: å•Ÿå‹•å¿ƒè·³æ©Ÿåˆ¶')
      this.startHeartbeat()

      // æ­¥é©Ÿ 5: é–‹å§‹éŒ„éŸ³
      this.logInfo('æ­¥é©Ÿ 5: é–‹å§‹éŸ³é »éŒ„è£½')
      await this.audioRecorder.start((chunk: AudioChunk) => {
        this.handleAudioChunk(chunk)
      })

      // æ­¥é©Ÿ 6: å•Ÿå‹•éŒ„éŸ³è¨ˆæ™‚å™¨
      this.logInfo('æ­¥é©Ÿ 6: å•Ÿå‹•éŒ„éŸ³è¨ˆæ™‚å™¨')
      this.startRecordingTimer()

      // æ›´æ–°éŒ„éŸ³ç‹€æ…‹
      this.recordingState.isRecording = true
      this.recordingState.error = null

      this.logSuccess('éŒ„éŸ³å•Ÿå‹•æˆåŠŸ', {
        sessionId,
        chunkConfig: getAudioConfigInfo(),
        mimeType: 'audio/webm;codecs=opus'
      })

    } catch (error) {
      // éŒ¯èª¤æ™‚æ¸…ç†è³‡æº
      await this.cleanupRecordingResources()
      this.recordingState.error = error instanceof Error ? error.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      this.handleError('é–‹å§‹éŒ„éŸ³', error)
    }
  }

  /**
   * åœæ­¢éŒ„éŸ³
   * ä¿æŒ WebSocket é€£æ¥ä»¥æ¥æ”¶å‰©é¤˜çš„è™•ç†çµæœ
   */
  async stopRecording(): Promise<void> {
    this.logInfo('åœæ­¢éŒ„éŸ³')

    try {
      // æ›´æ–°ç‹€æ…‹
      this.recordingState.isRecording = false

      // åœæ­¢éŸ³é »éŒ„è£½å™¨
      if (this.audioRecorder) {
        this.audioRecorder.stop()
        this.logInfo('éŸ³é »éŒ„è£½å™¨å·²åœæ­¢')
      }

      // åœæ­¢è¨ˆæ™‚å™¨
      this.clearTimers()

      // æ¸…ç†éŸ³é »éŒ„è£½å™¨ï¼ˆä¿ç•™ WebSocket é€£æ¥ï¼‰
      if (this.audioRecorder) {
        this.audioRecorder.cleanup()
        this.audioRecorder = null
      }

      // æ–·é–‹éŸ³é »ä¸Šå‚³ WebSocket
      if (this.audioUploadWs) {
        this.audioUploadWs.disconnect()
        this.audioUploadWs = null
      }

      this.logSuccess('éŒ„éŸ³åœæ­¢æˆåŠŸ', {
        sessionId: this.recordingState.currentSessionId,
        recordingTime: this.recordingState.recordingTime
      })

    } catch (error) {
      this.recordingState.error = error instanceof Error ? error.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      this.handleError('åœæ­¢éŒ„éŸ³', error)
    }
  }

  /**
   * å–å¾—ç•¶å‰éŒ„éŸ³ç‹€æ…‹
   */
  getRecordingState(): RecordingState {
    return { ...this.recordingState }
  }

  /**
   * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
   */
  isRecording(): boolean {
    return this.recordingState.isRecording
  }

  /**
   * å–å¾—éŒ„éŸ³æ™‚é–“ï¼ˆç§’ï¼‰
   */
  getRecordingTime(): number {
    console.log('â° [RecordingService] getRecordingTime', this.recordingState.recordingTime)
    return this.recordingState.recordingTime
  }

  /**
   * è¨­å®šéŸ³é »éŒ„è£½å™¨äº‹ä»¶è™•ç†
   */
  private setupAudioRecorderEvents(): void {
    if (!this.audioRecorder) return

    // è™•ç†éŒ„è£½éŒ¯èª¤
    this.audioRecorder.onError((error: Error) => {
      this.logWarning('éŸ³é »éŒ„è£½å™¨éŒ¯èª¤', error.message)
      this.recordingState.error = error.message
    })

    // è™•ç†ç‹€æ…‹è®ŠåŒ–
    this.audioRecorder.onStateChange((state) => {
      this.logInfo('éŸ³é »éŒ„è£½å™¨ç‹€æ…‹è®ŠåŒ–', state)
    })
  }

  /**
   * è¨­å®š WebSocket äº‹ä»¶è™•ç†
   */
  private setupWebSocketEvents(): void {
    if (!this.audioUploadWs) return

    // è™•ç† ACK/Missing è¨Šæ¯
    this.audioUploadWs.onAckMissing((data: AckMissingMessage) => {
      this.handleAckMissing(data)
    })

    // è™•ç† WebSocket é—œé–‰
    this.audioUploadWs.onClose((event) => {
      this.logWarning('éŸ³é »ä¸Šå‚³ WebSocket é€£æ¥é—œé–‰', {
        code: event.code,
        reason: event.reason
      })
    })
  }

  /**
   * è™•ç†éŸ³é »åˆ‡ç‰‡
   * å„²å­˜åˆ‡ç‰‡ä¸¦ä¸Šå‚³
   */
  private handleAudioChunk(chunk: AudioChunk): void {
    console.log('ğŸ¤ [RecordingService] æ”¶åˆ°éŸ³é »åˆ‡ç‰‡', {
      sequence: chunk.sequence,
      size: chunk.blob.size,
      duration: chunk.duration,
      timestamp: new Date().toISOString()
    })

    this.logInfo('æ”¶åˆ°éŸ³é »åˆ‡ç‰‡', {
      sequence: chunk.sequence,
      size: chunk.blob.size,
      duration: chunk.duration
    })

    // å„²å­˜åˆ‡ç‰‡ä¾›é‡å‚³ä½¿ç”¨
    this.audioChunks[chunk.sequence] = chunk

    // å¦‚æœ WebSocket å·²é€£æ¥ï¼Œç«‹å³ä¸Šå‚³
    if (this.audioUploadWs?.isConnected) {
      console.log('ğŸ“¤ [RecordingService] æº–å‚™ä¸Šå‚³éŸ³é »åˆ‡ç‰‡', {
        sequence: chunk.sequence,
        wsState: this.audioUploadWs.readyState,
        wsUrl: `/ws/upload_audio/${this.recordingState.currentSessionId}`
      })

      this.audioUploadWs.uploadAudioChunk(chunk.blob)

      console.log('âœ… [RecordingService] éŸ³é »åˆ‡ç‰‡å·²é€å‡º', {
        sequence: chunk.sequence,
        size: chunk.blob.size,
        time: new Date().toISOString()
      })

      this.logInfo('éŸ³é »åˆ‡ç‰‡å·²ä¸Šå‚³', { sequence: chunk.sequence })
    } else {
      console.error('âŒ [RecordingService] WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ä¸Šå‚³éŸ³é »åˆ‡ç‰‡', {
        sequence: chunk.sequence,
        wsState: this.audioUploadWs?.readyState || 'null',
        isConnected: this.audioUploadWs?.isConnected || false
      })

      this.logWarning('WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ä¸Šå‚³éŸ³é »åˆ‡ç‰‡', { sequence: chunk.sequence })
    }
  }

  /**
   * è™•ç† ACK/Missing è¨Šæ¯
   * å¯¦ç¾éŸ³é »åˆ‡ç‰‡é‡å‚³æ©Ÿåˆ¶
   */
  private handleAckMissing(data: AckMissingMessage): void {
    this.logInfo('æ”¶åˆ° ACK/Missing è¨Šæ¯', {
      ack: data.ack,
      missing: data.missing
    })

    if (data.missing.length > 0) {
      this.logWarning('æª¢æ¸¬åˆ°éºå¤±çš„éŸ³é »åˆ‡ç‰‡ï¼Œæº–å‚™é‡å‚³', data.missing)

      // é‡å‚³éºå¤±çš„åˆ‡ç‰‡
      data.missing.forEach(sequence => {
        const retryCount = this.retryCounts.get(sequence) ?? 0

        if (retryCount < 5) { // æœ€å¤šé‡å‚³ 5 æ¬¡
          this.retryCounts.set(sequence, retryCount + 1)

          // å°‹æ‰¾å°æ‡‰çš„éŸ³é »åˆ‡ç‰‡é€²è¡Œé‡å‚³
          if (this.audioChunks[sequence]) {
            this.logInfo('é‡å‚³éŸ³é »åˆ‡ç‰‡', {
              sequence,
              retryCount: retryCount + 1,
              maxRetries: 5
            })
            this.audioUploadWs?.uploadAudioChunk(this.audioChunks[sequence].blob)
          } else {
            this.logWarning('æ‰¾ä¸åˆ°è¦é‡å‚³çš„éŸ³é »åˆ‡ç‰‡', { sequence })
          }
        } else {
          this.logWarning('éŸ³é »åˆ‡ç‰‡é‡å‚³æ¬¡æ•¸å·²é”ä¸Šé™', {
            sequence,
            maxRetries: 5
          })
        }
      })
    }
  }

  /**
   * å•Ÿå‹•éŒ„éŸ³è¨ˆæ™‚å™¨
   */
  private startRecordingTimer(): void {
    this.clearRecordingTimer()
    this.recordingState.recordingTime = 0

    console.log('â±ï¸ [RecordingService] è¨ˆæ™‚å™¨å•Ÿå‹•')
    this.recordingTimer = setInterval(() => {
      this.recordingState.recordingTime += 1

      // æ¯ 30 ç§’è¨˜éŒ„ä¸€æ¬¡éŒ„éŸ³æ™‚é–“
      if (this.recordingState.recordingTime % 30 === 0) {
        this.logInfo('éŒ„éŸ³é€²è¡Œä¸­', {
          recordingTime: this.recordingState.recordingTime,
          minutes: Math.floor(this.recordingState.recordingTime / 60)
        })
      }
    }, 1000)
  }

  /**
   * å•Ÿå‹•å¿ƒè·³æ©Ÿåˆ¶
   */
  private startHeartbeat(): void {
    this.clearHeartbeatTimer()

    this.heartbeatTimer = setInterval(() => {
      if (this.audioUploadWs?.isConnected) {
        this.audioUploadWs.send(JSON.stringify({
          type: 'heartbeat',
          timestamp: Date.now()
        }))
        this.logInfo('ç™¼é€å¿ƒè·³è¨Šè™Ÿ')
      }
    }, 30000) // æ¯ 30 ç§’ç™¼é€ä¸€æ¬¡å¿ƒè·³
  }

  /**
   * æ¸…ç†æ‰€æœ‰è¨ˆæ™‚å™¨
   */
  private clearTimers(): void {
    this.clearRecordingTimer()
    this.clearHeartbeatTimer()
  }

  /**
   * æ¸…ç†éŒ„éŸ³è¨ˆæ™‚å™¨
   */
  private clearRecordingTimer(): void {
    if (this.recordingTimer) {
      clearInterval(this.recordingTimer)
      this.recordingTimer = null
      console.log('â¹ï¸ [RecordingService] è¨ˆæ™‚å™¨æ¸…é™¤')
    }
  }

  /**
   * æ¸…ç†å¿ƒè·³è¨ˆæ™‚å™¨
   */
  private clearHeartbeatTimer(): void {
    if (this.heartbeatTimer) {
      clearInterval(this.heartbeatTimer)
      this.heartbeatTimer = null
    }
  }

  /**
   * é‡ç½®éŒ„éŸ³ç‹€æ…‹
   */
  private resetRecordingState(): void {
    this.recordingState = {
      isRecording: false,
      recordingTime: 0,
      currentSessionId: null,
      error: null
    }
    this.audioChunks = []
    this.retryCounts.clear()
  }

  /**
   * æ¸…ç†éŒ„éŸ³ç›¸é—œè³‡æº
   * éŒ¯èª¤è™•ç†æ™‚ä½¿ç”¨
   */
  private async cleanupRecordingResources(): Promise<void> {
    try {
      // åœæ­¢éŸ³é »éŒ„è£½å™¨
      if (this.audioRecorder) {
        this.audioRecorder.stop()
        this.audioRecorder.cleanup()
        this.audioRecorder = null
      }

      // é—œé–‰ WebSocket é€£æ¥
      if (this.audioUploadWs) {
        this.audioUploadWs.disconnect()
        this.audioUploadWs = null
      }

      // æ¸…ç†è¨ˆæ™‚å™¨
      this.clearTimers()

      // é‡ç½®ç‹€æ…‹
      this.recordingState.isRecording = false

      this.logInfo('éŒ„éŸ³è³‡æºæ¸…ç†å®Œæˆ')
    } catch (error) {
      this.logWarning('æ¸…ç†éŒ„éŸ³è³‡æºæ™‚ç™¼ç”ŸéŒ¯èª¤', error)
    }
  }

  /**
   * ç²å–æœå‹™è©³ç´°ç‹€æ…‹
   * æ“´å±•åŸºç¤ç‹€æ…‹ï¼ŒåŒ…å«éŒ„éŸ³ç‰¹å®šä¿¡æ¯
   */
  async getDetailedStatus(): Promise<RecordingServiceStatus> {
    const baseStatus = this.getStatus()
    const supportCheck = await checkAudioRecordingSupport()

    return {
      ...baseStatus,
      recordingState: this.getRecordingState(),
      audioSupport: {
        supported: supportCheck.isSupported,
        errors: supportCheck.error ? [supportCheck.error] : []
      },
      audioRecorderState: this.audioRecorder?.currentState ?? null,
      webSocketConnected: this.audioUploadWs?.isConnected ?? false,
      chunksCount: this.audioChunks.length,
      retryCount: Array.from(this.retryCounts.values()).reduce((sum, count) => sum + count, 0)
    }
  }
}

/**
 * RecordingService è©³ç´°ç‹€æ…‹ä»‹é¢
 */
export interface RecordingServiceStatus {
  serviceName: string
  isInitialized: boolean
  isRunning: boolean
  timestamp: string
  recordingState: RecordingState
  audioSupport: {
    supported: boolean
    errors: string[]
  }
  audioRecorderState: string | null
  webSocketConnected: boolean
  chunksCount: number
  retryCount: number
}


# END FILE CONTENTS


# File: frontend/lib/app-state-reducer.ts

import { AppStateAction, initialAppData } from "../types/app-state-context"
import { AppData } from "../types/app-state"

export interface AppStateReducerState {
  appData: AppData
  isLoading: boolean
  error: string | null
}

export function appStateReducer(
  state: AppStateReducerState,
  action: AppStateAction
): AppStateReducerState {
  console.log('ğŸ”„ [AppStateReducer] Action:', action.type, action)

  switch (action.type) {
    case "SET_STATE":
    case "SET_APP_STATE":  // åˆ¥åï¼Œç‚ºäº†å‘å¾Œç›¸å®¹
      return {
        ...state,
        appData: {
          ...state.appData,
          state: action.payload,
        },
      }

    case "SET_RECORDING":
      return {
        ...state,
        appData: {
          ...state.appData,
          isRecording: action.payload,
        },
      }

    case "SET_RECORDING_TIME":
      console.log('â° [AppStateReducer] æ›´æ–°éŒ„éŸ³æ™‚é–“:', action.payload)
      return {
        ...state,
        appData: {
          ...state.appData,
          recordingTime: action.payload,
        },
      }

    case "SET_EDITOR_CONTENT":
      return {
        ...state,
        appData: {
          ...state.appData,
          editorContent: action.payload,
        },
      }

    case "SET_TRANSCRIPT_ENTRIES":
      return {
        ...state,
        appData: {
          ...state.appData,
          transcriptEntries: action.payload,
        },
      }

    case "ADD_TRANSCRIPT_ENTRY":
      return {
        ...state,
        appData: {
          ...state.appData,
          transcriptEntries: [...state.appData.transcriptEntries, action.payload],
        },
      }

    case "SET_SESSION":
      return {
        ...state,
        appData: {
          ...state.appData,
          session: action.payload,
        },
      }

    case "UPDATE_SESSION_STATUS":
      if (!state.appData.session) {
        console.warn('ğŸ”„ [AppStateReducer] è©¦åœ–æ›´æ–°ä¸å­˜åœ¨çš„ session ç‹€æ…‹')
        return state
      }
      return {
        ...state,
        appData: {
          ...state.appData,
          session: {
            ...state.appData.session,
            status: action.payload,
          },
        },
      }

    case "RESET_STATE":
      return {
        ...state,
        appData: initialAppData,
        error: null,
      }

    case "SET_LOADING":
      return {
        ...state,
        isLoading: action.payload,
      }

    case "SET_ERROR":
      return {
        ...state,
        error: action.payload,
      }

    case "CLEAR_ERROR":
      return {
        ...state,
        error: null,
      }

    default:
      console.warn('ğŸ”„ [AppStateReducer] æœªçŸ¥çš„ action type:', action)
      return state
  }
}


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/recording-service.test.ts

"use client"

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { RecordingService } from '../recording-service'
import { AudioRecorder } from '../../audio-recorder'
import { AudioUploadWebSocket } from '../../websocket'

// Mock AudioRecorder
vi.mock('../../audio-recorder', () => ({
    AudioRecorder: vi.fn().mockImplementation(() => ({
        initialize: vi.fn(),
        startRecording: vi.fn(),
        stopRecording: vi.fn(),
        onChunk: vi.fn(),
        onError: vi.fn(),
    }))
}))

// Mock AudioUploadWebSocket
vi.mock('../../websocket', () => ({
    AudioUploadWebSocket: vi.fn().mockImplementation(() => ({
        connect: vi.fn(),
        disconnect: vi.fn(),
        uploadAudioChunk: vi.fn(),
        onAckMissing: vi.fn(),
        isConnected: false,
        send: vi.fn(),
    }))
}))

// Mock transcriptManager
const mockTranscriptManager = {
    connect: vi.fn(),
    disconnect: vi.fn(),
    addListener: vi.fn(),
    removeListener: vi.fn(),
    isConnected: vi.fn(),
}

vi.mock('../../transcript-manager', () => ({
    transcriptManager: mockTranscriptManager
}))

describe('RecordingService', () => {
    let recordingService: RecordingService
    let mockAudioRecorder: any
    let mockWebSocket: any

    beforeEach(() => {
        recordingService = new RecordingService()
        mockAudioRecorder = new AudioRecorder({})
        mockWebSocket = new AudioUploadWebSocket('')
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('æœå‹™åˆå§‹åŒ–', () => {
        it('æ‡‰è©²æ­£ç¢ºåˆå§‹åŒ– RecordingService', () => {
            expect(recordingService).toBeDefined()
            expect(recordingService['serviceName']).toBe('RecordingService')
        })

        it('æ‡‰è©²æ­£ç¢ºå•Ÿå‹•å’Œåœæ­¢æœå‹™', async () => {
            await recordingService.start()
            expect(recordingService['isRunning']).toBe(true)

            await recordingService.stop()
            expect(recordingService['isRunning']).toBe(false)
        })

        it('æ‡‰è©²è¿”å›åˆå§‹éŒ„éŸ³ç‹€æ…‹', () => {
            const state = recordingService.getRecordingState()

            expect(state).toEqual({
                isRecording: false,
                recordingTime: 0,
                currentSessionId: null,
                error: null
            })
        })
    })

    describe('startRecording', () => {
        const sessionId = 'test-session-id'

        beforeEach(() => {
            // Mock browser environment
            Object.defineProperty(global, 'window', {
                value: {
                    addEventListener: vi.fn(),
                    removeEventListener: vi.fn(),
                },
                writable: true
            })
        })

        it('æ‡‰è©²æˆåŠŸé–‹å§‹éŒ„éŸ³', async () => {
            // Setup mocks
            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording(sessionId)

            // Verify AudioRecorder was initialized and started
            expect(AudioRecorder).toHaveBeenCalled()
            expect(mockAudioRecorder.initialize).toHaveBeenCalled()
            expect(mockAudioRecorder.startRecording).toHaveBeenCalled()

            // Verify WebSocket was connected
            expect(AudioUploadWebSocket).toHaveBeenCalledWith(sessionId)
            expect(mockWebSocket.connect).toHaveBeenCalled()

            // Verify transcript manager was connected
            expect(mockTranscriptManager.connect).toHaveBeenCalledWith(sessionId)

            // Verify recording state
            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(true)
            expect(state.currentSessionId).toBe(sessionId)
        })

        it('æ‡‰è©²è™•ç†éŸ³é »åˆå§‹åŒ–å¤±æ•—', async () => {
            const initError = new Error('Microphone permission denied')
            mockAudioRecorder.initialize.mockRejectedValue(initError)

            await expect(recordingService.startRecording(sessionId))
                .rejects.toThrow('Microphone permission denied')

            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
            expect(state.error).toBe('Microphone permission denied')
        })

        it('æ‡‰è©²è™•ç† WebSocket é€£æ¥å¤±æ•—', async () => {
            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockWebSocket.connect.mockRejectedValue(new Error('WebSocket connection failed'))

            await expect(recordingService.startRecording(sessionId))
                .rejects.toThrow('WebSocket connection failed')
        })

        it('æ‡‰è©²è™•ç† TranscriptManager é€£æ¥å¤±æ•—', async () => {
            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockRejectedValue(new Error('Transcript connection failed'))

            await expect(recordingService.startRecording(sessionId))
                .rejects.toThrow('Transcript connection failed')
        })

        it('æ‡‰è©²åœ¨ç€è¦½å™¨ç’°å¢ƒæª¢æŸ¥å¤±æ•—æ™‚æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Remove window object to simulate non-browser environment
            delete (global as any).window

            await expect(recordingService.startRecording(sessionId))
                .rejects.toThrow('æ­¤åŠŸèƒ½åƒ…åœ¨ç€è¦½å™¨ç’°å¢ƒä¸­å¯ç”¨')
        })

        it('æ‡‰è©²è™•ç†é‡è¤‡é–‹å§‹éŒ„éŸ³è«‹æ±‚', async () => {
            // Setup successful first recording
            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording(sessionId)

            // Try to start recording again
            await expect(recordingService.startRecording('another-session'))
                .rejects.toThrow('éŒ„éŸ³å·²åœ¨é€²è¡Œä¸­')
        })
    })

    describe('stopRecording', () => {
        beforeEach(async () => {
            // Setup recording state
            Object.defineProperty(global, 'window', {
                value: {
                    addEventListener: vi.fn(),
                    removeEventListener: vi.fn(),
                },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')
        })

        it('æ‡‰è©²æˆåŠŸåœæ­¢éŒ„éŸ³', async () => {
            await recordingService.stopRecording()

            // Verify audio recorder was stopped
            expect(mockAudioRecorder.stopRecording).toHaveBeenCalled()

            // Verify WebSocket was disconnected
            expect(mockWebSocket.disconnect).toHaveBeenCalled()

            // Verify recording state
            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
            expect(state.currentSessionId).toBeNull()
        })

        it('æ‡‰è©²è™•ç†åœæ­¢éŒ„éŸ³éŒ¯èª¤', async () => {
            mockAudioRecorder.stopRecording.mockImplementation(() => {
                throw new Error('Stop recording failed')
            })

            await expect(recordingService.stopRecording())
                .rejects.toThrow('Stop recording failed')
        })

        it('æ‡‰è©²åœ¨æ²’æœ‰éŒ„éŸ³æ™‚æ­£å¸¸è™•ç†åœæ­¢è«‹æ±‚', async () => {
            // Stop recording first
            await recordingService.stopRecording()

            // Try to stop again
            await expect(recordingService.stopRecording()).resolves.not.toThrow()
        })
    })

    describe('éŒ„éŸ³ç‹€æ…‹ç®¡ç†', () => {
        it('æ‡‰è©²æ­£ç¢ºè¿½è¹¤éŒ„éŸ³æ™‚é–“', async () => {
            // Mock timer
            vi.useFakeTimers()

            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')

            // Advance timer by 5 seconds
            vi.advanceTimersByTime(5000)

            const state = recordingService.getRecordingState()
            expect(state.recordingTime).toBe(5)

            vi.useRealTimers()
        })

        it('æ‡‰è©²æ­£ç¢ºå ±å‘ŠéŒ„éŸ³ç‹€æ…‹', async () => {
            expect(recordingService.isRecording()).toBe(false)

            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')
            expect(recordingService.isRecording()).toBe(true)

            await recordingService.stopRecording()
            expect(recordingService.isRecording()).toBe(false)
        })

        it('æ‡‰è©²æ­£ç¢ºå ±å‘ŠéŒ„éŸ³æ™‚é–“', () => {
            expect(recordingService.getRecordingTime()).toBe(0)
        })
    })

    describe('éŸ³é »åˆ‡ç‰‡è™•ç†', () => {
        it('æ‡‰è©²è™•ç†éŸ³é »åˆ‡ç‰‡ä¸Šå‚³', () => {
            const mockChunk = {
                sequence: 1,
                blob: new Blob(['test audio data'], { type: 'audio/webm' })
            }

            // Simulate chunk received
            const chunkHandler = mockAudioRecorder.onChunk.mock.calls[0]?.[0]
            if (chunkHandler) {
                chunkHandler(mockChunk)
            }

            // Verify WebSocket upload was called
            expect(mockWebSocket.uploadAudioChunk).toHaveBeenCalledWith(mockChunk.blob)
        })

        it('æ‡‰è©²è™•ç† ACK/Missing é‡å‚³æ©Ÿåˆ¶', () => {
            const ackMissingData = {
                acknowledged: [1, 2],
                missing: [3, 4]
            }

            // Simulate ACK/Missing message
            const ackHandler = mockWebSocket.onAckMissing.mock.calls[0]?.[0]
            if (ackHandler) {
                ackHandler(ackMissingData)
            }

            // Verify retry logic would be triggered for missing chunks
            expect(ackMissingData.missing).toEqual([3, 4])
        })
    })

    describe('éŒ¯èª¤è™•ç†', () => {
        it('æ‡‰è©²è™•ç†éŸ³é »éŒ„è£½å™¨éŒ¯èª¤', async () => {
            const audioError = new Error('Audio recording error')

            // Simulate audio recorder error
            const errorHandler = mockAudioRecorder.onError.mock.calls[0]?.[0]
            if (errorHandler) {
                errorHandler(audioError)
            }

            const state = recordingService.getRecordingState()
            expect(state.error).toBe('Audio recording error')
        })

        it('æ‡‰è©²æ¸…é™¤éŒ¯èª¤ç‹€æ…‹', () => {
            // Set error state
            recordingService['recordingState'].error = 'Test error'

            // Clear error (this would be called internally)
            recordingService['recordingState'].error = null

            const state = recordingService.getRecordingState()
            expect(state.error).toBeNull()
        })
    })

    describe('è³‡æºæ¸…ç†', () => {
        it('æ‡‰è©²åœ¨éŒ¯èª¤æ™‚æ¸…ç†è³‡æº', async () => {
            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockRejectedValue(new Error('Start failed'))

            await expect(recordingService.startRecording('test-session'))
                .rejects.toThrow('Start failed')

            // Verify cleanup was performed
            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
            expect(state.currentSessionId).toBeNull()
        })

        it('æ‡‰è©²åœ¨æœå‹™åœæ­¢æ™‚æ¸…ç†æ‰€æœ‰è³‡æº', async () => {
            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')
            await recordingService.stop()

            // Verify all resources are cleaned up
            expect(mockAudioRecorder.stopRecording).toHaveBeenCalled()
            expect(mockWebSocket.disconnect).toHaveBeenCalled()

            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
        })
    })

    describe('ä¸¦ç™¼å’Œç«¶çˆ­æ¢ä»¶', () => {
        it('æ‡‰è©²é˜²æ­¢ä¸¦ç™¼éŒ„éŸ³æ“ä½œ', async () => {
            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            // Start first recording
            const promise1 = recordingService.startRecording('session-1')

            // Try to start second recording immediately
            const promise2 = recordingService.startRecording('session-2')

            const results = await Promise.allSettled([promise1, promise2])

            // One should succeed, one should fail
            expect(results.filter(r => r.status === 'fulfilled')).toHaveLength(1)
            expect(results.filter(r => r.status === 'rejected')).toHaveLength(1)
        })

        it('æ‡‰è©²è™•ç†å¿«é€Ÿçš„é–‹å§‹-åœæ­¢æ“ä½œ', async () => {
            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')
            await recordingService.stopRecording()

            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
        })
    })

    describe('æœå‹™ç‹€æ…‹å ±å‘Š', () => {
        it('æ‡‰è©²å ±å‘Šæ­£ç¢ºçš„æœå‹™è³‡è¨Š', async () => {
            const status = await recordingService.getDetailedStatus()

            expect(status).toMatchObject({
                serviceName: 'RecordingService',
                isInitialized: expect.any(Boolean),
                isRunning: expect.any(Boolean),
                recordingState: expect.any(Object),
                audioSupport: expect.any(Object),
                webSocketConnected: expect.any(Boolean)
            })
        })
    })
})


# END FILE CONTENTS


# File: .cursorignore

/node_modules
/build
/temp
/xnotes
/.claude
/__pycache__
CLAUDE.local.md

# END FILE CONTENTS


# File: frontend/lib/transcript-manager-new.ts

"use client"

import { TranscriptWebSocket } from './websocket'
import { useAppStore } from './app-store-zustand'
import type { TranscriptEntry } from '../types/app-state'
import {
    TranscriptSegmentMessage,
    TranscriptCompleteMessage,
    ErrorMessage,
    TranscriptionErrorMessage,
    ConnectionEstablishedMessage,
    HeartbeatAckMessage,
    PongMessage,
    PhaseMessage
} from '../types/websocket-messages'

/**
 * TranscriptManager - å‹åˆ¥å®‰å…¨çš„é€å­—ç¨¿ç®¡ç†å™¨
 *
 * é‡æ§‹ç‰¹è‰²ï¼š
 * âœ… ä½¿ç”¨ TypeScript discriminated union
 * âœ… äº‹ä»¶é©…å‹•æ¶æ§‹æ›¿ä»£ handleMessage å·¨å‹æ–¹æ³•
 * âœ… å‹åˆ¥å®‰å…¨çš„äº‹ä»¶è™•ç†å™¨
 * âœ… ç§»é™¤ WebSocketManager hack
 */
export class TranscriptManager {
    private static instance: TranscriptManager | null = null
    private connections: Map<string, TranscriptWebSocket> = new Map()
    private connectionStates: Map<string, boolean> = new Map()
    private heartbeatIntervals: Map<string, NodeJS.Timeout> = new Map()
    private reconnectAttempts: Map<string, number> = new Map()
    private maxReconnectAttempts = 5
    private heartbeatInterval = 10000 // 10ç§’
    private reconnectDelay = 2000 // 2ç§’

    private constructor() {
        // Singleton pattern
        if (typeof window !== 'undefined') {
            (window as any).transcriptManager = this
        }
    }

    static getInstance(): TranscriptManager {
        if (!TranscriptManager.instance) {
            TranscriptManager.instance = new TranscriptManager()
        }
        return TranscriptManager.instance
    }

    /* ============================================================
     * æ ¸å¿ƒé€£æ¥ç®¡ç†
     * ============================================================ */

    async connect(sessionId: string): Promise<void> {
        console.log(`ğŸ”— [TranscriptManager] é€£æ¥æœƒè©±: ${sessionId}`)

        // æª¢æŸ¥æ˜¯å¦å·²æœ‰é€£æ¥
        if (this.connections.has(sessionId) && this.isConnected(sessionId)) {
            console.log(`âœ… [TranscriptManager] æœƒè©± ${sessionId} å·²é€£æ¥`)
            return
        }

        // æ¸…ç†èˆŠé€£æ¥
        if (this.connections.has(sessionId)) {
            await this.disconnect(sessionId)
        }

        try {
            await this.establishConnection(sessionId)
            console.log(`âœ… [TranscriptManager] æœƒè©± ${sessionId} é€£æ¥æˆåŠŸ`)
        } catch (error) {
            console.error(`âŒ [TranscriptManager] æœƒè©± ${sessionId} é€£æ¥å¤±æ•—:`, error)
            throw error
        }
    }

    async disconnect(sessionId: string): Promise<void> {
        console.log(`ğŸ“± [TranscriptManager] æ–·é–‹æœƒè©±: ${sessionId}`)

        // åœæ­¢å¿ƒè·³
        this.stopHeartbeat(sessionId)

        // æ–·é–‹ WebSocket
        const ws = this.connections.get(sessionId)
        if (ws) {
            ws.disconnect()
            this.connections.delete(sessionId)
        }

        // æ¸…ç†ç‹€æ…‹
        this.connectionStates.set(sessionId, false)
        this.reconnectAttempts.delete(sessionId)
    }

    /* ============================================================
     * ç§æœ‰æ–¹æ³•ï¼šé€£æ¥å»ºç«‹å’Œäº‹ä»¶ç¶å®š
     * ============================================================ */

    private async establishConnection(sessionId: string): Promise<void> {
        const ws = new TranscriptWebSocket(sessionId)

        // âœ… ä½¿ç”¨å‹åˆ¥å®‰å…¨çš„äº‹ä»¶ç¶å®šï¼ˆç§»é™¤ hackï¼‰
        this.bindWebSocketEvents(ws, sessionId)

        // è¨­å®šé—œé–‰è™•ç†
        ws.onClose((event) => {
            console.log(`ğŸ”Œ [TranscriptManager] æœƒè©± ${sessionId} é€£æ¥é—œé–‰:`, event.code, event.reason)
            this.connectionStates.set(sessionId, false)
            this.stopHeartbeat(sessionId)

            // å¦‚æœä¸æ˜¯æ‰‹å‹•é—œé–‰ï¼Œå˜—è©¦é‡é€£
            if (event.code !== 1000) {
                this.scheduleReconnect(sessionId)
            }
        })

        // å»ºç«‹é€£æ¥
        await ws.connect()

        // ä¿å­˜é€£æ¥
        this.connections.set(sessionId, ws)
        this.connectionStates.set(sessionId, true)

        // å•Ÿå‹•å¿ƒè·³å’Œåˆå§‹åŒ–
        this.sendPing(sessionId)
        this.startHeartbeat(sessionId)
    }

    private bindWebSocketEvents(ws: TranscriptWebSocket, sessionId: string): void {
        console.log(`ğŸ¯ [TranscriptManager] ç¶å®šäº‹ä»¶è™•ç†å™¨: ${sessionId}`)

        // âœ… å‹åˆ¥å®‰å…¨çš„äº‹ä»¶ç›£è½å™¨
        ws.on('transcript_segment', (msg) => this.handleTranscriptSegment(sessionId, msg))
        ws.on('connection_established', (msg) => this.handleConnectionEstablished(sessionId, msg))
        ws.on('transcript_complete', (msg) => this.handleTranscriptComplete(sessionId, msg))
        ws.on('heartbeat_ack', (msg) => this.handleHeartbeatAck(sessionId, msg))
        ws.on('pong', (msg) => this.handlePong(sessionId, msg))
        ws.on('error', (msg) => this.handleError(sessionId, msg))
        ws.on('transcription_error', (msg) => this.handleTranscriptionError(sessionId, msg))
        ws.on('phase', (msg) => this.handlePhase(sessionId, msg))
    }

    /* ============================================================
     * å‹åˆ¥å®‰å…¨çš„äº‹ä»¶è™•ç†å™¨ï¼ˆå–ä»£å·¨å‹ handleMessageï¼‰
     * ============================================================ */

    private handleTranscriptSegment(sessionId: string, msg: TranscriptSegmentMessage): void {
        console.log('ğŸ“ [TranscriptManager] æ”¶åˆ°é€å­—ç¨¿ç‰‡æ®µ:', {
            sessionId,
            text: msg.text.substring(0, 50) + '...',
            start_time: msg.start_time,
            end_time: msg.end_time,
            confidence: msg.confidence
        })

        // è½‰æ›ç‚º UI æ ¼å¼ä¸¦æ¨é€åˆ° store
        // ä½¿ç”¨ start_time ä¸¦è½‰æ›ç‚º HH:MM:SS æ ¼å¼
        const startTimeInSeconds = msg.start_time ?? 0
        const hours = Math.floor(startTimeInSeconds / 3600)
        const minutes = Math.floor((startTimeInSeconds % 3600) / 60)
        const seconds = Math.floor(startTimeInSeconds % 60)

        const entry: TranscriptEntry = {
            startTime: startTimeInSeconds,
            time: `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`,
            text: msg.text
        }

        console.log('ğŸ¯ [TranscriptManager] æ¨é€åˆ° store:', entry)
        useAppStore.getState().addTranscriptEntry(entry)

        // æª¢æŸ¥ç‹€æ…‹è½‰æ›
        const currentState = useAppStore.getState()
        console.log('ğŸ“Š [TranscriptManager] Store ç‹€æ…‹:', {
            appState: currentState.appState,
            transcriptCount: currentState.transcriptEntries.length
        })
    }

    private handleConnectionEstablished(sessionId: string, msg: ConnectionEstablishedMessage): void {
        console.log('âœ… [TranscriptManager] é€£æ¥å·²å»ºç«‹:', {
            sessionId,
            message: msg.message,
            timestamp: msg.timestamp
        })
    }

    private handleTranscriptComplete(sessionId: string, msg: TranscriptCompleteMessage): void {
        console.log('ğŸ¯ [TranscriptManager] è½‰éŒ„å®Œæˆ:', {
            sessionId,
            message: msg.message,
            timestamp: msg.timestamp
        })
        // å¯ä»¥åœ¨é€™è£¡è§¸ç™¼å®Œæˆç‹€æ…‹æˆ–é€šçŸ¥
    }

    private handleHeartbeatAck(sessionId: string, msg: HeartbeatAckMessage): void {
        console.log('ğŸ’“ [TranscriptManager] å¿ƒè·³ç¢ºèª:', {
            sessionId,
            timestamp: msg.timestamp
        })
    }

    private handlePong(sessionId: string, msg: PongMessage): void {
        console.log('ğŸ“ [TranscriptManager] Pong å›æ‡‰:', {
            sessionId,
            timestamp: msg.timestamp
        })
    }

    private handleError(sessionId: string, msg: ErrorMessage): void {
        console.error('ğŸš¨ [TranscriptManager] æ”¶åˆ°éŒ¯èª¤:', {
            sessionId,
            error_type: msg.error_type,
            error_message: msg.error_message,
            details: msg.details
        })
        // å¯ä»¥åœ¨é€™è£¡è§¸ç™¼éŒ¯èª¤è™•ç†é‚è¼¯
    }

    private handleTranscriptionError(sessionId: string, msg: TranscriptionErrorMessage): void {
        console.error('ğŸš¨ [TranscriptManager] è½‰éŒ„éŒ¯èª¤:', {
            sessionId,
            error_type: msg.error_type,
            error_message: msg.error_message
        })
    }

    private handlePhase(sessionId: string, msg: PhaseMessage): void {
        console.log(`ğŸ“ [TranscriptManager] ç›¸ä½è®Šæ›´: ${msg.phase}`, {
            sessionId,
            phase: msg.phase
        })

        // ğŸ¯ æ ¹æ“š phase æ›´æ–°æ‡‰ç”¨ç‹€æ…‹
        if (msg.phase === 'active') {
            console.log('âœ… [TranscriptManager] æ”¶åˆ° active phaseï¼Œåˆ‡æ›åˆ° recording_active')
            useAppStore.getState().setState('recording_active')
        } else if (msg.phase === 'waiting') {
            console.log('â³ [TranscriptManager] æ”¶åˆ° waiting phaseï¼Œä¿æŒ recording_waiting')
            useAppStore.getState().setState('recording_waiting')
        }
    }

    /* ============================================================
     * å¿ƒè·³å’Œé‡é€£æ©Ÿåˆ¶
     * ============================================================ */

    private sendPing(sessionId: string): void {
        const ws = this.connections.get(sessionId)
        if (ws && ws.isConnected) {
            ws.sendJson({ type: 'ping' })
            console.log(`ğŸ“ [TranscriptManager] ç™¼é€ ping: ${sessionId}`)
        }
    }

    private sendHeartbeat(sessionId: string): void {
        const ws = this.connections.get(sessionId)
        if (ws && ws.isConnected) {
            try {
                ws.sendJson({
                    type: 'heartbeat',
                    timestamp: Date.now()
                })
                console.log(`ğŸ’“ [TranscriptManager] ç™¼é€å¿ƒè·³: ${sessionId}`)
            } catch (error) {
                console.error(`âŒ [TranscriptManager] å¿ƒè·³å¤±æ•— ${sessionId}:`, error)
                this.connectionStates.set(sessionId, false)
                this.scheduleReconnect(sessionId)
            }
        }
    }

    private startHeartbeat(sessionId: string): void {
        this.stopHeartbeat(sessionId)

        const interval = setInterval(() => {
            this.sendHeartbeat(sessionId)
        }, this.heartbeatInterval)

        this.heartbeatIntervals.set(sessionId, interval)
        console.log(`ğŸ’“ [TranscriptManager] å•Ÿå‹•å¿ƒè·³: ${sessionId}`)
    }

    private stopHeartbeat(sessionId: string): void {
        const interval = this.heartbeatIntervals.get(sessionId)
        if (interval) {
            clearInterval(interval)
            this.heartbeatIntervals.delete(sessionId)
            console.log(`ğŸ’“ [TranscriptManager] åœæ­¢å¿ƒè·³: ${sessionId}`)
        }
    }

    private scheduleReconnect(sessionId: string): void {
        const attempts = this.reconnectAttempts.get(sessionId) ?? 0

        if (attempts >= this.maxReconnectAttempts) {
            console.error(`âŒ [TranscriptManager] é‡é€£æ¬¡æ•¸å·²é”ä¸Šé™: ${sessionId}`)
            return
        }

        this.reconnectAttempts.set(sessionId, attempts + 1)
        const delay = this.reconnectDelay * Math.pow(2, attempts)

        console.log(`ğŸ”„ [TranscriptManager] æ’ç¨‹é‡é€£: ${sessionId} (${attempts + 1}/${this.maxReconnectAttempts}) ${delay}ms`)

        setTimeout(async () => {
            try {
                await this.establishConnection(sessionId)
                this.reconnectAttempts.set(sessionId, 0)
                console.log(`âœ… [TranscriptManager] é‡é€£æˆåŠŸ: ${sessionId}`)
            } catch (error) {
                console.error(`âŒ [TranscriptManager] é‡é€£å¤±æ•—: ${sessionId}`, error)
            }
        }, delay)
    }

    /* ============================================================
 * å‘å¾Œå…¼å®¹æ–¹æ³•ï¼ˆæ”¯æ´èˆŠçš„ APIï¼‰
 * ============================================================ */

    /**
     * @deprecated èˆŠ API å…¼å®¹æ€§ - è«‹ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼
     */
    addListener(sessionId: string, callback: (message: any) => void): void {
        console.warn('âš ï¸ [TranscriptManager] addListener å·²æ£„ç”¨ï¼Œè«‹ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼')
        // ç‚ºäº†å…¼å®¹æ€§ï¼Œæš«æ™‚ä¿ç•™ä½†ä¸å¯¦ä½œ
    }

    /**
     * @deprecated èˆŠ API å…¼å®¹æ€§ - è«‹ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼
     */
    removeListener(sessionId: string, callback: (message: any) => void): void {
        console.warn('âš ï¸ [TranscriptManager] removeListener å·²æ£„ç”¨ï¼Œè«‹ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼')
        // ç‚ºäº†å…¼å®¹æ€§ï¼Œæš«æ™‚ä¿ç•™ä½†ä¸å¯¦ä½œ
    }

    /* ============================================================
     * å…¬å…±å·¥å…·æ–¹æ³•
     * ============================================================ */

    isConnected(sessionId: string): boolean {
        const ws = this.connections.get(sessionId)
        const actualConnected = ws?.isConnected ?? false

        // åŒæ­¥ç‹€æ…‹
        const stateConnected = this.connectionStates.get(sessionId) ?? false
        if (stateConnected !== actualConnected) {
            this.connectionStates.set(sessionId, actualConnected)
        }

        return actualConnected
    }

    getConnectionCount(): number {
        return Array.from(this.connections.values()).filter(ws => ws.isConnected).length
    }

    async disconnectAll(): Promise<void> {
        console.log('ğŸ“± [TranscriptManager] æ¸…ç†æ‰€æœ‰é€£æ¥')
        const sessionIds = Array.from(this.connections.keys())
        await Promise.all(sessionIds.map(sessionId => this.disconnect(sessionId)))
    }
}

// åŒ¯å‡º Singleton å¯¦ä¾‹
export const transcriptManager = TranscriptManager.getInstance()


# END FILE CONTENTS


# File: frontend/pnpm-lock.yaml

lockfileVersion: '9.0'

settings:
  autoInstallPeers: true
  excludeLinksFromLockfile: false

importers:

  .:
    dependencies:
      '@hookform/resolvers':
        specifier: ^3.9.1
        version: 3.10.0(react-hook-form@7.59.0(react@19.1.0))
      '@radix-ui/react-accordion':
        specifier: 1.2.2
        version: 1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-alert-dialog':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-aspect-ratio':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-avatar':
        specifier: 1.1.2
        version: 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-checkbox':
        specifier: 1.1.3
        version: 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-collapsible':
        specifier: 1.1.2
        version: 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-context-menu':
        specifier: 2.2.4
        version: 2.2.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-dialog':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-dropdown-menu':
        specifier: 2.1.4
        version: 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-hover-card':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-label':
        specifier: 2.1.1
        version: 2.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-menubar':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-navigation-menu':
        specifier: 1.2.3
        version: 1.2.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-popover':
        specifier: 1.1.4
        version: 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-progress':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-radio-group':
        specifier: 1.2.2
        version: 1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-scroll-area':
        specifier: 1.2.2
        version: 1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-select':
        specifier: 2.1.4
        version: 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-separator':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slider':
        specifier: 1.2.2
        version: 1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot':
        specifier: 1.1.1
        version: 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-switch':
        specifier: 1.1.2
        version: 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-tabs':
        specifier: 1.1.2
        version: 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-toast':
        specifier: 1.2.4
        version: 1.2.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-toggle':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-toggle-group':
        specifier: 1.1.1
        version: 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-tooltip':
        specifier: 1.1.6
        version: 1.1.6(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      axios:
        specifier: ^1.10.0
        version: 1.10.0
      class-variance-authority:
        specifier: ^0.7.1
        version: 0.7.1
      clsx:
        specifier: ^2.1.1
        version: 2.1.1
      cmdk:
        specifier: 1.0.4
        version: 1.0.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      date-fns:
        specifier: 4.1.0
        version: 4.1.0
      easymde:
        specifier: latest
        version: 2.20.0
      embla-carousel-react:
        specifier: 8.5.1
        version: 8.5.1(react@19.1.0)
      input-otp:
        specifier: 1.4.1
        version: 1.4.1(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      lucide-react:
        specifier: ^0.454.0
        version: 0.454.0(react@19.1.0)
      next:
        specifier: 15.2.4
        version: 15.2.4(@babel/core@7.28.0)(@playwright/test@1.53.2)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      next-themes:
        specifier: ^0.4.4
        version: 0.4.6(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react:
        specifier: ^19
        version: 19.1.0
      react-day-picker:
        specifier: 8.10.1
        version: 8.10.1(date-fns@4.1.0)(react@19.1.0)
      react-dom:
        specifier: ^19
        version: 19.1.0(react@19.1.0)
      react-hook-form:
        specifier: ^7.54.1
        version: 7.59.0(react@19.1.0)
      react-resizable-panels:
        specifier: ^2.1.7
        version: 2.1.9(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react-simplemde-editor:
        specifier: latest
        version: 5.2.0(easymde@2.20.0)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      recharts:
        specifier: 2.15.0
        version: 2.15.0(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      sonner:
        specifier: ^1.7.1
        version: 1.7.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      tailwind-merge:
        specifier: ^2.5.5
        version: 2.6.0
      tailwindcss-animate:
        specifier: ^1.0.7
        version: 1.0.7(tailwindcss@3.4.17)
      vaul:
        specifier: ^0.9.6
        version: 0.9.9(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      zod:
        specifier: ^3.24.1
        version: 3.25.71
      zustand:
        specifier: ^5.0.6
        version: 5.0.6(@types/react@19.1.8)(react@19.1.0)(use-sync-external-store@1.5.0(react@19.1.0))
    devDependencies:
      '@playwright/test':
        specifier: ^1.44.1
        version: 1.53.2
      '@testing-library/jest-dom':
        specifier: ^6.6.3
        version: 6.6.3
      '@testing-library/react':
        specifier: ^16.3.0
        version: 16.3.0(@testing-library/dom@10.4.0)(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@testing-library/user-event':
        specifier: ^14.6.1
        version: 14.6.1(@testing-library/dom@10.4.0)
      '@types/node':
        specifier: ^22
        version: 22.16.0
      '@types/react':
        specifier: ^19
        version: 19.1.8
      '@types/react-dom':
        specifier: ^19
        version: 19.1.6(@types/react@19.1.8)
      '@vitejs/plugin-react':
        specifier: ^4.6.0
        version: 4.6.0(vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0))
      '@vitest/ui':
        specifier: ^3.2.4
        version: 3.2.4(vitest@3.2.4)
      autoprefixer:
        specifier: ^10.4.20
        version: 10.4.21(postcss@8.5.6)
      eslint:
        specifier: ^9
        version: 9.30.1(jiti@1.21.7)
      eslint-config-next:
        specifier: 15.3.4
        version: 15.3.4(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      jsdom:
        specifier: ^26.1.0
        version: 26.1.0
      postcss:
        specifier: ^8.5.0
        version: 8.5.6
      tailwindcss:
        specifier: ^3.4.17
        version: 3.4.17
      typescript:
        specifier: ^5
        version: 5.8.3
      vitest:
        specifier: ^3.2.4
        version: 3.2.4(@types/node@22.16.0)(@vitest/ui@3.2.4)(jiti@1.21.7)(jsdom@26.1.0)(yaml@2.8.0)

packages:

  '@adobe/css-tools@4.4.3':
    resolution: {integrity: sha512-VQKMkwriZbaOgVCby1UDY/LDk5fIjhQicCvVPFqfe+69fWaPWydbWJ3wRt59/YzIwda1I81loas3oCoHxnqvdA==}

  '@alloc/quick-lru@5.2.0':
    resolution: {integrity: sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw==}
    engines: {node: '>=10'}

  '@ampproject/remapping@2.3.0':
    resolution: {integrity: sha512-30iZtAPgz+LTIYoeivqYo853f02jBYSd5uGnGpkFV0M3xOt9aN73erkgYAmZU43x4VfqcnLxW9Kpg3R5LC4YYw==}
    engines: {node: '>=6.0.0'}

  '@asamuzakjp/css-color@3.2.0':
    resolution: {integrity: sha512-K1A6z8tS3XsmCMM86xoWdn7Fkdn9m6RSVtocUrJYIwZnFVkng/PvkEoWtOWmP+Scc6saYWHWZYbndEEXxl24jw==}

  '@babel/code-frame@7.27.1':
    resolution: {integrity: sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==}
    engines: {node: '>=6.9.0'}

  '@babel/compat-data@7.28.0':
    resolution: {integrity: sha512-60X7qkglvrap8mn1lh2ebxXdZYtUcpd7gsmy9kLaBJ4i/WdY8PqTSdxyA8qraikqKQK5C1KRBKXqznrVapyNaw==}
    engines: {node: '>=6.9.0'}

  '@babel/core@7.28.0':
    resolution: {integrity: sha512-UlLAnTPrFdNGoFtbSXwcGFQBtQZJCNjaN6hQNP3UPvuNXT1i82N26KL3dZeIpNalWywr9IuQuncaAfUaS1g6sQ==}
    engines: {node: '>=6.9.0'}

  '@babel/generator@7.28.0':
    resolution: {integrity: sha512-lJjzvrbEeWrhB4P3QBsH7tey117PjLZnDbLiQEKjQ/fNJTjuq4HSqgFA+UNSwZT8D7dxxbnuSBMsa1lrWzKlQg==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-compilation-targets@7.27.2':
    resolution: {integrity: sha512-2+1thGUUWWjLTYTHZWK1n8Yga0ijBz1XAhUXcKy81rd5g6yh7hGqMp45v7cadSbEHc9G3OTv45SyneRN3ps4DQ==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-globals@7.28.0':
    resolution: {integrity: sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-module-imports@7.27.1':
    resolution: {integrity: sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-module-transforms@7.27.3':
    resolution: {integrity: sha512-dSOvYwvyLsWBeIRyOeHXp5vPj5l1I011r52FM1+r1jCERv+aFXYk4whgQccYEGYxK2H3ZAIA8nuPkQ0HaUo3qg==}
    engines: {node: '>=6.9.0'}
    peerDependencies:
      '@babel/core': ^7.0.0

  '@babel/helper-plugin-utils@7.27.1':
    resolution: {integrity: sha512-1gn1Up5YXka3YYAHGKpbideQ5Yjf1tDa9qYcgysz+cNCXukyLl6DjPXhD3VRwSb8c0J9tA4b2+rHEZtc6R0tlw==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-string-parser@7.27.1':
    resolution: {integrity: sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-validator-identifier@7.27.1':
    resolution: {integrity: sha512-D2hP9eA+Sqx1kBZgzxZh0y1trbuU+JoDkiEwqhQ36nodYqJwyEIhPSdMNd7lOm/4io72luTPWH20Yda0xOuUow==}
    engines: {node: '>=6.9.0'}

  '@babel/helper-validator-option@7.27.1':
    resolution: {integrity: sha512-YvjJow9FxbhFFKDSuFnVCe2WxXk1zWc22fFePVNEaWJEu8IrZVlda6N0uHwzZrUM1il7NC9Mlp4MaJYbYd9JSg==}
    engines: {node: '>=6.9.0'}

  '@babel/helpers@7.27.6':
    resolution: {integrity: sha512-muE8Tt8M22638HU31A3CgfSUciwz1fhATfoVai05aPXGor//CdWDCbnlY1yvBPo07njuVOCNGCSp/GTt12lIug==}
    engines: {node: '>=6.9.0'}

  '@babel/parser@7.28.0':
    resolution: {integrity: sha512-jVZGvOxOuNSsuQuLRTh13nU0AogFlw32w/MT+LV6D3sP5WdbW61E77RnkbaO2dUvmPAYrBDJXGn5gGS6tH4j8g==}
    engines: {node: '>=6.0.0'}
    hasBin: true

  '@babel/plugin-transform-react-jsx-self@7.27.1':
    resolution: {integrity: sha512-6UzkCs+ejGdZ5mFFC/OCUrv028ab2fp1znZmCZjAOBKiBK2jXD1O+BPSfX8X2qjJ75fZBMSnQn3Rq2mrBJK2mw==}
    engines: {node: '>=6.9.0'}
    peerDependencies:
      '@babel/core': ^7.0.0-0

  '@babel/plugin-transform-react-jsx-source@7.27.1':
    resolution: {integrity: sha512-zbwoTsBruTeKB9hSq73ha66iFeJHuaFkUbwvqElnygoNbj/jHRsSeokowZFN3CZ64IvEqcmmkVe89OPXc7ldAw==}
    engines: {node: '>=6.9.0'}
    peerDependencies:
      '@babel/core': ^7.0.0-0

  '@babel/runtime@7.27.6':
    resolution: {integrity: sha512-vbavdySgbTTrmFE+EsiqUTzlOr5bzlnJtUv9PynGCAKvfQqjIXbvFdumPM/GxMDfyuGMJaJAU6TO4zc1Jf1i8Q==}
    engines: {node: '>=6.9.0'}

  '@babel/template@7.27.2':
    resolution: {integrity: sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==}
    engines: {node: '>=6.9.0'}

  '@babel/traverse@7.28.0':
    resolution: {integrity: sha512-mGe7UK5wWyh0bKRfupsUchrQGqvDbZDbKJw+kcRGSmdHVYrv+ltd0pnpDTVpiTqnaBru9iEvA8pz8W46v0Amwg==}
    engines: {node: '>=6.9.0'}

  '@babel/types@7.28.0':
    resolution: {integrity: sha512-jYnje+JyZG5YThjHiF28oT4SIZLnYOcSBb6+SDaFIyzDVSkXQmQQYclJ2R+YxcdmK0AX6x1E5OQNtuh3jHDrUg==}
    engines: {node: '>=6.9.0'}

  '@csstools/color-helpers@5.0.2':
    resolution: {integrity: sha512-JqWH1vsgdGcw2RR6VliXXdA0/59LttzlU8UlRT/iUUsEeWfYq8I+K0yhihEUTTHLRm1EXvpsCx3083EU15ecsA==}
    engines: {node: '>=18'}

  '@csstools/css-calc@2.1.4':
    resolution: {integrity: sha512-3N8oaj+0juUw/1H3YwmDDJXCgTB1gKU6Hc/bB502u9zR0q2vd786XJH9QfrKIEgFlZmhZiq6epXl4rHqhzsIgQ==}
    engines: {node: '>=18'}
    peerDependencies:
      '@csstools/css-parser-algorithms': ^3.0.5
      '@csstools/css-tokenizer': ^3.0.4

  '@csstools/css-color-parser@3.0.10':
    resolution: {integrity: sha512-TiJ5Ajr6WRd1r8HSiwJvZBiJOqtH86aHpUjq5aEKWHiII2Qfjqd/HCWKPOW8EP4vcspXbHnXrwIDlu5savQipg==}
    engines: {node: '>=18'}
    peerDependencies:
      '@csstools/css-parser-algorithms': ^3.0.5
      '@csstools/css-tokenizer': ^3.0.4

  '@csstools/css-parser-algorithms@3.0.5':
    resolution: {integrity: sha512-DaDeUkXZKjdGhgYaHNJTV9pV7Y9B3b644jCLs9Upc3VeNGg6LWARAT6O+Q+/COo+2gg/bM5rhpMAtf70WqfBdQ==}
    engines: {node: '>=18'}
    peerDependencies:
      '@csstools/css-tokenizer': ^3.0.4

  '@csstools/css-tokenizer@3.0.4':
    resolution: {integrity: sha512-Vd/9EVDiu6PPJt9yAh6roZP6El1xHrdvIVGjyBsHR0RYwNHgL7FJPyIIW4fANJNG6FtyZfvlRPpFI4ZM/lubvw==}
    engines: {node: '>=18'}

  '@emnapi/core@1.4.3':
    resolution: {integrity: sha512-4m62DuCE07lw01soJwPiBGC0nAww0Q+RY70VZ+n49yDIO13yyinhbWCeNnaob0lakDtWQzSdtNWzJeOJt2ma+g==}

  '@emnapi/runtime@1.4.3':
    resolution: {integrity: sha512-pBPWdu6MLKROBX05wSNKcNb++m5Er+KQ9QkB+WVM+pW2Kx9hoSrVTnu3BdkI5eBLZoKu/J6mW/B6i6bJB2ytXQ==}

  '@emnapi/wasi-threads@1.0.2':
    resolution: {integrity: sha512-5n3nTJblwRi8LlXkJ9eBzu+kZR8Yxcc7ubakyQTFzPMtIhFpUBRbsnc2Dv88IZDIbCDlBiWrknhB4Lsz7mg6BA==}

  '@esbuild/aix-ppc64@0.25.5':
    resolution: {integrity: sha512-9o3TMmpmftaCMepOdA5k/yDw8SfInyzWWTjYTFCX3kPSDJMROQTb8jg+h9Cnwnmm1vOzvxN7gIfB5V2ewpjtGA==}
    engines: {node: '>=18'}
    cpu: [ppc64]
    os: [aix]

  '@esbuild/android-arm64@0.25.5':
    resolution: {integrity: sha512-VGzGhj4lJO+TVGV1v8ntCZWJktV7SGCs3Pn1GRWI1SBFtRALoomm8k5E9Pmwg3HOAal2VDc2F9+PM/rEY6oIDg==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [android]

  '@esbuild/android-arm@0.25.5':
    resolution: {integrity: sha512-AdJKSPeEHgi7/ZhuIPtcQKr5RQdo6OO2IL87JkianiMYMPbCtot9fxPbrMiBADOWWm3T2si9stAiVsGbTQFkbA==}
    engines: {node: '>=18'}
    cpu: [arm]
    os: [android]

  '@esbuild/android-x64@0.25.5':
    resolution: {integrity: sha512-D2GyJT1kjvO//drbRT3Hib9XPwQeWd9vZoBJn+bu/lVsOZ13cqNdDeqIF/xQ5/VmWvMduP6AmXvylO/PIc2isw==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [android]

  '@esbuild/darwin-arm64@0.25.5':
    resolution: {integrity: sha512-GtaBgammVvdF7aPIgH2jxMDdivezgFu6iKpmT+48+F8Hhg5J/sfnDieg0aeG/jfSvkYQU2/pceFPDKlqZzwnfQ==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [darwin]

  '@esbuild/darwin-x64@0.25.5':
    resolution: {integrity: sha512-1iT4FVL0dJ76/q1wd7XDsXrSW+oLoquptvh4CLR4kITDtqi2e/xwXwdCVH8hVHU43wgJdsq7Gxuzcs6Iq/7bxQ==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [darwin]

  '@esbuild/freebsd-arm64@0.25.5':
    resolution: {integrity: sha512-nk4tGP3JThz4La38Uy/gzyXtpkPW8zSAmoUhK9xKKXdBCzKODMc2adkB2+8om9BDYugz+uGV7sLmpTYzvmz6Sw==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [freebsd]

  '@esbuild/freebsd-x64@0.25.5':
    resolution: {integrity: sha512-PrikaNjiXdR2laW6OIjlbeuCPrPaAl0IwPIaRv+SMV8CiM8i2LqVUHFC1+8eORgWyY7yhQY+2U2fA55mBzReaw==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [freebsd]

  '@esbuild/linux-arm64@0.25.5':
    resolution: {integrity: sha512-Z9kfb1v6ZlGbWj8EJk9T6czVEjjq2ntSYLY2cw6pAZl4oKtfgQuS4HOq41M/BcoLPzrUbNd+R4BXFyH//nHxVg==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [linux]

  '@esbuild/linux-arm@0.25.5':
    resolution: {integrity: sha512-cPzojwW2okgh7ZlRpcBEtsX7WBuqbLrNXqLU89GxWbNt6uIg78ET82qifUy3W6OVww6ZWobWub5oqZOVtwolfw==}
    engines: {node: '>=18'}
    cpu: [arm]
    os: [linux]

  '@esbuild/linux-ia32@0.25.5':
    resolution: {integrity: sha512-sQ7l00M8bSv36GLV95BVAdhJ2QsIbCuCjh/uYrWiMQSUuV+LpXwIqhgJDcvMTj+VsQmqAHL2yYaasENvJ7CDKA==}
    engines: {node: '>=18'}
    cpu: [ia32]
    os: [linux]

  '@esbuild/linux-loong64@0.25.5':
    resolution: {integrity: sha512-0ur7ae16hDUC4OL5iEnDb0tZHDxYmuQyhKhsPBV8f99f6Z9KQM02g33f93rNH5A30agMS46u2HP6qTdEt6Q1kg==}
    engines: {node: '>=18'}
    cpu: [loong64]
    os: [linux]

  '@esbuild/linux-mips64el@0.25.5':
    resolution: {integrity: sha512-kB/66P1OsHO5zLz0i6X0RxlQ+3cu0mkxS3TKFvkb5lin6uwZ/ttOkP3Z8lfR9mJOBk14ZwZ9182SIIWFGNmqmg==}
    engines: {node: '>=18'}
    cpu: [mips64el]
    os: [linux]

  '@esbuild/linux-ppc64@0.25.5':
    resolution: {integrity: sha512-UZCmJ7r9X2fe2D6jBmkLBMQetXPXIsZjQJCjgwpVDz+YMcS6oFR27alkgGv3Oqkv07bxdvw7fyB71/olceJhkQ==}
    engines: {node: '>=18'}
    cpu: [ppc64]
    os: [linux]

  '@esbuild/linux-riscv64@0.25.5':
    resolution: {integrity: sha512-kTxwu4mLyeOlsVIFPfQo+fQJAV9mh24xL+y+Bm6ej067sYANjyEw1dNHmvoqxJUCMnkBdKpvOn0Ahql6+4VyeA==}
    engines: {node: '>=18'}
    cpu: [riscv64]
    os: [linux]

  '@esbuild/linux-s390x@0.25.5':
    resolution: {integrity: sha512-K2dSKTKfmdh78uJ3NcWFiqyRrimfdinS5ErLSn3vluHNeHVnBAFWC8a4X5N+7FgVE1EjXS1QDZbpqZBjfrqMTQ==}
    engines: {node: '>=18'}
    cpu: [s390x]
    os: [linux]

  '@esbuild/linux-x64@0.25.5':
    resolution: {integrity: sha512-uhj8N2obKTE6pSZ+aMUbqq+1nXxNjZIIjCjGLfsWvVpy7gKCOL6rsY1MhRh9zLtUtAI7vpgLMK6DxjO8Qm9lJw==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [linux]

  '@esbuild/netbsd-arm64@0.25.5':
    resolution: {integrity: sha512-pwHtMP9viAy1oHPvgxtOv+OkduK5ugofNTVDilIzBLpoWAM16r7b/mxBvfpuQDpRQFMfuVr5aLcn4yveGvBZvw==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [netbsd]

  '@esbuild/netbsd-x64@0.25.5':
    resolution: {integrity: sha512-WOb5fKrvVTRMfWFNCroYWWklbnXH0Q5rZppjq0vQIdlsQKuw6mdSihwSo4RV/YdQ5UCKKvBy7/0ZZYLBZKIbwQ==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [netbsd]

  '@esbuild/openbsd-arm64@0.25.5':
    resolution: {integrity: sha512-7A208+uQKgTxHd0G0uqZO8UjK2R0DDb4fDmERtARjSHWxqMTye4Erz4zZafx7Di9Cv+lNHYuncAkiGFySoD+Mw==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [openbsd]

  '@esbuild/openbsd-x64@0.25.5':
    resolution: {integrity: sha512-G4hE405ErTWraiZ8UiSoesH8DaCsMm0Cay4fsFWOOUcz8b8rC6uCvnagr+gnioEjWn0wC+o1/TAHt+It+MpIMg==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [openbsd]

  '@esbuild/sunos-x64@0.25.5':
    resolution: {integrity: sha512-l+azKShMy7FxzY0Rj4RCt5VD/q8mG/e+mDivgspo+yL8zW7qEwctQ6YqKX34DTEleFAvCIUviCFX1SDZRSyMQA==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [sunos]

  '@esbuild/win32-arm64@0.25.5':
    resolution: {integrity: sha512-O2S7SNZzdcFG7eFKgvwUEZ2VG9D/sn/eIiz8XRZ1Q/DO5a3s76Xv0mdBzVM5j5R639lXQmPmSo0iRpHqUUrsxw==}
    engines: {node: '>=18'}
    cpu: [arm64]
    os: [win32]

  '@esbuild/win32-ia32@0.25.5':
    resolution: {integrity: sha512-onOJ02pqs9h1iMJ1PQphR+VZv8qBMQ77Klcsqv9CNW2w6yLqoURLcgERAIurY6QE63bbLuqgP9ATqajFLK5AMQ==}
    engines: {node: '>=18'}
    cpu: [ia32]
    os: [win32]

  '@esbuild/win32-x64@0.25.5':
    resolution: {integrity: sha512-TXv6YnJ8ZMVdX+SXWVBo/0p8LTcrUYngpWjvm91TMjjBQii7Oz11Lw5lbDV5Y0TzuhSJHwiH4hEtC1I42mMS0g==}
    engines: {node: '>=18'}
    cpu: [x64]
    os: [win32]

  '@eslint-community/eslint-utils@4.7.0':
    resolution: {integrity: sha512-dyybb3AcajC7uha6CvhdVRJqaKyn7w2YKqKyAN37NKYgZT36w+iRb0Dymmc5qEJ549c/S31cMMSFd75bteCpCw==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    peerDependencies:
      eslint: ^6.0.0 || ^7.0.0 || >=8.0.0

  '@eslint-community/regexpp@4.12.1':
    resolution: {integrity: sha512-CCZCDJuduB9OUkFkY2IgppNZMi2lBQgD2qzwXkEia16cge2pijY/aXi96CJMquDMn3nJdlPV1A5KrJEXwfLNzQ==}
    engines: {node: ^12.0.0 || ^14.0.0 || >=16.0.0}

  '@eslint/config-array@0.21.0':
    resolution: {integrity: sha512-ENIdc4iLu0d93HeYirvKmrzshzofPw6VkZRKQGe9Nv46ZnWUzcF1xV01dcvEg/1wXUR61OmmlSfyeyO7EvjLxQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/config-helpers@0.3.0':
    resolution: {integrity: sha512-ViuymvFmcJi04qdZeDc2whTHryouGcDlaxPqarTD0ZE10ISpxGUVZGZDx4w01upyIynL3iu6IXH2bS1NhclQMw==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/core@0.14.0':
    resolution: {integrity: sha512-qIbV0/JZr7iSDjqAc60IqbLdsj9GDt16xQtWD+B78d/HAlvysGdZZ6rpJHGAc2T0FQx1X6thsSPdnoiGKdNtdg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/core@0.15.1':
    resolution: {integrity: sha512-bkOp+iumZCCbt1K1CmWf0R9pM5yKpDv+ZXtvSyQpudrI9kuFLp+bM2WOPXImuD/ceQuaa8f5pj93Y7zyECIGNA==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/eslintrc@3.3.1':
    resolution: {integrity: sha512-gtF186CXhIl1p4pJNGZw8Yc6RlshoePRvE0X91oPGb3vZ8pM3qOS9W9NGPat9LziaBV7XrJWGylNQXkGcnM3IQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/js@9.30.1':
    resolution: {integrity: sha512-zXhuECFlyep42KZUhWjfvsmXGX39W8K8LFb8AWXM9gSV9dQB+MrJGLKvW6Zw0Ggnbpw0VHTtrhFXYe3Gym18jg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/object-schema@2.1.6':
    resolution: {integrity: sha512-RBMg5FRL0I0gs51M/guSAj5/e14VQ4tpZnQNWwuDT66P14I43ItmPfIZRhO9fUVIPOAQXU47atlywZ/czoqFPA==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@eslint/plugin-kit@0.3.3':
    resolution: {integrity: sha512-1+WqvgNMhmlAambTvT3KPtCl/Ibr68VldY2XY40SL1CE0ZXiakFR/cbTspaF5HsnpDMvcYYoJHfl4980NBjGag==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@floating-ui/core@1.7.2':
    resolution: {integrity: sha512-wNB5ooIKHQc+Kui96jE/n69rHFWAVoxn5CAzL1Xdd8FG03cgY3MLO+GF9U3W737fYDSgPWA6MReKhBQBop6Pcw==}

  '@floating-ui/dom@1.7.2':
    resolution: {integrity: sha512-7cfaOQuCS27HD7DX+6ib2OrnW+b4ZBwDNnCcT0uTyidcmyWb03FnQqJybDBoCnpdxwBSfA94UAYlRCt7mV+TbA==}

  '@floating-ui/react-dom@2.1.4':
    resolution: {integrity: sha512-JbbpPhp38UmXDDAu60RJmbeme37Jbgsm7NrHGgzYYFKmblzRUh6Pa641dII6LsjwF4XlScDrde2UAzDo/b9KPw==}
    peerDependencies:
      react: '>=16.8.0'
      react-dom: '>=16.8.0'

  '@floating-ui/utils@0.2.10':
    resolution: {integrity: sha512-aGTxbpbg8/b5JfU1HXSrbH3wXZuLPJcNEcZQFMxLs3oSzgtVu6nFPkbbGGUvBcUjKV2YyB9Wxxabo+HEH9tcRQ==}

  '@hookform/resolvers@3.10.0':
    resolution: {integrity: sha512-79Dv+3mDF7i+2ajj7SkypSKHhl1cbln1OGavqrsF7p6mbUv11xpqpacPsGDCTRvCSjEEIez2ef1NveSVL3b0Ag==}
    peerDependencies:
      react-hook-form: ^7.0.0

  '@humanfs/core@0.19.1':
    resolution: {integrity: sha512-5DyQ4+1JEUzejeK1JGICcideyfUbGixgS9jNgex5nqkW+cY7WZhxBigmieN5Qnw9ZosSNVC9KQKyb+GUaGyKUA==}
    engines: {node: '>=18.18.0'}

  '@humanfs/node@0.16.6':
    resolution: {integrity: sha512-YuI2ZHQL78Q5HbhDiBA1X4LmYdXCKCMQIfw0pw7piHJwyREFebJUvrQN4cMssyES6x+vfUbx1CIpaQUKYdQZOw==}
    engines: {node: '>=18.18.0'}

  '@humanwhocodes/module-importer@1.0.1':
    resolution: {integrity: sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==}
    engines: {node: '>=12.22'}

  '@humanwhocodes/retry@0.3.1':
    resolution: {integrity: sha512-JBxkERygn7Bv/GbN5Rv8Ul6LVknS+5Bp6RgDC/O8gEBU/yeH5Ui5C/OlWrTb6qct7LjjfT6Re2NxB0ln0yYybA==}
    engines: {node: '>=18.18'}

  '@humanwhocodes/retry@0.4.3':
    resolution: {integrity: sha512-bV0Tgo9K4hfPCek+aMAn81RppFKv2ySDQeMoSZuvTASywNTnVJCArCZE2FWqpvIatKu7VMRLWlR1EazvVhDyhQ==}
    engines: {node: '>=18.18'}

  '@img/sharp-darwin-arm64@0.33.5':
    resolution: {integrity: sha512-UT4p+iz/2H4twwAoLCqfA9UH5pI6DggwKEGuaPy7nCVQ8ZsiY5PIcrRvD1DzuY3qYL07NtIQcWnBSY/heikIFQ==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [arm64]
    os: [darwin]

  '@img/sharp-darwin-x64@0.33.5':
    resolution: {integrity: sha512-fyHac4jIc1ANYGRDxtiqelIbdWkIuQaI84Mv45KvGRRxSAa7o7d1ZKAOBaYbnepLC1WqxfpimdeWfvqqSGwR2Q==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [x64]
    os: [darwin]

  '@img/sharp-libvips-darwin-arm64@1.0.4':
    resolution: {integrity: sha512-XblONe153h0O2zuFfTAbQYAX2JhYmDHeWikp1LM9Hul9gVPjFY427k6dFEcOL72O01QxQsWi761svJ/ev9xEDg==}
    cpu: [arm64]
    os: [darwin]

  '@img/sharp-libvips-darwin-x64@1.0.4':
    resolution: {integrity: sha512-xnGR8YuZYfJGmWPvmlunFaWJsb9T/AO2ykoP3Fz/0X5XV2aoYBPkX6xqCQvUTKKiLddarLaxpzNe+b1hjeWHAQ==}
    cpu: [x64]
    os: [darwin]

  '@img/sharp-libvips-linux-arm64@1.0.4':
    resolution: {integrity: sha512-9B+taZ8DlyyqzZQnoeIvDVR/2F4EbMepXMc/NdVbkzsJbzkUjhXv/70GQJ7tdLA4YJgNP25zukcxpX2/SueNrA==}
    cpu: [arm64]
    os: [linux]

  '@img/sharp-libvips-linux-arm@1.0.5':
    resolution: {integrity: sha512-gvcC4ACAOPRNATg/ov8/MnbxFDJqf/pDePbBnuBDcjsI8PssmjoKMAz4LtLaVi+OnSb5FK/yIOamqDwGmXW32g==}
    cpu: [arm]
    os: [linux]

  '@img/sharp-libvips-linux-s390x@1.0.4':
    resolution: {integrity: sha512-u7Wz6ntiSSgGSGcjZ55im6uvTrOxSIS8/dgoVMoiGE9I6JAfU50yH5BoDlYA1tcuGS7g/QNtetJnxA6QEsCVTA==}
    cpu: [s390x]
    os: [linux]

  '@img/sharp-libvips-linux-x64@1.0.4':
    resolution: {integrity: sha512-MmWmQ3iPFZr0Iev+BAgVMb3ZyC4KeFc3jFxnNbEPas60e1cIfevbtuyf9nDGIzOaW9PdnDciJm+wFFaTlj5xYw==}
    cpu: [x64]
    os: [linux]

  '@img/sharp-libvips-linuxmusl-arm64@1.0.4':
    resolution: {integrity: sha512-9Ti+BbTYDcsbp4wfYib8Ctm1ilkugkA/uscUn6UXK1ldpC1JjiXbLfFZtRlBhjPZ5o1NCLiDbg8fhUPKStHoTA==}
    cpu: [arm64]
    os: [linux]

  '@img/sharp-libvips-linuxmusl-x64@1.0.4':
    resolution: {integrity: sha512-viYN1KX9m+/hGkJtvYYp+CCLgnJXwiQB39damAO7WMdKWlIhmYTfHjwSbQeUK/20vY154mwezd9HflVFM1wVSw==}
    cpu: [x64]
    os: [linux]

  '@img/sharp-linux-arm64@0.33.5':
    resolution: {integrity: sha512-JMVv+AMRyGOHtO1RFBiJy/MBsgz0x4AWrT6QoEVVTyh1E39TrCUpTRI7mx9VksGX4awWASxqCYLCV4wBZHAYxA==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [arm64]
    os: [linux]

  '@img/sharp-linux-arm@0.33.5':
    resolution: {integrity: sha512-JTS1eldqZbJxjvKaAkxhZmBqPRGmxgu+qFKSInv8moZ2AmT5Yib3EQ1c6gp493HvrvV8QgdOXdyaIBrhvFhBMQ==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [arm]
    os: [linux]

  '@img/sharp-linux-s390x@0.33.5':
    resolution: {integrity: sha512-y/5PCd+mP4CA/sPDKl2961b+C9d+vPAveS33s6Z3zfASk2j5upL6fXVPZi7ztePZ5CuH+1kW8JtvxgbuXHRa4Q==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [s390x]
    os: [linux]

  '@img/sharp-linux-x64@0.33.5':
    resolution: {integrity: sha512-opC+Ok5pRNAzuvq1AG0ar+1owsu842/Ab+4qvU879ippJBHvyY5n2mxF1izXqkPYlGuP/M556uh53jRLJmzTWA==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [x64]
    os: [linux]

  '@img/sharp-linuxmusl-arm64@0.33.5':
    resolution: {integrity: sha512-XrHMZwGQGvJg2V/oRSUfSAfjfPxO+4DkiRh6p2AFjLQztWUuY/o8Mq0eMQVIY7HJ1CDQUJlxGGZRw1a5bqmd1g==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [arm64]
    os: [linux]

  '@img/sharp-linuxmusl-x64@0.33.5':
    resolution: {integrity: sha512-WT+d/cgqKkkKySYmqoZ8y3pxx7lx9vVejxW/W4DOFMYVSkErR+w7mf2u8m/y4+xHe7yY9DAXQMWQhpnMuFfScw==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [x64]
    os: [linux]

  '@img/sharp-wasm32@0.33.5':
    resolution: {integrity: sha512-ykUW4LVGaMcU9lu9thv85CbRMAwfeadCJHRsg2GmeRa/cJxsVY9Rbd57JcMxBkKHag5U/x7TSBpScF4U8ElVzg==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [wasm32]

  '@img/sharp-win32-ia32@0.33.5':
    resolution: {integrity: sha512-T36PblLaTwuVJ/zw/LaH0PdZkRz5rd3SmMHX8GSmR7vtNSP5Z6bQkExdSK7xGWyxLw4sUknBuugTelgw2faBbQ==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [ia32]
    os: [win32]

  '@img/sharp-win32-x64@0.33.5':
    resolution: {integrity: sha512-MpY/o8/8kj+EcnxwvrP4aTJSWw/aZ7JIGR4aBeZkZw5B7/Jn+tY9/VNwtcoGmdT7GfggGIU4kygOMSbYnOrAbg==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    cpu: [x64]
    os: [win32]

  '@isaacs/cliui@8.0.2':
    resolution: {integrity: sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==}
    engines: {node: '>=12'}

  '@jridgewell/gen-mapping@0.3.12':
    resolution: {integrity: sha512-OuLGC46TjB5BbN1dH8JULVVZY4WTdkF7tV9Ys6wLL1rubZnCMstOhNHueU5bLCrnRuDhKPDM4g6sw4Bel5Gzqg==}

  '@jridgewell/resolve-uri@3.1.2':
    resolution: {integrity: sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==}
    engines: {node: '>=6.0.0'}

  '@jridgewell/sourcemap-codec@1.5.4':
    resolution: {integrity: sha512-VT2+G1VQs/9oz078bLrYbecdZKs912zQlkelYpuf+SXF+QvZDYJlbx/LSx+meSAwdDFnF8FVXW92AVjjkVmgFw==}

  '@jridgewell/trace-mapping@0.3.29':
    resolution: {integrity: sha512-uw6guiW/gcAGPDhLmd77/6lW8QLeiV5RUTsAX46Db6oLhGaVj4lhnPwb184s1bkc8kdVg/+h988dro8GRDpmYQ==}

  '@napi-rs/wasm-runtime@0.2.11':
    resolution: {integrity: sha512-9DPkXtvHydrcOsopiYpUgPHpmj0HWZKMUnL2dZqpvC42lsratuBG06V5ipyno0fUek5VlFsNQ+AcFATSrJXgMA==}

  '@next/env@15.2.4':
    resolution: {integrity: sha512-+SFtMgoiYP3WoSswuNmxJOCwi06TdWE733D+WPjpXIe4LXGULwEaofiiAy6kbS0+XjM5xF5n3lKuBwN2SnqD9g==}

  '@next/eslint-plugin-next@15.3.4':
    resolution: {integrity: sha512-lBxYdj7TI8phbJcLSAqDt57nIcobEign5NYIKCiy0hXQhrUbTqLqOaSDi568U6vFg4hJfBdZYsG4iP/uKhCqgg==}

  '@next/swc-darwin-arm64@15.2.4':
    resolution: {integrity: sha512-1AnMfs655ipJEDC/FHkSr0r3lXBgpqKo4K1kiwfUf3iE68rDFXZ1TtHdMvf7D0hMItgDZ7Vuq3JgNMbt/+3bYw==}
    engines: {node: '>= 10'}
    cpu: [arm64]
    os: [darwin]

  '@next/swc-darwin-x64@15.2.4':
    resolution: {integrity: sha512-3qK2zb5EwCwxnO2HeO+TRqCubeI/NgCe+kL5dTJlPldV/uwCnUgC7VbEzgmxbfrkbjehL4H9BPztWOEtsoMwew==}
    engines: {node: '>= 10'}
    cpu: [x64]
    os: [darwin]

  '@next/swc-linux-arm64-gnu@15.2.4':
    resolution: {integrity: sha512-HFN6GKUcrTWvem8AZN7tT95zPb0GUGv9v0d0iyuTb303vbXkkbHDp/DxufB04jNVD+IN9yHy7y/6Mqq0h0YVaQ==}
    engines: {node: '>= 10'}
    cpu: [arm64]
    os: [linux]

  '@next/swc-linux-arm64-musl@15.2.4':
    resolution: {integrity: sha512-Oioa0SORWLwi35/kVB8aCk5Uq+5/ZIumMK1kJV+jSdazFm2NzPDztsefzdmzzpx5oGCJ6FkUC7vkaUseNTStNA==}
    engines: {node: '>= 10'}
    cpu: [arm64]
    os: [linux]

  '@next/swc-linux-x64-gnu@15.2.4':
    resolution: {integrity: sha512-yb5WTRaHdkgOqFOZiu6rHV1fAEK0flVpaIN2HB6kxHVSy/dIajWbThS7qON3W9/SNOH2JWkVCyulgGYekMePuw==}
    engines: {node: '>= 10'}
    cpu: [x64]
    os: [linux]

  '@next/swc-linux-x64-musl@15.2.4':
    resolution: {integrity: sha512-Dcdv/ix6srhkM25fgXiyOieFUkz+fOYkHlydWCtB0xMST6X9XYI3yPDKBZt1xuhOytONsIFJFB08xXYsxUwJLw==}
    engines: {node: '>= 10'}
    cpu: [x64]
    os: [linux]

  '@next/swc-win32-arm64-msvc@15.2.4':
    resolution: {integrity: sha512-dW0i7eukvDxtIhCYkMrZNQfNicPDExt2jPb9AZPpL7cfyUo7QSNl1DjsHjmmKp6qNAqUESyT8YFl/Aw91cNJJg==}
    engines: {node: '>= 10'}
    cpu: [arm64]
    os: [win32]

  '@next/swc-win32-x64-msvc@15.2.4':
    resolution: {integrity: sha512-SbnWkJmkS7Xl3kre8SdMF6F/XDh1DTFEhp0jRTj/uB8iPKoU2bb2NDfcu+iifv1+mxQEd1g2vvSxcZbXSKyWiQ==}
    engines: {node: '>= 10'}
    cpu: [x64]
    os: [win32]

  '@nodelib/fs.scandir@2.1.5':
    resolution: {integrity: sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==}
    engines: {node: '>= 8'}

  '@nodelib/fs.stat@2.0.5':
    resolution: {integrity: sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==}
    engines: {node: '>= 8'}

  '@nodelib/fs.walk@1.2.8':
    resolution: {integrity: sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==}
    engines: {node: '>= 8'}

  '@nolyfill/is-core-module@1.0.39':
    resolution: {integrity: sha512-nn5ozdjYQpUCZlWGuxcJY/KpxkWQs4DcbMCmKojjyrYDEAGy4Ce19NN4v5MduafTwJlbKc99UA8YhSVqq9yPZA==}
    engines: {node: '>=12.4.0'}

  '@pkgjs/parseargs@0.11.0':
    resolution: {integrity: sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==}
    engines: {node: '>=14'}

  '@playwright/test@1.53.2':
    resolution: {integrity: sha512-tEB2U5z74ebBeyfGNZ3Jfg29AnW+5HlWhvHtb/Mqco9pFdZU1ZLNdVb2UtB5CvmiilNr2ZfVH/qMmAROG/XTzw==}
    engines: {node: '>=18'}
    hasBin: true

  '@polka/url@1.0.0-next.29':
    resolution: {integrity: sha512-wwQAWhWSuHaag8c4q/KN/vCoeOJYshAIvMQwD4GpSb3OiZklFfvAgmj0VCBBImRpuF/aFgIRzllXlVX93Jevww==}

  '@radix-ui/number@1.1.0':
    resolution: {integrity: sha512-V3gRzhVNU1ldS5XhAPTom1fOIo4ccrjjJgmE+LI2h/WaFpHmx0MQApT+KZHnx8abG6Avtfcz4WoEciMnpFT3HQ==}

  '@radix-ui/primitive@1.1.1':
    resolution: {integrity: sha512-SJ31y+Q/zAyShtXJc8x83i9TYdbAfHZ++tUZnvjJJqFjzsdUnKsxPL6IEtBlxKkU7yzer//GQtZSV4GbldL3YA==}

  '@radix-ui/react-accordion@1.2.2':
    resolution: {integrity: sha512-b1oh54x4DMCdGsB4/7ahiSrViXxaBwRPotiZNnYXjLha9vfuURSAZErki6qjDoSIV0eXx5v57XnTGVtGwnfp2g==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-alert-dialog@1.1.4':
    resolution: {integrity: sha512-A6Kh23qZDLy3PSU4bh2UJZznOrUdHImIXqF8YtUa6CN73f8EOO9XlXSCd9IHyPvIquTaa/kwaSWzZTtUvgXVGw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-arrow@1.1.1':
    resolution: {integrity: sha512-NaVpZfmv8SKeZbn4ijN2V3jlHA9ngBG16VnIIm22nUR0Yk8KUALyBxT3KYEUnNuch9sTE8UTsS3whzBgKOL30w==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-aspect-ratio@1.1.1':
    resolution: {integrity: sha512-kNU4FIpcFMBLkOUcgeIteH06/8JLBcYY6Le1iKenDGCYNYFX3TQqCZjzkOsz37h7r94/99GTb7YhEr98ZBJibw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-avatar@1.1.2':
    resolution: {integrity: sha512-GaC7bXQZ5VgZvVvsJ5mu/AEbjYLnhhkoidOboC50Z6FFlLA03wG2ianUoH+zgDQ31/9gCF59bE4+2bBgTyMiig==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-checkbox@1.1.3':
    resolution: {integrity: sha512-HD7/ocp8f1B3e6OHygH0n7ZKjONkhciy1Nh0yuBgObqThc3oyx+vuMfFHKAknXRHHWVE9XvXStxJFyjUmB8PIw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-collapsible@1.1.2':
    resolution: {integrity: sha512-PliMB63vxz7vggcyq0IxNYk8vGDrLXVWw4+W4B8YnwI1s18x7YZYqlG9PLX7XxAJUi0g2DxP4XKJMFHh/iVh9A==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-collection@1.1.1':
    resolution: {integrity: sha512-LwT3pSho9Dljg+wY2KN2mrrh6y3qELfftINERIzBUO9e0N+t0oMTyn3k9iv+ZqgrwGkRnLpNJrsMv9BZlt2yuA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-compose-refs@1.1.1':
    resolution: {integrity: sha512-Y9VzoRDSJtgFMUCoiZBDVo084VQ5hfpXxVE+NgkdNsjiDBByiImMZKKhxMwCbdHvhlENG6a833CbFkOQvTricw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-compose-refs@1.1.2':
    resolution: {integrity: sha512-z4eqJvfiNnFMHIIvXP3CY57y2WJs5g2v3X0zm9mEJkrkNv4rDxu+sg9Jh8EkXyeqBkB7SOcboo9dMVqhyrACIg==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-context-menu@2.2.4':
    resolution: {integrity: sha512-ap4wdGwK52rJxGkwukU1NrnEodsUFQIooANKu+ey7d6raQ2biTcEf8za1zr0mgFHieevRTB2nK4dJeN8pTAZGQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-context@1.1.1':
    resolution: {integrity: sha512-UASk9zi+crv9WteK/NU4PLvOoL3OuE6BWVKNF6hPRBtYBDXQ2u5iu3O59zUlJiTVvkyuycnqrztsHVJwcK9K+Q==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-dialog@1.1.4':
    resolution: {integrity: sha512-Ur7EV1IwQGCyaAuyDRiOLA5JIUZxELJljF+MbM/2NC0BYwfuRrbpS30BiQBJrVruscgUkieKkqXYDOoByaxIoA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-direction@1.1.0':
    resolution: {integrity: sha512-BUuBvgThEiAXh2DWu93XsT+a3aWrGqolGlqqw5VU1kG7p/ZH2cuDlM1sRLNnY3QcBS69UIz2mcKhMxDsdewhjg==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-dismissable-layer@1.1.3':
    resolution: {integrity: sha512-onrWn/72lQoEucDmJnr8uczSNTujT0vJnA/X5+3AkChVPowr8n1yvIKIabhWyMQeMvvmdpsvcyDqx3X1LEXCPg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-dropdown-menu@2.1.4':
    resolution: {integrity: sha512-iXU1Ab5ecM+yEepGAWK8ZhMyKX4ubFdCNtol4sT9D0OVErG9PNElfx3TQhjw7n7BC5nFVz68/5//clWy+8TXzA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-focus-guards@1.1.1':
    resolution: {integrity: sha512-pSIwfrT1a6sIoDASCSpFwOasEwKTZWDw/iBdtnqKO7v6FeOzYJ7U53cPzYFVR3geGGXgVHaH+CdngrrAzqUGxg==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-focus-scope@1.1.1':
    resolution: {integrity: sha512-01omzJAYRxXdG2/he/+xy+c8a8gCydoQ1yOxnWNcRhrrBW5W+RQJ22EK1SaO8tb3WoUsuEw7mJjBozPzihDFjA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-hover-card@1.1.4':
    resolution: {integrity: sha512-QSUUnRA3PQ2UhvoCv3eYvMnCAgGQW+sTu86QPuNb+ZMi+ZENd6UWpiXbcWDQ4AEaKF9KKpCHBeaJz9Rw6lRlaQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-id@1.1.0':
    resolution: {integrity: sha512-EJUrI8yYh7WOjNOqpoJaf1jlFIH2LvtgAl+YcFqNCa+4hj64ZXmPkAKOFs/ukjz3byN6bdb/AVUqHkI8/uWWMA==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-id@1.1.1':
    resolution: {integrity: sha512-kGkGegYIdQsOb4XjsfM97rXsiHaBwco+hFI66oO4s9LU+PLAC5oJ7khdOVFxkhsmlbpUqDAvXw11CluXP+jkHg==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-label@2.1.1':
    resolution: {integrity: sha512-UUw5E4e/2+4kFMH7+YxORXGWggtY6sM8WIwh5RZchhLuUg2H1hc98Py+pr8HMz6rdaYrK2t296ZEjYLOCO5uUw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-menu@2.1.4':
    resolution: {integrity: sha512-BnOgVoL6YYdHAG6DtXONaR29Eq4nvbi8rutrV/xlr3RQCMMb3yqP85Qiw/3NReozrSW+4dfLkK+rc1hb4wPU/A==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-menubar@1.1.4':
    resolution: {integrity: sha512-+KMpi7VAZuB46+1LD7a30zb5IxyzLgC8m8j42gk3N4TUCcViNQdX8FhoH1HDvYiA8quuqcek4R4bYpPn/SY1GA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-navigation-menu@1.2.3':
    resolution: {integrity: sha512-IQWAsQ7dsLIYDrn0WqPU+cdM7MONTv9nqrLVYoie3BPiabSfUVDe6Fr+oEt0Cofsr9ONDcDe9xhmJbL1Uq1yKg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-popover@1.1.4':
    resolution: {integrity: sha512-aUACAkXx8LaFymDma+HQVji7WhvEhpFJ7+qPz17Nf4lLZqtreGOFRiNQWQmhzp7kEWg9cOyyQJpdIMUMPc/CPw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-popper@1.2.1':
    resolution: {integrity: sha512-3kn5Me69L+jv82EKRuQCXdYyf1DqHwD2U/sxoNgBGCB7K9TRc3bQamQ+5EPM9EvyPdli0W41sROd+ZU1dTCztw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-portal@1.1.3':
    resolution: {integrity: sha512-NciRqhXnGojhT93RPyDaMPfLH3ZSl4jjIFbZQ1b/vxvZEdHsBZ49wP9w8L3HzUQwep01LcWtkUvm0OVB5JAHTw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-presence@1.1.2':
    resolution: {integrity: sha512-18TFr80t5EVgL9x1SwF/YGtfG+l0BS0PRAlCWBDoBEiDQjeKgnNZRVJp/oVBl24sr3Gbfwc/Qpj4OcWTQMsAEg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-primitive@2.0.1':
    resolution: {integrity: sha512-sHCWTtxwNn3L3fH8qAfnF3WbUZycW93SM1j3NFDzXBiz8D6F5UTTy8G1+WFEaiCdvCVRJWj6N2R4Xq6HdiHmDg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-primitive@2.1.3':
    resolution: {integrity: sha512-m9gTwRkhy2lvCPe6QJp4d3G1TYEUHn/FzJUtq9MjH46an1wJU+GdoGC5VLof8RX8Ft/DlpshApkhswDLZzHIcQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-progress@1.1.1':
    resolution: {integrity: sha512-6diOawA84f/eMxFHcWut0aE1C2kyE9dOyCTQOMRR2C/qPiXz/X0SaiA/RLbapQaXUCmy0/hLMf9meSccD1N0pA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-radio-group@1.2.2':
    resolution: {integrity: sha512-E0MLLGfOP0l8P/NxgVzfXJ8w3Ch8cdO6UDzJfDChu4EJDy+/WdO5LqpdY8PYnCErkmZH3gZhDL1K7kQ41fAHuQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-roving-focus@1.1.1':
    resolution: {integrity: sha512-QE1RoxPGJ/Nm8Qmk0PxP8ojmoaS67i0s7hVssS7KuI2FQoc/uzVlZsqKfQvxPE6D8hICCPHJ4D88zNhT3OOmkw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-scroll-area@1.2.2':
    resolution: {integrity: sha512-EFI1N/S3YxZEW/lJ/H1jY3njlvTd8tBmgKEn4GHi51+aMm94i6NmAJstsm5cu3yJwYqYc93gpCPm21FeAbFk6g==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-select@2.1.4':
    resolution: {integrity: sha512-pOkb2u8KgO47j/h7AylCj7dJsm69BXcjkrvTqMptFqsE2i0p8lHkfgneXKjAgPzBMivnoMyt8o4KiV4wYzDdyQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-separator@1.1.1':
    resolution: {integrity: sha512-RRiNRSrD8iUiXriq/Y5n4/3iE8HzqgLHsusUSg5jVpU2+3tqcUFPJXHDymwEypunc2sWxDUS3UC+rkZRlHedsw==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-slider@1.2.2':
    resolution: {integrity: sha512-sNlU06ii1/ZcbHf8I9En54ZPW0Vil/yPVg4vQMcFNjrIx51jsHbFl1HYHQvCIWJSr1q0ZmA+iIs/ZTv8h7HHSA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-slot@1.1.1':
    resolution: {integrity: sha512-RApLLOcINYJA+dMVbOju7MYv1Mb2EBp2nH4HdDzXTSyaR5optlm6Otrz1euW3HbdOR8UmmFK06TD+A9frYWv+g==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-slot@1.2.3':
    resolution: {integrity: sha512-aeNmHnBxbi2St0au6VBVC7JXFlhLlOnvIIlePNniyUNAClzmtAUEY8/pBiK3iHjufOlwA+c20/8jngo7xcrg8A==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-switch@1.1.2':
    resolution: {integrity: sha512-zGukiWHjEdBCRyXvKR6iXAQG6qXm2esuAD6kDOi9Cn+1X6ev3ASo4+CsYaD6Fov9r/AQFekqnD/7+V0Cs6/98g==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-tabs@1.1.2':
    resolution: {integrity: sha512-9u/tQJMcC2aGq7KXpGivMm1mgq7oRJKXphDwdypPd/j21j/2znamPU8WkXgnhUaTrSFNIt8XhOyCAupg8/GbwQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-toast@1.2.4':
    resolution: {integrity: sha512-Sch9idFJHJTMH9YNpxxESqABcAFweJG4tKv+0zo0m5XBvUSL8FM5xKcJLFLXononpePs8IclyX1KieL5SDUNgA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-toggle-group@1.1.1':
    resolution: {integrity: sha512-OgDLZEA30Ylyz8YSXvnGqIHtERqnUt1KUYTKdw/y8u7Ci6zGiJfXc02jahmcSNK3YcErqioj/9flWC9S1ihfwg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-toggle@1.1.1':
    resolution: {integrity: sha512-i77tcgObYr743IonC1hrsnnPmszDRn8p+EGUsUt+5a/JFn28fxaM88Py6V2mc8J5kELMWishI0rLnuGLFD/nnQ==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-tooltip@1.1.6':
    resolution: {integrity: sha512-TLB5D8QLExS1uDn7+wH/bjEmRurNMTzNrtq7IjaS4kjion9NtzsTGkvR5+i7yc9q01Pi2KMM2cN3f8UG4IvvXA==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/react-use-callback-ref@1.1.0':
    resolution: {integrity: sha512-CasTfvsy+frcFkbXtSJ2Zu9JHpN8TYKxkgJGWbjiZhFivxaeW7rMeZt7QELGVLaYVfFMsKHjb7Ak0nMEe+2Vfw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-controllable-state@1.1.0':
    resolution: {integrity: sha512-MtfMVJiSr2NjzS0Aa90NPTnvTSg6C/JLCV7ma0W6+OMV78vd8OyRpID+Ng9LxzsPbLeuBnWBA1Nq30AtBIDChw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-escape-keydown@1.1.0':
    resolution: {integrity: sha512-L7vwWlR1kTTQ3oh7g1O0CBF3YCyyTj8NmhLR+phShpyA50HCfBFKVJTpshm9PzLiKmehsrQzTYTpX9HvmC9rhw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-layout-effect@1.1.0':
    resolution: {integrity: sha512-+FPE0rOdziWSrH9athwI1R0HDVbWlEhd+FR+aSDk4uWGmSJ9Z54sdZVDQPZAinJhJXwfT+qnj969mCsT2gfm5w==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-layout-effect@1.1.1':
    resolution: {integrity: sha512-RbJRS4UWQFkzHTTwVymMTUv8EqYhOp8dOOviLj2ugtTiXRaRQS7GLGxZTLL1jWhMeoSCf5zmcZkqTl9IiYfXcQ==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-previous@1.1.0':
    resolution: {integrity: sha512-Z/e78qg2YFnnXcW88A4JmTtm4ADckLno6F7OXotmkQfeuCVaKuYzqAATPhVzl3delXE7CxIV8shofPn3jPc5Og==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-rect@1.1.0':
    resolution: {integrity: sha512-0Fmkebhr6PiseyZlYAOtLS+nb7jLmpqTrJyv61Pe68MKYW6OWdRE2kI70TaYY27u7H0lajqM3hSMMLFq18Z7nQ==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-use-size@1.1.0':
    resolution: {integrity: sha512-XW3/vWuIXHa+2Uwcc2ABSfcCledmXhhQPlGbfcRXbiUQI5Icjcg19BGCZVKKInYbvUCut/ufbbLLPFC5cbb1hw==}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  '@radix-ui/react-visually-hidden@1.1.1':
    resolution: {integrity: sha512-vVfA2IZ9q/J+gEamvj761Oq1FpWgCDaNOOIfbPVp2MVPLEomUr5+Vf7kJGwQ24YxZSlQVar7Bes8kyTo5Dshpg==}
    peerDependencies:
      '@types/react': '*'
      '@types/react-dom': '*'
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@radix-ui/rect@1.1.0':
    resolution: {integrity: sha512-A9+lCBZoaMJlVKcRBz2YByCG+Cp2t6nAnMnNba+XiWxnj6r4JUFqfsgwocMBZU9LPtdxC6wB56ySYpc7LQIoJg==}

  '@rolldown/pluginutils@1.0.0-beta.19':
    resolution: {integrity: sha512-3FL3mnMbPu0muGOCaKAhhFEYmqv9eTfPSJRJmANrCwtgK8VuxpsZDGK+m0LYAGoyO8+0j5uRe4PeyPDK1yA/hA==}

  '@rollup/rollup-android-arm-eabi@4.44.1':
    resolution: {integrity: sha512-JAcBr1+fgqx20m7Fwe1DxPUl/hPkee6jA6Pl7n1v2EFiktAHenTaXl5aIFjUIEsfn9w3HE4gK1lEgNGMzBDs1w==}
    cpu: [arm]
    os: [android]

  '@rollup/rollup-android-arm64@4.44.1':
    resolution: {integrity: sha512-RurZetXqTu4p+G0ChbnkwBuAtwAbIwJkycw1n6GvlGlBuS4u5qlr5opix8cBAYFJgaY05TWtM+LaoFggUmbZEQ==}
    cpu: [arm64]
    os: [android]

  '@rollup/rollup-darwin-arm64@4.44.1':
    resolution: {integrity: sha512-fM/xPesi7g2M7chk37LOnmnSTHLG/v2ggWqKj3CCA1rMA4mm5KVBT1fNoswbo1JhPuNNZrVwpTvlCVggv8A2zg==}
    cpu: [arm64]
    os: [darwin]

  '@rollup/rollup-darwin-x64@4.44.1':
    resolution: {integrity: sha512-gDnWk57urJrkrHQ2WVx9TSVTH7lSlU7E3AFqiko+bgjlh78aJ88/3nycMax52VIVjIm3ObXnDL2H00e/xzoipw==}
    cpu: [x64]
    os: [darwin]

  '@rollup/rollup-freebsd-arm64@4.44.1':
    resolution: {integrity: sha512-wnFQmJ/zPThM5zEGcnDcCJeYJgtSLjh1d//WuHzhf6zT3Md1BvvhJnWoy+HECKu2bMxaIcfWiu3bJgx6z4g2XA==}
    cpu: [arm64]
    os: [freebsd]

  '@rollup/rollup-freebsd-x64@4.44.1':
    resolution: {integrity: sha512-uBmIxoJ4493YATvU2c0upGz87f99e3wop7TJgOA/bXMFd2SvKCI7xkxY/5k50bv7J6dw1SXT4MQBQSLn8Bb/Uw==}
    cpu: [x64]
    os: [freebsd]

  '@rollup/rollup-linux-arm-gnueabihf@4.44.1':
    resolution: {integrity: sha512-n0edDmSHlXFhrlmTK7XBuwKlG5MbS7yleS1cQ9nn4kIeW+dJH+ExqNgQ0RrFRew8Y+0V/x6C5IjsHrJmiHtkxQ==}
    cpu: [arm]
    os: [linux]

  '@rollup/rollup-linux-arm-musleabihf@4.44.1':
    resolution: {integrity: sha512-8WVUPy3FtAsKSpyk21kV52HCxB+me6YkbkFHATzC2Yd3yuqHwy2lbFL4alJOLXKljoRw08Zk8/xEj89cLQ/4Nw==}
    cpu: [arm]
    os: [linux]

  '@rollup/rollup-linux-arm64-gnu@4.44.1':
    resolution: {integrity: sha512-yuktAOaeOgorWDeFJggjuCkMGeITfqvPgkIXhDqsfKX8J3jGyxdDZgBV/2kj/2DyPaLiX6bPdjJDTu9RB8lUPQ==}
    cpu: [arm64]
    os: [linux]

  '@rollup/rollup-linux-arm64-musl@4.44.1':
    resolution: {integrity: sha512-W+GBM4ifET1Plw8pdVaecwUgxmiH23CfAUj32u8knq0JPFyK4weRy6H7ooxYFD19YxBulL0Ktsflg5XS7+7u9g==}
    cpu: [arm64]
    os: [linux]

  '@rollup/rollup-linux-loongarch64-gnu@4.44.1':
    resolution: {integrity: sha512-1zqnUEMWp9WrGVuVak6jWTl4fEtrVKfZY7CvcBmUUpxAJ7WcSowPSAWIKa/0o5mBL/Ij50SIf9tuirGx63Ovew==}
    cpu: [loong64]
    os: [linux]

  '@rollup/rollup-linux-powerpc64le-gnu@4.44.1':
    resolution: {integrity: sha512-Rl3JKaRu0LHIx7ExBAAnf0JcOQetQffaw34T8vLlg9b1IhzcBgaIdnvEbbsZq9uZp3uAH+JkHd20Nwn0h9zPjA==}
    cpu: [ppc64]
    os: [linux]

  '@rollup/rollup-linux-riscv64-gnu@4.44.1':
    resolution: {integrity: sha512-j5akelU3snyL6K3N/iX7otLBIl347fGwmd95U5gS/7z6T4ftK288jKq3A5lcFKcx7wwzb5rgNvAg3ZbV4BqUSw==}
    cpu: [riscv64]
    os: [linux]

  '@rollup/rollup-linux-riscv64-musl@4.44.1':
    resolution: {integrity: sha512-ppn5llVGgrZw7yxbIm8TTvtj1EoPgYUAbfw0uDjIOzzoqlZlZrLJ/KuiE7uf5EpTpCTrNt1EdtzF0naMm0wGYg==}
    cpu: [riscv64]
    os: [linux]

  '@rollup/rollup-linux-s390x-gnu@4.44.1':
    resolution: {integrity: sha512-Hu6hEdix0oxtUma99jSP7xbvjkUM/ycke/AQQ4EC5g7jNRLLIwjcNwaUy95ZKBJJwg1ZowsclNnjYqzN4zwkAw==}
    cpu: [s390x]
    os: [linux]

  '@rollup/rollup-linux-x64-gnu@4.44.1':
    resolution: {integrity: sha512-EtnsrmZGomz9WxK1bR5079zee3+7a+AdFlghyd6VbAjgRJDbTANJ9dcPIPAi76uG05micpEL+gPGmAKYTschQw==}
    cpu: [x64]
    os: [linux]

  '@rollup/rollup-linux-x64-musl@4.44.1':
    resolution: {integrity: sha512-iAS4p+J1az6Usn0f8xhgL4PaU878KEtutP4hqw52I4IO6AGoyOkHCxcc4bqufv1tQLdDWFx8lR9YlwxKuv3/3g==}
    cpu: [x64]
    os: [linux]

  '@rollup/rollup-win32-arm64-msvc@4.44.1':
    resolution: {integrity: sha512-NtSJVKcXwcqozOl+FwI41OH3OApDyLk3kqTJgx8+gp6On9ZEt5mYhIsKNPGuaZr3p9T6NWPKGU/03Vw4CNU9qg==}
    cpu: [arm64]
    os: [win32]

  '@rollup/rollup-win32-ia32-msvc@4.44.1':
    resolution: {integrity: sha512-JYA3qvCOLXSsnTR3oiyGws1Dm0YTuxAAeaYGVlGpUsHqloPcFjPg+X0Fj2qODGLNwQOAcCiQmHub/V007kiH5A==}
    cpu: [ia32]
    os: [win32]

  '@rollup/rollup-win32-x64-msvc@4.44.1':
    resolution: {integrity: sha512-J8o22LuF0kTe7m+8PvW9wk3/bRq5+mRo5Dqo6+vXb7otCm3TPhYOJqOaQtGU9YMWQSL3krMnoOxMr0+9E6F3Ug==}
    cpu: [x64]
    os: [win32]

  '@rtsao/scc@1.1.0':
    resolution: {integrity: sha512-zt6OdqaDoOnJ1ZYsCYGt9YmWzDXl4vQdKTyJev62gFhRGKdx7mcT54V9KIjg+d2wi9EXsPvAPKe7i7WjfVWB8g==}

  '@rushstack/eslint-patch@1.12.0':
    resolution: {integrity: sha512-5EwMtOqvJMMa3HbmxLlF74e+3/HhwBTMcvt3nqVJgGCozO6hzIPOBlwm8mGVNR9SN2IJpxSnlxczyDjcn7qIyw==}

  '@swc/counter@0.1.3':
    resolution: {integrity: sha512-e2BR4lsJkkRlKZ/qCHPw9ZaSxc0MVUd7gtbtaB7aMvHeJVYe8sOB8DBZkP2DtISHGSku9sCK6T6cnY0CtXrOCQ==}

  '@swc/helpers@0.5.15':
    resolution: {integrity: sha512-JQ5TuMi45Owi4/BIMAJBoSQoOJu12oOk/gADqlcUL9JEdHB8vyjUSsxqeNXnmXHjYKMi2WcYtezGEEhqUI/E2g==}

  '@testing-library/dom@10.4.0':
    resolution: {integrity: sha512-pemlzrSESWbdAloYml3bAJMEfNh1Z7EduzqPKprCH5S341frlpYnUEW0H72dLxa6IsYr+mPno20GiSm+h9dEdQ==}
    engines: {node: '>=18'}

  '@testing-library/jest-dom@6.6.3':
    resolution: {integrity: sha512-IteBhl4XqYNkM54f4ejhLRJiZNqcSCoXUOG2CPK7qbD322KjQozM4kHQOfkG2oln9b9HTYqs+Sae8vBATubxxA==}
    engines: {node: '>=14', npm: '>=6', yarn: '>=1'}

  '@testing-library/react@16.3.0':
    resolution: {integrity: sha512-kFSyxiEDwv1WLl2fgsq6pPBbw5aWKrsY2/noi1Id0TK0UParSF62oFQFGHXIyaG4pp2tEub/Zlel+fjjZILDsw==}
    engines: {node: '>=18'}
    peerDependencies:
      '@testing-library/dom': ^10.0.0
      '@types/react': ^18.0.0 || ^19.0.0
      '@types/react-dom': ^18.0.0 || ^19.0.0
      react: ^18.0.0 || ^19.0.0
      react-dom: ^18.0.0 || ^19.0.0
    peerDependenciesMeta:
      '@types/react':
        optional: true
      '@types/react-dom':
        optional: true

  '@testing-library/user-event@14.6.1':
    resolution: {integrity: sha512-vq7fv0rnt+QTXgPxr5Hjc210p6YKq2kmdziLgnsZGgLJ9e6VAShx1pACLuRjd/AS/sr7phAR58OIIpf0LlmQNw==}
    engines: {node: '>=12', npm: '>=6'}
    peerDependencies:
      '@testing-library/dom': '>=7.21.4'

  '@tybys/wasm-util@0.9.0':
    resolution: {integrity: sha512-6+7nlbMVX/PVDCwaIQ8nTOPveOcFLSt8GcXdx8hD0bt39uWxYT88uXzqTd4fTvqta7oeUJqudepapKNt2DYJFw==}

  '@types/aria-query@5.0.4':
    resolution: {integrity: sha512-rfT93uj5s0PRL7EzccGMs3brplhcrghnDoV26NqKhCAS1hVo+WdNsPvE/yb6ilfr5hi2MEk6d5EWJTKdxg8jVw==}

  '@types/babel__core@7.20.5':
    resolution: {integrity: sha512-qoQprZvz5wQFJwMDqeseRXWv3rqMvhgpbXFfVyWhbx9X47POIA6i/+dXefEmZKoAgOaTdaIgNSMqMIU61yRyzA==}

  '@types/babel__generator@7.27.0':
    resolution: {integrity: sha512-ufFd2Xi92OAVPYsy+P4n7/U7e68fex0+Ee8gSG9KX7eo084CWiQ4sdxktvdl0bOPupXtVJPY19zk6EwWqUQ8lg==}

  '@types/babel__template@7.4.4':
    resolution: {integrity: sha512-h/NUaSyG5EyxBIp8YRxo4RMe2/qQgvyowRwVMzhYhBCONbW8PUsg4lkFMrhgZhUe5z3L3MiLDuvyJ/CaPa2A8A==}

  '@types/babel__traverse@7.20.7':
    resolution: {integrity: sha512-dkO5fhS7+/oos4ciWxyEyjWe48zmG6wbCheo/G2ZnHx4fs3EU6YC6UM8rk56gAjNJ9P3MTH2jo5jb92/K6wbng==}

  '@types/chai@5.2.2':
    resolution: {integrity: sha512-8kB30R7Hwqf40JPiKhVzodJs2Qc1ZJ5zuT3uzw5Hq/dhNCl3G3l83jfpdI1e20BP348+fV7VIL/+FxaXkqBmWg==}

  '@types/codemirror@5.60.16':
    resolution: {integrity: sha512-V/yHdamffSS075jit+fDxaOAmdP2liok8NSNJnAZfDJErzOheuygHZEhAJrfmk5TEyM32MhkZjwo/idX791yxw==}

  '@types/d3-array@3.2.1':
    resolution: {integrity: sha512-Y2Jn2idRrLzUfAKV2LyRImR+y4oa2AntrgID95SHJxuMUrkNXmanDSed71sRNZysveJVt1hLLemQZIady0FpEg==}

  '@types/d3-color@3.1.3':
    resolution: {integrity: sha512-iO90scth9WAbmgv7ogoq57O9YpKmFBbmoEoCHDB2xMBY0+/KVrqAaCDyCE16dUspeOvIxFFRI+0sEtqDqy2b4A==}

  '@types/d3-ease@3.0.2':
    resolution: {integrity: sha512-NcV1JjO5oDzoK26oMzbILE6HW7uVXOHLQvHshBUW4UMdZGfiY6v5BeQwh9a9tCzv+CeefZQHJt5SRgK154RtiA==}

  '@types/d3-interpolate@3.0.4':
    resolution: {integrity: sha512-mgLPETlrpVV1YRJIglr4Ez47g7Yxjl1lj7YKsiMCb27VJH9W8NVM6Bb9d8kkpG/uAQS5AmbA48q2IAolKKo1MA==}

  '@types/d3-path@3.1.1':
    resolution: {integrity: sha512-VMZBYyQvbGmWyWVea0EHs/BwLgxc+MKi1zLDCONksozI4YJMcTt8ZEuIR4Sb1MMTE8MMW49v0IwI5+b7RmfWlg==}

  '@types/d3-scale@4.0.9':
    resolution: {integrity: sha512-dLmtwB8zkAeO/juAMfnV+sItKjlsw2lKdZVVy6LRr0cBmegxSABiLEpGVmSJJ8O08i4+sGR6qQtb6WtuwJdvVw==}

  '@types/d3-shape@3.1.7':
    resolution: {integrity: sha512-VLvUQ33C+3J+8p+Daf+nYSOsjB4GXp19/S/aGo60m9h1v6XaxjiT82lKVWJCfzhtuZ3yD7i/TPeC/fuKLLOSmg==}

  '@types/d3-time@3.0.4':
    resolution: {integrity: sha512-yuzZug1nkAAaBlBBikKZTgzCeA+k1uy4ZFwWANOfKw5z5LRhV0gNA7gNkKm7HoK+HRN0wX3EkxGk0fpbWhmB7g==}

  '@types/d3-timer@3.0.2':
    resolution: {integrity: sha512-Ps3T8E8dZDam6fUyNiMkekK3XUsaUEik+idO9/YjPtfj2qruF8tFBXS7XhtE4iIXBLxhmLjP3SXpLhVf21I9Lw==}

  '@types/deep-eql@4.0.2':
    resolution: {integrity: sha512-c9h9dVVMigMPc4bwTvC5dxqtqJZwQPePsWjPlpSOnojbor6pGqdk541lfA7AqFQr5pB1BRdq0juY9db81BwyFw==}

  '@types/estree@1.0.8':
    resolution: {integrity: sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==}

  '@types/json-schema@7.0.15':
    resolution: {integrity: sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==}

  '@types/json5@0.0.29':
    resolution: {integrity: sha512-dRLjCWHYg4oaA77cxO64oO+7JwCwnIzkZPdrrC71jQmQtlhM556pwKo5bUzqvZndkVbeFLIIi+9TC40JNF5hNQ==}

  '@types/marked@4.3.2':
    resolution: {integrity: sha512-a79Yc3TOk6dGdituy8hmTTJXjOkZ7zsFYV10L337ttq/rec8lRMDBpV7fL3uLx6TgbFCa5DU/h8FmIBQPSbU0w==}

  '@types/node@22.16.0':
    resolution: {integrity: sha512-B2egV9wALML1JCpv3VQoQ+yesQKAmNMBIAY7OteVrikcOcAkWm+dGL6qpeCktPjAv6N1JLnhbNiqS35UpFyBsQ==}

  '@types/react-dom@19.1.6':
    resolution: {integrity: sha512-4hOiT/dwO8Ko0gV1m/TJZYk3y0KBnY9vzDh7W+DH17b2HFSOGgdj33dhihPeuy3l0q23+4e+hoXHV6hCC4dCXw==}
    peerDependencies:
      '@types/react': ^19.0.0

  '@types/react@19.1.8':
    resolution: {integrity: sha512-AwAfQ2Wa5bCx9WP8nZL2uMZWod7J7/JSplxbTmBQ5ms6QpqNYm672H0Vu9ZVKVngQ+ii4R/byguVEUZQyeg44g==}

  '@types/tern@0.23.9':
    resolution: {integrity: sha512-ypzHFE/wBzh+BlH6rrBgS5I/Z7RD21pGhZ2rltb/+ZrVM1awdZwjx7hE5XfuYgHWk9uvV5HLZN3SloevCAp3Bw==}

  '@typescript-eslint/eslint-plugin@8.35.1':
    resolution: {integrity: sha512-9XNTlo7P7RJxbVeICaIIIEipqxLKguyh+3UbXuT2XQuFp6d8VOeDEGuz5IiX0dgZo8CiI6aOFLg4e8cF71SFVg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      '@typescript-eslint/parser': ^8.35.1
      eslint: ^8.57.0 || ^9.0.0
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/parser@8.35.1':
    resolution: {integrity: sha512-3MyiDfrfLeK06bi/g9DqJxP5pV74LNv4rFTyvGDmT3x2p1yp1lOd+qYZfiRPIOf/oON+WRZR5wxxuF85qOar+w==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      eslint: ^8.57.0 || ^9.0.0
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/project-service@8.35.1':
    resolution: {integrity: sha512-VYxn/5LOpVxADAuP3NrnxxHYfzVtQzLKeldIhDhzC8UHaiQvYlXvKuVho1qLduFbJjjy5U5bkGwa3rUGUb1Q6Q==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/scope-manager@8.35.1':
    resolution: {integrity: sha512-s/Bpd4i7ht2934nG+UoSPlYXd08KYz3bmjLEb7Ye1UVob0d1ENiT3lY8bsCmik4RqfSbPw9xJJHbugpPpP5JUg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@typescript-eslint/tsconfig-utils@8.35.1':
    resolution: {integrity: sha512-K5/U9VmT9dTHoNowWZpz+/TObS3xqC5h0xAIjXPw+MNcKV9qg6eSatEnmeAwkjHijhACH0/N7bkhKvbt1+DXWQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/type-utils@8.35.1':
    resolution: {integrity: sha512-HOrUBlfVRz5W2LIKpXzZoy6VTZzMu2n8q9C2V/cFngIC5U1nStJgv0tMV4sZPzdf4wQm9/ToWUFPMN9Vq9VJQQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      eslint: ^8.57.0 || ^9.0.0
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/types@8.35.1':
    resolution: {integrity: sha512-q/O04vVnKHfrrhNAscndAn1tuQhIkwqnaW+eu5waD5IPts2eX1dgJxgqcPx5BX109/qAz7IG6VrEPTOYKCNfRQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@typescript-eslint/typescript-estree@8.35.1':
    resolution: {integrity: sha512-Vvpuvj4tBxIka7cPs6Y1uvM7gJgdF5Uu9F+mBJBPY4MhvjrjWGK4H0lVgLJd/8PWZ23FTqsaJaLEkBCFUk8Y9g==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/utils@8.35.1':
    resolution: {integrity: sha512-lhnwatFmOFcazAsUm3ZnZFpXSxiwoa1Lj50HphnDe1Et01NF4+hrdXONSUHIcbVu2eFb1bAf+5yjXkGVkXBKAQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    peerDependencies:
      eslint: ^8.57.0 || ^9.0.0
      typescript: '>=4.8.4 <5.9.0'

  '@typescript-eslint/visitor-keys@8.35.1':
    resolution: {integrity: sha512-VRwixir4zBWCSTP/ljEo091lbpypz57PoeAQ9imjG+vbeof9LplljsL1mos4ccG6H9IjfrVGM359RozUnuFhpw==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  '@unrs/resolver-binding-android-arm-eabi@1.10.1':
    resolution: {integrity: sha512-zohDKXT1Ok0yhbVGff4YAg9HUs5ietG5GpvJBPFSApZnGe7uf2cd26DRhKZbn0Be6xHUZrSzP+RAgMmzyc71EA==}
    cpu: [arm]
    os: [android]

  '@unrs/resolver-binding-android-arm64@1.10.1':
    resolution: {integrity: sha512-tAN6k5UrTd4nicpA7s2PbjR/jagpDzAmvXFjbpTazUe5FRsFxVcBlS1F5Lzp5jtWU6bdiqRhSvd4X8rdpCffeA==}
    cpu: [arm64]
    os: [android]

  '@unrs/resolver-binding-darwin-arm64@1.10.1':
    resolution: {integrity: sha512-+FCsag8WkauI4dQ50XumCXdfvDCZEpMUnvZDsKMxfOisnEklpDFXc6ThY0WqybBYZbiwR5tWcFaZmI0G6b4vrg==}
    cpu: [arm64]
    os: [darwin]

  '@unrs/resolver-binding-darwin-x64@1.10.1':
    resolution: {integrity: sha512-qYKGGm5wk71ONcXTMZ0+J11qQeOAPz3nw6VtqrBUUELRyXFyvK8cHhHsLBFR4GHnilc2pgY1HTB2TvdW9wO26Q==}
    cpu: [x64]
    os: [darwin]

  '@unrs/resolver-binding-freebsd-x64@1.10.1':
    resolution: {integrity: sha512-hOHMAhbvIQ63gkpgeNsXcWPSyvXH7ZEyeg254hY0Lp/hX8NdW+FsUWq73g9946Pc/BrcVI/I3C1cmZ4RCX9bNw==}
    cpu: [x64]
    os: [freebsd]

  '@unrs/resolver-binding-linux-arm-gnueabihf@1.10.1':
    resolution: {integrity: sha512-6ds7+zzHJgTDmpe0gmFcOTvSUhG5oZukkt+cCsSb3k4Uiz2yEQB4iCRITX2hBwSW+p8gAieAfecITjgqCkswXw==}
    cpu: [arm]
    os: [linux]

  '@unrs/resolver-binding-linux-arm-musleabihf@1.10.1':
    resolution: {integrity: sha512-P7A0G2/jW00diNJyFeq4W9/nxovD62Ay8CMP4UK9OymC7qO7rG1a8Upad68/bdfpIOn7KSp7Aj/6lEW3yyznAA==}
    cpu: [arm]
    os: [linux]

  '@unrs/resolver-binding-linux-arm64-gnu@1.10.1':
    resolution: {integrity: sha512-Cg6xzdkrpltcTPO4At+A79zkC7gPDQIgosJmVV8M104ImB6KZi1MrNXgDYIAfkhUYjPzjNooEDFRAwwPadS7ZA==}
    cpu: [arm64]
    os: [linux]

  '@unrs/resolver-binding-linux-arm64-musl@1.10.1':
    resolution: {integrity: sha512-aNeg99bVkXa4lt+oZbjNRPC8ZpjJTKxijg/wILrJdzNyAymO2UC/HUK1UfDjt6T7U5p/mK24T3CYOi3/+YEQSA==}
    cpu: [arm64]
    os: [linux]

  '@unrs/resolver-binding-linux-ppc64-gnu@1.10.1':
    resolution: {integrity: sha512-ylz5ojeXrkPrtnzVhpCO+YegG63/aKhkoTlY8PfMfBfLaUG8v6m6iqrL7sBUKdVBgOB4kSTUPt9efQdA/Y3Z/w==}
    cpu: [ppc64]
    os: [linux]

  '@unrs/resolver-binding-linux-riscv64-gnu@1.10.1':
    resolution: {integrity: sha512-xcWyhmJfXXOxK7lvE4+rLwBq+on83svlc0AIypfe6x4sMJR+S4oD7n9OynaQShfj2SufPw2KJAotnsNb+4nN2g==}
    cpu: [riscv64]
    os: [linux]

  '@unrs/resolver-binding-linux-riscv64-musl@1.10.1':
    resolution: {integrity: sha512-mW9JZAdOCyorgi1eLJr4gX7xS67WNG9XNPYj5P8VuttK72XNsmdw9yhOO4tDANMgiLXFiSFaiL1gEpoNtRPw/A==}
    cpu: [riscv64]
    os: [linux]

  '@unrs/resolver-binding-linux-s390x-gnu@1.10.1':
    resolution: {integrity: sha512-NZGKhBy6xkJ0k09cWNZz4DnhBcGlhDd3W+j7EYoNvf5TSwj2K6kbmfqTWITEgkvjsMUjm1wsrc4IJaH6VtjyHQ==}
    cpu: [s390x]
    os: [linux]

  '@unrs/resolver-binding-linux-x64-gnu@1.10.1':
    resolution: {integrity: sha512-VsjgckJ0gNMw7p0d8In6uPYr+s0p16yrT2rvG4v2jUpEMYkpnfnCiALa9SWshbvlGjKQ98Q2x19agm3iFk8w8Q==}
    cpu: [x64]
    os: [linux]

  '@unrs/resolver-binding-linux-x64-musl@1.10.1':
    resolution: {integrity: sha512-idMnajMeejnaFi0Mx9UTLSYFDAOTfAEP7VjXNgxKApso3Eu2Njs0p2V95nNIyFi4oQVGFmIuCkoznAXtF/Zbmw==}
    cpu: [x64]
    os: [linux]

  '@unrs/resolver-binding-wasm32-wasi@1.10.1':
    resolution: {integrity: sha512-7jyhjIRNFjzlr8x5pth6Oi9hv3a7ubcVYm2GBFinkBQKcFhw4nIs5BtauSNtDW1dPIGrxF0ciynCZqzxMrYMsg==}
    engines: {node: '>=14.0.0'}
    cpu: [wasm32]

  '@unrs/resolver-binding-win32-arm64-msvc@1.10.1':
    resolution: {integrity: sha512-TY79+N+Gkoo7E99K+zmsKNeiuNJYlclZJtKqsHSls8We2iGhgxtletVsiBYie93MSTDRDMI8pkBZJlIJSZPrdA==}
    cpu: [arm64]
    os: [win32]

  '@unrs/resolver-binding-win32-ia32-msvc@1.10.1':
    resolution: {integrity: sha512-BAJN5PEPlEV+1m8+PCtFoKm3LQ1P57B4Z+0+efU0NzmCaGk7pUaOxuPgl+m3eufVeeNBKiPDltG0sSB9qEfCxw==}
    cpu: [ia32]
    os: [win32]

  '@unrs/resolver-binding-win32-x64-msvc@1.10.1':
    resolution: {integrity: sha512-2v3erKKmmCyIVvvhI2nF15qEbdBpISTq44m9pyd5gfIJB1PN94oePTLWEd82XUbIbvKhv76xTSeUQSCOGesLeg==}
    cpu: [x64]
    os: [win32]

  '@vitejs/plugin-react@4.6.0':
    resolution: {integrity: sha512-5Kgff+m8e2PB+9j51eGHEpn5kUzRKH2Ry0qGoe8ItJg7pqnkPrYPkDQZGgGmTa0EGarHrkjLvOdU3b1fzI8otQ==}
    engines: {node: ^14.18.0 || >=16.0.0}
    peerDependencies:
      vite: ^4.2.0 || ^5.0.0 || ^6.0.0 || ^7.0.0-beta.0

  '@vitest/expect@3.2.4':
    resolution: {integrity: sha512-Io0yyORnB6sikFlt8QW5K7slY4OjqNX9jmJQ02QDda8lyM6B5oNgVWoSoKPac8/kgnCUzuHQKrSLtu/uOqqrig==}

  '@vitest/mocker@3.2.4':
    resolution: {integrity: sha512-46ryTE9RZO/rfDd7pEqFl7etuyzekzEhUbTW3BvmeO/BcCMEgq59BKhek3dXDWgAj4oMK6OZi+vRr1wPW6qjEQ==}
    peerDependencies:
      msw: ^2.4.9
      vite: ^5.0.0 || ^6.0.0 || ^7.0.0-0
    peerDependenciesMeta:
      msw:
        optional: true
      vite:
        optional: true

  '@vitest/pretty-format@3.2.4':
    resolution: {integrity: sha512-IVNZik8IVRJRTr9fxlitMKeJeXFFFN0JaB9PHPGQ8NKQbGpfjlTx9zO4RefN8gp7eqjNy8nyK3NZmBzOPeIxtA==}

  '@vitest/runner@3.2.4':
    resolution: {integrity: sha512-oukfKT9Mk41LreEW09vt45f8wx7DordoWUZMYdY/cyAk7w5TWkTRCNZYF7sX7n2wB7jyGAl74OxgwhPgKaqDMQ==}

  '@vitest/snapshot@3.2.4':
    resolution: {integrity: sha512-dEYtS7qQP2CjU27QBC5oUOxLE/v5eLkGqPE0ZKEIDGMs4vKWe7IjgLOeauHsR0D5YuuycGRO5oSRXnwnmA78fQ==}

  '@vitest/spy@3.2.4':
    resolution: {integrity: sha512-vAfasCOe6AIK70iP5UD11Ac4siNUNJ9i/9PZ3NKx07sG6sUxeag1LWdNrMWeKKYBLlzuK+Gn65Yd5nyL6ds+nw==}

  '@vitest/ui@3.2.4':
    resolution: {integrity: sha512-hGISOaP18plkzbWEcP/QvtRW1xDXF2+96HbEX6byqQhAUbiS5oH6/9JwW+QsQCIYON2bI6QZBF+2PvOmrRZ9wA==}
    peerDependencies:
      vitest: 3.2.4

  '@vitest/utils@3.2.4':
    resolution: {integrity: sha512-fB2V0JFrQSMsCo9HiSq3Ezpdv4iYaXRG1Sx8edX3MwxfyNn83mKiGzOcH+Fkxt4MHxr3y42fQi1oeAInqgX2QA==}

  acorn-jsx@5.3.2:
    resolution: {integrity: sha512-rq9s+JNhf0IChjtDXxllJ7g41oZk5SlXtp0LHwyA5cejwn7vKmKp4pPri6YEePv2PU65sAsegbXtIinmDFDXgQ==}
    peerDependencies:
      acorn: ^6.0.0 || ^7.0.0 || ^8.0.0

  acorn@8.15.0:
    resolution: {integrity: sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==}
    engines: {node: '>=0.4.0'}
    hasBin: true

  agent-base@7.1.3:
    resolution: {integrity: sha512-jRR5wdylq8CkOe6hei19GGZnxM6rBGwFl3Bg0YItGDimvjGtAvdZk4Pu6Cl4u4Igsws4a1fd1Vq3ezrhn4KmFw==}
    engines: {node: '>= 14'}

  ajv@6.12.6:
    resolution: {integrity: sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==}

  ansi-regex@5.0.1:
    resolution: {integrity: sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==}
    engines: {node: '>=8'}

  ansi-regex@6.1.0:
    resolution: {integrity: sha512-7HSX4QQb4CspciLpVFwyRe79O3xsIZDDLER21kERQ71oaPodF8jL725AgJMFAYbooIqolJoRLuM81SpeUkpkvA==}
    engines: {node: '>=12'}

  ansi-styles@4.3.0:
    resolution: {integrity: sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==}
    engines: {node: '>=8'}

  ansi-styles@5.2.0:
    resolution: {integrity: sha512-Cxwpt2SfTzTtXcfOlzGEee8O+c+MmUgGrNiBcXnuWxuFJHe6a5Hz7qwhwe5OgaSYI0IJvkLqWX1ASG+cJOkEiA==}
    engines: {node: '>=10'}

  ansi-styles@6.2.1:
    resolution: {integrity: sha512-bN798gFfQX+viw3R7yrGWRqnrN2oRkEkUjjl4JNn4E8GxxbjtG3FbrEIIY3l8/hrwUwIeCZvi4QuOTP4MErVug==}
    engines: {node: '>=12'}

  any-promise@1.3.0:
    resolution: {integrity: sha512-7UvmKalWRt1wgjL1RrGxoSJW/0QZFIegpeGvZG9kjp8vrRu55XTHbwnqq2GpXm9uLbcuhxm3IqX9OB4MZR1b2A==}

  anymatch@3.1.3:
    resolution: {integrity: sha512-KMReFUr0B4t+D+OBkjR3KYqvocp2XaSzO55UcB6mgQMd3KbcE+mWTyvVV7D/zsdEbNnV6acZUutkiHQXvTr1Rw==}
    engines: {node: '>= 8'}

  arg@5.0.2:
    resolution: {integrity: sha512-PYjyFOLKQ9y57JvQ6QLo8dAgNqswh8M1RMJYdQduT6xbWSgK36P/Z/v+p888pM69jMMfS8Xd8F6I1kQ/I9HUGg==}

  argparse@2.0.1:
    resolution: {integrity: sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==}

  aria-hidden@1.2.6:
    resolution: {integrity: sha512-ik3ZgC9dY/lYVVM++OISsaYDeg1tb0VtP5uL3ouh1koGOaUMDPpbFIei4JkFimWUFPn90sbMNMXQAIVOlnYKJA==}
    engines: {node: '>=10'}

  aria-query@5.3.0:
    resolution: {integrity: sha512-b0P0sZPKtyu8HkeRAfCq0IfURZK+SuwMjY1UXGBU27wpAiTwQAIlq56IbIO+ytk/JjS1fMR14ee5WBBfKi5J6A==}

  aria-query@5.3.2:
    resolution: {integrity: sha512-COROpnaoap1E2F000S62r6A60uHZnmlvomhfyT2DlTcrY1OrBKn2UhH7qn5wTC9zMvD0AY7csdPSNwKP+7WiQw==}
    engines: {node: '>= 0.4'}

  array-buffer-byte-length@1.0.2:
    resolution: {integrity: sha512-LHE+8BuR7RYGDKvnrmcuSq3tDcKv9OFEXQt/HpbZhY7V6h0zlUXutnAD82GiFx9rdieCMjkvtcsPqBwgUl1Iiw==}
    engines: {node: '>= 0.4'}

  array-includes@3.1.9:
    resolution: {integrity: sha512-FmeCCAenzH0KH381SPT5FZmiA/TmpndpcaShhfgEN9eCVjnFBqq3l1xrI42y8+PPLI6hypzou4GXw00WHmPBLQ==}
    engines: {node: '>= 0.4'}

  array.prototype.findlast@1.2.5:
    resolution: {integrity: sha512-CVvd6FHg1Z3POpBLxO6E6zr+rSKEQ9L6rZHAaY7lLfhKsWYUBBOuMs0e9o24oopj6H+geRCX0YJ+TJLBK2eHyQ==}
    engines: {node: '>= 0.4'}

  array.prototype.findlastindex@1.2.6:
    resolution: {integrity: sha512-F/TKATkzseUExPlfvmwQKGITM3DGTK+vkAsCZoDc5daVygbJBnjEUCbgkAvVFsgfXfX4YIqZ/27G3k3tdXrTxQ==}
    engines: {node: '>= 0.4'}

  array.prototype.flat@1.3.3:
    resolution: {integrity: sha512-rwG/ja1neyLqCuGZ5YYrznA62D4mZXg0i1cIskIUKSiqF3Cje9/wXAls9B9s1Wa2fomMsIv8czB8jZcPmxCXFg==}
    engines: {node: '>= 0.4'}

  array.prototype.flatmap@1.3.3:
    resolution: {integrity: sha512-Y7Wt51eKJSyi80hFrJCePGGNo5ktJCslFuboqJsbf57CCPcm5zztluPlc4/aD8sWsKvlwatezpV4U1efk8kpjg==}
    engines: {node: '>= 0.4'}

  array.prototype.tosorted@1.1.4:
    resolution: {integrity: sha512-p6Fx8B7b7ZhL/gmUsAy0D15WhvDccw3mnGNbZpi3pmeJdxtWsj2jEaI4Y6oo3XiHfzuSgPwKc04MYt6KgvC/wA==}
    engines: {node: '>= 0.4'}

  arraybuffer.prototype.slice@1.0.4:
    resolution: {integrity: sha512-BNoCY6SXXPQ7gF2opIP4GBE+Xw7U+pHMYKuzjgCN3GwiaIR09UUeKfheyIry77QtrCBlC0KK0q5/TER/tYh3PQ==}
    engines: {node: '>= 0.4'}

  assertion-error@2.0.1:
    resolution: {integrity: sha512-Izi8RQcffqCeNVgFigKli1ssklIbpHnCYc6AknXGYoB6grJqyeby7jv12JUQgmTAnIDnbck1uxksT4dzN3PWBA==}
    engines: {node: '>=12'}

  ast-types-flow@0.0.8:
    resolution: {integrity: sha512-OH/2E5Fg20h2aPrbe+QL8JZQFko0YZaF+j4mnQ7BGhfavO7OpSLa8a0y9sBwomHdSbkhTS8TQNayBfnW5DwbvQ==}

  async-function@1.0.0:
    resolution: {integrity: sha512-hsU18Ae8CDTR6Kgu9DYf0EbCr/a5iGL0rytQDobUcdpYOKokk8LEjVphnXkDkgpi0wYVsqrXuP0bZxJaTqdgoA==}
    engines: {node: '>= 0.4'}

  asynckit@0.4.0:
    resolution: {integrity: sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==}

  autoprefixer@10.4.21:
    resolution: {integrity: sha512-O+A6LWV5LDHSJD3LjHYoNi4VLsj/Whi7k6zG12xTYaU4cQ8oxQGckXNX8cRHK5yOZ/ppVHe0ZBXGzSV9jXdVbQ==}
    engines: {node: ^10 || ^12 || >=14}
    hasBin: true
    peerDependencies:
      postcss: ^8.1.0

  available-typed-arrays@1.0.7:
    resolution: {integrity: sha512-wvUjBtSGN7+7SjNpq/9M2Tg350UZD3q62IFZLbRAR1bSMlCo1ZaeW+BJ+D090e4hIIZLBcTDWe4Mh4jvUDajzQ==}
    engines: {node: '>= 0.4'}

  axe-core@4.10.3:
    resolution: {integrity: sha512-Xm7bpRXnDSX2YE2YFfBk2FnF0ep6tmG7xPh8iHee8MIcrgq762Nkce856dYtJYLkuIoYZvGfTs/PbZhideTcEg==}
    engines: {node: '>=4'}

  axios@1.10.0:
    resolution: {integrity: sha512-/1xYAC4MP/HEG+3duIhFr4ZQXR4sQXOIe+o6sdqzeykGLx6Upp/1p8MHqhINOvGeP7xyNHe7tsiJByc4SSVUxw==}

  axobject-query@4.1.0:
    resolution: {integrity: sha512-qIj0G9wZbMGNLjLmg1PT6v2mE9AH2zlnADJD/2tC6E00hgmhUOfEB6greHPAfLRSufHqROIUTkw6E+M3lH0PTQ==}
    engines: {node: '>= 0.4'}

  balanced-match@1.0.2:
    resolution: {integrity: sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==}

  binary-extensions@2.3.0:
    resolution: {integrity: sha512-Ceh+7ox5qe7LJuLHoY0feh3pHuUDHAcRUeyL2VYghZwfpkNIy/+8Ocg0a3UuSoYzavmylwuLWQOf3hl0jjMMIw==}
    engines: {node: '>=8'}

  brace-expansion@1.1.12:
    resolution: {integrity: sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==}

  brace-expansion@2.0.2:
    resolution: {integrity: sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==}

  braces@3.0.3:
    resolution: {integrity: sha512-yQbXgO/OSZVD2IsiLlro+7Hf6Q18EJrKSEsdoMzKePKXct3gvD8oLcOQdIzGupr5Fj+EDe8gO/lxc1BzfMpxvA==}
    engines: {node: '>=8'}

  browserslist@4.25.1:
    resolution: {integrity: sha512-KGj0KoOMXLpSNkkEI6Z6mShmQy0bc1I+T7K9N81k4WWMrfz+6fQ6es80B/YLAeRoKvjYE1YSHHOW1qe9xIVzHw==}
    engines: {node: ^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || >=13.7}
    hasBin: true

  busboy@1.6.0:
    resolution: {integrity: sha512-8SFQbg/0hQ9xy3UNTB0YEnsNBbWfhf7RtnzpL7TkBiTBRfrQ9Fxcnz7VJsleJpyp6rVLvXiuORqjlHi5q+PYuA==}
    engines: {node: '>=10.16.0'}

  cac@6.7.14:
    resolution: {integrity: sha512-b6Ilus+c3RrdDk+JhLKUAQfzzgLEPy6wcXqS7f/xe1EETvsDP6GORG7SFuOs6cID5YkqchW/LXZbX5bc8j7ZcQ==}
    engines: {node: '>=8'}

  call-bind-apply-helpers@1.0.2:
    resolution: {integrity: sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==}
    engines: {node: '>= 0.4'}

  call-bind@1.0.8:
    resolution: {integrity: sha512-oKlSFMcMwpUg2ednkhQ454wfWiU/ul3CkJe/PEHcTKuiX6RpbehUiFMXu13HalGZxfUwCQzZG747YXBn1im9ww==}
    engines: {node: '>= 0.4'}

  call-bound@1.0.4:
    resolution: {integrity: sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==}
    engines: {node: '>= 0.4'}

  callsites@3.1.0:
    resolution: {integrity: sha512-P8BjAsXvZS+VIDUI11hHCQEv74YT67YUi5JJFNWIqL235sBmjX4+qx9Muvls5ivyNENctx46xQLQ3aTuE7ssaQ==}
    engines: {node: '>=6'}

  camelcase-css@2.0.1:
    resolution: {integrity: sha512-QOSvevhslijgYwRx6Rv7zKdMF8lbRmx+uQGx2+vDc+KI/eBnsy9kit5aj23AgGu3pa4t9AgwbnXWqS+iOY+2aA==}
    engines: {node: '>= 6'}

  caniuse-lite@1.0.30001726:
    resolution: {integrity: sha512-VQAUIUzBiZ/UnlM28fSp2CRF3ivUn1BWEvxMcVTNwpw91Py1pGbPIyIKtd+tzct9C3ouceCVdGAXxZOpZAsgdw==}

  chai@5.2.0:
    resolution: {integrity: sha512-mCuXncKXk5iCLhfhwTc0izo0gtEmpz5CtG2y8GiOINBlMVS6v8TMRc5TaLWKS6692m9+dVVfzgeVxR5UxWHTYw==}
    engines: {node: '>=12'}

  chalk@3.0.0:
    resolution: {integrity: sha512-4D3B6Wf41KOYRFdszmDqMCGq5VV/uMAB273JILmO+3jAlh8X4qDtdtgCR3fxtbLEMzSx22QdhnDcJvu2u1fVwg==}
    engines: {node: '>=8'}

  chalk@4.1.2:
    resolution: {integrity: sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==}
    engines: {node: '>=10'}

  check-error@2.1.1:
    resolution: {integrity: sha512-OAlb+T7V4Op9OwdkjmguYRqncdlx5JiofwOAUkmTF+jNdHwzTaTs4sRAGpzLF3oOz5xAyDGrPgeIDFQmDOTiJw==}
    engines: {node: '>= 16'}

  chokidar@3.6.0:
    resolution: {integrity: sha512-7VT13fmjotKpGipCW9JEQAusEPE+Ei8nl6/g4FBAmIm0GOOLMua9NDDo/DWp0ZAxCr3cPq5ZpBqmPAQgDda2Pw==}
    engines: {node: '>= 8.10.0'}

  class-variance-authority@0.7.1:
    resolution: {integrity: sha512-Ka+9Trutv7G8M6WT6SeiRWz792K5qEqIGEGzXKhAE6xOWAY6pPH8U+9IY3oCMv6kqTmLsv7Xh/2w2RigkePMsg==}

  client-only@0.0.1:
    resolution: {integrity: sha512-IV3Ou0jSMzZrd3pZ48nLkT9DA7Ag1pnPzaiQhpW7c3RbcqqzvzzVu+L8gfqMp/8IM2MQtSiqaCxrrcfu8I8rMA==}

  clsx@2.1.1:
    resolution: {integrity: sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==}
    engines: {node: '>=6'}

  cmdk@1.0.4:
    resolution: {integrity: sha512-AnsjfHyHpQ/EFeAnG216WY7A5LiYCoZzCSygiLvfXC3H3LFGCprErteUcszaVluGOhuOTbJS3jWHrSDYPBBygg==}
    peerDependencies:
      react: ^18 || ^19 || ^19.0.0-rc
      react-dom: ^18 || ^19 || ^19.0.0-rc

  codemirror-spell-checker@1.1.2:
    resolution: {integrity: sha512-2Tl6n0v+GJRsC9K3MLCdLaMOmvWL0uukajNJseorZJsslaxZyZMgENocPU8R0DyoTAiKsyqiemSOZo7kjGV0LQ==}

  codemirror@5.65.19:
    resolution: {integrity: sha512-+aFkvqhaAVr1gferNMuN8vkTSrWIFvzlMV9I2KBLCWS2WpZ2+UAkZjlMZmEuT+gcXTi6RrGQCkWq1/bDtGqhIA==}

  color-convert@2.0.1:
    resolution: {integrity: sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==}
    engines: {node: '>=7.0.0'}

  color-name@1.1.4:
    resolution: {integrity: sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==}

  color-string@1.9.1:
    resolution: {integrity: sha512-shrVawQFojnZv6xM40anx4CkoDP+fZsw/ZerEMsW/pyzsRbElpsL/DBVW7q3ExxwusdNXI3lXpuhEZkzs8p5Eg==}

  color@4.2.3:
    resolution: {integrity: sha512-1rXeuUUiGGrykh+CeBdu5Ie7OJwinCgQY0bc7GCRxy5xVHy+moaqkpL/jqQq0MtQOeYcrqEz4abc5f0KtU7W4A==}
    engines: {node: '>=12.5.0'}

  combined-stream@1.0.8:
    resolution: {integrity: sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==}
    engines: {node: '>= 0.8'}

  commander@4.1.1:
    resolution: {integrity: sha512-NOKm8xhkzAjzFx8B2v5OAHT+u5pRQc2UCa2Vq9jYL/31o2wi9mxBA7LIFs3sV5VSC49z6pEhfbMULvShKj26WA==}
    engines: {node: '>= 6'}

  concat-map@0.0.1:
    resolution: {integrity: sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==}

  convert-source-map@2.0.0:
    resolution: {integrity: sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==}

  cross-spawn@7.0.6:
    resolution: {integrity: sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==}
    engines: {node: '>= 8'}

  css.escape@1.5.1:
    resolution: {integrity: sha512-YUifsXXuknHlUsmlgyY0PKzgPOr7/FjCePfHNt0jxm83wHZi44VDMQ7/fGNkjY3/jV1MC+1CmZbaHzugyeRtpg==}

  cssesc@3.0.0:
    resolution: {integrity: sha512-/Tb/JcjK111nNScGob5MNtsntNM1aCNUDipB/TkwZFhyDrrE47SOx/18wF2bbjgc3ZzCSKW1T5nt5EbFoAz/Vg==}
    engines: {node: '>=4'}
    hasBin: true

  cssstyle@4.6.0:
    resolution: {integrity: sha512-2z+rWdzbbSZv6/rhtvzvqeZQHrBaqgogqt85sqFNbabZOuFbCVFb8kPeEtZjiKkbrm395irpNKiYeFeLiQnFPg==}
    engines: {node: '>=18'}

  csstype@3.1.3:
    resolution: {integrity: sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==}

  d3-array@3.2.4:
    resolution: {integrity: sha512-tdQAmyA18i4J7wprpYq8ClcxZy3SC31QMeByyCFyRt7BVHdREQZ5lpzoe5mFEYZUWe+oq8HBvk9JjpibyEV4Jg==}
    engines: {node: '>=12'}

  d3-color@3.1.0:
    resolution: {integrity: sha512-zg/chbXyeBtMQ1LbD/WSoW2DpC3I0mpmPdW+ynRTj/x2DAWYrIY7qeZIHidozwV24m4iavr15lNwIwLxRmOxhA==}
    engines: {node: '>=12'}

  d3-ease@3.0.1:
    resolution: {integrity: sha512-wR/XK3D3XcLIZwpbvQwQ5fK+8Ykds1ip7A2Txe0yxncXSdq1L9skcG7blcedkOX+ZcgxGAmLX1FrRGbADwzi0w==}
    engines: {node: '>=12'}

  d3-format@3.1.0:
    resolution: {integrity: sha512-YyUI6AEuY/Wpt8KWLgZHsIU86atmikuoOmCfommt0LYHiQSPjvX2AcFc38PX0CBpr2RCyZhjex+NS/LPOv6YqA==}
    engines: {node: '>=12'}

  d3-interpolate@3.0.1:
    resolution: {integrity: sha512-3bYs1rOD33uo8aqJfKP3JWPAibgw8Zm2+L9vBKEHJ2Rg+viTR7o5Mmv5mZcieN+FRYaAOWX5SJATX6k1PWz72g==}
    engines: {node: '>=12'}

  d3-path@3.1.0:
    resolution: {integrity: sha512-p3KP5HCf/bvjBSSKuXid6Zqijx7wIfNW+J/maPs+iwR35at5JCbLUT0LzF1cnjbCHWhqzQTIN2Jpe8pRebIEFQ==}
    engines: {node: '>=12'}

  d3-scale@4.0.2:
    resolution: {integrity: sha512-GZW464g1SH7ag3Y7hXjf8RoUuAFIqklOAq3MRl4OaWabTFJY9PN/E1YklhXLh+OQ3fM9yS2nOkCoS+WLZ6kvxQ==}
    engines: {node: '>=12'}

  d3-shape@3.2.0:
    resolution: {integrity: sha512-SaLBuwGm3MOViRq2ABk3eLoxwZELpH6zhl3FbAoJ7Vm1gofKx6El1Ib5z23NUEhF9AsGl7y+dzLe5Cw2AArGTA==}
    engines: {node: '>=12'}

  d3-time-format@4.1.0:
    resolution: {integrity: sha512-dJxPBlzC7NugB2PDLwo9Q8JiTR3M3e4/XANkreKSUxF8vvXKqm1Yfq4Q5dl8budlunRVlUUaDUgFt7eA8D6NLg==}
    engines: {node: '>=12'}

  d3-time@3.1.0:
    resolution: {integrity: sha512-VqKjzBLejbSMT4IgbmVgDjpkYrNWUYJnbCGo874u7MMKIWsILRX+OpX/gTk8MqjpT1A/c6HY2dCA77ZN0lkQ2Q==}
    engines: {node: '>=12'}

  d3-timer@3.0.1:
    resolution: {integrity: sha512-ndfJ/JxxMd3nw31uyKoY2naivF+r29V+Lc0svZxe1JvvIRmi8hUsrMvdOwgS1o6uBHmiz91geQ0ylPP0aj1VUA==}
    engines: {node: '>=12'}

  damerau-levenshtein@1.0.8:
    resolution: {integrity: sha512-sdQSFB7+llfUcQHUQO3+B8ERRj0Oa4w9POWMI/puGtuf7gFywGmkaLCElnudfTiKZV+NvHqL0ifzdrI8Ro7ESA==}

  data-urls@5.0.0:
    resolution: {integrity: sha512-ZYP5VBHshaDAiVZxjbRVcFJpc+4xGgT0bK3vzy1HLN8jTO975HEbuYzZJcHoQEY5K1a0z8YayJkyVETa08eNTg==}
    engines: {node: '>=18'}

  data-view-buffer@1.0.2:
    resolution: {integrity: sha512-EmKO5V3OLXh1rtK2wgXRansaK1/mtVdTUEiEI0W8RkvgT05kfxaH29PliLnpLP73yYO6142Q72QNa8Wx/A5CqQ==}
    engines: {node: '>= 0.4'}

  data-view-byte-length@1.0.2:
    resolution: {integrity: sha512-tuhGbE6CfTM9+5ANGf+oQb72Ky/0+s3xKUpHvShfiz2RxMFgFPjsXuRLBVMtvMs15awe45SRb83D6wH4ew6wlQ==}
    engines: {node: '>= 0.4'}

  data-view-byte-offset@1.0.1:
    resolution: {integrity: sha512-BS8PfmtDGnrgYdOonGZQdLZslWIeCGFP9tpan0hi1Co2Zr2NKADsvGYA8XxuG/4UWgJ6Cjtv+YJnB6MM69QGlQ==}
    engines: {node: '>= 0.4'}

  date-fns@4.1.0:
    resolution: {integrity: sha512-Ukq0owbQXxa/U3EGtsdVBkR1w7KOQ5gIBqdH2hkvknzZPYvBxb/aa6E8L7tmjFtkwZBu3UXBbjIgPo/Ez4xaNg==}

  debug@3.2.7:
    resolution: {integrity: sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==}
    peerDependencies:
      supports-color: '*'
    peerDependenciesMeta:
      supports-color:
        optional: true

  debug@4.4.1:
    resolution: {integrity: sha512-KcKCqiftBJcZr++7ykoDIEwSa3XWowTfNPo92BYxjXiyYEVrUQh2aLyhxBCwww+heortUFxEJYcRzosstTEBYQ==}
    engines: {node: '>=6.0'}
    peerDependencies:
      supports-color: '*'
    peerDependenciesMeta:
      supports-color:
        optional: true

  decimal.js-light@2.5.1:
    resolution: {integrity: sha512-qIMFpTMZmny+MMIitAB6D7iVPEorVw6YQRWkvarTkT4tBeSLLiHzcwj6q0MmYSFCiVpiqPJTJEYIrpcPzVEIvg==}

  decimal.js@10.5.0:
    resolution: {integrity: sha512-8vDa8Qxvr/+d94hSh5P3IJwI5t8/c0KsMp+g8bNw9cY2icONa5aPfvKeieW1WlG0WQYwwhJ7mjui2xtiePQSXw==}

  deep-eql@5.0.2:
    resolution: {integrity: sha512-h5k/5U50IJJFpzfL6nO9jaaumfjO/f2NjK/oYB2Djzm4p9L+3T9qWpZqZ2hAbLPuuYq9wrU08WQyBTL5GbPk5Q==}
    engines: {node: '>=6'}

  deep-is@0.1.4:
    resolution: {integrity: sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==}

  define-data-property@1.1.4:
    resolution: {integrity: sha512-rBMvIzlpA8v6E+SJZoo++HAYqsLrkg7MSfIinMPFhmkorw7X+dOXVJQs+QT69zGkzMyfDnIMN2Wid1+NbL3T+A==}
    engines: {node: '>= 0.4'}

  define-properties@1.2.1:
    resolution: {integrity: sha512-8QmQKqEASLd5nx0U1B1okLElbUuuttJ/AnYmRXbbbGDWh6uS208EjD4Xqq/I9wK7u0v6O08XhTWnt5XtEbR6Dg==}
    engines: {node: '>= 0.4'}

  delayed-stream@1.0.0:
    resolution: {integrity: sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==}
    engines: {node: '>=0.4.0'}

  dequal@2.0.3:
    resolution: {integrity: sha512-0je+qPKHEMohvfRTCEo3CrPG6cAzAYgmzKyxRiYSSDkS6eGJdyVJm7WaYA5ECaAD9wLB2T4EEeymA5aFVcYXCA==}
    engines: {node: '>=6'}

  detect-libc@2.0.4:
    resolution: {integrity: sha512-3UDv+G9CsCKO1WKMGw9fwq/SWJYbI0c5Y7LU1AXYoDdbhE2AHQ6N6Nb34sG8Fj7T5APy8qXDCKuuIHd1BR0tVA==}
    engines: {node: '>=8'}

  detect-node-es@1.1.0:
    resolution: {integrity: sha512-ypdmJU/TbBby2Dxibuv7ZLW3Bs1QEmM7nHjEANfohJLvE0XVujisn1qPJcZxg+qDucsr+bP6fLD1rPS3AhJ7EQ==}

  didyoumean@1.2.2:
    resolution: {integrity: sha512-gxtyfqMg7GKyhQmb056K7M3xszy/myH8w+B4RT+QXBQsvAOdc3XymqDDPHx1BgPgsdAA5SIifona89YtRATDzw==}

  dlv@1.1.3:
    resolution: {integrity: sha512-+HlytyjlPKnIG8XuRG8WvmBP8xs8P71y+SKKS6ZXWoEgLuePxtDoUEiH7WkdePWrQ5JBpE6aoVqfZfJUQkjXwA==}

  doctrine@2.1.0:
    resolution: {integrity: sha512-35mSku4ZXK0vfCuHEDAwt55dg2jNajHZ1odvF+8SSr82EsZY4QmXfuWso8oEd8zRhVObSN18aM0CjSdoBX7zIw==}
    engines: {node: '>=0.10.0'}

  dom-accessibility-api@0.5.16:
    resolution: {integrity: sha512-X7BJ2yElsnOJ30pZF4uIIDfBEVgF4XEBxL9Bxhy6dnrm5hkzqmsWHGTiHqRiITNhMyFLyAiWndIJP7Z1NTteDg==}

  dom-accessibility-api@0.6.3:
    resolution: {integrity: sha512-7ZgogeTnjuHbo+ct10G9Ffp0mif17idi0IyWNVA/wcwcm7NPOD/WEHVP3n7n3MhXqxoIYm8d6MuZohYWIZ4T3w==}

  dom-helpers@5.2.1:
    resolution: {integrity: sha512-nRCa7CK3VTrM2NmGkIy4cbK7IZlgBE/PYMn55rrXefr5xXDP0LdtfPnblFDoVdcAfslJ7or6iqAUnx0CCGIWQA==}

  dunder-proto@1.0.1:
    resolution: {integrity: sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==}
    engines: {node: '>= 0.4'}

  eastasianwidth@0.2.0:
    resolution: {integrity: sha512-I88TYZWc9XiYHRQ4/3c5rjjfgkjhLyW2luGIheGERbNQ6OY7yTybanSpDXZa8y7VUP9YmDcYa+eyq4ca7iLqWA==}

  easymde@2.20.0:
    resolution: {integrity: sha512-V1Z5f92TfR42Na852OWnIZMbM7zotWQYTddNaLYZFVKj7APBbyZ3FYJ27gBw2grMW3R6Qdv9J8n5Ij7XRSIgXQ==}

  electron-to-chromium@1.5.179:
    resolution: {integrity: sha512-UWKi/EbBopgfFsc5k61wFpV7WrnnSlSzW/e2XcBmS6qKYTivZlLtoll5/rdqRTxGglGHkmkW0j0pFNJG10EUIQ==}

  embla-carousel-react@8.5.1:
    resolution: {integrity: sha512-z9Y0K84BJvhChXgqn2CFYbfEi6AwEr+FFVVKm/MqbTQ2zIzO1VQri6w67LcfpVF0AjbhwVMywDZqY4alYkjW5w==}
    peerDependencies:
      react: ^16.8.0 || ^17.0.1 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc

  embla-carousel-reactive-utils@8.5.1:
    resolution: {integrity: sha512-n7VSoGIiiDIc4MfXF3ZRTO59KDp820QDuyBDGlt5/65+lumPHxX2JLz0EZ23hZ4eg4vZGUXwMkYv02fw2JVo/A==}
    peerDependencies:
      embla-carousel: 8.5.1

  embla-carousel@8.5.1:
    resolution: {integrity: sha512-JUb5+FOHobSiWQ2EJNaueCNT/cQU9L6XWBbWmorWPQT9bkbk+fhsuLr8wWrzXKagO3oWszBO7MSx+GfaRk4E6A==}

  emoji-regex@8.0.0:
    resolution: {integrity: sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==}

  emoji-regex@9.2.2:
    resolution: {integrity: sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==}

  entities@6.0.1:
    resolution: {integrity: sha512-aN97NXWF6AWBTahfVOIrB/NShkzi5H7F9r1s9mD3cDj4Ko5f2qhhVoYMibXF7GlLveb/D2ioWay8lxI97Ven3g==}
    engines: {node: '>=0.12'}

  es-abstract@1.24.0:
    resolution: {integrity: sha512-WSzPgsdLtTcQwm4CROfS5ju2Wa1QQcVeT37jFjYzdFz1r9ahadC8B8/a4qxJxM+09F18iumCdRmlr96ZYkQvEg==}
    engines: {node: '>= 0.4'}

  es-define-property@1.0.1:
    resolution: {integrity: sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==}
    engines: {node: '>= 0.4'}

  es-errors@1.3.0:
    resolution: {integrity: sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==}
    engines: {node: '>= 0.4'}

  es-iterator-helpers@1.2.1:
    resolution: {integrity: sha512-uDn+FE1yrDzyC0pCo961B2IHbdM8y/ACZsKD4dG6WqrjV53BADjwa7D+1aom2rsNVfLyDgU/eigvlJGJ08OQ4w==}
    engines: {node: '>= 0.4'}

  es-module-lexer@1.7.0:
    resolution: {integrity: sha512-jEQoCwk8hyb2AZziIOLhDqpm5+2ww5uIE6lkO/6jcOCusfk6LhMHpXXfBLXTZ7Ydyt0j4VoUQv6uGNYbdW+kBA==}

  es-object-atoms@1.1.1:
    resolution: {integrity: sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==}
    engines: {node: '>= 0.4'}

  es-set-tostringtag@2.1.0:
    resolution: {integrity: sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==}
    engines: {node: '>= 0.4'}

  es-shim-unscopables@1.1.0:
    resolution: {integrity: sha512-d9T8ucsEhh8Bi1woXCf+TIKDIROLG5WCkxg8geBCbvk22kzwC5G2OnXVMO6FUsvQlgUUXQ2itephWDLqDzbeCw==}
    engines: {node: '>= 0.4'}

  es-to-primitive@1.3.0:
    resolution: {integrity: sha512-w+5mJ3GuFL+NjVtJlvydShqE1eN3h3PbI7/5LAsYJP/2qtuMXjfL2LpHSRqo4b4eSF5K/DH1JXKUAHSB2UW50g==}
    engines: {node: '>= 0.4'}

  esbuild@0.25.5:
    resolution: {integrity: sha512-P8OtKZRv/5J5hhz0cUAdu/cLuPIKXpQl1R9pZtvmHWQvrAUVd0UNIPT4IB4W3rNOqVO0rlqHmCIbSwxh/c9yUQ==}
    engines: {node: '>=18'}
    hasBin: true

  escalade@3.2.0:
    resolution: {integrity: sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==}
    engines: {node: '>=6'}

  escape-string-regexp@4.0.0:
    resolution: {integrity: sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==}
    engines: {node: '>=10'}

  eslint-config-next@15.3.4:
    resolution: {integrity: sha512-WqeumCq57QcTP2lYlV6BRUySfGiBYEXlQ1L0mQ+u4N4X4ZhUVSSQ52WtjqHv60pJ6dD7jn+YZc0d1/ZSsxccvg==}
    peerDependencies:
      eslint: ^7.23.0 || ^8.0.0 || ^9.0.0
      typescript: '>=3.3.1'
    peerDependenciesMeta:
      typescript:
        optional: true

  eslint-import-resolver-node@0.3.9:
    resolution: {integrity: sha512-WFj2isz22JahUv+B788TlO3N6zL3nNJGU8CcZbPZvVEkBPaJdCV4vy5wyghty5ROFbCRnm132v8BScu5/1BQ8g==}

  eslint-import-resolver-typescript@3.10.1:
    resolution: {integrity: sha512-A1rHYb06zjMGAxdLSkN2fXPBwuSaQ0iO5M/hdyS0Ajj1VBaRp0sPD3dn1FhME3c/JluGFbwSxyCfqdSbtQLAHQ==}
    engines: {node: ^14.18.0 || >=16.0.0}
    peerDependencies:
      eslint: '*'
      eslint-plugin-import: '*'
      eslint-plugin-import-x: '*'
    peerDependenciesMeta:
      eslint-plugin-import:
        optional: true
      eslint-plugin-import-x:
        optional: true

  eslint-module-utils@2.12.1:
    resolution: {integrity: sha512-L8jSWTze7K2mTg0vos/RuLRS5soomksDPoJLXIslC7c8Wmut3bx7CPpJijDcBZtxQ5lrbUdM+s0OlNbz0DCDNw==}
    engines: {node: '>=4'}
    peerDependencies:
      '@typescript-eslint/parser': '*'
      eslint: '*'
      eslint-import-resolver-node: '*'
      eslint-import-resolver-typescript: '*'
      eslint-import-resolver-webpack: '*'
    peerDependenciesMeta:
      '@typescript-eslint/parser':
        optional: true
      eslint:
        optional: true
      eslint-import-resolver-node:
        optional: true
      eslint-import-resolver-typescript:
        optional: true
      eslint-import-resolver-webpack:
        optional: true

  eslint-plugin-import@2.32.0:
    resolution: {integrity: sha512-whOE1HFo/qJDyX4SnXzP4N6zOWn79WhnCUY/iDR0mPfQZO8wcYE4JClzI2oZrhBnnMUCBCHZhO6VQyoBU95mZA==}
    engines: {node: '>=4'}
    peerDependencies:
      '@typescript-eslint/parser': '*'
      eslint: ^2 || ^3 || ^4 || ^5 || ^6 || ^7.2.0 || ^8 || ^9
    peerDependenciesMeta:
      '@typescript-eslint/parser':
        optional: true

  eslint-plugin-jsx-a11y@6.10.2:
    resolution: {integrity: sha512-scB3nz4WmG75pV8+3eRUQOHZlNSUhFNq37xnpgRkCCELU3XMvXAxLk1eqWWyE22Ki4Q01Fnsw9BA3cJHDPgn2Q==}
    engines: {node: '>=4.0'}
    peerDependencies:
      eslint: ^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9

  eslint-plugin-react-hooks@5.2.0:
    resolution: {integrity: sha512-+f15FfK64YQwZdJNELETdn5ibXEUQmW1DZL6KXhNnc2heoy/sg9VJJeT7n8TlMWouzWqSWavFkIhHyIbIAEapg==}
    engines: {node: '>=10'}
    peerDependencies:
      eslint: ^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0 || ^9.0.0

  eslint-plugin-react@7.37.5:
    resolution: {integrity: sha512-Qteup0SqU15kdocexFNAJMvCJEfa2xUKNV4CC1xsVMrIIqEy3SQ/rqyxCWNzfrd3/ldy6HMlD2e0JDVpDg2qIA==}
    engines: {node: '>=4'}
    peerDependencies:
      eslint: ^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9.7

  eslint-scope@8.4.0:
    resolution: {integrity: sha512-sNXOfKCn74rt8RICKMvJS7XKV/Xk9kA7DyJr8mJik3S7Cwgy3qlkkmyS2uQB3jiJg6VNdZd/pDBJu0nvG2NlTg==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  eslint-visitor-keys@3.4.3:
    resolution: {integrity: sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}

  eslint-visitor-keys@4.2.1:
    resolution: {integrity: sha512-Uhdk5sfqcee/9H/rCOJikYz67o0a2Tw2hGRPOG2Y1R2dg7brRe1uG0yaNQDHu+TO/uQPF/5eCapvYSmHUjt7JQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  eslint@9.30.1:
    resolution: {integrity: sha512-zmxXPNMOXmwm9E0yQLi5uqXHs7uq2UIiqEKo3Gq+3fwo1XrJ+hijAZImyF7hclW3E6oHz43Yk3RP8at6OTKflQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}
    hasBin: true
    peerDependencies:
      jiti: '*'
    peerDependenciesMeta:
      jiti:
        optional: true

  espree@10.4.0:
    resolution: {integrity: sha512-j6PAQ2uUr79PZhBjP5C5fhl8e39FmRnOjsD5lGnWrFU8i2G776tBK7+nP8KuQUTTyAZUwfQqXAgrVH5MbH9CYQ==}
    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}

  esquery@1.6.0:
    resolution: {integrity: sha512-ca9pw9fomFcKPvFLXhBKUK90ZvGibiGOvRJNbjljY7s7uq/5YO4BOzcYtJqExdx99rF6aAcnRxHmcUHcz6sQsg==}
    engines: {node: '>=0.10'}

  esrecurse@4.3.0:
    resolution: {integrity: sha512-KmfKL3b6G+RXvP8N1vr3Tq1kL/oCFgn2NYXEtqP8/L3pKapUA4G8cFVaoF3SU323CD4XypR/ffioHmkti6/Tag==}
    engines: {node: '>=4.0'}

  estraverse@5.3.0:
    resolution: {integrity: sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==}
    engines: {node: '>=4.0'}

  estree-walker@3.0.3:
    resolution: {integrity: sha512-7RUKfXgSMMkzt6ZuXmqapOurLGPPfgj6l9uRZ7lRGolvk0y2yocc35LdcxKC5PQZdn2DMqioAQ2NoWcrTKmm6g==}

  esutils@2.0.3:
    resolution: {integrity: sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==}
    engines: {node: '>=0.10.0'}

  eventemitter3@4.0.7:
    resolution: {integrity: sha512-8guHBZCwKnFhYdHr2ysuRWErTwhoN2X8XELRlrRwpmfeY2jjuUN4taQMsULKUVo1K4DvZl+0pgfyoysHxvmvEw==}

  expect-type@1.2.1:
    resolution: {integrity: sha512-/kP8CAwxzLVEeFrMm4kMmy4CCDlpipyA7MYLVrdJIkV0fYF0UaigQHRsxHiuY/GEea+bh4KSv3TIlgr+2UL6bw==}
    engines: {node: '>=12.0.0'}

  fast-deep-equal@3.1.3:
    resolution: {integrity: sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==}

  fast-equals@5.2.2:
    resolution: {integrity: sha512-V7/RktU11J3I36Nwq2JnZEM7tNm17eBJz+u25qdxBZeCKiX6BkVSZQjwWIr+IobgnZy+ag73tTZgZi7tr0LrBw==}
    engines: {node: '>=6.0.0'}

  fast-glob@3.3.1:
    resolution: {integrity: sha512-kNFPyjhh5cKjrUltxs+wFx+ZkbRaxxmZ+X0ZU31SOsxCEtP9VPgtq2teZw1DebupL5GmDaNQ6yKMMVcM41iqDg==}
    engines: {node: '>=8.6.0'}

  fast-glob@3.3.3:
    resolution: {integrity: sha512-7MptL8U0cqcFdzIzwOTHoilX9x5BrNqye7Z/LuC7kCMRio1EMSyqRK3BEAUD7sXRq4iT4AzTVuZdhgQ2TCvYLg==}
    engines: {node: '>=8.6.0'}

  fast-json-stable-stringify@2.1.0:
    resolution: {integrity: sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==}

  fast-levenshtein@2.0.6:
    resolution: {integrity: sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==}

  fastq@1.19.1:
    resolution: {integrity: sha512-GwLTyxkCXjXbxqIhTsMI2Nui8huMPtnxg7krajPJAjnEG/iiOS7i+zCtWGZR9G0NBKbXKh6X9m9UIsYX/N6vvQ==}

  fdir@6.4.6:
    resolution: {integrity: sha512-hiFoqpyZcfNm1yc4u8oWCf9A2c4D3QjCrks3zmoVKVxpQRzmPNar1hUJcBG2RQHvEVGDN+Jm81ZheVLAQMK6+w==}
    peerDependencies:
      picomatch: ^3 || ^4
    peerDependenciesMeta:
      picomatch:
        optional: true

  fflate@0.8.2:
    resolution: {integrity: sha512-cPJU47OaAoCbg0pBvzsgpTPhmhqI5eJjh/JIu8tPj5q+T7iLvW/JAYUqmE7KOB4R1ZyEhzBaIQpQpardBF5z8A==}

  file-entry-cache@8.0.0:
    resolution: {integrity: sha512-XXTUwCvisa5oacNGRP9SfNtYBNAMi+RPwBFmblZEF7N7swHYQS6/Zfk7SRwx4D5j3CH211YNRco1DEMNVfZCnQ==}
    engines: {node: '>=16.0.0'}

  fill-range@7.1.1:
    resolution: {integrity: sha512-YsGpe3WHLK8ZYi4tWDg2Jy3ebRz2rXowDxnld4bkQB00cc/1Zw9AWnC0i9ztDJitivtQvaI9KaLyKrc+hBW0yg==}
    engines: {node: '>=8'}

  find-up@5.0.0:
    resolution: {integrity: sha512-78/PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==}
    engines: {node: '>=10'}

  flat-cache@4.0.1:
    resolution: {integrity: sha512-f7ccFPK3SXFHpx15UIGyRJ/FJQctuKZ0zVuN3frBo4HnK3cay9VEW0R6yPYFHC0AgqhukPzKjq22t5DmAyqGyw==}
    engines: {node: '>=16'}

  flatted@3.3.3:
    resolution: {integrity: sha512-GX+ysw4PBCz0PzosHDepZGANEuFCMLrnRTiEy9McGjmkCQYwRq4A/X786G/fjM/+OjsWSU1ZrY5qyARZmO/uwg==}

  follow-redirects@1.15.9:
    resolution: {integrity: sha512-gew4GsXizNgdoRyqmyfMHyAmXsZDk6mHkSxZFCzW9gwlbtOW44CDtYavM+y+72qD/Vq2l550kMF52DT8fOLJqQ==}
    engines: {node: '>=4.0'}
    peerDependencies:
      debug: '*'
    peerDependenciesMeta:
      debug:
        optional: true

  for-each@0.3.5:
    resolution: {integrity: sha512-dKx12eRCVIzqCxFGplyFKJMPvLEWgmNtUrpTiJIR5u97zEhRG8ySrtboPHZXx7daLxQVrl643cTzbab2tkQjxg==}
    engines: {node: '>= 0.4'}

  foreground-child@3.3.1:
    resolution: {integrity: sha512-gIXjKqtFuWEgzFRJA9WCQeSJLZDjgJUOMCMzxtvFq/37KojM1BFGufqsCy0r4qSQmYLsZYMeyRqzIWOMup03sw==}
    engines: {node: '>=14'}

  form-data@4.0.3:
    resolution: {integrity: sha512-qsITQPfmvMOSAdeyZ+12I1c+CKSstAFAwu+97zrnWAbIr5u8wfsExUzCesVLC8NgHuRUqNN4Zy6UPWUTRGslcA==}
    engines: {node: '>= 6'}

  fraction.js@4.3.7:
    resolution: {integrity: sha512-ZsDfxO51wGAXREY55a7la9LScWpwv9RxIrYABrlvOFBlH/ShPnrtsXeuUIfXKKOVicNxQ+o8JTbJvjS4M89yew==}

  fsevents@2.3.2:
    resolution: {integrity: sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==}
    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}
    os: [darwin]

  fsevents@2.3.3:
    resolution: {integrity: sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==}
    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}
    os: [darwin]

  function-bind@1.1.2:
    resolution: {integrity: sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==}

  function.prototype.name@1.1.8:
    resolution: {integrity: sha512-e5iwyodOHhbMr/yNrc7fDYG4qlbIvI5gajyzPnb5TCwyhjApznQh1BMFou9b30SevY43gCJKXycoCBjMbsuW0Q==}
    engines: {node: '>= 0.4'}

  functions-have-names@1.2.3:
    resolution: {integrity: sha512-xckBUXyTIqT97tq2x2AMb+g163b5JFysYk0x4qxNFwbfQkmNZoiRHb6sPzI9/QV33WeuvVYBUIiD4NzNIyqaRQ==}

  gensync@1.0.0-beta.2:
    resolution: {integrity: sha512-3hN7NaskYvMDLQY55gnW3NQ+mesEAepTqlg+VEbj7zzqEMBVNhzcGYYeqFo/TlYz6eQiFcp1HcsCZO+nGgS8zg==}
    engines: {node: '>=6.9.0'}

  get-intrinsic@1.3.0:
    resolution: {integrity: sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==}
    engines: {node: '>= 0.4'}

  get-nonce@1.0.1:
    resolution: {integrity: sha512-FJhYRoDaiatfEkUK8HKlicmu/3SGFD51q3itKDGoSTysQJBnfOcxU5GxnhE1E6soB76MbT0MBtnKJuXyAx+96Q==}
    engines: {node: '>=6'}

  get-proto@1.0.1:
    resolution: {integrity: sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==}
    engines: {node: '>= 0.4'}

  get-symbol-description@1.1.0:
    resolution: {integrity: sha512-w9UMqWwJxHNOvoNzSJ2oPF5wvYcvP7jUvYzhp67yEhTi17ZDBBC1z9pTdGuzjD+EFIqLSYRweZjqfiPzQ06Ebg==}
    engines: {node: '>= 0.4'}

  get-tsconfig@4.10.1:
    resolution: {integrity: sha512-auHyJ4AgMz7vgS8Hp3N6HXSmlMdUyhSUrfBF16w153rxtLIEOE+HGqaBppczZvnHLqQJfiHotCYpNhl0lUROFQ==}

  glob-parent@5.1.2:
    resolution: {integrity: sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==}
    engines: {node: '>= 6'}

  glob-parent@6.0.2:
    resolution: {integrity: sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==}
    engines: {node: '>=10.13.0'}

  glob@10.4.5:
    resolution: {integrity: sha512-7Bv8RF0k6xjo7d4A/PxYLbUCfb6c+Vpd2/mB2yRDlew7Jb5hEXiCD9ibfO7wpk8i4sevK6DFny9h7EYbM3/sHg==}
    hasBin: true

  globals@14.0.0:
    resolution: {integrity: sha512-oahGvuMGQlPw/ivIYBjVSrWAfWLBeku5tpPE2fOPLi+WHffIWbuh2tCjhyQhTBPMf5E9jDEH4FOmTYgYwbKwtQ==}
    engines: {node: '>=18'}

  globalthis@1.0.4:
    resolution: {integrity: sha512-DpLKbNU4WylpxJykQujfCcwYWiV/Jhm50Goo0wrVILAv5jOr9d+H+UR3PhSCD2rCCEIg0uc+G+muBTwD54JhDQ==}
    engines: {node: '>= 0.4'}

  gopd@1.2.0:
    resolution: {integrity: sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==}
    engines: {node: '>= 0.4'}

  graphemer@1.4.0:
    resolution: {integrity: sha512-EtKwoO6kxCL9WO5xipiHTZlSzBm7WLT627TqC/uVRd0HKmq8NXyebnNYxDoBi7wt8eTWrUrKXCOVaFq9x1kgag==}

  has-bigints@1.1.0:
    resolution: {integrity: sha512-R3pbpkcIqv2Pm3dUwgjclDRVmWpTJW2DcMzcIhEXEx1oh/CEMObMm3KLmRJOdvhM7o4uQBnwr8pzRK2sJWIqfg==}
    engines: {node: '>= 0.4'}

  has-flag@4.0.0:
    resolution: {integrity: sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==}
    engines: {node: '>=8'}

  has-property-descriptors@1.0.2:
    resolution: {integrity: sha512-55JNKuIW+vq4Ke1BjOTjM2YctQIvCT7GFzHwmfZPGo5wnrgkid0YQtnAleFSqumZm4az3n2BS+erby5ipJdgrg==}

  has-proto@1.2.0:
    resolution: {integrity: sha512-KIL7eQPfHQRC8+XluaIw7BHUwwqL19bQn4hzNgdr+1wXoU0KKj6rufu47lhY7KbJR2C6T6+PfyN0Ea7wkSS+qQ==}
    engines: {node: '>= 0.4'}

  has-symbols@1.1.0:
    resolution: {integrity: sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==}
    engines: {node: '>= 0.4'}

  has-tostringtag@1.0.2:
    resolution: {integrity: sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==}
    engines: {node: '>= 0.4'}

  hasown@2.0.2:
    resolution: {integrity: sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==}
    engines: {node: '>= 0.4'}

  html-encoding-sniffer@4.0.0:
    resolution: {integrity: sha512-Y22oTqIU4uuPgEemfz7NDJz6OeKf12Lsu+QC+s3BVpda64lTiMYCyGwg5ki4vFxkMwQdeZDl2adZoqUgdFuTgQ==}
    engines: {node: '>=18'}

  http-proxy-agent@7.0.2:
    resolution: {integrity: sha512-T1gkAiYYDWYx3V5Bmyu7HcfcvL7mUrTWiM6yOfa3PIphViJ/gFPbvidQ+veqSOHci/PxBcDabeUNCzpOODJZig==}
    engines: {node: '>= 14'}

  https-proxy-agent@7.0.6:
    resolution: {integrity: sha512-vK9P5/iUfdl95AI+JVyUuIcVtd4ofvtrOr3HNtM2yxC9bnMbEdp3x01OhQNnjb8IJYi38VlTE3mBXwcfvywuSw==}
    engines: {node: '>= 14'}

  iconv-lite@0.6.3:
    resolution: {integrity: sha512-4fCk79wshMdzMp2rH06qWrJE4iolqLhCUH+OiuIgU++RB0+94NlDL81atO7GX55uUKueo0txHNtvEyI6D7WdMw==}
    engines: {node: '>=0.10.0'}

  ignore@5.3.2:
    resolution: {integrity: sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==}
    engines: {node: '>= 4'}

  ignore@7.0.5:
    resolution: {integrity: sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==}
    engines: {node: '>= 4'}

  import-fresh@3.3.1:
    resolution: {integrity: sha512-TR3KfrTZTYLPB6jUjfx6MF9WcWrHL9su5TObK4ZkYgBdWKPOFoSoQIdEuTuR82pmtxH2spWG9h6etwfr1pLBqQ==}
    engines: {node: '>=6'}

  imurmurhash@0.1.4:
    resolution: {integrity: sha512-JmXMZ6wuvDmLiHEml9ykzqO6lwFbof0GG4IkcGaENdCRDDmMVnny7s5HsIgHCbaq0w2MyPhDqkhTUgS2LU2PHA==}
    engines: {node: '>=0.8.19'}

  indent-string@4.0.0:
    resolution: {integrity: sha512-EdDDZu4A2OyIK7Lr/2zG+w5jmbuk1DVBnEwREQvBzspBJkCEbRa8GxU1lghYcaGJCnRWibjDXlq779X1/y5xwg==}
    engines: {node: '>=8'}

  input-otp@1.4.1:
    resolution: {integrity: sha512-+yvpmKYKHi9jIGngxagY9oWiiblPB7+nEO75F2l2o4vs+6vpPZZmUl4tBNYuTCvQjhvEIbdNeJu70bhfYP2nbw==}
    peerDependencies:
      react: ^16.8 || ^17.0 || ^18.0 || ^19.0.0 || ^19.0.0-rc
      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0.0 || ^19.0.0-rc

  internal-slot@1.1.0:
    resolution: {integrity: sha512-4gd7VpWNQNB4UKKCFFVcp1AVv+FMOgs9NKzjHKusc8jTMhd5eL1NqQqOpE0KzMds804/yHlglp3uxgluOqAPLw==}
    engines: {node: '>= 0.4'}

  internmap@2.0.3:
    resolution: {integrity: sha512-5Hh7Y1wQbvY5ooGgPbDaL5iYLAPzMTUrjMulskHLH6wnv/A+1q5rgEaiuqEjB+oxGXIVZs1FF+R/KPN3ZSQYYg==}
    engines: {node: '>=12'}

  is-array-buffer@3.0.5:
    resolution: {integrity: sha512-DDfANUiiG2wC1qawP66qlTugJeL5HyzMpfr8lLK+jMQirGzNod0B12cFB/9q838Ru27sBwfw78/rdoU7RERz6A==}
    engines: {node: '>= 0.4'}

  is-arrayish@0.3.2:
    resolution: {integrity: sha512-eVRqCvVlZbuw3GrM63ovNSNAeA1K16kaR/LRY/92w0zxQ5/1YzwblUX652i4Xs9RwAGjW9d9y6X88t8OaAJfWQ==}

  is-async-function@2.1.1:
    resolution: {integrity: sha512-9dgM/cZBnNvjzaMYHVoxxfPj2QXt22Ev7SuuPrs+xav0ukGB0S6d4ydZdEiM48kLx5kDV+QBPrpVnFyefL8kkQ==}
    engines: {node: '>= 0.4'}

  is-bigint@1.1.0:
    resolution: {integrity: sha512-n4ZT37wG78iz03xPRKJrHTdZbe3IicyucEtdRsV5yglwc3GyUfbAfpSeD0FJ41NbUNSt5wbhqfp1fS+BgnvDFQ==}
    engines: {node: '>= 0.4'}

  is-binary-path@2.1.0:
    resolution: {integrity: sha512-ZMERYes6pDydyuGidse7OsHxtbI7WVeUEozgR/g7rd0xUimYNlvZRE/K2MgZTjWy725IfelLeVcEM97mmtRGXw==}
    engines: {node: '>=8'}

  is-boolean-object@1.2.2:
    resolution: {integrity: sha512-wa56o2/ElJMYqjCjGkXri7it5FbebW5usLw/nPmCMs5DeZ7eziSYZhSmPRn0txqeW4LnAmQQU7FgqLpsEFKM4A==}
    engines: {node: '>= 0.4'}

  is-bun-module@2.0.0:
    resolution: {integrity: sha512-gNCGbnnnnFAUGKeZ9PdbyeGYJqewpmc2aKHUEMO5nQPWU9lOmv7jcmQIv+qHD8fXW6W7qfuCwX4rY9LNRjXrkQ==}

  is-callable@1.2.7:
    resolution: {integrity: sha512-1BC0BVFhS/p0qtw6enp8e+8OD0UrK0oFLztSjNzhcKA3WDuJxxAPXzPuPtKkjEY9UUoEWlX/8fgKeu2S8i9JTA==}
    engines: {node: '>= 0.4'}

  is-core-module@2.16.1:
    resolution: {integrity: sha512-UfoeMA6fIJ8wTYFEUjelnaGI67v6+N7qXJEvQuIGa99l4xsCruSYOVSQ0uPANn4dAzm8lkYPaKLrrijLq7x23w==}
    engines: {node: '>= 0.4'}

  is-data-view@1.0.2:
    resolution: {integrity: sha512-RKtWF8pGmS87i2D6gqQu/l7EYRlVdfzemCJN/P3UOs//x1QE7mfhvzHIApBTRf7axvT6DMGwSwBXYCT0nfB9xw==}
    engines: {node: '>= 0.4'}

  is-date-object@1.1.0:
    resolution: {integrity: sha512-PwwhEakHVKTdRNVOw+/Gyh0+MzlCl4R6qKvkhuvLtPMggI1WAHt9sOwZxQLSGpUaDnrdyDsomoRgNnCfKNSXXg==}
    engines: {node: '>= 0.4'}

  is-extglob@2.1.1:
    resolution: {integrity: sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==}
    engines: {node: '>=0.10.0'}

  is-finalizationregistry@1.1.1:
    resolution: {integrity: sha512-1pC6N8qWJbWoPtEjgcL2xyhQOP491EQjeUo3qTKcmV8YSDDJrOepfG8pcC7h/QgnQHYSv0mJ3Z/ZWxmatVrysg==}
    engines: {node: '>= 0.4'}

  is-fullwidth-code-point@3.0.0:
    resolution: {integrity: sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==}
    engines: {node: '>=8'}

  is-generator-function@1.1.0:
    resolution: {integrity: sha512-nPUB5km40q9e8UfN/Zc24eLlzdSf9OfKByBw9CIdw4H1giPMeA0OIJvbchsCu4npfI2QcMVBsGEBHKZ7wLTWmQ==}
    engines: {node: '>= 0.4'}

  is-glob@4.0.3:
    resolution: {integrity: sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==}
    engines: {node: '>=0.10.0'}

  is-map@2.0.3:
    resolution: {integrity: sha512-1Qed0/Hr2m+YqxnM09CjA2d/i6YZNfF6R2oRAOj36eUdS6qIV/huPJNSEpKbupewFs+ZsJlxsjjPbc0/afW6Lw==}
    engines: {node: '>= 0.4'}

  is-negative-zero@2.0.3:
    resolution: {integrity: sha512-5KoIu2Ngpyek75jXodFvnafB6DJgr3u8uuK0LEZJjrU19DrMD3EVERaR8sjz8CCGgpZvxPl9SuE1GMVPFHx1mw==}
    engines: {node: '>= 0.4'}

  is-number-object@1.1.1:
    resolution: {integrity: sha512-lZhclumE1G6VYD8VHe35wFaIif+CTy5SJIi5+3y4psDgWu4wPDoBhF8NxUOinEc7pHgiTsT6MaBb92rKhhD+Xw==}
    engines: {node: '>= 0.4'}

  is-number@7.0.0:
    resolution: {integrity: sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==}
    engines: {node: '>=0.12.0'}

  is-potential-custom-element-name@1.0.1:
    resolution: {integrity: sha512-bCYeRA2rVibKZd+s2625gGnGF/t7DSqDs4dP7CrLA1m7jKWz6pps0LpYLJN8Q64HtmPKJ1hrN3nzPNKFEKOUiQ==}

  is-regex@1.2.1:
    resolution: {integrity: sha512-MjYsKHO5O7mCsmRGxWcLWheFqN9DJ/2TmngvjKXihe6efViPqc274+Fx/4fYj/r03+ESvBdTXK0V6tA3rgez1g==}
    engines: {node: '>= 0.4'}

  is-set@2.0.3:
    resolution: {integrity: sha512-iPAjerrse27/ygGLxw+EBR9agv9Y6uLeYVJMu+QNCoouJ1/1ri0mGrcWpfCqFZuzzx3WjtwxG098X+n4OuRkPg==}
    engines: {node: '>= 0.4'}

  is-shared-array-buffer@1.0.4:
    resolution: {integrity: sha512-ISWac8drv4ZGfwKl5slpHG9OwPNty4jOWPRIhBpxOoD+hqITiwuipOQ2bNthAzwA3B4fIjO4Nln74N0S9byq8A==}
    engines: {node: '>= 0.4'}

  is-string@1.1.1:
    resolution: {integrity: sha512-BtEeSsoaQjlSPBemMQIrY1MY0uM6vnS1g5fmufYOtnxLGUZM2178PKbhsk7Ffv58IX+ZtcvoGwccYsh0PglkAA==}
    engines: {node: '>= 0.4'}

  is-symbol@1.1.1:
    resolution: {integrity: sha512-9gGx6GTtCQM73BgmHQXfDmLtfjjTUDSyoxTCbp5WtoixAhfgsDirWIcVQ/IHpvI5Vgd5i/J5F7B9cN/WlVbC/w==}
    engines: {node: '>= 0.4'}

  is-typed-array@1.1.15:
    resolution: {integrity: sha512-p3EcsicXjit7SaskXHs1hA91QxgTw46Fv6EFKKGS5DRFLD8yKnohjF3hxoju94b/OcMZoQukzpPpBE9uLVKzgQ==}
    engines: {node: '>= 0.4'}

  is-weakmap@2.0.2:
    resolution: {integrity: sha512-K5pXYOm9wqY1RgjpL3YTkF39tni1XajUIkawTLUo9EZEVUFga5gSQJF8nNS7ZwJQ02y+1YCNYcMh+HIf1ZqE+w==}
    engines: {node: '>= 0.4'}

  is-weakref@1.1.1:
    resolution: {integrity: sha512-6i9mGWSlqzNMEqpCp93KwRS1uUOodk2OJ6b+sq7ZPDSy2WuI5NFIxp/254TytR8ftefexkWn5xNiHUNpPOfSew==}
    engines: {node: '>= 0.4'}

  is-weakset@2.0.4:
    resolution: {integrity: sha512-mfcwb6IzQyOKTs84CQMrOwW4gQcaTOAWJ0zzJCl2WSPDrWk/OzDaImWFH3djXhb24g4eudZfLRozAvPGw4d9hQ==}
    engines: {node: '>= 0.4'}

  isarray@2.0.5:
    resolution: {integrity: sha512-xHjhDr3cNBK0BzdUJSPXZntQUx/mwMS5Rw4A7lPJ90XGAO6ISP/ePDNuo0vhqOZU+UD5JoodwCAAoZQd3FeAKw==}

  isexe@2.0.0:
    resolution: {integrity: sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==}

  iterator.prototype@1.1.5:
    resolution: {integrity: sha512-H0dkQoCa3b2VEeKQBOxFph+JAbcrQdE7KC0UkqwpLmv2EC4P41QXP+rqo9wYodACiG5/WM5s9oDApTU8utwj9g==}
    engines: {node: '>= 0.4'}

  jackspeak@3.4.3:
    resolution: {integrity: sha512-OGlZQpz2yfahA/Rd1Y8Cd9SIEsqvXkLVoSw/cgwhnhFMDbsQFeZYoJJ7bIZBS9BcamUW96asq/npPWugM+RQBw==}

  jiti@1.21.7:
    resolution: {integrity: sha512-/imKNG4EbWNrVjoNC/1H5/9GFy+tqjGBHCaSsN+P2RnPqjsLmv6UD3Ej+Kj8nBWaRAwyk7kK5ZUc+OEatnTR3A==}
    hasBin: true

  js-tokens@4.0.0:
    resolution: {integrity: sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==}

  js-tokens@9.0.1:
    resolution: {integrity: sha512-mxa9E9ITFOt0ban3j6L5MpjwegGz6lBQmM1IJkWeBZGcMxto50+eWdjC/52xDbS2vy0k7vIMK0Fe2wfL9OQSpQ==}

  js-yaml@4.1.0:
    resolution: {integrity: sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==}
    hasBin: true

  jsdom@26.1.0:
    resolution: {integrity: sha512-Cvc9WUhxSMEo4McES3P7oK3QaXldCfNWp7pl2NNeiIFlCoLr3kfq9kb1fxftiwk1FLV7CvpvDfonxtzUDeSOPg==}
    engines: {node: '>=18'}
    peerDependencies:
      canvas: ^3.0.0
    peerDependenciesMeta:
      canvas:
        optional: true

  jsesc@3.1.0:
    resolution: {integrity: sha512-/sM3dO2FOzXjKQhJuo0Q173wf2KOo8t4I8vHy6lF9poUp7bKT0/NHE8fPX23PwfhnykfqnC2xRxOnVw5XuGIaA==}
    engines: {node: '>=6'}
    hasBin: true

  json-buffer@3.0.1:
    resolution: {integrity: sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==}

  json-schema-traverse@0.4.1:
    resolution: {integrity: sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==}

  json-stable-stringify-without-jsonify@1.0.1:
    resolution: {integrity: sha512-Bdboy+l7tA3OGW6FjyFHWkP5LuByj1Tk33Ljyq0axyzdk9//JSi2u3fP1QSmd1KNwq6VOKYGlAu87CisVir6Pw==}

  json5@1.0.2:
    resolution: {integrity: sha512-g1MWMLBiz8FKi1e4w0UyVL3w+iJceWAFBAaBnnGKOpNa5f8TLktkbre1+s6oICydWAm+HRUGTmI+//xv2hvXYA==}
    hasBin: true

  json5@2.2.3:
    resolution: {integrity: sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==}
    engines: {node: '>=6'}
    hasBin: true

  jsx-ast-utils@3.3.5:
    resolution: {integrity: sha512-ZZow9HBI5O6EPgSJLUb8n2NKgmVWTwCvHGwFuJlMjvLFqlGG6pjirPhtdsseaLZjSibD8eegzmYpUZwoIlj2cQ==}
    engines: {node: '>=4.0'}

  keyv@4.5.4:
    resolution: {integrity: sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==}

  language-subtag-registry@0.3.23:
    resolution: {integrity: sha512-0K65Lea881pHotoGEa5gDlMxt3pctLi2RplBb7Ezh4rRdLEOtgi7n4EwK9lamnUCkKBqaeKRVebTq6BAxSkpXQ==}

  language-tags@1.0.9:
    resolution: {integrity: sha512-MbjN408fEndfiQXbFQ1vnd+1NoLDsnQW41410oQBXiyXDMYH5z505juWa4KUE1LqxRC7DgOgZDbKLxHIwm27hA==}
    engines: {node: '>=0.10'}

  levn@0.4.1:
    resolution: {integrity: sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==}
    engines: {node: '>= 0.8.0'}

  lilconfig@3.1.3:
    resolution: {integrity: sha512-/vlFKAoH5Cgt3Ie+JLhRbwOsCQePABiU3tJ1egGvyQ+33R/vcwM2Zl2QR/LzjsBeItPt3oSVXapn+m4nQDvpzw==}
    engines: {node: '>=14'}

  lines-and-columns@1.2.4:
    resolution: {integrity: sha512-7ylylesZQ/PV29jhEDl3Ufjo6ZX7gCqJr5F7PKrqc93v7fzSymt1BpwEU8nAUXs8qzzvqhbjhK5QZg6Mt/HkBg==}

  locate-path@6.0.0:
    resolution: {integrity: sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==}
    engines: {node: '>=10'}

  lodash.merge@4.6.2:
    resolution: {integrity: sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==}

  lodash@4.17.21:
    resolution: {integrity: sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==}

  loose-envify@1.4.0:
    resolution: {integrity: sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==}
    hasBin: true

  loupe@3.1.4:
    resolution: {integrity: sha512-wJzkKwJrheKtknCOKNEtDK4iqg/MxmZheEMtSTYvnzRdEYaZzmgH976nenp8WdJRdx5Vc1X/9MO0Oszl6ezeXg==}

  lru-cache@10.4.3:
    resolution: {integrity: sha512-JNAzZcXrCt42VGLuYz0zfAzDfAvJWW6AfYlDBQyDV5DClI2m5sAmK+OIO7s59XfsRsWHp02jAJrRadPRGTt6SQ==}

  lru-cache@5.1.1:
    resolution: {integrity: sha512-KpNARQA3Iwv+jTA0utUVVbrh+Jlrr1Fv0e56GGzAFOXN7dk/FviaDW8LHmK52DlcH4WP2n6gI8vN1aesBFgo9w==}

  lucide-react@0.454.0:
    resolution: {integrity: sha512-hw7zMDwykCLnEzgncEEjHeA6+45aeEzRYuKHuyRSOPkhko+J3ySGjGIzu+mmMfDFG1vazHepMaYFYHbTFAZAAQ==}
    peerDependencies:
      react: ^16.5.1 || ^17.0.0 || ^18.0.0 || ^19.0.0-rc

  lz-string@1.5.0:
    resolution: {integrity: sha512-h5bgJWpxJNswbU7qCrV0tIKQCaS3blPDrqKWx+QxzuzL1zGUzij9XCWLrSLsJPu5t+eWA/ycetzYAO5IOMcWAQ==}
    hasBin: true

  magic-string@0.30.17:
    resolution: {integrity: sha512-sNPKHvyjVf7gyjwS4xGTaW/mCnF8wnjtifKBEhxfZ7E/S8tQ0rssrwGNn6q8JH/ohItJfSQp9mBtQYuTlH5QnA==}

  marked@4.3.0:
    resolution: {integrity: sha512-PRsaiG84bK+AMvxziE/lCFss8juXjNaWzVbN5tXAm4XjeaS9NAHhop+PjQxz2A9h8Q4M/xGmzP8vqNwy6JeK0A==}
    engines: {node: '>= 12'}
    hasBin: true

  math-intrinsics@1.1.0:
    resolution: {integrity: sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==}
    engines: {node: '>= 0.4'}

  merge2@1.4.1:
    resolution: {integrity: sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==}
    engines: {node: '>= 8'}

  micromatch@4.0.8:
    resolution: {integrity: sha512-PXwfBhYu0hBCPw8Dn0E+WDYb7af3dSLVWKi3HGv84IdF4TyFoC0ysxFd0Goxw7nSv4T/PzEJQxsYsEiFCKo2BA==}
    engines: {node: '>=8.6'}

  mime-db@1.52.0:
    resolution: {integrity: sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==}
    engines: {node: '>= 0.6'}

  mime-types@2.1.35:
    resolution: {integrity: sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==}
    engines: {node: '>= 0.6'}

  min-indent@1.0.1:
    resolution: {integrity: sha512-I9jwMn07Sy/IwOj3zVkVik2JTvgpaykDZEigL6Rx6N9LbMywwUSMtxET+7lVoDLLd3O3IXwJwvuuns8UB/HeAg==}
    engines: {node: '>=4'}

  minimatch@3.1.2:
    resolution: {integrity: sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==}

  minimatch@9.0.5:
    resolution: {integrity: sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==}
    engines: {node: '>=16 || 14 >=14.17'}

  minimist@1.2.8:
    resolution: {integrity: sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==}

  minipass@7.1.2:
    resolution: {integrity: sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==}
    engines: {node: '>=16 || 14 >=14.17'}

  mrmime@2.0.1:
    resolution: {integrity: sha512-Y3wQdFg2Va6etvQ5I82yUhGdsKrcYox6p7FfL1LbK2J4V01F9TGlepTIhnK24t7koZibmg82KGglhA1XK5IsLQ==}
    engines: {node: '>=10'}

  ms@2.1.3:
    resolution: {integrity: sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==}

  mz@2.7.0:
    resolution: {integrity: sha512-z81GNO7nnYMEhrGh9LeymoE4+Yr0Wn5McHIZMK5cfQCl+NDX08sCZgUc9/6MHni9IWuFLm1Z3HTCXu2z9fN62Q==}

  nanoid@3.3.11:
    resolution: {integrity: sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==}
    engines: {node: ^10 || ^12 || ^13.7 || ^14 || >=15.0.1}
    hasBin: true

  napi-postinstall@0.3.0:
    resolution: {integrity: sha512-M7NqKyhODKV1gRLdkwE7pDsZP2/SC2a2vHkOYh9MCpKMbWVfyVfUw5MaH83Fv6XMjxr5jryUp3IDDL9rlxsTeA==}
    engines: {node: ^12.20.0 || ^14.18.0 || >=16.0.0}
    hasBin: true

  natural-compare@1.4.0:
    resolution: {integrity: sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==}

  next-themes@0.4.6:
    resolution: {integrity: sha512-pZvgD5L0IEvX5/9GWyHMf3m8BKiVQwsCMHfoFosXtXBMnaS0ZnIJ9ST4b4NqLVKDEm8QBxoNNGNaBv2JNF6XNA==}
    peerDependencies:
      react: ^16.8 || ^17 || ^18 || ^19 || ^19.0.0-rc
      react-dom: ^16.8 || ^17 || ^18 || ^19 || ^19.0.0-rc

  next@15.2.4:
    resolution: {integrity: sha512-VwL+LAaPSxEkd3lU2xWbgEOtrM8oedmyhBqaVNmgKB+GvZlCy9rgaEc+y2on0wv+l0oSFqLtYD6dcC1eAedUaQ==}
    engines: {node: ^18.18.0 || ^19.8.0 || >= 20.0.0}
    hasBin: true
    peerDependencies:
      '@opentelemetry/api': ^1.1.0
      '@playwright/test': ^1.41.2
      babel-plugin-react-compiler: '*'
      react: ^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0
      react-dom: ^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0
      sass: ^1.3.0
    peerDependenciesMeta:
      '@opentelemetry/api':
        optional: true
      '@playwright/test':
        optional: true
      babel-plugin-react-compiler:
        optional: true
      sass:
        optional: true

  node-releases@2.0.19:
    resolution: {integrity: sha512-xxOWJsBKtzAq7DY0J+DTzuz58K8e7sJbdgwkbMWQe8UYB6ekmsQ45q0M/tJDsGaZmbC+l7n57UV8Hl5tHxO9uw==}

  normalize-path@3.0.0:
    resolution: {integrity: sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb/mD4WYojCRwcwLA==}
    engines: {node: '>=0.10.0'}

  normalize-range@0.1.2:
    resolution: {integrity: sha512-bdok/XvKII3nUpklnV6P2hxtMNrCboOjAcyBuQnWEhO665FwrSNRxU+AqpsyvO6LgGYPspN+lu5CLtw4jPRKNA==}
    engines: {node: '>=0.10.0'}

  nwsapi@2.2.20:
    resolution: {integrity: sha512-/ieB+mDe4MrrKMT8z+mQL8klXydZWGR5Dowt4RAGKbJ3kIGEx3X4ljUo+6V73IXtUPWgfOlU5B9MlGxFO5T+cA==}

  object-assign@4.1.1:
    resolution: {integrity: sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==}
    engines: {node: '>=0.10.0'}

  object-hash@3.0.0:
    resolution: {integrity: sha512-RSn9F68PjH9HqtltsSnqYC1XXoWe9Bju5+213R98cNGttag9q9yAOTzdbsqvIa7aNm5WffBZFpWYr2aWrklWAw==}
    engines: {node: '>= 6'}

  object-inspect@1.13.4:
    resolution: {integrity: sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==}
    engines: {node: '>= 0.4'}

  object-keys@1.1.1:
    resolution: {integrity: sha512-NuAESUOUMrlIXOfHKzD6bpPu3tYt3xvjNdRIQ+FeT0lNb4K8WR70CaDxhuNguS2XG+GjkyMwOzsN5ZktImfhLA==}
    engines: {node: '>= 0.4'}

  object.assign@4.1.7:
    resolution: {integrity: sha512-nK28WOo+QIjBkDduTINE4JkF/UJJKyf2EJxvJKfblDpyg0Q+pkOHNTL0Qwy6NP6FhE/EnzV73BxxqcJaXY9anw==}
    engines: {node: '>= 0.4'}

  object.entries@1.1.9:
    resolution: {integrity: sha512-8u/hfXFRBD1O0hPUjioLhoWFHRmt6tKA4/vZPyckBr18l1KE9uHrFaFaUi8MDRTpi4uak2goyPTSNJLXX2k2Hw==}
    engines: {node: '>= 0.4'}

  object.fromentries@2.0.8:
    resolution: {integrity: sha512-k6E21FzySsSK5a21KRADBd/NGneRegFO5pLHfdQLpRDETUNJueLXs3WCzyQ3tFRDYgbq3KHGXfTbi2bs8WQ6rQ==}
    engines: {node: '>= 0.4'}

  object.groupby@1.0.3:
    resolution: {integrity: sha512-+Lhy3TQTuzXI5hevh8sBGqbmurHbbIjAi0Z4S63nthVLmLxfbj4T54a4CfZrXIrt9iP4mVAPYMo/v99taj3wjQ==}
    engines: {node: '>= 0.4'}

  object.values@1.2.1:
    resolution: {integrity: sha512-gXah6aZrcUxjWg2zR2MwouP2eHlCBzdV4pygudehaKXSGW4v2AsRQUK+lwwXhii6KFZcunEnmSUoYp5CXibxtA==}
    engines: {node: '>= 0.4'}

  optionator@0.9.4:
    resolution: {integrity: sha512-6IpQ7mKUxRcZNLIObR0hz7lxsapSSIYNZJwXPGeF0mTVqGKFIXj1DQcMoT22S3ROcLyY/rz0PWaWZ9ayWmad9g==}
    engines: {node: '>= 0.8.0'}

  own-keys@1.0.1:
    resolution: {integrity: sha512-qFOyK5PjiWZd+QQIh+1jhdb9LpxTF0qs7Pm8o5QHYZ0M3vKqSqzsZaEB6oWlxZ+q2sJBMI/Ktgd2N5ZwQoRHfg==}
    engines: {node: '>= 0.4'}

  p-limit@3.1.0:
    resolution: {integrity: sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==}
    engines: {node: '>=10'}

  p-locate@5.0.0:
    resolution: {integrity: sha512-LaNjtRWUBY++zB5nE/NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X/tl/QYq3TIeE6nxHppbo2LGymrG5Pw==}
    engines: {node: '>=10'}

  package-json-from-dist@1.0.1:
    resolution: {integrity: sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw==}

  parent-module@1.0.1:
    resolution: {integrity: sha512-GQ2EWRpQV8/o+Aw8YqtfZZPfNRWZYkbidE9k5rpl/hC3vtHHBfGm2Ifi6qWV+coDGkrUKZAxE3Lot5kcsRlh+g==}
    engines: {node: '>=6'}

  parse5@7.3.0:
    resolution: {integrity: sha512-IInvU7fabl34qmi9gY8XOVxhYyMyuH2xUNpb2q8/Y+7552KlejkRvqvD19nMoUW/uQGGbqNpA6Tufu5FL5BZgw==}

  path-exists@4.0.0:
    resolution: {integrity: sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc/ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7/w==}
    engines: {node: '>=8'}

  path-key@3.1.1:
    resolution: {integrity: sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==}
    engines: {node: '>=8'}

  path-parse@1.0.7:
    resolution: {integrity: sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==}

  path-scurry@1.11.1:
    resolution: {integrity: sha512-Xa4Nw17FS9ApQFJ9umLiJS4orGjm7ZzwUrwamcGQuHSzDyth9boKDaycYdDcZDuqYATXw4HFXgaqWTctW/v1HA==}
    engines: {node: '>=16 || 14 >=14.18'}

  pathe@2.0.3:
    resolution: {integrity: sha512-WUjGcAqP1gQacoQe+OBJsFA7Ld4DyXuUIjZ5cc75cLHvJ7dtNsTugphxIADwspS+AraAUePCKrSVtPLFj/F88w==}

  pathval@2.0.1:
    resolution: {integrity: sha512-//nshmD55c46FuFw26xV/xFAaB5HF9Xdap7HJBBnrKdAd6/GxDBaNA1870O79+9ueg61cZLSVc+OaFlfmObYVQ==}
    engines: {node: '>= 14.16'}

  picocolors@1.1.1:
    resolution: {integrity: sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==}

  picomatch@2.3.1:
    resolution: {integrity: sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==}
    engines: {node: '>=8.6'}

  picomatch@4.0.2:
    resolution: {integrity: sha512-M7BAV6Rlcy5u+m6oPhAPFgJTzAioX/6B0DxyvDlo9l8+T3nLKbrczg2WLUyzd45L8RqfUMyGPzekbMvX2Ldkwg==}
    engines: {node: '>=12'}

  pify@2.3.0:
    resolution: {integrity: sha512-udgsAY+fTnvv7kI7aaxbqwWNb0AHiB0qBO89PZKPkoTmGOgdbrHDKD+0B2X4uTfJ/FT1R09r9gTsjUjNJotuog==}
    engines: {node: '>=0.10.0'}

  pirates@4.0.7:
    resolution: {integrity: sha512-TfySrs/5nm8fQJDcBDuUng3VOUKsd7S+zqvbOTiGXHfxX4wK31ard+hoNuvkicM/2YFzlpDgABOevKSsB4G/FA==}
    engines: {node: '>= 6'}

  playwright-core@1.53.2:
    resolution: {integrity: sha512-ox/OytMy+2w1jcYEYlOo1Hhp8hZkLCximMTUTMBXjGUA1KoFfiSZ+DU+3a739jsPY0yoKH2TFy9S2fsJas8yAw==}
    engines: {node: '>=18'}
    hasBin: true

  playwright@1.53.2:
    resolution: {integrity: sha512-6K/qQxVFuVQhRQhFsVZ9fGeatxirtrpPgxzBYWyZLEXJzqYwuL4fuNmfOfD5et1tJE4GScKyPNeLhZeRwuTU3A==}
    engines: {node: '>=18'}
    hasBin: true

  possible-typed-array-names@1.1.0:
    resolution: {integrity: sha512-/+5VFTchJDoVj3bhoqi6UeymcD00DAwb1nJwamzPvHEszJ4FpF6SNNbUbOS8yI56qHzdV8eK0qEfOSiodkTdxg==}
    engines: {node: '>= 0.4'}

  postcss-import@15.1.0:
    resolution: {integrity: sha512-hpr+J05B2FVYUAXHeK1YyI267J/dDDhMU6B6civm8hSY1jYJnBXxzKDKDswzJmtLHryrjhnDjqqp/49t8FALew==}
    engines: {node: '>=14.0.0'}
    peerDependencies:
      postcss: ^8.0.0

  postcss-js@4.0.1:
    resolution: {integrity: sha512-dDLF8pEO191hJMtlHFPRa8xsizHaM82MLfNkUHdUtVEV3tgTp5oj+8qbEqYM57SLfc74KSbw//4SeJma2LRVIw==}
    engines: {node: ^12 || ^14 || >= 16}
    peerDependencies:
      postcss: ^8.4.21

  postcss-load-config@4.0.2:
    resolution: {integrity: sha512-bSVhyJGL00wMVoPUzAVAnbEoWyqRxkjv64tUl427SKnPrENtq6hJwUojroMz2VB+Q1edmi4IfrAPpami5VVgMQ==}
    engines: {node: '>= 14'}
    peerDependencies:
      postcss: '>=8.0.9'
      ts-node: '>=9.0.0'
    peerDependenciesMeta:
      postcss:
        optional: true
      ts-node:
        optional: true

  postcss-nested@6.2.0:
    resolution: {integrity: sha512-HQbt28KulC5AJzG+cZtj9kvKB93CFCdLvog1WFLf1D+xmMvPGlBstkpTEZfK5+AN9hfJocyBFCNiqyS48bpgzQ==}
    engines: {node: '>=12.0'}
    peerDependencies:
      postcss: ^8.2.14

  postcss-selector-parser@6.1.2:
    resolution: {integrity: sha512-Q8qQfPiZ+THO/3ZrOrO0cJJKfpYCagtMUkXbnEfmgUjwXg6z/WBeOyS9APBBPCTSiDV+s4SwQGu8yFsiMRIudg==}
    engines: {node: '>=4'}

  postcss-value-parser@4.2.0:
    resolution: {integrity: sha512-1NNCs6uurfkVbeXG4S8JFT9t19m45ICnif8zWLd5oPSZ50QnwMfK+H3jv408d4jw/7Bttv5axS5IiHoLaVNHeQ==}

  postcss@8.4.31:
    resolution: {integrity: sha512-PS08Iboia9mts/2ygV3eLpY5ghnUcfLV/EXTOW1E2qYxJKGGBUtNjN76FYHnMs36RmARn41bC0AZmn+rR0OVpQ==}
    engines: {node: ^10 || ^12 || >=14}

  postcss@8.5.6:
    resolution: {integrity: sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==}
    engines: {node: ^10 || ^12 || >=14}

  prelude-ls@1.2.1:
    resolution: {integrity: sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==}
    engines: {node: '>= 0.8.0'}

  pretty-format@27.5.1:
    resolution: {integrity: sha512-Qb1gy5OrP5+zDf2Bvnzdl3jsTf1qXVMazbvCoKhtKqVs4/YK4ozX4gKQJJVyNe+cajNPn0KoC0MC3FUmaHWEmQ==}
    engines: {node: ^10.13.0 || ^12.13.0 || ^14.15.0 || >=15.0.0}

  prop-types@15.8.1:
    resolution: {integrity: sha512-oj87CgZICdulUohogVAR7AjlC0327U4el4L6eAvOqCeudMDVU0NThNaV+b9Df4dXgSP1gXMTnPdhfe/2qDH5cg==}

  proxy-from-env@1.1.0:
    resolution: {integrity: sha512-D+zkORCbA9f1tdWRK0RaCR3GPv50cMxcrz4X8k5LTSUD1Dkw47mKJEZQNunItRTkWwgtaUSo1RVFRIG9ZXiFYg==}

  punycode@2.3.1:
    resolution: {integrity: sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==}
    engines: {node: '>=6'}

  queue-microtask@1.2.3:
    resolution: {integrity: sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==}

  react-day-picker@8.10.1:
    resolution: {integrity: sha512-TMx7fNbhLk15eqcMt+7Z7S2KF7mfTId/XJDjKE8f+IUcFn0l08/kI4FiYTL/0yuOLmEcbR4Fwe3GJf/NiiMnPA==}
    peerDependencies:
      date-fns: ^2.28.0 || ^3.0.0
      react: ^16.8.0 || ^17.0.0 || ^18.0.0

  react-dom@19.1.0:
    resolution: {integrity: sha512-Xs1hdnE+DyKgeHJeJznQmYMIBG3TKIHJJT95Q58nHLSrElKlGQqDTR2HQ9fx5CN/Gk6Vh/kupBTDLU11/nDk/g==}
    peerDependencies:
      react: ^19.1.0

  react-hook-form@7.59.0:
    resolution: {integrity: sha512-kmkek2/8grqarTJExFNjy+RXDIP8yM+QTl3QL6m6Q8b2bih4ltmiXxH7T9n+yXNK477xPh5yZT/6vD8sYGzJTA==}
    engines: {node: '>=18.0.0'}
    peerDependencies:
      react: ^16.8.0 || ^17 || ^18 || ^19

  react-is@16.13.1:
    resolution: {integrity: sha512-24e6ynE2H+OKt4kqsOvNd8kBpV65zoxbA4BVsEOB3ARVWQki/DHzaUoC5KuON/BiccDaCCTZBuOcfZs70kR8bQ==}

  react-is@17.0.2:
    resolution: {integrity: sha512-w2GsyukL62IJnlaff/nRegPQR94C/XXamvMWmSHRJ4y7Ts/4ocGRmTHvOs8PSE6pB3dWOrD/nueuU5sduBsQ4w==}

  react-is@18.3.1:
    resolution: {integrity: sha512-/LLMVyas0ljjAtoYiPqYiL8VWXzUUdThrmU5+n20DZv+a+ClRoevUzw5JxU+Ieh5/c87ytoTBV9G1FiKfNJdmg==}

  react-refresh@0.17.0:
    resolution: {integrity: sha512-z6F7K9bV85EfseRCp2bzrpyQ0Gkw1uLoCel9XBVWPg/TjRj94SkJzUTGfOa4bs7iJvBWtQG0Wq7wnI0syw3EBQ==}
    engines: {node: '>=0.10.0'}

  react-remove-scroll-bar@2.3.8:
    resolution: {integrity: sha512-9r+yi9+mgU33AKcj6IbT9oRCO78WriSj6t/cF8DWBZJ9aOGPOTEDvdUDz1FwKim7QXWwmHqtdHnRJfhAxEG46Q==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0
    peerDependenciesMeta:
      '@types/react':
        optional: true

  react-remove-scroll@2.7.1:
    resolution: {integrity: sha512-HpMh8+oahmIdOuS5aFKKY6Pyog+FNaZV/XyJOq7b4YFwsFHe5yYfdbIalI4k3vU2nSDql7YskmUseHsRrJqIPA==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  react-resizable-panels@2.1.9:
    resolution: {integrity: sha512-z77+X08YDIrgAes4jl8xhnUu1LNIRp4+E7cv4xHmLOxxUPO/ML7PSrE813b90vj7xvQ1lcf7g2uA9GeMZonjhQ==}
    peerDependencies:
      react: ^16.14.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
      react-dom: ^16.14.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc

  react-simplemde-editor@5.2.0:
    resolution: {integrity: sha512-GkTg1MlQHVK2Rks++7sjuQr/GVS/xm6y+HchZ4GPBWrhcgLieh4CjK04GTKbsfYorSRYKa0n37rtNSJmOzEDkQ==}
    peerDependencies:
      easymde: '>= 2.0.0 < 3.0.0'
      react: '>=16.8.2'
      react-dom: '>=16.8.2'

  react-smooth@4.0.4:
    resolution: {integrity: sha512-gnGKTpYwqL0Iii09gHobNolvX4Kiq4PKx6eWBCYYix+8cdw+cGo3do906l1NBPKkSWx1DghC1dlWG9L2uGd61Q==}
    peerDependencies:
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0
      react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0

  react-style-singleton@2.2.3:
    resolution: {integrity: sha512-b6jSvxvVnyptAiLjbkWLE/lOnR4lfTtDAl+eUC7RZy+QQWc6wRzIV2CE6xBuMmDxc2qIihtDCZD5NPOFl7fRBQ==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  react-transition-group@4.4.5:
    resolution: {integrity: sha512-pZcd1MCJoiKiBR2NRxeCRg13uCXbydPnmB4EOeRrY7480qNWO8IIgQG6zlDkm6uRMsURXPuKq0GWtiM59a5Q6g==}
    peerDependencies:
      react: '>=16.6.0'
      react-dom: '>=16.6.0'

  react@19.1.0:
    resolution: {integrity: sha512-FS+XFBNvn3GTAWq26joslQgWNoFu08F4kl0J4CgdNKADkdSGXQyTCnKteIAJy96Br6YbpEU1LSzV5dYtjMkMDg==}
    engines: {node: '>=0.10.0'}

  read-cache@1.0.0:
    resolution: {integrity: sha512-Owdv/Ft7IjOgm/i0xvNDZ1LrRANRfew4b2prF3OWMQLxLfu3bS8FVhCsrSCMK4lR56Y9ya+AThoTpDCTxCmpRA==}

  readdirp@3.6.0:
    resolution: {integrity: sha512-hOS089on8RduqdbhvQ5Z37A0ESjsqz6qnRcffsMU3495FuTdqSm+7bhJ29JvIOsBDEEnan5DPu9t3To9VRlMzA==}
    engines: {node: '>=8.10.0'}

  recharts-scale@0.4.5:
    resolution: {integrity: sha512-kivNFO+0OcUNu7jQquLXAxz1FIwZj8nrj+YkOKc5694NbjCvcT6aSZiIzNzd2Kul4o4rTto8QVR9lMNtxD4G1w==}

  recharts@2.15.0:
    resolution: {integrity: sha512-cIvMxDfpAmqAmVgc4yb7pgm/O1tmmkl/CjrvXuW+62/+7jj/iF9Ykm+hb/UJt42TREHMyd3gb+pkgoa2MxgDIw==}
    engines: {node: '>=14'}
    peerDependencies:
      react: ^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0
      react-dom: ^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0

  redent@3.0.0:
    resolution: {integrity: sha512-6tDA8g98We0zd0GvVeMT9arEOnTw9qM03L9cJXaCjrip1OO764RDBLBfrB4cwzNGDj5OA5ioymC9GkizgWJDUg==}
    engines: {node: '>=8'}

  reflect.getprototypeof@1.0.10:
    resolution: {integrity: sha512-00o4I+DVrefhv+nX0ulyi3biSHCPDe+yLv5o/p6d/UVlirijB8E16FtfwSAi4g3tcqrQ4lRAqQSoFEZJehYEcw==}
    engines: {node: '>= 0.4'}

  regexp.prototype.flags@1.5.4:
    resolution: {integrity: sha512-dYqgNSZbDwkaJ2ceRd9ojCGjBq+mOm9LmtXnAnEGyHhN/5R7iDW2TRw3h+o/jCFxus3P2LfWIIiwowAjANm7IA==}
    engines: {node: '>= 0.4'}

  resolve-from@4.0.0:
    resolution: {integrity: sha512-pb/MYmXstAkysRFx8piNI1tGFNQIFA3vkE3Gq4EuA1dF6gHp/+vgZqsCGJapvy8N3Q+4o7FwvquPJcnZ7RYy4g==}
    engines: {node: '>=4'}

  resolve-pkg-maps@1.0.0:
    resolution: {integrity: sha512-seS2Tj26TBVOC2NIc2rOe2y2ZO7efxITtLZcGSOnHHNOQ7CkiUBfw0Iw2ck6xkIhPwLhKNLS8BO+hEpngQlqzw==}

  resolve@1.22.10:
    resolution: {integrity: sha512-NPRy+/ncIMeDlTAsuqwKIiferiawhefFJtkNSW0qZJEqMEb+qBt/77B/jGeeek+F0uOeN05CDa6HXbbIgtVX4w==}
    engines: {node: '>= 0.4'}
    hasBin: true

  resolve@2.0.0-next.5:
    resolution: {integrity: sha512-U7WjGVG9sH8tvjW5SmGbQuui75FiyjAX72HX15DwBBwF9dNiQZRQAg9nnPhYy+TUnE0+VcrttuvNI8oSxZcocA==}
    hasBin: true

  reusify@1.1.0:
    resolution: {integrity: sha512-g6QUff04oZpHs0eG5p83rFLhHeV00ug/Yf9nZM6fLeUrPguBTkTQOdpAWWspMh55TZfVQDPaN3NQJfbVRAxdIw==}
    engines: {iojs: '>=1.0.0', node: '>=0.10.0'}

  rollup@4.44.1:
    resolution: {integrity: sha512-x8H8aPvD+xbl0Do8oez5f5o8eMS3trfCghc4HhLAnCkj7Vl0d1JWGs0UF/D886zLW2rOj2QymV/JcSSsw+XDNg==}
    engines: {node: '>=18.0.0', npm: '>=8.0.0'}
    hasBin: true

  rrweb-cssom@0.8.0:
    resolution: {integrity: sha512-guoltQEx+9aMf2gDZ0s62EcV8lsXR+0w8915TC3ITdn2YueuNjdAYh/levpU9nFaoChh9RUS5ZdQMrKfVEN9tw==}

  run-parallel@1.2.0:
    resolution: {integrity: sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==}

  safe-array-concat@1.1.3:
    resolution: {integrity: sha512-AURm5f0jYEOydBj7VQlVvDrjeFgthDdEF5H1dP+6mNpoXOMo1quQqJ4wvJDyRZ9+pO3kGWoOdmV08cSv2aJV6Q==}
    engines: {node: '>=0.4'}

  safe-push-apply@1.0.0:
    resolution: {integrity: sha512-iKE9w/Z7xCzUMIZqdBsp6pEQvwuEebH4vdpjcDWnyzaI6yl6O9FHvVpmGelvEHNsoY6wGblkxR6Zty/h00WiSA==}
    engines: {node: '>= 0.4'}

  safe-regex-test@1.1.0:
    resolution: {integrity: sha512-x/+Cz4YrimQxQccJf5mKEbIa1NzeCRNI5Ecl/ekmlYaampdNLPalVyIcCZNNH3MvmqBugV5TMYZXv0ljslUlaw==}
    engines: {node: '>= 0.4'}

  safer-buffer@2.1.2:
    resolution: {integrity: sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==}

  saxes@6.0.0:
    resolution: {integrity: sha512-xAg7SOnEhrm5zI3puOOKyy1OMcMlIJZYNJY7xLBwSze0UjhPLnWfj2GF2EpT0jmzaJKIWKHLsaSSajf35bcYnA==}
    engines: {node: '>=v12.22.7'}

  scheduler@0.26.0:
    resolution: {integrity: sha512-NlHwttCI/l5gCPR3D1nNXtWABUmBwvZpEQiD4IXSbIDq8BzLIK/7Ir5gTFSGZDUu37K5cMNp0hFtzO38sC7gWA==}

  semver@6.3.1:
    resolution: {integrity: sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==}
    hasBin: true

  semver@7.7.2:
    resolution: {integrity: sha512-RF0Fw+rO5AMf9MAyaRXI4AV0Ulj5lMHqVxxdSgiVbixSCXoEmmX/jk0CuJw4+3SqroYO9VoUh+HcuJivvtJemA==}
    engines: {node: '>=10'}
    hasBin: true

  set-function-length@1.2.2:
    resolution: {integrity: sha512-pgRc4hJ4/sNjWCSS9AmnS40x3bNMDTknHgL5UaMBTMyJnU90EgWh1Rz+MC9eFu4BuN/UwZjKQuY/1v3rM7HMfg==}
    engines: {node: '>= 0.4'}

  set-function-name@2.0.2:
    resolution: {integrity: sha512-7PGFlmtwsEADb0WYyvCMa1t+yke6daIG4Wirafur5kcf+MhUnPms1UeR0CKQdTZD81yESwMHbtn+TR+dMviakQ==}
    engines: {node: '>= 0.4'}

  set-proto@1.0.0:
    resolution: {integrity: sha512-RJRdvCo6IAnPdsvP/7m6bsQqNnn1FCBX5ZNtFL98MmFF/4xAIJTIg1YbHW5DC2W5SKZanrC6i4HsJqlajw/dZw==}
    engines: {node: '>= 0.4'}

  sharp@0.33.5:
    resolution: {integrity: sha512-haPVm1EkS9pgvHrQ/F3Xy+hgcuMV0Wm9vfIBSiwZ05k+xgb0PkBQpGsAA/oWdDobNaZTH5ppvHtzCFbnSEwHVw==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}

  shebang-command@2.0.0:
    resolution: {integrity: sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==}
    engines: {node: '>=8'}

  shebang-regex@3.0.0:
    resolution: {integrity: sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==}
    engines: {node: '>=8'}

  side-channel-list@1.0.0:
    resolution: {integrity: sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==}
    engines: {node: '>= 0.4'}

  side-channel-map@1.0.1:
    resolution: {integrity: sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==}
    engines: {node: '>= 0.4'}

  side-channel-weakmap@1.0.2:
    resolution: {integrity: sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==}
    engines: {node: '>= 0.4'}

  side-channel@1.1.0:
    resolution: {integrity: sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==}
    engines: {node: '>= 0.4'}

  siginfo@2.0.0:
    resolution: {integrity: sha512-ybx0WO1/8bSBLEWXZvEd7gMW3Sn3JFlW3TvX1nREbDLRNQNaeNN8WK0meBwPdAaOI7TtRRRJn/Es1zhrrCHu7g==}

  signal-exit@4.1.0:
    resolution: {integrity: sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==}
    engines: {node: '>=14'}

  simple-swizzle@0.2.2:
    resolution: {integrity: sha512-JA//kQgZtbuY83m+xT+tXJkmJncGMTFT+C+g2h2R9uxkYIrE2yy9sgmcLhCnw57/WSD+Eh3J97FPEDFnbXnDUg==}

  sirv@3.0.1:
    resolution: {integrity: sha512-FoqMu0NCGBLCcAkS1qA+XJIQTR6/JHfQXl+uGteNCQ76T91DMUjPa9xfmeqMY3z80nLSg9yQmNjK0Px6RWsH/A==}
    engines: {node: '>=18'}

  sonner@1.7.4:
    resolution: {integrity: sha512-DIS8z4PfJRbIyfVFDVnK9rO3eYDtse4Omcm6bt0oEr5/jtLgysmjuBl1frJ9E/EQZrFmKx2A8m/s5s9CRXIzhw==}
    peerDependencies:
      react: ^18.0.0 || ^19.0.0 || ^19.0.0-rc
      react-dom: ^18.0.0 || ^19.0.0 || ^19.0.0-rc

  source-map-js@1.2.1:
    resolution: {integrity: sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==}
    engines: {node: '>=0.10.0'}

  stable-hash@0.0.5:
    resolution: {integrity: sha512-+L3ccpzibovGXFK+Ap/f8LOS0ahMrHTf3xu7mMLSpEGU0EO9ucaysSylKo9eRDFNhWve/y275iPmIZ4z39a9iA==}

  stackback@0.0.2:
    resolution: {integrity: sha512-1XMJE5fQo1jGH6Y/7ebnwPOBEkIEnT4QF32d5R1+VXdXveM0IBMJt8zfaxX1P3QhVwrYe+576+jkANtSS2mBbw==}

  std-env@3.9.0:
    resolution: {integrity: sha512-UGvjygr6F6tpH7o2qyqR6QYpwraIjKSdtzyBdyytFOHmPZY917kwdwLG0RbOjWOnKmnm3PeHjaoLLMie7kPLQw==}

  stop-iteration-iterator@1.1.0:
    resolution: {integrity: sha512-eLoXW/DHyl62zxY4SCaIgnRhuMr6ri4juEYARS8E6sCEqzKpOiE521Ucofdx+KnDZl5xmvGYaaKCk5FEOxJCoQ==}
    engines: {node: '>= 0.4'}

  streamsearch@1.1.0:
    resolution: {integrity: sha512-Mcc5wHehp9aXz1ax6bZUyY5afg9u2rv5cqQI3mRrYkGC8rW2hM02jWuwjtL++LS5qinSyhj2QfLyNsuc+VsExg==}
    engines: {node: '>=10.0.0'}

  string-width@4.2.3:
    resolution: {integrity: sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==}
    engines: {node: '>=8'}

  string-width@5.1.2:
    resolution: {integrity: sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==}
    engines: {node: '>=12'}

  string.prototype.includes@2.0.1:
    resolution: {integrity: sha512-o7+c9bW6zpAdJHTtujeePODAhkuicdAryFsfVKwA+wGw89wJ4GTY484WTucM9hLtDEOpOvI+aHnzqnC5lHp4Rg==}
    engines: {node: '>= 0.4'}

  string.prototype.matchall@4.0.12:
    resolution: {integrity: sha512-6CC9uyBL+/48dYizRf7H7VAYCMCNTBeM78x/VTUe9bFEaxBepPJDa1Ow99LqI/1yF7kuy7Q3cQsYMrcjGUcskA==}
    engines: {node: '>= 0.4'}

  string.prototype.repeat@1.0.0:
    resolution: {integrity: sha512-0u/TldDbKD8bFCQ/4f5+mNRrXwZ8hg2w7ZR8wa16e8z9XpePWl3eGEcUD0OXpEH/VJH/2G3gjUtR3ZOiBe2S/w==}

  string.prototype.trim@1.2.10:
    resolution: {integrity: sha512-Rs66F0P/1kedk5lyYyH9uBzuiI/kNRmwJAR9quK6VOtIpZ2G+hMZd+HQbbv25MgCA6gEffoMZYxlTod4WcdrKA==}
    engines: {node: '>= 0.4'}

  string.prototype.trimend@1.0.9:
    resolution: {integrity: sha512-G7Ok5C6E/j4SGfyLCloXTrngQIQU3PWtXGst3yM7Bea9FRURf1S42ZHlZZtsNque2FN2PoUhfZXYLNWwEr4dLQ==}
    engines: {node: '>= 0.4'}

  string.prototype.trimstart@1.0.8:
    resolution: {integrity: sha512-UXSH262CSZY1tfu3G3Secr6uGLCFVPMhIqHjlgCUtCCcgihYc/xKs9djMTMUOb2j1mVSeU8EU6NWc/iQKU6Gfg==}
    engines: {node: '>= 0.4'}

  strip-ansi@6.0.1:
    resolution: {integrity: sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==}
    engines: {node: '>=8'}

  strip-ansi@7.1.0:
    resolution: {integrity: sha512-iq6eVVI64nQQTRYq2KtEg2d2uU7LElhTJwsH4YzIHZshxlgZms/wIc4VoDQTlG/IvVIrBKG06CrZnp0qv7hkcQ==}
    engines: {node: '>=12'}

  strip-bom@3.0.0:
    resolution: {integrity: sha512-vavAMRXOgBVNF6nyEEmL3DBK19iRpDcoIwW+swQ+CbGiu7lju6t+JklA1MHweoWtadgt4ISVUsXLyDq34ddcwA==}
    engines: {node: '>=4'}

  strip-indent@3.0.0:
    resolution: {integrity: sha512-laJTa3Jb+VQpaC6DseHhF7dXVqHTfJPCRDaEbid/drOhgitgYku/letMUqOXFoWV0zIIUbjpdH2t+tYj4bQMRQ==}
    engines: {node: '>=8'}

  strip-json-comments@3.1.1:
    resolution: {integrity: sha512-6fPc+R4ihwqP6N/aIv2f1gMH8lOVtWQHoqC4yK6oSDVVocumAsfCqjkXnqiYMhmMwS/mEHLp7Vehlt3ql6lEig==}
    engines: {node: '>=8'}

  strip-literal@3.0.0:
    resolution: {integrity: sha512-TcccoMhJOM3OebGhSBEmp3UZ2SfDMZUEBdRA/9ynfLi8yYajyWX3JiXArcJt4Umh4vISpspkQIY8ZZoCqjbviA==}

  styled-jsx@5.1.6:
    resolution: {integrity: sha512-qSVyDTeMotdvQYoHWLNGwRFJHC+i+ZvdBRYosOFgC+Wg1vx4frN2/RG/NA7SYqqvKNLf39P2LSRA2pu6n0XYZA==}
    engines: {node: '>= 12.0.0'}
    peerDependencies:
      '@babel/core': '*'
      babel-plugin-macros: '*'
      react: '>= 16.8.0 || 17.x.x || ^18.0.0-0 || ^19.0.0-0'
    peerDependenciesMeta:
      '@babel/core':
        optional: true
      babel-plugin-macros:
        optional: true

  sucrase@3.35.0:
    resolution: {integrity: sha512-8EbVDiu9iN/nESwxeSxDKe0dunta1GOlHufmSSXxMD2z2/tMZpDMpvXQGsc+ajGo8y2uYUmixaSRUc/QPoQ0GA==}
    engines: {node: '>=16 || 14 >=14.17'}
    hasBin: true

  supports-color@7.2.0:
    resolution: {integrity: sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==}
    engines: {node: '>=8'}

  supports-preserve-symlinks-flag@1.0.0:
    resolution: {integrity: sha512-ot0WnXS9fgdkgIcePe6RHNk1WA8+muPa6cSjeR3V8K27q9BB1rTE3R1p7Hv0z1ZyAc8s6Vvv8DIyWf681MAt0w==}
    engines: {node: '>= 0.4'}

  symbol-tree@3.2.4:
    resolution: {integrity: sha512-9QNk5KwDF+Bvz+PyObkmSYjI5ksVUYtjW7AU22r2NKcfLJcXp96hkDWU3+XndOsUb+AQ9QhfzfCT2O+CNWT5Tw==}

  tailwind-merge@2.6.0:
    resolution: {integrity: sha512-P+Vu1qXfzediirmHOC3xKGAYeZtPcV9g76X+xg2FD4tYgR71ewMA35Y3sCz3zhiN/dwefRpJX0yBcgwi1fXNQA==}

  tailwindcss-animate@1.0.7:
    resolution: {integrity: sha512-bl6mpH3T7I3UFxuvDEXLxy/VuFxBk5bbzplh7tXI68mwMokNYd1t9qPBHlnyTwfa4JGC4zP516I1hYYtQ/vspA==}
    peerDependencies:
      tailwindcss: '>=3.0.0 || insiders'

  tailwindcss@3.4.17:
    resolution: {integrity: sha512-w33E2aCvSDP0tW9RZuNXadXlkHXqFzSkQew/aIa2i/Sj8fThxwovwlXHSPXTbAHwEIhBFXAedUhP2tueAKP8Og==}
    engines: {node: '>=14.0.0'}
    hasBin: true

  thenify-all@1.6.0:
    resolution: {integrity: sha512-RNxQH/qI8/t3thXJDwcstUO4zeqo64+Uy/+sNVRBx4Xn2OX+OZ9oP+iJnNFqplFra2ZUVeKCSa2oVWi3T4uVmA==}
    engines: {node: '>=0.8'}

  thenify@3.3.1:
    resolution: {integrity: sha512-RVZSIV5IG10Hk3enotrhvz0T9em6cyHBLkH/YAZuKqd8hRkKhSfCGIcP2KUY0EPxndzANBmNllzWPwak+bheSw==}

  tiny-invariant@1.3.3:
    resolution: {integrity: sha512-+FbBPE1o9QAYvviau/qC5SE3caw21q3xkvWKBtja5vgqOWIHHJ3ioaq1VPfn/Szqctz2bU/oYeKd9/z5BL+PVg==}

  tinybench@2.9.0:
    resolution: {integrity: sha512-0+DUvqWMValLmha6lr4kD8iAMK1HzV0/aKnCtWb9v9641TnP/MFb7Pc2bxoxQjTXAErryXVgUOfv2YqNllqGeg==}

  tinyexec@0.3.2:
    resolution: {integrity: sha512-KQQR9yN7R5+OSwaK0XQoj22pwHoTlgYqmUscPYoknOoWCWfj/5/ABTMRi69FrKU5ffPVh5QcFikpWJI/P1ocHA==}

  tinyglobby@0.2.14:
    resolution: {integrity: sha512-tX5e7OM1HnYr2+a2C/4V0htOcSQcoSTH9KgJnVvNm5zm/cyEWKJ7j7YutsH9CxMdtOkkLFy2AHrMci9IM8IPZQ==}
    engines: {node: '>=12.0.0'}

  tinypool@1.1.1:
    resolution: {integrity: sha512-Zba82s87IFq9A9XmjiX5uZA/ARWDrB03OHlq+Vw1fSdt0I+4/Kutwy8BP4Y/y/aORMo61FQ0vIb5j44vSo5Pkg==}
    engines: {node: ^18.0.0 || >=20.0.0}

  tinyrainbow@2.0.0:
    resolution: {integrity: sha512-op4nsTR47R6p0vMUUoYl/a+ljLFVtlfaXkLQmqfLR1qHma1h/ysYk4hEXZ880bf2CYgTskvTa/e196Vd5dDQXw==}
    engines: {node: '>=14.0.0'}

  tinyspy@4.0.3:
    resolution: {integrity: sha512-t2T/WLB2WRgZ9EpE4jgPJ9w+i66UZfDc8wHh0xrwiRNN+UwH98GIJkTeZqX9rg0i0ptwzqW+uYeIF0T4F8LR7A==}
    engines: {node: '>=14.0.0'}

  tldts-core@6.1.86:
    resolution: {integrity: sha512-Je6p7pkk+KMzMv2XXKmAE3McmolOQFdxkKw0R8EYNr7sELW46JqnNeTX8ybPiQgvg1ymCoF8LXs5fzFaZvJPTA==}

  tldts@6.1.86:
    resolution: {integrity: sha512-WMi/OQ2axVTf/ykqCQgXiIct+mSQDFdH2fkwhPwgEwvJ1kSzZRiinb0zF2Xb8u4+OqPChmyI6MEu4EezNJz+FQ==}
    hasBin: true

  to-regex-range@5.0.1:
    resolution: {integrity: sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==}
    engines: {node: '>=8.0'}

  totalist@3.0.1:
    resolution: {integrity: sha512-sf4i37nQ2LBx4m3wB74y+ubopq6W/dIzXg0FDGjsYnZHVa1Da8FH853wlL2gtUhg+xJXjfk3kUZS3BRoQeoQBQ==}
    engines: {node: '>=6'}

  tough-cookie@5.1.2:
    resolution: {integrity: sha512-FVDYdxtnj0G6Qm/DhNPSb8Ju59ULcup3tuJxkFb5K8Bv2pUXILbf0xZWU8PX8Ov19OXljbUyveOFwRMwkXzO+A==}
    engines: {node: '>=16'}

  tr46@5.1.1:
    resolution: {integrity: sha512-hdF5ZgjTqgAntKkklYw0R03MG2x/bSzTtkxmIRw/sTNV8YXsCJ1tfLAX23lhxhHJlEf3CRCOCGGWw3vI3GaSPw==}
    engines: {node: '>=18'}

  ts-api-utils@2.1.0:
    resolution: {integrity: sha512-CUgTZL1irw8u29bzrOD/nH85jqyc74D6SshFgujOIA7osm2Rz7dYH77agkx7H4FBNxDq7Cjf+IjaX/8zwFW+ZQ==}
    engines: {node: '>=18.12'}
    peerDependencies:
      typescript: '>=4.8.4'

  ts-interface-checker@0.1.13:
    resolution: {integrity: sha512-Y/arvbn+rrz3JCKl9C4kVNfTfSm2/mEp5FSz5EsZSANGPSlQrpRI5M4PKF+mJnE52jOO90PnPSc3Ur3bTQw0gA==}

  tsconfig-paths@3.15.0:
    resolution: {integrity: sha512-2Ac2RgzDe/cn48GvOe3M+o82pEFewD3UPbyoUHHdKasHwJKjds4fLXWf/Ux5kATBKN20oaFGu+jbElp1pos0mg==}

  tslib@2.8.1:
    resolution: {integrity: sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w==}

  type-check@0.4.0:
    resolution: {integrity: sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==}
    engines: {node: '>= 0.8.0'}

  typed-array-buffer@1.0.3:
    resolution: {integrity: sha512-nAYYwfY3qnzX30IkA6AQZjVbtK6duGontcQm1WSG1MD94YLqK0515GNApXkoxKOWMusVssAHWLh9SeaoefYFGw==}
    engines: {node: '>= 0.4'}

  typed-array-byte-length@1.0.3:
    resolution: {integrity: sha512-BaXgOuIxz8n8pIq3e7Atg/7s+DpiYrxn4vdot3w9KbnBhcRQq6o3xemQdIfynqSeXeDrF32x+WvfzmOjPiY9lg==}
    engines: {node: '>= 0.4'}

  typed-array-byte-offset@1.0.4:
    resolution: {integrity: sha512-bTlAFB/FBYMcuX81gbL4OcpH5PmlFHqlCCpAl8AlEzMz5k53oNDvN8p1PNOWLEmI2x4orp3raOFB51tv9X+MFQ==}
    engines: {node: '>= 0.4'}

  typed-array-length@1.0.7:
    resolution: {integrity: sha512-3KS2b+kL7fsuk/eJZ7EQdnEmQoaho/r6KUef7hxvltNA5DR8NAUM+8wJMbJyZ4G9/7i3v5zPBIMN5aybAh2/Jg==}
    engines: {node: '>= 0.4'}

  typescript@5.8.3:
    resolution: {integrity: sha512-p1diW6TqL9L07nNxvRMM7hMMw4c5XOo/1ibL4aAIGmSAt9slTE1Xgw5KWuof2uTOvCg9BY7ZRi+GaF+7sfgPeQ==}
    engines: {node: '>=14.17'}
    hasBin: true

  typo-js@1.2.5:
    resolution: {integrity: sha512-F45vFWdGX8xahIk/sOp79z2NJs8ETMYsmMChm9D5Hlx3+9j7VnCyQyvij5MOCrNY3NNe8noSyokRjQRfq+Bc7A==}

  unbox-primitive@1.1.0:
    resolution: {integrity: sha512-nWJ91DjeOkej/TA8pXQ3myruKpKEYgqvpw9lz4OPHj/NWFNluYrjbz9j01CJ8yKQd2g4jFoOkINCTW2I5LEEyw==}
    engines: {node: '>= 0.4'}

  undici-types@6.21.0:
    resolution: {integrity: sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==}

  unrs-resolver@1.10.1:
    resolution: {integrity: sha512-EFrL7Hw4kmhZdwWO3dwwFJo6hO3FXuQ6Bg8BK/faHZ9m1YxqBS31BNSTxklIQkxK/4LlV8zTYnPsIRLBzTzjCA==}

  update-browserslist-db@1.1.3:
    resolution: {integrity: sha512-UxhIZQ+QInVdunkDAaiazvvT/+fXL5Osr0JZlJulepYu6Jd7qJtDZjlur0emRlT71EN3ScPoE7gvsuIKKNavKw==}
    hasBin: true
    peerDependencies:
      browserslist: '>= 4.21.0'

  uri-js@4.4.1:
    resolution: {integrity: sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==}

  use-callback-ref@1.3.3:
    resolution: {integrity: sha512-jQL3lRnocaFtu3V00JToYz/4QkNWswxijDaCVNZRiRTO3HQDLsdu1ZtmIUvV4yPp+rvWm5j0y0TG/S61cuijTg==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  use-sidecar@1.1.3:
    resolution: {integrity: sha512-Fedw0aZvkhynoPYlA5WXrMCAMm+nSWdZt6lzJQ7Ok8S6Q+VsHmHpRWndVRJ8Be0ZbkfPc5LRYH+5XrzXcEeLRQ==}
    engines: {node: '>=10'}
    peerDependencies:
      '@types/react': '*'
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc
    peerDependenciesMeta:
      '@types/react':
        optional: true

  use-sync-external-store@1.5.0:
    resolution: {integrity: sha512-Rb46I4cGGVBmjamjphe8L/UnvJD+uPPtTkNvX5mZgqdbavhI4EbgIWJiIHXJ8bc/i9EQGPRh4DwEURJ552Do0A==}
    peerDependencies:
      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0

  util-deprecate@1.0.2:
    resolution: {integrity: sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==}

  vaul@0.9.9:
    resolution: {integrity: sha512-7afKg48srluhZwIkaU+lgGtFCUsYBSGOl8vcc8N/M3YQlZFlynHD15AE+pwrYdc826o7nrIND4lL9Y6b9WWZZQ==}
    peerDependencies:
      react: ^16.8 || ^17.0 || ^18.0
      react-dom: ^16.8 || ^17.0 || ^18.0

  victory-vendor@36.9.2:
    resolution: {integrity: sha512-PnpQQMuxlwYdocC8fIJqVXvkeViHYzotI+NJrCuav0ZYFoq912ZHBk3mCeuj+5/VpodOjPe1z0Fk2ihgzlXqjQ==}

  vite-node@3.2.4:
    resolution: {integrity: sha512-EbKSKh+bh1E1IFxeO0pg1n4dvoOTt0UDiXMd/qn++r98+jPO1xtJilvXldeuQ8giIB5IkpjCgMleHMNEsGH6pg==}
    engines: {node: ^18.0.0 || ^20.0.0 || >=22.0.0}
    hasBin: true

  vite@7.0.0:
    resolution: {integrity: sha512-ixXJB1YRgDIw2OszKQS9WxGHKwLdCsbQNkpJN171udl6szi/rIySHL6/Os3s2+oE4P/FLD4dxg4mD7Wust+u5g==}
    engines: {node: ^20.19.0 || >=22.12.0}
    hasBin: true
    peerDependencies:
      '@types/node': ^20.19.0 || >=22.12.0
      jiti: '>=1.21.0'
      less: ^4.0.0
      lightningcss: ^1.21.0
      sass: ^1.70.0
      sass-embedded: ^1.70.0
      stylus: '>=0.54.8'
      sugarss: ^5.0.0
      terser: ^5.16.0
      tsx: ^4.8.1
      yaml: ^2.4.2
    peerDependenciesMeta:
      '@types/node':
        optional: true
      jiti:
        optional: true
      less:
        optional: true
      lightningcss:
        optional: true
      sass:
        optional: true
      sass-embedded:
        optional: true
      stylus:
        optional: true
      sugarss:
        optional: true
      terser:
        optional: true
      tsx:
        optional: true
      yaml:
        optional: true

  vitest@3.2.4:
    resolution: {integrity: sha512-LUCP5ev3GURDysTWiP47wRRUpLKMOfPh+yKTx3kVIEiu5KOMeqzpnYNsKyOoVrULivR8tLcks4+lga33Whn90A==}
    engines: {node: ^18.0.0 || ^20.0.0 || >=22.0.0}
    hasBin: true
    peerDependencies:
      '@edge-runtime/vm': '*'
      '@types/debug': ^4.1.12
      '@types/node': ^18.0.0 || ^20.0.0 || >=22.0.0
      '@vitest/browser': 3.2.4
      '@vitest/ui': 3.2.4
      happy-dom: '*'
      jsdom: '*'
    peerDependenciesMeta:
      '@edge-runtime/vm':
        optional: true
      '@types/debug':
        optional: true
      '@types/node':
        optional: true
      '@vitest/browser':
        optional: true
      '@vitest/ui':
        optional: true
      happy-dom:
        optional: true
      jsdom:
        optional: true

  w3c-xmlserializer@5.0.0:
    resolution: {integrity: sha512-o8qghlI8NZHU1lLPrpi2+Uq7abh4GGPpYANlalzWxyWteJOCsr/P+oPBA49TOLu5FTZO4d3F9MnWJfiMo4BkmA==}
    engines: {node: '>=18'}

  webidl-conversions@7.0.0:
    resolution: {integrity: sha512-VwddBukDzu71offAQR975unBIGqfKZpM+8ZX6ySk8nYhVoo5CYaZyzt3YBvYtRtO+aoGlqxPg/B87NGVZ/fu6g==}
    engines: {node: '>=12'}

  whatwg-encoding@3.1.1:
    resolution: {integrity: sha512-6qN4hJdMwfYBtE3YBTTHhoeuUrDBPZmbQaxWAqSALV/MeEnR5z1xd8UKud2RAkFoPkmB+hli1TZSnyi84xz1vQ==}
    engines: {node: '>=18'}

  whatwg-mimetype@4.0.0:
    resolution: {integrity: sha512-QaKxh0eNIi2mE9p2vEdzfagOKHCcj1pJ56EEHGQOVxp8r9/iszLUUV7v89x9O1p/T+NlTM5W7jW6+cz4Fq1YVg==}
    engines: {node: '>=18'}

  whatwg-url@14.2.0:
    resolution: {integrity: sha512-De72GdQZzNTUBBChsXueQUnPKDkg/5A5zp7pFDuQAj5UFoENpiACU0wlCvzpAGnTkj++ihpKwKyYewn/XNUbKw==}
    engines: {node: '>=18'}

  which-boxed-primitive@1.1.1:
    resolution: {integrity: sha512-TbX3mj8n0odCBFVlY8AxkqcHASw3L60jIuF8jFP78az3C2YhmGvqbHBpAjTRH2/xqYunrJ9g1jSyjCjpoWzIAA==}
    engines: {node: '>= 0.4'}

  which-builtin-type@1.2.1:
    resolution: {integrity: sha512-6iBczoX+kDQ7a3+YJBnh3T+KZRxM/iYNPXicqk66/Qfm1b93iu+yOImkg0zHbj5LNOcNv1TEADiZ0xa34B4q6Q==}
    engines: {node: '>= 0.4'}

  which-collection@1.0.2:
    resolution: {integrity: sha512-K4jVyjnBdgvc86Y6BkaLZEN933SwYOuBFkdmBu9ZfkcAbdVbpITnDmjvZ/aQjRXQrv5EPkTnD1s39GiiqbngCw==}
    engines: {node: '>= 0.4'}

  which-typed-array@1.1.19:
    resolution: {integrity: sha512-rEvr90Bck4WZt9HHFC4DJMsjvu7x+r6bImz0/BrbWb7A2djJ8hnZMrWnHo9F8ssv0OMErasDhftrfROTyqSDrw==}
    engines: {node: '>= 0.4'}

  which@2.0.2:
    resolution: {integrity: sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==}
    engines: {node: '>= 8'}
    hasBin: true

  why-is-node-running@2.3.0:
    resolution: {integrity: sha512-hUrmaWBdVDcxvYqnyh09zunKzROWjbZTiNy8dBEjkS7ehEDQibXJ7XvlmtbwuTclUiIyN+CyXQD4Vmko8fNm8w==}
    engines: {node: '>=8'}
    hasBin: true

  word-wrap@1.2.5:
    resolution: {integrity: sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==}
    engines: {node: '>=0.10.0'}

  wrap-ansi@7.0.0:
    resolution: {integrity: sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==}
    engines: {node: '>=10'}

  wrap-ansi@8.1.0:
    resolution: {integrity: sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==}
    engines: {node: '>=12'}

  ws@8.18.3:
    resolution: {integrity: sha512-PEIGCY5tSlUt50cqyMXfCzX+oOPqN0vuGqWzbcJ2xvnkzkq46oOpz7dQaTDBdfICb4N14+GARUDw2XV2N4tvzg==}
    engines: {node: '>=10.0.0'}
    peerDependencies:
      bufferutil: ^4.0.1
      utf-8-validate: '>=5.0.2'
    peerDependenciesMeta:
      bufferutil:
        optional: true
      utf-8-validate:
        optional: true

  xml-name-validator@5.0.0:
    resolution: {integrity: sha512-EvGK8EJ3DhaHfbRlETOWAS5pO9MZITeauHKJyb8wyajUfQUenkIg2MvLDTZ4T/TgIcm3HU0TFBgWWboAZ30UHg==}
    engines: {node: '>=18'}

  xmlchars@2.2.0:
    resolution: {integrity: sha512-JZnDKK8B0RCDw84FNdDAIpZK+JuJw+s7Lz8nksI7SIuU3UXJJslUthsi+uWBUYOwPFwW7W7PRLRfUKpxjtjFCw==}

  yallist@3.1.1:
    resolution: {integrity: sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==}

  yaml@2.8.0:
    resolution: {integrity: sha512-4lLa/EcQCB0cJkyts+FpIRx5G/llPxfP6VQU5KByHEhLxY3IJCH0f0Hy1MHI8sClTvsIb8qwRJ6R/ZdlDJ/leQ==}
    engines: {node: '>= 14.6'}
    hasBin: true

  yocto-queue@0.1.0:
    resolution: {integrity: sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==}
    engines: {node: '>=10'}

  zod@3.25.71:
    resolution: {integrity: sha512-BsBc/NPk7h8WsUWYWYL+BajcJPY8YhjelaWu2NMLuzgraKAz4Lb4/6K11g9jpuDetjMiqhZ6YaexFLOC0Ogi3Q==}

  zustand@5.0.6:
    resolution: {integrity: sha512-ihAqNeUVhe0MAD+X8M5UzqyZ9k3FFZLBTtqo6JLPwV53cbRB/mJwBI0PxcIgqhBBHlEs8G45OTDTMq3gNcLq3A==}
    engines: {node: '>=12.20.0'}
    peerDependencies:
      '@types/react': '>=18.0.0'
      immer: '>=9.0.6'
      react: '>=18.0.0'
      use-sync-external-store: '>=1.2.0'
    peerDependenciesMeta:
      '@types/react':
        optional: true
      immer:
        optional: true
      react:
        optional: true
      use-sync-external-store:
        optional: true

snapshots:

  '@adobe/css-tools@4.4.3': {}

  '@alloc/quick-lru@5.2.0': {}

  '@ampproject/remapping@2.3.0':
    dependencies:
      '@jridgewell/gen-mapping': 0.3.12
      '@jridgewell/trace-mapping': 0.3.29

  '@asamuzakjp/css-color@3.2.0':
    dependencies:
      '@csstools/css-calc': 2.1.4(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-color-parser': 3.0.10(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-parser-algorithms': 3.0.5(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-tokenizer': 3.0.4
      lru-cache: 10.4.3

  '@babel/code-frame@7.27.1':
    dependencies:
      '@babel/helper-validator-identifier': 7.27.1
      js-tokens: 4.0.0
      picocolors: 1.1.1

  '@babel/compat-data@7.28.0': {}

  '@babel/core@7.28.0':
    dependencies:
      '@ampproject/remapping': 2.3.0
      '@babel/code-frame': 7.27.1
      '@babel/generator': 7.28.0
      '@babel/helper-compilation-targets': 7.27.2
      '@babel/helper-module-transforms': 7.27.3(@babel/core@7.28.0)
      '@babel/helpers': 7.27.6
      '@babel/parser': 7.28.0
      '@babel/template': 7.27.2
      '@babel/traverse': 7.28.0
      '@babel/types': 7.28.0
      convert-source-map: 2.0.0
      debug: 4.4.1
      gensync: 1.0.0-beta.2
      json5: 2.2.3
      semver: 6.3.1
    transitivePeerDependencies:
      - supports-color

  '@babel/generator@7.28.0':
    dependencies:
      '@babel/parser': 7.28.0
      '@babel/types': 7.28.0
      '@jridgewell/gen-mapping': 0.3.12
      '@jridgewell/trace-mapping': 0.3.29
      jsesc: 3.1.0

  '@babel/helper-compilation-targets@7.27.2':
    dependencies:
      '@babel/compat-data': 7.28.0
      '@babel/helper-validator-option': 7.27.1
      browserslist: 4.25.1
      lru-cache: 5.1.1
      semver: 6.3.1

  '@babel/helper-globals@7.28.0': {}

  '@babel/helper-module-imports@7.27.1':
    dependencies:
      '@babel/traverse': 7.28.0
      '@babel/types': 7.28.0
    transitivePeerDependencies:
      - supports-color

  '@babel/helper-module-transforms@7.27.3(@babel/core@7.28.0)':
    dependencies:
      '@babel/core': 7.28.0
      '@babel/helper-module-imports': 7.27.1
      '@babel/helper-validator-identifier': 7.27.1
      '@babel/traverse': 7.28.0
    transitivePeerDependencies:
      - supports-color

  '@babel/helper-plugin-utils@7.27.1': {}

  '@babel/helper-string-parser@7.27.1': {}

  '@babel/helper-validator-identifier@7.27.1': {}

  '@babel/helper-validator-option@7.27.1': {}

  '@babel/helpers@7.27.6':
    dependencies:
      '@babel/template': 7.27.2
      '@babel/types': 7.28.0

  '@babel/parser@7.28.0':
    dependencies:
      '@babel/types': 7.28.0

  '@babel/plugin-transform-react-jsx-self@7.27.1(@babel/core@7.28.0)':
    dependencies:
      '@babel/core': 7.28.0
      '@babel/helper-plugin-utils': 7.27.1

  '@babel/plugin-transform-react-jsx-source@7.27.1(@babel/core@7.28.0)':
    dependencies:
      '@babel/core': 7.28.0
      '@babel/helper-plugin-utils': 7.27.1

  '@babel/runtime@7.27.6': {}

  '@babel/template@7.27.2':
    dependencies:
      '@babel/code-frame': 7.27.1
      '@babel/parser': 7.28.0
      '@babel/types': 7.28.0

  '@babel/traverse@7.28.0':
    dependencies:
      '@babel/code-frame': 7.27.1
      '@babel/generator': 7.28.0
      '@babel/helper-globals': 7.28.0
      '@babel/parser': 7.28.0
      '@babel/template': 7.27.2
      '@babel/types': 7.28.0
      debug: 4.4.1
    transitivePeerDependencies:
      - supports-color

  '@babel/types@7.28.0':
    dependencies:
      '@babel/helper-string-parser': 7.27.1
      '@babel/helper-validator-identifier': 7.27.1

  '@csstools/color-helpers@5.0.2': {}

  '@csstools/css-calc@2.1.4(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)':
    dependencies:
      '@csstools/css-parser-algorithms': 3.0.5(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-tokenizer': 3.0.4

  '@csstools/css-color-parser@3.0.10(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)':
    dependencies:
      '@csstools/color-helpers': 5.0.2
      '@csstools/css-calc': 2.1.4(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-parser-algorithms': 3.0.5(@csstools/css-tokenizer@3.0.4)
      '@csstools/css-tokenizer': 3.0.4

  '@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4)':
    dependencies:
      '@csstools/css-tokenizer': 3.0.4

  '@csstools/css-tokenizer@3.0.4': {}

  '@emnapi/core@1.4.3':
    dependencies:
      '@emnapi/wasi-threads': 1.0.2
      tslib: 2.8.1
    optional: true

  '@emnapi/runtime@1.4.3':
    dependencies:
      tslib: 2.8.1
    optional: true

  '@emnapi/wasi-threads@1.0.2':
    dependencies:
      tslib: 2.8.1
    optional: true

  '@esbuild/aix-ppc64@0.25.5':
    optional: true

  '@esbuild/android-arm64@0.25.5':
    optional: true

  '@esbuild/android-arm@0.25.5':
    optional: true

  '@esbuild/android-x64@0.25.5':
    optional: true

  '@esbuild/darwin-arm64@0.25.5':
    optional: true

  '@esbuild/darwin-x64@0.25.5':
    optional: true

  '@esbuild/freebsd-arm64@0.25.5':
    optional: true

  '@esbuild/freebsd-x64@0.25.5':
    optional: true

  '@esbuild/linux-arm64@0.25.5':
    optional: true

  '@esbuild/linux-arm@0.25.5':
    optional: true

  '@esbuild/linux-ia32@0.25.5':
    optional: true

  '@esbuild/linux-loong64@0.25.5':
    optional: true

  '@esbuild/linux-mips64el@0.25.5':
    optional: true

  '@esbuild/linux-ppc64@0.25.5':
    optional: true

  '@esbuild/linux-riscv64@0.25.5':
    optional: true

  '@esbuild/linux-s390x@0.25.5':
    optional: true

  '@esbuild/linux-x64@0.25.5':
    optional: true

  '@esbuild/netbsd-arm64@0.25.5':
    optional: true

  '@esbuild/netbsd-x64@0.25.5':
    optional: true

  '@esbuild/openbsd-arm64@0.25.5':
    optional: true

  '@esbuild/openbsd-x64@0.25.5':
    optional: true

  '@esbuild/sunos-x64@0.25.5':
    optional: true

  '@esbuild/win32-arm64@0.25.5':
    optional: true

  '@esbuild/win32-ia32@0.25.5':
    optional: true

  '@esbuild/win32-x64@0.25.5':
    optional: true

  '@eslint-community/eslint-utils@4.7.0(eslint@9.30.1(jiti@1.21.7))':
    dependencies:
      eslint: 9.30.1(jiti@1.21.7)
      eslint-visitor-keys: 3.4.3

  '@eslint-community/regexpp@4.12.1': {}

  '@eslint/config-array@0.21.0':
    dependencies:
      '@eslint/object-schema': 2.1.6
      debug: 4.4.1
      minimatch: 3.1.2
    transitivePeerDependencies:
      - supports-color

  '@eslint/config-helpers@0.3.0': {}

  '@eslint/core@0.14.0':
    dependencies:
      '@types/json-schema': 7.0.15

  '@eslint/core@0.15.1':
    dependencies:
      '@types/json-schema': 7.0.15

  '@eslint/eslintrc@3.3.1':
    dependencies:
      ajv: 6.12.6
      debug: 4.4.1
      espree: 10.4.0
      globals: 14.0.0
      ignore: 5.3.2
      import-fresh: 3.3.1
      js-yaml: 4.1.0
      minimatch: 3.1.2
      strip-json-comments: 3.1.1
    transitivePeerDependencies:
      - supports-color

  '@eslint/js@9.30.1': {}

  '@eslint/object-schema@2.1.6': {}

  '@eslint/plugin-kit@0.3.3':
    dependencies:
      '@eslint/core': 0.15.1
      levn: 0.4.1

  '@floating-ui/core@1.7.2':
    dependencies:
      '@floating-ui/utils': 0.2.10

  '@floating-ui/dom@1.7.2':
    dependencies:
      '@floating-ui/core': 1.7.2
      '@floating-ui/utils': 0.2.10

  '@floating-ui/react-dom@2.1.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@floating-ui/dom': 1.7.2
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  '@floating-ui/utils@0.2.10': {}

  '@hookform/resolvers@3.10.0(react-hook-form@7.59.0(react@19.1.0))':
    dependencies:
      react-hook-form: 7.59.0(react@19.1.0)

  '@humanfs/core@0.19.1': {}

  '@humanfs/node@0.16.6':
    dependencies:
      '@humanfs/core': 0.19.1
      '@humanwhocodes/retry': 0.3.1

  '@humanwhocodes/module-importer@1.0.1': {}

  '@humanwhocodes/retry@0.3.1': {}

  '@humanwhocodes/retry@0.4.3': {}

  '@img/sharp-darwin-arm64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-darwin-arm64': 1.0.4
    optional: true

  '@img/sharp-darwin-x64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-darwin-x64': 1.0.4
    optional: true

  '@img/sharp-libvips-darwin-arm64@1.0.4':
    optional: true

  '@img/sharp-libvips-darwin-x64@1.0.4':
    optional: true

  '@img/sharp-libvips-linux-arm64@1.0.4':
    optional: true

  '@img/sharp-libvips-linux-arm@1.0.5':
    optional: true

  '@img/sharp-libvips-linux-s390x@1.0.4':
    optional: true

  '@img/sharp-libvips-linux-x64@1.0.4':
    optional: true

  '@img/sharp-libvips-linuxmusl-arm64@1.0.4':
    optional: true

  '@img/sharp-libvips-linuxmusl-x64@1.0.4':
    optional: true

  '@img/sharp-linux-arm64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linux-arm64': 1.0.4
    optional: true

  '@img/sharp-linux-arm@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linux-arm': 1.0.5
    optional: true

  '@img/sharp-linux-s390x@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linux-s390x': 1.0.4
    optional: true

  '@img/sharp-linux-x64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linux-x64': 1.0.4
    optional: true

  '@img/sharp-linuxmusl-arm64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linuxmusl-arm64': 1.0.4
    optional: true

  '@img/sharp-linuxmusl-x64@0.33.5':
    optionalDependencies:
      '@img/sharp-libvips-linuxmusl-x64': 1.0.4
    optional: true

  '@img/sharp-wasm32@0.33.5':
    dependencies:
      '@emnapi/runtime': 1.4.3
    optional: true

  '@img/sharp-win32-ia32@0.33.5':
    optional: true

  '@img/sharp-win32-x64@0.33.5':
    optional: true

  '@isaacs/cliui@8.0.2':
    dependencies:
      string-width: 5.1.2
      string-width-cjs: string-width@4.2.3
      strip-ansi: 7.1.0
      strip-ansi-cjs: strip-ansi@6.0.1
      wrap-ansi: 8.1.0
      wrap-ansi-cjs: wrap-ansi@7.0.0

  '@jridgewell/gen-mapping@0.3.12':
    dependencies:
      '@jridgewell/sourcemap-codec': 1.5.4
      '@jridgewell/trace-mapping': 0.3.29

  '@jridgewell/resolve-uri@3.1.2': {}

  '@jridgewell/sourcemap-codec@1.5.4': {}

  '@jridgewell/trace-mapping@0.3.29':
    dependencies:
      '@jridgewell/resolve-uri': 3.1.2
      '@jridgewell/sourcemap-codec': 1.5.4

  '@napi-rs/wasm-runtime@0.2.11':
    dependencies:
      '@emnapi/core': 1.4.3
      '@emnapi/runtime': 1.4.3
      '@tybys/wasm-util': 0.9.0
    optional: true

  '@next/env@15.2.4': {}

  '@next/eslint-plugin-next@15.3.4':
    dependencies:
      fast-glob: 3.3.1

  '@next/swc-darwin-arm64@15.2.4':
    optional: true

  '@next/swc-darwin-x64@15.2.4':
    optional: true

  '@next/swc-linux-arm64-gnu@15.2.4':
    optional: true

  '@next/swc-linux-arm64-musl@15.2.4':
    optional: true

  '@next/swc-linux-x64-gnu@15.2.4':
    optional: true

  '@next/swc-linux-x64-musl@15.2.4':
    optional: true

  '@next/swc-win32-arm64-msvc@15.2.4':
    optional: true

  '@next/swc-win32-x64-msvc@15.2.4':
    optional: true

  '@nodelib/fs.scandir@2.1.5':
    dependencies:
      '@nodelib/fs.stat': 2.0.5
      run-parallel: 1.2.0

  '@nodelib/fs.stat@2.0.5': {}

  '@nodelib/fs.walk@1.2.8':
    dependencies:
      '@nodelib/fs.scandir': 2.1.5
      fastq: 1.19.1

  '@nolyfill/is-core-module@1.0.39': {}

  '@pkgjs/parseargs@0.11.0':
    optional: true

  '@playwright/test@1.53.2':
    dependencies:
      playwright: 1.53.2

  '@polka/url@1.0.0-next.29': {}

  '@radix-ui/number@1.1.0': {}

  '@radix-ui/primitive@1.1.1': {}

  '@radix-ui/react-accordion@1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collapsible': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-alert-dialog@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dialog': 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-arrow@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-aspect-ratio@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-avatar@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-checkbox@1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-collapsible@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-collection@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-compose-refs@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-compose-refs@1.1.2(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-context-menu@2.2.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-menu': 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-context@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-dialog@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-focus-guards': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-focus-scope': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      aria-hidden: 1.2.6
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-remove-scroll: 2.7.1(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-direction@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-dismissable-layer@1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-escape-keydown': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-dropdown-menu@2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-menu': 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-focus-guards@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-focus-scope@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-hover-card@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-id@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-id@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-label@2.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-menu@2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-focus-guards': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-focus-scope': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      aria-hidden: 1.2.6
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-remove-scroll: 2.7.1(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-menubar@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-menu': 2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-navigation-menu@1.2.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-visually-hidden': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-popover@1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-focus-guards': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-focus-scope': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      aria-hidden: 1.2.6
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-remove-scroll: 2.7.1(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-popper@1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@floating-ui/react-dom': 2.1.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-arrow': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-rect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/rect': 1.1.0
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-portal@1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-presence@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-primitive@2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-primitive@2.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-slot': 1.2.3(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-progress@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-radio-group@1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-roving-focus@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-scroll-area@1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/number': 1.1.0
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-select@2.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/number': 1.1.0
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-focus-guards': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-focus-scope': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-visually-hidden': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      aria-hidden: 1.2.6
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-remove-scroll: 2.7.1(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-separator@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-slider@1.2.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/number': 1.1.0
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-slot@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-slot@1.2.3(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-compose-refs': 1.1.2(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-switch@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-previous': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-size': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-tabs@1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-toast@1.2.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-collection': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-visually-hidden': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-toggle-group@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-direction': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-roving-focus': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-toggle': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-toggle@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-tooltip@1.1.6(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/primitive': 1.1.1
      '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-context': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-dismissable-layer': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-popper': 1.2.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-portal': 1.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-presence': 1.1.2(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-slot': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-visually-hidden': 1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/react-use-callback-ref@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-controllable-state@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-escape-keydown@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-layout-effect@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-layout-effect@1.1.1(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-previous@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-rect@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/rect': 1.1.0
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-use-size@1.1.0(@types/react@19.1.8)(react@19.1.0)':
    dependencies:
      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.1.8)(react@19.1.0)
      react: 19.1.0
    optionalDependencies:
      '@types/react': 19.1.8

  '@radix-ui/react-visually-hidden@1.1.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@radix-ui/rect@1.1.0': {}

  '@rolldown/pluginutils@1.0.0-beta.19': {}

  '@rollup/rollup-android-arm-eabi@4.44.1':
    optional: true

  '@rollup/rollup-android-arm64@4.44.1':
    optional: true

  '@rollup/rollup-darwin-arm64@4.44.1':
    optional: true

  '@rollup/rollup-darwin-x64@4.44.1':
    optional: true

  '@rollup/rollup-freebsd-arm64@4.44.1':
    optional: true

  '@rollup/rollup-freebsd-x64@4.44.1':
    optional: true

  '@rollup/rollup-linux-arm-gnueabihf@4.44.1':
    optional: true

  '@rollup/rollup-linux-arm-musleabihf@4.44.1':
    optional: true

  '@rollup/rollup-linux-arm64-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-arm64-musl@4.44.1':
    optional: true

  '@rollup/rollup-linux-loongarch64-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-powerpc64le-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-riscv64-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-riscv64-musl@4.44.1':
    optional: true

  '@rollup/rollup-linux-s390x-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-x64-gnu@4.44.1':
    optional: true

  '@rollup/rollup-linux-x64-musl@4.44.1':
    optional: true

  '@rollup/rollup-win32-arm64-msvc@4.44.1':
    optional: true

  '@rollup/rollup-win32-ia32-msvc@4.44.1':
    optional: true

  '@rollup/rollup-win32-x64-msvc@4.44.1':
    optional: true

  '@rtsao/scc@1.1.0': {}

  '@rushstack/eslint-patch@1.12.0': {}

  '@swc/counter@0.1.3': {}

  '@swc/helpers@0.5.15':
    dependencies:
      tslib: 2.8.1

  '@testing-library/dom@10.4.0':
    dependencies:
      '@babel/code-frame': 7.27.1
      '@babel/runtime': 7.27.6
      '@types/aria-query': 5.0.4
      aria-query: 5.3.0
      chalk: 4.1.2
      dom-accessibility-api: 0.5.16
      lz-string: 1.5.0
      pretty-format: 27.5.1

  '@testing-library/jest-dom@6.6.3':
    dependencies:
      '@adobe/css-tools': 4.4.3
      aria-query: 5.3.2
      chalk: 3.0.0
      css.escape: 1.5.1
      dom-accessibility-api: 0.6.3
      lodash: 4.17.21
      redent: 3.0.0

  '@testing-library/react@16.3.0(@testing-library/dom@10.4.0)(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)':
    dependencies:
      '@babel/runtime': 7.27.6
      '@testing-library/dom': 10.4.0
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8
      '@types/react-dom': 19.1.6(@types/react@19.1.8)

  '@testing-library/user-event@14.6.1(@testing-library/dom@10.4.0)':
    dependencies:
      '@testing-library/dom': 10.4.0

  '@tybys/wasm-util@0.9.0':
    dependencies:
      tslib: 2.8.1
    optional: true

  '@types/aria-query@5.0.4': {}

  '@types/babel__core@7.20.5':
    dependencies:
      '@babel/parser': 7.28.0
      '@babel/types': 7.28.0
      '@types/babel__generator': 7.27.0
      '@types/babel__template': 7.4.4
      '@types/babel__traverse': 7.20.7

  '@types/babel__generator@7.27.0':
    dependencies:
      '@babel/types': 7.28.0

  '@types/babel__template@7.4.4':
    dependencies:
      '@babel/parser': 7.28.0
      '@babel/types': 7.28.0

  '@types/babel__traverse@7.20.7':
    dependencies:
      '@babel/types': 7.28.0

  '@types/chai@5.2.2':
    dependencies:
      '@types/deep-eql': 4.0.2

  '@types/codemirror@5.60.16':
    dependencies:
      '@types/tern': 0.23.9

  '@types/d3-array@3.2.1': {}

  '@types/d3-color@3.1.3': {}

  '@types/d3-ease@3.0.2': {}

  '@types/d3-interpolate@3.0.4':
    dependencies:
      '@types/d3-color': 3.1.3

  '@types/d3-path@3.1.1': {}

  '@types/d3-scale@4.0.9':
    dependencies:
      '@types/d3-time': 3.0.4

  '@types/d3-shape@3.1.7':
    dependencies:
      '@types/d3-path': 3.1.1

  '@types/d3-time@3.0.4': {}

  '@types/d3-timer@3.0.2': {}

  '@types/deep-eql@4.0.2': {}

  '@types/estree@1.0.8': {}

  '@types/json-schema@7.0.15': {}

  '@types/json5@0.0.29': {}

  '@types/marked@4.3.2': {}

  '@types/node@22.16.0':
    dependencies:
      undici-types: 6.21.0

  '@types/react-dom@19.1.6(@types/react@19.1.8)':
    dependencies:
      '@types/react': 19.1.8

  '@types/react@19.1.8':
    dependencies:
      csstype: 3.1.3

  '@types/tern@0.23.9':
    dependencies:
      '@types/estree': 1.0.8

  '@typescript-eslint/eslint-plugin@8.35.1(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)':
    dependencies:
      '@eslint-community/regexpp': 4.12.1
      '@typescript-eslint/parser': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      '@typescript-eslint/scope-manager': 8.35.1
      '@typescript-eslint/type-utils': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      '@typescript-eslint/utils': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      '@typescript-eslint/visitor-keys': 8.35.1
      eslint: 9.30.1(jiti@1.21.7)
      graphemer: 1.4.0
      ignore: 7.0.5
      natural-compare: 1.4.0
      ts-api-utils: 2.1.0(typescript@5.8.3)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)':
    dependencies:
      '@typescript-eslint/scope-manager': 8.35.1
      '@typescript-eslint/types': 8.35.1
      '@typescript-eslint/typescript-estree': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/visitor-keys': 8.35.1
      debug: 4.4.1
      eslint: 9.30.1(jiti@1.21.7)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/project-service@8.35.1(typescript@5.8.3)':
    dependencies:
      '@typescript-eslint/tsconfig-utils': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/types': 8.35.1
      debug: 4.4.1
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/scope-manager@8.35.1':
    dependencies:
      '@typescript-eslint/types': 8.35.1
      '@typescript-eslint/visitor-keys': 8.35.1

  '@typescript-eslint/tsconfig-utils@8.35.1(typescript@5.8.3)':
    dependencies:
      typescript: 5.8.3

  '@typescript-eslint/type-utils@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)':
    dependencies:
      '@typescript-eslint/typescript-estree': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/utils': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      debug: 4.4.1
      eslint: 9.30.1(jiti@1.21.7)
      ts-api-utils: 2.1.0(typescript@5.8.3)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/types@8.35.1': {}

  '@typescript-eslint/typescript-estree@8.35.1(typescript@5.8.3)':
    dependencies:
      '@typescript-eslint/project-service': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/tsconfig-utils': 8.35.1(typescript@5.8.3)
      '@typescript-eslint/types': 8.35.1
      '@typescript-eslint/visitor-keys': 8.35.1
      debug: 4.4.1
      fast-glob: 3.3.3
      is-glob: 4.0.3
      minimatch: 9.0.5
      semver: 7.7.2
      ts-api-utils: 2.1.0(typescript@5.8.3)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/utils@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)':
    dependencies:
      '@eslint-community/eslint-utils': 4.7.0(eslint@9.30.1(jiti@1.21.7))
      '@typescript-eslint/scope-manager': 8.35.1
      '@typescript-eslint/types': 8.35.1
      '@typescript-eslint/typescript-estree': 8.35.1(typescript@5.8.3)
      eslint: 9.30.1(jiti@1.21.7)
      typescript: 5.8.3
    transitivePeerDependencies:
      - supports-color

  '@typescript-eslint/visitor-keys@8.35.1':
    dependencies:
      '@typescript-eslint/types': 8.35.1
      eslint-visitor-keys: 4.2.1

  '@unrs/resolver-binding-android-arm-eabi@1.10.1':
    optional: true

  '@unrs/resolver-binding-android-arm64@1.10.1':
    optional: true

  '@unrs/resolver-binding-darwin-arm64@1.10.1':
    optional: true

  '@unrs/resolver-binding-darwin-x64@1.10.1':
    optional: true

  '@unrs/resolver-binding-freebsd-x64@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-arm-gnueabihf@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-arm-musleabihf@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-arm64-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-arm64-musl@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-ppc64-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-riscv64-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-riscv64-musl@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-s390x-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-x64-gnu@1.10.1':
    optional: true

  '@unrs/resolver-binding-linux-x64-musl@1.10.1':
    optional: true

  '@unrs/resolver-binding-wasm32-wasi@1.10.1':
    dependencies:
      '@napi-rs/wasm-runtime': 0.2.11
    optional: true

  '@unrs/resolver-binding-win32-arm64-msvc@1.10.1':
    optional: true

  '@unrs/resolver-binding-win32-ia32-msvc@1.10.1':
    optional: true

  '@unrs/resolver-binding-win32-x64-msvc@1.10.1':
    optional: true

  '@vitejs/plugin-react@4.6.0(vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0))':
    dependencies:
      '@babel/core': 7.28.0
      '@babel/plugin-transform-react-jsx-self': 7.27.1(@babel/core@7.28.0)
      '@babel/plugin-transform-react-jsx-source': 7.27.1(@babel/core@7.28.0)
      '@rolldown/pluginutils': 1.0.0-beta.19
      '@types/babel__core': 7.20.5
      react-refresh: 0.17.0
      vite: 7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)
    transitivePeerDependencies:
      - supports-color

  '@vitest/expect@3.2.4':
    dependencies:
      '@types/chai': 5.2.2
      '@vitest/spy': 3.2.4
      '@vitest/utils': 3.2.4
      chai: 5.2.0
      tinyrainbow: 2.0.0

  '@vitest/mocker@3.2.4(vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0))':
    dependencies:
      '@vitest/spy': 3.2.4
      estree-walker: 3.0.3
      magic-string: 0.30.17
    optionalDependencies:
      vite: 7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)

  '@vitest/pretty-format@3.2.4':
    dependencies:
      tinyrainbow: 2.0.0

  '@vitest/runner@3.2.4':
    dependencies:
      '@vitest/utils': 3.2.4
      pathe: 2.0.3
      strip-literal: 3.0.0

  '@vitest/snapshot@3.2.4':
    dependencies:
      '@vitest/pretty-format': 3.2.4
      magic-string: 0.30.17
      pathe: 2.0.3

  '@vitest/spy@3.2.4':
    dependencies:
      tinyspy: 4.0.3

  '@vitest/ui@3.2.4(vitest@3.2.4)':
    dependencies:
      '@vitest/utils': 3.2.4
      fflate: 0.8.2
      flatted: 3.3.3
      pathe: 2.0.3
      sirv: 3.0.1
      tinyglobby: 0.2.14
      tinyrainbow: 2.0.0
      vitest: 3.2.4(@types/node@22.16.0)(@vitest/ui@3.2.4)(jiti@1.21.7)(jsdom@26.1.0)(yaml@2.8.0)

  '@vitest/utils@3.2.4':
    dependencies:
      '@vitest/pretty-format': 3.2.4
      loupe: 3.1.4
      tinyrainbow: 2.0.0

  acorn-jsx@5.3.2(acorn@8.15.0):
    dependencies:
      acorn: 8.15.0

  acorn@8.15.0: {}

  agent-base@7.1.3: {}

  ajv@6.12.6:
    dependencies:
      fast-deep-equal: 3.1.3
      fast-json-stable-stringify: 2.1.0
      json-schema-traverse: 0.4.1
      uri-js: 4.4.1

  ansi-regex@5.0.1: {}

  ansi-regex@6.1.0: {}

  ansi-styles@4.3.0:
    dependencies:
      color-convert: 2.0.1

  ansi-styles@5.2.0: {}

  ansi-styles@6.2.1: {}

  any-promise@1.3.0: {}

  anymatch@3.1.3:
    dependencies:
      normalize-path: 3.0.0
      picomatch: 2.3.1

  arg@5.0.2: {}

  argparse@2.0.1: {}

  aria-hidden@1.2.6:
    dependencies:
      tslib: 2.8.1

  aria-query@5.3.0:
    dependencies:
      dequal: 2.0.3

  aria-query@5.3.2: {}

  array-buffer-byte-length@1.0.2:
    dependencies:
      call-bound: 1.0.4
      is-array-buffer: 3.0.5

  array-includes@3.1.9:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-object-atoms: 1.1.1
      get-intrinsic: 1.3.0
      is-string: 1.1.1
      math-intrinsics: 1.1.0

  array.prototype.findlast@1.2.5:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      es-shim-unscopables: 1.1.0

  array.prototype.findlastindex@1.2.6:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      es-shim-unscopables: 1.1.0

  array.prototype.flat@1.3.3:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-shim-unscopables: 1.1.0

  array.prototype.flatmap@1.3.3:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-shim-unscopables: 1.1.0

  array.prototype.tosorted@1.1.4:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-shim-unscopables: 1.1.0

  arraybuffer.prototype.slice@1.0.4:
    dependencies:
      array-buffer-byte-length: 1.0.2
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      get-intrinsic: 1.3.0
      is-array-buffer: 3.0.5

  assertion-error@2.0.1: {}

  ast-types-flow@0.0.8: {}

  async-function@1.0.0: {}

  asynckit@0.4.0: {}

  autoprefixer@10.4.21(postcss@8.5.6):
    dependencies:
      browserslist: 4.25.1
      caniuse-lite: 1.0.30001726
      fraction.js: 4.3.7
      normalize-range: 0.1.2
      picocolors: 1.1.1
      postcss: 8.5.6
      postcss-value-parser: 4.2.0

  available-typed-arrays@1.0.7:
    dependencies:
      possible-typed-array-names: 1.1.0

  axe-core@4.10.3: {}

  axios@1.10.0:
    dependencies:
      follow-redirects: 1.15.9
      form-data: 4.0.3
      proxy-from-env: 1.1.0
    transitivePeerDependencies:
      - debug

  axobject-query@4.1.0: {}

  balanced-match@1.0.2: {}

  binary-extensions@2.3.0: {}

  brace-expansion@1.1.12:
    dependencies:
      balanced-match: 1.0.2
      concat-map: 0.0.1

  brace-expansion@2.0.2:
    dependencies:
      balanced-match: 1.0.2

  braces@3.0.3:
    dependencies:
      fill-range: 7.1.1

  browserslist@4.25.1:
    dependencies:
      caniuse-lite: 1.0.30001726
      electron-to-chromium: 1.5.179
      node-releases: 2.0.19
      update-browserslist-db: 1.1.3(browserslist@4.25.1)

  busboy@1.6.0:
    dependencies:
      streamsearch: 1.1.0

  cac@6.7.14: {}

  call-bind-apply-helpers@1.0.2:
    dependencies:
      es-errors: 1.3.0
      function-bind: 1.1.2

  call-bind@1.0.8:
    dependencies:
      call-bind-apply-helpers: 1.0.2
      es-define-property: 1.0.1
      get-intrinsic: 1.3.0
      set-function-length: 1.2.2

  call-bound@1.0.4:
    dependencies:
      call-bind-apply-helpers: 1.0.2
      get-intrinsic: 1.3.0

  callsites@3.1.0: {}

  camelcase-css@2.0.1: {}

  caniuse-lite@1.0.30001726: {}

  chai@5.2.0:
    dependencies:
      assertion-error: 2.0.1
      check-error: 2.1.1
      deep-eql: 5.0.2
      loupe: 3.1.4
      pathval: 2.0.1

  chalk@3.0.0:
    dependencies:
      ansi-styles: 4.3.0
      supports-color: 7.2.0

  chalk@4.1.2:
    dependencies:
      ansi-styles: 4.3.0
      supports-color: 7.2.0

  check-error@2.1.1: {}

  chokidar@3.6.0:
    dependencies:
      anymatch: 3.1.3
      braces: 3.0.3
      glob-parent: 5.1.2
      is-binary-path: 2.1.0
      is-glob: 4.0.3
      normalize-path: 3.0.0
      readdirp: 3.6.0
    optionalDependencies:
      fsevents: 2.3.3

  class-variance-authority@0.7.1:
    dependencies:
      clsx: 2.1.1

  client-only@0.0.1: {}

  clsx@2.1.1: {}

  cmdk@1.0.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@radix-ui/react-dialog': 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      '@radix-ui/react-id': 1.1.1(@types/react@19.1.8)(react@19.1.0)
      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      use-sync-external-store: 1.5.0(react@19.1.0)
    transitivePeerDependencies:
      - '@types/react'
      - '@types/react-dom'

  codemirror-spell-checker@1.1.2:
    dependencies:
      typo-js: 1.2.5

  codemirror@5.65.19: {}

  color-convert@2.0.1:
    dependencies:
      color-name: 1.1.4

  color-name@1.1.4: {}

  color-string@1.9.1:
    dependencies:
      color-name: 1.1.4
      simple-swizzle: 0.2.2
    optional: true

  color@4.2.3:
    dependencies:
      color-convert: 2.0.1
      color-string: 1.9.1
    optional: true

  combined-stream@1.0.8:
    dependencies:
      delayed-stream: 1.0.0

  commander@4.1.1: {}

  concat-map@0.0.1: {}

  convert-source-map@2.0.0: {}

  cross-spawn@7.0.6:
    dependencies:
      path-key: 3.1.1
      shebang-command: 2.0.0
      which: 2.0.2

  css.escape@1.5.1: {}

  cssesc@3.0.0: {}

  cssstyle@4.6.0:
    dependencies:
      '@asamuzakjp/css-color': 3.2.0
      rrweb-cssom: 0.8.0

  csstype@3.1.3: {}

  d3-array@3.2.4:
    dependencies:
      internmap: 2.0.3

  d3-color@3.1.0: {}

  d3-ease@3.0.1: {}

  d3-format@3.1.0: {}

  d3-interpolate@3.0.1:
    dependencies:
      d3-color: 3.1.0

  d3-path@3.1.0: {}

  d3-scale@4.0.2:
    dependencies:
      d3-array: 3.2.4
      d3-format: 3.1.0
      d3-interpolate: 3.0.1
      d3-time: 3.1.0
      d3-time-format: 4.1.0

  d3-shape@3.2.0:
    dependencies:
      d3-path: 3.1.0

  d3-time-format@4.1.0:
    dependencies:
      d3-time: 3.1.0

  d3-time@3.1.0:
    dependencies:
      d3-array: 3.2.4

  d3-timer@3.0.1: {}

  damerau-levenshtein@1.0.8: {}

  data-urls@5.0.0:
    dependencies:
      whatwg-mimetype: 4.0.0
      whatwg-url: 14.2.0

  data-view-buffer@1.0.2:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-data-view: 1.0.2

  data-view-byte-length@1.0.2:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-data-view: 1.0.2

  data-view-byte-offset@1.0.1:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-data-view: 1.0.2

  date-fns@4.1.0: {}

  debug@3.2.7:
    dependencies:
      ms: 2.1.3

  debug@4.4.1:
    dependencies:
      ms: 2.1.3

  decimal.js-light@2.5.1: {}

  decimal.js@10.5.0: {}

  deep-eql@5.0.2: {}

  deep-is@0.1.4: {}

  define-data-property@1.1.4:
    dependencies:
      es-define-property: 1.0.1
      es-errors: 1.3.0
      gopd: 1.2.0

  define-properties@1.2.1:
    dependencies:
      define-data-property: 1.1.4
      has-property-descriptors: 1.0.2
      object-keys: 1.1.1

  delayed-stream@1.0.0: {}

  dequal@2.0.3: {}

  detect-libc@2.0.4:
    optional: true

  detect-node-es@1.1.0: {}

  didyoumean@1.2.2: {}

  dlv@1.1.3: {}

  doctrine@2.1.0:
    dependencies:
      esutils: 2.0.3

  dom-accessibility-api@0.5.16: {}

  dom-accessibility-api@0.6.3: {}

  dom-helpers@5.2.1:
    dependencies:
      '@babel/runtime': 7.27.6
      csstype: 3.1.3

  dunder-proto@1.0.1:
    dependencies:
      call-bind-apply-helpers: 1.0.2
      es-errors: 1.3.0
      gopd: 1.2.0

  eastasianwidth@0.2.0: {}

  easymde@2.20.0:
    dependencies:
      '@types/codemirror': 5.60.16
      '@types/marked': 4.3.2
      codemirror: 5.65.19
      codemirror-spell-checker: 1.1.2
      marked: 4.3.0

  electron-to-chromium@1.5.179: {}

  embla-carousel-react@8.5.1(react@19.1.0):
    dependencies:
      embla-carousel: 8.5.1
      embla-carousel-reactive-utils: 8.5.1(embla-carousel@8.5.1)
      react: 19.1.0

  embla-carousel-reactive-utils@8.5.1(embla-carousel@8.5.1):
    dependencies:
      embla-carousel: 8.5.1

  embla-carousel@8.5.1: {}

  emoji-regex@8.0.0: {}

  emoji-regex@9.2.2: {}

  entities@6.0.1: {}

  es-abstract@1.24.0:
    dependencies:
      array-buffer-byte-length: 1.0.2
      arraybuffer.prototype.slice: 1.0.4
      available-typed-arrays: 1.0.7
      call-bind: 1.0.8
      call-bound: 1.0.4
      data-view-buffer: 1.0.2
      data-view-byte-length: 1.0.2
      data-view-byte-offset: 1.0.1
      es-define-property: 1.0.1
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      es-set-tostringtag: 2.1.0
      es-to-primitive: 1.3.0
      function.prototype.name: 1.1.8
      get-intrinsic: 1.3.0
      get-proto: 1.0.1
      get-symbol-description: 1.1.0
      globalthis: 1.0.4
      gopd: 1.2.0
      has-property-descriptors: 1.0.2
      has-proto: 1.2.0
      has-symbols: 1.1.0
      hasown: 2.0.2
      internal-slot: 1.1.0
      is-array-buffer: 3.0.5
      is-callable: 1.2.7
      is-data-view: 1.0.2
      is-negative-zero: 2.0.3
      is-regex: 1.2.1
      is-set: 2.0.3
      is-shared-array-buffer: 1.0.4
      is-string: 1.1.1
      is-typed-array: 1.1.15
      is-weakref: 1.1.1
      math-intrinsics: 1.1.0
      object-inspect: 1.13.4
      object-keys: 1.1.1
      object.assign: 4.1.7
      own-keys: 1.0.1
      regexp.prototype.flags: 1.5.4
      safe-array-concat: 1.1.3
      safe-push-apply: 1.0.0
      safe-regex-test: 1.1.0
      set-proto: 1.0.0
      stop-iteration-iterator: 1.1.0
      string.prototype.trim: 1.2.10
      string.prototype.trimend: 1.0.9
      string.prototype.trimstart: 1.0.8
      typed-array-buffer: 1.0.3
      typed-array-byte-length: 1.0.3
      typed-array-byte-offset: 1.0.4
      typed-array-length: 1.0.7
      unbox-primitive: 1.1.0
      which-typed-array: 1.1.19

  es-define-property@1.0.1: {}

  es-errors@1.3.0: {}

  es-iterator-helpers@1.2.1:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-set-tostringtag: 2.1.0
      function-bind: 1.1.2
      get-intrinsic: 1.3.0
      globalthis: 1.0.4
      gopd: 1.2.0
      has-property-descriptors: 1.0.2
      has-proto: 1.2.0
      has-symbols: 1.1.0
      internal-slot: 1.1.0
      iterator.prototype: 1.1.5
      safe-array-concat: 1.1.3

  es-module-lexer@1.7.0: {}

  es-object-atoms@1.1.1:
    dependencies:
      es-errors: 1.3.0

  es-set-tostringtag@2.1.0:
    dependencies:
      es-errors: 1.3.0
      get-intrinsic: 1.3.0
      has-tostringtag: 1.0.2
      hasown: 2.0.2

  es-shim-unscopables@1.1.0:
    dependencies:
      hasown: 2.0.2

  es-to-primitive@1.3.0:
    dependencies:
      is-callable: 1.2.7
      is-date-object: 1.1.0
      is-symbol: 1.1.1

  esbuild@0.25.5:
    optionalDependencies:
      '@esbuild/aix-ppc64': 0.25.5
      '@esbuild/android-arm': 0.25.5
      '@esbuild/android-arm64': 0.25.5
      '@esbuild/android-x64': 0.25.5
      '@esbuild/darwin-arm64': 0.25.5
      '@esbuild/darwin-x64': 0.25.5
      '@esbuild/freebsd-arm64': 0.25.5
      '@esbuild/freebsd-x64': 0.25.5
      '@esbuild/linux-arm': 0.25.5
      '@esbuild/linux-arm64': 0.25.5
      '@esbuild/linux-ia32': 0.25.5
      '@esbuild/linux-loong64': 0.25.5
      '@esbuild/linux-mips64el': 0.25.5
      '@esbuild/linux-ppc64': 0.25.5
      '@esbuild/linux-riscv64': 0.25.5
      '@esbuild/linux-s390x': 0.25.5
      '@esbuild/linux-x64': 0.25.5
      '@esbuild/netbsd-arm64': 0.25.5
      '@esbuild/netbsd-x64': 0.25.5
      '@esbuild/openbsd-arm64': 0.25.5
      '@esbuild/openbsd-x64': 0.25.5
      '@esbuild/sunos-x64': 0.25.5
      '@esbuild/win32-arm64': 0.25.5
      '@esbuild/win32-ia32': 0.25.5
      '@esbuild/win32-x64': 0.25.5

  escalade@3.2.0: {}

  escape-string-regexp@4.0.0: {}

  eslint-config-next@15.3.4(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3):
    dependencies:
      '@next/eslint-plugin-next': 15.3.4
      '@rushstack/eslint-patch': 1.12.0
      '@typescript-eslint/eslint-plugin': 8.35.1(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      '@typescript-eslint/parser': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      eslint: 9.30.1(jiti@1.21.7)
      eslint-import-resolver-node: 0.3.9
      eslint-import-resolver-typescript: 3.10.1(eslint-plugin-import@2.32.0)(eslint@9.30.1(jiti@1.21.7))
      eslint-plugin-import: 2.32.0(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7))
      eslint-plugin-jsx-a11y: 6.10.2(eslint@9.30.1(jiti@1.21.7))
      eslint-plugin-react: 7.37.5(eslint@9.30.1(jiti@1.21.7))
      eslint-plugin-react-hooks: 5.2.0(eslint@9.30.1(jiti@1.21.7))
    optionalDependencies:
      typescript: 5.8.3
    transitivePeerDependencies:
      - eslint-import-resolver-webpack
      - eslint-plugin-import-x
      - supports-color

  eslint-import-resolver-node@0.3.9:
    dependencies:
      debug: 3.2.7
      is-core-module: 2.16.1
      resolve: 1.22.10
    transitivePeerDependencies:
      - supports-color

  eslint-import-resolver-typescript@3.10.1(eslint-plugin-import@2.32.0)(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      '@nolyfill/is-core-module': 1.0.39
      debug: 4.4.1
      eslint: 9.30.1(jiti@1.21.7)
      get-tsconfig: 4.10.1
      is-bun-module: 2.0.0
      stable-hash: 0.0.5
      tinyglobby: 0.2.14
      unrs-resolver: 1.10.1
    optionalDependencies:
      eslint-plugin-import: 2.32.0(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7))
    transitivePeerDependencies:
      - supports-color

  eslint-module-utils@2.12.1(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-node@0.3.9)(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      debug: 3.2.7
    optionalDependencies:
      '@typescript-eslint/parser': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
      eslint: 9.30.1(jiti@1.21.7)
      eslint-import-resolver-node: 0.3.9
      eslint-import-resolver-typescript: 3.10.1(eslint-plugin-import@2.32.0)(eslint@9.30.1(jiti@1.21.7))
    transitivePeerDependencies:
      - supports-color

  eslint-plugin-import@2.32.0(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      '@rtsao/scc': 1.1.0
      array-includes: 3.1.9
      array.prototype.findlastindex: 1.2.6
      array.prototype.flat: 1.3.3
      array.prototype.flatmap: 1.3.3
      debug: 3.2.7
      doctrine: 2.1.0
      eslint: 9.30.1(jiti@1.21.7)
      eslint-import-resolver-node: 0.3.9
      eslint-module-utils: 2.12.1(@typescript-eslint/parser@8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3))(eslint-import-resolver-node@0.3.9)(eslint-import-resolver-typescript@3.10.1)(eslint@9.30.1(jiti@1.21.7))
      hasown: 2.0.2
      is-core-module: 2.16.1
      is-glob: 4.0.3
      minimatch: 3.1.2
      object.fromentries: 2.0.8
      object.groupby: 1.0.3
      object.values: 1.2.1
      semver: 6.3.1
      string.prototype.trimend: 1.0.9
      tsconfig-paths: 3.15.0
    optionalDependencies:
      '@typescript-eslint/parser': 8.35.1(eslint@9.30.1(jiti@1.21.7))(typescript@5.8.3)
    transitivePeerDependencies:
      - eslint-import-resolver-typescript
      - eslint-import-resolver-webpack
      - supports-color

  eslint-plugin-jsx-a11y@6.10.2(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      aria-query: 5.3.2
      array-includes: 3.1.9
      array.prototype.flatmap: 1.3.3
      ast-types-flow: 0.0.8
      axe-core: 4.10.3
      axobject-query: 4.1.0
      damerau-levenshtein: 1.0.8
      emoji-regex: 9.2.2
      eslint: 9.30.1(jiti@1.21.7)
      hasown: 2.0.2
      jsx-ast-utils: 3.3.5
      language-tags: 1.0.9
      minimatch: 3.1.2
      object.fromentries: 2.0.8
      safe-regex-test: 1.1.0
      string.prototype.includes: 2.0.1

  eslint-plugin-react-hooks@5.2.0(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      eslint: 9.30.1(jiti@1.21.7)

  eslint-plugin-react@7.37.5(eslint@9.30.1(jiti@1.21.7)):
    dependencies:
      array-includes: 3.1.9
      array.prototype.findlast: 1.2.5
      array.prototype.flatmap: 1.3.3
      array.prototype.tosorted: 1.1.4
      doctrine: 2.1.0
      es-iterator-helpers: 1.2.1
      eslint: 9.30.1(jiti@1.21.7)
      estraverse: 5.3.0
      hasown: 2.0.2
      jsx-ast-utils: 3.3.5
      minimatch: 3.1.2
      object.entries: 1.1.9
      object.fromentries: 2.0.8
      object.values: 1.2.1
      prop-types: 15.8.1
      resolve: 2.0.0-next.5
      semver: 6.3.1
      string.prototype.matchall: 4.0.12
      string.prototype.repeat: 1.0.0

  eslint-scope@8.4.0:
    dependencies:
      esrecurse: 4.3.0
      estraverse: 5.3.0

  eslint-visitor-keys@3.4.3: {}

  eslint-visitor-keys@4.2.1: {}

  eslint@9.30.1(jiti@1.21.7):
    dependencies:
      '@eslint-community/eslint-utils': 4.7.0(eslint@9.30.1(jiti@1.21.7))
      '@eslint-community/regexpp': 4.12.1
      '@eslint/config-array': 0.21.0
      '@eslint/config-helpers': 0.3.0
      '@eslint/core': 0.14.0
      '@eslint/eslintrc': 3.3.1
      '@eslint/js': 9.30.1
      '@eslint/plugin-kit': 0.3.3
      '@humanfs/node': 0.16.6
      '@humanwhocodes/module-importer': 1.0.1
      '@humanwhocodes/retry': 0.4.3
      '@types/estree': 1.0.8
      '@types/json-schema': 7.0.15
      ajv: 6.12.6
      chalk: 4.1.2
      cross-spawn: 7.0.6
      debug: 4.4.1
      escape-string-regexp: 4.0.0
      eslint-scope: 8.4.0
      eslint-visitor-keys: 4.2.1
      espree: 10.4.0
      esquery: 1.6.0
      esutils: 2.0.3
      fast-deep-equal: 3.1.3
      file-entry-cache: 8.0.0
      find-up: 5.0.0
      glob-parent: 6.0.2
      ignore: 5.3.2
      imurmurhash: 0.1.4
      is-glob: 4.0.3
      json-stable-stringify-without-jsonify: 1.0.1
      lodash.merge: 4.6.2
      minimatch: 3.1.2
      natural-compare: 1.4.0
      optionator: 0.9.4
    optionalDependencies:
      jiti: 1.21.7
    transitivePeerDependencies:
      - supports-color

  espree@10.4.0:
    dependencies:
      acorn: 8.15.0
      acorn-jsx: 5.3.2(acorn@8.15.0)
      eslint-visitor-keys: 4.2.1

  esquery@1.6.0:
    dependencies:
      estraverse: 5.3.0

  esrecurse@4.3.0:
    dependencies:
      estraverse: 5.3.0

  estraverse@5.3.0: {}

  estree-walker@3.0.3:
    dependencies:
      '@types/estree': 1.0.8

  esutils@2.0.3: {}

  eventemitter3@4.0.7: {}

  expect-type@1.2.1: {}

  fast-deep-equal@3.1.3: {}

  fast-equals@5.2.2: {}

  fast-glob@3.3.1:
    dependencies:
      '@nodelib/fs.stat': 2.0.5
      '@nodelib/fs.walk': 1.2.8
      glob-parent: 5.1.2
      merge2: 1.4.1
      micromatch: 4.0.8

  fast-glob@3.3.3:
    dependencies:
      '@nodelib/fs.stat': 2.0.5
      '@nodelib/fs.walk': 1.2.8
      glob-parent: 5.1.2
      merge2: 1.4.1
      micromatch: 4.0.8

  fast-json-stable-stringify@2.1.0: {}

  fast-levenshtein@2.0.6: {}

  fastq@1.19.1:
    dependencies:
      reusify: 1.1.0

  fdir@6.4.6(picomatch@4.0.2):
    optionalDependencies:
      picomatch: 4.0.2

  fflate@0.8.2: {}

  file-entry-cache@8.0.0:
    dependencies:
      flat-cache: 4.0.1

  fill-range@7.1.1:
    dependencies:
      to-regex-range: 5.0.1

  find-up@5.0.0:
    dependencies:
      locate-path: 6.0.0
      path-exists: 4.0.0

  flat-cache@4.0.1:
    dependencies:
      flatted: 3.3.3
      keyv: 4.5.4

  flatted@3.3.3: {}

  follow-redirects@1.15.9: {}

  for-each@0.3.5:
    dependencies:
      is-callable: 1.2.7

  foreground-child@3.3.1:
    dependencies:
      cross-spawn: 7.0.6
      signal-exit: 4.1.0

  form-data@4.0.3:
    dependencies:
      asynckit: 0.4.0
      combined-stream: 1.0.8
      es-set-tostringtag: 2.1.0
      hasown: 2.0.2
      mime-types: 2.1.35

  fraction.js@4.3.7: {}

  fsevents@2.3.2:
    optional: true

  fsevents@2.3.3:
    optional: true

  function-bind@1.1.2: {}

  function.prototype.name@1.1.8:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      functions-have-names: 1.2.3
      hasown: 2.0.2
      is-callable: 1.2.7

  functions-have-names@1.2.3: {}

  gensync@1.0.0-beta.2: {}

  get-intrinsic@1.3.0:
    dependencies:
      call-bind-apply-helpers: 1.0.2
      es-define-property: 1.0.1
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      function-bind: 1.1.2
      get-proto: 1.0.1
      gopd: 1.2.0
      has-symbols: 1.1.0
      hasown: 2.0.2
      math-intrinsics: 1.1.0

  get-nonce@1.0.1: {}

  get-proto@1.0.1:
    dependencies:
      dunder-proto: 1.0.1
      es-object-atoms: 1.1.1

  get-symbol-description@1.1.0:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      get-intrinsic: 1.3.0

  get-tsconfig@4.10.1:
    dependencies:
      resolve-pkg-maps: 1.0.0

  glob-parent@5.1.2:
    dependencies:
      is-glob: 4.0.3

  glob-parent@6.0.2:
    dependencies:
      is-glob: 4.0.3

  glob@10.4.5:
    dependencies:
      foreground-child: 3.3.1
      jackspeak: 3.4.3
      minimatch: 9.0.5
      minipass: 7.1.2
      package-json-from-dist: 1.0.1
      path-scurry: 1.11.1

  globals@14.0.0: {}

  globalthis@1.0.4:
    dependencies:
      define-properties: 1.2.1
      gopd: 1.2.0

  gopd@1.2.0: {}

  graphemer@1.4.0: {}

  has-bigints@1.1.0: {}

  has-flag@4.0.0: {}

  has-property-descriptors@1.0.2:
    dependencies:
      es-define-property: 1.0.1

  has-proto@1.2.0:
    dependencies:
      dunder-proto: 1.0.1

  has-symbols@1.1.0: {}

  has-tostringtag@1.0.2:
    dependencies:
      has-symbols: 1.1.0

  hasown@2.0.2:
    dependencies:
      function-bind: 1.1.2

  html-encoding-sniffer@4.0.0:
    dependencies:
      whatwg-encoding: 3.1.1

  http-proxy-agent@7.0.2:
    dependencies:
      agent-base: 7.1.3
      debug: 4.4.1
    transitivePeerDependencies:
      - supports-color

  https-proxy-agent@7.0.6:
    dependencies:
      agent-base: 7.1.3
      debug: 4.4.1
    transitivePeerDependencies:
      - supports-color

  iconv-lite@0.6.3:
    dependencies:
      safer-buffer: 2.1.2

  ignore@5.3.2: {}

  ignore@7.0.5: {}

  import-fresh@3.3.1:
    dependencies:
      parent-module: 1.0.1
      resolve-from: 4.0.0

  imurmurhash@0.1.4: {}

  indent-string@4.0.0: {}

  input-otp@1.4.1(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  internal-slot@1.1.0:
    dependencies:
      es-errors: 1.3.0
      hasown: 2.0.2
      side-channel: 1.1.0

  internmap@2.0.3: {}

  is-array-buffer@3.0.5:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      get-intrinsic: 1.3.0

  is-arrayish@0.3.2:
    optional: true

  is-async-function@2.1.1:
    dependencies:
      async-function: 1.0.0
      call-bound: 1.0.4
      get-proto: 1.0.1
      has-tostringtag: 1.0.2
      safe-regex-test: 1.1.0

  is-bigint@1.1.0:
    dependencies:
      has-bigints: 1.1.0

  is-binary-path@2.1.0:
    dependencies:
      binary-extensions: 2.3.0

  is-boolean-object@1.2.2:
    dependencies:
      call-bound: 1.0.4
      has-tostringtag: 1.0.2

  is-bun-module@2.0.0:
    dependencies:
      semver: 7.7.2

  is-callable@1.2.7: {}

  is-core-module@2.16.1:
    dependencies:
      hasown: 2.0.2

  is-data-view@1.0.2:
    dependencies:
      call-bound: 1.0.4
      get-intrinsic: 1.3.0
      is-typed-array: 1.1.15

  is-date-object@1.1.0:
    dependencies:
      call-bound: 1.0.4
      has-tostringtag: 1.0.2

  is-extglob@2.1.1: {}

  is-finalizationregistry@1.1.1:
    dependencies:
      call-bound: 1.0.4

  is-fullwidth-code-point@3.0.0: {}

  is-generator-function@1.1.0:
    dependencies:
      call-bound: 1.0.4
      get-proto: 1.0.1
      has-tostringtag: 1.0.2
      safe-regex-test: 1.1.0

  is-glob@4.0.3:
    dependencies:
      is-extglob: 2.1.1

  is-map@2.0.3: {}

  is-negative-zero@2.0.3: {}

  is-number-object@1.1.1:
    dependencies:
      call-bound: 1.0.4
      has-tostringtag: 1.0.2

  is-number@7.0.0: {}

  is-potential-custom-element-name@1.0.1: {}

  is-regex@1.2.1:
    dependencies:
      call-bound: 1.0.4
      gopd: 1.2.0
      has-tostringtag: 1.0.2
      hasown: 2.0.2

  is-set@2.0.3: {}

  is-shared-array-buffer@1.0.4:
    dependencies:
      call-bound: 1.0.4

  is-string@1.1.1:
    dependencies:
      call-bound: 1.0.4
      has-tostringtag: 1.0.2

  is-symbol@1.1.1:
    dependencies:
      call-bound: 1.0.4
      has-symbols: 1.1.0
      safe-regex-test: 1.1.0

  is-typed-array@1.1.15:
    dependencies:
      which-typed-array: 1.1.19

  is-weakmap@2.0.2: {}

  is-weakref@1.1.1:
    dependencies:
      call-bound: 1.0.4

  is-weakset@2.0.4:
    dependencies:
      call-bound: 1.0.4
      get-intrinsic: 1.3.0

  isarray@2.0.5: {}

  isexe@2.0.0: {}

  iterator.prototype@1.1.5:
    dependencies:
      define-data-property: 1.1.4
      es-object-atoms: 1.1.1
      get-intrinsic: 1.3.0
      get-proto: 1.0.1
      has-symbols: 1.1.0
      set-function-name: 2.0.2

  jackspeak@3.4.3:
    dependencies:
      '@isaacs/cliui': 8.0.2
    optionalDependencies:
      '@pkgjs/parseargs': 0.11.0

  jiti@1.21.7: {}

  js-tokens@4.0.0: {}

  js-tokens@9.0.1: {}

  js-yaml@4.1.0:
    dependencies:
      argparse: 2.0.1

  jsdom@26.1.0:
    dependencies:
      cssstyle: 4.6.0
      data-urls: 5.0.0
      decimal.js: 10.5.0
      html-encoding-sniffer: 4.0.0
      http-proxy-agent: 7.0.2
      https-proxy-agent: 7.0.6
      is-potential-custom-element-name: 1.0.1
      nwsapi: 2.2.20
      parse5: 7.3.0
      rrweb-cssom: 0.8.0
      saxes: 6.0.0
      symbol-tree: 3.2.4
      tough-cookie: 5.1.2
      w3c-xmlserializer: 5.0.0
      webidl-conversions: 7.0.0
      whatwg-encoding: 3.1.1
      whatwg-mimetype: 4.0.0
      whatwg-url: 14.2.0
      ws: 8.18.3
      xml-name-validator: 5.0.0
    transitivePeerDependencies:
      - bufferutil
      - supports-color
      - utf-8-validate

  jsesc@3.1.0: {}

  json-buffer@3.0.1: {}

  json-schema-traverse@0.4.1: {}

  json-stable-stringify-without-jsonify@1.0.1: {}

  json5@1.0.2:
    dependencies:
      minimist: 1.2.8

  json5@2.2.3: {}

  jsx-ast-utils@3.3.5:
    dependencies:
      array-includes: 3.1.9
      array.prototype.flat: 1.3.3
      object.assign: 4.1.7
      object.values: 1.2.1

  keyv@4.5.4:
    dependencies:
      json-buffer: 3.0.1

  language-subtag-registry@0.3.23: {}

  language-tags@1.0.9:
    dependencies:
      language-subtag-registry: 0.3.23

  levn@0.4.1:
    dependencies:
      prelude-ls: 1.2.1
      type-check: 0.4.0

  lilconfig@3.1.3: {}

  lines-and-columns@1.2.4: {}

  locate-path@6.0.0:
    dependencies:
      p-locate: 5.0.0

  lodash.merge@4.6.2: {}

  lodash@4.17.21: {}

  loose-envify@1.4.0:
    dependencies:
      js-tokens: 4.0.0

  loupe@3.1.4: {}

  lru-cache@10.4.3: {}

  lru-cache@5.1.1:
    dependencies:
      yallist: 3.1.1

  lucide-react@0.454.0(react@19.1.0):
    dependencies:
      react: 19.1.0

  lz-string@1.5.0: {}

  magic-string@0.30.17:
    dependencies:
      '@jridgewell/sourcemap-codec': 1.5.4

  marked@4.3.0: {}

  math-intrinsics@1.1.0: {}

  merge2@1.4.1: {}

  micromatch@4.0.8:
    dependencies:
      braces: 3.0.3
      picomatch: 2.3.1

  mime-db@1.52.0: {}

  mime-types@2.1.35:
    dependencies:
      mime-db: 1.52.0

  min-indent@1.0.1: {}

  minimatch@3.1.2:
    dependencies:
      brace-expansion: 1.1.12

  minimatch@9.0.5:
    dependencies:
      brace-expansion: 2.0.2

  minimist@1.2.8: {}

  minipass@7.1.2: {}

  mrmime@2.0.1: {}

  ms@2.1.3: {}

  mz@2.7.0:
    dependencies:
      any-promise: 1.3.0
      object-assign: 4.1.1
      thenify-all: 1.6.0

  nanoid@3.3.11: {}

  napi-postinstall@0.3.0: {}

  natural-compare@1.4.0: {}

  next-themes@0.4.6(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  next@15.2.4(@babel/core@7.28.0)(@playwright/test@1.53.2)(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@next/env': 15.2.4
      '@swc/counter': 0.1.3
      '@swc/helpers': 0.5.15
      busboy: 1.6.0
      caniuse-lite: 1.0.30001726
      postcss: 8.4.31
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      styled-jsx: 5.1.6(@babel/core@7.28.0)(react@19.1.0)
    optionalDependencies:
      '@next/swc-darwin-arm64': 15.2.4
      '@next/swc-darwin-x64': 15.2.4
      '@next/swc-linux-arm64-gnu': 15.2.4
      '@next/swc-linux-arm64-musl': 15.2.4
      '@next/swc-linux-x64-gnu': 15.2.4
      '@next/swc-linux-x64-musl': 15.2.4
      '@next/swc-win32-arm64-msvc': 15.2.4
      '@next/swc-win32-x64-msvc': 15.2.4
      '@playwright/test': 1.53.2
      sharp: 0.33.5
    transitivePeerDependencies:
      - '@babel/core'
      - babel-plugin-macros

  node-releases@2.0.19: {}

  normalize-path@3.0.0: {}

  normalize-range@0.1.2: {}

  nwsapi@2.2.20: {}

  object-assign@4.1.1: {}

  object-hash@3.0.0: {}

  object-inspect@1.13.4: {}

  object-keys@1.1.1: {}

  object.assign@4.1.7:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-object-atoms: 1.1.1
      has-symbols: 1.1.0
      object-keys: 1.1.1

  object.entries@1.1.9:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-object-atoms: 1.1.1

  object.fromentries@2.0.8:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-object-atoms: 1.1.1

  object.groupby@1.0.3:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0

  object.values@1.2.1:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-object-atoms: 1.1.1

  optionator@0.9.4:
    dependencies:
      deep-is: 0.1.4
      fast-levenshtein: 2.0.6
      levn: 0.4.1
      prelude-ls: 1.2.1
      type-check: 0.4.0
      word-wrap: 1.2.5

  own-keys@1.0.1:
    dependencies:
      get-intrinsic: 1.3.0
      object-keys: 1.1.1
      safe-push-apply: 1.0.0

  p-limit@3.1.0:
    dependencies:
      yocto-queue: 0.1.0

  p-locate@5.0.0:
    dependencies:
      p-limit: 3.1.0

  package-json-from-dist@1.0.1: {}

  parent-module@1.0.1:
    dependencies:
      callsites: 3.1.0

  parse5@7.3.0:
    dependencies:
      entities: 6.0.1

  path-exists@4.0.0: {}

  path-key@3.1.1: {}

  path-parse@1.0.7: {}

  path-scurry@1.11.1:
    dependencies:
      lru-cache: 10.4.3
      minipass: 7.1.2

  pathe@2.0.3: {}

  pathval@2.0.1: {}

  picocolors@1.1.1: {}

  picomatch@2.3.1: {}

  picomatch@4.0.2: {}

  pify@2.3.0: {}

  pirates@4.0.7: {}

  playwright-core@1.53.2: {}

  playwright@1.53.2:
    dependencies:
      playwright-core: 1.53.2
    optionalDependencies:
      fsevents: 2.3.2

  possible-typed-array-names@1.1.0: {}

  postcss-import@15.1.0(postcss@8.5.6):
    dependencies:
      postcss: 8.5.6
      postcss-value-parser: 4.2.0
      read-cache: 1.0.0
      resolve: 1.22.10

  postcss-js@4.0.1(postcss@8.5.6):
    dependencies:
      camelcase-css: 2.0.1
      postcss: 8.5.6

  postcss-load-config@4.0.2(postcss@8.5.6):
    dependencies:
      lilconfig: 3.1.3
      yaml: 2.8.0
    optionalDependencies:
      postcss: 8.5.6

  postcss-nested@6.2.0(postcss@8.5.6):
    dependencies:
      postcss: 8.5.6
      postcss-selector-parser: 6.1.2

  postcss-selector-parser@6.1.2:
    dependencies:
      cssesc: 3.0.0
      util-deprecate: 1.0.2

  postcss-value-parser@4.2.0: {}

  postcss@8.4.31:
    dependencies:
      nanoid: 3.3.11
      picocolors: 1.1.1
      source-map-js: 1.2.1

  postcss@8.5.6:
    dependencies:
      nanoid: 3.3.11
      picocolors: 1.1.1
      source-map-js: 1.2.1

  prelude-ls@1.2.1: {}

  pretty-format@27.5.1:
    dependencies:
      ansi-regex: 5.0.1
      ansi-styles: 5.2.0
      react-is: 17.0.2

  prop-types@15.8.1:
    dependencies:
      loose-envify: 1.4.0
      object-assign: 4.1.1
      react-is: 16.13.1

  proxy-from-env@1.1.0: {}

  punycode@2.3.1: {}

  queue-microtask@1.2.3: {}

  react-day-picker@8.10.1(date-fns@4.1.0)(react@19.1.0):
    dependencies:
      date-fns: 4.1.0
      react: 19.1.0

  react-dom@19.1.0(react@19.1.0):
    dependencies:
      react: 19.1.0
      scheduler: 0.26.0

  react-hook-form@7.59.0(react@19.1.0):
    dependencies:
      react: 19.1.0

  react-is@16.13.1: {}

  react-is@17.0.2: {}

  react-is@18.3.1: {}

  react-refresh@0.17.0: {}

  react-remove-scroll-bar@2.3.8(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-style-singleton: 2.2.3(@types/react@19.1.8)(react@19.1.0)
      tslib: 2.8.1
    optionalDependencies:
      '@types/react': 19.1.8

  react-remove-scroll@2.7.1(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-remove-scroll-bar: 2.3.8(@types/react@19.1.8)(react@19.1.0)
      react-style-singleton: 2.2.3(@types/react@19.1.8)(react@19.1.0)
      tslib: 2.8.1
      use-callback-ref: 1.3.3(@types/react@19.1.8)(react@19.1.0)
      use-sidecar: 1.1.3(@types/react@19.1.8)(react@19.1.0)
    optionalDependencies:
      '@types/react': 19.1.8

  react-resizable-panels@2.1.9(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  react-simplemde-editor@5.2.0(easymde@2.20.0)(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@types/codemirror': 5.60.16
      easymde: 2.20.0
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  react-smooth@4.0.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      fast-equals: 5.2.2
      prop-types: 15.8.1
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-transition-group: 4.4.5(react-dom@19.1.0(react@19.1.0))(react@19.1.0)

  react-style-singleton@2.2.3(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      get-nonce: 1.0.1
      react: 19.1.0
      tslib: 2.8.1
    optionalDependencies:
      '@types/react': 19.1.8

  react-transition-group@4.4.5(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@babel/runtime': 7.27.6
      dom-helpers: 5.2.1
      loose-envify: 1.4.0
      prop-types: 15.8.1
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  react@19.1.0: {}

  read-cache@1.0.0:
    dependencies:
      pify: 2.3.0

  readdirp@3.6.0:
    dependencies:
      picomatch: 2.3.1

  recharts-scale@0.4.5:
    dependencies:
      decimal.js-light: 2.5.1

  recharts@2.15.0(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      clsx: 2.1.1
      eventemitter3: 4.0.7
      lodash: 4.17.21
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
      react-is: 18.3.1
      react-smooth: 4.0.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      recharts-scale: 0.4.5
      tiny-invariant: 1.3.3
      victory-vendor: 36.9.2

  redent@3.0.0:
    dependencies:
      indent-string: 4.0.0
      strip-indent: 3.0.0

  reflect.getprototypeof@1.0.10:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      get-intrinsic: 1.3.0
      get-proto: 1.0.1
      which-builtin-type: 1.2.1

  regexp.prototype.flags@1.5.4:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-errors: 1.3.0
      get-proto: 1.0.1
      gopd: 1.2.0
      set-function-name: 2.0.2

  resolve-from@4.0.0: {}

  resolve-pkg-maps@1.0.0: {}

  resolve@1.22.10:
    dependencies:
      is-core-module: 2.16.1
      path-parse: 1.0.7
      supports-preserve-symlinks-flag: 1.0.0

  resolve@2.0.0-next.5:
    dependencies:
      is-core-module: 2.16.1
      path-parse: 1.0.7
      supports-preserve-symlinks-flag: 1.0.0

  reusify@1.1.0: {}

  rollup@4.44.1:
    dependencies:
      '@types/estree': 1.0.8
    optionalDependencies:
      '@rollup/rollup-android-arm-eabi': 4.44.1
      '@rollup/rollup-android-arm64': 4.44.1
      '@rollup/rollup-darwin-arm64': 4.44.1
      '@rollup/rollup-darwin-x64': 4.44.1
      '@rollup/rollup-freebsd-arm64': 4.44.1
      '@rollup/rollup-freebsd-x64': 4.44.1
      '@rollup/rollup-linux-arm-gnueabihf': 4.44.1
      '@rollup/rollup-linux-arm-musleabihf': 4.44.1
      '@rollup/rollup-linux-arm64-gnu': 4.44.1
      '@rollup/rollup-linux-arm64-musl': 4.44.1
      '@rollup/rollup-linux-loongarch64-gnu': 4.44.1
      '@rollup/rollup-linux-powerpc64le-gnu': 4.44.1
      '@rollup/rollup-linux-riscv64-gnu': 4.44.1
      '@rollup/rollup-linux-riscv64-musl': 4.44.1
      '@rollup/rollup-linux-s390x-gnu': 4.44.1
      '@rollup/rollup-linux-x64-gnu': 4.44.1
      '@rollup/rollup-linux-x64-musl': 4.44.1
      '@rollup/rollup-win32-arm64-msvc': 4.44.1
      '@rollup/rollup-win32-ia32-msvc': 4.44.1
      '@rollup/rollup-win32-x64-msvc': 4.44.1
      fsevents: 2.3.3

  rrweb-cssom@0.8.0: {}

  run-parallel@1.2.0:
    dependencies:
      queue-microtask: 1.2.3

  safe-array-concat@1.1.3:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      get-intrinsic: 1.3.0
      has-symbols: 1.1.0
      isarray: 2.0.5

  safe-push-apply@1.0.0:
    dependencies:
      es-errors: 1.3.0
      isarray: 2.0.5

  safe-regex-test@1.1.0:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-regex: 1.2.1

  safer-buffer@2.1.2: {}

  saxes@6.0.0:
    dependencies:
      xmlchars: 2.2.0

  scheduler@0.26.0: {}

  semver@6.3.1: {}

  semver@7.7.2: {}

  set-function-length@1.2.2:
    dependencies:
      define-data-property: 1.1.4
      es-errors: 1.3.0
      function-bind: 1.1.2
      get-intrinsic: 1.3.0
      gopd: 1.2.0
      has-property-descriptors: 1.0.2

  set-function-name@2.0.2:
    dependencies:
      define-data-property: 1.1.4
      es-errors: 1.3.0
      functions-have-names: 1.2.3
      has-property-descriptors: 1.0.2

  set-proto@1.0.0:
    dependencies:
      dunder-proto: 1.0.1
      es-errors: 1.3.0
      es-object-atoms: 1.1.1

  sharp@0.33.5:
    dependencies:
      color: 4.2.3
      detect-libc: 2.0.4
      semver: 7.7.2
    optionalDependencies:
      '@img/sharp-darwin-arm64': 0.33.5
      '@img/sharp-darwin-x64': 0.33.5
      '@img/sharp-libvips-darwin-arm64': 1.0.4
      '@img/sharp-libvips-darwin-x64': 1.0.4
      '@img/sharp-libvips-linux-arm': 1.0.5
      '@img/sharp-libvips-linux-arm64': 1.0.4
      '@img/sharp-libvips-linux-s390x': 1.0.4
      '@img/sharp-libvips-linux-x64': 1.0.4
      '@img/sharp-libvips-linuxmusl-arm64': 1.0.4
      '@img/sharp-libvips-linuxmusl-x64': 1.0.4
      '@img/sharp-linux-arm': 0.33.5
      '@img/sharp-linux-arm64': 0.33.5
      '@img/sharp-linux-s390x': 0.33.5
      '@img/sharp-linux-x64': 0.33.5
      '@img/sharp-linuxmusl-arm64': 0.33.5
      '@img/sharp-linuxmusl-x64': 0.33.5
      '@img/sharp-wasm32': 0.33.5
      '@img/sharp-win32-ia32': 0.33.5
      '@img/sharp-win32-x64': 0.33.5
    optional: true

  shebang-command@2.0.0:
    dependencies:
      shebang-regex: 3.0.0

  shebang-regex@3.0.0: {}

  side-channel-list@1.0.0:
    dependencies:
      es-errors: 1.3.0
      object-inspect: 1.13.4

  side-channel-map@1.0.1:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      get-intrinsic: 1.3.0
      object-inspect: 1.13.4

  side-channel-weakmap@1.0.2:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      get-intrinsic: 1.3.0
      object-inspect: 1.13.4
      side-channel-map: 1.0.1

  side-channel@1.1.0:
    dependencies:
      es-errors: 1.3.0
      object-inspect: 1.13.4
      side-channel-list: 1.0.0
      side-channel-map: 1.0.1
      side-channel-weakmap: 1.0.2

  siginfo@2.0.0: {}

  signal-exit@4.1.0: {}

  simple-swizzle@0.2.2:
    dependencies:
      is-arrayish: 0.3.2
    optional: true

  sirv@3.0.1:
    dependencies:
      '@polka/url': 1.0.0-next.29
      mrmime: 2.0.1
      totalist: 3.0.1

  sonner@1.7.4(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)

  source-map-js@1.2.1: {}

  stable-hash@0.0.5: {}

  stackback@0.0.2: {}

  std-env@3.9.0: {}

  stop-iteration-iterator@1.1.0:
    dependencies:
      es-errors: 1.3.0
      internal-slot: 1.1.0

  streamsearch@1.1.0: {}

  string-width@4.2.3:
    dependencies:
      emoji-regex: 8.0.0
      is-fullwidth-code-point: 3.0.0
      strip-ansi: 6.0.1

  string-width@5.1.2:
    dependencies:
      eastasianwidth: 0.2.0
      emoji-regex: 9.2.2
      strip-ansi: 7.1.0

  string.prototype.includes@2.0.1:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-abstract: 1.24.0

  string.prototype.matchall@4.0.12:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-errors: 1.3.0
      es-object-atoms: 1.1.1
      get-intrinsic: 1.3.0
      gopd: 1.2.0
      has-symbols: 1.1.0
      internal-slot: 1.1.0
      regexp.prototype.flags: 1.5.4
      set-function-name: 2.0.2
      side-channel: 1.1.0

  string.prototype.repeat@1.0.0:
    dependencies:
      define-properties: 1.2.1
      es-abstract: 1.24.0

  string.prototype.trim@1.2.10:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-data-property: 1.1.4
      define-properties: 1.2.1
      es-abstract: 1.24.0
      es-object-atoms: 1.1.1
      has-property-descriptors: 1.0.2

  string.prototype.trimend@1.0.9:
    dependencies:
      call-bind: 1.0.8
      call-bound: 1.0.4
      define-properties: 1.2.1
      es-object-atoms: 1.1.1

  string.prototype.trimstart@1.0.8:
    dependencies:
      call-bind: 1.0.8
      define-properties: 1.2.1
      es-object-atoms: 1.1.1

  strip-ansi@6.0.1:
    dependencies:
      ansi-regex: 5.0.1

  strip-ansi@7.1.0:
    dependencies:
      ansi-regex: 6.1.0

  strip-bom@3.0.0: {}

  strip-indent@3.0.0:
    dependencies:
      min-indent: 1.0.1

  strip-json-comments@3.1.1: {}

  strip-literal@3.0.0:
    dependencies:
      js-tokens: 9.0.1

  styled-jsx@5.1.6(@babel/core@7.28.0)(react@19.1.0):
    dependencies:
      client-only: 0.0.1
      react: 19.1.0
    optionalDependencies:
      '@babel/core': 7.28.0

  sucrase@3.35.0:
    dependencies:
      '@jridgewell/gen-mapping': 0.3.12
      commander: 4.1.1
      glob: 10.4.5
      lines-and-columns: 1.2.4
      mz: 2.7.0
      pirates: 4.0.7
      ts-interface-checker: 0.1.13

  supports-color@7.2.0:
    dependencies:
      has-flag: 4.0.0

  supports-preserve-symlinks-flag@1.0.0: {}

  symbol-tree@3.2.4: {}

  tailwind-merge@2.6.0: {}

  tailwindcss-animate@1.0.7(tailwindcss@3.4.17):
    dependencies:
      tailwindcss: 3.4.17

  tailwindcss@3.4.17:
    dependencies:
      '@alloc/quick-lru': 5.2.0
      arg: 5.0.2
      chokidar: 3.6.0
      didyoumean: 1.2.2
      dlv: 1.1.3
      fast-glob: 3.3.3
      glob-parent: 6.0.2
      is-glob: 4.0.3
      jiti: 1.21.7
      lilconfig: 3.1.3
      micromatch: 4.0.8
      normalize-path: 3.0.0
      object-hash: 3.0.0
      picocolors: 1.1.1
      postcss: 8.5.6
      postcss-import: 15.1.0(postcss@8.5.6)
      postcss-js: 4.0.1(postcss@8.5.6)
      postcss-load-config: 4.0.2(postcss@8.5.6)
      postcss-nested: 6.2.0(postcss@8.5.6)
      postcss-selector-parser: 6.1.2
      resolve: 1.22.10
      sucrase: 3.35.0
    transitivePeerDependencies:
      - ts-node

  thenify-all@1.6.0:
    dependencies:
      thenify: 3.3.1

  thenify@3.3.1:
    dependencies:
      any-promise: 1.3.0

  tiny-invariant@1.3.3: {}

  tinybench@2.9.0: {}

  tinyexec@0.3.2: {}

  tinyglobby@0.2.14:
    dependencies:
      fdir: 6.4.6(picomatch@4.0.2)
      picomatch: 4.0.2

  tinypool@1.1.1: {}

  tinyrainbow@2.0.0: {}

  tinyspy@4.0.3: {}

  tldts-core@6.1.86: {}

  tldts@6.1.86:
    dependencies:
      tldts-core: 6.1.86

  to-regex-range@5.0.1:
    dependencies:
      is-number: 7.0.0

  totalist@3.0.1: {}

  tough-cookie@5.1.2:
    dependencies:
      tldts: 6.1.86

  tr46@5.1.1:
    dependencies:
      punycode: 2.3.1

  ts-api-utils@2.1.0(typescript@5.8.3):
    dependencies:
      typescript: 5.8.3

  ts-interface-checker@0.1.13: {}

  tsconfig-paths@3.15.0:
    dependencies:
      '@types/json5': 0.0.29
      json5: 1.0.2
      minimist: 1.2.8
      strip-bom: 3.0.0

  tslib@2.8.1: {}

  type-check@0.4.0:
    dependencies:
      prelude-ls: 1.2.1

  typed-array-buffer@1.0.3:
    dependencies:
      call-bound: 1.0.4
      es-errors: 1.3.0
      is-typed-array: 1.1.15

  typed-array-byte-length@1.0.3:
    dependencies:
      call-bind: 1.0.8
      for-each: 0.3.5
      gopd: 1.2.0
      has-proto: 1.2.0
      is-typed-array: 1.1.15

  typed-array-byte-offset@1.0.4:
    dependencies:
      available-typed-arrays: 1.0.7
      call-bind: 1.0.8
      for-each: 0.3.5
      gopd: 1.2.0
      has-proto: 1.2.0
      is-typed-array: 1.1.15
      reflect.getprototypeof: 1.0.10

  typed-array-length@1.0.7:
    dependencies:
      call-bind: 1.0.8
      for-each: 0.3.5
      gopd: 1.2.0
      is-typed-array: 1.1.15
      possible-typed-array-names: 1.1.0
      reflect.getprototypeof: 1.0.10

  typescript@5.8.3: {}

  typo-js@1.2.5: {}

  unbox-primitive@1.1.0:
    dependencies:
      call-bound: 1.0.4
      has-bigints: 1.1.0
      has-symbols: 1.1.0
      which-boxed-primitive: 1.1.1

  undici-types@6.21.0: {}

  unrs-resolver@1.10.1:
    dependencies:
      napi-postinstall: 0.3.0
    optionalDependencies:
      '@unrs/resolver-binding-android-arm-eabi': 1.10.1
      '@unrs/resolver-binding-android-arm64': 1.10.1
      '@unrs/resolver-binding-darwin-arm64': 1.10.1
      '@unrs/resolver-binding-darwin-x64': 1.10.1
      '@unrs/resolver-binding-freebsd-x64': 1.10.1
      '@unrs/resolver-binding-linux-arm-gnueabihf': 1.10.1
      '@unrs/resolver-binding-linux-arm-musleabihf': 1.10.1
      '@unrs/resolver-binding-linux-arm64-gnu': 1.10.1
      '@unrs/resolver-binding-linux-arm64-musl': 1.10.1
      '@unrs/resolver-binding-linux-ppc64-gnu': 1.10.1
      '@unrs/resolver-binding-linux-riscv64-gnu': 1.10.1
      '@unrs/resolver-binding-linux-riscv64-musl': 1.10.1
      '@unrs/resolver-binding-linux-s390x-gnu': 1.10.1
      '@unrs/resolver-binding-linux-x64-gnu': 1.10.1
      '@unrs/resolver-binding-linux-x64-musl': 1.10.1
      '@unrs/resolver-binding-wasm32-wasi': 1.10.1
      '@unrs/resolver-binding-win32-arm64-msvc': 1.10.1
      '@unrs/resolver-binding-win32-ia32-msvc': 1.10.1
      '@unrs/resolver-binding-win32-x64-msvc': 1.10.1

  update-browserslist-db@1.1.3(browserslist@4.25.1):
    dependencies:
      browserslist: 4.25.1
      escalade: 3.2.0
      picocolors: 1.1.1

  uri-js@4.4.1:
    dependencies:
      punycode: 2.3.1

  use-callback-ref@1.3.3(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      react: 19.1.0
      tslib: 2.8.1
    optionalDependencies:
      '@types/react': 19.1.8

  use-sidecar@1.1.3(@types/react@19.1.8)(react@19.1.0):
    dependencies:
      detect-node-es: 1.1.0
      react: 19.1.0
      tslib: 2.8.1
    optionalDependencies:
      '@types/react': 19.1.8

  use-sync-external-store@1.5.0(react@19.1.0):
    dependencies:
      react: 19.1.0

  util-deprecate@1.0.2: {}

  vaul@0.9.9(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0):
    dependencies:
      '@radix-ui/react-dialog': 1.1.4(@types/react-dom@19.1.6(@types/react@19.1.8))(@types/react@19.1.8)(react-dom@19.1.0(react@19.1.0))(react@19.1.0)
      react: 19.1.0
      react-dom: 19.1.0(react@19.1.0)
    transitivePeerDependencies:
      - '@types/react'
      - '@types/react-dom'

  victory-vendor@36.9.2:
    dependencies:
      '@types/d3-array': 3.2.1
      '@types/d3-ease': 3.0.2
      '@types/d3-interpolate': 3.0.4
      '@types/d3-scale': 4.0.9
      '@types/d3-shape': 3.1.7
      '@types/d3-time': 3.0.4
      '@types/d3-timer': 3.0.2
      d3-array: 3.2.4
      d3-ease: 3.0.1
      d3-interpolate: 3.0.1
      d3-scale: 4.0.2
      d3-shape: 3.2.0
      d3-time: 3.1.0
      d3-timer: 3.0.1

  vite-node@3.2.4(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0):
    dependencies:
      cac: 6.7.14
      debug: 4.4.1
      es-module-lexer: 1.7.0
      pathe: 2.0.3
      vite: 7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)
    transitivePeerDependencies:
      - '@types/node'
      - jiti
      - less
      - lightningcss
      - sass
      - sass-embedded
      - stylus
      - sugarss
      - supports-color
      - terser
      - tsx
      - yaml

  vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0):
    dependencies:
      esbuild: 0.25.5
      fdir: 6.4.6(picomatch@4.0.2)
      picomatch: 4.0.2
      postcss: 8.5.6
      rollup: 4.44.1
      tinyglobby: 0.2.14
    optionalDependencies:
      '@types/node': 22.16.0
      fsevents: 2.3.3
      jiti: 1.21.7
      yaml: 2.8.0

  vitest@3.2.4(@types/node@22.16.0)(@vitest/ui@3.2.4)(jiti@1.21.7)(jsdom@26.1.0)(yaml@2.8.0):
    dependencies:
      '@types/chai': 5.2.2
      '@vitest/expect': 3.2.4
      '@vitest/mocker': 3.2.4(vite@7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0))
      '@vitest/pretty-format': 3.2.4
      '@vitest/runner': 3.2.4
      '@vitest/snapshot': 3.2.4
      '@vitest/spy': 3.2.4
      '@vitest/utils': 3.2.4
      chai: 5.2.0
      debug: 4.4.1
      expect-type: 1.2.1
      magic-string: 0.30.17
      pathe: 2.0.3
      picomatch: 4.0.2
      std-env: 3.9.0
      tinybench: 2.9.0
      tinyexec: 0.3.2
      tinyglobby: 0.2.14
      tinypool: 1.1.1
      tinyrainbow: 2.0.0
      vite: 7.0.0(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)
      vite-node: 3.2.4(@types/node@22.16.0)(jiti@1.21.7)(yaml@2.8.0)
      why-is-node-running: 2.3.0
    optionalDependencies:
      '@types/node': 22.16.0
      '@vitest/ui': 3.2.4(vitest@3.2.4)
      jsdom: 26.1.0
    transitivePeerDependencies:
      - jiti
      - less
      - lightningcss
      - msw
      - sass
      - sass-embedded
      - stylus
      - sugarss
      - supports-color
      - terser
      - tsx
      - yaml

  w3c-xmlserializer@5.0.0:
    dependencies:
      xml-name-validator: 5.0.0

  webidl-conversions@7.0.0: {}

  whatwg-encoding@3.1.1:
    dependencies:
      iconv-lite: 0.6.3

  whatwg-mimetype@4.0.0: {}

  whatwg-url@14.2.0:
    dependencies:
      tr46: 5.1.1
      webidl-conversions: 7.0.0

  which-boxed-primitive@1.1.1:
    dependencies:
      is-bigint: 1.1.0
      is-boolean-object: 1.2.2
      is-number-object: 1.1.1
      is-string: 1.1.1
      is-symbol: 1.1.1

  which-builtin-type@1.2.1:
    dependencies:
      call-bound: 1.0.4
      function.prototype.name: 1.1.8
      has-tostringtag: 1.0.2
      is-async-function: 2.1.1
      is-date-object: 1.1.0
      is-finalizationregistry: 1.1.1
      is-generator-function: 1.1.0
      is-regex: 1.2.1
      is-weakref: 1.1.1
      isarray: 2.0.5
      which-boxed-primitive: 1.1.1
      which-collection: 1.0.2
      which-typed-array: 1.1.19

  which-collection@1.0.2:
    dependencies:
      is-map: 2.0.3
      is-set: 2.0.3
      is-weakmap: 2.0.2
      is-weakset: 2.0.4

  which-typed-array@1.1.19:
    dependencies:
      available-typed-arrays: 1.0.7
      call-bind: 1.0.8
      call-bound: 1.0.4
      for-each: 0.3.5
      get-proto: 1.0.1
      gopd: 1.2.0
      has-tostringtag: 1.0.2

  which@2.0.2:
    dependencies:
      isexe: 2.0.0

  why-is-node-running@2.3.0:
    dependencies:
      siginfo: 2.0.0
      stackback: 0.0.2

  word-wrap@1.2.5: {}

  wrap-ansi@7.0.0:
    dependencies:
      ansi-styles: 4.3.0
      string-width: 4.2.3
      strip-ansi: 6.0.1

  wrap-ansi@8.1.0:
    dependencies:
      ansi-styles: 6.2.1
      string-width: 5.1.2
      strip-ansi: 7.1.0

  ws@8.18.3: {}

  xml-name-validator@5.0.0: {}

  xmlchars@2.2.0: {}

  yallist@3.1.1: {}

  yaml@2.8.0: {}

  yocto-queue@0.1.0: {}

  zod@3.25.71: {}

  zustand@5.0.6(@types/react@19.1.8)(react@19.1.0)(use-sync-external-store@1.5.0(react@19.1.0)):
    optionalDependencies:
      '@types/react': 19.1.8
      react: 19.1.0
      use-sync-external-store: 1.5.0(react@19.1.0)


# END FILE CONTENTS


# File: frontend/components/ui/checkbox.tsx

"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }


# END FILE CONTENTS


# File: frontend/components/ui/toaster.tsx

"use client"

import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}


# END FILE CONTENTS


# File: frontend/components/ui/drawer.tsx

"use client"

import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}


# END FILE CONTENTS


# File: frontend/providers/app-state-provider-wrapper.tsx

"use client"

import React from 'react'
import { AppStateProvider } from '../hooks/use-app-state-context'
import { isFeatureEnabled } from '../lib/feature-flags'

interface AppStateProviderWrapperProps {
    children: React.ReactNode
}

/**
 * AppStateProvider åŒ…è£å™¨
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šæ˜¯å¦å•Ÿç”¨æ–°çš„ç‹€æ…‹ç®¡ç†ç³»çµ±
 * é€™æä¾›äº†æ¼¸é€²å¼éƒ¨ç½²çš„èƒ½åŠ›ï¼Œå¯ä»¥å®‰å…¨åœ°åœ¨æ–°èˆŠç³»çµ±é–“åˆ‡æ›
 */
export function AppStateProviderWrapper({ children }: AppStateProviderWrapperProps) {
    // æª¢æŸ¥æ˜¯å¦å•Ÿç”¨æ–°çš„ç‹€æ…‹ç®¡ç†ç³»çµ±
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')
    const useNewAppStateHook = isFeatureEnabled('useNewAppStateHook')

    console.log('ğŸ”„ [AppStateProviderWrapper] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewStateManagement,
        useNewAppStateHook,
        willUseProvider: useNewStateManagement || useNewAppStateHook
    })

    // å¦‚æœå•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨ AppStateProvider åŒ…è£
    if (useNewStateManagement || useNewAppStateHook) {
        console.log('ğŸ”„ [AppStateProviderWrapper] å•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç† - ä½¿ç”¨ AppStateProvider')
        return (
            <AppStateProvider>
                {children}
            </AppStateProvider>
        )
    }

    // å¦å‰‡ç›´æ¥æ¸²æŸ“å­çµ„ä»¶ï¼ˆä½¿ç”¨èˆŠç³»çµ±ï¼‰
    console.log('ğŸ”„ [AppStateProviderWrapper] ä½¿ç”¨èˆŠç‹€æ…‹ç®¡ç† - ç›´æ¥æ¸²æŸ“')
    return <>{children}</>
}


# END FILE CONTENTS


# File: frontend/study-scriber.tsx

"use client"

import dynamic from "next/dynamic"
import "easymde/dist/easymde.min.css"
import { useMemo, useEffect } from "react"
import { Button } from "@/components/ui/button"
import { RotateCcw, Download } from "lucide-react"


// å‹•æ…‹åŒ¯å…¥ SimpleMDE ä»¥é¿å… SSR å•é¡Œ
// é€é .then(mod => mod.default) æ˜ç¢ºå–ç”¨ default exportï¼Œ
// ä»¥é¿å… Next.js åœ¨è™•ç† CommonJS èˆ‡ ESM æ··ç”¨æ™‚ï¼Œ
// å¯èƒ½å°‡æ•´å€‹ module ç‰©ä»¶ç•¶ä½œ React å…ƒä»¶è€Œå°è‡´ç„¡æ³•å®Œæˆè¼‰å…¥ã€‚
const SimpleMDE = dynamic(() => import("react-simplemde-editor").then(mod => mod.default), {
  ssr: false,
  loading: () => (
    <div className="h-full flex items-center justify-center text-muted-foreground">
      è¼‰å…¥ç·¨è¼¯å™¨ä¸­...
    </div>
  ),
})

import { useAppStore } from "./lib/app-store-zustand"
import { DefaultState } from "./components/default-state"
import { RecordingState } from "./components/recording-state"
import { WaitingState } from "./components/waiting-state"
import { FinishState } from "./components/finish-state"
import { ProviderContextMenu } from "./components/provider-context-menu"

export default function Component() {
  // ä½¿ç”¨ Zustand store
  const appState = useAppStore(state => state.appState)
  const isLoading = useAppStore(state => state.isLoading)
  const error = useAppStore(state => state.error)
  const session = useAppStore(state => state.session)
  const isRecording = useAppStore(state => state.isRecording)
  const recordingTime = useAppStore(state => state.recordingTime)
  const transcriptEntries = useAppStore(state => state.transcriptEntries)
  const editorContent = useAppStore(state => state.editorContent)
  const sttProvider = useAppStore(state => state.sttProvider)

  // Actions
  const startRecording = useAppStore(state => state.startRecording)
  const stopRecording = useAppStore(state => state.stopRecording)
  const updateEditorContent = useAppStore(state => state.updateEditorContent)
  const resetState = useAppStore(state => state.resetState)
  const setSttProvider = useAppStore(state => state.setSttProvider)
  // âœ… ç§»é™¤ draftTitle ç‹€æ…‹ - æ¨™é¡Œä¸å†å¿…å¡«

  // é å…ˆè¼‰å…¥ SimpleMDEï¼Œé¿å…ç¬¬ä¸€æ¬¡è¼‰å…¥æ™‚å¡åœ¨ loading
  useEffect(() => {
    if (typeof (SimpleMDE as any).preload === 'function') {
      (SimpleMDE as any).preload()
    }
  }, [])

  // ä½¿ç”¨ Zustand store - æ‰€æœ‰ç‹€æ…‹å·²åœ¨ä¸Šæ–¹å®£å‘Š

  // æª¢æŸ¥ä¸¦æ¸…ç†ç•°å¸¸çš„ localStorage ç‹€æ…‹
  useEffect(() => {
    if (typeof window !== 'undefined') {
      const appStateData = localStorage.getItem('app_state_v1')
      if (appStateData) {
        try {
          const parsedState = JSON.parse(appStateData)
          console.log("ğŸ” [StudyScriber] æª¢æŸ¥ localStorage ç‹€æ…‹:", parsedState)

          // å¦‚æœç‹€æ…‹æ˜¯ç•°å¸¸çš„éŒ„éŸ³ç‹€æ…‹ï¼Œæ¸…é™¤å®ƒ
          if (parsedState.state && ['recording_waiting', 'recording_active', 'processing'].includes(parsedState.state)) {
            console.log("ğŸ§¹ [StudyScriber] æ¸…é™¤ç•°å¸¸çš„ localStorage ç‹€æ…‹")
            localStorage.removeItem('app_state_v1')
            localStorage.removeItem('last_session')
            // åˆ·æ–°é é¢ä»¥é‡æ–°åˆå§‹åŒ–
            window.location.reload()
            return
          }
        } catch (error) {
          console.error("âŒ [StudyScriber] è§£æ localStorage å¤±æ•—:", error)
          localStorage.removeItem('app_state_v1')
          localStorage.removeItem('last_session')
        }
      }
    }
  }, [])

  // è¿½è¹¤ç‹€æ…‹æµè½‰
  console.log("[DEBUG] appState:", appState)
  console.log("[DEBUG] isRecording:", isRecording)
  if (session) {
    console.log("[DEBUG] session.status:", session.status, "session.type:", session.type)
  } else {
    console.log("[DEBUG] session: null")
  }

  // æ·»åŠ èª¿è©¦åŠŸèƒ½åˆ° window
  if (typeof window !== 'undefined') {
    // æš´éœ²å®Œæ•´ç‹€æ…‹åˆ° window.appData ä»¥ä¾¿è¨ºæ–·
    (window as any).appData = {
      state: appState,
      isRecording,
      recordingTime,
      transcriptEntries,
      editorContent,
      session,
      isLoading,
      error
    }
  }

  // æš´éœ²éŒ„éŸ³ç‹€æ…‹åˆ° window ä»¥ä¾¿èª¿è©¦
  if (typeof window !== 'undefined') {
    (window as any).recordingHook = { isRecording, recordingTime }
  }

  // æš´éœ² session åˆ° window ä»¥ä¾¿èª¿è©¦
  if (typeof window !== 'undefined') {
    (window as any).sessionHook = {
      currentSession: session,
      isLoading: isLoading,
      error: error
    }
  }

  useEffect(() => {
    console.log("ğŸ“± StudyScriber: state æ›´æ–°:", {
      state: appState,
      isRecording: isRecording,
      recordingTime: recordingTime,
      transcriptEntries: transcriptEntries,
      editorContent: editorContent,
      session: session,
      isLoading: isLoading,
      error: error,
    })
  }, [appState, isRecording, recordingTime, transcriptEntries, editorContent, session, isLoading, error])

  const editorOptions = useMemo(() => {
    return {
      spellChecker: false,
      placeholder: "Start writing your notes...",
      status: false,
      toolbar: [
        "bold",
        "italic",
        "strikethrough",
        "|",
        "heading-1",
        "heading-2",
        "heading-3",
        "|",
        "quote",
        "unordered-list",
        "ordered-list",
        "|",
        "link",
        "image",
        "table",
        "|",
        "preview",
        "side-by-side",
        "fullscreen",
      ] as const,
      autofocus: true,
      tabSize: 2,
    }
  }, [])

  const renderRightPanel = () => {
    // ç‹€æ…‹ç•°å¸¸æª¢æŸ¥ï¼šå¦‚æœæ˜¯ recording_waiting ä½†æ²’æœ‰ sessionï¼Œæ‡‰è©²é¡¯ç¤º default ç‹€æ…‹
    if (appState === "recording_waiting" && !session) {
      console.log("âš ï¸ [StudyScriber] æª¢æ¸¬åˆ°ç‹€æ…‹ç•°å¸¸: recording_waiting ä½†æ²’æœ‰ sessionï¼Œé¡¯ç¤º DefaultState")
      return <DefaultState
        onStartRecording={() => {
          console.log("ğŸ“± StudyScriber: æº–å‚™èª¿ç”¨ startRecordingï¼ˆç‹€æ…‹ä¿®å¾©ï¼‰")
          startRecording()
        }}
      />
    }

    switch (appState) {
      case "default":
        console.log("ğŸ”„ [StudyScriber] æ¸²æŸ“ DefaultStateï¼ŒstartRecording å‡½æ•¸:", typeof startRecording)
        return <DefaultState
          onStartRecording={() => {
            console.log("ğŸ“± StudyScriber: æº–å‚™èª¿ç”¨ startRecording")
            console.log("ğŸ“± StudyScriber: startRecording å‡½æ•¸é¡å‹:", typeof startRecording)
            startRecording()
          }}
        />
      case "recording_active":
        return (
          <RecordingState
            transcriptEntries={transcriptEntries}
            recordingTime={recordingTime}
            onStopRecording={stopRecording}
            error={error}
          />
        )
      case "recording_waiting":
        return (
          <RecordingState
            transcriptEntries={transcriptEntries}
            recordingTime={recordingTime}
            onStopRecording={stopRecording}
            error={error}
          />
        )
      case "processing":
        return <WaitingState />
      case "finished":
        return (
          <FinishState
            transcriptEntries={transcriptEntries}
            onExport={() => {
              // TODO: å¯¦ç¾åŒ¯å‡ºåŠŸèƒ½
              console.log('Export functionality not implemented yet')
            }}
            onToLatest={() => {
              // TODO: å¯¦ç¾æ²å‹•åˆ°æœ€æ–°åŠŸèƒ½
              console.log('To Latest functionality not implemented yet')
            }}
          />
        )
      default:
        return <DefaultState
          onStartRecording={() => {
            console.log("ğŸ“± StudyScriber: æº–å‚™èª¿ç”¨ startRecording (default)")
            startRecording()
          }}
        />
    }
  }

  return (
    <div className="h-screen bg-background flex flex-col" suppressHydrationWarning={true}>
      {/* Full Width Header - Fixed height of 80px */}
      <div className="bg-background border-b border-border px-6 flex-shrink-0 w-full h-20 flex justify-between items-center">
        <h1 className="text-2xl font-semibold text-foreground">Study Scriber</h1>

        {/* Header action buttons */}
        <div className="flex items-center gap-2">
          {/* New note æŒ‰éˆ• - åœ¨æœ‰æ´»èºæœƒè©±æˆ–éœ€è¦çš„ç‹€æ…‹ä¸‹é¡¯ç¤º */}
          {((appState === "default" && !!session) ||
            appState === "recording_waiting" ||
            appState === "recording_active" ||
            appState === "finished") && (
              <Button variant="outline" onClick={resetState} size="sm" className="px-4 h-8 flex items-center gap-2">
                <RotateCcw className="w-4 h-4" />
                New note
              </Button>
            )}

          {/* Export æŒ‰éˆ• - åªåœ¨ finished ç‹€æ…‹é¡¯ç¤º */}
          {appState === "finished" && (
            <Button onClick={() => console.log('Export functionality')} size="sm" className="px-4 h-8 flex items-center gap-2">
              <Download className="w-4 h-4" />
              Export
            </Button>
          )}

          <ProviderContextMenu
            currentProvider={sttProvider}
            onProviderChange={setSttProvider}
            disabled={appState === 'recording_active' || appState === 'processing' || appState === 'recording_waiting'}
          />
        </div>
      </div>

      {/* Main Content Area */}
      <div className="flex-1 flex overflow-hidden">
        {/* Left Panel (Editor) */}
        <div className="flex-1 border-r border-border h-full">
          <SimpleMDE
            value={editorContent}
            onChange={updateEditorContent}
            options={editorOptions}
            className="h-full"
          />
        </div>

        {/* Right Panel (Recording/Transcription) */}
        <div className="w-1/3 min-w-[400px] max-w-[500px] flex-shrink-0 h-full overflow-y-auto">
          {renderRightPanel()}
        </div>
      </div>
    </div>
  )
}


# END FILE CONTENTS


# File: frontend/components/ui/form.tsx

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}


# END FILE CONTENTS


# File: frontend/.env.example

# StudyScriber Frontend Environment Variables
# è¤‡è£½æ­¤æ–‡ä»¶ç‚º .env.local ä¸¦å¡«å…¥å¯¦éš›çš„é…ç½®å€¼

# å¾Œç«¯ API åŸºç¤ URL
NEXT_PUBLIC_API_URL=http://127.0.0.1:8000

# WebSocket åŸºç¤ URL
NEXT_PUBLIC_WS_URL=ws://127.0.0.1:8000

# é–‹ç™¼æ¨¡å¼é…ç½®
NODE_ENV=development

# éŸ³è¨Šåˆ‡ç‰‡é–“éš”é…ç½® (å½±éŸ¿å‰ç«¯éŒ„éŸ³é–“éš”ï¼Œéœ€èˆ‡å¾Œç«¯ä¿æŒä¸€è‡´)
# æ–¹æ³•ä¸€ï¼šç›´æ¥è¨­å®šæ¯«ç§’æ•¸ (å„ªå…ˆç´šè¼ƒé«˜)
# NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_MS=10000

# æ–¹æ³•äºŒï¼šè¨­å®šç§’æ•¸ (æœƒè‡ªå‹•è½‰æ›ç‚ºæ¯«ç§’)
NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_SEC=10

# å¦‚æœéƒ½æœªè¨­å®šï¼Œé è¨­ç‚º 10 ç§’ (10000ms)
# å»ºè­°å€¼ï¼š5-30ç§’ï¼Œéœ€èˆ‡å¾Œç«¯ AUDIO_CHUNK_DURATION_SEC ä¿æŒä¸€è‡´


# END FILE CONTENTS


# File: frontend/components/SessionLoadingOverlay.tsx

import React from 'react'

export default function SessionLoadingOverlay() {
    return (
        <div className="fixed inset-0 flex items-center justify-center bg-white/60 z-50">
            <div className="animate-spin rounded-full h-12 w-12 border-y-4 border-gray-400"></div>
            <p className="ml-4 text-gray-700">æº–å‚™éŒ„éŸ³æœƒè©±ä¸­â€¦</p>
        </div>
    )
}


# END FILE CONTENTS


# File: frontend/test-transcript-integration.js

 

# END FILE CONTENTS


# File: frontend/hooks/use-app-state-context.ts

"use client"

import React, { createContext, useContext, useReducer, useCallback, useEffect, useState } from "react"
import { AppStateContextValue, initialContextState } from "../types/app-state-context"
import { appStateReducer, AppStateReducerState } from "../lib/app-state-reducer"
import { InitialStateLoader } from "../lib/initial-state-loader"
import { AppState, SessionStatus, SessionType, TranscriptEntry } from "../types/app-state"
import { StateMachineManager } from '../lib/state-machine';
import { StateTransitionTrigger } from "../types/state-transitions";
import { ServiceRegistry, SERVICE_KEYS, serviceContainer } from "../lib/services";
import type { ISessionService, IRecordingService, ITranscriptService, TranscriptMessage } from "../lib/services";

const AppStateContext = createContext<AppStateContextValue | null>(null)

export function AppStateProvider({ children }: { children: React.ReactNode }) {
  const [state, dispatch] = useReducer(appStateReducer, initialContextState as AppStateReducerState)
  const [stateMachineManager, setStateMachineManager] = useState<StateMachineManager | null>(null);
  const [servicesInitialized, setServicesInitialized] = useState(false);

  // åˆå§‹åŒ–æœå‹™å±¤
  useEffect(() => {
    async function initializeServices() {
      try {
        console.log('ğŸš€ [AppStateProvider] åˆå§‹åŒ–æœå‹™å±¤...')

        // è¨»å†Šä¸¦åˆå§‹åŒ–æ‰€æœ‰æœå‹™
        await ServiceRegistry.initializeServices()

        setServicesInitialized(true)
        console.log('âœ… [AppStateProvider] æœå‹™å±¤åˆå§‹åŒ–å®Œæˆ')
      } catch (error) {
        console.error('âŒ [AppStateProvider] æœå‹™å±¤åˆå§‹åŒ–å¤±æ•—:', error)
      }
    }

    initializeServices()
  }, [])

  // è¼‰å…¥åˆå§‹ç‹€æ…‹ä¸¦åˆå§‹åŒ–ç‹€æ…‹æ©Ÿ
  useEffect(() => {
    if (!servicesInitialized) {
      console.log('â³ [AppStateProvider] ç­‰å¾…æœå‹™å±¤åˆå§‹åŒ–...')
      return
    }

    console.log('ğŸ”„ [AppStateProvider] è¼‰å…¥åˆå§‹ç‹€æ…‹...')

    // æª¢æŸ¥æ˜¯å¦åœ¨ç€è¦½å™¨ç’°å¢ƒ
    if (typeof window !== 'undefined') {
      try {
        const initialAppData = InitialStateLoader.loadInitialAppData()

        // æ›´æ–° Context ç‹€æ…‹
        dispatch({ type: "SET_APP_STATE", payload: initialAppData.state })
        dispatch({ type: "SET_EDITOR_CONTENT", payload: initialAppData.editorContent })
        dispatch({ type: "SET_TRANSCRIPT_ENTRIES", payload: initialAppData.transcriptEntries })

        if (initialAppData.session) {
          dispatch({ type: "SET_SESSION", payload: initialAppData.session })
        }

        // åˆå§‹åŒ–ç‹€æ…‹æ©Ÿä¸¦è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨
        const smManager = new StateMachineManager({
          currentState: initialAppData.state,
          isRecording: initialAppData.isRecording,
          transcriptCount: initialAppData.transcriptEntries.length,
          session: initialAppData.session || null,
          error: null
        });

        // å–å¾—æœå‹™å¯¦ä¾‹
        const sessionService = serviceContainer.resolve<ISessionService>(SERVICE_KEYS.SESSION_SERVICE)
        const recordingService = serviceContainer.resolve<IRecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
        const transcriptService = serviceContainer.resolve<ITranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - CREATE_SESSION
        smManager.registerSideEffectHandler('CREATE_SESSION', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ—ï¸ [å‰¯ä½œç”¨] CREATE_SESSION: å»ºç«‹æœƒè©±', effect);

            try {
              if (effect.type === 'CREATE_SESSION') {
                // ä¿®å¾©ï¼šå»ºç«‹æœƒè©±å‰å…ˆæª¢æŸ¥ç¾æœ‰æ´»èºæœƒè©±
                console.log('ğŸ” [å‰¯ä½œç”¨] CREATE_SESSION: æª¢æŸ¥ç¾æœ‰æ´»èºæœƒè©±')
                const existingSession = await sessionService.checkActiveSession()

                if (existingSession) {
                  console.log('âš ï¸ [å‰¯ä½œç”¨] CREATE_SESSION: ç™¼ç¾ç¾æœ‰æ´»èºæœƒè©±ï¼Œå˜—è©¦è‡ªå‹•æ¸…ç†', {
                    existingSessionId: existingSession.id,
                    status: existingSession.status,
                    type: existingSession.type
                  })

                  try {
                    // å˜—è©¦åˆªé™¤ç¾æœ‰æ´»èºæœƒè©±
                    await sessionService.deleteSession(existingSession.id)
                    console.log('âœ… [å‰¯ä½œç”¨] CREATE_SESSION: æˆåŠŸæ¸…ç†ç¾æœ‰æœƒè©±', existingSession.id)
                  } catch (cleanupError) {
                    console.warn('âš ï¸ [å‰¯ä½œç”¨] CREATE_SESSION: æ¸…ç†ç¾æœ‰æœƒè©±å¤±æ•—ï¼Œç¹¼çºŒå˜—è©¦å‰µå»º', cleanupError)
                  }
                }

                const sessionData = await sessionService.createRecordingSession(
                  effect.title || `éŒ„éŸ³ç­†è¨˜ ${new Date().toLocaleString()}`
                )

                // æ–°å¢ï¼šç­‰å¾…æœƒè©±åœ¨è³‡æ–™åº«ä¸­å®Œå…¨å¯è¦‹
                const isReady = await sessionService.waitForSessionReady(sessionData.id)

                if (!isReady) {
                  throw new Error('æœƒè©±å‰µå»ºè¶…æ™‚ï¼Œç„¡æ³•ç¢ºèªæœƒè©±ç‹€æ…‹')
                }

                // æ›´æ–° Context ç‹€æ…‹
                dispatch({
                  type: "SET_SESSION",
                  payload: {
                    id: sessionData.id,
                    status: sessionData.status as SessionStatus,
                    type: effect.sessionType
                  }
                })

                console.log('âœ… [å‰¯ä½œç”¨] CREATE_SESSION å®Œæˆ:', sessionData.id)

                // ç§»é™¤ setTimeoutï¼Œæ”¹ç‚ºåŒæ­¥è§¸ç™¼ SESSION_CREATED è½‰æ›
                if (stateMachineManager) {
                  stateMachineManager.getStateMachine().transition('SESSION_CREATED')
                }
              }
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] CREATE_SESSION å¤±æ•—:', error)

              // ä¿®å¾©ï¼šæä¾›æ›´æ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯
              let errorMessage = 'å»ºç«‹æœƒè©±å¤±æ•—'
              if (error instanceof Error) {
                if (error.message.includes('409') || error.message.includes('è¡çª')) {
                  errorMessage = 'æœƒè©±è¡çªï¼šè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–è¯ç¹«æŠ€è¡“æ”¯æ´'
                } else if (error.message.includes('è¶…æ™‚')) {
                  errorMessage = 'æœƒè©±å‰µå»ºè¶…æ™‚ï¼šè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥å¾Œé‡è©¦'
                }
              }

              dispatch({ type: "SET_ERROR", payload: errorMessage })

              // ä¿®å¾©ï¼šç¢ºä¿æ¸…ç† session ç‹€æ…‹
              dispatch({ type: "SET_SESSION", payload: null })

              // ç§»é™¤ setTimeoutï¼Œæ”¹ç‚ºåŒæ­¥è§¸ç™¼éŒ¯èª¤è½‰æ›
              if (stateMachineManager) {
                stateMachineManager.getStateMachine().transition('ERROR_OCCURRED')
              }
            }
          }
        });



        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - START_RECORDING
        smManager.registerSideEffectHandler('START_RECORDING', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ¤ [å‰¯ä½œç”¨] START_RECORDING: é–‹å§‹éŒ„éŸ³', effect);

            try {
              const currentSession = smManager.getStateMachine().getContext().session
              if (!currentSession) {
                throw new Error('æ²’æœ‰æ´»èºçš„æœƒè©±')
              }

              await recordingService.startRecording(currentSession.id)

              // æ›´æ–°éŒ„éŸ³ç‹€æ…‹
              dispatch({ type: "SET_RECORDING", payload: true })

              console.log('âœ… [å‰¯ä½œç”¨] START_RECORDING å®Œæˆ')
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] START_RECORDING å¤±æ•—:', error)
              dispatch({ type: "SET_ERROR", payload: 'é–‹å§‹éŒ„éŸ³å¤±æ•—' })

              // è§¸ç™¼éŒ¯èª¤è½‰æ›
              setTimeout(() => {
                if (stateMachineManager) {
                  stateMachineManager.getStateMachine().transition('ERROR_OCCURRED')
                }
              }, 100)
            }
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - CONNECT_WEBSOCKET
        smManager.registerSideEffectHandler('CONNECT_WEBSOCKET', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ”Œ [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: é€£æ¥ WebSocket', effect);

            try {
              const currentSession = smManager.getStateMachine().getContext().session
              if (!currentSession) {
                throw new Error('æ²’æœ‰æ´»èºçš„æœƒè©±')
              }

              // ä¿®å¾©ï¼šæ·»åŠ é€£æ¥è¶…æ™‚è™•ç†
              const WEBSOCKET_TIMEOUT = 10000; // 10ç§’è¶…æ™‚

              const connectionPromise = async () => {
                // æ–°å¢ï¼šWebSocket é€£æ¥å‰æœƒè©±ç‹€æ…‹é æª¢
                console.log('ğŸ” [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: é–‹å§‹æœƒè©±ç‹€æ…‹é æª¢', currentSession.id)

                const activeSession = await sessionService.checkActiveSession()
                if (!activeSession) {
                  throw new Error(`æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—ï¼šæ²’æœ‰æ´»èºçš„æœƒè©±`)
                }

                if (activeSession.id !== currentSession.id) {
                  throw new Error(`æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—ï¼šæ´»èºæœƒè©± ${activeSession.id} èˆ‡æœŸæœ›çš„æœƒè©± ${currentSession.id} ä¸åŒ¹é…`)
                }

                if (activeSession.status !== 'active') {
                  throw new Error(`æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—ï¼šæœƒè©± ${activeSession.id} ç‹€æ…‹ç‚º ${activeSession.status}ï¼ŒæœŸæœ›ç‚º active`)
                }

                if (activeSession.type !== 'recording') {
                  throw new Error(`æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—ï¼šæœƒè©± ${activeSession.id} é¡å‹ç‚º ${activeSession.type}ï¼ŒæœŸæœ›ç‚º recording`)
                }

                console.log('âœ… [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: æœƒè©±ç‹€æ…‹é æª¢é€šé', {
                  sessionId: activeSession.id,
                  status: activeSession.status,
                  type: activeSession.type
                })

                // é€£æ¥ä¸¦æ·»åŠ ç›£è½å™¨ - ä½¿ç”¨é æª¢é€šéçš„æœƒè©± ID
                await transcriptService.connect(activeSession.id)

                return activeSession
              }

              // ä¿®å¾©ï¼šä½¿ç”¨ Promise.race å¯¦ç¾è¶…æ™‚æ©Ÿåˆ¶
              const timeoutPromise = new Promise<never>((_, reject) => {
                setTimeout(() => reject(new Error('WebSocket é€£æ¥è¶…æ™‚')), WEBSOCKET_TIMEOUT)
              })

              const activeSession = await Promise.race([connectionPromise(), timeoutPromise])

              // æ·»åŠ é€å­—ç¨¿ç›£è½å™¨
              const handleTranscript = (message: TranscriptMessage) => {
                if (message.type === 'transcript_segment' && message.text) {
                  const startTime = message.start_time ?? 0
                  const hours = Math.floor(startTime / 3600)
                  const minutes = Math.floor((startTime % 3600) / 60)
                  const seconds = Math.floor(startTime % 60)
                  const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

                  // æ·»åŠ é€å­—ç¨¿åˆ° Context
                  dispatch({
                    type: "ADD_TRANSCRIPT_ENTRY",
                    payload: {
                      time: timeStr,
                      text: message.text
                    }
                  })

                  // å¦‚æœæ˜¯ç¬¬ä¸€å€‹é€å­—ç¨¿ï¼Œè§¸ç™¼è½‰æ›
                  const currentContext = smManager.getStateMachine().getContext()
                  if (currentContext.transcriptCount === 0) {
                    setTimeout(() => {
                      smManager.getStateMachine().transition('FIRST_TRANSCRIPT_RECEIVED')
                    }, 100)
                  }
                } else if (message.type === 'transcript_complete') {
                  // è½‰éŒ„å®Œæˆ
                  setTimeout(() => {
                    smManager.getStateMachine().transition('PROCESSING_COMPLETED')
                  }, 100)
                } else if (message.type === 'error') {
                  console.error('ğŸš¨ [å‰¯ä½œç”¨] é€å­—ç¨¿éŒ¯èª¤:', message)
                  dispatch({ type: "SET_ERROR", payload: 'é€å­—ç¨¿è™•ç†éŒ¯èª¤' })

                  setTimeout(() => {
                    smManager.getStateMachine().transition('ERROR_OCCURRED')
                  }, 100)
                }
              }

              transcriptService.addTranscriptListener(activeSession.id, handleTranscript)

              console.log('âœ… [å‰¯ä½œç”¨] CONNECT_WEBSOCKET å®Œæˆ')
            } catch (error: unknown) {
              console.error('âŒ [å‰¯ä½œç”¨] CONNECT_WEBSOCKET å¤±æ•—:', error)

              // å€åˆ†ä¸åŒé¡å‹çš„éŒ¯èª¤æä¾›æ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯
              let errorMessage = 'é€£æ¥é€å­—ç¨¿æœå‹™å¤±æ•—'
              if (error instanceof Error) {
                if (error.message.includes('æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—')) {
                  errorMessage = 'æœƒè©±ç‹€æ…‹é©—è­‰å¤±æ•—'
                } else if (error.message.includes('æ²’æœ‰æ´»èºçš„æœƒè©±')) {
                  errorMessage = 'æ²’æœ‰å¯ç”¨çš„æœƒè©±'
                } else if (error.message.includes('WebSocket é€£æ¥è¶…æ™‚')) {
                  errorMessage = 'WebSocket é€£æ¥è¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥'
                }
              }

              dispatch({ type: "SET_ERROR", payload: errorMessage })

              setTimeout(() => {
                if (stateMachineManager) {
                  stateMachineManager.getStateMachine().transition('ERROR_OCCURRED')
                }
              }, 100)
            }
          }
        });



        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - STOP_RECORDING
        smManager.registerSideEffectHandler('STOP_RECORDING', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ›‘ [å‰¯ä½œç”¨] STOP_RECORDING: åœæ­¢éŒ„éŸ³', effect);

            try {
              await recordingService.stopRecording()

              // æ›´æ–°éŒ„éŸ³ç‹€æ…‹
              dispatch({ type: "SET_RECORDING", payload: false })
              dispatch({ type: "SET_RECORDING_TIME", payload: 0 })

              console.log('âœ… [å‰¯ä½œç”¨] STOP_RECORDING å®Œæˆ')
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] STOP_RECORDING å¤±æ•—:', error)
              dispatch({ type: "SET_ERROR", payload: 'åœæ­¢éŒ„éŸ³å¤±æ•—' })
            }
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - DISCONNECT_WEBSOCKET
        smManager.registerSideEffectHandler('DISCONNECT_WEBSOCKET', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ”Œ [å‰¯ä½œç”¨] DISCONNECT_WEBSOCKET: æ–·é–‹ WebSocket', effect);

            try {
              const currentSession = smManager.getStateMachine().getContext().session
              if (currentSession) {
                await transcriptService.disconnect(currentSession.id)
              }

              console.log('âœ… [å‰¯ä½œç”¨] DISCONNECT_WEBSOCKET å®Œæˆ')
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] DISCONNECT_WEBSOCKET å¤±æ•—:', error)
            }
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - FINISH_SESSION
        smManager.registerSideEffectHandler('FINISH_SESSION', {
          handleSideEffect: async (effect) => {
            console.log('âœ… [å‰¯ä½œç”¨] FINISH_SESSION: å®Œæˆæœƒè©±', effect);

            try {
              const currentSession = smManager.getStateMachine().getContext().session
              if (currentSession) {
                await sessionService.finishSession(currentSession.id)

                // æ›´æ–°æœƒè©±ç‹€æ…‹
                dispatch({
                  type: "UPDATE_SESSION_STATUS",
                  payload: "completed" as SessionStatus
                })
              }

              console.log('âœ… [å‰¯ä½œç”¨] FINISH_SESSION å®Œæˆ')
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] FINISH_SESSION å¤±æ•—:', error)
              dispatch({ type: "SET_ERROR", payload: 'å®Œæˆæœƒè©±å¤±æ•—' })
            }
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - CLEAR_TRANSCRIPTS
        smManager.registerSideEffectHandler('CLEAR_TRANSCRIPTS', {
          handleSideEffect: (effect) => {
            console.log('ğŸ§¹ [å‰¯ä½œç”¨] CLEAR_TRANSCRIPTS: æ¸…é™¤é€å­—ç¨¿', effect);
            dispatch({ type: "SET_TRANSCRIPT_ENTRIES", payload: [] })
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - SAVE_DRAFT
        smManager.registerSideEffectHandler('SAVE_DRAFT', {
          handleSideEffect: (effect) => {
            console.log('ğŸ’¾ [å‰¯ä½œç”¨] SAVE_DRAFT: å„²å­˜è‰ç¨¿', effect);
            // ç•¶å‰å·²æœ‰è‡ªå‹•å„²å­˜æ©Ÿåˆ¶ï¼Œé€™è£¡å¯ä»¥è§¸ç™¼ç«‹å³å„²å­˜
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - SHOW_ERROR
        smManager.registerSideEffectHandler('SHOW_ERROR', {
          handleSideEffect: (effect) => {
            console.log('ğŸš¨ [å‰¯ä½œç”¨] SHOW_ERROR: é¡¯ç¤ºéŒ¯èª¤', effect);
            if (effect.type === 'SHOW_ERROR') {
              dispatch({ type: "SET_ERROR", payload: effect.message })
            }
          }
        });

        // ä¿®å¾©ï¼šæ–°å¢ ERROR_CLEANUP å‰¯ä½œç”¨è™•ç†å™¨ï¼Œç¢ºä¿éŒ¯èª¤æ™‚ç‹€æ…‹å®Œå…¨é‡ç½®
        smManager.registerSideEffectHandler('ERROR_CLEANUP', {
          handleSideEffect: (effect) => {
            console.log('ğŸ§¹ [å‰¯ä½œç”¨] ERROR_CLEANUP: æ¸…ç†éŒ¯èª¤ç‹€æ…‹', effect);

            // æ¸…ç†æ‰€æœ‰ç›¸é—œç‹€æ…‹
            dispatch({ type: "SET_SESSION", payload: null })
            dispatch({ type: "SET_RECORDING", payload: false })
            dispatch({ type: "SET_RECORDING_TIME", payload: 0 })

            console.log('âœ… [å‰¯ä½œç”¨] ERROR_CLEANUP: ç‹€æ…‹æ¸…ç†å®Œæˆ')
          }
        });

        setStateMachineManager(smManager);

        console.log('âœ… [AppStateProvider] åˆå§‹ç‹€æ…‹è¼‰å…¥å®Œæˆ:', {
          state: initialAppData.state,
          hasSession: !!initialAppData.session,
          transcriptCount: initialAppData.transcriptEntries.length,
          contentLength: initialAppData.editorContent.length
        })
      } catch (error) {
        console.error('âŒ [AppStateProvider] è¼‰å…¥åˆå§‹ç‹€æ…‹å¤±æ•—:', error)
      }
    }
  }, [servicesInitialized])

  // éŒ„éŸ³æ™‚é–“è¿½è¹¤
  useEffect(() => {
    let intervalId: NodeJS.Timeout | null = null

    if (state.appData.isRecording && servicesInitialized) {
      intervalId = setInterval(() => {
        const recordingService = serviceContainer.resolve<IRecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
        console.log('Context instance', recordingService)
        const recordingTime = recordingService.getRecordingTime()
        dispatch({ type: "SET_RECORDING_TIME", payload: recordingTime })
      }, 1000)
    }

    return () => {
      if (intervalId) {
        clearInterval(intervalId)
      }
    }
  }, [state.appData.isRecording, servicesInitialized])

  // ç‹€æ…‹æŒä¹…åŒ–
  useEffect(() => {
    // æª¢æŸ¥æ˜¯å¦åœ¨ç€è¦½å™¨ç’°å¢ƒä¸”ç‹€æ…‹å·²åˆå§‹åŒ–
    if (typeof window !== 'undefined' && state.appData) {
      try {
        // å»¶é²å„²å­˜ï¼Œé¿å…åœ¨åˆå§‹è¼‰å…¥æ™‚ç«‹å³å„²å­˜
        const timeoutId = setTimeout(() => {
          InitialStateLoader.saveAppState(state.appData)
        }, 1000) // 1ç§’å»¶é²

        return () => clearTimeout(timeoutId)
      } catch (error) {
        console.error('âŒ [AppStateProvider] ç‹€æ…‹æŒä¹…åŒ–å¤±æ•—:', error)
      }
    }
  }, [state.appData])

  // å°‡ç‹€æ…‹è®Šæ›´åŒæ­¥åˆ°ç‹€æ…‹æ©Ÿ
  useEffect(() => {
    if (stateMachineManager) {
      stateMachineManager.getStateMachine().updateContext({
        currentState: state.appData.state,
        isRecording: state.appData.isRecording,
        transcriptCount: state.appData.transcriptEntries.length,
        session: state.appData.session,
        error: state.error
      });
    }
  }, [state, stateMachineManager]);

  const transition = useCallback((trigger: StateTransitionTrigger) => {
    if (!stateMachineManager) {
      console.error("ç‹€æ…‹æ©Ÿå°šæœªåˆå§‹åŒ–");
      return null;
    }
    const result = stateMachineManager.getStateMachine().transition(trigger);
    if (result.success) {
      dispatch({ type: 'SET_APP_STATE', payload: result.newState });
    }
    return result;
  }, [stateMachineManager]);

  const setState = useCallback((newState: AppState) => {
    dispatch({ type: "SET_STATE", payload: newState })
  }, [])

  const setRecording = useCallback((isRecording: boolean) => {
    dispatch({ type: "SET_RECORDING", payload: isRecording })
  }, [])

  const setRecordingTime = useCallback((time: number) => {
    dispatch({ type: "SET_RECORDING_TIME", payload: time })
  }, [])

  const setEditorContent = useCallback((content: string) => {
    dispatch({ type: "SET_EDITOR_CONTENT", payload: content })
  }, [])

  const setTranscriptEntries = useCallback((entries: TranscriptEntry[]) => {
    dispatch({ type: "SET_TRANSCRIPT_ENTRIES", payload: entries })
  }, [])

  const addTranscriptEntry = useCallback((entry: TranscriptEntry) => {
    dispatch({ type: "ADD_TRANSCRIPT_ENTRY", payload: entry })
  }, [])

  const setSession = useCallback((session: { id: string; status: SessionStatus; type: SessionType } | null) => {
    dispatch({ type: "SET_SESSION", payload: session })
  }, [])

  const updateSessionStatus = useCallback((status: SessionStatus) => {
    dispatch({ type: "UPDATE_SESSION_STATUS", payload: status })
  }, [])

  const resetState = useCallback(() => {
    dispatch({ type: "RESET_STATE" })
  }, [])

  const setLoading = useCallback((loading: boolean) => {
    dispatch({ type: "SET_LOADING", payload: loading })
  }, [])

  const setError = useCallback((error: string | null) => {
    dispatch({ type: "SET_ERROR", payload: error })
  }, [])

  const contextValue: AppStateContextValue = {
    appData: state.appData,
    isLoading: state.isLoading,
    error: state.error,
    dispatch,
    setState,
    setRecording,
    setRecordingTime,
    setEditorContent,
    setTranscriptEntries,
    addTranscriptEntry,
    setSession,
    updateSessionStatus,
    resetState,
    setLoading,
    setError,
    transition,
  }

  return React.createElement(
    AppStateContext.Provider,
    { value: contextValue },
    children
  )
}

export function useAppStateContext(): AppStateContextValue {
  const context = useContext(AppStateContext)
  if (!context) {
    throw new Error("useAppStateContext å¿…é ˆåœ¨ AppStateProvider å…§ä½¿ç”¨")
  }
  return context
}

export { AppStateContext }


# END FILE CONTENTS


# File: frontend/tsconfig.json

{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "target": "ES6",
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}


# END FILE CONTENTS


# File: app/api/segments.py

"""
StudyScriber éŸ³æª”åˆ‡ç‰‡ä¸Šå‚³ API
"""

import logging
from uuid import UUID
from fastapi import APIRouter, UploadFile, File, BackgroundTasks, Depends, HTTPException
from starlette.status import HTTP_201_CREATED, HTTP_400_BAD_REQUEST, HTTP_409_CONFLICT
from supabase import Client

from app.core.config import Settings, get_settings
from app.db.database import get_supabase_client
from app.services.r2_client import get_r2_client
from app.services.azure_openai_v2 import SimpleAudioTranscriptionService
from app.services.transcript_feed import get_transcript_hub
from app.core.container import container
from app.utils.validators import valid_webm
from app.services.stt.factory import get_provider
from app.services.stt.save_utils import save_and_push_result


logger = logging.getLogger(__name__)

router = APIRouter(prefix="/api", tags=["éŸ³æª”ä¸Šå‚³"])

MAX_FILE_SIZE = 5 * 1024 * 1024  # 5 MB


@router.post("/segment", status_code=HTTP_201_CREATED)
async def upload_segment(
    sid: UUID,
    seq: int,
    file: UploadFile = File(...),
    background: BackgroundTasks = BackgroundTasks(),
    settings: Settings = Depends(get_settings),
    supabase: Client = Depends(get_supabase_client)
):
    """
    ä¸Šå‚³ 10 ç§’ WebM éŸ³æª”åˆ‡ç‰‡ (B-020)

    ä½¿ç”¨ Content-Length + UploadFile.spool_max_size é›™ä¿éšª
    ç«‹å³å›æ‡‰ ackï¼ŒèƒŒæ™¯è™•ç†è½‰éŒ„
    """

    # --- åŸºæœ¬é©—è­‰ ---
    if file.content_type not in ("audio/webm", "audio/webm;codecs=opus"):
        raise HTTPException(HTTP_400_BAD_REQUEST, "Unsupported media type. Expected audio/webm")

    # è®€å–æª”æ¡ˆå…§å®¹
    blob = await file.read()

    # æª”æ¡ˆå¤§å°æª¢æŸ¥
    if len(blob) > MAX_FILE_SIZE:
        raise HTTPException(HTTP_400_BAD_REQUEST, f"File too large: {len(blob)} bytes > {MAX_FILE_SIZE} bytes (5MB)")

    # æœƒè©±é©—è­‰ - æª¢æŸ¥ session å­˜åœ¨ä¸”ç‹€æ…‹æ­£ç¢º
    try:
        session_response = supabase.table("sessions").select("*").eq("id", str(sid)).eq("status", "active").limit(1).execute()
        if not session_response.data:
            raise HTTPException(HTTP_400_BAD_REQUEST, "Session not found or not active")

        session = session_response.data[0]
        if session.get('type') != 'recording':
            raise HTTPException(HTTP_400_BAD_REQUEST, "Session is not in recording mode")

    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Session validation error: {e}")
        raise HTTPException(HTTP_400_BAD_REQUEST, "Session validation failed")

    # åºè™Ÿå”¯ä¸€æ€§æª¢æŸ¥ - (session_id, seq) UNIQUE
    try:
        existing_response = supabase.table("audio_files").select("id").eq("session_id", str(sid)).eq("chunk_sequence", seq).limit(1).execute()
        if existing_response.data:
            raise HTTPException(HTTP_409_CONFLICT, f"Sequence {seq} already uploaded for this session. Please retry with next sequence or skip.")
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Sequence uniqueness check error: {e}")
        raise HTTPException(HTTP_400_BAD_REQUEST, "Sequence validation failed")

    # WebM æª”æ¡ˆæ ¼å¼åŸºæœ¬é©—è­‰
    if not valid_webm(blob[:32]):
        raise HTTPException(HTTP_400_BAD_REQUEST, "Invalid WebM header. Please ensure file is properly encoded WebM format.")

    logger.info(f"âœ… Validated WebM segment upload: session={sid}, seq={seq}, size={len(blob)} bytes")

    # --- ç«‹å³å› Ackï¼Œä¸¦ä¸ŸèƒŒæ™¯ä»»å‹™ ---
    background.add_task(process_and_transcribe, sid, seq, blob)
    return {"ack": seq, "size": len(blob), "status": "accepted"}


async def process_and_transcribe(sid: UUID, seq: int, webm_blob: bytes):
    """
    èƒŒæ™¯ä»»å‹™ï¼šè™•ç†éŸ³æª”åˆ‡ç‰‡ä¸¦åŸ·è¡Œè½‰éŒ„

    æµç¨‹ï¼šR2 å„²å­˜ â†’ è³‡æ–™åº«è¨˜éŒ„ â†’ FFmpeg è½‰æ› â†’ Whisper è½‰éŒ„ â†’ WebSocket å»£æ’­
    """
    transcript_hub = get_transcript_hub()

    try:
        logger.info(f"ğŸš€ [èƒŒæ™¯è½‰éŒ„] é–‹å§‹è™•ç†åˆ‡ç‰‡ {seq} (session: {sid}, size: {len(webm_blob)} bytes)")

        # 1. å„²å­˜è‡³ Cloudflare R2
        r2_client = get_r2_client()
        blob_path = await r2_client.store_segment(sid, seq, webm_blob)
        logger.info(f"ğŸ“ [R2 å„²å­˜] åˆ‡ç‰‡ {seq} å·²å„²å­˜è‡³ {blob_path}")

        # 2. è¨˜éŒ„åˆ°è³‡æ–™åº« audio_files è¡¨
        supabase = get_supabase_client()
        app_settings = get_settings()
        audio_file_data = {
            "session_id": str(sid),
            "chunk_sequence": seq,
            "r2_key": blob_path,
            "r2_bucket": r2_client.bucket_name,
            "file_size": len(webm_blob),
            "duration_seconds": app_settings.AUDIO_CHUNK_DURATION_SEC  # å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
        }

        audio_response = supabase.table("audio_files").insert(audio_file_data).execute()
        if not audio_response.data:
            raise Exception("Failed to insert audio file record")

        logger.info(f"ğŸ“ [è³‡æ–™åº«] éŸ³æª”è¨˜éŒ„å·²å»ºç«‹: {audio_response.data[0]['id']}")

        # 3. å•Ÿå‹•è½‰éŒ„æœå‹™
        try:
            provider = get_provider(sid)
            logger.info(f"ğŸ¯ [è½‰éŒ„å•Ÿå‹•] é–‹å§‹è½‰éŒ„åˆ‡ç‰‡ {seq} (provider={provider.name})")
            result = await provider.transcribe(webm_blob, sid, seq)
            if result:
                await save_and_push_result(sid, seq, result)
                logger.info(f"âœ… [è½‰éŒ„å•Ÿå‹•] åˆ‡ç‰‡ {seq} è½‰éŒ„æˆåŠŸ")
            else:
                logger.warning(f"âš ï¸ [è½‰éŒ„å•Ÿå‹•] åˆ‡ç‰‡ {seq} è½‰éŒ„å¤±æ•—")
        except Exception as transcription_error:
            logger.error(f"âŒ [è½‰éŒ„æœå‹™éŒ¯èª¤] åˆ‡ç‰‡ {seq}: {transcription_error}")
            await transcript_hub.broadcast_error(str(sid), "transcription_service_error", str(transcription_error), seq)

        logger.info(f"âœ… [èƒŒæ™¯è½‰éŒ„] åˆ‡ç‰‡ {seq} è™•ç†å®Œæˆ")

    except Exception as e:
        logger.error(f"âŒ [èƒŒæ™¯è½‰éŒ„] åˆ‡ç‰‡ {seq} è™•ç†å¤±æ•—: {e}")
        # æ¨™è¨˜åˆ‡ç‰‡éŒ¯èª¤ç‹€æ…‹
        await _mark_segment_error(sid, seq, str(e))
        # å»£æ’­éŒ¯èª¤åˆ°å‰ç«¯
        await transcript_hub.broadcast_error(str(sid), "processing_error", str(e), seq)


async def _mark_segment_error(sid: UUID, seq: int, error_message: str):
    """æ¨™è¨˜åˆ‡ç‰‡è™•ç†éŒ¯èª¤"""
    try:
        supabase = get_supabase_client()
        # å¯ä»¥è€ƒæ…®åœ¨ audio_files è¡¨æ·»åŠ  error_message æ¬„ä½ï¼Œæˆ–å»ºç«‹éŒ¯èª¤è¨˜éŒ„è¡¨
        logger.error(f"åˆ‡ç‰‡éŒ¯èª¤è¨˜éŒ„: session={sid}, seq={seq}, error={error_message}")
    except Exception as e:
        logger.error(f"è¨˜éŒ„åˆ‡ç‰‡éŒ¯èª¤å¤±æ•—: {e}")





# END FILE CONTENTS


# File: frontend/app-store-zustand.ts

export type AppState =
    | 'default'
    | 'session_creating'
    | 'recording_waiting'
    | 'recording_active'
    | 'processing'
    | 'finished'


# END FILE CONTENTS


# File: frontend/components/ui/avatar.tsx

"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }


# END FILE CONTENTS


# File: app/services/r2_client.py

"""
Cloudflare R2 å„²å­˜æœå‹™å®¢æˆ¶ç«¯
ä½¿ç”¨ Cloudflare API Token èªè­‰
"""

import os
import logging
import asyncio
import aiohttp
from typing import Dict, Any
from uuid import UUID
import requests
from dotenv import load_dotenv
from supabase import Client
from app.core.config import settings

# è¼‰å…¥ç’°å¢ƒè®Šæ•¸
load_dotenv()

logger = logging.getLogger(__name__)

class R2ClientError(Exception):
    """R2 å®¢æˆ¶ç«¯ç•°å¸¸"""
    pass

class R2Client:
    """Cloudflare R2 å„²å­˜å®¢æˆ¶ç«¯ - ä½¿ç”¨ API Token èªè­‰"""

    def __init__(self):
        """åˆå§‹åŒ– R2 å®¢æˆ¶ç«¯"""
        self.account_id = os.getenv('R2_ACCOUNT_ID')
        self.bucket_name = os.getenv('R2_BUCKET_NAME', 'studyscriber-audio')
        self.api_token = os.getenv('R2_API_TOKEN')

        # é©—è­‰å¿…è¦é…ç½®
        if not self.account_id:
            raise R2ClientError("ç¼ºå°‘ R2_ACCOUNT_ID ç’°å¢ƒè®Šæ•¸")

        if not self.api_token:
            raise R2ClientError("ç¼ºå°‘ R2_API_TOKEN ç’°å¢ƒè®Šæ•¸")

        # åˆå§‹åŒ– API Token å®¢æˆ¶ç«¯
        self.api_base_url = f"https://api.cloudflare.com/client/v4/accounts/{self.account_id}/r2/buckets/{self.bucket_name}/objects"
        self.headers = {
            'Authorization': f'Bearer {self.api_token}',
            'Content-Type': 'application/octet-stream'
        }

        logger.info("R2 å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸï¼Œä½¿ç”¨ API Token èªè­‰")

    async def store_segment(self, sid: UUID, seq: int, blob: bytes) -> str:
        """
        å„²å­˜éŸ³æª”åˆ‡ç‰‡åˆ° R2 (ç°¡åŒ–ç‰ˆ REST API æ¶æ§‹)

        Args:
            sid: æœƒè©± ID
            seq: åˆ‡ç‰‡åºè™Ÿ
            blob: éŸ³æª”äºŒé€²åˆ¶è³‡æ–™

        Returns:
            str: R2 å„²å­˜éµå€¼

        Raises:
            R2ClientError: ä¸Šå‚³å¤±æ•—æ™‚æ‹‹å‡º
        """
        key = f"{sid}/{seq:06}.webm"
        url = f"{self.api_base_url}/{key}"

        headers = {
            "Authorization": f"Bearer {self.api_token}",
            "Content-Type": "audio/webm"
        }

        try:
            async with aiohttp.ClientSession() as session:
                async with session.put(url, data=blob, headers=headers) as response:
                    if response.status in [200, 201]:
                        logger.info(f"âœ… R2 ä¸Šå‚³æˆåŠŸ: {key} ({len(blob)} bytes)")
                        return key
                    else:
                        error_text = await response.text()
                        raise R2ClientError(f"R2 ä¸Šå‚³å¤±æ•—: {response.status} - {error_text}")

        except aiohttp.ClientError as e:
            raise R2ClientError(f"R2 ä¸Šå‚³é€£ç·šéŒ¯èª¤: {str(e)}")
        except Exception as e:
            raise R2ClientError(f"R2 ä¸Šå‚³æœªçŸ¥éŒ¯èª¤: {str(e)}")

    async def test_connection(self) -> Dict[str, Any]:
        """æ¸¬è©¦é€£æ¥"""
        try:
            # æ¸¬è©¦ token æœ‰æ•ˆæ€§
            verify_url = "https://api.cloudflare.com/client/v4/user/tokens/verify"
            response = requests.get(verify_url, headers={'Authorization': f'Bearer {self.api_token}'})

            if response.status_code == 200:
                result = response.json()
                return {
                    'success': True,
                    'auth_method': 'api_token',
                    'token_status': result.get('result', {}).get('status'),
                    'account_id': self.account_id,
                    'bucket_name': self.bucket_name
                }
            else:
                return {
                    'success': False,
                    'error': f'Token é©—è­‰å¤±æ•—: {response.status_code}',
                    'auth_method': 'api_token'
                }
        except Exception as e:
            return {
                'success': False,
                'error': f'API Token é€£æ¥æ¸¬è©¦å¤±æ•—: {str(e)}',
                'auth_method': 'api_token'
            }

    async def upload_file(self, key: str, data: bytes, content_type: str = 'application/octet-stream') -> Dict[str, Any]:
        """ä¸Šå‚³æª”æ¡ˆåˆ° R2"""
        try:
            url = f"{self.api_base_url}/{key}"
            headers = self.headers.copy()
            headers['Content-Type'] = content_type

            response = requests.put(url, data=data, headers=headers)

            if response.status_code in [200, 201]:
                return {
                    'success': True,
                    'key': key,
                    'size': len(data),
                    'method': 'api_token'
                }
            else:
                return {
                    'success': False,
                    'error': f'ä¸Šå‚³å¤±æ•—: {response.status_code} - {response.text}',
                    'method': 'api_token'
                }
        except Exception as e:
            return {
                'success': False,
                'error': f'API Token ä¸Šå‚³å¤±æ•—: {str(e)}',
                'method': 'api_token'
            }

    async def store_chunk_blob(
        self, session_id: UUID, chunk_sequence: int, blob_data: bytes, supabase_client: Client
    ) -> dict:
        """
        å°‡éŸ³æª”åˆ‡ç‰‡ Blob å­˜å„²åˆ° R2 ä¸¦åœ¨è³‡æ–™åº«ä¸­è¨˜éŒ„

        Args:
            session_id: æœƒè©± ID
            chunk_sequence: éŸ³æª”åˆ‡ç‰‡åºè™Ÿ
            blob_data: éŸ³æª”äºŒé€²åˆ¶æ•¸æ“š
            supabase_client: Supabase å®¢æˆ¶ç«¯å¯¦ä¾‹

        Returns:
            Dict: åŒ…å«æ“ä½œçµæœçš„å­—å…¸
        """
        # ç”Ÿæˆ R2 å„²å­˜éµå€¼
        r2_key = generate_audio_key(str(session_id), chunk_sequence)

        # æœ€å¤šé‡è©¦3æ¬¡ä¸Šå‚³
        max_retries = 3
        upload_result = None

        for attempt in range(max_retries):
            try:
                # ä¸Šå‚³æª”æ¡ˆåˆ° R2
                upload_result = await self.upload_file(
                    key=r2_key,
                    data=blob_data,
                    content_type='audio/webm'
                )

                if upload_result['success']:
                    break

                logger.warning(f"ä¸Šå‚³å¤±æ•—ï¼Œç¬¬ {attempt + 1} æ¬¡å˜—è©¦: {upload_result.get('error')}")

                # æŒ‡æ•¸é€€é¿
                if attempt < max_retries - 1:
                    await asyncio.sleep(2 ** attempt)

            except Exception as e:
                logger.error(f"ä¸Šå‚³ç•°å¸¸ï¼Œç¬¬ {attempt + 1} æ¬¡å˜—è©¦: {str(e)}")
                if attempt == max_retries - 1:
                    upload_result = {
                        'success': False,
                        'error': f'ä¸Šå‚³å¤±æ•—ï¼Œå·²é‡è©¦ {max_retries} æ¬¡: {str(e)}'
                    }
                elif attempt < max_retries - 1:
                    await asyncio.sleep(2 ** attempt)

        if not upload_result['success']:
            return {
                'success': False,
                'error': f'R2 ä¸Šå‚³å¤±æ•—: {upload_result.get("error")}',
                'session_id': session_id,
                'chunk_sequence': chunk_sequence
            }

        # ä½¿ç”¨å‚³å…¥çš„ supabase_client é€²è¡Œè³‡æ–™åº«æ“ä½œ
        try:
            audio_file_record = {
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "r2_key": r2_key,
                "r2_bucket": self.bucket_name,
                "file_size": len(blob_data),
                "duration_seconds": settings.AUDIO_CHUNK_DURATION_SEC  # å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
            }

            db_response = supabase_client.table("audio_files").insert(audio_file_record).execute()

            if not db_response.data:
                return {
                    'success': False,
                    'error': 'è³‡æ–™åº«è¨˜éŒ„å»ºç«‹å¤±æ•—',
                    'session_id': session_id,
                    'chunk_sequence': chunk_sequence
                }

        except Exception as db_error:
            logger.error(f"è³‡æ–™åº«æ“ä½œå¤±æ•—: {str(db_error)}")
            return {
                'success': False,
                'error': f'è³‡æ–™åº«è¨˜éŒ„å»ºç«‹å¤±æ•—: {str(db_error)}',
                'session_id': session_id,
                'chunk_sequence': chunk_sequence
            }

        return {
            'success': True,
            'session_id': session_id,
            'chunk_sequence': chunk_sequence,
            'r2_key': r2_key,
            'r2_bucket': self.bucket_name,
            'file_size': len(blob_data),
            'upload_method': upload_result.get('method')
        }

    def get_download_url(self, key: str) -> str:
        """
        ç²å–æª”æ¡ˆçš„ç›´æ¥ä¸‹è¼‰ URL

        æ³¨æ„ï¼šæ­¤ URL éœ€è¦ API Token èªè­‰ï¼Œé©ç”¨æ–¼æœå‹™ç«¯ä½¿ç”¨
        å°æ–¼å®¢æˆ¶ç«¯ä¸‹è¼‰ï¼Œå»ºè­°ä½¿ç”¨ Cloudflare çš„å…¬é–‹ URL æˆ–å¯¦ä½œä»£ç†ç«¯é»
        """
        return f"{self.api_base_url}/{key}"

    async def download_file(self, key: str) -> Dict[str, Any]:
        """å¾ R2 ä¸‹è¼‰æª”æ¡ˆ"""
        try:
            url = f"{self.api_base_url}/{key}"
            headers = {'Authorization': f'Bearer {self.api_token}'}

            response = requests.get(url, headers=headers)

            if response.status_code == 200:
                return {
                    'success': True,
                    'key': key,
                    'data': response.content,
                    'size': len(response.content),
                    'method': 'api_token'
                }
            elif response.status_code == 404:
                return {
                    'success': False,
                    'error': f'æª”æ¡ˆä¸å­˜åœ¨: {key}',
                    'method': 'api_token'
                }
            else:
                return {
                    'success': False,
                    'error': f'ä¸‹è¼‰å¤±æ•—: {response.status_code} - {response.text}',
                    'method': 'api_token'
                }
        except Exception as e:
            return {
                'success': False,
                'error': f'API Token ä¸‹è¼‰å¤±æ•—: {str(e)}',
                'method': 'api_token'
            }

def get_r2_client() -> R2Client:
    """ç²å– R2 å®¢æˆ¶ç«¯å¯¦ä¾‹"""
    return R2Client()

def generate_audio_key(session_id: str, chunk_sequence: int) -> str:
    """ç”ŸæˆéŸ³æª”å„²å­˜éµå"""
    return f"audio/{session_id}/chunk_{chunk_sequence:04d}.webm"


# END FILE CONTENTS


# File: frontend/lib/initial-state-loader.ts

"use client"

import type { AppData } from '../types/app-state'

/**
 * åˆå§‹ç‹€æ…‹è¼‰å…¥å™¨
 * è² è²¬å¾ localStorage æˆ–å…¶ä»–æŒä¹…åŒ–å­˜å„²è¼‰å…¥åˆå§‹ç‹€æ…‹
 */
export class InitialStateLoader {
    private static readonly STORAGE_KEYS = {
        DRAFT_NOTE: 'draft_note',
        LAST_SESSION: 'last_session',
        APP_STATE: 'app_state_v1',
    } as const

    /**
     * è¼‰å…¥åˆå§‹æ‡‰ç”¨ç‹€æ…‹
     * å„ªå…ˆé †åºï¼šlocalStorage > é è¨­ç‹€æ…‹
     */
    static loadInitialAppData(): AppData {
        console.log('ğŸ”„ [InitialStateLoader] é–‹å§‹è¼‰å…¥åˆå§‹ç‹€æ…‹')

        try {
            // 1. è¼‰å…¥è‰ç¨¿ç­†è¨˜
            const draftContent = this.loadDraftNote()

            // 2. è¼‰å…¥ä¸Šæ¬¡æœƒè©±è³‡è¨Šï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            const lastSession = this.loadLastSession()

            // 3. è¼‰å…¥å®Œæ•´æ‡‰ç”¨ç‹€æ…‹ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            const savedAppState = this.loadSavedAppState()

            // ä¿®æ­£ï¼šå¦‚æœå„²å­˜çš„ç‹€æ…‹æ˜¯æš«æ™‚æ€§æˆ–å·²å®Œæˆçš„ï¼Œå‰‡é‡ç½®ç‚ºé è¨­ç‹€æ…‹
            console.log('ğŸ” [InitialStateLoader] æª¢æŸ¥å„²å­˜çš„ç‹€æ…‹:', {
                savedState: savedAppState?.state,
                shouldReset: savedAppState?.state && ['recording_waiting', 'recording_active', 'processing', 'finished'].includes(savedAppState.state)
            })

            const validInitialState =
                savedAppState?.state &&
                    !['recording_waiting', 'recording_active', 'processing', 'finished'].includes(savedAppState.state)
                    ? savedAppState.state
                    : 'default'

            console.log('ğŸ” [InitialStateLoader] æœ€çµ‚åˆå§‹ç‹€æ…‹:', validInitialState)

            const initialAppData: AppData = {
                state: validInitialState,
                transcriptEntries: savedAppState?.transcriptEntries || [],
                editorContent: draftContent || '',
                isRecording: false, // é‡å•Ÿå¾Œæ°¸é ä¸æ‡‰è©²æ˜¯éŒ„éŸ³ç‹€æ…‹
                recordingTime: 0,   // é‡å•Ÿå¾Œé‡ç½®éŒ„éŸ³æ™‚é–“
                session: lastSession, // å¯èƒ½ç‚º null
            }

            console.log('ğŸ”„ [InitialStateLoader] åˆå§‹ç‹€æ…‹è¼‰å…¥å®Œæˆ:', {
                hasDraftContent: !!draftContent,
                hasLastSession: !!lastSession,
                hasSavedAppState: !!savedAppState,
                state: initialAppData.state,
                transcriptCount: initialAppData.transcriptEntries.length
            })

            return initialAppData
        } catch (error) {
            console.error('âŒ [InitialStateLoader] è¼‰å…¥åˆå§‹ç‹€æ…‹å¤±æ•—:', error)
            return this.getDefaultAppData()
        }
    }

    /**
     * è¼‰å…¥è‰ç¨¿ç­†è¨˜å…§å®¹
     */
    private static loadDraftNote(): string {
        try {
            const draft = localStorage.getItem(this.STORAGE_KEYS.DRAFT_NOTE)
            return draft || ''
        } catch (error) {
            console.warn('âš ï¸ [InitialStateLoader] è¼‰å…¥è‰ç¨¿ç­†è¨˜å¤±æ•—:', error)
            return ''
        }
    }

    /**
     * è¼‰å…¥ä¸Šæ¬¡æœƒè©±è³‡è¨Š
     */
    private static loadLastSession(): AppData['session'] {
        try {
            const sessionData = localStorage.getItem(this.STORAGE_KEYS.LAST_SESSION)
            if (!sessionData) return null

            const session = JSON.parse(sessionData)

            // é©—è­‰æœƒè©±è³‡æ–™çµæ§‹
            if (session && typeof session === 'object' && session.id) {
                // åªæœ‰åœ¨æœƒè©±ç‹€æ…‹ä¸æ˜¯ completed æˆ– error æ™‚æ‰æ¢å¾©
                if (session.status === 'completed' || session.status === 'error') {
                    console.log('ğŸ”„ [InitialStateLoader] ä¸Šæ¬¡æœƒè©±å·²å®Œæˆï¼Œä¸æ¢å¾©:', session.status)
                    return null
                }

                console.log('ğŸ”„ [InitialStateLoader] æ¢å¾©ä¸Šæ¬¡æœƒè©±:', {
                    id: session.id,
                    status: session.status,
                    type: session.type
                })
                return session
            }

            return null
        } catch (error) {
            console.warn('âš ï¸ [InitialStateLoader] è¼‰å…¥ä¸Šæ¬¡æœƒè©±å¤±æ•—:', error)
            return null
        }
    }

    /**
     * è¼‰å…¥å®Œæ•´çš„æ‡‰ç”¨ç‹€æ…‹
     */
    private static loadSavedAppState(): Partial<AppData> | null {
        try {
            const stateData = localStorage.getItem(this.STORAGE_KEYS.APP_STATE)
            if (!stateData) return null

            const savedState = JSON.parse(stateData)

            // é©—è­‰ç‹€æ…‹è³‡æ–™çµæ§‹
            if (savedState && typeof savedState === 'object') {
                console.log('ğŸ”„ [InitialStateLoader] è¼‰å…¥å·²å„²å­˜çš„æ‡‰ç”¨ç‹€æ…‹')
                return savedState
            }

            return null
        } catch (error) {
            console.warn('âš ï¸ [InitialStateLoader] è¼‰å…¥æ‡‰ç”¨ç‹€æ…‹å¤±æ•—:', error)
            return null
        }
    }

    /**
     * ç²å–é è¨­æ‡‰ç”¨ç‹€æ…‹
     */
    private static getDefaultAppData(): AppData {
        console.log('ğŸ”„ [InitialStateLoader] ä½¿ç”¨é è¨­ç‹€æ…‹')
        return {
            state: 'default',
            transcriptEntries: [],
            editorContent: '',
            isRecording: false,
            recordingTime: 0,
            session: null,
        }
    }

    /**
     * å„²å­˜æ‡‰ç”¨ç‹€æ…‹åˆ° localStorage
     */
    static saveAppState(appData: AppData): void {
        try {
            // å„²å­˜å®Œæ•´æ‡‰ç”¨ç‹€æ…‹ï¼ˆæ’é™¤æ•æ„Ÿè³‡è¨Šï¼‰
            const stateToSave = {
                state: appData.state,
                transcriptEntries: appData.transcriptEntries,
                // ä¸å„²å­˜ editorContentï¼ˆå·²å–®ç¨å„²å­˜ç‚º draft_noteï¼‰
                // ä¸å„²å­˜ isRecording å’Œ recordingTimeï¼ˆé‡å•Ÿå¾Œæ‡‰é‡ç½®ï¼‰
            }

            localStorage.setItem(this.STORAGE_KEYS.APP_STATE, JSON.stringify(stateToSave))

            // å„²å­˜æœƒè©±è³‡è¨Š
            if (appData.session) {
                localStorage.setItem(this.STORAGE_KEYS.LAST_SESSION, JSON.stringify(appData.session))
            } else {
                localStorage.removeItem(this.STORAGE_KEYS.LAST_SESSION)
            }

            console.log('ğŸ’¾ [InitialStateLoader] æ‡‰ç”¨ç‹€æ…‹å·²å„²å­˜')
        } catch (error) {
            console.error('âŒ [InitialStateLoader] å„²å­˜æ‡‰ç”¨ç‹€æ…‹å¤±æ•—:', error)
        }
    }

    /**
     * æ¸…é™¤æ‰€æœ‰æŒä¹…åŒ–ç‹€æ…‹
     */
    static clearPersistedState(): void {
        try {
            localStorage.removeItem(this.STORAGE_KEYS.APP_STATE)
            localStorage.removeItem(this.STORAGE_KEYS.LAST_SESSION)
            // æ³¨æ„ï¼šä¸æ¸…é™¤ DRAFT_NOTEï¼Œå› ç‚ºé‚£æ˜¯ç”¨æˆ¶çš„è‰ç¨¿å…§å®¹

            console.log('ğŸ—‘ï¸ [InitialStateLoader] æŒä¹…åŒ–ç‹€æ…‹å·²æ¸…é™¤')
        } catch (error) {
            console.error('âŒ [InitialStateLoader] æ¸…é™¤æŒä¹…åŒ–ç‹€æ…‹å¤±æ•—:', error)
        }
    }

    /**
     * æª¢æŸ¥æ˜¯å¦æœ‰æŒä¹…åŒ–ç‹€æ…‹
     */
    static hasPersistedState(): boolean {
        try {
            return !!(
                localStorage.getItem(this.STORAGE_KEYS.APP_STATE) ||
                localStorage.getItem(this.STORAGE_KEYS.LAST_SESSION)
            )
        } catch (error) {
            console.warn('âš ï¸ [InitialStateLoader] æª¢æŸ¥æŒä¹…åŒ–ç‹€æ…‹å¤±æ•—:', error)
            return false
        }
    }
}


# END FILE CONTENTS


# File: frontend/lib/audio-recorder.ts

"use client"

import { getAudioChunkIntervalMs } from './config'

// éŸ³è¨ŠéŒ„è£½ç‹€æ…‹
export type AudioRecorderState = 'idle' | 'recording' | 'paused' | 'error'

// éŸ³è¨ŠéŒ„è£½é…ç½®
export interface AudioRecorderConfig {
  chunkInterval: number // åˆ‡ç‰‡é–“éš”ï¼ˆæ¯«ç§’ï¼‰
  mimeType: string // éŸ³è¨Šæ ¼å¼
  audioBitsPerSecond?: number // éŸ³è¨Šä½å…ƒç‡
}

// éŸ³è¨Šåˆ‡ç‰‡è³‡æ–™
export interface AudioChunk {
  blob: Blob
  timestamp: number
  duration: number
  sequence: number
}

// é è¨­é…ç½®
const DEFAULT_CONFIG: AudioRecorderConfig = {
  chunkInterval: 12000, // 12 ç§’
  mimeType: 'audio/webm;codecs=opus',
  audioBitsPerSecond: 64000, // 64 kbps
}

// æ”¯æ´çš„éŸ³è¨Šæ ¼å¼åˆ—è¡¨ï¼ˆå„ªå…ˆé †åºï¼‰
// MP4 æ ¼å¼åœ¨ FFmpeg 7.1.1 ä¸­æœ‰æ›´å¥½çš„å…¼å®¹æ€§ï¼Œå› æ­¤æ”¾åœ¨ç¬¬ä¸€ä½
const SUPPORTED_MIME_TYPES = [
  'audio/webm;codecs=opus', // ç¬¬ä¸€å„ªå…ˆï¼šWebM Opus ç·¨è§£ç¢¼å™¨ï¼ŒéŸ³è³ªå„ªç§€ä¸”ä¸²æµå‹å¥½
  'audio/webm',             // ç¬¬äºŒå„ªå…ˆï¼šWebM é€šç”¨æ ¼å¼
  'audio/mp4',              // ç¬¬ä¸‰å„ªå…ˆï¼šMP4 ä½œç‚ºå‚™é¸æ–¹æ¡ˆ
  'audio/ogg;codecs=opus',
  'audio/wav',
]

export class AudioRecorder {
  private mediaRecorder: MediaRecorder | null = null
  private stream: MediaStream | null = null
  private config: AudioRecorderConfig
  private state: AudioRecorderState = 'idle'
  private chunkSequence: number = 0 // åˆ‡ç‰‡åºè™Ÿè¨ˆæ•¸å™¨

  // äº‹ä»¶å›èª¿
  private onChunkCallback?: (chunk: AudioChunk) => void
  private onStateChangeCallback?: (state: AudioRecorderState) => void
  private onErrorCallback?: (error: Error) => void

  constructor(config: Partial<AudioRecorderConfig> = {}) {
    this.config = { ...DEFAULT_CONFIG, ...config }
  }

  /**
   * é–‹å§‹éŒ„è£½
   */
  async start(onDataAvailable: (chunk: AudioChunk) => void): Promise<void> {
    if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
      throw new Error('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
    }

    // ç²å–éº¥å…‹é¢¨æ¬Šé™
    this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })

    // å‰µå»º MediaRecorder
    this.mediaRecorder = new MediaRecorder(this.stream, {
      mimeType: this.config.mimeType,
      audioBitsPerSecond: this.config.audioBitsPerSecond,
    })

    // é‡ç½®åºè™Ÿè¨ˆæ•¸å™¨
    this.chunkSequence = 0

    // ç›£è½è³‡æ–™å¯ç”¨äº‹ä»¶
    this.mediaRecorder.ondataavailable = (event) => {
      console.log('ğŸ™ï¸ [AudioRecorder] MediaRecorder.ondataavailable è§¸ç™¼', {
        dataSize: event.data.size,
        sequence: this.chunkSequence,
        timestamp: new Date().toISOString()
      })

      if (event.data.size > 0) {
        const chunk: AudioChunk = {
          blob: event.data,
          timestamp: Date.now(),
          duration: this.config.chunkInterval,
          sequence: this.chunkSequence++, // åˆ†é…åºè™Ÿä¸¦éå¢
        }

        console.log('ğŸ“¦ [AudioRecorder] å»ºç«‹éŸ³é »åˆ‡ç‰‡', {
          sequence: chunk.sequence,
          size: chunk.blob.size,
          duration: chunk.duration,
          mimeType: this.config.mimeType
        })

        onDataAvailable(chunk)
      } else {
        console.warn('âš ï¸ [AudioRecorder] ondataavailable ä½† data.size = 0')
      }
    }

    // é–‹å§‹éŒ„è£½ï¼Œæ¯éš”æŒ‡å®šæ™‚é–“ç”¢ç”Ÿä¸€å€‹åˆ‡ç‰‡
    console.log('ğŸ¬ [AudioRecorder] é–‹å§‹éŒ„è£½', {
      chunkInterval: this.config.chunkInterval,
      mimeType: this.config.mimeType,
      state: this.mediaRecorder.state
    })

    this.mediaRecorder.start(this.config.chunkInterval)

    console.log('âœ… [AudioRecorder] MediaRecorder.start() å·²èª¿ç”¨', {
      state: this.mediaRecorder.state,
      stream: this.stream ? 'active' : 'null'
    })
  }

  /**
   * åœæ­¢éŒ„è£½
   */
  stop(): void {
    if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
      this.mediaRecorder.stop()
    }

    if (this.stream) {
      this.stream.getTracks().forEach(track => track.stop())
      this.stream = null
    }

    this.mediaRecorder = null
    this.chunkSequence = 0 // é‡ç½®åºè™Ÿ
  }

  /**
   * ç²å–éŒ„è£½ç‹€æ…‹
   */
  get isRecording(): boolean {
    return this.mediaRecorder !== null && this.mediaRecorder.state === 'recording'
  }

  /**
   * ç²å–ç•¶å‰åºè™Ÿ
   */
  get currentSequence(): number {
    return this.chunkSequence
  }

  // æ¸…ç†è³‡æº
  cleanup(): void {
    this.stop()

    if (this.stream) {
      this.stream.getTracks().forEach(track => track.stop())
      this.stream = null
    }

    this.mediaRecorder = null
    console.log('ğŸ§¹ éŸ³è¨ŠéŒ„è£½å™¨å·²æ¸…ç†')
  }

  // è¨­å®šç‹€æ…‹
  private setState(newState: AudioRecorderState): void {
    this.state = newState
    this.onStateChangeCallback?.(newState)
  }

  // éŒ¯èª¤è™•ç†
  private handleError(error: Error): void {
    console.error('âŒ AudioRecorder éŒ¯èª¤:', error)
    this.setState('error')
    this.onErrorCallback?.(error)
  }

  // äº‹ä»¶å›èª¿è¨­å®š
  onChunk(callback: (chunk: AudioChunk) => void): void {
    this.onChunkCallback = callback
  }

  onStateChange(callback: (state: AudioRecorderState) => void): void {
    this.onStateChangeCallback = callback
  }

  onError(callback: (error: Error) => void): void {
    this.onErrorCallback = callback
  }

  // Getter
  get currentState(): AudioRecorderState {
    return this.state
  }

  get currentConfig(): AudioRecorderConfig {
    return { ...this.config }
  }
}

// å·¥å» å‡½æ•¸
export const createAudioRecorder = (config?: Partial<AudioRecorderConfig>): AudioRecorder => {
  return new AudioRecorder(config)
}

/**
 * æª¢æŸ¥ç€è¦½å™¨éŸ³è¨ŠéŒ„è£½æ”¯æ´
 */
export async function checkAudioRecordingSupport(): Promise<{ isSupported: boolean; error?: string }> {
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API' }
  }

  if (!window.MediaRecorder) {
    return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API' }
  }

  // æª¢æŸ¥ MIME é¡å‹æ”¯æ´
  if (!MediaRecorder.isTypeSupported(DEFAULT_CONFIG.mimeType)) {
    return { isSupported: false, error: `ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${DEFAULT_CONFIG.mimeType}` }
  }

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
    // ç«‹å³åœæ­¢ä¸²æµä»¥é‡‹æ”¾è³‡æº
    stream.getTracks().forEach(track => track.stop())
    return { isSupported: true }
  } catch (error) {
    return { isSupported: false, error: `ç„¡æ³•ç²å–éº¥å…‹é¢¨æ¬Šé™: ${error}` }
  }
}


# END FILE CONTENTS


# File: frontend/__tests__/integration/websocket-state-sync.test.ts

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { renderHook, act } from '@testing-library/react'
import { createElement } from 'react'
import { AppStateProvider } from '../../hooks/use-app-state-context'
import { useTranscriptNew } from '../../hooks/use-transcript-new'
import { featureFlagManager } from '../../lib/feature-flags'
import type { ReactNode } from 'react'

// Mock WebSocket
class MockWebSocket {
    onopen: ((event: Event) => void) | null = null
    onmessage: ((event: MessageEvent) => void) | null = null
    onerror: ((event: Event) => void) | null = null
    onclose: ((event: CloseEvent) => void) | null = null
    readyState = 0 // WebSocket.CONNECTING

    constructor(public url: string) {
        // æ¨¡æ“¬ç•°æ­¥é€£æ¥
        setTimeout(() => {
            this.readyState = 1 // WebSocket.OPEN
            if (this.onopen) {
                this.onopen(new Event('open'))
            }
        }, 10)
    }

    send(data: string) {
        // æ¨¡æ“¬ç™¼é€æ•¸æ“š
    }

    close() {
        this.readyState = 3 // WebSocket.CLOSED
        if (this.onclose) {
            this.onclose(new CloseEvent('close'))
        }
    }

    // æ¨¡æ“¬æ¥æ”¶æ¶ˆæ¯
    simulateMessage(data: any) {
        if (this.onmessage) {
            this.onmessage(new MessageEvent('message', { data: JSON.stringify(data) }))
        }
    }

    // æ¨¡æ“¬éŒ¯èª¤
    simulateError() {
        if (this.onerror) {
            this.onerror(new Event('error'))
        }
    }
}

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
    clear: vi.fn(),
}

Object.defineProperty(window, 'localStorage', {
    value: localStorageMock
})

// Mock WebSocket globally
Object.defineProperty(window, 'WebSocket', {
    value: MockWebSocket
})

function TestWrapper({ children }: { children: ReactNode }) {
    return createElement(AppStateProvider, null, children)
}

describe('WebSocket èˆ‡ç‹€æ…‹åŒæ­¥æ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        featureFlagManager.reset()
        featureFlagManager.enable('useNewStateManagement')
        featureFlagManager.enable('useNewTranscriptHook')
        localStorageMock.getItem.mockReturnValue(null)
    })

    describe('WebSocket é€£æ¥ç®¡ç†', () => {
        test('æ‡‰è©²èƒ½å¤ å»ºç«‹ WebSocket é€£æ¥', async () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // åˆå§‹ç‹€æ…‹æ‡‰è©²æ˜¯æœªé€£æ¥
            expect(result.current.isConnected).toBe(false)

            // é€™è£¡æˆ‘å€‘ç„¡æ³•ç›´æ¥æ¸¬è©¦ WebSocket é€£æ¥ï¼Œå› ç‚ºå®ƒåœ¨ TranscriptManager ä¸­
            // ä½†æˆ‘å€‘å¯ä»¥æ¸¬è©¦ Hook çš„åŸºæœ¬åŠŸèƒ½
            expect(result.current.error).toBe(null)
            expect(result.current.autoScrollEnabled).toBe(true)
        })

        test('æ‡‰è©²æä¾› WebSocket æ§åˆ¶æ–¹æ³•', () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æª¢æŸ¥æ‰€æœ‰å¿…è¦çš„æ–¹æ³•éƒ½å­˜åœ¨
            expect(typeof result.current.disconnect).toBe('function')
            expect(typeof result.current.clearTranscripts).toBe('function')
            expect(typeof result.current.enableAutoScroll).toBe('function')
            expect(typeof result.current.disableAutoScroll).toBe('function')
            expect(typeof result.current.scrollToLatest).toBe('function')
        })

        test('æ‡‰è©²èƒ½å¤ æ§åˆ¶è‡ªå‹•æ»¾å‹•', async () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // åˆå§‹ç‹€æ…‹ï¼šè‡ªå‹•æ»¾å‹•å•Ÿç”¨
            expect(result.current.autoScrollEnabled).toBe(true)

            // ç¦ç”¨è‡ªå‹•æ»¾å‹•
            await act(async () => {
                result.current.disableAutoScroll()
            })

            expect(result.current.autoScrollEnabled).toBe(false)

            // å•Ÿç”¨è‡ªå‹•æ»¾å‹•
            await act(async () => {
                result.current.enableAutoScroll()
            })

            expect(result.current.autoScrollEnabled).toBe(true)
        })
    })

    describe('ç‹€æ…‹åŒæ­¥', () => {
        test('Hook æ‡‰è©²èˆ‡ Context ç‹€æ…‹ä¿æŒåŒæ­¥', () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æª¢æŸ¥ Hook è¿”å›çš„ç‹€æ…‹çµæ§‹
            expect(result.current).toHaveProperty('isConnected')
            expect(result.current).toHaveProperty('error')
            expect(result.current).toHaveProperty('autoScrollEnabled')
            expect(result.current).toHaveProperty('disconnect')
            expect(result.current).toHaveProperty('clearTranscripts')
        })

        test('æ¸…é™¤é€å­—ç¨¿æ‡‰è©²æ­£å¸¸å·¥ä½œ', async () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æ¸…é™¤é€å­—ç¨¿ä¸æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
            await act(async () => {
                expect(() => result.current.clearTranscripts()).not.toThrow()
            })
        })

        test('æ–·é–‹é€£æ¥æ‡‰è©²æ­£å¸¸å·¥ä½œ', async () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æ–·é–‹é€£æ¥ä¸æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
            await act(async () => {
                expect(() => result.current.disconnect()).not.toThrow()
            })
        })
    })

    describe('éŒ¯èª¤è™•ç†', () => {
        test('æ‡‰è©²æ­£ç¢ºè™•ç† WebSocket éŒ¯èª¤', () => {
            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // åˆå§‹éŒ¯èª¤ç‹€æ…‹æ‡‰è©²æ˜¯ null
            expect(result.current.error).toBe(null)
        })

        test('Hook unmount æ‡‰è©²æ¸…ç†è³‡æº', () => {
            const { unmount } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // unmount æ‡‰è©²æ­£å¸¸åŸ·è¡Œè€Œä¸æ‹‹å‡ºéŒ¯èª¤
            expect(() => unmount()).not.toThrow()
        })
    })

    describe('åŠŸèƒ½é–‹é—œæ•´åˆ', () => {
        test('ç•¶åŠŸèƒ½é–‹é—œé—œé–‰æ™‚æ‡‰è©²ä½¿ç”¨èˆŠç‰ˆæœ¬', () => {
            // ç¦ç”¨æ–°çš„ Transcript Hook
            featureFlagManager.disable('useNewTranscriptHook')

            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æ‡‰è©²ä»ç„¶æä¾›ç›¸åŒçš„ API
            expect(result.current).toHaveProperty('isConnected')
            expect(result.current).toHaveProperty('error')
            expect(result.current).toHaveProperty('autoScrollEnabled')
        })

        test('ç•¶åŠŸèƒ½é–‹é—œå•Ÿç”¨æ™‚æ‡‰è©²ä½¿ç”¨æ–°ç‰ˆæœ¬', () => {
            // ç¢ºä¿æ–°åŠŸèƒ½é–‹é—œå•Ÿç”¨
            featureFlagManager.enable('useNewTranscriptHook')

            const { result } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // æ‡‰è©²æä¾›å®Œæ•´çš„ API
            expect(result.current).toHaveProperty('isConnected')
            expect(result.current).toHaveProperty('error')
            expect(result.current).toHaveProperty('autoScrollEnabled')
            expect(result.current).toHaveProperty('disconnect')
            expect(result.current).toHaveProperty('clearTranscripts')
        })
    })

    describe('å¤šå¯¦ä¾‹æ¸¬è©¦', () => {
        test('å¤šå€‹ Hook å¯¦ä¾‹æ‡‰è©²å…±äº« TranscriptManager', () => {
            const { result: result1 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })
            const { result: result2 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // å…©å€‹å¯¦ä¾‹æ‡‰è©²æœ‰ç›¸åŒçš„é€£æ¥ç‹€æ…‹
            expect(result1.current.isConnected).toBe(result2.current.isConnected)
            expect(result1.current.error).toBe(result2.current.error)
        })

        test('ä¸€å€‹å¯¦ä¾‹çš„æ“ä½œæ‡‰è©²å½±éŸ¿å…¶ä»–å¯¦ä¾‹', async () => {
            const { result: result1 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })
            const { result: result2 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // å¾ç¬¬ä¸€å€‹å¯¦ä¾‹ç¦ç”¨è‡ªå‹•æ»¾å‹•
            await act(async () => {
                result1.current.disableAutoScroll()
            })

            // ç¬¬äºŒå€‹å¯¦ä¾‹æ‡‰è©²åæ˜ ç›¸åŒçš„ç‹€æ…‹
            expect(result2.current.autoScrollEnabled).toBe(false)
        })
    })

    describe('è¨˜æ†¶é«”ç®¡ç†', () => {
        test('Hook æ‡‰è©²æ­£ç¢ºæ¸…ç†è³‡æº', () => {
            const { unmount } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })

            // å¤šæ¬¡ mount/unmount æ‡‰è©²ç©©å®š
            for (let i = 0; i < 3; i++) {
                unmount()
                const { unmount: newUnmount } = renderHook(() => useTranscriptNew(), {
                    wrapper: TestWrapper
                })
                expect(() => newUnmount()).not.toThrow()
            }
        })

        test('Context unmount ä¸æ‡‰è©²å½±éŸ¿ TranscriptManager', () => {
            let unmount1: () => void
            let unmount2: () => void

            // ç¬¬ä¸€å€‹ Provider
            const { unmount: u1 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })
            unmount1 = u1

            // ç¬¬äºŒå€‹ Provider
            const { unmount: u2 } = renderHook(() => useTranscriptNew(), {
                wrapper: TestWrapper
            })
            unmount2 = u2

            // æ¸…ç†ç¬¬ä¸€å€‹ä¸æ‡‰è©²å½±éŸ¿ç¬¬äºŒå€‹
            expect(() => unmount1()).not.toThrow()
            expect(() => unmount2()).not.toThrow()
        })
    })
})


# END FILE CONTENTS


# File: .cursor/rules/rules.mdc

---
description:
globs:
alwaysApply: true
---
<!-- Source:
1. https://tidyfirst.substack.com/p/augmented-coding-beyond-the-vibes
2. https://github.com/arthow4n/live-language-mate/blob/master/CLAUDE.md -->

You are a senior software engineer who follows Kent Beck's Test-Driven Development (TDD) and Tidy First principles. Your purpose is to guide development following these methodologies precisely.


# Basic Rules

1. If the project has a PRD or SPEC, read them carefully to ensure that what you're doing is consistent and aligned with the correct objectives.
2. When you are coding or implementing the test, implement only enough code to fulfill that need or make the test pass.


# User Preferences

-  **Language Preference**: Communicate using Traditional Chinese (zh-tw) from Taiwan
-  **Simplicity Principle**: Avoid overly complex tool settings and configuration files


## Planning and task management

- Prioritize the use of Task Manager for task analysis and scheduling.
- When executing tasks from the Todos checklist, report and explain after completing each task, check it off, and then proceed to the next task.
- You are meant to work on your own unattended once the user has approved your initial work plan, you should plan ahead for working on your own.
- When planning, the plan is always for yourself to be able to follow the plan and work on the task immediately after the plan is approved by the user.
- When planning, automatically break down the task into smaller tasks and utilise the TodoRead & TodoWrite tools.
- When planning, plan ahead to see if you need to update any tests.
- When planning, think and review the plan yourself to see if you are over-engineering, you should focus on only making the absolutely relevant and needed chagnes. You need to review your own plan at least review 2 times.
- When planning is completed, write the spec to  ./docs as a markdown, using its functionality as the filename.
- Before you start working, make sure to step back and break down the plan into smaller todo items.


## Development process

- You should do TDD:
  1. Review the code paths that will be tested from beginning to end, then think how to write the correct test case.
  2. Write a test case that is failing, which will be fixed after correct implementation.
  3. Start implementation.
  4. Fix until test passes.
  5. Commit and push after each task is done.
- If test is failng more than 3 times in a row, step back and read again the code path from beginning to end, think how to address the issue systematically before you rerun the test again.
- Question yourself are your soution and test addressing what the user asked for.
- Always use environment-variable config files for clean, unified managementâ€”never hard-code.
- Don't skip anything in your todo.

# CORE DEVELOPMENT PRINCIPLES

- Always follow the TDD cycle: Red â†’ Green â†’ Refactor

- Write the simplest failing test first

- Implement the minimum code needed to make tests pass

- Refactor only after tests are passing

- Follow Beck's "Tidy First" approach by separating structural changes from behavioral changes

- Maintain high code quality throughout development

# TDD METHODOLOGY GUIDANCE

- Start by writing a failing test that defines a small increment of functionality

- Use meaningful test names that describe behavior (e.g., "shouldSumTwoPositiveNumbers")

- Make test failures clear and informative

- Write just enough code to make the test pass - no more

- Once tests pass, consider if refactoring is needed

- Repeat the cycle for new functionality

# TIDY FIRST APPROACH

- Separate all changes into two distinct types:

1. STRUCTURAL CHANGES: Rearranging code without changing behavior (renaming, extracting methods, moving code)

2. BEHAVIORAL CHANGES: Adding or modifying actual functionality

- Never mix structural and behavioral changes in the same commit

- Always make structural changes first when both are needed

# CODE QUALITY STANDARDS

- Eliminate duplication ruthlessly

- Express intent clearly through naming and structure

- Make dependencies explicit

- Keep methods small and focused on a single responsibility

- Minimize state and side effects

- Use the simplest solution that could possibly work

# REFACTORING GUIDELINES

- Refactor only when tests are passing (in the "Green" phase)

- Use established refactoring patterns with their proper names

- Make one refactoring change at a time

- Run tests after each refactoring step

- Prioritize refactorings that remove duplication or improve clarity

# EXAMPLE WORKFLOW

When approaching a new feature:

1. Write a simple failing test for a small part of the feature

2. Implement the bare minimum to make it pass

3. Run tests to confirm they pass (Green)

4. Make any necessary structural changes (Tidy First), running tests after each change

5. Commit structural changes separately

6. Add another test for the next small increment of functionality

7. Repeat until the feature is complete, committing behavioral changes separately from structural ones

Follow this process precisely, always prioritizing clean, well-tested code over quick implementation.

Always write one test at a time, make it run, then improve structure. Always run all the tests (except long-running tests) each time.



# Engineering mindset

- You should follow the existing code style, if you are about to implement something new or write a new test, search for existing files to understand the current style and convention.
- You should actively look for reusing shared function/component/hook etc, and search for another potentially extractable/sharable code to move to shared code.
- Avoid over-engineering. Keep thinking and reviewing whether if your solution is over-engineered, step back, look around and see if you can simplify your solution and its related code paths and only make the absolutely necessary changes.
- For asynchronous logic flow, no matter in test, code or UI, make sure to implement them in a way where the cause and effect can be logically followed, for example by using async-await, event handler, or callback. Avoid using timeout/polling to handle asynchronous logic flow, if timeout/polling is really the only way to implement the logic, make sure to comment why timeout/polling is used instead of the other better approaches.
- Don't leave unnecessary comment, unmaintained comment can become stale and adds confusion. You should only leave comment for explaining the motivation behind the code, not to repeat what the code is doing.
- Make sure your code can be logically followed, there should not be implicit flow.
- Make sure the cause and effect in the code flow is deterministic, you should not cause race condition.
- If you belive something might be caused by a race condition or a timing issue, you should default to step back and read through all the related code paths from beginning to end, and then make a comprehensive argument about why it's really a race condition or timing issue. This is to make sure you don't just blindly guess and fix the wrong problem.

# Tool usage

- Always use MCP tools, including Serena and Context7, for research and feasibility analysis evaluation before editing code.
- Batch your tool calls, use many tools at once.


# Other Rules

Always follow the instructions in these rules:

- @frontend.mdc
- @backend.mdc
- @ui-rules/shadcn-tailwind-ui-guideline.mdc



# END FILE CONTENTS


# File: frontend/lib/stream/__tests__/audio-uploader.test.ts

import { describe, test, expect, beforeEach, vi, afterEach } from 'vitest'
import { AudioUploader } from '../audio-uploader'

// Mock WebSocket
class MockWebSocket {
    static CONNECTING = 0
    static OPEN = 1
    static CLOSING = 2
    static CLOSED = 3

    readyState: number = MockWebSocket.CONNECTING
    onopen: ((event: Event) => void) | null = null
    onclose: ((event: CloseEvent) => void) | null = null
    onerror: ((event: Event) => void) | null = null
    onmessage: ((event: MessageEvent) => void) | null = null

    send = vi.fn()
    close = vi.fn()

    constructor(public url: string) {
        // æ¨¡æ“¬ç•°æ­¥é€£æ¥
        setTimeout(() => {
            this.readyState = MockWebSocket.OPEN
            this.onopen?.(new Event('open'))
        }, 10)
    }

    // æ¨¡æ“¬é€£æ¥é—œé–‰
    simulateClose(wasClean: boolean = true, code: number = 1000, reason: string = '') {
        this.readyState = MockWebSocket.CLOSED
        const closeEvent = new CloseEvent('close', { wasClean, code, reason })
        this.onclose?.(closeEvent)
    }

    // æ¨¡æ“¬æ”¶åˆ°æ¶ˆæ¯
    simulateMessage(data: any) {
        const messageEvent = new MessageEvent('message', { data: JSON.stringify(data) })
        this.onmessage?.(messageEvent)
    }

    // æ¨¡æ“¬éŒ¯èª¤
    simulateError() {
        this.onerror?.(new Event('error'))
    }
}

// Mock å…¨å±€ WebSocket
Object.defineProperty(global, 'WebSocket', {
    writable: true,
    value: MockWebSocket,
})

// Mock ç’°å¢ƒè®Šæ•¸
const originalEnv = process.env
beforeEach(() => {
    process.env = { ...originalEnv }
    process.env.NEXT_PUBLIC_WS_URL = 'ws://localhost:8000'
})

afterEach(() => {
    process.env = originalEnv
})

describe('AudioUploader', () => {
    let uploader: AudioUploader
    let mockWebSocket: MockWebSocket

    beforeEach(() => {
        vi.clearAllMocks()
        uploader = new AudioUploader()

        // æ””æˆª WebSocket å‰µå»º
        const originalWebSocket = global.WebSocket
        global.WebSocket = vi.fn((url: string) => {
            mockWebSocket = new MockWebSocket(url)
            return mockWebSocket
        }) as any
    })

    afterEach(() => {
        uploader.close()
    })

    describe('é€£æ¥ç®¡ç†', () => {
        test('æ‡‰è©²æˆåŠŸå»ºç«‹ WebSocket é€£æ¥', async () => {
            const connectPromise = uploader.connect('test-session-id')

            // ç­‰å¾…é€£æ¥å®Œæˆ
            await connectPromise

            expect(uploader.isConnected).toBe(true)
            expect(uploader.currentSessionId).toBe('test-session-id')
            expect(uploader.currentSequence).toBe(0)
        })

        test('æ‡‰è©²ä½¿ç”¨æ­£ç¢ºçš„ WebSocket URL', async () => {
            await uploader.connect('test-session-id')

            expect(global.WebSocket).toHaveBeenCalledWith(
                'ws://localhost:8000/ws/upload_audio/test-session-id'
            )
        })

        test('æ‡‰è©²åœ¨é€£æ¥æ™‚é‡ç½®ç‹€æ…‹', async () => {
            // å…ˆç™¼é€ä¸€äº›æ•¸æ“šä¾†æ”¹è®Šåºè™Ÿ
            await uploader.connect('session-1')
            uploader.send(new Blob(['test']))

            expect(uploader.currentSequence).toBe(1)

            // é‡æ–°é€£æ¥æ‡‰è©²é‡ç½®
            await uploader.connect('session-2')

            expect(uploader.currentSequence).toBe(0)
            expect(uploader.currentSessionId).toBe('session-2')
        })

        test('æ‡‰è©²æ­£ç¢ºé—œé–‰é€£æ¥', () => {
            uploader.close()

            expect(uploader.isConnected).toBe(false)
            expect(uploader.currentSessionId).toBe(null)
            expect(uploader.currentSequence).toBe(0)
        })
    })

    describe('æ•¸æ“šå‚³é€', () => {
        beforeEach(async () => {
            await uploader.connect('test-session-id')
        })

        test('æ‡‰è©²æ­£ç¢ºç™¼é€éŸ³è¨Šæ•¸æ“š', () => {
            const testBlob = new Blob(['test audio data'], { type: 'audio/webm' })

            uploader.send(testBlob)

            // æ‡‰è©²ç™¼é€å…©æ¬¡ï¼šåºè™Ÿ + æ•¸æ“š
            expect(mockWebSocket.send).toHaveBeenCalledTimes(2)

            // é©—è­‰åºè™Ÿç™¼é€ï¼ˆ4 å­—ç¯€ï¼‰
            const sequenceCall = mockWebSocket.send.mock.calls[0][0]
            expect(sequenceCall).toBeInstanceOf(ArrayBuffer)
            expect(sequenceCall.byteLength).toBe(4)

            // é©—è­‰æ•¸æ“šç™¼é€
            const blobCall = mockWebSocket.send.mock.calls[1][0]
            expect(blobCall).toBe(testBlob)
        })

        test('æ‡‰è©²æ­£ç¢ºéå¢åºè™Ÿ', () => {
            const blob1 = new Blob(['audio 1'])
            const blob2 = new Blob(['audio 2'])

            uploader.send(blob1)
            uploader.send(blob2)

            expect(uploader.currentSequence).toBe(2)
            expect(mockWebSocket.send).toHaveBeenCalledTimes(4) // 2 åºè™Ÿ + 2 æ•¸æ“š
        })

        test('æ‡‰è©²æ”¯æ´è‡ªè¨‚åºè™Ÿç™¼é€', () => {
            const testBlob = new Blob(['test'])

            uploader.send(testBlob, 42)

            // å…§éƒ¨åºè™Ÿä¸æ‡‰è©²æ”¹è®Š
            expect(uploader.currentSequence).toBe(0)

            // ä½†æ‡‰è©²ç™¼é€æŒ‡å®šçš„åºè™Ÿ
            const sequenceCall = mockWebSocket.send.mock.calls[0][0]
            const view = new DataView(sequenceCall)
            expect(view.getUint32(0, false)).toBe(42) // big-endian
        })

        test('æ‡‰è©²è™•ç† WebSocket æœªé€£æ¥çš„æƒ…æ³', () => {
            mockWebSocket.readyState = MockWebSocket.CLOSED

            const testBlob = new Blob(['test'])
            uploader.send(testBlob)

            // ä¸æ‡‰è©²ç™¼é€ä»»ä½•æ•¸æ“š
            expect(mockWebSocket.send).not.toHaveBeenCalled()
        })
    })

    describe('é‡é€£æ©Ÿåˆ¶', () => {
        beforeEach(async () => {
            await uploader.connect('test-session-id')
        })

        test('æ‡‰è©²åœ¨éæ­£å¸¸é—œé–‰æ™‚å˜—è©¦é‡é€£', async () => {
            // æ¨¡æ“¬éæ­£å¸¸é—œé–‰
            mockWebSocket.simulateClose(false, 1006, 'Connection lost')

            // ç­‰å¾…é‡é€£é‚è¼¯è§¸ç™¼
            await new Promise(resolve => setTimeout(resolve, 100))

            // æ‡‰è©²å˜—è©¦é‡æ–°å‰µå»º WebSocket
            expect(global.WebSocket).toHaveBeenCalledTimes(2)
        })

        test('æ‡‰è©²åœ¨æ­£å¸¸é—œé–‰æ™‚ä¸å˜—è©¦é‡é€£', () => {
            const originalCreateWebSocket = global.WebSocket

            // æ¨¡æ“¬æ­£å¸¸é—œé–‰
            mockWebSocket.simulateClose(true, 1000, 'Normal closure')

            // ä¸æ‡‰è©²å˜—è©¦é‡é€£
            expect(global.WebSocket).toHaveBeenCalledTimes(1)
        })

        test('æ‡‰è©²æœ‰é‡é€£æ¬¡æ•¸é™åˆ¶', async () => {
            // æ¨¡æ“¬é€£çºŒå¤±æ•—çš„é‡é€£
            const originalConnect = uploader.connect
            let connectCallCount = 0

            uploader.connect = vi.fn().mockImplementation(() => {
                connectCallCount++
                if (connectCallCount <= 5) {
                    throw new Error('Connection failed')
                }
                return originalConnect.call(uploader, 'test-session-id')
            })

            // è§¸ç™¼é‡é€£
            mockWebSocket.simulateClose(false, 1006, 'Connection lost')

            // ç­‰å¾…é‡é€£å˜—è©¦
            await new Promise(resolve => setTimeout(resolve, 200))

            // æ‡‰è©²æœ‰é‡é€£æ¬¡æ•¸é™åˆ¶
            expect(connectCallCount).toBeLessThanOrEqual(5)
        })
    })

    describe('ä¼ºæœå™¨æ¶ˆæ¯è™•ç†', () => {
        beforeEach(async () => {
            await uploader.connect('test-session-id')
        })

        test('æ‡‰è©²è™•ç† ACK æ¶ˆæ¯', () => {
            const consoleSpy = vi.spyOn(console, 'log').mockImplementation(() => { })

            mockWebSocket.simulateMessage({
                type: 'ack',
                chunk_sequence: 5
            })

            expect(consoleSpy).toHaveBeenCalledWith(
                expect.stringContaining('éŸ³è¨Šåˆ‡ç‰‡ #5 ç¢ºèªæ”¶åˆ°')
            )

            consoleSpy.mockRestore()
        })

        test('æ‡‰è©²è™•ç†ä¸Šå‚³éŒ¯èª¤æ¶ˆæ¯', () => {
            const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => { })

            mockWebSocket.simulateMessage({
                type: 'upload_error',
                chunk_sequence: 3,
                error: 'Upload failed'
            })

            expect(consoleSpy).toHaveBeenCalledWith(
                expect.stringContaining('ä¸Šå‚³éŒ¯èª¤ #3'),
                'Upload failed'
            )

            consoleSpy.mockRestore()
        })

        test('æ‡‰è©²è™•ç†é€£æ¥å»ºç«‹æ¶ˆæ¯', () => {
            const consoleSpy = vi.spyOn(console, 'log').mockImplementation(() => { })

            mockWebSocket.simulateMessage({
                type: 'connection_established'
            })

            expect(consoleSpy).toHaveBeenCalledWith(
                expect.stringContaining('é€£æ¥å·²å»ºç«‹')
            )

            consoleSpy.mockRestore()
        })

        test('æ‡‰è©²è™•ç†é JSON æ¶ˆæ¯', () => {
            const consoleSpy = vi.spyOn(console, 'log').mockImplementation(() => { })

            // æ¨¡æ“¬é JSON æ•¸æ“š
            const messageEvent = new MessageEvent('message', { data: 'plain text' })
            mockWebSocket.onmessage?.(messageEvent)

            expect(consoleSpy).toHaveBeenCalledWith(
                expect.stringContaining('æ”¶åˆ°é JSON æ¶ˆæ¯'),
                'plain text'
            )

            consoleSpy.mockRestore()
        })
    })

    describe('é–‹ç™¼æ¨¡å¼è¨ºæ–·', () => {
        const originalNodeEnv = process.env.NODE_ENV

        beforeEach(async () => {
            // ä½¿ç”¨ vi.stubEnv ä¾†æ¨¡æ“¬ç’°å¢ƒè®Šæ•¸
            vi.stubEnv('NODE_ENV', 'development')
            await uploader.connect('test-session-id')

            // æ¸…é™¤ window.__rec
            delete (window as any).__rec
        })

        afterEach(() => {
            vi.unstubAllEnvs()
        })

        test('æ‡‰è©²åœ¨é–‹ç™¼æ¨¡å¼ä¸‹è¨˜éŒ„è¨ºæ–·ä¿¡æ¯', () => {
            const testBlob = new Blob(['test'], { type: 'audio/webm' })

            uploader.send(testBlob)

            expect((window as any).__rec).toBeDefined()
            expect((window as any).__rec.chunksSent).toBe(1)
            expect((window as any).__rec.totalBytes).toBe(testBlob.size)
            expect((window as any).__rec.sessionId).toBe('test-session-id')
        })

        test('æ‡‰è©²ç´¯ç©è¨ºæ–·çµ±è¨ˆ', () => {
            const blob1 = new Blob(['data1'])
            const blob2 = new Blob(['data2'])

            uploader.send(blob1)
            uploader.send(blob2)

            const rec = (window as any).__rec
            expect(rec.chunksSent).toBe(2)
            expect(rec.totalBytes).toBe(blob1.size + blob2.size)
            expect(rec.lastSequence).toBe(1)
        })
    })

    describe('é€£æ¥ç‹€æ…‹', () => {
        test('æ‡‰è©²æ­£ç¢ºå ±å‘Šé€£æ¥ç‹€æ…‹', async () => {
            expect(uploader.connectionState).toBe('NOT_CREATED')

            const connectPromise = uploader.connect('test-session-id')
            expect(uploader.connectionState).toBe('CONNECTING')

            await connectPromise
            expect(uploader.connectionState).toBe('OPEN')

            uploader.close()
            expect(uploader.connectionState).toBe('NOT_CREATED')
        })

        test('æ‡‰è©²æ­£ç¢ºæª¢æŸ¥é€£æ¥ç‹€æ…‹', async () => {
            expect(uploader.isConnected).toBe(false)

            await uploader.connect('test-session-id')
            expect(uploader.isConnected).toBe(true)

            uploader.close()
            expect(uploader.isConnected).toBe(false)
        })
    })
})


# END FILE CONTENTS


# File: playwright.config.ts

 

# END FILE CONTENTS


# File: frontend/components/recording-waiting-state.tsx

"use client"

import { useState, useCallback } from "react"
import { ScrollArea } from "@/components/ui/scroll-area"
import { Button } from "@/components/ui/button"
import { Square, AlertCircle } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"
import type { TranscriptEntry } from "../types/app-state"

interface RecordingWaitingStateProps {
    recordingTime: number
    onStopRecording: () => void
    transcriptEntries: TranscriptEntry[]
    error?: string | null
}

export function RecordingWaitingState({
    recordingTime,
    onStopRecording,
    transcriptEntries,
    error
}: RecordingWaitingStateProps) {
    const [isAutoScrollLocked, setIsAutoScrollLocked] = useState(true)

    const toggleAutoScrollLock = useCallback(() => {
        setIsAutoScrollLocked(prev => !prev)
    }, [])

    const formatTime = (seconds: number) => {
        const mins = Math.floor(seconds / 60)
        const secs = seconds % 60
        return `${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`
    }

    return (
        <div className="h-full flex flex-col">
            <ScrollArea className="flex-1">
                {error && (
                    <Alert variant="destructive" className="m-4">
                        <AlertCircle className="h-4 w-4" />
                        <AlertDescription>{error}</AlertDescription>
                    </Alert>
                )}

                {transcriptEntries.length > 0 ? (
                    <div className="p-4 space-y-4">
                        {transcriptEntries.map((entry, index) => (
                            <div key={index} className="flex gap-4 text-sm">
                                <span className="text-muted-foreground font-mono">{entry.time}</span>
                                <span className="flex-1">{entry.text}</span>
                            </div>
                        ))}
                    </div>
                ) : (
                    <div className="flex flex-col items-center justify-center h-full p-8 text-muted-foreground text-center space-y-2">
                        <div className="text-sm">
                            Recordingâ€¦ {formatTime(recordingTime)}
                        </div>
                        <div className="text-xs">
                            {error ? "è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤" : "è½‰éŒ„ä¸­"}
                        </div>
                    </div>
                )}
            </ScrollArea>

            <div className="p-4 border-t border-border flex justify-end">
                <Button onClick={onStopRecording} variant="destructive" size="sm" className="flex items-center gap-2">
                    <Square className="w-4 h-4" />
                    Stop
                </Button>
            </div>
        </div>
    )
}


# END FILE CONTENTS


# File: frontend/components/ui/table.tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}


# END FILE CONTENTS


# File: app/lib/httpx_timeout.py

from httpx import Timeout
from app.core.config import get_settings

def get_httpx_timeout() -> Timeout:
    """
    ä¾æ“šè¨­å®šæª”å›å‚³ httpx.Timeout ç‰©ä»¶ã€‚
    é€™æ¨£ä»»ä½• provider å¼•ç”¨æ™‚éƒ½ä¸æœƒ NameErrorã€‚
    """
    s = get_settings()
    return Timeout(
        connect=s.HTTPX_CONNECT_TIMEOUT,   # e.g. 5
        read=s.HTTPX_READ_TIMEOUT,         # 55
        write=s.HTTPX_WRITE_TIMEOUT,       # 30
        pool=s.HTTPX_POOL_TIMEOUT,         # 5
    )


# END FILE CONTENTS


# File: frontend/components/upload-status-indicator.tsx

"use client"

import { useState, useEffect } from 'react'
import { Button } from './ui/button'
import { Alert, AlertDescription } from './ui/alert'
import { Badge } from './ui/badge'
import { RefreshCw, Upload, AlertTriangle, CheckCircle, Wifi, WifiOff } from 'lucide-react'
import { restAudioUploader } from '../lib/rest-audio-uploader'

interface UploadStats {
    uploaded: number
    failed: number
    cached: number
    retrying: boolean
}

interface UploadStatusIndicatorProps {
    sessionId?: string
    isRecording?: boolean
    className?: string
}

/**
 * UploadStatusIndicator - ä¸Šå‚³ç‹€æ…‹æŒ‡ç¤ºå™¨
 *
 * Phase 2 é‡æ§‹ï¼šé¡¯ç¤º REST API ä¸Šå‚³ç‹€æ…‹
 *
 * åŠŸèƒ½ï¼š
 * - é¡¯ç¤ºä¸Šå‚³çµ±è¨ˆï¼ˆæˆåŠŸ/å¤±æ•—/æš«å­˜ï¼‰
 * - æç¤ºæš«å­˜æª”æ¡ˆå¯é‡æ–°ä¸Šå‚³
 * - æ”¯æ´æ‰‹å‹•é‡è©¦åŠŸèƒ½
 * - ç¶²è·¯ç‹€æ…‹æŒ‡ç¤º
 */
export function UploadStatusIndicator({
    sessionId,
    isRecording = false,
    className = ""
}: UploadStatusIndicatorProps) {
    const [uploadStats, setUploadStats] = useState<UploadStats>({
        uploaded: 0,
        failed: 0,
        cached: 0,
        retrying: false
    })
    const [isOnline, setIsOnline] = useState(true)
    const [lastUpdate, setLastUpdate] = useState(Date.now())

    // ç›£è½ç¶²è·¯ç‹€æ…‹
    useEffect(() => {
        const handleOnline = () => setIsOnline(true)
        const handleOffline = () => setIsOnline(false)

        window.addEventListener('online', handleOnline)
        window.addEventListener('offline', handleOffline)

        return () => {
            window.removeEventListener('online', handleOnline)
            window.removeEventListener('offline', handleOffline)
        }
    }, [])

    // è¨­ç½®ä¸Šå‚³å™¨äº‹ä»¶ç›£è½
    useEffect(() => {
        if (!sessionId) return

        restAudioUploader.setSessionId(sessionId)

        // ç›£è½ä¸Šå‚³æˆåŠŸ
        const handleUploadSuccess = (seq: number) => {
            setUploadStats(prev => ({
                ...prev,
                uploaded: prev.uploaded + 1
            }))
            setLastUpdate(Date.now())
        }

        // ç›£è½ä¸Šå‚³å¤±æ•—
        const handleUploadError = (seq: number) => {
            setUploadStats(prev => ({
                ...prev,
                failed: prev.failed + 1
            }))
            setLastUpdate(Date.now())
        }

        // ç›£è½æš«å­˜åˆ°æœ¬åœ°
        const handleCacheStored = (seq: number) => {
            setUploadStats(prev => ({
                ...prev,
                cached: prev.cached + 1
            }))
            setLastUpdate(Date.now())
        }

        restAudioUploader.onUploadSuccess(handleUploadSuccess)
        restAudioUploader.onUploadError(handleUploadError)
        restAudioUploader.onCacheStored(handleCacheStored)

        return () => {
            // æ¸…ç†äº‹ä»¶ç›£è½å™¨
            restAudioUploader.onUploadSuccess(() => { })
            restAudioUploader.onUploadError(() => { })
            restAudioUploader.onCacheStored(() => { })
        }
    }, [sessionId])

    // å®šæœŸæ›´æ–°æš«å­˜æ•¸é‡
    useEffect(() => {
        const updateCachedCount = async () => {
            if (sessionId && restAudioUploader) {
                const count = await restAudioUploader.getCachedSegmentsCount()
                setUploadStats(prev => ({
                    ...prev,
                    cached: count
                }))
            }
        }

        updateCachedCount()
        const interval = setInterval(updateCachedCount, 10000) // æ¯ 10 ç§’æ›´æ–°ä¸€æ¬¡

        return () => clearInterval(interval)
    }, [sessionId])

    // é‡æ–°ä¸Šå‚³æš«å­˜æª”æ¡ˆ
    const handleRetryUploads = async () => {
        if (!sessionId || uploadStats.retrying) return

        setUploadStats(prev => ({ ...prev, retrying: true }))

        try {
            await restAudioUploader.retryFailedSegments()

            // æ›´æ–°æš«å­˜æ•¸é‡
            const newCachedCount = await restAudioUploader.getCachedSegmentsCount()
            setUploadStats(prev => ({
                ...prev,
                cached: newCachedCount,
                retrying: false
            }))

            console.log('âœ… [UploadStatusIndicator] é‡æ–°ä¸Šå‚³å®Œæˆ')
        } catch (error) {
            console.error('âŒ [UploadStatusIndicator] é‡æ–°ä¸Šå‚³å¤±æ•—:', error)
            setUploadStats(prev => ({ ...prev, retrying: false }))
        }
    }

    // å¦‚æœä¸åœ¨éŒ„éŸ³ä¸”æ²’æœ‰çµ±è¨ˆæ•¸æ“šï¼Œä¸é¡¯ç¤º
    if (!isRecording && uploadStats.uploaded === 0 && uploadStats.failed === 0 && uploadStats.cached === 0) {
        return null
    }

    return (
        <div className={`space-y-2 ${className}`}>
            {/* ç¶²è·¯ç‹€æ…‹æŒ‡ç¤º */}
            <div className="flex items-center gap-2 text-sm text-muted-foreground">
                {isOnline ? (
                    <Wifi className="h-4 w-4 text-green-500" />
                ) : (
                    <WifiOff className="h-4 w-4 text-red-500" />
                )}
                <span>{isOnline ? 'ç·šä¸Š' : 'é›¢ç·š'}</span>
            </div>

            {/* ä¸Šå‚³çµ±è¨ˆ */}
            <div className="flex items-center gap-2 flex-wrap">
                {uploadStats.uploaded > 0 && (
                    <Badge variant="default" className="flex items-center gap-1">
                        <CheckCircle className="h-3 w-3" />
                        å·²ä¸Šå‚³ {uploadStats.uploaded}
                    </Badge>
                )}

                {uploadStats.failed > 0 && (
                    <Badge variant="destructive" className="flex items-center gap-1">
                        <AlertTriangle className="h-3 w-3" />
                        å¤±æ•— {uploadStats.failed}
                    </Badge>
                )}

                {uploadStats.cached > 0 && (
                    <Badge variant="secondary" className="flex items-center gap-1">
                        <Upload className="h-3 w-3" />
                        æš«å­˜ {uploadStats.cached}
                    </Badge>
                )}
            </div>

            {/* æš«å­˜æª”æ¡ˆæç¤º */}
            {uploadStats.cached > 0 && (
                <Alert>
                    <AlertTriangle className="h-4 w-4" />
                    <AlertDescription className="flex items-center justify-between">
                        <span>
                            æœ‰ {uploadStats.cached} å€‹éŸ³é »æ®µè½æš«å­˜åœ¨æœ¬åœ°ã€‚
                            {isOnline ? 'å¯ä»¥é‡æ–°ä¸Šå‚³' : 'è«‹ç­‰å¾…ç¶²è·¯é€£ç·š'}
                        </span>
                        {isOnline && (
                            <Button
                                size="sm"
                                variant="outline"
                                onClick={handleRetryUploads}
                                disabled={uploadStats.retrying}
                                className="ml-2"
                            >
                                {uploadStats.retrying ? (
                                    <>
                                        <RefreshCw className="h-3 w-3 mr-1 animate-spin" />
                                        é‡æ–°ä¸Šå‚³ä¸­...
                                    </>
                                ) : (
                                    <>
                                        <Upload className="h-3 w-3 mr-1" />
                                        é‡æ–°ä¸Šå‚³
                                    </>
                                )}
                            </Button>
                        )}
                    </AlertDescription>
                </Alert>
            )}

            {/* éŒ„éŸ³æ™‚çš„å³æ™‚ç‹€æ…‹ */}
            {isRecording && (
                <div className="text-xs text-muted-foreground">
                    ä¸Šæ¬¡æ›´æ–°ï¼š{new Date(lastUpdate).toLocaleTimeString()}
                </div>
            )}
        </div>
    )
}


# END FILE CONTENTS


# File: frontend/constants/languages.ts

export const LANGS = [
    { code: 'zh-TW', label: 'ä¸­æ–‡ï¼ˆç¹é«”ï¼‰' },
    { code: 'en-US', label: 'English' },
];


# END FILE CONTENTS


# File: frontend/lib/__tests__/advanced-audio-recorder.test.ts

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { AdvancedAudioRecorder, checkAdvancedAudioRecordingSupport } from '../advanced-audio-recorder'

// Track created instances
let mockInstances: any[] = []

const MockMediaRecorder = vi.fn().mockImplementation((stream: any, options: any) => {
    // Create individual mock functions for each instance
    const instanceStart = vi.fn()
    const instanceStop = vi.fn()
    const instanceRequestData = vi.fn()

    const instance = {
        start: instanceStart,
        stop: instanceStop,
        requestData: instanceRequestData,
        state: 'inactive',
        ondataavailable: null,
        onerror: null,
        mimeType: options.mimeType,
        audioBitsPerSecond: options.audioBitsPerSecond,
        stream,
        options
    }
    mockInstances.push(instance)
    return instance
}) as any

MockMediaRecorder.isTypeSupported = vi.fn().mockReturnValue(true)

// Mock getUserMedia
const mockGetUserMedia = vi.fn()

describe('AdvancedAudioRecorder', () => {
    let recorder: AdvancedAudioRecorder
    let mockStream: any

    beforeEach(() => {
        // Reset mocks
        vi.clearAllMocks()
        mockInstances = [] // Reset instances array

        // Setup global mocks
        global.MediaRecorder = MockMediaRecorder as any

        // Reset and setup isTypeSupported mock
        MockMediaRecorder.isTypeSupported.mockClear()
        MockMediaRecorder.isTypeSupported.mockReturnValue(true)

        global.navigator = {
            mediaDevices: {
                getUserMedia: mockGetUserMedia
            }
        } as any

        // Mock stream
        mockStream = {
            getTracks: vi.fn().mockReturnValue([
                { stop: vi.fn() }
            ])
        }
        mockGetUserMedia.mockResolvedValue(mockStream)

        // Create recorder instance
        recorder = new AdvancedAudioRecorder({
            segmentDuration: 10000,
            mimeType: 'audio/webm;codecs=opus',
            audioBitsPerSecond: 128000
        })
    })

    afterEach(() => {
        recorder.cleanup()
    })

    describe('checkAdvancedAudioRecordingSupport', () => {
        it('should return supported when all APIs are available', async () => {
            const result = await checkAdvancedAudioRecordingSupport()
            expect(result.isSupported).toBe(true)
        })

        it('should return unsupported when MediaDevices is not available', async () => {
            global.navigator = {} as any
            const result = await checkAdvancedAudioRecordingSupport()
            expect(result.isSupported).toBe(false)
            expect(result.error).toContain('MediaDevices API')
        })

        it('should return unsupported when MediaRecorder is not available', async () => {
            delete (global as any).MediaRecorder
            const result = await checkAdvancedAudioRecordingSupport()
            expect(result.isSupported).toBe(false)
            expect(result.error).toContain('MediaRecorder API')
        })

        it('should return unsupported when mime type is not supported', async () => {
            MockMediaRecorder.isTypeSupported.mockReturnValue(false)
            const result = await checkAdvancedAudioRecordingSupport()
            expect(result.isSupported).toBe(false)
            expect(result.error).toContain('éŸ³è¨Šæ ¼å¼')
        })
    })

    describe('AdvancedAudioRecorder', () => {
        it('should initialize with default config', () => {
            expect(recorder.currentConfig).toEqual({
                segmentDuration: 10000,
                mimeType: 'audio/webm;codecs=opus',
                audioBitsPerSecond: 128000
            })
        })

        it('should accept custom config', () => {
            const customRecorder = new AdvancedAudioRecorder({
                segmentDuration: 5000,
                audioBitsPerSecond: 64000
            })
            expect(customRecorder.currentConfig.segmentDuration).toBe(5000)
            expect(customRecorder.currentConfig.audioBitsPerSecond).toBe(64000)
        })

        it('should initialize media stream', async () => {
            await recorder.initialize()
            expect(mockGetUserMedia).toHaveBeenCalledWith({ audio: true })
        })

        it('should not reinitialize if already initialized', async () => {
            await recorder.initialize()
            await recorder.initialize()
            expect(mockGetUserMedia).toHaveBeenCalledTimes(1)
        })

        it('should start recording with dual MediaRecorder strategy', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            expect(recorder.recording).toBe(true)
            expect(mockInstances[0].start).toHaveBeenCalledTimes(1) // Current recorder started
        })

        it('should create MediaRecorder with correct options', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            // Check if MediaRecorder was created with correct options
            expect(MockMediaRecorder).toHaveBeenCalledWith(
                mockStream,
                {
                    mimeType: 'audio/webm;codecs=opus',
                    audioBitsPerSecond: 128000
                }
            )
        })

        it('should handle segment data available', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            // Get the first MediaRecorder instance created
            const mockRecorderInstance = mockInstances[0]

            // Simulate data available event
            const mockBlob = new Blob(['test data'], { type: 'audio/webm' })
            const mockEvent = { data: mockBlob }

            if (mockRecorderInstance.ondataavailable) {
                mockRecorderInstance.ondataavailable(mockEvent)
            }

            expect(onSegmentCallback).toHaveBeenCalledWith({
                blob: mockBlob,
                timestamp: expect.any(Number),
                duration: 10000,
                sequence: 0
            })
        })

        it('should increment sequence number for each segment', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            const mockRecorderInstance = mockInstances[0]
            const mockBlob = new Blob(['test data'], { type: 'audio/webm' })
            const mockEvent = { data: mockBlob }

            // First segment
            if (mockRecorderInstance.ondataavailable) {
                mockRecorderInstance.ondataavailable(mockEvent)
            }
            expect(onSegmentCallback).toHaveBeenLastCalledWith(
                expect.objectContaining({ sequence: 0 })
            )

            // Second segment
            if (mockRecorderInstance.ondataavailable) {
                mockRecorderInstance.ondataavailable(mockEvent)
            }
            expect(onSegmentCallback).toHaveBeenLastCalledWith(
                expect.objectContaining({ sequence: 1 })
            )
        })

        it('should stop recording and cleanup', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            expect(recorder.recording).toBe(true)

            recorder.stop()

            expect(recorder.recording).toBe(false)
            // Verify that at least 2 MediaRecorder instances were created (dual strategy)
            expect(mockInstances.length).toBeGreaterThanOrEqual(2)
        })

        it('should prevent starting when already recording', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            await expect(recorder.start(onSegmentCallback)).rejects.toThrow('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
        })

        it('should handle MediaRecorder errors', async () => {
            const onSegmentCallback = vi.fn()
            const onErrorCallback = vi.fn()
            recorder.onError(onErrorCallback)

            await recorder.start(onSegmentCallback)

            const mockRecorderInstance = mockInstances[0]
            const mockError = new Error('MediaRecorder error')

            if (mockRecorderInstance.onerror) {
                mockRecorderInstance.onerror(mockError)
            }

            expect(onErrorCallback).toHaveBeenCalledWith(expect.any(Error))
            expect(recorder.recording).toBe(false)
        })

        it('should cleanup resources properly', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            recorder.cleanup()

            expect(recorder.recording).toBe(false)
            expect(mockStream.getTracks()[0].stop).toHaveBeenCalled()
        })

        it('should schedule recorder swap after segment duration', async () => {
            vi.useFakeTimers()

            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            // Initially should have 2 recorders (current + next)
            expect(mockInstances.length).toBe(2)

            // Fast-forward time to trigger swap
            vi.advanceTimersByTime(10000)

            // After swap, should have created additional recorders
            expect(mockInstances.length).toBeGreaterThan(2)

            // Verify recorder is still recording
            expect(recorder.recording).toBe(true)

            vi.useRealTimers()
        })

        it('should not swap recorders after stop is called', async () => {
            vi.useFakeTimers()

            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            recorder.stop()

            // Fast-forward time
            vi.advanceTimersByTime(10000)

            // Should not start additional recorders after stop
            expect(mockInstances[0].start).toHaveBeenCalledTimes(1)

            vi.useRealTimers()
        })
    })
})


# END FILE CONTENTS


# File: frontend/vitest.config.ts

/// <reference types="vitest" />
import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
    plugins: [react()],
    test: {
        globals: true,
        environment: 'jsdom',
    },
    resolve: {
        alias: {
            '@': path.resolve(__dirname, './'),
        },
    },
})


# END FILE CONTENTS


# File: frontend/lib/services/transcript-service.ts

"use client"

import { BaseService } from './base-service'
import { ITranscriptService, TranscriptMessage } from './interfaces'
import { transcriptManager } from '../transcript-manager'

/**
 * é€å­—ç¨¿æœå‹™è³‡è¨Šä»‹é¢
 */
interface TranscriptServiceInfo {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    connectedSessions: string[]
    activeListeners: Record<string, number>
    totalConnections: number
    transcriptManagerConnections: number
}

/**
 * TranscriptService - é€å­—ç¨¿æœå‹™
 *
 * è·è²¬ï¼š
 * - å°è£ TranscriptManager çš„ API ç‚ºæœå‹™å±¤æ¥å£
 * - æä¾›çµ±ä¸€çš„é€å­—ç¨¿é€£æ¥å’Œæ¶ˆæ¯è™•ç†
 * - ä¿æŒ TranscriptManager çš„ç¨ç«‹æ€§å’Œ WebSocket é‡é€£æ©Ÿåˆ¶
 * - æ”¯æŒå¤šæœƒè©±çš„é€å­—ç¨¿ç®¡ç†
 */
export class TranscriptService extends BaseService implements ITranscriptService {
    protected readonly serviceName = 'TranscriptService'

    private connectedSessions: Set<string> = new Set()
    private sessionListeners: Map<string, Set<(message: TranscriptMessage) => void>> = new Map()

    /**
     * åˆå§‹åŒ–æœå‹™
     */
    async initialize(): Promise<void> {
        this.logInfo('åˆå§‹åŒ–é€å­—ç¨¿æœå‹™')
        // TranscriptManager æ˜¯ Singletonï¼Œç„¡éœ€ç‰¹åˆ¥åˆå§‹åŒ–
    }

    /**
     * æ¸…ç†æœå‹™è³‡æº
     */
    async cleanup(): Promise<void> {
        this.logInfo('æ¸…ç†é€å­—ç¨¿æœå‹™è³‡æº')

        // æ–·é–‹æ‰€æœ‰é€£æ¥
        const sessionIds = Array.from(this.connectedSessions)
        for (const sessionId of sessionIds) {
            await this.disconnect(sessionId)
        }

        this.connectedSessions.clear()
        this.sessionListeners.clear()
    }

    /**
     * é€£æ¥é€å­—ç¨¿æœå‹™
     */
    async connect(sessionId: string): Promise<void> {
        if (!this.isRunning) {
            throw new Error('TranscriptService å°šæœªå•Ÿå‹•ï¼Œè«‹å…ˆèª¿ç”¨ start()')
        }

        try {
            this.logInfo(`é€£æ¥é€å­—ç¨¿æœå‹™: ${sessionId}`)

            // ä½¿ç”¨ TranscriptManager å»ºç«‹é€£æ¥
            await transcriptManager.connect(sessionId)

            // è¨˜éŒ„é€£æ¥ç‹€æ…‹
            this.connectedSessions.add(sessionId)

            this.logSuccess(`é€å­—ç¨¿æœå‹™é€£æ¥æˆåŠŸ: ${sessionId}`)
        } catch (error) {
            this.handleError(`é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—: ${sessionId}`, error)
        }
    }

    /**
     * æ–·é–‹é€å­—ç¨¿æœå‹™
     */
    async disconnect(sessionId?: string): Promise<void> {
        try {
            if (sessionId) {
                this.logInfo(`æ–·é–‹é€å­—ç¨¿æœå‹™: ${sessionId}`)

                // ç§»é™¤æ‰€æœ‰ç›£è½å™¨
                const listeners = this.sessionListeners.get(sessionId)
                if (listeners) {
                    listeners.forEach(callback => {
                        transcriptManager.removeListener(sessionId, callback)
                    })
                    this.sessionListeners.delete(sessionId)
                }

                // æ–·é–‹é€£æ¥
                await transcriptManager.disconnect(sessionId)
                this.connectedSessions.delete(sessionId)

                this.logSuccess(`é€å­—ç¨¿æœå‹™æ–·é–‹æˆåŠŸ: ${sessionId}`)
            } else {
                // æ–·é–‹æ‰€æœ‰é€£æ¥
                this.logInfo('æ–·é–‹æ‰€æœ‰é€å­—ç¨¿æœå‹™é€£æ¥')
                const sessionIds = Array.from(this.connectedSessions)
                for (const id of sessionIds) {
                    await this.disconnect(id)
                }
            }
        } catch (error) {
            this.handleError(`æ–·é–‹é€å­—ç¨¿æœå‹™å¤±æ•—: ${sessionId || 'all'}`, error)
        }
    }

    /**
     * æ·»åŠ é€å­—ç¨¿ç›£è½å™¨
     */
    addTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
        if (!this.isRunning) {
            throw new Error('TranscriptService å°šæœªå•Ÿå‹•ï¼Œè«‹å…ˆèª¿ç”¨ start()')
        }

        this.logInfo(`æ·»åŠ é€å­—ç¨¿ç›£è½å™¨: ${sessionId}`)

        // è¨˜éŒ„ç›£è½å™¨
        if (!this.sessionListeners.has(sessionId)) {
            this.sessionListeners.set(sessionId, new Set())
        }
        this.sessionListeners.get(sessionId)!.add(callback)

        // æ·»åŠ åˆ° TranscriptManager
        transcriptManager.addListener(sessionId, callback)
    }

    /**
     * ç§»é™¤é€å­—ç¨¿ç›£è½å™¨
     */
    removeTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
        this.logInfo(`ç§»é™¤é€å­—ç¨¿ç›£è½å™¨: ${sessionId}`)

        // å¾è¨˜éŒ„ä¸­ç§»é™¤
        const listeners = this.sessionListeners.get(sessionId)
        if (listeners) {
            listeners.delete(callback)
            if (listeners.size === 0) {
                this.sessionListeners.delete(sessionId)
            }
        }

        // å¾ TranscriptManager ç§»é™¤
        transcriptManager.removeListener(sessionId, callback)
    }

    /**
     * æª¢æŸ¥é€£æ¥ç‹€æ…‹
     */
    isConnected(sessionId: string): boolean {
        return transcriptManager.isConnected(sessionId)
    }

    /**
     * æ¸…é™¤é€å­—ç¨¿
     *
     * æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸æœƒæ¸…é™¤ TranscriptManager ä¸­çš„æ•¸æ“šï¼Œ
     * å› ç‚º TranscriptManager æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œåªè² è²¬ WebSocket é€£æ¥ã€‚
     * å¯¦éš›çš„é€å­—ç¨¿æ•¸æ“šæ‡‰è©²ç”±ç‹€æ…‹ç®¡ç†å±¤è™•ç†ã€‚
     */
    clearTranscripts(sessionId: string): void {
        this.logInfo(`æ¸…é™¤é€å­—ç¨¿: ${sessionId}`)
        // TranscriptManager ä¸å„²å­˜é€å­—ç¨¿æ•¸æ“šï¼Œé€™å€‹æ–¹æ³•ä¸»è¦ç”¨æ–¼è§¸ç™¼ç‹€æ…‹æ¸…é™¤
        // å¯¦éš›çš„æ¸…é™¤é‚è¼¯æ‡‰è©²åœ¨ç‹€æ…‹ç®¡ç†å±¤å¯¦ç¾
    }

    /**
     * å–å¾—æœå‹™ç‹€æ…‹è³‡è¨Š
     */
    getServiceInfo(): TranscriptServiceInfo {
        return {
            serviceName: this.serviceName,
            isInitialized: this.isInitialized,
            isRunning: this.isRunning,
            connectedSessions: Array.from(this.connectedSessions),
            activeListeners: Object.fromEntries(
                Array.from(this.sessionListeners.entries()).map(([sessionId, listeners]) => [
                    sessionId,
                    listeners.size
                ])
            ),
            totalConnections: this.connectedSessions.size,
            transcriptManagerConnections: transcriptManager.getConnectionCount()
        }
    }
}


# END FILE CONTENTS


# File: .cursor/rules/ui-rules/shadcn-tailwind-ui-guideline.mdc

<!-- Source: https://github.com/RayFernando1337/llm-cursor-rules/blob/main/fire-your-design-team.md -->

# shadcn/ui with Tailwind v4 Design System Guidelines

This document outlines design principles and implementation guidelines for applications using shadcn/ui with Tailwind v4. These guidelines ensure consistency, accessibility, and best practices throughout the UI development process.

## Core Design Principles

### 1. Typography System: 4 Sizes, 2 Weights
- **4 Font Sizes Only**:
  - Size 1: Large headings
  - Size 2: Subheadings/Important content
  - Size 3: Body text
  - Size 4: Small text/labels
- **2 Font Weights Only**:
  - Semibold: For headings and emphasis
  - Regular: For body text and general content
- **Consistent Hierarchy**: Maintain clear visual hierarchy with limited options

### 2. 8pt Grid System
- **All spacing values must be divisible by 8 or 4**
- **Examples**:
  - Instead of 25px padding â†’ Use 24px (divisible by 8)
  - Instead of 11px margin â†’ Use 12px (divisible by 4)
- **Consistent Rhythm**: Creates visual harmony throughout the interface

### 3. 60/30/10 Color Rule
- **60%**: Neutral color (white/light gray)
- **30%**: Complementary color (dark gray/black)
- **10%**: Main brand/accent color (e.g., red, blue)
- **Color Balance**: Prevents visual stress while maintaining hierarchy

### 4. Clean Visual Structure
- **Logical Grouping**: Related elements should be visually connected
- **Deliberate Spacing**: Spacing between elements should follow the grid system
- **Alignment**: Elements should be properly aligned within their containers
- **Simplicity Over Flashiness**: Focus on clarity and function first

## Foundation

### Tailwind v4 Integration
- **Use Tailwind CSS v4 for styling**: Leverage the latest Tailwind features including the new @theme directive, dynamic utility values, and OKLCH colors. [Tailwind CSS v4 Documentation](mdc:https://tailwindcss.com/docs)
- **Modern browsing features**: Tailwind v4 uses bleeding-edge browser features and is designed for modern browsers.
- **Simplified installation**: Fewer dependencies, zero configuration required in many cases.
- **shadcn/ui v4 demo**: Reference the demo site for component examples. [shadcn/ui v4 Demo](mdc:https://v4.shadcn.com/)

### New CSS Structure
- **Replace @layer base with @theme directive**:
  ```css
  /* Old approach in v3 */
  @layer base {
    :root {
      --background: 0 0% 100%;
      --foreground: 0 0% 3.9%;
    }
  }
  
  /* New approach in v4 */
  @theme {
    --color-background: hsl(var(--background));
    --color-foreground: hsl(var(--foreground));
  }
  ```
- **Tailwind imports**: Use `@import "tailwindcss"` instead of `@tailwind base`
- **Container queries**: Built-in support without plugins
- **OKLCH color format**: Updated from HSL for better color perception

## Typography System

### Font Sizes & Weights
- **Strictly limit to 4 distinct sizes**:
  - Size 1: Large headings (largest)
  - Size 2: Subheadings
  - Size 3: Body text
  - Size 4: Small text/labels (smallest)
- **Only use 2 font weights**:
  - Semibold: For headings and emphasis
  - Regular: For body text and most UI elements
- **Common mistakes to avoid**:
  - Using more than 4 font sizes
  - Introducing additional font weights
  - Inconsistent size application

### Typography Implementation
- **Reference shadcn's typography primitives** for consistent text styling
- **Use monospace variant** for numerical data when appropriate
- **data-slot attribute**: Every shadcn/ui primitive now has a data-slot attribute for styling
- **Maintain hierarchy** using consistent sizing patterns

## 8pt Grid System

### Spacing Guidelines
- **All spacing values MUST be divisible by 8 or 4**:
  - âœ… DO: Use 8, 16, 24, 32, 40, 48, etc.
  - âŒ DON'T: Use 25, 11, 7, 13, etc.

- **Practical examples**:
  - Instead of 25px padding â†’ Use 24px (divisible by 8)
  - Instead of 11px margin â†’ Use 12px (divisible by 4)
  - Instead of 15px gap â†’ Use 16px (divisible by 8)

- **Use Tailwind's spacing utilities**:
  - p-4 (16px), p-6 (24px), p-8 (32px)
  - m-2 (8px), m-4 (16px), m-6 (24px)
  - gap-2 (8px), gap-4 (16px), gap-8 (32px)

- **Why this matters**:
  - Creates visual harmony
  - Simplifies decision-making
  - Establishes predictable patterns

### Implementation
- **Tailwind v4 dynamic spacing**: Spacing utilities accept any value without arbitrary syntax
- **Consistent component spacing**: Group related elements with matching gap values
- **Check responsive behavior**: Ensure grid system holds at all breakpoints

## 60/30/10 Color Rule

### Color Distribution
- **60%**: neutral color (bg-background)
  - Usually white or light gray in light mode
  - Dark gray or black in dark mode
  - Used for primary backgrounds, cards, containers

- **30%**: complementary color (text-foreground)
  - Usually dark gray or black in light mode
  - Light gray or white in dark mode
  - Used for text, icons, subtle UI elements

- **10%**: accent color (brand color)
  - Your primary brand color (red, blue, etc.)
  - Used sparingly for call-to-action buttons, highlights, important indicators
  - Avoid overusing to prevent visual stress

### Common Mistakes
- âŒ Overusing accent colors creates visual stress
- âŒ Not enough contrast between background and text
- âŒ Too many competing accent colors (stick to one primary accent)

### Implementation with shadcn/ui
- **Background/foreground convention**: Each component uses the background/foreground pattern
- **CSS variables in globals.css**:
  ```css
  :root {
    --background: oklch(1 0 0);
    --foreground: oklch(0.145 0 0);
    --primary: oklch(0.205 0 0);
    --primary-foreground: oklch(0.985 0 0);
    /* Additional variables */
  }
  
  @theme {
    --color-background: var(--background);
    --color-foreground: var(--foreground);
    /* Register other variables */
  }
  ```
- **OKLCH color format**: More accessible colors, especially in dark mode
- **Reserve accent colors** for important elements that need attention

## Component Architecture

### shadcn/ui Component Structure
- **2-layered architecture**:
  1. Structure and behavior layer (Radix UI primitives)
  2. Style layer (Tailwind CSS)
- **Class Variance Authority (CVA)** for variant styling
- **data-slot attribute** for styling component parts

### Implementation
- **Install components individually** using CLI (updated for v4) or manual installation
- **Component customization**: Modify components directly as needed
- **Radix UI primitives**: Base components for accessibility and behavior
- **New-York style**: Default recommended style for new projects (deprecated "default" style)

## Visual Hierarchy

### Design Principles
- **Simplicity over flashiness**: Focus on clarity and usability
- **Emphasis on what matters**: Highlight important elements
- **Reduced cognitive load**: Use consistent terminology and patterns
- **Visual connection**: Connect related UI elements through consistent patterns

### Implementation
- **Use shadcn/ui Blocks** for common UI patterns
- **Maintain consistent spacing** between related elements
- **Align elements properly** within containers
- **Logical grouping** of related functionality

## Installation & Setup

### Project Setup
- **CLI initialization**:
  ```bash
  npx create-next-app@latest my-app
  cd my-app
  npx shadcn-ui@latest init
  ```
- **Manual setup**: Follow the guide at [Manual Installation](mdc:https://ui.shadcn.com/docs/installation/manual)
- **components.json configuration**:
  ```json
  {
    "style": "new-york",
    "rsc": true,
    "tailwind": {
      "config": "",
      "css": "app/globals.css",
      "baseColor": "neutral",
      "cssVariables": true
    },
    "aliases": {
      "components": "@/components",
      "utils": "@/lib/utils"
    }
  }
  ```

### Adding Components
- **Use the CLI**: `npx shadcn-ui@latest add button`
- **Install dependencies**: Required for each component
- **Find components**: [Component Reference](mdc:https://ui.shadcn.com/docs/components)

## Advanced Features

### Dark Mode
- **Updated dark mode colors** for better accessibility using OKLCH
- **Consistent contrast ratios** across light and dark themes
- **Custom variant**: `@custom-variant dark (&:is(.dark *))`

### Container Queries
- **Built-in support** without plugins
- **Responsive components** that adapt to their container size
- **@min-* and @max-* variants** for container query ranges

### Data Visualization
- **Chart components**: Use with consistent styling
- **Consistent color patterns**: Use chart-1 through chart-5 variables

## Experience Design

### Motion & Animation
- **Consider transitions** between screens and states
- **Animation purpose**: Enhance usability, not distract
- **Consistent motion patterns**: Similar elements should move similarly

### Implementation
- **Test experiences** across the entire flow
- **Design with animation in mind** from the beginning
- **Balance speed and smoothness** for optimal user experience

## Resources

- [shadcn/ui Documentation](mdc:https://ui.shadcn.com/docs)
- [Tailwind CSS v4 Documentation](mdc:https://tailwindcss.com/docs)
- [shadcn/ui GitHub Repository](mdc:https://github.com/shadcn/ui)
- [Tailwind v4 Upgrade Guide](mdc:https://tailwindcss.com/docs/upgrade-guide)
- [shadcn/ui v4 Demo](mdc:https://v4.shadcn.com/)
- [Figma Design System](mdc:https://www.figma.com/community/file/1203061493325953101/shadcn-ui-design-system)

## Code Review Checklist

### Core Design Principles
- [ ] Typography: Uses only 4 font sizes and 2 font weights (Semibold, Regular)
- [ ] Spacing: All spacing values are divisible by 8 or 4
- [ ] Colors: Follows 60/30/10 color distribution (60% neutral, 30% complementary, 10% accent)
- [ ] Structure: Elements are logically grouped with consistent spacing

### Technical Implementation
- [ ] Uses proper OKLCH color variables
- [ ] Leverages @theme directive for variables
- [ ] Components implement data-slot attribute properly
- [ ] Visual hierarchy is clear and consistent
- [ ] Components use Class Variance Authority for variants
- [ ] Dark mode implementation is consistent
- [ ] Accessibility standards are maintained (contrast, keyboard navigation, etc.)

### Common Issues to Flag
- [ ] Too many font sizes (more than 4)
- [ ] Inconsistent spacing values (not divisible by 8 or 4)
- [ ] Overuse of accent colors (exceeding 10%)
- [ ] Random or inconsistent margins/padding
- [ ] Insufficient contrast between text and background
- [ ] Unnecessary custom CSS when Tailwind utilities would suffice

# END FILE CONTENTS


# File: frontend/hooks/use-recording.ts

"use client"

import { useState, useCallback, useRef, useEffect } from 'react'
import { AckMissingMessage } from '../lib/websocket'
import { SegmentedAudioRecorder, AudioSegment } from '../lib/segmented-audio-recorder'
import { audioUploader } from '../lib/stream/audio-uploader'
import { transcriptManager, TranscriptMessage } from '../lib/transcript-manager'
import { getAudioChunkIntervalMs } from '../lib/config'
import { useAppActions } from '../lib/app-store-zustand'

interface UseRecordingReturn {
  isRecording: boolean
  recordingTime: number
  transcripts: TranscriptMessage[]
  transcriptCompleted: boolean
  error: string | null
  startRecording: (sessionId: string) => Promise<void>
  stopRecording: () => void
  clearTranscripts: () => void
}

export function useRecording(): UseRecordingReturn {
  const [isRecording, setIsRecording] = useState(false)
  const [recordingTime, setRecordingTime] = useState(0)
  const [transcripts, setTranscripts] = useState<TranscriptMessage[]>([])
  const [transcriptCompleted, setTranscriptCompleted] = useState(false)
  const [error, setError] = useState<string | null>(null)

  // å¾ Zustand store ç²å–æ“ä½œ
  const { setRecordingStart } = useAppActions()

  // WebSocket å’ŒéŒ„éŸ³å™¨å¼•ç”¨
  const segmentedRecorderRef = useRef<SegmentedAudioRecorder | null>(null)
  const currentSessionIdRef = useRef<string | null>(null)

  // è¨ˆæ™‚å™¨å’Œç‹€æ…‹å¼•ç”¨
  const timerRef = useRef<NodeJS.Timeout | null>(null)
  const segmentsRef = useRef<AudioSegment[]>([])
  const retryCountsRef = useRef<Map<number, number>>(new Map())
  const fallbackTimerRef = useRef<NodeJS.Timeout | null>(null) // æ–°å¢ï¼šfallback è¨ˆæ™‚å™¨

  // æ¸…ç†è¨ˆæ™‚å™¨
  const clearTimer = useCallback(() => {
    if (timerRef.current) {
      clearInterval(timerRef.current)
      timerRef.current = null
    }
    if (fallbackTimerRef.current) {
      clearTimeout(fallbackTimerRef.current)
      fallbackTimerRef.current = null
    }
  }, [])

  // é–‹å§‹éŒ„éŸ³è¨ˆæ™‚å™¨ï¼ˆåŸºæ–¼å¯¦éš›æ™‚é–“æˆ³ï¼‰
  const startTimer = useCallback(() => {
    clearTimer()
    setRecordingTime(0)
    const startTime = Date.now()

    timerRef.current = setInterval(() => {
      const elapsed = Math.floor((Date.now() - startTime) / 1000)
      setRecordingTime(elapsed)
    }, 1000)

    console.log('â±ï¸ [useRecording] éŒ„éŸ³è¨ˆæ™‚å™¨å·²å•Ÿå‹•')
  }, [clearTimer])

  // è™•ç†éŒ„éŸ³çœŸæ­£é–‹å§‹ï¼ˆonstart äº‹ä»¶ï¼‰
  const handleRecordingStart = useCallback(() => {
    const startTime = Date.now()
    console.log('ğŸš€ [useRecording] éŒ„éŸ³çœŸæ­£é–‹å§‹ï¼Œè¨­ç½®é–‹å§‹æ™‚é–“:', new Date(startTime).toISOString())

    // è¨­ç½®åˆ° Zustand store
    setRecordingStart(startTime)

    // åŒæ™‚æ›´æ–°æœ¬åœ°è¨ˆæ™‚å™¨
    startTimer()

    // æ¸…é™¤ fallback è¨ˆæ™‚å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if (fallbackTimerRef.current) {
      clearTimeout(fallbackTimerRef.current)
      fallbackTimerRef.current = null
    }
  }, [setRecordingStart, startTimer])

  // è™•ç†é€å­—ç¨¿æ¥æ”¶ - é€é TranscriptManager
  const handleTranscript = useCallback((transcript: TranscriptMessage) => {
    console.log('ğŸ“ [useRecording] æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯:', {
      type: transcript.type,
      text: transcript.text,
      textLength: transcript.text?.length || 0,
      start_time: transcript.start_time,
      end_time: transcript.end_time,
      start_sequence: transcript.start_sequence,
      confidence: transcript.confidence,
      sessionId: currentSessionIdRef.current,
      timestamp: new Date().toISOString(),
      fullMessage: transcript
    })

    // è™•ç†è½‰éŒ„å®Œæˆé€šçŸ¥
    if (transcript.type === 'transcript_complete' || transcript.message === 'transcription_complete') {
      console.log('âœ… [useRecording] é€å­—ç¨¿è½‰éŒ„å®Œæˆï¼Œè¨­å®š transcriptCompleted=true')
      setTranscriptCompleted(true)
      return
    }

    // è™•ç† active phase è¨Šæ¯ï¼ˆé‡è¦ï¼šé€™æœƒè§¸ç™¼ç‹€æ…‹è½‰æ›ï¼‰
    if (transcript.type === 'active' || transcript.phase === 'active') {
      console.log('ğŸš€ [useRecording] æ”¶åˆ° active phase è¨Šæ¯ï¼Œè½‰éŒ„é–‹å§‹')
      // é€™è£¡å¯ä»¥è¨­ç½®ä¸€å€‹æ¨™è¨˜ï¼Œè¡¨ç¤ºè½‰éŒ„å·²é–‹å§‹
      return
    }

    // åªè™•ç†é€å­—ç¨¿ç‰‡æ®µé¡å‹çš„è¨Šæ¯
    if (transcript.type !== 'transcript_segment') {
      console.log('âš ï¸ [useRecording] è·³ééé€å­—ç¨¿ç‰‡æ®µè¨Šæ¯:', transcript.type)
      return
    }

    if (!transcript.text) {
      console.log('âš ï¸ [useRecording] è·³éç©ºæ–‡å­—é€å­—ç¨¿')
      return
    }

    console.log('ğŸ”„ [useRecording] é–‹å§‹è™•ç†é€å­—ç¨¿ç‰‡æ®µ...', {
      text: transcript.text,
      textPreview: transcript.text.substring(0, 50) + '...',
      sequence: transcript.start_sequence,
      startTime: transcript.start_time,
      endTime: transcript.end_time
    })

    setTranscripts((prev) => {
      console.log('ğŸ“Š [useRecording] åˆä½µå‰ç‹€æ…‹:', {
        existingCount: prev.length,
        newSegmentText: transcript.text,
        newSegmentSequence: transcript.start_sequence,
        newSegmentTime: transcript.start_time
      })

      // ä½¿ç”¨ start_sequence ä½œç‚ºæ’åºä¾æ“šï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨æ™‚é–“æˆ³
      const sequence = transcript.start_sequence ?? transcript.timestamp ?? 0

      // ä¾ç…§åºè™Ÿæ’åºä¸¦å»é‡
      const filtered = prev.filter(t => {
        const existingSequence = t.start_sequence ?? t.timestamp ?? 0
        return existingSequence !== sequence
      })

      const updated = [...filtered, transcript].sort((a, b) => {
        const aSequence = a.start_sequence ?? a.timestamp ?? 0
        const bSequence = b.start_sequence ?? b.timestamp ?? 0
        return aSequence - bSequence
      })

      console.log('ğŸ“Š [useRecording] åˆä½µå¾Œç‹€æ…‹:', {
        newCount: updated.length,
        countChange: updated.length - prev.length,
        filteredCount: filtered.length,
        isDuplicate: filtered.length === prev.length ? false : true,
        lastSegmentText: updated[updated.length - 1]?.text?.substring(0, 50) + '...'
      })

      console.log(`âœ… [useRecording] é€å­—ç¨¿æ›´æ–°å®Œæˆ: ${prev.length} â†’ ${updated.length} å€‹ç‰‡æ®µ`)
      return updated
    })
  }, [])

  // è™•ç† ACK/Missing è¨Šæ¯ - æ”¯æ´é‡å‚³æ©Ÿåˆ¶
  const handleAckMissing = useCallback((data: AckMissingMessage) => {
    console.log('ğŸ“¨ [useRecording] æ”¶åˆ° ACK/Missing:', data)

    if (data.missing.length > 0) {
      console.warn('âš ï¸ [useRecording] æœ‰éºå¤±çš„éŸ³æª”æ®µè½éœ€è¦é‡å‚³:', data.missing)

      // é‡ç™¼éºå¤±çš„æ®µè½
      data.missing.forEach(async (sequence) => {
        if (segmentsRef.current[sequence]) {
          await audioUploader.send(segmentsRef.current[sequence].blob, sequence)
        }
      })
    }
  }, [])

  // è™•ç†éŸ³æª”æ®µè½ - ä¸å†è² è²¬å•Ÿå‹•è¨ˆæ™‚
  const handleAudioSegment = useCallback(async (segment: AudioSegment) => {
    console.log(`ğŸµ [useRecording] æ”¶åˆ°éŸ³æª”æ®µè½ #${segment.sequence}, å¤§å°: ${segment.blob.size} bytes`)

    // å„²å­˜æ®µè½ä¾›é‡å‚³ä½¿ç”¨
    segmentsRef.current[segment.sequence] = segment

    // ä½¿ç”¨æ”¹å–„çš„ AudioUploader ç™¼é€
    if (audioUploader.isConnected) {
      await audioUploader.send(segment.blob, segment.sequence)
    } else {
      console.warn('âš ï¸ [useRecording] AudioUploader æœªé€£æ¥ï¼Œç„¡æ³•ç™¼é€æ®µè½')
    }
  }, [])

  // é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨ onstart äº‹ä»¶
  const startRecording = useCallback(async (sessionId: string): Promise<void> => {
    try {
      setError(null)
      setTranscriptCompleted(false)
      currentSessionIdRef.current = sessionId

      console.log('ğŸ¤ [useRecording] é–‹å§‹éŒ„éŸ³æµç¨‹:', { sessionId })

      // ç¢ºä¿åœ¨ç€è¦½å™¨ç’°å¢ƒä¸­åŸ·è¡Œ
      if (typeof window === 'undefined') {
        throw new Error('æ­¤åŠŸèƒ½åƒ…åœ¨ç€è¦½å™¨ç’°å¢ƒä¸­å¯ç”¨')
      }

      // æ­¥é©Ÿ 1: å»ºç«‹åˆ†æ®µå¼éŸ³æª”éŒ„è£½å™¨
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 1: åˆå§‹åŒ–åˆ†æ®µå¼éŸ³æª”éŒ„è£½å™¨')
      const segmentedRecorder = new SegmentedAudioRecorder({
        segmentDuration: getAudioChunkIntervalMs(), // å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
        mimeType: 'audio/webm;codecs=opus',
        audioBitsPerSecond: 64000 // 64 kbps
      })

      console.log('ğŸ¤ [useRecording] éŸ³è¨Šé…ç½®: WebM Opus, 64 kbps, 15 ç§’åˆ‡ç‰‡')

      segmentedRecorderRef.current = segmentedRecorder
      segmentsRef.current = []
      retryCountsRef.current.clear()

      // è¨­å®šéŸ³æª”éŒ„è£½å™¨äº‹ä»¶
      segmentedRecorder.onError((err) => {
        console.error('âŒ [useRecording] SegmentedAudioRecorder éŒ¯èª¤:', err)
        setError(err.message)
      })

      // æ–°å¢ï¼šè¨­å®šéŒ„éŸ³é–‹å§‹å›èª¿
      segmentedRecorder.onStart(handleRecordingStart)

      // æ­¥é©Ÿ 2: åˆå§‹åŒ–éŸ³è¨Šæ¬Šé™
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 2: åˆå§‹åŒ–éŸ³è¨Šæ¬Šé™')
      await segmentedRecorder.initialize()

      // æ­¥é©Ÿ 3: å»ºç«‹ WebSocket é€£ç·šï¼ˆä¸¦è¡Œå»ºç«‹ï¼Œç¢ºä¿éƒ½å°±ç·’ï¼‰
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 3: å»ºç«‹ WebSocket é€£ç·š')

      // 3a. å»ºç«‹éŸ³æª”ä¸Šå‚³é€£ç·šï¼ˆä½¿ç”¨æ”¹å–„çš„ AudioUploaderï¼‰
      console.log('ğŸ”Œ [useRecording] å»ºç«‹éŸ³æª”ä¸Šå‚³é€£ç·š')
      await audioUploader.connect(sessionId)

      // 3b. å»ºç«‹é€å­—ç¨¿æ¥æ”¶ WebSocketï¼ˆé€é TranscriptManagerï¼‰
      console.log('ğŸ”Œ [useRecording] å»ºç«‹é€å­—ç¨¿æ¥æ”¶ WebSocket')
      await transcriptManager.connect(sessionId)
      transcriptManager.addListener(sessionId, handleTranscript)

      // æ­¥é©Ÿ 4: é©—è­‰é€£ç·šç‹€æ…‹
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 4: é©—è­‰é€£ç·šç‹€æ…‹')
      if (!audioUploader.isConnected) {
        throw new Error('éŸ³æª”ä¸Šå‚³ AudioUploader é€£ç·šå¤±æ•—')
      }

      if (!transcriptManager.isConnected(sessionId)) {
        throw new Error('é€å­—ç¨¿æ¥æ”¶ WebSocket é€£ç·šå¤±æ•—')
      }

      console.log('âœ… [useRecording] æ‰€æœ‰é€£ç·šå·²å»ºç«‹')

      // æ­¥é©Ÿ 5: é–‹å§‹åˆ†æ®µéŒ„éŸ³
      console.log('ğŸ¤ [useRecording] æ­¥é©Ÿ 5: é–‹å§‹åˆ†æ®µéŒ„éŸ³')

      // å…ˆè¨­ç½®éŒ„éŸ³ç‹€æ…‹ï¼Œç¢ºä¿ç‹€æ…‹æ˜ å°„æ­£ç¢º
      setIsRecording(true)
      console.log('ğŸ¤ [useRecording] éŒ„éŸ³ç‹€æ…‹å·²è¨­ç½®ç‚º true')

      // è¨­ç½® fallback è¨ˆæ™‚å™¨ï¼šå¦‚æœ 10 ç§’å¾Œ onstart é‚„æ²’è§¸ç™¼ï¼Œä½¿ç”¨èˆŠé‚è¼¯
      fallbackTimerRef.current = setTimeout(() => {
        console.warn('âš ï¸ [useRecording] onstart äº‹ä»¶ 10 ç§’å…§æœªè§¸ç™¼ï¼Œä½¿ç”¨ fallback è¨ˆæ™‚å™¨')
        handleRecordingStart()
      }, 10000)

      await segmentedRecorder.start(handleAudioSegment)
      console.log('â³ [useRecording] ç­‰å¾… onstart äº‹ä»¶å•Ÿå‹•è¨ˆæ™‚å™¨')

      console.log('âœ… [useRecording] éŒ„éŸ³é–‹å§‹æˆåŠŸï¼ŒSession ID:', sessionId)

    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ [useRecording] é–‹å§‹éŒ„éŸ³å¤±æ•—:', err)

      // éŒ¯èª¤æ™‚æ¸…ç†è³‡æº
      if (segmentedRecorderRef.current) {
        segmentedRecorderRef.current.stop()
        segmentedRecorderRef.current.cleanup()
      }
      if (audioUploader.isConnected) {
        audioUploader.close()
      }
      if (currentSessionIdRef.current) {
        transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
      }
      clearTimer()
    }
  }, [handleAudioSegment, handleAckMissing, handleTranscript, handleRecordingStart, clearTimer])

  // åœæ­¢éŒ„éŸ³
  const stopRecording = useCallback(() => {
    try {
      // åœæ­¢åˆ†æ®µå¼éŸ³æª”éŒ„è£½å™¨
      if (segmentedRecorderRef.current) {
        segmentedRecorderRef.current.stop()
      }

      // é—œé–‰éŸ³æª”ä¸Šå‚³é€£ç·š
      if (audioUploader.isConnected) {
        audioUploader.close()
      }

      setIsRecording(false)
      clearTimer()

      console.log('âœ… [useRecording] éŒ„éŸ³åœæ­¢ï¼Œç­‰å¾…è½‰éŒ„å®Œæˆ')

      // æ³¨æ„ï¼šä¸æ–·é–‹ TranscriptManager é€£æ¥ï¼Œç¹¼çºŒæ¥æ”¶è½‰éŒ„çµæœ

    } catch (err) {
      console.error('âŒ [useRecording] åœæ­¢éŒ„éŸ³å¤±æ•—:', err)
      setError('åœæ­¢éŒ„éŸ³æ™‚ç™¼ç”ŸéŒ¯èª¤')
    }
  }, [clearTimer])

  // æ¸…ç©ºé€å­—ç¨¿
  const clearTranscripts = useCallback(() => {
    setTranscripts([])
    setTranscriptCompleted(false)
    console.log('ğŸ”„ é€å­—ç¨¿å·²æ¸…é™¤')
  }, [])

  // æ¸…ç†è³‡æº
  useEffect(() => {
    return () => {
      // ç§»é™¤ TranscriptManager ç›£è½å™¨
      if (currentSessionIdRef.current) {
        transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
      }

      // æ¸…ç†è¨ˆæ™‚å™¨
      clearTimer()

      // é—œé–‰éŸ³æª”ä¸Šå‚³é€£ç·š
      if (audioUploader.isConnected) {
        audioUploader.close()
      }

      // åœæ­¢ä¸¦æ¸…ç†åˆ†æ®µå¼éŒ„éŸ³å™¨
      if (segmentedRecorderRef.current) {
        segmentedRecorderRef.current.stop()
        segmentedRecorderRef.current.cleanup()
      }
    }
  }, [clearTimer, handleTranscript])

  return {
    isRecording,
    recordingTime,
    transcripts,
    transcriptCompleted,
    error,
    startRecording,
    stopRecording,
    clearTranscripts,
  }
}


# END FILE CONTENTS


# File: pyproject.toml

[project]
name = "study-scriber"
version = "0.1.0"
description = "Cloud note tool: record, real-time transcript, Markdown notes & export as ZIP."
readme = "README.md"
requires-python = ">=3.12"
dependencies = [
    "fastapi",
    "uvicorn[standard]",
    "pydantic",
    "pydantic-settings",
    "python-dotenv",
    "psycopg2-binary",
    "uvloop",
    "httpx",
    "aiohttp",
    "loguru",
    "supabase",
    "gotrue",
    "postgrest",
    "realtime",
    "storage3",
    "openai",
    "aiofiles",
    "python-multipart",
    "google-generativeai",  # æä¾› google.generativeai.GenerativeModel
    # Task 5: ç›£æ§ä¾è³´
    "prometheus-client",
    # æ¸¬è©¦ä¾è³´
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
    "pytest-cov>=4.0.0",
]

[tool.setuptools.packages.find]
include = ["app*"]

[tool.pytest.ini_options]
addopts = "--cov=app"


# END FILE CONTENTS


# File: frontend/components/ui/select.tsx

"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}


# END FILE CONTENTS


# File: frontend/lib/services/service-container.ts

"use client"

import { BaseService, ServiceStatus } from './base-service'

/**
 * ServiceContainer - æœå‹™ä¾è³´æ³¨å…¥å®¹å™¨
 *
 * åƒè€ƒå¾Œç«¯ container.py æ¨¡å¼ï¼Œæä¾›ï¼š
 * - Singleton æ¨¡å¼ (åƒè€ƒ TranscriptManager.getInstance())
 * - é¡å‹å®‰å…¨çš„æœå‹™è¨»å†Šå’Œè§£æ
 * - æœå‹™ç”Ÿå‘½é€±æœŸç®¡ç†
 * - ä¾è³´é—œä¿‚ç®¡ç†
 */
export class ServiceContainer {
    /**
     * Singleton å¯¦ä¾‹
     */
    private static instance: ServiceContainer | null = null

    /**
     * æœå‹™å·¥å» å‡½æ•¸æ˜ å°„è¡¨
     * key: æœå‹™è­˜åˆ¥ç¬¦, value: æœå‹™å·¥å» å‡½æ•¸
     */
    private readonly providers = new Map<string, () => any>()

    /**
     * å–®ä¾‹æœå‹™å¯¦ä¾‹å¿«å–
     * key: æœå‹™è­˜åˆ¥ç¬¦, value: æœå‹™å¯¦ä¾‹
     */
    private readonly singletons = new Map<string, any>()

    /**
     * å·²è¨»å†Šçš„å–®ä¾‹æœå‹™æ¨™è­˜
     */
    private readonly singletonKeys = new Set<string>()

    /**
     * ç§æœ‰å»ºæ§‹å­ (Singleton æ¨¡å¼)
     */
    private constructor() {
        // é–‹ç™¼æ¨¡å¼ä¸‹å°‡å¯¦ä¾‹æ›åˆ°å…¨åŸŸä»¥åˆ©é™¤éŒ¯
        if (typeof window !== 'undefined') {
            ; (window as any).serviceContainer = this
            console.log('ğŸ”§ [ServiceContainer] æœå‹™å®¹å™¨å·²åˆå§‹åŒ–')
        }
    }

    /**
     * å–å¾— ServiceContainer å¯¦ä¾‹ (Singleton)
     */
    static getInstance(): ServiceContainer {
        if (!ServiceContainer.instance) {
            ServiceContainer.instance = new ServiceContainer()
        }
        return ServiceContainer.instance
    }

    /**
     * è¨»å†Šæœå‹™å·¥å» å‡½æ•¸
     * åƒè€ƒå¾Œç«¯ container.py çš„ register æ–¹æ³•
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     * @param factory æœå‹™å·¥å» å‡½æ•¸
     */
    register<T>(key: string, factory: () => T): void {
        if (this.providers.has(key)) {
            console.warn(`âš ï¸ [ServiceContainer] æœå‹™ "${key}" å·²å­˜åœ¨ï¼Œå°‡è¢«è¦†è“‹`)
        }

        this.providers.set(key, factory)
        console.log(`âœ… [ServiceContainer] æœå‹™ "${key}" è¨»å†ŠæˆåŠŸ`)
    }

    /**
     * è¨»å†Šå–®ä¾‹æœå‹™
     * å–®ä¾‹æœå‹™åªæœƒè¢«å‰µå»ºä¸€æ¬¡ï¼Œå¾ŒçºŒèª¿ç”¨è¿”å›åŒä¸€å¯¦ä¾‹
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     * @param factory æœå‹™å·¥å» å‡½æ•¸
     */
    registerSingleton<T>(key: string, factory: () => T): void {
        this.register(key, factory)
        this.singletonKeys.add(key)
        console.log(`âœ… [ServiceContainer] å–®ä¾‹æœå‹™ "${key}" è¨»å†ŠæˆåŠŸ`)
    }

    /**
     * è§£ææœå‹™å¯¦ä¾‹
     * åƒè€ƒå¾Œç«¯ container.py çš„ resolve æ–¹æ³•
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     * @returns æœå‹™å¯¦ä¾‹
     * @throws å¦‚æœæœå‹™æœªè¨»å†Š
     */
    resolve<T>(key: string): T {
        // æª¢æŸ¥å–®ä¾‹å¿«å–
        if (this.singletonKeys.has(key) && this.singletons.has(key)) {
            return this.singletons.get(key) as T
        }

        // å–å¾—å·¥å» å‡½æ•¸
        const provider = this.providers.get(key)
        if (!provider) {
            const error = `æœå‹™ "${key}" æœªè¨»å†Š`
            console.error(`âŒ [ServiceContainer] ${error}`)
            throw new Error(error)
        }

        try {
            const instance = provider() as T

            // å–®ä¾‹æœå‹™å¿«å–å¯¦ä¾‹
            if (this.singletonKeys.has(key)) {
                this.singletons.set(key, instance)
            }

            console.log(`âœ… [ServiceContainer] æœå‹™ "${key}" è§£ææˆåŠŸ`)
            return instance
        } catch (error) {
            console.error(`âŒ [ServiceContainer] å‰µå»ºæœå‹™ "${key}" å¤±æ•—:`, error)
            throw error
        }
    }

    /**
     * æª¢æŸ¥æœå‹™æ˜¯å¦å·²è¨»å†Š
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     */
    isRegistered(key: string): boolean {
        return this.providers.has(key)
    }

    /**
     * å–å¾—æ‰€æœ‰å·²è¨»å†Šçš„æœå‹™è­˜åˆ¥ç¬¦
     */
    getRegisteredServices(): string[] {
        return Array.from(this.providers.keys())
    }

    /**
     * æ¸…é™¤æŒ‡å®šæœå‹™è¨»å†Š
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     */
    unregister(key: string): boolean {
        const hasProvider = this.providers.delete(key)
        this.singletons.delete(key)
        this.singletonKeys.delete(key)

        if (hasProvider) {
            console.log(`ğŸ—‘ï¸ [ServiceContainer] æœå‹™ "${key}" å·²æ¸…é™¤`)
        }

        return hasProvider
    }

    /**
     * æ¸…é™¤æ‰€æœ‰æœå‹™è¨»å†Š
     * ä¸»è¦ç”¨æ–¼æ¸¬è©¦ç’°å¢ƒ
     */
    clear(): void {
        const count = this.providers.size
        this.providers.clear()
        this.singletons.clear()
        this.singletonKeys.clear()
        console.log(`ğŸ—‘ï¸ [ServiceContainer] å·²æ¸…é™¤ ${count} å€‹æœå‹™`)
    }

    /**
     * ç²å–å®¹å™¨ç‹€æ…‹æ‘˜è¦
     */
    getContainerStatus(): ServiceContainerStatus {
        const registeredServices = this.getRegisteredServices()
        const activeSingletons = Array.from(this.singletons.keys())

        return {
            totalServices: registeredServices.length,
            activeSingletonsCount: activeSingletons.length,
            registeredServices,
            activeSingletons,
            timestamp: new Date().toISOString()
        }
    }

    /**
     * åˆå§‹åŒ–æ‰€æœ‰å·²è¨»å†Šçš„ BaseService å¯¦ä¾‹
     * ç”¨æ–¼æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•æ™‚çµ±ä¸€åˆå§‹åŒ–æœå‹™
     */
    async initializeServices(): Promise<ServiceInitializationResult[]> {
        const results: ServiceInitializationResult[] = []
        const services = this.getRegisteredServices()

        console.log(`ğŸš€ [ServiceContainer] é–‹å§‹åˆå§‹åŒ– ${services.length} å€‹æœå‹™...`)

        for (const serviceKey of services) {
            try {
                const service = this.resolve(serviceKey)

                // æª¢æŸ¥æ˜¯å¦ç‚º BaseService å¯¦ä¾‹
                if (service instanceof BaseService) {
                    await service.start()
                    results.push({
                        serviceKey,
                        success: true,
                        status: service.getStatus()
                    })
                    console.log(`âœ… [ServiceContainer] æœå‹™ "${serviceKey}" åˆå§‹åŒ–æˆåŠŸ`)
                } else {
                    // é BaseService å¯¦ä¾‹ï¼Œè·³éåˆå§‹åŒ–
                    results.push({
                        serviceKey,
                        success: true,
                        status: null,
                        message: 'é BaseService å¯¦ä¾‹ï¼Œè·³éåˆå§‹åŒ–'
                    })
                    console.log(`â„¹ï¸ [ServiceContainer] æœå‹™ "${serviceKey}" é BaseService å¯¦ä¾‹ï¼Œè·³éåˆå§‹åŒ–`)
                }
            } catch (error) {
                results.push({
                    serviceKey,
                    success: false,
                    error: error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
                })
                console.error(`âŒ [ServiceContainer] æœå‹™ "${serviceKey}" åˆå§‹åŒ–å¤±æ•—:`, error)
            }
        }

        const successCount = results.filter(r => r.success).length
        console.log(`ğŸ¯ [ServiceContainer] æœå‹™åˆå§‹åŒ–å®Œæˆ: ${successCount}/${services.length} æˆåŠŸ`)

        return results
    }

    /**
     * æ¸…ç†æ‰€æœ‰å·²å•Ÿå‹•çš„ BaseService å¯¦ä¾‹
     * ç”¨æ–¼æ‡‰ç”¨ç¨‹å¼é—œé–‰æ™‚çµ±ä¸€æ¸…ç†è³‡æº
     */
    async cleanupServices(): Promise<ServiceCleanupResult[]> {
        const results: ServiceCleanupResult[] = []
        const singletonKeys = Array.from(this.singletons.keys())

        console.log(`ğŸ›‘ [ServiceContainer] é–‹å§‹æ¸…ç† ${singletonKeys.length} å€‹å–®ä¾‹æœå‹™...`)

        for (const serviceKey of singletonKeys) {
            try {
                const service = this.singletons.get(serviceKey)

                if (service instanceof BaseService && service.isRunning) {
                    await service.stop()
                    results.push({
                        serviceKey,
                        success: true
                    })
                    console.log(`âœ… [ServiceContainer] æœå‹™ "${serviceKey}" æ¸…ç†æˆåŠŸ`)
                } else {
                    results.push({
                        serviceKey,
                        success: true,
                        message: 'æœå‹™æœªé‹è¡Œæˆ–é BaseService å¯¦ä¾‹'
                    })
                }
            } catch (error) {
                results.push({
                    serviceKey,
                    success: false,
                    error: error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
                })
                console.error(`âŒ [ServiceContainer] æœå‹™ "${serviceKey}" æ¸…ç†å¤±æ•—:`, error)
            }
        }

        const successCount = results.filter(r => r.success).length
        console.log(`ğŸ¯ [ServiceContainer] æœå‹™æ¸…ç†å®Œæˆ: ${successCount}/${singletonKeys.length} æˆåŠŸ`)

        return results
    }
}

/**
 * æœå‹™å®¹å™¨éŒ¯èª¤é¡åˆ¥
 */
export class ServiceContainerError extends Error {
    readonly errorType: 'UNREGISTERED_SERVICE' | 'CREATION_FAILED' | 'UNKNOWN'
    readonly serviceKey: string
    readonly originalError?: unknown

    constructor(
        message: string,
        errorType: 'UNREGISTERED_SERVICE' | 'CREATION_FAILED' | 'UNKNOWN',
        serviceKey: string,
        originalError?: unknown
    ) {
        super(message)
        this.name = 'ServiceContainerError'
        this.errorType = errorType
        this.serviceKey = serviceKey
        this.originalError = originalError
    }
}

/**
 * å®¹å™¨ç‹€æ…‹ä»‹é¢
 */
export interface ServiceContainerStatus {
    totalServices: number
    activeSingletonsCount: number
    registeredServices: string[]
    activeSingletons: string[]
    timestamp: string
}

/**
 * æœå‹™åˆå§‹åŒ–çµæœä»‹é¢
 */
export interface ServiceInitializationResult {
    serviceKey: string
    success: boolean
    status?: ServiceStatus | null
    error?: string
    message?: string
}

/**
 * æœå‹™æ¸…ç†çµæœä»‹é¢
 */
export interface ServiceCleanupResult {
    serviceKey: string
    success: boolean
    error?: string
    message?: string
}

/**
 * åŒ¯å‡ºå…¨åŸŸå®¹å™¨å¯¦ä¾‹ (Singleton)
 * æ–¹ä¾¿å…¶ä»–æ¨¡çµ„ä½¿ç”¨
 */
export const serviceContainer = ServiceContainer.getInstance()


# END FILE CONTENTS


# File: frontend/hooks/use-transcript.ts

"use client"

import { useState, useCallback, useRef, useEffect } from 'react'
import { transcriptManager, TranscriptMessage } from '../lib/transcript-manager'

interface UseTranscriptReturn {
    transcripts: TranscriptMessage[]
    isConnected: boolean
    isCompleted: boolean
    error: string | null
    connect: (sessionId: string) => Promise<void>
    disconnect: () => void
    clearTranscripts: () => void
    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    autoScrollEnabled: boolean
    enableAutoScroll: () => void
    disableAutoScroll: () => void
    scrollToLatest: () => void
    setScrollContainer: (element: HTMLElement | null) => void
}

export function useTranscript(): UseTranscriptReturn {
    const [transcripts, setTranscripts] = useState<TranscriptMessage[]>([])
    const [isConnected, setIsConnected] = useState(false)
    const [isCompleted, setIsCompleted] = useState(false)
    const [error, setError] = useState<string | null>(null)
    const [autoScrollEnabled, setAutoScrollEnabled] = useState(true)

    const containerRef = useRef<HTMLElement | null>(null)
    const currentSessionIdRef = useRef<string | null>(null)

    // è™•ç†é€å­—ç¨¿æ¥æ”¶èˆ‡åˆä½µé‚è¼¯
    const handleTranscript = useCallback((transcript: TranscriptMessage) => {
        console.log('ğŸ“ [useTranscript] æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯:', {
            type: transcript.type,
            text: transcript.text,
            textLength: transcript.text?.length || 0,
            start_time: transcript.start_time,
            end_time: transcript.end_time,
            confidence: transcript.confidence,
            sessionId: currentSessionIdRef.current,
            currentTranscriptCount: transcripts.length,
            timestamp: new Date().toISOString()
        })

        // è™•ç†è½‰éŒ„å®Œæˆé€šçŸ¥
        if (transcript.type === 'transcript_complete' || transcript.message === 'transcription_complete') {
            console.log('âœ… [useTranscript] é€å­—ç¨¿è½‰éŒ„å®Œæˆï¼Œè¨­å®š isCompleted=true')
            setIsCompleted(true)
            return
        }

        // è™•ç†è½‰éŒ„éŒ¯èª¤ (éœ€è¦é¡å‹è½‰æ›å› ç‚º TranscriptMessage ä¸åŒ…å«éŒ¯èª¤é¡å‹)
        const anyMessage = transcript as any
        if (anyMessage.type === 'error' || anyMessage.type === 'transcription_error') {
            console.error('ğŸš¨ [useTranscript] æ”¶åˆ°è½‰éŒ„éŒ¯èª¤:', transcript)
            const errorMessage = anyMessage.error_message || anyMessage.details || 'è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤'
            setError(errorMessage)
            return
        }

        // åªè™•ç†é€å­—ç¨¿ç‰‡æ®µé¡å‹çš„è¨Šæ¯
        if (transcript.type !== 'transcript_segment') {
            console.log('âš ï¸ [useTranscript] è·³ééé€å­—ç¨¿ç‰‡æ®µè¨Šæ¯:', transcript.type)
            return
        }

        if (!transcript.text) {
            console.log('âš ï¸ [useTranscript] è·³éç©ºæ–‡å­—é€å­—ç¨¿')
            return
        }

        console.log('ğŸ”„ [useTranscript] é–‹å§‹è™•ç†é€å­—ç¨¿ç‰‡æ®µ...')

        setTranscripts((prev) => {
            console.log('ğŸ“Š [useTranscript] åˆä½µå‰ç‹€æ…‹:', {
                existingCount: prev.length,
                newSegmentText: transcript.text,
                newSegmentTime: transcript.start_time
            })

            const newTranscripts = mergeSegments(prev, transcript)

            console.log('ğŸ“Š [useTranscript] åˆä½µå¾Œç‹€æ…‹:', {
                newCount: newTranscripts.length,
                countChange: newTranscripts.length - prev.length,
                lastSegmentText: newTranscripts[newTranscripts.length - 1]?.text?.substring(0, 50) + '...'
            })

            console.log(`âœ… [useTranscript] é€å­—ç¨¿æ›´æ–°å®Œæˆ: ${prev.length} â†’ ${newTranscripts.length} å€‹ç‰‡æ®µ`)
            return newTranscripts
        })
    }, [transcripts.length])

    // é€å­—ç¨¿ç‰‡æ®µåˆä½µé‚è¼¯ - ç¦ç”¨åˆä½µï¼Œç¢ºä¿æ¯å¥è©±éƒ½æœ‰ç¨ç«‹æ™‚é–“æˆ³
    const mergeSegments = useCallback((
        existingSegments: TranscriptMessage[],
        newSegment: TranscriptMessage
    ): TranscriptMessage[] => {
        // ç¦ç”¨åˆä½µé‚è¼¯ï¼Œç›´æ¥æ·»åŠ æ–°ç‰‡æ®µ
        // ç”¨æˆ¶è¦æ±‚ï¼šã€Œä¸€å¥è©±ä¸€å€‹æ™‚é–“æˆ³ã€ï¼Œä¸è¦å°‡é€å­—ç¨¿åˆä½µ
        return [...existingSegments, newSegment]
    }, [])

    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    const scrollToLatest = useCallback(() => {
        if (containerRef.current && autoScrollEnabled) {
            containerRef.current.scrollTop = containerRef.current.scrollHeight
        }
    }, [autoScrollEnabled])

    // æª¢æ¸¬ä½¿ç”¨è€…æ»¾å‹• - é›¢åº•éƒ¨ >60px æ™‚ç¦ç”¨è‡ªå‹•æ²å‹•
    const handleScroll = useCallback((event: Event) => {
        const container = event.target as HTMLElement
        if (!container) return

        const { scrollTop, scrollHeight, clientHeight } = container
        const distanceFromBottom = scrollHeight - scrollTop - clientHeight

        if (distanceFromBottom > 60) {
            setAutoScrollEnabled(false)
        } else if (distanceFromBottom <= 10) {
            setAutoScrollEnabled(true)
        }
    }, [])

    // è¨­å®šè‡ªå‹•æ²å‹•å®¹å™¨
    const setScrollContainer = useCallback((element: HTMLElement | null) => {
        if (containerRef.current) {
            containerRef.current.removeEventListener('scroll', handleScroll)
        }

        containerRef.current = element

        if (element) {
            element.addEventListener('scroll', handleScroll)
        }
    }, [handleScroll])

    // å•Ÿç”¨è‡ªå‹•æ²å‹•
    const enableAutoScroll = useCallback(() => {
        setAutoScrollEnabled(true)
        scrollToLatest()
    }, [scrollToLatest])

    // ç¦ç”¨è‡ªå‹•æ²å‹•
    const disableAutoScroll = useCallback(() => {
        setAutoScrollEnabled(false)
    }, [])

    // é€£æ¥ TranscriptManager
    const connect = useCallback(async (sessionId: string): Promise<void> => {
        try {
            setError(null)
            setIsCompleted(false)

            // ç§»é™¤èˆŠçš„ç›£è½å™¨
            if (currentSessionIdRef.current) {
                transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
            }

            // é€£æ¥åˆ°æ–°çš„ session
            await transcriptManager.connect(sessionId)
            transcriptManager.addListener(sessionId, handleTranscript)

            currentSessionIdRef.current = sessionId
            setIsConnected(transcriptManager.isConnected(sessionId))

            console.log('âœ… use-transcript é€£æ¥æˆåŠŸï¼ŒSession ID:', sessionId)

        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'é€£æ¥é€å­—ç¨¿æœå‹™å¤±æ•—'
            setError(errorMessage)
            setIsConnected(false)
            console.error('âŒ use-transcript é€£æ¥å¤±æ•—:', err)
        }
    }, [handleTranscript])

    // æ–·é–‹é€£æ¥
    const disconnect = useCallback(() => {
        if (currentSessionIdRef.current) {
            transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
            // æ³¨æ„ï¼šä¸å‘¼å« transcriptManager.disconnectï¼Œå› ç‚ºå…¶ä»–çµ„ä»¶å¯èƒ½é‚„åœ¨ä½¿ç”¨
            currentSessionIdRef.current = null
        }

        setIsConnected(false)
        console.log('ğŸ”Œ use-transcript æ–·é–‹é€£æ¥')
    }, [handleTranscript])

    // æ¸…ç©ºé€å­—ç¨¿
    const clearTranscripts = useCallback(() => {
        setTranscripts([])
        setIsCompleted(false)
        console.log('ğŸ”„ use-transcript é€å­—ç¨¿å·²æ¸…é™¤')
    }, [])

    // è‡ªå‹•æ²å‹•æ•ˆæœ
    useEffect(() => {
        if (transcripts.length > 0) {
            scrollToLatest()
        }
    }, [transcripts, scrollToLatest])

    // æ¸…ç†è³‡æº
    useEffect(() => {
        return () => {
            if (currentSessionIdRef.current) {
                transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
            }

            if (containerRef.current) {
                containerRef.current.removeEventListener('scroll', handleScroll)
            }
        }
    }, [handleTranscript, handleScroll])

    return {
        transcripts,
        isConnected,
        isCompleted,
        error,
        connect,
        disconnect,
        clearTranscripts,
        autoScrollEnabled,
        enableAutoScroll,
        disableAutoScroll,
        scrollToLatest,
        setScrollContainer,
    }
}


# END FILE CONTENTS


# File: pnpm-lock.yaml

lockfileVersion: '9.0'

settings:
  autoInstallPeers: true
  excludeLinksFromLockfile: false

importers:

  .:
    devDependencies:
      '@playwright/test':
        specifier: ^1.54.1
        version: 1.54.1
      jszip:
        specifier: ^3.10.1
        version: 3.10.1

packages:

  '@playwright/test@1.54.1':
    resolution: {integrity: sha512-FS8hQ12acieG2dYSksmLOF7BNxnVf2afRJdCuM1eMSxj6QTSE6G4InGF7oApGgDb65MX7AwMVlIkpru0yZA4Xw==}
    engines: {node: '>=18'}
    hasBin: true

  core-util-is@1.0.3:
    resolution: {integrity: sha512-ZQBvi1DcpJ4GDqanjucZ2Hj3wEO5pZDS89BWbkcrvdxksJorwUDDZamX9ldFkp9aw2lmBDLgkObEA4DWNJ9FYQ==}

  fsevents@2.3.2:
    resolution: {integrity: sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==}
    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}
    os: [darwin]

  immediate@3.0.6:
    resolution: {integrity: sha512-XXOFtyqDjNDAQxVfYxuF7g9Il/IbWmmlQg2MYKOH8ExIT1qg6xc4zyS3HaEEATgs1btfzxq15ciUiY7gjSXRGQ==}

  inherits@2.0.4:
    resolution: {integrity: sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==}

  isarray@1.0.0:
    resolution: {integrity: sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==}

  jszip@3.10.1:
    resolution: {integrity: sha512-xXDvecyTpGLrqFrvkrUSoxxfJI5AH7U8zxxtVclpsUtMCq4JQ290LY8AW5c7Ggnr/Y/oK+bQMbqK2qmtk3pN4g==}

  lie@3.3.0:
    resolution: {integrity: sha512-UaiMJzeWRlEujzAuw5LokY1L5ecNQYZKfmyZ9L7wDHb/p5etKaxXhohBcrw0EYby+G/NA52vRSN4N39dxHAIwQ==}

  pako@1.0.11:
    resolution: {integrity: sha512-4hLB8Py4zZce5s4yd9XzopqwVv/yGNhV1Bl8NTmCq1763HeK2+EwVTv+leGeL13Dnh2wfbqowVPXCIO0z4taYw==}

  playwright-core@1.54.1:
    resolution: {integrity: sha512-Nbjs2zjj0htNhzgiy5wu+3w09YetDx5pkrpI/kZotDlDUaYk0HVA5xrBVPdow4SAUIlhgKcJeJg4GRKW6xHusA==}
    engines: {node: '>=18'}
    hasBin: true

  playwright@1.54.1:
    resolution: {integrity: sha512-peWpSwIBmSLi6aW2auvrUtf2DqY16YYcCMO8rTVx486jKmDTJg7UAhyrraP98GB8BoPURZP8+nxO7TSd4cPr5g==}
    engines: {node: '>=18'}
    hasBin: true

  process-nextick-args@2.0.1:
    resolution: {integrity: sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==}

  readable-stream@2.3.8:
    resolution: {integrity: sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==}

  safe-buffer@5.1.2:
    resolution: {integrity: sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==}

  setimmediate@1.0.5:
    resolution: {integrity: sha512-MATJdZp8sLqDl/68LfQmbP8zKPLQNV6BIZoIgrscFDQ+RsvK/BxeDQOgyxKKoh0y/8h3BqVFnCqQ/gd+reiIXA==}

  string_decoder@1.1.1:
    resolution: {integrity: sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==}

  util-deprecate@1.0.2:
    resolution: {integrity: sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==}

snapshots:

  '@playwright/test@1.54.1':
    dependencies:
      playwright: 1.54.1

  core-util-is@1.0.3: {}

  fsevents@2.3.2:
    optional: true

  immediate@3.0.6: {}

  inherits@2.0.4: {}

  isarray@1.0.0: {}

  jszip@3.10.1:
    dependencies:
      lie: 3.3.0
      pako: 1.0.11
      readable-stream: 2.3.8
      setimmediate: 1.0.5

  lie@3.3.0:
    dependencies:
      immediate: 3.0.6

  pako@1.0.11: {}

  playwright-core@1.54.1: {}

  playwright@1.54.1:
    dependencies:
      playwright-core: 1.54.1
    optionalDependencies:
      fsevents: 2.3.2

  process-nextick-args@2.0.1: {}

  readable-stream@2.3.8:
    dependencies:
      core-util-is: 1.0.3
      inherits: 2.0.4
      isarray: 1.0.0
      process-nextick-args: 2.0.1
      safe-buffer: 5.1.2
      string_decoder: 1.1.1
      util-deprecate: 1.0.2

  safe-buffer@5.1.2: {}

  setimmediate@1.0.5: {}

  string_decoder@1.1.1:
    dependencies:
      safe-buffer: 5.1.2

  util-deprecate@1.0.2: {}


# END FILE CONTENTS


# File: frontend/components/ui/tabs.tsx

"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }


# END FILE CONTENTS


# File: frontend/lib/api.ts

import axios, { AxiosResponse, AxiosError } from 'axios'

// API åŸºç¤é…ç½® - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000'

// å·®ç•°åŒ–è¶…æ™‚é…ç½®
const API_TIMEOUTS = {
  session: 15000,    // æœƒè©±æ“ä½œéœ€è¦æ›´å¤šæ™‚é–“ï¼ˆå»ºç«‹ã€å‡ç´šç­‰ï¼‰
  notes: 8000,       // ç­†è¨˜æ“ä½œç›¸å°è¼ƒå¿«
  export: 30000,     // åŒ¯å‡ºæ“ä½œå¯èƒ½éœ€è¦æ›´é•·æ™‚é–“
  default: 10000     // å…¶ä»–æ“ä½œä¿æŒç¾æœ‰è¨­å®š
} as const

// éŒ¯èª¤åˆ†é¡ï¼šåˆ¤æ–·æ˜¯å¦å¯é‡è©¦
const isRetriableError = (error: AxiosError): boolean => {
  // ç¶²è·¯éŒ¯èª¤ï¼ˆé€£æ¥å¤±æ•—ã€DNS å¤±æ•—ç­‰ï¼‰
  if (error.code === 'ERR_NETWORK' || error.code === 'ECONNABORTED') {
    return true
  }

  // è¶…æ™‚éŒ¯èª¤
  if (error.code === 'ECONNRESET' || error.message.includes('timeout')) {
    return true
  }

  // ä¼ºæœå™¨éŒ¯èª¤ï¼ˆ5xxï¼‰
  if (error.response?.status && error.response.status >= 500) {
    return true
  }

  // ç‰¹å®šçš„ 4xx éŒ¯èª¤ï¼ˆé€Ÿç‡é™åˆ¶ï¼‰
  if (error.response?.status === 429) {
    return true
  }

  return false
}

// é€šç”¨é‡è©¦æ©Ÿåˆ¶é…ç½®
interface RetryConfig {
  maxRetries: number
  baseDelay: number
  maxDelay: number
  backoffFactor: number
}

const DEFAULT_RETRY_CONFIG: RetryConfig = {
  maxRetries: 3,
  baseDelay: 1000,    // 1ç§’åŸºç¤å»¶é²
  maxDelay: 10000,    // æœ€å¤§å»¶é² 10ç§’
  backoffFactor: 2    // æŒ‡æ•¸é€€é¿å› å­
}

// æŒ‡æ•¸é€€é¿ç®—æ³•
const calculateDelay = (attempt: number, config: RetryConfig): number => {
  const delay = config.baseDelay * Math.pow(config.backoffFactor, attempt - 1)
  return Math.min(delay, config.maxDelay)
}

// å»ºç«‹å°ˆç”¨çš„ API å®¢æˆ¶ç«¯
const createApiClient = (timeoutMs: number) => {
  return axios.create({
    baseURL: API_BASE_URL,
    timeout: timeoutMs,
    headers: {
      'Content-Type': 'application/json',
    },
  })
}

// ä¸åŒé¡å‹çš„ API å®¢æˆ¶ç«¯
const sessionClient = createApiClient(API_TIMEOUTS.session)
const notesClient = createApiClient(API_TIMEOUTS.notes)
const exportClient = createApiClient(API_TIMEOUTS.export)
const defaultClient = createApiClient(API_TIMEOUTS.default)

// é€šç”¨é‡è©¦åŒ…è£å™¨
async function withRetry<T>(
  operation: () => Promise<T>,
  context: string,
  config: Partial<RetryConfig> = {}
): Promise<T> {
  const retryConfig = { ...DEFAULT_RETRY_CONFIG, ...config }

  for (let attempt = 1; attempt <= retryConfig.maxRetries; attempt++) {
    try {
      const result = await operation()

      if (attempt > 1) {
        console.log(`âœ… [APIé‡è©¦] ${context} é‡è©¦æˆåŠŸ (ç¬¬ ${attempt} æ¬¡å˜—è©¦)`)
      }

      return result
    } catch (error) {
      const isLastAttempt = attempt === retryConfig.maxRetries

      if (axios.isAxiosError(error)) {
        // ä¸å¯é‡è©¦çš„éŒ¯èª¤ï¼Œç«‹å³å¤±æ•—
        if (!isRetriableError(error)) {
          console.log(`âŒ [APIé‡è©¦] ${context} é‡åˆ°ä¸å¯é‡è©¦éŒ¯èª¤ï¼Œç«‹å³çµ‚æ­¢:`, {
            status: error.response?.status,
            code: error.code,
            message: error.message,
          });
          throw error;
        }

        // æœ€å¾Œä¸€æ¬¡å˜—è©¦å¤±æ•—
        if (isLastAttempt) {
          console.error(`âŒ [APIé‡è©¦] ${context} é‡è©¦å¤±æ•—ï¼Œå·²é”æœ€å¤§é‡è©¦æ¬¡æ•¸ (${retryConfig.maxRetries})`)
          throw error
        }

        // è¨ˆç®—å»¶é²æ™‚é–“
        const delay = calculateDelay(attempt, retryConfig)

        console.warn(`âš ï¸ [APIé‡è©¦] ${context} ç¬¬ ${attempt} æ¬¡å˜—è©¦å¤±æ•—ï¼Œ${delay}ms å¾Œé‡è©¦...`, {
          status: error.response?.status,
          code: error.code,
          attempt: `${attempt}/${retryConfig.maxRetries}`,
          nextDelay: delay
        })

        // ç­‰å¾…å¾Œé‡è©¦
        await new Promise(resolve => setTimeout(resolve, delay))
      } else {
        // é Axios éŒ¯èª¤ï¼Œç›´æ¥æ‹‹å‡º
        throw error
      }
    }
  }

  // é€™è£¡ä¸æ‡‰è©²è¢«åŸ·è¡Œåˆ°
  throw new Error(`${context} é‡è©¦é‚è¼¯ç•°å¸¸`)
}

// çµ±ä¸€çš„å›æ‡‰æ””æˆªå™¨è¨­ç½®
const setupInterceptors = (client: typeof sessionClient, clientName: string) => {
  client.interceptors.response.use(
    (response: AxiosResponse) => {
      console.log(`ğŸ“¡ [${clientName}] API è«‹æ±‚æˆåŠŸ:`, {
        method: response.config.method?.toUpperCase(),
        url: response.config.url,
        status: response.status,
        duration: response.headers['x-response-time'] || 'unknown'
      })
      return response
    },
    (error: AxiosError) => {
      // ä¸é¡¯ç¤ºé æœŸçš„ 404 éŒ¯èª¤ï¼ˆä¾‹å¦‚ï¼šæ²’æœ‰æ´»èºæœƒè©±ï¼‰
      const isExpected404 = error.response?.status === 404 &&
        error.config?.url?.includes('/api/session/active')

      if (!isExpected404) {
        console.error(`âŒ [${clientName}] API éŒ¯èª¤:`, {
          method: error.config?.method?.toUpperCase(),
          url: error.config?.url,
          status: error.response?.status,
          code: error.code,
          message: error.message,
          isRetriable: isRetriableError(error)
        })
      }

      return Promise.reject(error)
    }
  )
}

// è¨­ç½®æ‰€æœ‰å®¢æˆ¶ç«¯çš„æ””æˆªå™¨
setupInterceptors(sessionClient, 'Session')
setupInterceptors(notesClient, 'Notes')
setupInterceptors(exportClient, 'Export')
setupInterceptors(defaultClient, 'Default')

// å‹åˆ¥å®šç¾©
export interface SessionCreateRequest {
  title?: string
  type: 'note_only' | 'recording'
  content?: string
  start_ts?: number  // éŒ„éŸ³é–‹å§‹æ™‚é–“æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œç”¨æ–¼ç²¾ç¢ºæ™‚é–“åŒæ­¥
  lang_code?: string  // BCP-47 èªè¨€ç¢¼ï¼ˆå¦‚ zh-TW, en-USï¼‰
  stt_provider?: string  // èªéŸ³è½‰æ–‡å­— Provider åç¨±ï¼ˆå¦‚ whisper, gpt4oï¼‰
}

// STT Provider é¡å‹å®šç¾©
export type STTProvider = 'whisper' | 'gemini' | 'gpt4o'

export interface SessionResponse {
  id: string
  title?: string
  type: 'note_only' | 'recording'
  status: 'draft' | 'active' | 'processing' | 'completed' | 'error'
  language: string
  created_at: string
  updated_at: string
}

export interface NoteUpdateRequest {
  content: string
  client_ts?: string  // ISO æ™‚é–“æˆ³å­—ä¸²ï¼Œå¯é¸
}

export interface NoteUpdateResponse {
  success: boolean
  message: string
  server_ts: string  // ISO æ™‚é–“æˆ³å­—ä¸²
  note: NoteResponse
}

export interface NoteResponse {
  session_id: string
  content: string
  client_ts?: string  // ISO æ™‚é–“æˆ³å­—ä¸²ï¼Œå¯é¸
  created_at: string
  updated_at: string
}

// Session API - ä½¿ç”¨æœƒè©±å°ˆç”¨å®¢æˆ¶ç«¯å’Œé‡è©¦æ©Ÿåˆ¶
export const sessionAPI = {
  // å»ºç«‹æ–°æœƒè©±
  async createSession(data: SessionCreateRequest): Promise<SessionResponse> {
    return withRetry(
      async () => {
        const response = await sessionClient.post('/api/session', data)
        return response.data
      },
      `å»ºç«‹æœƒè©± (${data.type})`,
      { maxRetries: 2 } // æœƒè©±å»ºç«‹é‡è©¦æ¬¡æ•¸è¼ƒå°‘ï¼Œé¿å…é‡è¤‡å»ºç«‹
    )
  },

  // ç²å–æ´»èºæœƒè©± - å¢å¼·é‡è©¦æ©Ÿåˆ¶
  async getActiveSession(): Promise<SessionResponse | null> {
    return withRetry(
      async () => {
        try {
          const response = await sessionClient.get('/api/session/active')
          return response.data
        } catch (error) {
          // å¦‚æœæ²’æœ‰æ´»èºæœƒè©±ï¼Œè¿”å› null è€Œä¸æ˜¯æ‹‹å‡ºéŒ¯èª¤
          if (axios.isAxiosError(error) && error.response?.status === 404) {
            return null
          }
          throw error
        }
      },
      'æª¢æŸ¥æ´»èºæœƒè©±',
      { maxRetries: 3, baseDelay: 500 } // æ›´é »ç¹çš„é‡è©¦ï¼ŒåŸºç¤å»¶é²è¼ƒçŸ­
    )
  },

  // å®Œæˆæœƒè©±
  async finishSession(sessionId: string): Promise<void> {
    return withRetry(
      async () => {
        await sessionClient.patch(`/api/session/${sessionId}/finish`)
      },
      `å®Œæˆæœƒè©± (${sessionId})`,
      { maxRetries: 2 }
    )
  },

  // å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼
  async upgradeToRecording(sessionId: string): Promise<SessionResponse> {
    return withRetry(
      async () => {
        const response = await sessionClient.patch(`/api/session/${sessionId}/upgrade`)
        return response.data
      },
      `å‡ç´šæœƒè©± (${sessionId})`,
      { maxRetries: 2 }
    )
  },

  // åˆªé™¤æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“š
  async deleteSession(sessionId: string): Promise<{ success: boolean; message: string }> {
    return withRetry(
      async () => {
        const response = await sessionClient.delete(`/api/session/${sessionId}`)
        return response.data
      },
      `åˆªé™¤æœƒè©± (${sessionId})`,
      { maxRetries: 2 }
    )
  },
}

// Notes API - ä½¿ç”¨ç­†è¨˜å°ˆç”¨å®¢æˆ¶ç«¯å’Œé‡è©¦æ©Ÿåˆ¶
export const notesAPI = {
  // æ›´æ–°ç­†è¨˜å…§å®¹
  async updateNote(sessionId: string, data: NoteUpdateRequest): Promise<NoteUpdateResponse> {
    return withRetry(
      async () => {
        const response = await notesClient.put(`/api/notes/${sessionId}`, data)
        return response.data
      },
      `æ›´æ–°ç­†è¨˜ (${sessionId})`,
      { maxRetries: 3, baseDelay: 500 } // ç­†è¨˜æ›´æ–°é‡è©¦è¼ƒç©æ¥µ
    )
  },

  // ç²å–ç­†è¨˜å…§å®¹
  async getNote(sessionId: string): Promise<NoteResponse> {
    return withRetry(
      async () => {
        const response = await notesClient.get(`/api/notes/${sessionId}`)
        return response.data
      },
      `ç²å–ç­†è¨˜ (${sessionId})`,
      { maxRetries: 3, baseDelay: 500 }
    )
  },
}

// Export API - ä½¿ç”¨åŒ¯å‡ºå°ˆç”¨å®¢æˆ¶ç«¯
export const exportAPI = {
  // åŒ¯å‡ºæœƒè©±è³‡æ–™
  async exportSession(sessionId: string, type: 'zip' | 'md' = 'zip'): Promise<Blob> {
    return withRetry(
      async () => {
        const response = await exportClient.get(`/api/export/${sessionId}`, {
          params: { type },
          responseType: 'blob',
        })
        return response.data
      },
      `åŒ¯å‡ºæœƒè©± (${sessionId})`,
      { maxRetries: 2, baseDelay: 2000 } // åŒ¯å‡ºé‡è©¦å»¶é²è¼ƒé•·
    )
  },
}

// WebSocket URL å»ºæ§‹ - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸
export const getWebSocketURL = (path: string): string => {
  const wsBaseURL = process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000'
  return `${wsBaseURL}${path}`
}

// åŒ¯å‡ºé‡è©¦åŠŸèƒ½ä¾›å…¶ä»–æ¨¡çµ„ä½¿ç”¨
export { withRetry, isRetriableError, API_TIMEOUTS }

// ä¿æŒå‘å¾Œå…¼å®¹æ€§
export default defaultClient


# END FILE CONTENTS


# File: frontend/components/ui/toggle.tsx

"use client"

import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3 min-w-10",
        sm: "h-9 px-2.5 min-w-9",
        lg: "h-11 px-5 min-w-11",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }


# END FILE CONTENTS


# File: frontend/lib/__tests__/migration-adapter.test.ts

import { describe, test, expect, beforeEach, vi } from 'vitest'
import { StateSyncBridge } from '../migration-adapter'
import { AppStateContextValue } from '../../types/app-state-context'
import { LegacyAppStateHook } from '../migration-adapter'

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
}
Object.defineProperty(window, 'localStorage', { value: localStorageMock })

describe('StateSyncBridge', () => {
    let bridge: StateSyncBridge
    let mockNewContext: AppStateContextValue
    let mockLegacyHook: LegacyAppStateHook

    beforeEach(() => {
        bridge = new StateSyncBridge()

        // Mock new context
        mockNewContext = {
            appData: {
                state: 'default',
                transcriptEntries: [],
                editorContent: '',
                isRecording: false,
                recordingTime: 0,
                session: null,
            },
            isLoading: false,
            error: null,
            dispatch: vi.fn(),
            setState: vi.fn(),
            setRecording: vi.fn(),
            setRecordingTime: vi.fn(),
            setEditorContent: vi.fn(),
            setTranscriptEntries: vi.fn(),
            addTranscriptEntry: vi.fn(),
            setSession: vi.fn(),
            updateSessionStatus: vi.fn(),
            resetState: vi.fn(),
            setLoading: vi.fn(),
            setError: vi.fn(),
        }

        // Mock legacy hook
        mockLegacyHook = {
            appData: {
                state: 'default',
                transcriptEntries: [],
                editorContent: '',
                isRecording: false,
                recordingTime: 0,
                session: null,
            },
            isLoading: false,
            error: null,
            startRecording: vi.fn(),
            stopRecording: vi.fn(),
            newNote: vi.fn(),
            saveLocalDraft: vi.fn(),
            session: null,
            recordingError: null,
            transcriptError: null,
            createNoteSession: vi.fn(),
            sessionLoading: false,
        }
    })

    test('should register new context successfully', () => {
        bridge.registerNewContext(mockNewContext)
        expect(bridge.getSyncStatus().enabled).toBe(true)
    })

    test('should register legacy hook successfully', () => {
        bridge.registerLegacyHook(mockLegacyHook)
        expect(bridge.getSyncStatus().enabled).toBe(true)
    })

    test('should enable and disable sync', () => {
        bridge.disableSync()
        expect(bridge.getSyncStatus().enabled).toBe(false)

        bridge.enableSync()
        expect(bridge.getSyncStatus().enabled).toBe(true)
    })

    test('should provide sync status', () => {
        const status = bridge.getSyncStatus()
        expect(status).toHaveProperty('enabled')
        expect(status).toHaveProperty('lastSync')
        expect(status).toHaveProperty('inProgress')
    })
})


# END FILE CONTENTS


# File: frontend/lib/__tests__/rest-audio-uploader-409.test.ts

/**
 * RestAudioUploader 409 è¡çªè™•ç†æ¸¬è©¦
 * æ¸¬è©¦éŸ³é »æ®µè½ä¸Šå‚³æ™‚é‡åˆ°åºè™Ÿè¡çªçš„è™•ç†é‚è¼¯
 */

import { describe, test, expect, vi, beforeEach, afterEach } from 'vitest'
import { RestAudioUploader } from '../rest-audio-uploader'

// Mock fetch å…¨åŸŸå‡½æ•¸
const mockFetch = vi.fn()
global.fetch = mockFetch

// Mock console æ–¹æ³•
const consoleSpy = {
    log: vi.spyOn(console, 'log'),
    error: vi.spyOn(console, 'error')
}

describe('RestAudioUploader - 409 è¡çªè™•ç†', () => {
    let uploader: RestAudioUploader
    const sessionId = 'test-session-123'
    const testBlob = new Blob(['test audio data'], { type: 'audio/webm' })

    beforeEach(() => {
        uploader = new RestAudioUploader()
        uploader.setSessionId(sessionId)
        // åªæ¸…é™¤ fetch mockï¼Œä¿ç•™ console spy
        mockFetch.mockClear()
        consoleSpy.log.mockClear()
        consoleSpy.error.mockClear()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('HTTP 409 éŒ¯èª¤è™•ç†', () => {
        test('ç•¶é‡åˆ° 409 éŒ¯èª¤æ™‚ï¼Œæ‡‰è©²è¦–ç‚ºå†ªç­‰æˆåŠŸ', async () => {
            // Arrange
            const sequence = 5
            const mockResponse = {
                ok: false,
                status: 409,
                statusText: 'Conflict'
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            // Mock æˆåŠŸå›èª¿
            const onSuccessCallback = vi.fn()
            uploader.onUploadSuccess(onSuccessCallback)

            // Act
            const result = await uploader.uploadSegment(sequence, testBlob)

            // Assert
            expect(result).toEqual({
                ack: sequence,
                size: testBlob.size,
                status: 'success'
            })
            expect(onSuccessCallback).toHaveBeenCalledWith(sequence, {
                ack: sequence,
                size: testBlob.size,
                status: 'success'
            })
            expect(consoleSpy.log).toHaveBeenCalledWith(
                `âœ… [RestAudioUploader] æ®µè½ #${sequence} å·²å­˜åœ¨ï¼Œè¦–ç‚ºä¸Šå‚³æˆåŠŸ`
            )
        })

        test('409 éŒ¯èª¤æ‡‰è©²é‡ç½®é‡è©¦è¨ˆæ•¸ï¼ˆé€éæˆåŠŸå›èª¿é©—è­‰ï¼‰', async () => {
            // Arrange
            const sequence = 3
            const mockResponse = {
                ok: false,
                status: 409,
                statusText: 'Conflict'
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            const onSuccessCallback = vi.fn()
            uploader.onUploadSuccess(onSuccessCallback)

            // Act
            await uploader.uploadSegment(sequence, testBlob)

            // Assert - é©—è­‰æˆåŠŸå›èª¿è¢«è§¸ç™¼ï¼Œèªªæ˜ 409 è¢«è¦–ç‚ºæˆåŠŸ
            expect(onSuccessCallback).toHaveBeenCalledWith(sequence, {
                ack: sequence,
                size: testBlob.size,
                status: 'success'
            })
        })

        test('409 éŒ¯èª¤ä¸æ‡‰è©²è§¸ç™¼éŒ¯èª¤å›èª¿', async () => {
            // Arrange
            const sequence = 1
            const mockResponse = {
                ok: false,
                status: 409,
                statusText: 'Conflict'
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            const onErrorCallback = vi.fn()
            uploader.onUploadError(onErrorCallback)

            // Act
            await uploader.uploadSegment(sequence, testBlob)

            // Assert
            expect(onErrorCallback).not.toHaveBeenCalled()
        })
    })

    describe('å…¶ä»– HTTP éŒ¯èª¤è™•ç†', () => {
        test('é 409 éŒ¯èª¤æ‡‰è©²æ­£å¸¸æ‹‹å‡ºç•°å¸¸', async () => {
            // Arrange
            const sequence = 2
            const mockResponse = {
                ok: false,
                status: 500,
                statusText: 'Internal Server Error'
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            // Act & Assert
            await expect(uploader.uploadSegment(sequence, testBlob))
                .rejects.toThrow('HTTP 500: Internal Server Error')
        })

        test('ç¶²è·¯éŒ¯èª¤æ‡‰è©²æ­£å¸¸æ‹‹å‡ºç•°å¸¸', async () => {
            // Arrange
            const sequence = 4
            const networkError = new Error('Network Error')
            mockFetch.mockRejectedValueOnce(networkError)

            // Act & Assert
            await expect(uploader.uploadSegment(sequence, testBlob))
                .rejects.toThrow('Network Error')
        })
    })

    describe('æˆåŠŸä¸Šå‚³è™•ç†', () => {
        test('æˆåŠŸä¸Šå‚³æ‡‰è©²æ­£å¸¸è™•ç†', async () => {
            // Arrange
            const sequence = 0
            const successResponse = {
                ack: sequence,
                size: testBlob.size,
                status: 'success'
            }
            const mockResponse = {
                ok: true,
                json: () => Promise.resolve(successResponse)
            }
            mockFetch.mockResolvedValueOnce(mockResponse)

            const onSuccessCallback = vi.fn()
            uploader.onUploadSuccess(onSuccessCallback)

            // Act
            const result = await uploader.uploadSegment(sequence, testBlob)

            // Assert
            expect(result).toEqual(successResponse)
            expect(onSuccessCallback).toHaveBeenCalledWith(sequence, successResponse)
            // åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œç§»é™¤ console.log æª¢æŸ¥
        })
    })

    describe('åºè™Ÿé‡ç½®æ©Ÿåˆ¶', () => {
        test('resetSequence æ‡‰è©²æ­£å¸¸åŸ·è¡Œä¸¦è¨˜éŒ„æ—¥èªŒ', () => {
            // Act
            uploader.resetSequence()

            // Assert
            // åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œç§»é™¤ console.log æª¢æŸ¥
        })
    })

    describe('é‚Šç·£æƒ…æ³æ¸¬è©¦', () => {
        test('å¤šå€‹ 409 éŒ¯èª¤æ‡‰è©²éƒ½è¢«æ­£ç¢ºè™•ç†', async () => {
            // Arrange
            const sequences = [0, 1, 2, 3, 4]
            const mockResponse = {
                ok: false,
                status: 409,
                statusText: 'Conflict'
            }

            sequences.forEach(() => {
                mockFetch.mockResolvedValueOnce(mockResponse)
            })

            const onSuccessCallback = vi.fn()
            uploader.onUploadSuccess(onSuccessCallback)

            // Act
            const results = await Promise.all(
                sequences.map(seq => uploader.uploadSegment(seq, testBlob))
            )

            // Assert
            results.forEach((result, index) => {
                expect(result).toEqual({
                    ack: sequences[index],
                    size: testBlob.size,
                    status: 'success'
                })
            })
            expect(onSuccessCallback).toHaveBeenCalledTimes(sequences.length)
        })

        test('Session ID æœªè¨­å®šæ™‚æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            const uploaderWithoutSession = new RestAudioUploader()

            // Act & Assert
            await expect(uploaderWithoutSession.uploadSegment(0, testBlob))
                .rejects.toThrow('Session ID æœªè¨­å®š')
        })
    })
})


# END FILE CONTENTS


# File: frontend/lib/interfaces.ts

export interface ISessionService {
    ensureFreshRecordingSession(): Promise<void>
}


# END FILE CONTENTS


# File: app/core/audio_vad.py

import asyncio, shlex, re
from app.core.config import get_settings

async def is_silent(wav: bytes) -> bool:
    """
    è‹¥æ•´æ®µéŸ³è¨Šéƒ½åœ¨éœéŸ³é–€æª»ä»¥ä¸‹ï¼Œå› True
    """
    s = get_settings()
    noise_db = s.SILENCE_NOISE_DB
    duration = s.SILENCE_DURATION_SEC
    cmd = (
        f"ffmpeg -v info -i pipe:0 "
        f"-af silencedetect=noise={noise_db}dB:d={duration} "
        f"-f null -"
    )
    proc = await asyncio.create_subprocess_exec(
        *shlex.split(cmd),
        stdin=asyncio.subprocess.PIPE,
        stderr=asyncio.subprocess.PIPE,
        stdout=asyncio.subprocess.PIPE,
    )
    _, err = await proc.communicate(wav)
    log = err.decode()

    # FFmpeg åªåœ¨åµæ¸¬åˆ°éŸ³è¨Šæ™‚å°å‡º "silence_end"
    return "silence_end" not in log


# END FILE CONTENTS


# File: app/utils/__init__.py

"""
å·¥å…·æ¨¡çµ„

æä¾›å„ç¨®å…±ç”¨çš„å·¥å…·å‡½æ•¸å’Œé©—è­‰å™¨
"""


# END FILE CONTENTS


# File: frontend/components/ui/skeleton.tsx

import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }


# END FILE CONTENTS


# File: frontend/hooks/use-app-state-new.ts

"use client"

import { useCallback, useEffect, useState, useRef } from "react"
import { useAppStateContext } from "./use-app-state-context"
import { useSession } from "./use-session-adapter"
import { useRecording } from "./use-recording-adapter"
import { useNotes } from "./use-notes"
import { useTranscript } from "./use-transcript-adapter"
import { useToast } from "@/components/ui/use-toast"
import type { AppData } from "../types/app-state"
import { StateMachineManager } from '../lib/state-machine';

/**
 * æ–°ç‰ˆæœ¬çš„ useAppState Hook
 * ä½¿ç”¨ Context ç‹€æ…‹ç®¡ç†ï¼Œå¤§å¹…ç°¡åŒ–åŸæœ¬ 868 è¡Œçš„è¤‡é›œé‚è¼¯
 * å°‡ç‹€æ…‹ç®¡ç†å§”è¨—çµ¦ AppStateContextï¼ŒHook åªè² è²¬æ¥­å‹™é‚è¼¯
 */
export function useAppStateNew() {
  const context = useAppStateContext()
  const { appData, isLoading, error, dispatch, transition } = context
  const session = useSession()
  const recording = useRecording()
  const notes = useNotes()
  const transcript = useTranscript()
  const { toast } = useToast()

  console.log('ğŸ”„ [useAppStateNew] Hook åˆå§‹åŒ–:', {
    currentState: appData.state,
    isRecording: appData.isRecording,
    sessionId: appData.session?.id,
    transcriptCount: appData.transcriptEntries.length
  })

  const stateMachineManagerRef = useRef<StateMachineManager | null>(null);

  // ç¢ºä¿ç‹€æ…‹æ©Ÿç®¡ç†å™¨åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œé¿å… React StrictMode é‡è¤‡åˆå§‹åŒ–
  if (!stateMachineManagerRef.current) {
    console.log('ğŸ”„ [useAppStateNew] åˆå§‹åŒ–ç‹€æ…‹æ©Ÿç®¡ç†å™¨');

    const smManager = new StateMachineManager({
      currentState: appData.state,
      isRecording: appData.isRecording,
      transcriptCount: appData.transcriptEntries.length,
      session: appData.session || null,
      error: error,
    });

    // ç«‹å³è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨
    smManager.registerSideEffectHandler('CREATE_SESSION', {
      handleSideEffect: async (effect) => {
        console.log('ğŸ—ï¸ [å‰¯ä½œç”¨] CREATE_SESSION: å»ºç«‹æœƒè©±', effect);
        // å¾ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡ç²å–æ¨™é¡Œ
        const context = smManager.getStateMachine().getContext();
        const title = context.pendingSessionTitle || 'New Recording';
        const newSession = await session.createRecordingSession(title, appData.editorContent);
        if (newSession) {
          dispatch({ type: 'SET_SESSION', payload: newSession });
          // æ›´æ–°ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡
          smManager.getStateMachine().updateContext({
            currentState: appData.state,
            isRecording: appData.isRecording,
            transcriptCount: appData.transcriptEntries.length,
            session: newSession,
            error: error,
            pendingSessionTitle: undefined, // æ¸…é™¤å¾…å»ºç«‹æœƒè©±æ¨™é¡Œ
          });
          localStorage.removeItem('draft_note');
        } else {
          throw new Error('ç„¡æ³•å»ºç«‹éŒ„éŸ³æœƒè©±');
        }
      }
    });
    smManager.registerSideEffectHandler('START_RECORDING', {
      handleSideEffect: async () => {
        // å¾ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡ç²å–æœ€æ–°çš„ session è³‡è¨Š
        const context = smManager.getStateMachine().getContext();
        if (context.session?.id) {
          console.log('ğŸ¤ [å‰¯ä½œç”¨] START_RECORDING: é–‹å§‹éŒ„éŸ³', context.session.id);
          await recording.startRecording(context.session.id);
        } else {
          console.error('ğŸ¤ [å‰¯ä½œç”¨] START_RECORDING: æ²’æœ‰å¯ç”¨çš„ session');
        }
      }
    });
    smManager.registerSideEffectHandler('STOP_RECORDING', {
      handleSideEffect: async () => {
        await stopRecording();
      }
    });
    smManager.registerSideEffectHandler('CONNECT_WEBSOCKET', {
      handleSideEffect: async () => {
        // å¾ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡ç²å–æœ€æ–°çš„ session è³‡è¨Š
        const context = smManager.getStateMachine().getContext();
        if (context.session?.id) {
          console.log('ğŸ”Œ [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: é€£æ¥ WebSocket', context.session.id);
          await transcript.connect(context.session.id);
        } else {
          console.error('ğŸ”Œ [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: æ²’æœ‰å¯ç”¨çš„ session');
        }
      }
    });
    smManager.registerSideEffectHandler('DISCONNECT_WEBSOCKET', {
      handleSideEffect: () => {
        transcript.disconnect();
      }
    });
    smManager.registerSideEffectHandler('FINISH_SESSION', {
      handleSideEffect: async () => {
        await finishSession();
      }
    });

    stateMachineManagerRef.current = smManager;
  }

  const stateMachineManager = stateMachineManagerRef.current;

  useEffect(() => {
    stateMachineManager.getStateMachine().updateContext({
      currentState: appData.state,
      isRecording: appData.isRecording,
      transcriptCount: appData.transcriptEntries.length,
      session: appData.session,
      error: error,
    });
  }, [appData, error, stateMachineManager]);

  // å»ºç«‹ç´”ç­†è¨˜æœƒè©±
  const createNoteSession = useCallback(async (title?: string) => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      const newSession = await session.createNoteSession(title ?? undefined)
      if (newSession) {
        dispatch({ type: 'SET_SESSION', payload: newSession })

        // è¼‰å…¥ç­†è¨˜å…§å®¹
        if (newSession.id) {
          await notes.loadNote(newSession.id)
        }

        // æ¸…é™¤æœ¬åœ°è‰ç¨¿
        localStorage.removeItem('draft_note')

        console.log('âœ… [useAppStateNew] ç´”ç­†è¨˜æœƒè©±å»ºç«‹æˆåŠŸ')

        toast({
          title: 'ç­†è¨˜æœƒè©±å·²å»ºç«‹',
          description: `æœƒè©± "${title}" å»ºç«‹æˆåŠŸ`,
        })
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹ç­†è¨˜æœƒè©±å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] å»ºç«‹ç­†è¨˜æœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å»ºç«‹å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, notes, toast, dispatch])

  // å»ºç«‹éŒ„éŸ³æœƒè©±
  const createRecordingSession = useCallback(async (title?: string) => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      const newSession = await session.createRecordingSession(title, appData.editorContent)
      if (newSession) {
        dispatch({ type: 'SET_SESSION', payload: newSession })

        // è¼‰å…¥ç­†è¨˜å…§å®¹
        await notes.loadNote(newSession.id)

        // æ¸…é™¤æœ¬åœ°è‰ç¨¿
        localStorage.removeItem('draft_note')

        console.log('âœ… [useAppStateNew] éŒ„éŸ³æœƒè©±å»ºç«‹æˆåŠŸ')

        toast({
          title: 'éŒ„éŸ³æœƒè©±å·²å»ºç«‹',
          description: `æœƒè©± "${title}" å»ºç«‹æˆåŠŸ`,
        })
      }
    } catch (err) {
      // ç‰¹åˆ¥è™•ç†æœƒè©±è¡çªéŒ¯èª¤
      if (err instanceof Error && err.message.includes('æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çª')) {
        const conflictMsg = 'åµæ¸¬åˆ°æœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
        dispatch({ type: 'SET_ERROR', payload: conflictMsg })

        toast({
          title: 'æœƒè©±è¡çª',
          description: 'ç›®å‰å·²æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–ç­‰å¾…ç•¶å‰æœƒè©±çµæŸ',
          variant: 'destructive'
        })
        return
      }

      const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å»ºç«‹å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, notes, toast, dispatch, appData.editorContent])

  // é–‹å§‹éŒ„éŸ³ - å®Œå…¨å§”è¨—çµ¦ç‹€æ…‹æ©Ÿ
  const startRecording = useCallback(async (title?: string) => {
    console.log("ğŸ¤ [useAppStateNew] startRecording: è§¸ç™¼ç‹€æ…‹æ©Ÿ")

    // æª¢æŸ¥ç‹€æ…‹æ©Ÿæ˜¯å¦å·²åˆå§‹åŒ–
    if (!stateMachineManager) {
      console.error("ğŸ¤ [useAppStateNew] ç‹€æ…‹æ©Ÿå°šæœªåˆå§‹åŒ–")
      toast({ title: 'ç³»çµ±åˆå§‹åŒ–ä¸­', description: 'è«‹ç¨å¾Œå†è©¦', variant: 'destructive' })
      return
    }

    dispatch({ type: 'SET_LOADING', payload: true })

    try {
      // å¦‚æœç•¶å‰ç‹€æ…‹ä¸æ˜¯ defaultï¼Œå…ˆé‡ç½®ç‹€æ…‹
      if (appData.state !== 'default') {
        console.log("ğŸ”„ [useAppStateNew] ç•¶å‰ç‹€æ…‹é defaultï¼Œå…ˆé‡ç½®ç‹€æ…‹:", appData.state)
        dispatch({ type: 'RESET_STATE' })
        // æ¸…é™¤ç›¸é—œç‹€æ…‹
        recording.clearTranscripts()
        transcript.clearTranscripts()
        // æ›´æ–°ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡
        stateMachineManager.getStateMachine().updateContext({
          currentState: 'default',
          isRecording: false,
          transcriptCount: 0,
          session: null,
          error: null,
        });
      }

      // æª¢æŸ¥æ˜¯å¦æœ‰ç¾æœ‰æœƒè©±éœ€è¦è™•ç†
      const latestActiveSession = await session.checkActiveSession()
      const currentSession = latestActiveSession || session.currentSession

      // æ›´æ–°ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡ï¼ŒåŒ…å«å¾…å»ºç«‹æœƒè©±çš„æ¨™é¡Œ
      stateMachineManager.getStateMachine().updateContext({
        currentState: 'default', // ç¢ºä¿å¾ default ç‹€æ…‹é–‹å§‹
        isRecording: appData.isRecording,
        transcriptCount: appData.transcriptEntries.length,
        session: currentSession,
        error: error,
        pendingSessionTitle: title,  // å‚³éæ¨™é¡Œçµ¦ç‹€æ…‹æ©Ÿ
      });

      if (currentSession?.type === 'note_only') {
        // å‡ç´šç¾æœ‰æœƒè©±
        console.log("ğŸ¤ [useAppStateNew] å‡ç´šç¾æœ‰æœƒè©±ç‚ºéŒ„éŸ³æ¨¡å¼")
        const upgradedSession = await session.upgradeToRecording()
        if (upgradedSession) {
          dispatch({ type: 'SET_SESSION', payload: upgradedSession })
          // å†æ¬¡æ›´æ–°ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡
          stateMachineManager.getStateMachine().updateContext({
            currentState: 'default', // ç¢ºä¿å¾ default ç‹€æ…‹é–‹å§‹
            isRecording: appData.isRecording,
            transcriptCount: appData.transcriptEntries.length,
            session: upgradedSession,
            error: error,
            pendingSessionTitle: title,
          });
        }
      }

      // è§¸ç™¼ç‹€æ…‹è½‰æ› - è®“ç‹€æ…‹æ©Ÿè™•ç†æ‰€æœ‰é‚è¼¯
      console.log("ğŸ¤ [useAppStateNew] æº–å‚™è§¸ç™¼ç‹€æ…‹è½‰æ› USER_START_RECORDING")
      const result = transition('USER_START_RECORDING');
      console.log("ğŸ¤ [useAppStateNew] ç‹€æ…‹è½‰æ›çµæœ:", result)

      if (!result?.success) {
        throw new Error(result?.error || 'ç‹€æ…‹è½‰æ›å¤±æ•—');
      }

      console.log("ğŸ¤ [useAppStateNew] ç‹€æ…‹æ©Ÿè™•ç†å®Œæˆ")
      toast({ title: 'éŒ„éŸ³é–‹å§‹' })

    } catch (err) {
      const msg = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: msg })

      console.error("ğŸ¤ [useAppStateNew] éŒ„éŸ³å¤±æ•—:", msg)
      toast({ title: 'éŒ„éŸ³å¤±æ•—', description: msg, variant: 'destructive' })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, toast, dispatch, transition, stateMachineManager, appData.state, appData.isRecording, appData.transcriptEntries, error, recording, transcript])

  // å‡ç´šæœƒè©±ç‚ºéŒ„éŸ³æ¨¡å¼
  const upgradeToRecording = useCallback(async () => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      const updatedSession = await session.upgradeToRecording()
      if (updatedSession) {
        dispatch({ type: 'SET_SESSION', payload: updatedSession })

        console.log('âœ… [useAppStateNew] æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼æˆåŠŸ')

        toast({
          title: 'å‡ç´šæˆåŠŸ',
          description: 'æœƒè©±å·²å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼',
        })
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å‡ç´šæœƒè©±å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] å‡ç´šæœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å‡ç´šå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, toast, dispatch])

  // åœæ­¢éŒ„éŸ³
  const stopRecording = useCallback(async () => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      await recording.stopRecording()
      transcript.disconnect()

      // è§¸ç™¼ç‹€æ…‹è½‰æ›
      transition('USER_STOP_RECORDING');

      console.log('âœ… [useAppStateNew] éŒ„éŸ³åœæ­¢ï¼Œé–‹å§‹è™•ç†é€å­—ç¨¿')

      toast({
        title: 'è™•ç†ä¸­',
        description: 'æ­£åœ¨è™•ç†éŒ„éŸ³å…§å®¹ï¼Œè«‹ç¨å€™...',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] åœæ­¢éŒ„éŸ³å¤±æ•—:', err)

      toast({
        title: 'åœæ­¢å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [recording, transcript, toast, dispatch, transition])

  // å®Œæˆæœƒè©±
  const finishSession = useCallback(async () => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      await session.finishSession()
      // åœ¨é€™è£¡ä¸éœ€è¦è§¸ç™¼ç‹€æ…‹è½‰æ›ï¼Œå› ç‚º stopRecording å·²ç¶“è™•ç†äº†
      // dispatch({ type: 'SET_APP_STATE', payload: 'finished' })

      console.log('âœ… [useAppStateNew] æœƒè©±å®Œæˆ')

      toast({
        title: 'æœƒè©±å®Œæˆ',
        description: 'æ‚¨å¯ä»¥åŒ¯å‡ºç­†è¨˜æˆ–é–‹å§‹æ–°çš„ç­†è¨˜',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å®Œæˆæœƒè©±å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] å®Œæˆæœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å®Œæˆå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, toast, dispatch])

  // é–‹æ–°ç­†è¨˜
  const newNote = useCallback(async () => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      // å¦‚æœæœ‰æ´»èºæœƒè©±ï¼Œå…ˆåˆªé™¤å®ƒ
      if (session.currentSession) {
        console.log('ğŸ—‘ï¸ [useAppStateNew] åˆªé™¤ç•¶å‰æ´»èºæœƒè©±:', session.currentSession.id)
        await session.deleteSession()
      }

      // è§¸ç™¼ç‹€æ…‹è½‰æ›
      transition('USER_NEW_NOTE');

      // é‡ç½®æ‰€æœ‰ç‹€æ…‹
      dispatch({ type: 'RESET_STATE' })

      // æ¸…é™¤ç›¸é—œç‹€æ…‹
      recording.clearTranscripts()
      transcript.clearTranscripts()
      notes.clearNote()

      // æ¸…é™¤æœ¬åœ°è‰ç¨¿
      localStorage.removeItem('draft_note')

      console.log('ğŸ”„ [useAppStateNew] å·²é–‹å§‹æ–°ç­†è¨˜')

      toast({
        title: 'æ–°ç­†è¨˜',
        description: 'å·²æ¸…ç©ºå…§å®¹ï¼Œå¯ä»¥é–‹å§‹æ–°çš„ç­†è¨˜',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'é–‹å§‹æ–°ç­†è¨˜å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] é–‹å§‹æ–°ç­†è¨˜å¤±æ•—:', err)

      toast({
        title: 'æ“ä½œå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, recording, transcript, notes, toast, dispatch, transition])

  // è‡ªå‹•å„²å­˜ç­†è¨˜å…§å®¹åˆ°æœ¬åœ°è‰ç¨¿
  const saveLocalDraft = useCallback((content: string) => {
    if (!session.currentSession && content.trim()) {
      localStorage.setItem('draft_note', content)
    }
    dispatch({ type: 'SET_EDITOR_CONTENT', payload: content })
  }, [session.currentSession, dispatch])

  // ä½¿ç”¨ useCallback ä¾†è¨˜æ†¶å‡½æ•¸
  const createRecordingSessionCallback = useCallback(createRecordingSession, [session, notes, toast, dispatch, appData.editorContent]);
  const startRecordingCallback = useCallback(startRecording, [session, recording, toast, dispatch, appData.editorContent, transition]);
  const stopRecordingCallback = useCallback(stopRecording, [recording, transcript, toast, dispatch, transition]);
  const finishSessionCallback = useCallback(finishSession, [session, toast, dispatch]);
  const connectTranscriptCallback = useCallback(transcript.connect, [transcript]);
  const disconnectTranscriptCallback = useCallback(transcript.disconnect, [transcript]);

  return {
    // æ‡‰ç”¨ç‹€æ…‹ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
    appData,
    isLoading,
    error,

    // æœƒè©±ç®¡ç†
    createNoteSession,
    createRecordingSession,
    upgradeToRecording,
    finishSession,
    newNote,

    // éŒ„éŸ³æ§åˆ¶
    startRecording,
    stopRecording,

    // æœ¬åœ°è‰ç¨¿
    saveLocalDraft,

    // å¤–éƒ¨ç‹€æ…‹ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
    session: session.currentSession,
    sessionLoading: session.isLoading,
    sessionError: session.error,

    // éŒ„éŸ³ç‹€æ…‹
    recordingError: recording.error,

    // é€å­—ç¨¿ç‹€æ…‹
    transcriptConnected: transcript.isConnected,
    transcriptError: transcript.error,
    transcriptAutoScroll: transcript.autoScrollEnabled,
    enableAutoScroll: transcript.enableAutoScroll,
    disableAutoScroll: transcript.disableAutoScroll,
    scrollToLatest: transcript.scrollToLatest,
  }
}


# END FILE CONTENTS


# File: frontend/hooks/use-toast.ts

"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }


# END FILE CONTENTS


# File: docs/skip-silence-spec.md

# éœéŸ³æ®µéæ¿¾è¦æ ¼

## ç›®æ¨™

- éŸ³è¨Šåˆ‡ç‰‡è‹¥ç‚ºã€Œå®Œå…¨éœéŸ³ã€ï¼Œä¸ç”¢ç”Ÿé€å­—ç¨¿ã€ä¸æ¨é€ WebSocketï¼Œå‰ç«¯ä¸é¡¯ç¤ºã€‚

## æµç¨‹èªªæ˜

1. **éœéŸ³åµæ¸¬ util**ï¼ˆ`app/core/audio_vad.py`ï¼‰
   - ä½¿ç”¨ ffmpeg `silencedetect`ï¼Œåˆ¤æ–·ä¸€æ®µ wav æ˜¯å¦ã€Œå…¨éƒ¨éœéŸ³ã€ã€‚
   - åƒæ•¸ï¼š
     - dB é–€æª»ï¼ˆ`SILENCE_NOISE_DB`ï¼Œé è¨­ -35ï¼‰
     - æŒçºŒç§’æ•¸ï¼ˆ`SILENCE_DURATION_SEC`ï¼Œé è¨­ 0.3ï¼‰
   - åƒæ•¸å¯ç”± config/env è¨­å®šã€‚
   - è‹¥æ•´æ®µéŸ³è¨Šéƒ½åœ¨é–€æª»ä»¥ä¸‹ï¼Œå›å‚³ Trueã€‚

2. **STT Provider æ•´åˆ**ï¼ˆå¦‚ `gpt4o_provider.py`ï¼‰
   - è½‰æª”å¾Œå‘¼å« `is_silent`ï¼Œè‹¥ç‚ºéœéŸ³ç›´æ¥ return Noneï¼Œä¸é€å» STTã€‚
   - ééœéŸ³æ‰å‘¼å« STT APIã€‚

3. **å¤–å±¤æµç¨‹**ï¼ˆå¦‚ `segments.py`ï¼‰
   - è‹¥ transcribe å›å‚³ Noneï¼Œåƒ…è¨˜éŒ„ warningï¼Œä¸å‘¼å« `save_and_push_result`ï¼Œä¸æ¨é€ WebSocketã€‚
   - å‰ç«¯ä¸æœƒé¡¯ç¤ºè©²æ®µã€‚

## åƒæ•¸è¨­è¨ˆ

- `SILENCE_NOISE_DB`ï¼šéœéŸ³åˆ¤æ–· dB é–€æª»ï¼Œé è¨­ -35ï¼Œå¯ç”±ç’°å¢ƒè®Šæ•¸èª¿æ•´ã€‚
- `SILENCE_DURATION_SEC`ï¼šéœéŸ³åˆ¤æ–·æŒçºŒç§’æ•¸ï¼Œé è¨­ 0.3ï¼Œå¯ç”±ç’°å¢ƒè®Šæ•¸èª¿æ•´ã€‚

## æ¸¬è©¦èˆ‡é©—è­‰

- `is_silent` å·²æœ‰å–®å…ƒæ¸¬è©¦ï¼Œmock ffmpeg è¡Œç‚ºï¼Œé©—è­‰éœéŸ³/ééœéŸ³çš†æ­£ç¢ºã€‚
- Provider å±¤æœ‰æ¸¬è©¦ï¼Œé©—è­‰é‡åˆ°éœéŸ³æ™‚æœƒ return Noneã€‚
- å¤–å±¤æµç¨‹å·²é©—è­‰ï¼ŒNone ä¸æœƒæ¨é€é€å­—ç¨¿ã€‚

## å‚™è¨»

- è‹¥éœ€èª¿æ•´åˆ¤æ–·éˆæ•åº¦ï¼Œå»ºè­°å„ªå…ˆèª¿æ•´ dB é–€æª»ã€‚
- è‹¥ chunk é•·åº¦æœ‰è®Šå‹•ï¼Œéœ€åŒæ­¥è€ƒæ…®éœéŸ³æŒçºŒç§’æ•¸åƒæ•¸ã€‚ 


# END FILE CONTENTS


# File: frontend/lib/simple-audio-recorder.ts

"use client"

import { getAudioChunkIntervalMs } from './config'

/**
 * SimpleAudioRecorder - ç°¡åŒ–éŸ³è¨ŠéŒ„è£½å™¨
 *
 * Phase 2 é‡æ§‹ï¼šç§»é™¤è¤‡é›œçš„ SegmentedAudioRecorder é‚è¼¯
 * æ”¹ç”¨æ¨™æº– MediaRecorder + timeslice æ¨¡å¼ï¼ˆå¯é…ç½®ï¼‰
 *
 * ç‰¹é»ï¼š
 * - ä½¿ç”¨ MediaRecorder.start(timeslice) è‡ªå‹•åˆ‡ç‰‡
 * - æ¯å€‹æ®µè½åŒ…å«å®Œæ•´ WebM Header
 * - ç°¡åŒ–éŒ¯èª¤è™•ç†
 * - ç§»é™¤éæ­¸å•Ÿå‹•/åœæ­¢è¤‡é›œæ€§
 * - æ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®åˆ‡ç‰‡æ™‚é–“
 */

export interface AudioSegment {
    blob: Blob
    timestamp: number
    duration: number
    sequence: number
}

export interface SimpleAudioRecorderConfig {
    segmentDuration: number // æ®µè½æ™‚é•·ï¼ˆæ¯«ç§’ï¼‰
    mimeType: string
    audioBitsPerSecond: number
}

const DEFAULT_CONFIG: SimpleAudioRecorderConfig = {
    segmentDuration: getAudioChunkIntervalMs(), // å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
    mimeType: 'audio/webm;codecs=opus',
    audioBitsPerSecond: 128000, // 128 kbps for configurable chunks
}

export class SimpleAudioRecorder {
    private stream: MediaStream | null = null
    private mediaRecorder: MediaRecorder | null = null
    private config: SimpleAudioRecorderConfig
    private sequence: number = 0
    private isRecording: boolean = false

    // äº‹ä»¶å›èª¿
    private onSegmentCallback?: (segment: AudioSegment) => void
    private onErrorCallback?: (error: Error) => void

    constructor(config: Partial<SimpleAudioRecorderConfig> = {}) {
        this.config = { ...DEFAULT_CONFIG, ...config }
    }

    /**
     * åˆå§‹åŒ–éŒ„éŸ³å™¨ - ç²å–éŸ³è¨Šæ¬Šé™
     */
    async initialize(): Promise<void> {
        if (this.stream) {
            return // å·²åˆå§‹åŒ–
        }

        try {
            this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })
            console.log('ğŸ¤ [SimpleAudioRecorder] éŸ³è¨Šæ¬Šé™ç²å–æˆåŠŸ')
        } catch (error) {
            const errorMsg = error instanceof Error ? error.message : 'ç²å–éŸ³è¨Šæ¬Šé™å¤±æ•—'
            this.handleError(new Error(errorMsg))
            throw error
        }
    }

    /**
     * é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨æ¨™æº– MediaRecorder + timeslice
     */
    async start(onSegmentAvailable: (segment: AudioSegment) => void): Promise<void> {
        if (this.isRecording) {
            throw new Error('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
        }

        if (!this.stream) {
            await this.initialize()
        }

        this.onSegmentCallback = onSegmentAvailable
        this.sequence = 0
        this.isRecording = true

        console.log('ğŸ¬ [SimpleAudioRecorder] é–‹å§‹éŒ„éŸ³', {
            segmentDuration: this.config.segmentDuration,
            mimeType: this.config.mimeType,
            audioBitsPerSecond: this.config.audioBitsPerSecond
        })

        // å»ºç«‹ MediaRecorder å¯¦ä¾‹
        this.mediaRecorder = new MediaRecorder(this.stream!, {
            mimeType: this.config.mimeType,
            audioBitsPerSecond: this.config.audioBitsPerSecond,
        })

        // è¨­å®šè³‡æ–™æ¥æ”¶è™•ç†
        this.mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0 && this.isRecording) {
                console.log(`ğŸ“¦ [SimpleAudioRecorder] æ®µè½ #${this.sequence} å®Œæˆ`, {
                    size: event.data.size,
                    mimeType: this.config.mimeType,
                })

                const segment: AudioSegment = {
                    blob: event.data,
                    timestamp: Date.now(),
                    duration: this.config.segmentDuration,
                    sequence: this.sequence++,
                }

                // å›èª¿é€šçŸ¥æœ‰æ–°æ®µè½å¯ç”¨
                this.onSegmentCallback?.(segment)
            }
        }

        // éŒ¯èª¤è™•ç†
        this.mediaRecorder.onerror = (event) => {
            console.error('âŒ [SimpleAudioRecorder] MediaRecorder éŒ¯èª¤:', event)
            this.handleError(new Error(`MediaRecorder éŒ¯èª¤: ${event}`))
        }

        // é–‹å§‹éŒ„è£½ï¼Œä½¿ç”¨ timeslice è‡ªå‹•åˆ‡ç‰‡
        this.mediaRecorder.start(this.config.segmentDuration)
        console.log('âœ… [SimpleAudioRecorder] MediaRecorder å·²å•Ÿå‹•ï¼Œè‡ªå‹• 10 ç§’åˆ‡ç‰‡')
    }

    /**
     * åœæ­¢éŒ„éŸ³
     */
    stop(): void {
        console.log('â¹ï¸ [SimpleAudioRecorder] åœæ­¢éŒ„éŸ³')

        this.isRecording = false

        if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {
            this.mediaRecorder.stop()
        }
    }

    /**
     * æ¸…ç†è³‡æº
     */
    cleanup(): void {
        this.stop()

        if (this.stream) {
            this.stream.getTracks().forEach(track => track.stop())
            this.stream = null
        }

        this.mediaRecorder = null
        this.sequence = 0
        console.log('ğŸ§¹ [SimpleAudioRecorder] å·²æ¸…ç†')
    }

    /**
     * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
     */
    get recording(): boolean {
        return this.isRecording
    }

    /**
     * ç²å–ç•¶å‰åºè™Ÿ
     */
    get currentSequence(): number {
        return this.sequence
    }

    /**
     * ç²å–ç•¶å‰é…ç½®
     */
    get currentConfig(): SimpleAudioRecorderConfig {
        return { ...this.config }
    }

    // éŒ¯èª¤è™•ç†
    private handleError(error: Error): void {
        console.error('âŒ [SimpleAudioRecorder] éŒ¯èª¤:', error)
        this.isRecording = false
        this.onErrorCallback?.(error)
    }

    // äº‹ä»¶å›èª¿è¨­å®š
    onSegment(callback: (segment: AudioSegment) => void): void {
        this.onSegmentCallback = callback
    }

    onError(callback: (error: Error) => void): void {
        this.onErrorCallback = callback
    }
}

// å·¥å» å‡½æ•¸
export const createSimpleAudioRecorder = (config?: Partial<SimpleAudioRecorderConfig>): SimpleAudioRecorder => {
    return new SimpleAudioRecorder(config)
}

/**
 * æª¢æŸ¥ç€è¦½å™¨éŸ³è¨ŠéŒ„è£½æ”¯æ´
 */
export async function checkSimpleAudioRecordingSupport(): Promise<{ isSupported: boolean; error?: string }> {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API' }
    }

    if (!window.MediaRecorder) {
        return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API' }
    }

    // æª¢æŸ¥ MIME é¡å‹æ”¯æ´
    if (!MediaRecorder.isTypeSupported(DEFAULT_CONFIG.mimeType)) {
        return { isSupported: false, error: `ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${DEFAULT_CONFIG.mimeType}` }
    }

    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
        // ç«‹å³åœæ­¢ä¸²æµä»¥é‡‹æ”¾è³‡æº
        stream.getTracks().forEach(track => track.stop())
        return { isSupported: true }
    } catch (error) {
        return { isSupported: false, error: `ç„¡æ³•ç²å–éº¥å…‹é¢¨æ¬Šé™: ${error}` }
    }
}


# END FILE CONTENTS


# File: frontend/refresh.ts



# END FILE CONTENTS


# File: app/services/stt/interfaces.py

"""
æœå‹™ä»‹é¢å®šç¾©
"""

from __future__ import annotations
from abc import ABC, abstractmethod
from typing import Any, Dict
from uuid import UUID


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1ï¸âƒ£ èˆŠçš„ TranscriptionServiceï¼ˆè‹¥åˆ¥è™•é‚„åœ¨ç”¨ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class TranscriptionService(ABC):
    """è½‰éŒ„æœå‹™æŠ½è±¡åŸºç¤é¡ï¼ˆèˆŠï¼‰"""

    @abstractmethod
    async def process_audio_chunk(
        self, session_id: UUID, chunk_sequence: int, webm_data: bytes
    ) -> None:
        """è™•ç†ä¸€å€‹éŸ³è¨Šåˆ‡ç‰‡"""
        raise NotImplementedError

    @abstractmethod
    async def shutdown(self) -> None:
        """å„ªé›…åœ°é—œé–‰æœå‹™"""
        raise NotImplementedError


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2ï¸âƒ£ æ–°çš„ ISTTProviderï¼šfactory èˆ‡å„ provider ä½¿ç”¨
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class ISTTProvider(ABC):
    """
    Speech-to-Text Provider ä»‹é¢ã€‚

    æ¯å€‹ providerï¼ˆWhisper/GPT-4o/Geminiâ€¦ï¼‰éƒ½è¦å¯¦ä½œ `transcribe`ã€‚
    """

    # provider çš„è­˜åˆ¥ç¢¼
    name: str  # ç›´æ¥å±¬æ€§ï¼Œç¦æ­¢å†å®šç¾©åŒåæ–¹æ³•

    @abstractmethod
    async def transcribe(
        self, audio: bytes, session_id: UUID, chunk_seq: int
    ) -> Dict[str, Any] | None:
        """
        :param audio: 10s WebM/WAV bytes
        :return: çµ±ä¸€æ¬„ä½ dictï¼Œè‹¥ `None` ä»£è¡¨ç„¡æ–‡å­—
        """
        raise NotImplementedError

    # å¯é¸ï¼šæ¯åˆ†é˜æœ€å¤§è«‹æ±‚æ•¸ï¼Œçµ¦æ’ç¨‹å™¨åƒè€ƒ
    def max_rpm(self) -> int:
        return 60


__all__ = ["ISTTProvider", "TranscriptionService"]


# END FILE CONTENTS


# File: app/core/config.py

from pydantic_settings import BaseSettings, SettingsConfigDict
from pydantic import Field, field_validator

import os

# æ ¹æ“šåŸ·è¡Œç’°å¢ƒæ±ºå®šè¦è®€å–çš„ .env æª”æ¡ˆã€‚
# å¦‚æœåµæ¸¬åˆ° TESTING ç’°å¢ƒè®Šæ•¸ç‚ºçœŸ (ç”± pytest/conftest è¨­å®š)ï¼Œ
# å‰‡è®€å– `.env.local`ï¼›é è¨­æƒ…æ³ (æ­£å¼ç’°å¢ƒ) å‰‡è®€å– `.env`ã€‚

_ENV_FILE: str = ".env.local" if os.getenv("TESTING", "").lower() in {"1", "true", "yes"} else ".env"

class Settings(BaseSettings):
    LOG_LEVEL: str = "INFO"
    CORS_ORIGINS: str = "http://localhost:3000"
    SUPABASE_URL: str = ""
    SUPABASE_KEY: str = ""
    DB_MODE: str = "supabase"
    STT_PROVIDER_DEFAULT: str = Field(
        default="whisper",
        env="DEFAULT_STT_PROVIDER",
    )
    AZURE_OPENAI_API_KEY: str = ""
    AZURE_OPENAI_ENDPOINT: str = ""
    AZURE_OPENAI_API_VERSION: str = "2024-02-01"
    WHISPER_DEPLOYMENT_NAME: str = ""
    WHISPER_LANGUAGE: str = "zh-TW"
    GPT4O_DEPLOYMENT_NAME: str = Field(
        default="gpt4o",        # ä½ åœ¨ Azure å»ºçš„éƒ¨ç½²åç¨±
        env="GPT4O_DEPLOYMENT_NAME"
    )
    GPT4O_TRANSCRIBE_PROMPT: str = Field(
        default="",
        env="GPT4O_TRANSCRIBE_PROMPT"
    )
    # (é¸) é€Ÿç‡é™åˆ¶
    GPT4O_MAX_REQUESTS: int = 60
    GEMINI_ENDPOINT: str = Field("", description="Vertex AI ç«¯é»ï¼Œå¦‚ us-central1-aiplatform.googleapis.com")
    GEMINI_API_KEY: str = Field("", description="GCP æœå‹™å¸³æˆ¶ API Key")
    GEMINI_PROMPT: str = Field("è«‹è¼¸å‡ºé€å­—ç¨¿ï¼š", description="Gemini system prompt")
    GEMINI_MAX_REQUESTS: int = Field(90, description="Gemini æ¯åˆ†é˜æœ€å¤§è«‹æ±‚æ¬¡æ•¸ (RateLimiter ç”¨)")
    R2_ACCOUNT_ID: str = ""
    R2_BUCKET_NAME: str = "studyscriber"
    R2_API_TOKEN: str = ""
    WHISPER_BATCH_SIZE: int = Field(2, alias="whisper_batch_size")
    WHISPER_BATCH_TIMEOUT: int = Field(3, alias="whisper_batch_timeout")
    ENABLE_PERFORMANCE_LOGGING: bool = Field(True, alias="enable_performance_logging")
    DEBUG: bool = Field(False, alias="debug")

    # éŸ³é »åˆ‡ç‰‡é…ç½®
    AUDIO_CHUNK_DURATION_SEC: int = Field(
    default=15,
    env="AUDIO_CHUNK_DURATION_SEC"
)

    # é€å­—ç¨¿é¡¯ç¤ºé…ç½®
    TRANSCRIPT_DISPLAY_INTERVAL_SEC: int = Field(10, description="é€å­—ç¨¿æ™‚é–“æˆ³é¡¯ç¤ºé–“éš”ï¼ˆç§’ï¼‰")

    # REST API ç°¡åŒ–æ¶æ§‹é…ç½®
    SEGMENT_DURATION: int = Field(10, description="åˆ†æ®µéŒ„éŸ³æ™‚é•·ï¼ˆç§’ï¼‰")
    UPLOAD_MAX_SIZE: int = Field(5 * 1024 * 1024, description="æª”æ¡ˆä¸Šå‚³å¤§å°é™åˆ¶ï¼ˆ5MBï¼‰")
    AUDIO_BITRATE: int = Field(128000, description="éŸ³é »ä½å…ƒç‡ï¼ˆ128 kbpsï¼‰")
    MIME_TYPE: str = Field("audio/webm;codecs=opus", description="éŸ³é »æª”æ¡ˆ MIME é¡å‹")

    # ä¸Šå‚³è¨­å®š
    UPLOAD_TIMEOUT_SEC: int = Field(30, description="ä¸Šå‚³è¶…æ™‚æ™‚é–“ï¼ˆç§’ï¼‰")
    MAX_RETRIES: int = Field(3, description="æœ€å¤§é‡è©¦æ¬¡æ•¸")
    RETRY_DELAY_SEC: int = Field(2, description="é‡è©¦å»¶é²æ™‚é–“ï¼ˆç§’ï¼‰")

    # æ»‘å‹•è¦–çª— Rate Limiting é…ç½®
    USE_SLIDING_WINDOW_RATE_LIMIT: bool = Field(False, description="å•Ÿç”¨æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶")
    SLIDING_WINDOW_MAX_REQUESTS: int = Field(3, description="æ»‘å‹•è¦–çª—å…§æœ€å¤§è«‹æ±‚æ•¸")
    SLIDING_WINDOW_SECONDS: int = Field(60, description="æ»‘å‹•è¦–çª—æ™‚é–“ï¼ˆç§’ï¼‰")

    # Whisper æ®µè½éæ¿¾é–€æª»åƒæ•¸ (å¾ç’°å¢ƒè®Šæ•¸è®€å–)
    FILTER_NO_SPEECH: float = Field(
        0.2,
        description="éœéŸ³æª¢æ¸¬é–€æª»ï¼šno_speech_prob è¶…éæ­¤å€¼çš„æ®µè½å°‡è¢«éæ¿¾ï¼ˆ0.0-1.0ï¼‰",
        ge=0.0,
        le=1.0
    )
    FILTER_LOGPROB: float = Field(
        -1.0,
        description="ç½®ä¿¡åº¦éæ¿¾é–€æª»ï¼šavg_logprob ä½æ–¼æ­¤å€¼çš„æ®µè½å°‡è¢«éæ¿¾ï¼ˆè² å€¼ï¼‰"
    )
    FILTER_COMPRESSION: float = Field(
        2.4,
        description="é‡è¤‡å…§å®¹æª¢æ¸¬é–€æª»ï¼šcompression_ratio è¶…éæ­¤å€¼çš„æ®µè½å°‡è¢«éæ¿¾ï¼ˆæ­£å€¼ï¼‰",
        gt=0.0
    )

    # ä¸¦ç™¼è™•ç†å„ªåŒ–é…ç½®ï¼ˆç”¨æˆ¶å»ºè­°åƒæ•¸ï¼‰
    MAX_CONCURRENT_TRANSCRIPTIONS: int = Field(3, description="æœ€å¤§ä¸¦ç™¼è½‰éŒ„æ•¸")
    TRANSCRIPTION_WORKERS_COUNT: int = Field(3, description="è½‰éŒ„Workeræ•¸é‡")
    QUEUE_BACKLOG_THRESHOLD: int = Field(10, description="éšŠåˆ—ç©å£“è­¦å ±é–€æª»")
    QUEUE_MONITOR_INTERVAL: int = Field(5, description="ç›£æ§é–“éš”(ç§’)")
    QUEUE_ALERT_COOLDOWN: int = Field(30, description="è­¦å ±å†·å»æ™‚é–“(ç§’)")

    # éšŠåˆ—ç³»çµ±é…ç½®
    MAX_QUEUE_SIZE: int = Field(100, description="æœ€å¤§éšŠåˆ—å¤§å°")
    QUEUE_TIMEOUT_SECONDS: int = Field(300, description="éšŠåˆ—è¶…æ™‚ï¼ˆç§’ï¼‰")

    # ä½ å¯ä»¥ä¾éœ€æ±‚å†åŠ æ›´å¤šæ¬„ä½

    # éœéŸ³åˆ¤æ–·åƒæ•¸
    SILENCE_NOISE_DB: float = Field(-35.0, description="éœéŸ³åˆ¤æ–· dB é–€æª» (è² å€¼)", env="SILENCE_NOISE_DB")
    SILENCE_DURATION_SEC: float = Field(0.3, description="éœéŸ³åˆ¤æ–·æŒçºŒç§’æ•¸", env="SILENCE_DURATION_SEC")

    model_config = SettingsConfigDict(env_file=_ENV_FILE, env_file_encoding="utf-8", extra="ignore")

settings = Settings()

def get_settings() -> Settings:
    """ç²å–æ‡‰ç”¨ç¨‹å¼è¨­å®šå¯¦ä¾‹"""
    return settings


# END FILE CONTENTS


# File: frontend/hooks/useNetworkRestorer.ts

"use client"
import { useEffect } from 'react'
import { emit } from '@/utils/event-bus'

export function useNetworkRestorer() {
    useEffect(() => {
        const handler = () => emit('network:restored')
        window.addEventListener('online', handler)
        return () => window.removeEventListener('online', handler)
    }, [])
}


# END FILE CONTENTS


# File: frontend/components/ui/hover-card.tsx

"use client"

import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }


# END FILE CONTENTS


# File: docs/auto-retry-upload-spec.md

# è‡ªå‹•è£œå‚³èˆ‡ WebSocket ç·šä¸Šæ¢å¾©åŠŸèƒ½è¦æ ¼

## ç›®æ¨™
ç•¶ä½¿ç”¨è€…è£ç½®åœ¨éŒ„éŸ³éç¨‹ä¸­é›¢ç·šï¼Œç³»çµ±æ‡‰èƒ½åœ¨åµæ¸¬åˆ°é‡æ–°é€£ç·šï¼ˆ`window.online`ï¼‰å¾Œï¼š
1. è‡ªå‹•è£œå‚³é›¢ç·šæœŸé–“å¿«å–æ–¼ IndexedDB çš„ WebM éŸ³æª”åˆ‡ç‰‡ã€‚
2. é‡æ–°å»ºç«‹ Transcript WebSocket é€£ç·šï¼ŒæŒçºŒå³æ™‚é¡¯ç¤ºé€å­—ç¨¿ã€‚
3. å…¨ç¨‹ç„¡éœ€ä½¿ç”¨è€…æ‰‹å‹•ä»‹å…¥ï¼Œç¢ºä¿è³‡æ–™å®Œæ•´ä¸”å³æ™‚é«”é©—ä¸€è‡´ã€‚

---

## åŠŸèƒ½éœ€æ±‚
### FR-1 è‡ªå‹•è£œå‚³
- ç›£è½ `window` çš„ `online` äº‹ä»¶ï¼›è§¸ç™¼æ™‚èª¿ç”¨ `restAudioUploader.retryFailedSegments()`ã€‚
- å‘¼å«å®Œæˆå¾Œï¼Œè‹¥è£œå‚³æˆåŠŸï¼Œæ‡‰æ›´æ–° `UploadStatusIndicator` çš„çµ±è¨ˆï¼ˆuploaded/failed/cachedï¼‰ã€‚
- è‹¥è£œå‚³éç¨‹å†æ¬¡å¤±æ•—ï¼Œéœ€ä¿ç•™æ–¼ IndexedDBï¼Œä¸¦ä»¥ toast æˆ– UI badge æç¤ºä½¿ç”¨è€…ã€‚

### FR-2 é‡æ–°é€£ç·š Transcript WebSocket
- åœ¨ `online` äº‹ä»¶åŒä¸€æµç¨‹ä¸­ï¼š
  - æª¢æŸ¥ç›®å‰ SessionIdï¼ˆå¯ç”± `SimpleRecordingService` æˆ– AppState å–å¾—ï¼‰ã€‚
  - è‹¥ `transcriptManager.isConnected(sessionId)` ç‚º `false`ï¼Œå‘¼å« `transcriptManager.connect(sessionId)` é‡æ–°é€£ç·šã€‚
- é‡æ–°é€£ç·šæ‡‰é‡è¨­ `TranscriptManager` çš„é‡é€£è¨ˆæ•¸ï¼Œé¿å…å…ˆå‰é”ä¸Šé™å¾Œä¸å†é‡è©¦ã€‚

### FR-3 èˆ‡æ—¢æœ‰æ©Ÿåˆ¶å”åŒ
- ä¿ç•™ `TranscriptManager` ç¾æœ‰çš„æŒ‡æ•¸é€€é¿é‡é€£é‚è¼¯ï¼›`online` äº‹ä»¶åƒ…ä½œã€Œå¼·åˆ¶ç«‹å³é‡é€£ã€ã€‚
- ä¿ç•™ `RestAudioUploader` æ—¢æœ‰çš„è‡ªå‹•é‡è©¦ä¸‰æ¬¡ + æš«å­˜æµç¨‹ã€‚

### FR-4 UX èˆ‡å¯è¦–åŒ–
- `UploadStatusIndicator` åœ¨è‡ªå‹•è£œå‚³æœŸé–“é¡¯ç¤º loading spinnerï¼ˆreuse `retrying` stateï¼‰ã€‚
- æˆåŠŸå¾Œ toastï¼š`æš«å­˜æ®µè½å·²å…¨éƒ¨ä¸Šå‚³å®Œæˆ`ã€‚
- è‹¥ä»æœ‰æœªæˆåŠŸé …ç›®ï¼Œtoastï¼š`ä»æœ‰ {count} æ®µè½å¾…ä¸Šå‚³ï¼Œå°‡æ–¼ç·šä¸Šæ™‚è‡ªå‹•é‡è©¦`ã€‚

---

## éåŠŸèƒ½éœ€æ±‚
| é¡åˆ¥       | éœ€æ±‚                                                        |
| ---------- | ----------------------------------------------------------- |
| **å¯é æ€§** | ä¸Šç·šå¾Œ 2 ç§’å…§å®Œæˆç¬¬ä¸€æ³¢è£œå‚³èˆ‡é‡é€£ï¼›è£œå‚³å¤±æ•—ä¸å½±éŸ¿å¾ŒçºŒé‡è©¦ã€‚ |
| **æ•ˆèƒ½**   | å–®æ¬¡è£œå‚³æ‰¹æ¬¡æœ€å¤š 20 å€‹åˆ‡ç‰‡ï¼Œè¶…éå‰‡åˆ†æ‰¹ï¼ˆé¿å…é˜»å¡ UIï¼‰ã€‚     |
| **ç¶­è­·æ€§** | ç›¸é—œé‚è¼¯é›†ä¸­æ–¼å–®ä¸€ Hook / Serviceï¼Œä¸¦å…·å‚™å–®å…ƒæ¸¬è©¦è¦†è“‹ã€‚     |

---

## å¾…è¾¦äº‹é …ï¼ˆTask Breakdownï¼‰

| #    | æè¿°                                                                                                                                         | é¡å‹       | ä¾è³´ |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------- | ---------- | ---- |
| T-01 | å»ºç«‹ `useNetworkRestorer` Hookï¼šç›£è½ `online` äº‹ä»¶ä¸¦ç™¼å¸ƒ custom event `network:restored`                                                     | Structural | â€”    |
| T-02 | åœ¨ `UploadStatusIndicator` ä¸­è¨»å†Š `network:restored`ï¼Œå‘¼å« `restAudioUploader.retryFailedSegments()` ä¸¦è™•ç† UI state                         | Behavioral | T-01 |
| T-03 | åœ¨ `SimpleRecordingService`ï¼ˆæˆ– TranscriptServiceï¼‰ä¸­è¨»å†Š `network:restored`ï¼Œæª¢æŸ¥ `sessionId` ä¸¦å‘¼å« `transcriptManager.connect(sessionId)` | Behavioral | T-01 |
| T-04 | é‡æ§‹ `TranscriptManager`ï¼šæä¾› `resetReconnectAttempts(sessionId)` å…¬é–‹æ–¹æ³•                                                                  | Structural | â€”    |
| T-05 | å–®å…ƒæ¸¬è©¦ï¼š                                                                                                                                   |
  - æ¨¡æ“¬ offline â†’ online æµç¨‹ï¼Œé©—è­‰ `retryFailedSegments`ã€`connect` è¢«å‘¼å«
  - é©—è­‰ UI æŒ‡ç¤ºæ›´æ–° | Test | T-02, T-03 |
| T-06 | E2E æ¸¬è©¦ï¼ˆPlaywrightï¼‰ï¼šæ¨¡æ“¬æ–·ç¶² 30s å¾Œæ¢å¾©ï¼Œç¢ºèªé€å­—ç¨¿å®Œæ•´ & ç„¡ç¼ºç‰‡ | Test | T-02, T-03 |
| T-07 | æ–‡ä»¶æ›´æ–°ï¼šREADMEã€SPEC.mdã€é–‹ç™¼è€…æŒ‡å—åŠ å…¥é›¢ç·šè¡Œç‚ºèªªæ˜ | Doc | T-02â€“T-06 |

> **TDD æç¤º**ï¼šæ¯å€‹ Behavioral Task å…ˆå¯«å¤±æ•—æ¸¬è©¦ï¼Œå†å¯¦ä½œï¼›Structural Task ç¢ºèªç¾æœ‰æ¸¬è©¦ä»å…¨éƒ¨é€šéã€‚

---

## é¢¨éšªèˆ‡å‚™è¨»
- **è¡Œå‹•è£ç½®çœé›»ç­–ç•¥** å¯èƒ½å»¶é² `online` äº‹ä»¶è§¸ç™¼ï¼›éœ€åœ¨ resume App æ™‚è£œå……æª¢æŸ¥ IndexedDBã€‚ 
- **IndexedDB å®¹é‡**ï¼šå¤šæ¬¡é•·æ™‚é–“é›¢ç·šå¯èƒ½ç´¯ç©å¤§é‡åˆ‡ç‰‡ï¼Œéœ€è€ƒæ…®æ¸…ç†ç­–ç•¥ï¼ˆæœªç´å…¥æœ¬æ¬¡å·¥ä½œï¼‰ã€‚

---

*æœ€å¾Œæ›´æ–°ï¼š{{DATE_NOW}}* 


# END FILE CONTENTS


# File: frontend/components/waiting-state.tsx

"use client"

import { Loader2 } from "lucide-react"

export function WaitingState() {
  return (
    <div className="h-full flex flex-col items-center justify-center p-6 space-y-4">
      <Loader2 className="w-8 h-8 animate-spin text-muted-foreground" />
      <div className="text-center">
        <div className="text-lg font-medium text-foreground">Transcription in progress,</div>
        <div className="text-lg font-medium text-foreground">please wait.</div>
      </div>
    </div>
  )
}


# END FILE CONTENTS


# File: frontend/components/ui/ExportButton.tsx

"use client"

import { useState } from 'react'
import { downloadZip } from '@/utils/export'
import { sessionAPI, notesAPI } from '@/lib/api'
import { toast } from '@/hooks/use-toast'
import { useSession } from '@/hooks/use-session'

interface Props {
    sid: string
    editorContent: string
}

export default function ExportButton({ sid, editorContent }: Props) {
    const [busy, setBusy] = useState(false)
    const { waitUntilCompleted } = useSession()

    const handleExport = async () => {
        if (busy) return
        setBusy(true)

        try {
            // 1ï¸âƒ£ ç­‰å¾… completed
            const ok = await waitUntilCompleted(sid, 30_000)
            if (!ok) {
                toast({ title: 'å¾Œç«¯ä»åœ¨è™•ç†é€å­—ç¨¿ï¼Œè«‹ç¨å€™å†è©¦' })
                return
            }

            // 2ï¸âƒ£ å„²å­˜ç­†è¨˜
            await notesAPI.updateNote(sid, { content: editorContent })

            // 3ï¸âƒ£ ä¸‹è¼‰ ZIP
            await downloadZip(sid)
        } catch (err) {
            console.error(err)
            toast({ title: 'åŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦', variant: 'destructive' })
        } finally {
            setBusy(false)
        }
    }

    return (
        <button
            className="btn btn-primary flex items-center gap-2"
            disabled={busy}
            onClick={handleExport}
        >
            {busy && (
                <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24">
                    <circle
                        className="opacity-25"
                        cx="12" cy="12" r="10"
                        stroke="currentColor"
                        strokeWidth="4"
                        fill="none"
                    />
                    <path
                        className="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8v4l3-3-3-3v4A8 8 8 0 104 12z"
                    />
                </svg>
            )}
            Export&nbsp;ZIP
        </button>
    )
}


# END FILE CONTENTS


# File: .cursor/rules/playwright-e2e-testing.mdc

---
alwaysApply: false
---

<!-- Source: https://github.com/PatrickJS/awesome-cursorrules/blob/main/rules/playwright-e2e-testing-cursorrules-prompt-file/.cursorrules -->

# Auto-detect TypeScript Usage

Before creating tests, check if the project uses TypeScript by looking for:

- tsconfig.json file
- .ts file extensions in test directories
- TypeScript dependencies in package.json
  Adjust file extensions (.ts/.js) and syntax based on this detection.

# End-to-End UI Testing Focus

Generate tests that focus on critical user flows (e.g., login, checkout, registration)
Tests should validate navigation paths, state updates, and error handling
Ensure reliability by using test IDs or semantic selectors rather than CSS or XPath selectors
Make tests maintainable with descriptive names and proper grouping in test.describe blocks
Use Playwright's page.route for API mocking to create isolated, deterministic tests

# Best Practices

**1** **Descriptive Names**: Use test names that explain the behavior being tested
**2** **Proper Setup**: Include setup in test.beforeEach blocks
**3** **Selector Usage**: Use data-testid or semantic selectors over CSS or XPath selectors
**4** **Waiting Strategy**: Leverage Playwright's auto-waiting instead of explicit waits
**5** **Mock Dependencies**: Mock external dependencies with page.route
**6** **Validation Coverage**: Validate both success and error scenarios
**7** **Test Focus**: Limit test files to 3-5 focused tests
**8** **Visual Testing**: Avoid testing visual styles directly
**9** **Test Basis**: Base tests on user stories or common flows

# Input/Output Expectations

**Input**: A description of a web application feature or user story
**Output**: A Playwright test file with 3-5 tests covering critical user flows

# Example End-to-End Test

When testing a login page, implement the following pattern:

```js
import { test, expect } from '@playwright/test';

test.describe('Login Page', () => {
  test.beforeEach(async ({ page }) => {
    await page.route('/api/login', (route) => {
      const body = route.request().postDataJSON();
      if (body.username === 'validUser' && body.password === 'validPass') {
        route.fulfill({
          status: 200,
          body: JSON.stringify({ message: 'Login successful' }),
        });
      } else {
        route.fulfill({
          status: 401,
          body: JSON.stringify({ error: 'Invalid credentials' }),
        });
      }
    });
    await page.goto('/login');
  });

  test('should allow user to log in with valid credentials', async ({
    page,
  }) => {
    await page.locator('[data-testid="username"]').fill('validUser');
    await page.locator('[data-testid="password"]').fill('validPass');
    await page.locator('[data-testid="submit"]').click();
    await expect(page.locator('[data-testid="welcome-message"]')).toBeVisible();
    await expect(page.locator('[data-testid="welcome-message"]')).toHaveText(
      /Welcome, validUser/
    );
  });

  test('should show an error message for invalid credentials', async ({
    page,
  }) => {
    await page.locator('[data-testid="username"]').fill('invalidUser');
    await page.locator('[data-testid="password"]').fill('wrongPass');
    await page.locator('[data-testid="submit"]').click();
    await expect(page.locator('[data-testid="error-message"]')).toBeVisible();
    await expect(page.locator('[data-testid="error-message"]')).toHaveText(
      'Invalid credentials'
    );
  });
});
```


# END FILE CONTENTS


# File: frontend/components/ui/dialog.tsx

"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}


# END FILE CONTENTS


# File: frontend/components/ui/context-menu.tsx

"use client"

import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}


# END FILE CONTENTS


# File: frontend/lib/config.ts

"use client"

/**
 * å‰ç«¯é…ç½®ç®¡ç†
 * é›†ä¸­ç®¡ç†æ‰€æœ‰å¯é…ç½®çš„è¨­å®šé …ç›®
 */

/**
 * éŸ³è¨ŠéŒ„è£½é…ç½®
 */
export interface AudioConfig {
  chunkInterval: number // éŸ³è¨Šåˆ‡ç‰‡é–“éš”ï¼ˆæ¯«ç§’ï¼‰
  mimeType: string // éŸ³è¨Šæ ¼å¼
  audioBitsPerSecond: number // éŸ³è¨Šä½å…ƒç‡
}

/**
 * æ‡‰ç”¨ç¨‹å¼é…ç½®
 */
export interface AppConfig {
  apiUrl: string
  wsUrl: string
  audio: AudioConfig
  isDevelopment: boolean
}

/**
 * å¾ç’°å¢ƒè®Šæ•¸ç²å–éŸ³è¨Šåˆ‡ç‰‡é–“éš”
 * æ”¯æ´ç§’æ•¸å’Œæ¯«ç§’æ•¸å…©ç¨®æ ¼å¼
 */
function getAudioChunkInterval(): number {
  // å„ªå…ˆä½¿ç”¨æ¯«ç§’æ ¼å¼çš„ç’°å¢ƒè®Šæ•¸
  const intervalMs = process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_MS
  if (intervalMs) {
    const parsed = parseInt(intervalMs, 10)
    if (!isNaN(parsed) && parsed > 0) {
      return parsed
    }
  }

  // å…¶æ¬¡ä½¿ç”¨ç§’æ•¸æ ¼å¼çš„ç’°å¢ƒè®Šæ•¸
  const intervalSec = process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_SEC
  if (intervalSec) {
    const parsed = parseInt(intervalSec, 10)
    if (!isNaN(parsed) && parsed > 0) {
      return parsed * 1000 // è½‰æ›ç‚ºæ¯«ç§’
    }
  }

  // é è¨­å€¼ï¼š10ç§’
  return 10 * 1000
}

/**
 * æ‡‰ç”¨ç¨‹å¼é…ç½®å¯¦ä¾‹
 */
export const appConfig: AppConfig = {
  apiUrl: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000',
  wsUrl: process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000',
  isDevelopment: process.env.NODE_ENV === 'development',
  audio: {
    chunkInterval: getAudioChunkInterval(),
    mimeType: 'audio/webm;codecs=opus',
    audioBitsPerSecond: 64000  // 64 kbps for 10s chunks
  }
}

/**
 * è¼”åŠ©å‡½æ•¸ï¼šç²å–éŸ³è¨Šåˆ‡ç‰‡é–“éš”ï¼ˆæ¯«ç§’ï¼‰
 */
export function getAudioChunkIntervalMs(): number {
  return appConfig.audio.chunkInterval
}

/**
 * è¼”åŠ©å‡½æ•¸ï¼šç²å–éŸ³è¨Šåˆ‡ç‰‡é–“éš”ï¼ˆç§’ï¼‰
 */
export function getAudioChunkIntervalSec(): number {
  return Math.round(appConfig.audio.chunkInterval / 1000)
}

/**
 * è¼”åŠ©å‡½æ•¸ï¼šæ ¼å¼åŒ–éŸ³è¨Šé…ç½®è³‡è¨Š
 */
export function getAudioConfigInfo(): string {
  const seconds = getAudioChunkIntervalSec()
  return `${seconds}ç§’åˆ‡ç‰‡ (${appConfig.audio.chunkInterval}ms)`
}

/**
 * ç²å–æ‡‰ç”¨ç¨‹å¼é…ç½®
 */
export function getAppConfig(): AppConfig {
  return appConfig
}

/**
 * é–‹ç™¼æ¨¡å¼è¨ºæ–·è³‡è¨Š
 */
export function getConfigInfo(): string {
  const config = getAppConfig()
  return `Config: API=${config.apiUrl}, WS=${config.wsUrl}, Dev=${config.isDevelopment}`
}

/**
 * é–‹ç™¼æ¨¡å¼è¨ºæ–·ï¼šé¡¯ç¤ºç•¶å‰é…ç½®
 */
if (appConfig.isDevelopment && typeof window !== 'undefined') {
  console.log('ğŸ”§ [Config] éŸ³è¨Šé…ç½®:', {
    chunkInterval: appConfig.audio.chunkInterval,
    chunkIntervalSec: getAudioChunkIntervalSec(),
    mimeType: appConfig.audio.mimeType,
    source: process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_MS ? 'MS' :
      process.env.NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_SEC ? 'SEC' : 'DEFAULT'
  })
}


# END FILE CONTENTS


# File: frontend/components/ui/menubar.tsx

"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const MenubarMenu = MenubarPrimitive.Menu

const MenubarGroup = MenubarPrimitive.Group

const MenubarPortal = MenubarPrimitive.Portal

const MenubarSub = MenubarPrimitive.Sub

const MenubarRadioGroup = MenubarPrimitive.RadioGroup

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}


# END FILE CONTENTS


# File: frontend/lib/app-store-zustand.ts

"use client"

import { create } from 'zustand'
import { serviceContainer, SERVICE_KEYS } from './services'
import type { ISessionService } from './services/interfaces'
import { AppState, SessionStatus, SessionType, TranscriptEntry } from '../types/app-state'
import { TranscriptManager } from './transcript-manager'

/**
 * App ç‹€æ…‹ä»‹é¢
 */
import { STTProvider } from './api'

interface AppStoreState {
  // æ‡‰ç”¨ç‹€æ…‹
  appState: AppState
  isLoading: boolean
  error: string | null

  // æœƒè©±ç‹€æ…‹
  session: {
    id: string
    status: SessionStatus
    type: SessionType
  } | null

  // éŒ„éŸ³ç‹€æ…‹
  isRecording: boolean
  recordingTime: number
  recordingStartTime: number | null

  // å…§éƒ¨è¨ˆæ™‚å™¨
  timerId: NodeJS.Timeout | null

  // é€å­—ç¨¿ç‹€æ…‹
  transcriptEntries: TranscriptEntry[]

  // ç·¨è¼¯å™¨ç‹€æ…‹
  editorContent: string

  // STT Provider ç‹€æ…‹
  sttProvider: STTProvider
}

/**
 * App æ“ä½œä»‹é¢
 */
interface AppStoreActions {
  // æ ¸å¿ƒæ¥­å‹™æ“ä½œ
  startRecording: (title?: string) => Promise<void>
  stopRecording: () => Promise<void>

  // ç‹€æ…‹ç®¡ç†
  setState: (appState: AppState) => void
  setSession: (session: AppStoreState['session']) => void
  setRecording: (isRecording: boolean) => void
  setError: (error: string | null) => void
  clearError: () => void

  // ç·¨è¼¯å™¨æ“ä½œ
  updateEditorContent: (content: string) => void
  addTranscriptEntry: (entry: TranscriptEntry) => void

  // è¨ˆæ™‚å™¨æ“ä½œ
  startTimer: () => void
  stopTimer: () => void
  cleanup: () => void

  // éŒ„éŸ³æ™‚é–“æ“ä½œ
  setRecordingStart: (timestamp: number) => void

  // ç‹€æ…‹é‡ç½®
  resetState: () => void

  // STT Provider æ“ä½œ
  setSttProvider: (provider: STTProvider) => void
}

/**
 * å®Œæ•´çš„ Store é¡å‹
 */
type AppStore = AppStoreState & AppStoreActions

/**
 * åŸºæ–¼ Zustand çš„ App Store
 *
 * å¯¦ç¾ç”¨æˆ¶è¦æ±‚çš„æœƒè©±è¡çªè™•ç†ç­–ç•¥ï¼š
 * 1. startRecording æ™‚å„ªå…ˆèª¿ç”¨ ensureRecordingSession
 * 2. å„ªé›…è™•ç† 409 è¡çªï¼Œè‡ªå‹•è¼‰å…¥ç¾æœ‰æœƒè©±
 * 3. æä¾›æ¸…æ™°çš„ç‹€æ…‹ç®¡ç†å’ŒéŒ¯èª¤è™•ç†
 */
export const useAppStore = create<AppStore>((set, get) => ({
  // === åˆå§‹ç‹€æ…‹ ===
  appState: 'default' as AppState,
  isLoading: false,
  error: null,
  session: null,
  isRecording: false,
  recordingTime: 0,
  recordingStartTime: null,
  timerId: null,
  transcriptEntries: [],
  editorContent: '',
  sttProvider: 'gpt4o' as STTProvider,

  // === æ ¸å¿ƒæ¥­å‹™æ“ä½œ ===

  /**
   * é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨é›™ WebSocket å®Œæ•´éŒ„éŸ³æµç¨‹
   */
  startRecording: async (title?: string) => {
    console.log('ğŸ¤ [AppStore] é–‹å§‹é›™ WebSocket éŒ„éŸ³æµç¨‹')

    // 1. è¨­ç½®ç­‰å¾…ç‹€æ…‹
    set({
      appState: 'recording_waiting',
      isLoading: true,
      error: null
    })

    try {
      // 2. ç²å–ç•¶å‰çš„éŒ„éŸ³é–‹å§‹æ™‚é–“ï¼ˆç”± onstart äº‹ä»¶è¨­ç½®ï¼‰
      const currentState = get()
      const startTs = currentState.recordingStartTime

      const startTsDate = typeof startTs === 'number' ? new Date(startTs as number).toISOString() : 'N/A'
      const hasStartTime = typeof startTs === 'number'

      console.log('ğŸ• [AppStore] éŒ„éŸ³é–‹å§‹æ™‚é–“:', {
        startTs,
        startTsDate,
        hasStartTime
      })

      // 3. ç²å– RecordingFlowService
      const { RecordingFlowService } = await import('./services/recording-flow-service')
      const recordingFlowService = new RecordingFlowService()
      await recordingFlowService.initialize()

      // 4. å•Ÿå‹•å®Œæ•´éŒ„éŸ³æµç¨‹ï¼ˆåŒ…å«é›™ WebSocketï¼‰ï¼Œå‚³éé–‹å§‹æ™‚é–“æˆ³å’Œ STT Provider
      console.log('ğŸ” [AppStore] å•Ÿå‹•å®Œæ•´éŒ„éŸ³æµç¨‹...')
      const sessionResponse = await recordingFlowService.startRecordingFlow(
        title || `éŒ„éŸ³ç­†è¨˜ ${new Date().toLocaleString()}`,
        undefined, // content
        startTs,   // å‚³ééŒ„éŸ³é–‹å§‹æ™‚é–“æˆ³
        currentState.sttProvider // å‚³é STT Provider
      )

      console.log('âœ… [AppStore] é›™ WebSocket éŒ„éŸ³æµç¨‹å•Ÿå‹•æˆåŠŸ:', {
        sessionId: sessionResponse.id,
        withStartTs: !!startTs
      })

      // 5. æ›´æ–°ç‹€æ…‹ï¼Œä¿æŒç­‰å¾…é€å­—ç¨¿
      set({
        appState: 'recording_waiting',
        session: {
          id: sessionResponse.id,
          status: sessionResponse.status as SessionStatus,
          type: sessionResponse.type as SessionType
        },
        isRecording: true,
        isLoading: false
      })

      // 6. ä¸éœ€è¦å†æ¬¡å•Ÿå‹•è¨ˆæ™‚å™¨ï¼Œå› ç‚ºå·²ç¶“åœ¨ setRecordingStart ä¸­å•Ÿå‹•äº†
      console.log('ğŸ• [AppStore] è¨ˆæ™‚å™¨å·²åœ¨ onstart äº‹ä»¶ä¸­å•Ÿå‹•ï¼ŒéŒ„éŸ³æ™‚é–“:', currentState.recordingTime)

        // 7. å„²å­˜æœå‹™å¯¦ä¾‹ä¾›åœæ­¢æ™‚ä½¿ç”¨
        ; (globalThis as any).currentRecordingFlowService = recordingFlowService

      console.log('ğŸ¯ [AppStore] é›™ WebSocket éŒ„éŸ³æ¨¡å¼å•Ÿå‹•æˆåŠŸ')

    } catch (error) {
      // 8. éŒ¯èª¤è™•ç†
      const errorMessage = error instanceof Error ? error.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      console.error('âŒ [AppStore] ç„¡æ³•é–‹å§‹éŒ„éŸ³:', error)

      // æ¸…ç†è¨ˆæ™‚å™¨ï¼ˆå¦‚æœå·²å•Ÿå‹•ï¼‰
      get().stopTimer()

      set({
        appState: 'default',
        error: errorMessage,
        isLoading: false,
        session: null,
        isRecording: false
      })

      console.error('ğŸš¨ [AppStore] é›™ WebSocket éŒ„éŸ³å•Ÿå‹•å¤±æ•—ï¼Œè«‹é‡è©¦')
    }
  },

  /**
   * åœæ­¢éŒ„éŸ³ - åœæ­¢é›™ WebSocket éŒ„éŸ³æµç¨‹
   */
  stopRecording: async () => {
    console.log('ğŸ›‘ [AppStore] åœæ­¢é›™ WebSocket éŒ„éŸ³æµç¨‹')

    // åœæ­¢è¨ˆæ™‚å™¨
    get().stopTimer()

    set({
      appState: 'processing',
      isLoading: true
    })

    try {
      // ç²å–ä¸¦èª¿ç”¨ RecordingFlowService
      const recordingFlowService = (globalThis as any).currentRecordingFlowService

      if (recordingFlowService) {
        await recordingFlowService.stopRecordingFlow()
        await recordingFlowService.cleanup()

          // æ¸…ç†å…¨å±€å¼•ç”¨
          ; (globalThis as any).currentRecordingFlowService = null

        console.log('âœ… [AppStore] RecordingFlowService åœæ­¢æˆåŠŸ')
      } else {
        console.warn('âš ï¸ [AppStore] æ²’æœ‰æ‰¾åˆ°æ´»èºçš„ RecordingFlowService')
      }

      set({
        appState: 'finished',
        isRecording: false,
        isLoading: false
      })

      console.log('âœ… [AppStore] é›™ WebSocket éŒ„éŸ³åœæ­¢æˆåŠŸ')

    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      console.error('âŒ [AppStore] åœæ­¢éŒ„éŸ³å¤±æ•—:', error)

      set({
        error: errorMessage,
        isLoading: false
      })
    }
  },

  // === ç‹€æ…‹ç®¡ç†æ“ä½œ ===

  setState: (appState: AppState) => {
    set({ appState })
  },

  setSession: (session: AppStoreState['session']) => {
    set({ session })
  },

  setRecording: (isRecording: boolean) => {
    set({ isRecording })
  },

  setError: (error: string | null) => {
    set({ error })
  },

  clearError: () => {
    set({ error: null })
  },

  // === STT Provider æ“ä½œ ===

  setSttProvider: (provider: STTProvider) => {
    set({ sttProvider: provider })
    console.log('ğŸ”§ [AppStore] STT Provider å·²æ›´æ–°:', provider)
  },

  // === ç·¨è¼¯å™¨æ“ä½œ ===

  updateEditorContent: (content: string) => {
    set({ editorContent: content })
  },

  addTranscriptEntry: (entry: TranscriptEntry) => {
    console.log('[S] add entry', entry.text.slice(0, 20))

    set((state) => {
      // å°‡æ–°æ¢ç›®åŠ å…¥ä¸¦æŒ‰æ•¸å€¼æ™‚é–“æ’åº
      const timeToSeconds = (t: string): number => {
        const parts = t.split(':').map(Number)
        if (parts.length === 3) {
          const [hh, mm, ss] = parts
          return hh * 3600 + mm * 60 + ss
        } else if (parts.length === 2) {
          const [mm, ss] = parts
          return mm * 60 + ss
        }
        return 0
      }

      const getStart = (e: TranscriptEntry): number => e.startTime ?? timeToSeconds(e.time)

      const newEntries = [...state.transcriptEntries, entry].sort(
        (a, b) => getStart(a) - getStart(b)
      )
      return {
        transcriptEntries: newEntries,
        // ğŸ¯ æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿æ™‚ï¼Œå¾ recording_waiting â†’ recording_active
        appState: state.appState === 'recording_waiting' ? 'recording_active' : state.appState
      }
    })
  },

  setRecordingTime: (time: number) => {
    set({ recordingTime: time })
  },

  // è¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“ä¸¦å•Ÿå‹•åŸºæ–¼å¯¦éš›æ™‚é–“çš„è¨ˆæ™‚å™¨
  setRecordingStart: (timestamp: number) => {
    console.log('ğŸš€ [AppStore] è¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“:', new Date(timestamp).toISOString())
    set({ recordingStartTime: timestamp, recordingTime: 0 })

    // å•Ÿå‹•åŸºæ–¼å¯¦éš›æ™‚é–“çš„è¨ˆæ™‚å™¨
    get().startTimer()
  },

  // è¨ˆæ™‚é‚è¼¯ - ä¿®æ”¹ç‚ºåŸºæ–¼å¯¦éš›æ™‚é–“æˆ³çš„è¨ˆç®—
  startTimer: () => {
    const currentState = get()
    if (currentState.timerId) return // é˜²æ­¢é‡è¤‡å•Ÿå‹•

    const timerId = setInterval(() => {
      const state = get()
      if (state.recordingStartTime) {
        const elapsed = Math.floor((Date.now() - state.recordingStartTime) / 1000)
        set({ recordingTime: elapsed })
      } else {
        // Fallback åˆ°èˆŠé‚è¼¯
        set(prevState => ({ recordingTime: prevState.recordingTime + 1 }))
      }
    }, 1000)

    set({ timerId })
    console.log('ğŸ• [AppStore] éŒ„éŸ³è¨ˆæ™‚å™¨å·²å•Ÿå‹•')
  },

  stopTimer: () => {
    const currentState = get()
    if (currentState.timerId) {
      clearInterval(currentState.timerId)
      set({ timerId: null, recordingTime: 0, recordingStartTime: null })
      console.log('â¹ï¸ [AppStore] éŒ„éŸ³è¨ˆæ™‚å™¨å·²åœæ­¢ä¸¦é‡ç½®')
    }
  },

  cleanup: () => {
    const currentState = get()
    if (currentState.timerId) {
      clearInterval(currentState.timerId)
      set({ timerId: null })
      console.log('ğŸ§¹ [AppStore] è¨ˆæ™‚å™¨å·²æ¸…ç†')
    }
  },

  // === ç‹€æ…‹é‡ç½® ===

  resetState: () => {
    console.log('ğŸ”„ [AppStore] é‡ç½®ç‹€æ…‹')

    // æ¸…ç†è¨ˆæ™‚å™¨
    const currentState = get()
    if (currentState.timerId) {
      clearInterval(currentState.timerId)
    }

    set({
      appState: 'default',
      isLoading: false,
      error: null,
      session: null,
      isRecording: false,
      recordingTime: 0,
      recordingStartTime: null,
      timerId: null,
      transcriptEntries: [],
      editorContent: '',
      sttProvider: 'gpt4o' as STTProvider,
    })
  }
}))

/**
 * ä¾¿åˆ©çš„ Hookï¼šåªç²å–ç‹€æ…‹
 */
export const useAppState = () => useAppStore((state: AppStore) => ({
  appState: state.appState,
  isLoading: state.isLoading,
  error: state.error,
  session: state.session,
  isRecording: state.isRecording,
  recordingTime: state.recordingTime,
  transcriptEntries: state.transcriptEntries,
  editorContent: state.editorContent
}))

/**
 * ä¾¿åˆ©çš„ Hookï¼šåªç²å–æ“ä½œ
 */
export const useAppActions = () => useAppStore((state: AppStore) => ({
  startRecording: state.startRecording,
  stopRecording: state.stopRecording,
  setState: state.setState,
  setSession: state.setSession,
  setRecording: state.setRecording,
  setError: state.setError,
  clearError: state.clearError,
  updateEditorContent: state.updateEditorContent,
  addTranscriptEntry: state.addTranscriptEntry,
  setRecordingStart: state.setRecordingStart,
  resetState: state.resetState
}))

export default useAppStore


# END FILE CONTENTS


# File: app/lib/rate_limit.py

# app/lib/rate_limit.py
import asyncio
import logging
from app.core.config import get_settings

logger = logging.getLogger(__name__)

class RateLimitHandler:
    def __init__(self):
        self._delay = 0
        logger.info("ğŸš¦ [RateLimitHandler] é »ç‡é™åˆ¶è™•ç†å™¨å·²åˆå§‹åŒ–")

    async def wait(self):
        if self._delay:
            logger.info(f"â³ [RateLimitHandler] ç­‰å¾… {self._delay}s é¿å…é »ç‡é™åˆ¶")
            await asyncio.sleep(self._delay)

    def backoff(self):
        previous_delay = self._delay
        self._delay = min((self._delay or 5) * 2, 60)
        logger.warning(f"ğŸ“ˆ [RateLimitHandler] é€€é¿å»¶é²ï¼š{previous_delay}s â†’ {self._delay}s")

    def reset(self):
        if self._delay > 0:
            logger.info(f"âœ… [RateLimitHandler] é‡ç½®å»¶é²ï¼š{self._delay}s â†’ 0s")
            self._delay = 0

class SlidingWindowRateLimiter:
    def __init__(self, max_requests: int = 3, window_seconds: int = 60):
        self.max_requests = max_requests
        self.window_seconds = window_seconds
        self.semaphore = asyncio.Semaphore(max_requests)
        self.active_requests = 0
        self.total_acquired = 0
        self.total_released = 0
        self._lock = asyncio.Lock()
        logger.info(f"ğŸªŸ [SlidingWindow] åˆå§‹åŒ–å®Œæˆï¼š{max_requests} requests/{window_seconds}s")

    async def acquire(self):
        await self.semaphore.acquire()
        async with self._lock:
            self.active_requests += 1
            self.total_acquired += 1
        loop = asyncio.get_event_loop()
        loop.call_later(self.window_seconds, self._release_permit)

    def _release_permit(self):
        self.semaphore.release()
        self.active_requests = max(0, self.active_requests - 1)
        self.total_released += 1

    async def wait(self):
        await self.acquire()

    def get_stats(self):
        return {
            'type': 'sliding_window',
            'max_requests': self.max_requests,
            'window_seconds': self.window_seconds,
            'active_requests': self.active_requests,
            'available_permits': self.max_requests - self.active_requests,
            'total_acquired': self.total_acquired,
            'total_released': self.total_released,
            'utilization_percent': (self.active_requests / self.max_requests) * 100 if self.max_requests > 0 else 0,
            'is_at_capacity': self.active_requests >= self.max_requests
        }

    def reset(self):
        self.total_acquired = 0
        self.total_released = 0

    def backoff(self):
        logger.warning(f"ğŸš¦ [SlidingWindow] é‡åˆ° 429 éŒ¯èª¤ï¼Œæ»‘å‹•è¦–çª—å°‡è‡ªå‹•è™•ç†é€€é¿")

    @property
    def _delay(self):
        if self.active_requests >= self.max_requests:
            return max(1, self.window_seconds // 4)
        return 0


def get_rate_limit():
    s = get_settings()
    if getattr(s, "USE_SLIDING_WINDOW_RATE_LIMIT", False):
        if not hasattr(get_rate_limit, "_sliding_window"):
            get_rate_limit._sliding_window = SlidingWindowRateLimiter(
                max_requests=getattr(s, "SLIDING_WINDOW_MAX_REQUESTS", 3),
                window_seconds=getattr(s, "SLIDING_WINDOW_SECONDS", 60)
            )
        return get_rate_limit._sliding_window
    else:
        if not hasattr(get_rate_limit, "_handler"):
            get_rate_limit._handler = RateLimitHandler()
        return get_rate_limit._handler


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/recording-flow-service.test.ts

/**
 * RecordingFlowService æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦
 *
 * æ¸¬è©¦ RecordingFlowService çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç¢ºä¿ï¼š
 * 1. startRecordingFlow æˆåŠŸæ™‚è¿”å› SessionResponse
 * 2. startRecordingFlow å¤±æ•—æ™‚æ‹‹å‡ºéŒ¯èª¤
 * 3. ç‹€æ…‹ç®¡ç†æ­£ç¢º
 */

import { describe, test, expect, vi, beforeEach, afterEach } from 'vitest'
import { RecordingFlowService } from '../recording-flow-service'
import { serviceContainer } from '../service-container'
import { SERVICE_KEYS } from '../interfaces'
import type { ISessionService, IRecordingService, ITranscriptService } from '../interfaces'
import type { SessionResponse } from '../../api'

// Mock æœå‹™å®¹å™¨
vi.mock('../service-container', () => ({
    serviceContainer: {
        resolve: vi.fn()
    }
}))

// 1. ä¿®æ”¹ RecordingFlowService è®“ setAppState å¯æ³¨å…¥
class TestableRecordingFlowService extends RecordingFlowService {
    constructor(setAppState: (state: string) => void) {
        super()
        // @ts-ignore
        this.setAppState = setAppState
    }
}

describe('RecordingFlowService - æ ¸å¿ƒåŠŸèƒ½', () => {
    let recordingFlowService: RecordingFlowService
    let mockSessionService: any
    let mockRecordingService: any
    let mockTranscriptService: any
    let mockServiceContainer: any
    let setAppStateMock: any

    // æ¸¬è©¦ç”¨çš„æœƒè©±æ•¸æ“š
    const mockSessionResponse: SessionResponse = {
        id: 'test-session-123',
        title: 'æ¸¬è©¦éŒ„éŸ³æœƒè©±',
        type: 'recording',
        status: 'active',
        language: 'zh-TW',
        created_at: '2024-01-01T00:00:00Z',
        updated_at: '2024-01-01T00:00:00Z'
    }

    beforeEach(async () => {
        // å‰µå»º mock æœå‹™
        mockSessionService = {
            ensureRecordingSession: vi.fn().mockResolvedValue(mockSessionResponse),
            createRecordingSession: vi.fn().mockResolvedValue(mockSessionResponse),
            waitForSessionReady: vi.fn().mockResolvedValue(true),
            finishSession: vi.fn(),
            checkActiveSession: vi.fn(),
        } as Partial<ISessionService>

        mockRecordingService = {
            requestPermission: vi.fn().mockResolvedValue(true),
            startRecording: vi.fn(),
            stopRecording: vi.fn(),
            isRecording: vi.fn(),
            getRecordingTime: vi.fn(),
            getRecordingState: vi.fn(),
        } as Partial<IRecordingService>

        mockTranscriptService = {
            connect: vi.fn(),
            disconnect: vi.fn(),
            addTranscriptListener: vi.fn(),
            removeTranscriptListener: vi.fn(),
            isConnected: vi.fn(),
            start: vi.fn(),
        } as Partial<ITranscriptService>

        // è¨­ç½®æœå‹™å®¹å™¨ mock
        mockServiceContainer = serviceContainer as any
        mockServiceContainer.resolve.mockImplementation((key: string) => {
            switch (key) {
                case SERVICE_KEYS.SESSION_SERVICE:
                    return mockSessionService
                case SERVICE_KEYS.RECORDING_SERVICE:
                    return mockRecordingService
                case SERVICE_KEYS.TRANSCRIPT_SERVICE:
                    return mockTranscriptService
                default:
                    throw new Error(`Unknown service key: ${key}`)
            }
        })

        // mock setAppState
        setAppStateMock = vi.fn()
        // é€™è£¡ç”¨ spyOn å–ä»£ setAppState
        const zustand = await import('../../app-store-zustand')
        vi.spyOn(zustand.useAppStore.getState(), 'setState').mockImplementation(setAppStateMock)

        recordingFlowService = new TestableRecordingFlowService(setAppStateMock)
        await recordingFlowService.initialize()
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('startRecordingFlow - æˆåŠŸæƒ…å¢ƒ', () => {
        test('æˆåŠŸå•Ÿå‹•éŒ„éŸ³æµç¨‹æ‡‰è©²è¿”å› SessionResponse', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)

            // Act
            const result = await recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(result).toEqual(mockSessionResponse)
            expect(result.id).toBe(mockSessionResponse.id)
            expect(result.status).toBe('active')
            expect(result.type).toBe('recording')

            // é©—è­‰æœå‹™èª¿ç”¨
            expect(mockSessionService.createRecordingSession).toHaveBeenCalledWith('æ¸¬è©¦æ¨™é¡Œ', undefined, undefined, undefined)
            expect(mockSessionService.waitForSessionReady).toHaveBeenCalledWith(mockSessionResponse.id, 5000)
            expect(mockTranscriptService.connect).toHaveBeenCalledWith(mockSessionResponse.id)
            expect(mockRecordingService.startRecording).toHaveBeenCalledWith(mockSessionResponse.id)

            // é©—è­‰ç‹€æ…‹
            expect(recordingFlowService.isFlowRunning()).toBe(true)
            expect(recordingFlowService.getCurrentSession()).toEqual(mockSessionResponse)
        })

        test('ç•¶æ¨™é¡Œç‚ºç©ºæ™‚ï¼Œæ‡‰è©²ä½¿ç”¨é è¨­æ¨™é¡Œ', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)

            // Act
            await recordingFlowService.startRecordingFlow()

            // Assert
            expect(mockSessionService.createRecordingSession).toHaveBeenCalledWith(
                expect.stringMatching(/éŒ„éŸ³ç­†è¨˜ \d{1,2}\/\d{1,2}\/\d{4}/),
                undefined, undefined, undefined
            )
        })
    })

    describe('startRecordingFlow - éŒ¯èª¤æƒ…å¢ƒ', () => {
        test('ç•¶æœƒè©±å‰µå»ºå¤±æ•—æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            const sessionError = new Error('æœƒè©±å‰µå»ºå¤±æ•—')
            mockSessionService.createRecordingSession.mockRejectedValueOnce(sessionError)

            // Act & Assert
            await expect(recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ'))
                .rejects.toThrow('æœƒè©±å‰µå»ºå¤±æ•—')

            // é©—è­‰å…¶ä»–æœå‹™æ²’æœ‰è¢«èª¿ç”¨
            expect(mockTranscriptService.connect).not.toHaveBeenCalled()
            expect(mockRecordingService.startRecording).not.toHaveBeenCalled()

            // é©—è­‰ç‹€æ…‹é‡ç½®
            expect(recordingFlowService.isFlowRunning()).toBe(false)
            expect(recordingFlowService.getCurrentSession()).toBeNull()
        })

        test('ç•¶æœƒè©±æº–å‚™å¤±æ•—æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(false)

            // Act & Assert
            await expect(recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ'))
                .rejects.toThrow('æœƒè©±æº–å‚™è¶…æ™‚')

            // é©—è­‰å…¶ä»–æœå‹™æ²’æœ‰è¢«èª¿ç”¨
            expect(mockTranscriptService.connect).not.toHaveBeenCalled()
            expect(mockRecordingService.startRecording).not.toHaveBeenCalled()
        })

        test('ç•¶é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            const transcriptError = new Error('é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—')
            mockTranscriptService.connect.mockRejectedValueOnce(transcriptError)

            // Act & Assert
            await expect(recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ'))
                .rejects.toThrow('é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—')

            // é©—è­‰éŒ„éŸ³æ²’æœ‰å•Ÿå‹•
            expect(mockRecordingService.startRecording).not.toHaveBeenCalled()
        })

        test('ç•¶éŒ„éŸ³æœå‹™å•Ÿå‹•å¤±æ•—æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            const recordingError = new Error('éŒ„éŸ³å•Ÿå‹•å¤±æ•—')
            mockRecordingService.startRecording.mockRejectedValueOnce(recordingError)

            // Act & Assert
            await expect(recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ'))
                .rejects.toThrow('éŒ„éŸ³å•Ÿå‹•å¤±æ•—')
        })

        test('ç•¶æµç¨‹å·²åœ¨é‹è¡Œæ™‚ï¼Œæ‡‰è©²å…ˆåœæ­¢ç¾æœ‰æµç¨‹', async () => {
            // Arrange - å…ˆå•Ÿå‹•ä¸€å€‹æµç¨‹
            mockSessionService.createRecordingSession.mockResolvedValue(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValue(true)
            mockTranscriptService.connect.mockResolvedValue(undefined)
            mockRecordingService.startRecording.mockResolvedValue(undefined)
            mockRecordingService.stopRecording.mockResolvedValue(undefined)
            mockTranscriptService.disconnect.mockResolvedValue(undefined)
            mockSessionService.finishSession.mockResolvedValue(undefined)

            await recordingFlowService.startRecordingFlow('ç¬¬ä¸€å€‹æœƒè©±')

            // Act - å•Ÿå‹•ç¬¬äºŒå€‹æµç¨‹
            const result = await recordingFlowService.startRecordingFlow('ç¬¬äºŒå€‹æœƒè©±')

            // Assert - é©—è­‰ç¬¬äºŒæ¬¡å•Ÿå‹•æˆåŠŸ
            expect(result).toEqual(mockSessionResponse)
            expect(recordingFlowService.isFlowRunning()).toBe(true)
        })
    })

    describe('stopRecordingFlow', () => {
        beforeEach(async () => {
            // å…ˆå•Ÿå‹•éŒ„éŸ³æµç¨‹
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)
            mockRecordingService.isRecording.mockReturnValue(true)

            await recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ')
        })

        test('æ‡‰è©²æ­£ç¢ºåœæ­¢éŒ„éŸ³æµç¨‹', async () => {
            // Arrange
            mockRecordingService.stopRecording.mockResolvedValueOnce(undefined)
            mockTranscriptService.disconnect.mockResolvedValueOnce(undefined)
            mockSessionService.finishSession.mockResolvedValueOnce(undefined)

            // Act
            await recordingFlowService.stopRecordingFlow()

            // Assert - é©—è­‰åœæ­¢é †åº
            expect(mockRecordingService.stopRecording).toHaveBeenCalled()
            expect(mockTranscriptService.disconnect).toHaveBeenCalledWith(mockSessionResponse.id)
            expect(mockSessionService.finishSession).toHaveBeenCalledWith(mockSessionResponse.id)

            // é©—è­‰ç‹€æ…‹æ¸…ç†
            expect(recordingFlowService.isFlowRunning()).toBe(false)
            expect(recordingFlowService.getCurrentSession()).toBeNull()
        })
    })

    describe('Stop â†’ processing â†’ finished ç‹€æ…‹æµ', () => {
        beforeEach(async () => {
            // å…ˆå•Ÿå‹•éŒ„éŸ³æµç¨‹
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockTranscriptService.start.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)
            mockRecordingService.isRecording.mockReturnValue(true)

            await recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ')
        })

        test('åœæ­¢éŒ„éŸ³å¾Œæ‡‰é€²å…¥ processingï¼Œæ”¶åˆ° transcript_complete é€²å…¥ finished ä¸¦æ–·ç·š', async () => {
            // Arrange
            mockRecordingService.stopRecording.mockResolvedValueOnce(undefined)
            // ä¸è¦ç«‹å³æ–·ç·š
            mockTranscriptService.disconnect.mockResolvedValueOnce(undefined)
            mockSessionService.finishSession.mockResolvedValueOnce(undefined)

            // Act: åœæ­¢éŒ„éŸ³
            await recordingFlowService.stopRecordingFlow()

            // Assert: æ‡‰è©²é€²å…¥ processing ç‹€æ…‹
            expect(setAppStateMock).toHaveBeenCalledWith('processing')
            // æ¨¡æ“¬æ”¶åˆ° transcript_complete è¨Šæ¯
            const msg = { type: 'transcript_complete', session_id: mockSessionResponse.id }
            // éœ€å°‡ handleTranscriptMessage è¨­ç‚º public æˆ–ç”¨ (as any)
            await (recordingFlowService as any).handleTranscriptMessage(msg)

            // æ‡‰è©²é€²å…¥ finished ç‹€æ…‹ä¸¦æ–·ç·š
            expect(setAppStateMock).toHaveBeenCalledWith('finished')
            expect(mockTranscriptService.disconnect).toHaveBeenCalledWith(mockSessionResponse.id)
            expect((recordingFlowService as any).isFlowActive).toBe(false)
        })
    })

    describe('ç‹€æ…‹ç®¡ç†', () => {
        test('åˆå§‹ç‹€æ…‹æ‡‰è©²æ­£ç¢º', () => {
            expect(recordingFlowService.isFlowRunning()).toBe(false)
            expect(recordingFlowService.getCurrentSession()).toBeNull()
            expect(recordingFlowService.getTranscriptEntries()).toEqual([])
        })

        test('å•Ÿå‹•å¾Œç‹€æ…‹æ‡‰è©²æ­£ç¢º', async () => {
            // Arrange
            mockSessionService.createRecordingSession.mockResolvedValueOnce(mockSessionResponse)
            mockSessionService.waitForSessionReady.mockResolvedValueOnce(true)
            mockTranscriptService.connect.mockResolvedValueOnce(undefined)
            mockRecordingService.startRecording.mockResolvedValueOnce(undefined)

            // Act
            await recordingFlowService.startRecordingFlow('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(recordingFlowService.isFlowRunning()).toBe(true)
            expect(recordingFlowService.getCurrentSession()).toEqual(mockSessionResponse)
        })
    })
})




# END FILE CONTENTS


# File: docs/ADD_GEMINI.md

## âœ¨ Feature Specï¼šå¯åˆ‡æ› Whisper â‡† Gemini (2.5 Pro) èªéŸ³è½‰æ–‡å­—

### 0. ç›®æ¨™
1. ä½¿ç”¨è€…å¯åœ¨ UI é¸æ“‡ **Whisper** æˆ– **Gemini 2.5 Pro** ä½œç‚ºè½‰éŒ„å¼•æ“  
2. é¸å®šå¾Œå»ºç«‹ä¹‹ session åŠå…¶æ‰€æœ‰åˆ‡ç‰‡éƒ½èµ°å°æ‡‰ Provider  
3. ç„¡è«– Providerï¼Œå‰ç«¯å¾—åˆ° *ä¸€è‡´* çš„ `transcript_segment` Payload

---

### 1. æ–°å¢ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸                 | ç¯„ä¾‹å€¼                                  | èªªæ˜                                 |
| -------------------- | --------------------------------------- | ------------------------------------ |
| STT_PROVIDER_DEFAULT | whisper                                 | é è¨­ Provider (`whisper` / `gemini`) |
| GEMINI_ENDPOINT      | `us-central1-aiplatform.googleapis.com` | Vertex AI ç«¯é»                       |
| GEMINI_API_KEY       | `ya29.~â€¦`                               | GCP æœå‹™å¸³æˆ¶ *API Key*               |
| GEMINI_PROMPT        | `è«‹è¼¸å‡ºé€å­—ç¨¿â€¦`                         | é è¨­ system prompt                   |
| GEMINI_MAX_REQUESTS  | 90                                      | 1 min å…§å¯å‘¼å«æ¬¡æ•¸ (RateLimiter ç”¨)  |

---

### 2. DB è®Šæ›´

```sql
ALTER TABLE sessions
ADD COLUMN stt_provider VARCHAR(20) NOT NULL DEFAULT 'whisper';
```

---

### 3. å¾Œç«¯

#### 3-1 ç›®éŒ„çµæ§‹

```
app/services/stt/
 â”œâ”€ base.py             # ISTTProvider ä»‹é¢
 â”œâ”€ whisper_provider.py # èˆŠ SimpleAudioTranscriptionService ç§»å…¥
 â”œâ”€ gemini_provider.py  # å…¨æ–°å¯¦ä½œ
 â””â”€ factory.py          # get_provider(session_id)
```

#### 3-2 ä»‹é¢ `base.py`

```python
class ISTTProvider(ABC):
    @abstractmethod
    async def transcribe(self, webm: bytes, session_id: UUID, chunk_seq: int) -> dict: ...
    @abstractmethod
    def name(self) -> str: ...
    @abstractmethod
    def max_rpm(self) -> int: ...
```

#### 3-3 Gemini å¯¦ä½œï¼ˆæ ¸å¿ƒç‰‡æ®µï¼‰

```python
class GeminiProvider(ISTTProvider):
    def __init__(self):
        self.model = GenerativeModel("gemini-2.5-pro-preview",
                                     api_key=settings.GEMINI_API_KEY)

    async def transcribe(self, webm: bytes, session_id: UUID, chunk_seq: int):
        pcm = await ffmpeg_webm_to_pcm(webm)          # å…±ç”¨è½‰æª”å·¥å…·
        b64 = base64.b64encode(pcm).decode()
        prompt = settings.GEMINI_PROMPT
        res = await self.model.generate_content_async(
            contents=[{"role":"user","parts":[
              {"text": prompt},
              {"audio":{"mime_type":"audio/wav","data":b64}}
            ]}]
        )
        text = res.text.strip()
        return {"text": text,
                "start_offset": 0,
                "end_offset": 0}      # Gemini ç„¡æ®µè½ â†’ 0~D

    def name(self):     return "gemini"
    def max_rpm(self):  return settings.GEMINI_MAX_REQUESTS
```

#### 3-4 Factory

```python
def get_provider(session_id: UUID) -> ISTTProvider:
    provider = cache.get(session_id)    # ç°¡æ˜“ LRU
    if provider: return provider

    record = supabase.table("sessions")\
        .select("stt_provider").eq("id", str(session_id)).single().execute()
    name = record.data["stt_provider"]
    if name == "gemini":
        provider = GeminiProvider()
    else:
        provider = WhisperProvider()
    cache[session_id] = provider
    return provider
```

#### 3-5 QueueManager æ•´åˆ

```python
provider = get_provider(session_id)
rate_limiter = SlidingWindowRateLimiter(max_requests=provider.max_rpm())
result = await provider.transcribe(webm, session_id, chunk_seq)
```

> ğŸ¯ `transcript_segment` JSON å¢åŠ  `"provider": "gemini" | "whisper"` ï¼ˆä¾›å‰ç«¯é¡¯ç¤ºå°å¾½ç« ï¼‰ã€‚

---

### 4. API

| Method | Path                          | Body/Query                                                       | èªªæ˜                                                             |
| ------ | ----------------------------- | ---------------------------------------------------------------- | ---------------------------------------------------------------- |
| POST   | `/api/session`                | `{ "type":"recording", "title":"...", "stt_provider":"gemini" }` | å¤šä¸€å€‹ `stt_provider` æ¬„ä½ï¼Œé è¨­ `settings.STT_PROVIDER_DEFAULT` |
| PATCH  | `/api/session/{sid}/provider` | `{ "stt_provider":"whisper" }`                                   | (å¯é¸) æœƒè©±ä¸­é€”åˆ‡æ›ï¼Œåƒ…åœ¨ *å°šæœªä¸Šå‚³éŸ³æª”* æ™‚å…è¨±                  |

---

### 5. å‰ç«¯

#### 5-1 UI

1. `SettingsDrawer` â†’ æ–°å¢ã€ŒèªéŸ³è½‰æ–‡å­—å¼•æ“ã€é¸é …  
   - `Whisper (Azure) / Gemini 2.5 Pro (Vertex AI)`
2. é»æ“Šã€Œæ›´æ›ã€é–‹ `ProviderSelectModal`  
   - radio + Save  
3. é¸å®šå¾Œï¼š
   - è‹¥å°šæœªæœ‰ session â†’ å­˜ localStorage, `useAppStore.setProvider`
   - è‹¥å·²æœ‰ active session â†’ å‘¼å« `PATCH /provider`

#### 5-2 Zustand Store

```ts
type STTProvider = 'whisper' | 'gemini'

provider: STTProvider
setProvider: (p: STTProvider)=> set({ provider:p })
```

#### 5-3 é–‹å§‹éŒ„éŸ³æµç¨‹

```ts
await ensureFreshRecordingSession(
  { title, stt_provider: get().provider }   // å‚³åˆ°å¾Œç«¯
)
```

#### 5-4 Transcript UI

åœ¨å­—å¹•åˆ—åŠ ä¸€å€‹å° tagï¼š

```jsx
{entry.provider === 'gemini' && <Badge>G</Badge>}
```

---

### 6. æ¸¬è©¦

| é¡å‹             | Case                                        | æ–·è¨€                                 |
| ---------------- | ------------------------------------------- | ------------------------------------ |
| unit (MSW)       | POST `/session` with `stt_provider=gemini`  | å› 201, body.stt_provider = gemini   |
| e2e (Playwright) | åˆ‡åˆ° Gemini éŒ„ 30 s                         | UI å‡ºç¾ provider æ¨™ç±¤ & å­—å¹•é †åºæ­£ç¢º |
| backend          | GeminiProvider.transcribe() mock Base64 Wav | å›å‚³ dict.text â‰  ''                  |

---

### 7. æ–‡ä»¶ï¼ˆREADME ç¯„ç‰‡æ®µï¼‰

```md
### âš™ï¸ åˆ‡æ› STT Provider

.env
```
| key                  | whisper | gemini                                |
| -------------------- | ------- | ------------------------------------- |
| STT_PROVIDER_DEFAULT | whisper | gemini                                |
| GEMINI_ENDPOINT      | â€“       | us-central1-aiplatform.googleapis.com |
| GEMINI_API_KEY       | â€“       | <your-gcp-key>                        |

åœ¨ UI â†’ Settings â†’ STT Provider å¯ Runtime åˆ‡æ›ã€‚
```

---

å®Œæˆä»¥ä¸Š Checklistï¼ˆ#0â€Šâ€“â€Š#10 ç‚º **å¿…éœ€**ï¼‰ï¼Œå³å¯åœ¨åŒä¸€æ”¯ App å…§è‡ªç”±åˆ‡æ› Whisper èˆ‡ Gemini 2.5 Pro ä½œç‚ºè½‰éŒ„å¼•æ“ã€‚



# END FILE CONTENTS


# File: frontend/components/ui/alert-dialog.tsx

"use client"

import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}


# END FILE CONTENTS


# File: frontend/components/ui/card.tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }


# END FILE CONTENTS


# File: frontend/components/ui/tooltip.tsx

"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }


# END FILE CONTENTS


# File: app/schemas/__init__.py



# END FILE CONTENTS


# File: app/lib/settings_utils.py

"""
settings_utils.py
é›†ä¸­æ”¾ä¸€äº›æœƒåœ¨å¤šå€‹æ¨¡çµ„ç”¨åˆ°ã€ä½†å¿…é ˆå‹•æ…‹è®€å–
get_settings() çš„å°å‡½å¼ï¼Œé¿å… module import æ™‚
æŠŠ settings ç¶æ­»ã€‚
"""

from app.core.config import get_settings


def get_chunk_duration() -> int:
    """
    å›å‚³ç›®å‰ .env ä¸­æŒ‡å®šçš„åˆ‡ç‰‡é•·åº¦ (ç§’)ã€‚
    æ¯æ¬¡å‘¼å«éƒ½é‡æ–°èµ° get_settings()ï¼Œç¢ºä¿èˆ‡
    .env â†’ Settings ä¸€è‡´ã€‚
    """
    return get_settings().AUDIO_CHUNK_DURATION_SEC


def get_filter_thresholds():
    """
    å›å‚³ (no_speech_thresh, logprob_thresh, compression_thresh)ã€‚
    åŒæ¨£æ¯æ¬¡é‡æ–°è®€å–è¨­å®šã€‚
    """
    s = get_settings()
    return s.FILTER_NO_SPEECH, s.FILTER_LOGPROB, s.FILTER_COMPRESSION


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/transcript-service.test.ts

"use client"

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { TranscriptService } from '../transcript-service'
import { transcriptManager } from '../../transcript-manager'
import type { TranscriptMessage } from '../interfaces'

// Mock transcriptManager
const mockTranscriptManager = {
    connect: vi.fn(),
    disconnect: vi.fn(),
    addListener: vi.fn(),
    removeListener: vi.fn(),
    isConnected: vi.fn(),
    getCurrentTranscripts: vi.fn(),
    clearTranscripts: vi.fn(),
    getConnectionCount: vi.fn(),
}

vi.mock('../../transcript-manager', () => ({
    transcriptManager: mockTranscriptManager
}))

describe('TranscriptService', () => {
    let transcriptService: TranscriptService

    beforeEach(() => {
        transcriptService = new TranscriptService()
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('æœå‹™åˆå§‹åŒ–', () => {
        it('æ‡‰è©²æ­£ç¢ºåˆå§‹åŒ– TranscriptService', () => {
            expect(transcriptService).toBeDefined()
            expect(transcriptService['serviceName']).toBe('TranscriptService')
        })

        it('æ‡‰è©²æ­£ç¢ºå•Ÿå‹•å’Œåœæ­¢æœå‹™', async () => {
            await transcriptService.start()
            expect(transcriptService['isRunning']).toBe(true)

            await transcriptService.stop()
            expect(transcriptService['isRunning']).toBe(false)
        })
    })

    describe('connect', () => {
        const sessionId = 'test-session-id'

        it('æ‡‰è©²æˆåŠŸé€£æ¥é€å­—ç¨¿æœå‹™', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await transcriptService.connect(sessionId)

            expect(mockTranscriptManager.connect).toHaveBeenCalledWith(sessionId)
            expect(transcriptService['connectedSessions'].has(sessionId)).toBe(true)
        })

        it('æ‡‰è©²è™•ç†é€£æ¥å¤±æ•—', async () => {
            const connectError = new Error('Connection failed')
            mockTranscriptManager.connect.mockRejectedValue(connectError)

            await expect(transcriptService.connect(sessionId))
                .rejects.toThrow('Connection failed')

            expect(transcriptService['connectedSessions'].has(sessionId)).toBe(false)
        })

        it('æ‡‰è©²è™•ç†é‡è¤‡é€£æ¥è«‹æ±‚', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            // é¦–æ¬¡é€£æ¥
            await transcriptService.connect(sessionId)

            // é‡è¤‡é€£æ¥ï¼ˆæ‡‰è©²è¢«å¿½ç•¥ï¼‰
            await transcriptService.connect(sessionId)

            expect(mockTranscriptManager.connect).toHaveBeenCalledTimes(1)
        })

        it('æ‡‰è©²æ”¯æ´å¤šå€‹æœƒè©±åŒæ™‚é€£æ¥', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await transcriptService.connect('session-1')
            await transcriptService.connect('session-2')

            expect(transcriptService['connectedSessions'].has('session-1')).toBe(true)
            expect(transcriptService['connectedSessions'].has('session-2')).toBe(true)
            expect(mockTranscriptManager.connect).toHaveBeenCalledTimes(2)
        })
    })

    describe('disconnect', () => {
        const sessionId = 'test-session-id'

        beforeEach(async () => {
            // Setup connected state
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            await transcriptService.connect(sessionId)
        })

        it('æ‡‰è©²æˆåŠŸæ–·é–‹ç‰¹å®šæœƒè©±', async () => {
            mockTranscriptManager.disconnect.mockResolvedValue(undefined)

            await transcriptService.disconnect(sessionId)

            expect(mockTranscriptManager.disconnect).toHaveBeenCalledWith(sessionId)
            expect(transcriptService['connectedSessions'].has(sessionId)).toBe(false)
        })

        it('æ‡‰è©²æ–·é–‹æ‰€æœ‰æœƒè©±ï¼ˆç•¶ä¸æŒ‡å®š sessionId æ™‚ï¼‰', async () => {
            // é€£æ¥å¤šå€‹æœƒè©±
            await transcriptService.connect('session-2')
            mockTranscriptManager.disconnect.mockResolvedValue(undefined)

            await transcriptService.disconnect()

            expect(mockTranscriptManager.disconnect).toHaveBeenCalledTimes(2)
            expect(transcriptService['connectedSessions'].size).toBe(0)
        })

        it('æ‡‰è©²æ¸…ç†å°æ‡‰çš„ç›£è½å™¨', async () => {
            const callback = vi.fn()

            // æ·»åŠ ç›£è½å™¨
            transcriptService.addTranscriptListener(sessionId, callback)

            mockTranscriptManager.disconnect.mockResolvedValue(undefined)
            await transcriptService.disconnect(sessionId)

            expect(mockTranscriptManager.removeListener).toHaveBeenCalledWith(sessionId, callback)
            expect(transcriptService['sessionListeners'].has(sessionId)).toBe(false)
        })

        it('æ‡‰è©²è™•ç†æ–·é–‹ä¸å­˜åœ¨çš„æœƒè©±', async () => {
            await expect(transcriptService.disconnect('non-existent'))
                .resolves.not.toThrow()
        })

        it('æ‡‰è©²è™•ç†æ–·é–‹å¤±æ•—', async () => {
            const disconnectError = new Error('Disconnect failed')
            mockTranscriptManager.disconnect.mockRejectedValue(disconnectError)

            await expect(transcriptService.disconnect(sessionId))
                .rejects.toThrow('Disconnect failed')
        })
    })

    describe('addTranscriptListener', () => {
        const sessionId = 'test-session-id'
        const callback = vi.fn()

        it('æ‡‰è©²æˆåŠŸæ·»åŠ é€å­—ç¨¿ç›£è½å™¨', () => {
            transcriptService.addTranscriptListener(sessionId, callback)

            expect(mockTranscriptManager.addListener).toHaveBeenCalledWith(sessionId, callback)
            expect(transcriptService['sessionListeners'].get(sessionId)?.has(callback)).toBe(true)
        })

        it('æ‡‰è©²æ”¯æ´åŒä¸€æœƒè©±å¤šå€‹ç›£è½å™¨', () => {
            const callback2 = vi.fn()

            transcriptService.addTranscriptListener(sessionId, callback)
            transcriptService.addTranscriptListener(sessionId, callback2)

            const listeners = transcriptService['sessionListeners'].get(sessionId)
            expect(listeners?.has(callback)).toBe(true)
            expect(listeners?.has(callback2)).toBe(true)
            expect(listeners?.size).toBe(2)
        })

        it('æ‡‰è©²é˜²æ­¢é‡è¤‡æ·»åŠ ç›¸åŒç›£è½å™¨', () => {
            transcriptService.addTranscriptListener(sessionId, callback)
            transcriptService.addTranscriptListener(sessionId, callback)

            expect(mockTranscriptManager.addListener).toHaveBeenCalledTimes(1)
            expect(transcriptService['sessionListeners'].get(sessionId)?.size).toBe(1)
        })

        it('æ‡‰è©²è™•ç†ä¸åŒæœƒè©±çš„ç›£è½å™¨', () => {
            const callback2 = vi.fn()

            transcriptService.addTranscriptListener('session-1', callback)
            transcriptService.addTranscriptListener('session-2', callback2)

            expect(transcriptService['sessionListeners'].get('session-1')?.has(callback)).toBe(true)
            expect(transcriptService['sessionListeners'].get('session-2')?.has(callback2)).toBe(true)
        })
    })

    describe('removeTranscriptListener', () => {
        const sessionId = 'test-session-id'
        const callback = vi.fn()

        beforeEach(() => {
            transcriptService.addTranscriptListener(sessionId, callback)
        })

        it('æ‡‰è©²æˆåŠŸç§»é™¤é€å­—ç¨¿ç›£è½å™¨', () => {
            transcriptService.removeTranscriptListener(sessionId, callback)

            expect(mockTranscriptManager.removeListener).toHaveBeenCalledWith(sessionId, callback)
            expect(transcriptService['sessionListeners'].get(sessionId)?.has(callback)).toBe(false)
        })

        it('æ‡‰è©²è™•ç†ç§»é™¤ä¸å­˜åœ¨çš„ç›£è½å™¨', () => {
            const nonExistentCallback = vi.fn()

            expect(() => transcriptService.removeTranscriptListener(sessionId, nonExistentCallback))
                .not.toThrow()
        })

        it('æ‡‰è©²è™•ç†ç§»é™¤ä¸å­˜åœ¨æœƒè©±çš„ç›£è½å™¨', () => {
            expect(() => transcriptService.removeTranscriptListener('non-existent', callback))
                .not.toThrow()
        })

        it('æ‡‰è©²åœ¨ç§»é™¤æœ€å¾Œä¸€å€‹ç›£è½å™¨æ™‚æ¸…ç†æœƒè©±è¨˜éŒ„', () => {
            transcriptService.removeTranscriptListener(sessionId, callback)

            expect(transcriptService['sessionListeners'].has(sessionId)).toBe(false)
        })
    })

    describe('isConnected', () => {
        const sessionId = 'test-session-id'

        it('æ‡‰è©²å ±å‘Šæ­£ç¢ºçš„é€£æ¥ç‹€æ…‹', async () => {
            expect(transcriptService.isConnected(sessionId)).toBe(false)

            mockTranscriptManager.connect.mockResolvedValue(undefined)
            await transcriptService.connect(sessionId)

            expect(transcriptService.isConnected(sessionId)).toBe(true)

            mockTranscriptManager.disconnect.mockResolvedValue(undefined)
            await transcriptService.disconnect(sessionId)

            expect(transcriptService.isConnected(sessionId)).toBe(false)
        })

        it('æ‡‰è©²è™•ç†ä¸å­˜åœ¨çš„æœƒè©±', () => {
            expect(transcriptService.isConnected('non-existent')).toBe(false)
        })
    })

    describe('é€å­—ç¨¿æ•¸æ“šè™•ç†', () => {
        const sessionId = 'test-session-id'
        const mockTranscript: TranscriptMessage = {
            id: 'transcript-1',
            text: 'Hello world',
            timestamp: '2024-01-01T00:00:00Z',
            confidence: 0.95,
            isPartial: false,
            sessionId
        }

        it('æ‡‰è©²æ­£ç¢ºè™•ç†é€å­—ç¨¿è¨Šæ¯', () => {
            const callback = vi.fn()
            transcriptService.addTranscriptListener(sessionId, callback)

            // æ¨¡æ“¬æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯
            const listenerCall = mockTranscriptManager.addListener.mock.calls.find(
                call => call[0] === sessionId
            )
            const transcriptCallback = listenerCall?.[1]

            if (transcriptCallback) {
                transcriptCallback(mockTranscript)
            }

            expect(callback).toHaveBeenCalledWith(mockTranscript)
        })

        it('æ‡‰è©²è™•ç†éƒ¨åˆ†é€å­—ç¨¿', () => {
            const callback = vi.fn()
            const partialTranscript: TranscriptMessage = {
                ...mockTranscript,
                text: 'Hello wor...',
                isPartial: true,
                confidence: 0.7
            }

            transcriptService.addTranscriptListener(sessionId, callback)

            // æ¨¡æ“¬æ”¶åˆ°éƒ¨åˆ†é€å­—ç¨¿
            const listenerCall = mockTranscriptManager.addListener.mock.calls.find(
                call => call[0] === sessionId
            )
            const transcriptCallback = listenerCall?.[1]

            if (transcriptCallback) {
                transcriptCallback(partialTranscript)
            }

            expect(callback).toHaveBeenCalledWith(partialTranscript)
        })

        it('æ‡‰è©²æ”¯æ´å¤šå€‹ç›£è½å™¨åŒæ™‚æ¥æ”¶è¨Šæ¯', () => {
            const callback1 = vi.fn()
            const callback2 = vi.fn()

            transcriptService.addTranscriptListener(sessionId, callback1)
            transcriptService.addTranscriptListener(sessionId, callback2)

            // æ¨¡æ“¬æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯
            const listenerCalls = mockTranscriptManager.addListener.mock.calls.filter(
                call => call[0] === sessionId
            )

            listenerCalls.forEach(call => {
                const transcriptCallback = call[1]
                if (transcriptCallback) {
                    transcriptCallback(mockTranscript)
                }
            })

            expect(callback1).toHaveBeenCalledWith(mockTranscript)
            expect(callback2).toHaveBeenCalledWith(mockTranscript)
        })
    })

    describe('éŒ¯èª¤è™•ç†', () => {
        const sessionId = 'test-session-id'

        it('æ‡‰è©²è™•ç† TranscriptManager é€£æ¥éŒ¯èª¤', async () => {
            const connectionError = new Error('WebSocket connection failed')
            mockTranscriptManager.connect.mockRejectedValue(connectionError)

            await expect(transcriptService.connect(sessionId))
                .rejects.toThrow('WebSocket connection failed')

            expect(transcriptService.isConnected(sessionId)).toBe(false)
        })

        it('æ‡‰è©²è™•ç† TranscriptManager æ–·é–‹éŒ¯èª¤', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            await transcriptService.connect(sessionId)

            const disconnectError = new Error('Disconnect failed')
            mockTranscriptManager.disconnect.mockRejectedValue(disconnectError)

            await expect(transcriptService.disconnect(sessionId))
                .rejects.toThrow('Disconnect failed')
        })

        it('æ‡‰è©²åœ¨é€£æ¥å¤±æ•—æ™‚æ¸…ç†ç‹€æ…‹', async () => {
            const connectionError = new Error('Connection failed')
            mockTranscriptManager.connect.mockRejectedValue(connectionError)

            try {
                await transcriptService.connect(sessionId)
            } catch {
                // é æœŸçš„éŒ¯èª¤
            }

            expect(transcriptService['connectedSessions'].has(sessionId)).toBe(false)
        })
    })

    describe('ä¸¦ç™¼å ´æ™¯æ¸¬è©¦', () => {
        it('æ‡‰è©²è™•ç†ä¸¦ç™¼é€£æ¥è«‹æ±‚', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            const promises = [
                transcriptService.connect('session-1'),
                transcriptService.connect('session-2'),
                transcriptService.connect('session-3')
            ]

            await Promise.all(promises)

            expect(transcriptService['connectedSessions'].size).toBe(3)
            expect(mockTranscriptManager.connect).toHaveBeenCalledTimes(3)
        })

        it('æ‡‰è©²è™•ç†ä¸¦ç™¼çš„é€£æ¥å’Œæ–·é–‹æ“ä½œ', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.disconnect.mockResolvedValue(undefined)

            // é€£æ¥æœƒè©±
            await transcriptService.connect('session-1')

            const promises = [
                transcriptService.connect('session-2'),
                transcriptService.disconnect('session-1'),
                transcriptService.connect('session-3')
            ]

            await Promise.all(promises)

            expect(transcriptService['connectedSessions'].has('session-1')).toBe(false)
            expect(transcriptService['connectedSessions'].has('session-2')).toBe(true)
            expect(transcriptService['connectedSessions'].has('session-3')).toBe(true)
        })

        it('æ‡‰è©²è™•ç†å¿«é€Ÿçš„æ·»åŠ å’Œç§»é™¤ç›£è½å™¨æ“ä½œ', () => {
            const callbacks = Array.from({ length: 5 }, () => vi.fn())
            const sessionId = 'test-session'

            // å¿«é€Ÿæ·»åŠ å¤šå€‹ç›£è½å™¨
            callbacks.forEach(callback => {
                transcriptService.addTranscriptListener(sessionId, callback)
            })

            expect(transcriptService['sessionListeners'].get(sessionId)?.size).toBe(5)

            // å¿«é€Ÿç§»é™¤ç›£è½å™¨
            callbacks.forEach(callback => {
                transcriptService.removeTranscriptListener(sessionId, callback)
            })

            expect(transcriptService['sessionListeners'].has(sessionId)).toBe(false)
        })
    })

    describe('è³‡æºæ¸…ç†', () => {
        it('æ‡‰è©²åœ¨æœå‹™åœæ­¢æ™‚æ¸…ç†æ‰€æœ‰è³‡æº', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.disconnect.mockResolvedValue(undefined)

            // é€£æ¥å¤šå€‹æœƒè©±
            await transcriptService.connect('session-1')
            await transcriptService.connect('session-2')

            // æ·»åŠ ç›£è½å™¨
            const callback1 = vi.fn()
            const callback2 = vi.fn()
            transcriptService.addTranscriptListener('session-1', callback1)
            transcriptService.addTranscriptListener('session-2', callback2)

            // åœæ­¢æœå‹™
            await transcriptService.stop()

            // é©—è­‰è³‡æºæ¸…ç†
            expect(transcriptService['connectedSessions'].size).toBe(0)
            expect(transcriptService['sessionListeners'].size).toBe(0)
        })

        it('æ‡‰è©²è™•ç†æ¸…ç†éç¨‹ä¸­çš„éŒ¯èª¤', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            await transcriptService.connect('session-1')

            // æ¨¡æ“¬æ–·é–‹æ™‚ç™¼ç”ŸéŒ¯èª¤
            mockTranscriptManager.disconnect.mockRejectedValue(new Error('Cleanup error'))

            // æœå‹™åœæ­¢æ‡‰è©²ä¸æœƒæ‹‹å‡ºéŒ¯èª¤
            await expect(transcriptService.stop()).resolves.not.toThrow()
        })
    })

    describe('æœå‹™ç‹€æ…‹å ±å‘Š', () => {
        it('æ‡‰è©²å ±å‘Šæ­£ç¢ºçš„æœå‹™è³‡è¨Š', () => {
            const info = transcriptService.getServiceInfo()

            expect(info).toMatchObject({
                serviceName: 'TranscriptService',
                isInitialized: expect.any(Boolean),
                isRunning: expect.any(Boolean),
                connectedSessions: expect.any(Array),
                activeListeners: expect.any(Object),
                totalConnections: expect.any(Number)
            })
        })

        it('æ‡‰è©²æ­£ç¢ºå ±å‘Šé€£æ¥æ•¸é‡', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await transcriptService.connect('session-1')
            await transcriptService.connect('session-2')

            const info = transcriptService.getServiceInfo()

            expect(info.connectedSessions).toHaveLength(2)
            expect(info.totalConnections).toBe(2)
        })

        it('æ‡‰è©²æ­£ç¢ºå ±å‘Šç›£è½å™¨æ•¸é‡', () => {
            const callback1 = vi.fn()
            const callback2 = vi.fn()

            transcriptService.addTranscriptListener('session-1', callback1)
            transcriptService.addTranscriptListener('session-1', callback2)
            transcriptService.addTranscriptListener('session-2', callback1)

            const info = transcriptService.getServiceInfo()

            expect(info.activeListeners['session-1']).toBe(2)
            expect(info.activeListeners['session-2']).toBe(1)
        })
    })

    describe('é‚Šç•Œæ¢ä»¶æ¸¬è©¦', () => {
        it('æ‡‰è©²è™•ç†ç©ºå­—ç¬¦ä¸²æœƒè©± ID', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await expect(transcriptService.connect('')).resolves.not.toThrow()
            expect(transcriptService.isConnected('')).toBe(true)
        })

        it('æ‡‰è©²è™•ç†ç‰¹æ®Šå­—ç¬¦çš„æœƒè©± ID', async () => {
            const specialSessionId = 'session-123!@#$%^&*()'
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await transcriptService.connect(specialSessionId)
            expect(transcriptService.isConnected(specialSessionId)).toBe(true)
        })

        it('æ‡‰è©²è™•ç† null/undefined å›èª¿å‡½æ•¸', () => {
            expect(() => transcriptService.addTranscriptListener('session', null as any))
                .not.toThrow()

            expect(() => transcriptService.addTranscriptListener('session', undefined as any))
                .not.toThrow()
        })
    })
})


# END FILE CONTENTS


# File: frontend/components/finish-state.tsx

"use client"

import { ScrollArea } from "@/components/ui/scroll-area"
import { Button } from "@/components/ui/button"
import { ChevronDown } from "lucide-react"
import type { TranscriptEntry } from "../types/app-state"

interface FinishStateProps {
  transcriptEntries: TranscriptEntry[]
  onExport?: () => void
  onToLatest?: () => void
}

export function FinishState({ transcriptEntries, onExport, onToLatest }: FinishStateProps) {
  return (
    <div className="h-full flex flex-col">
      <ScrollArea className="flex-1">
        <div className="p-6 space-y-4">
          {transcriptEntries.map((entry, index) => (
            <div key={index} className="flex gap-4 text-sm">
              <span className="text-muted-foreground font-mono text-xs mt-1 min-w-[40px] flex-shrink-0">
                {entry.time}
              </span>
              <span className="text-foreground leading-relaxed flex-1">{entry.text}</span>
            </div>
          ))}
        </div>
      </ScrollArea>

      <div className="p-4 border-t border-border space-y-2">
        {/* Action buttons row */}
        <div className="flex justify-center gap-2">
          {onToLatest && (
            <Button
              onClick={onToLatest}
              variant="ghost"
              size="sm"
              className="flex items-center gap-2"
            >
              <ChevronDown className="w-4 h-4" />
              To Latest
            </Button>
          )}
        </div>
      </div>
    </div>
  )
}


# END FILE CONTENTS


# File: app/services/stt/whisper_provider.py

from __future__ import annotations

import logging
from uuid import UUID
from typing import Any, Dict, Optional
from app.services.stt.base import ISTTProvider
from app.services.azure_whisper import AzureWhisperService
from app.services.stt.lang_map import to_whisper
from app.db.database import get_supabase_client

import json
from app.core.config import get_settings

logger = logging.getLogger(__name__)

__all__ = ["WhisperProvider", "save_and_push_result"]

class WhisperProvider(ISTTProvider):
    name = "whisper"
    _service: Optional[AzureWhisperService] = None

    def __init__(self) -> None:
        if self._service is None:
            self._service = AzureWhisperService()

    def max_rpm(self) -> int:
        # å¯æ ¹æ“šè¨­å®šèª¿æ•´
        from app.core.config import get_settings
        settings = get_settings()
        return getattr(settings, "WHISPER_MAX_REQUESTS", 180)


    async def transcribe(self, audio: bytes, session_id: UUID, chunk_seq: int) -> Dict[str, Any] | None:
        # æŸ¥è©¢ canonical lang_code
        supa = get_supabase_client()
        row = supa.table("sessions").select("lang_code").eq("id", str(session_id)).single().execute()
        canonical = (row.data or {}).get("lang_code", "zh-TW")
        api_language = to_whisper(canonical)
        return await self._service.transcribe(
            audio, session_id, chunk_seq,
            api_language=api_language,
            canonical_lang=canonical
        )

async def save_and_push_result(session_id: UUID, chunk_seq: int, data: dict):
    """å…±ç”¨ï¼šæŠŠçµæœå¯«å…¥ transcript_segments ä¸¦é€é WebSocket æ¨é€"""
    from app.ws.transcript_feed import manager
    from app.db.database import get_supabase_client

    settings = get_settings()
    supa = get_supabase_client()
    seg = {
        "session_id": str(session_id),
        "chunk_sequence": chunk_seq,
        "text": data["text"],
        "start_time": chunk_seq * settings.AUDIO_CHUNK_DURATION_SEC,
        "end_time": (chunk_seq + 1) * settings.AUDIO_CHUNK_DURATION_SEC,
        "confidence": 1.0,
        "lang_code": data["lang_code"],
    }
    row = supa.table("transcript_segments").insert(seg).execute()

    # WebSocket
    await manager.broadcast(
        json.dumps({
            "type": "transcript_segment",
            "session_id": str(session_id),
            "segment_id": row.data[0]["id"],
            **seg
        }),
        str(session_id)
    )


# END FILE CONTENTS


# File: frontend/lib/websocket.ts

"use client"

import { getWebSocketURL } from './api'

// WebSocket é€£æ¥ç‹€æ…‹
export type WebSocketState = 'connecting' | 'connected' | 'disconnected' | 'error'

// é€å­—ç¨¿æ¥æ”¶ä»‹é¢ (èˆ‡å¾Œç«¯æ¨é€æ ¼å¼ä¸€è‡´)
export interface TranscriptMessage {
  type: 'transcript_segment' | 'transcript_complete' | 'connection_established' | 'heartbeat_ack' | 'pong' | 'active' | 'error' | 'transcription_error'
  session_id?: string
  segment_id?: string
  text?: string
  message?: string  // ç”¨æ–¼é€£æ¥ç¢ºèªè¨Šæ¯æˆ–å®Œæˆé€šçŸ¥
  start_sequence?: number
  end_sequence?: number
  start_time?: number
  end_time?: number
  language?: string
  confidence?: number
  timestamp?: number
  phase?: 'waiting' | 'active'  // æ–°å¢ phase æ¬„ä½
  error_type?: string
  error_message?: string
  details?: any
}

// ACK/Missing è¨Šæ¯ä»‹é¢
export interface AckMissingMessage {
  ack: number
  missing: number[]
}

// WebSocket ç®¡ç†é¡åˆ¥
export class WebSocketManager {
  private ws: WebSocket | null = null
  private url: string
  private reconnectAttempts = 0
  private maxReconnectAttempts = 5
  private reconnectDelay = 1000
  private isManualClose = false

  constructor(url: string) {
    this.url = url
  }

  connect(): Promise<void> {
    return new Promise((resolve, reject) => {
      try {
        this.ws = new WebSocket(this.url)
        this.isManualClose = false

        this.ws.onopen = () => {
          console.log('âœ… WebSocket é€£æ¥æˆåŠŸ:', this.url)
          this.reconnectAttempts = 0
          resolve()
        }

        this.ws.onerror = (error) => {
          console.error('âŒ WebSocket é€£æ¥éŒ¯èª¤:', error)
          reject(error)
        }

        this.ws.onclose = (event) => {
          console.log('ğŸ”Œ WebSocket é€£æ¥é—œé–‰:', event.code, event.reason)

          if (!this.isManualClose && this.reconnectAttempts < this.maxReconnectAttempts) {
            this.reconnectAttempts++
            console.log(`ğŸ”„ å˜—è©¦é‡æ–°é€£æ¥ (${this.reconnectAttempts}/${this.maxReconnectAttempts})`)

            setTimeout(() => {
              this.connect()
            }, this.reconnectDelay * this.reconnectAttempts)
          }
        }
      } catch (error) {
        reject(error)
      }
    })
  }

  disconnect(): void {
    this.isManualClose = true
    if (this.ws) {
      this.ws.close()
      this.ws = null
    }
  }

  send(data: string | ArrayBuffer): void {
    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
      const dataInfo = data instanceof ArrayBuffer
        ? `Binary (${data.byteLength} bytes)`
        : `Text (${data.length} chars)`

      console.log('ğŸ“¡ [WebSocketManager] ç™¼é€è³‡æ–™', {
        type: dataInfo,
        url: this.url,
        readyState: this.ws.readyState,
        timestamp: new Date().toISOString()
      })

      this.ws.send(data)
    } else {
      console.warn('âš ï¸ WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ç™¼é€è³‡æ–™', {
        url: this.url,
        readyState: this.ws?.readyState || 'null'
      })
    }
  }

  onMessage(callback: (event: MessageEvent) => void): void {
    if (this.ws) {
      this.ws.onmessage = callback
    }
  }

  onClose(callback: (event: CloseEvent) => void): void {
    if (this.ws) {
      const originalOnClose = this.ws.onclose
      const ws = this.ws // ä¿å­˜å¼•ç”¨é¿å… null å•é¡Œ
      this.ws.onclose = (event) => {
        // å…ˆèª¿ç”¨æ–°çš„å›èª¿
        callback(event)
        // å†èª¿ç”¨åŸå§‹çš„è™•ç†å™¨
        if (originalOnClose) {
          originalOnClose.call(ws, event)
        }
      }
    }
  }

  get readyState(): number {
    return this.ws?.readyState ?? WebSocket.CLOSED
  }

  get isConnected(): boolean {
    return this.ws?.readyState === WebSocket.OPEN
  }
}

// éŸ³æª”ä¸Šå‚³ WebSocket ç®¡ç†
export class AudioUploadWebSocket extends WebSocketManager {
  private sequenceNumber = 0

  constructor(sessionId: string) {
    super(getWebSocketURL(`/ws/upload_audio/${sessionId}`))
  }

  uploadAudioChunk(audioBlob: Blob): void {
    console.log('ğŸ”Š [AudioUploadWebSocket] uploadAudioChunk è¢«èª¿ç”¨', {
      sequence: this.sequenceNumber,
      blobSize: audioBlob.size,
      wsState: this.readyState,
      isConnected: this.isConnected
    })

    if (!this.isConnected) {
      console.warn('âš ï¸ WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ä¸Šå‚³éŸ³æª”')
      return
    }

    // å»ºç«‹åŒ…å«åºè™Ÿçš„è³‡æ–™åŒ…
    const sequenceBuffer = new ArrayBuffer(4)
    const sequenceView = new DataView(sequenceBuffer)
    sequenceView.setUint32(0, this.sequenceNumber, true) // little-endian

    // åˆä½µåºè™Ÿå’ŒéŸ³æª”è³‡æ–™
    audioBlob.arrayBuffer().then(audioBuffer => {
      const combinedBuffer = new ArrayBuffer(sequenceBuffer.byteLength + audioBuffer.byteLength)
      const combinedView = new Uint8Array(combinedBuffer)

      combinedView.set(new Uint8Array(sequenceBuffer), 0)
      combinedView.set(new Uint8Array(audioBuffer), sequenceBuffer.byteLength)

      console.log('ğŸ”„ [AudioUploadWebSocket] æº–å‚™ç™¼é€ binary frame', {
        sequence: this.sequenceNumber,
        totalSize: combinedBuffer.byteLength,
        audioSize: audioBuffer.byteLength,
        sequenceSize: sequenceBuffer.byteLength
      })

      this.send(combinedBuffer)

      console.log(`âœ… [AudioUploadWebSocket] Binary frame å·²é€å‡º #${this.sequenceNumber}`, {
        size: `${audioBlob.size} bytes`,
        totalSize: `${combinedBuffer.byteLength} bytes`,
        timestamp: new Date().toISOString()
      })

      this.sequenceNumber++
    }).catch(error => {
      console.error('âŒ [AudioUploadWebSocket] è™•ç†éŸ³é »è³‡æ–™å¤±æ•—', {
        sequence: this.sequenceNumber,
        error: error.message || error
      })
    })
  }

  onAckMissing(callback: (data: AckMissingMessage) => void): void {
    this.onMessage((event) => {
      try {
        const message = JSON.parse(event.data)

        // æ ¹æ“šæ¶ˆæ¯é¡å‹é€²è¡Œåˆ†ç™¼
        switch (message.type) {
          case 'ack_missing':
            // ç¢ºèª data.missing å­˜åœ¨ä¸”æ˜¯é™£åˆ—
            if (message.missing && Array.isArray(message.missing)) {
              callback(message as AckMissingMessage)
            } else {
              console.error('âŒ æ”¶åˆ°çš„ ack_missing è¨Šæ¯æ ¼å¼ä¸æ­£ç¢º:', message)
            }
            break
          case 'ack':
            // è™•ç†éŸ³æª”åˆ‡ç‰‡ç¢ºèªè¨Šæ¯
            console.log('âœ… éŸ³æª”åˆ‡ç‰‡ç¢ºèª:', message.chunk_sequence || 'unknown')
            break
          case 'heartbeat_ack':
            // è™•ç†éŸ³æª”ä¸Šå‚³å¿ƒè·³ç¢ºèª
            console.log('ğŸ’“ éŸ³æª”ä¸Šå‚³å¿ƒè·³ç¢ºèª')
            break
          case 'connection_established':
            console.log('âœ… éŸ³æª”ä¸Šå‚³ WebSocket é€£æ¥å·²å»ºç«‹')
            break
          case 'error':
            console.error('âŒ éŸ³æª”ä¸Šå‚³æœå‹™ç«¯éŒ¯èª¤:', message.message)
            break
          default:
            console.warn('âš ï¸ æ”¶åˆ°æœªçŸ¥çš„éŸ³æª”ä¸Šå‚³è¨Šæ¯é¡å‹:', message.type)
        }
      } catch (error) {
        console.error('âŒ è§£æéŸ³æª”ä¸Šå‚³æœå‹™è¨Šæ¯å¤±æ•—:', error)
      }
    })
  }

  resetSequence(): void {
    this.sequenceNumber = 0
  }
}

// é€å­—ç¨¿æ¥æ”¶ WebSocket ç®¡ç† - ç°¡åŒ–ç‰ˆï¼Œåªè² è²¬åŸºç¤é€£æ¥
export class TranscriptWebSocket extends WebSocketManager {
  constructor(sessionId: string) {
    super(getWebSocketURL(`/ws/transcript_feed/${sessionId}`))
  }

  // è¨­å®šè¨Šæ¯è™•ç†å›èª¿
  onMessage(callback: (data: any) => void): void {
    super.onMessage((event) => {
      console.log('ğŸ”¥ [TranscriptWebSocket] åŸå§‹ WebSocket è¨Šæ¯:', {
        data: event.data,
        type: typeof event.data,
        length: event.data?.length,
        timestamp: new Date().toISOString()
      })

      try {
        const data = JSON.parse(event.data)
        console.log('âœ… [TranscriptWebSocket] JSON è§£ææˆåŠŸ:', {
          parsedData: data,
          dataType: data.type,
          sessionId: data.session_id
        })

        console.log('ğŸ¯ [TranscriptWebSocket] å³å°‡èª¿ç”¨ callback')
        callback(data)
        console.log('âœ… [TranscriptWebSocket] callback èª¿ç”¨å®Œæˆ')

      } catch (error) {
        console.error('âŒ TranscriptWebSocket è§£æè¨Šæ¯å¤±æ•—:', {
          error: error instanceof Error ? error.message : String(error),
          rawData: event.data
        })
      }
    })
  }

  // ç™¼é€ JSON è¨Šæ¯
  sendJson(message: any): void {
    if (this.isConnected) {
      this.send(JSON.stringify(message))
    }
  }
}

// WebSocket å·¥å» å‡½æ•¸
export const createAudioUploadWebSocket = (sessionId: string): AudioUploadWebSocket => {
  return new AudioUploadWebSocket(sessionId)
}

export const createTranscriptWebSocket = (sessionId: string): TranscriptWebSocket => {
  return new TranscriptWebSocket(sessionId)
}


# END FILE CONTENTS


# File: frontend/lib/transcript-manager-adapter.ts

"use client"

import { isFeatureEnabled } from './feature-flags'

/**
 * TranscriptManager é©é…å™¨
 *
 * æ ¹æ“šåŠŸèƒ½æ——æ¨™ `useRefactoredTranscriptManager` é¸æ“‡ä½¿ç”¨ï¼š
 * - æ–°çš„é‡æ§‹å¯¦ç¾ï¼ˆtranscript-manager-new.tsï¼‰
 * - èˆŠçš„å¯¦ç¾ï¼ˆtranscript-manager.tsï¼‰
 *
 * é€™å…è¨±æˆ‘å€‘é€²è¡Œå®‰å…¨çš„æ¼¸é€²å¼åˆ‡æ›å’Œæ¸¬è©¦
 */

// å®šç¾©é€šç”¨ä»‹é¢ï¼Œç¢ºä¿æ–°èˆŠå¯¦ç¾å…¼å®¹
export interface ITranscriptManager {
  connect(sessionId: string): Promise<void>
  disconnect(sessionId: string): Promise<void>
  disconnectAll(): Promise<void>
  isConnected(sessionId: string): boolean
  getConnectionCount(): number
}

let managerInstance: ITranscriptManager | null = null

/**
 * å–å¾— TranscriptManager å¯¦ä¾‹
 * æ ¹æ“šåŠŸèƒ½æ——æ¨™è‡ªå‹•é¸æ“‡å¯¦ç¾
 */
export async function getTranscriptManager(): Promise<ITranscriptManager> {
  const useRefactored = isFeatureEnabled('useRefactoredTranscriptManager')

  console.log(`ğŸ¯ [TranscriptManagerAdapter] ä½¿ç”¨ ${useRefactored ? 'æ–°' : 'èˆŠ'} å¯¦ç¾`)

  if (useRefactored) {
    // å‹•æ…‹å°å…¥æ–°å¯¦ç¾
    if (!managerInstance || !(managerInstance as any).isRefactored) {
      const { TranscriptManager } = await import('./transcript-manager-new')
      managerInstance = TranscriptManager.getInstance()
        ; (managerInstance as any).isRefactored = true
      console.log('âœ… [TranscriptManagerAdapter] å·²è¼‰å…¥é‡æ§‹å¾Œçš„ TranscriptManager')
    }
  } else {
    // å‹•æ…‹å°å…¥èˆŠå¯¦ç¾
    if (!managerInstance || (managerInstance as any).isRefactored) {
      const { transcriptManager } = await import('./transcript-manager')
      managerInstance = transcriptManager
        ; (managerInstance as any).isRefactored = false
      console.log('âœ… [TranscriptManagerAdapter] å·²è¼‰å…¥åŸå§‹ TranscriptManager')
    }
  }

  return managerInstance
}

/**
 * å¼·åˆ¶é‡æ–°è¼‰å…¥ TranscriptManagerï¼ˆç”¨æ–¼åŠŸèƒ½æ——æ¨™è®Šæ›´å¾Œï¼‰
 */
export async function reloadTranscriptManager(): Promise<ITranscriptManager> {
  // æ¸…ç†ç¾æœ‰å¯¦ä¾‹
  if (managerInstance) {
    try {
      await managerInstance.disconnectAll()
    } catch (error) {
      console.warn('âš ï¸ [TranscriptManagerAdapter] æ¸…ç†èˆŠå¯¦ä¾‹æ™‚ç™¼ç”ŸéŒ¯èª¤:', error)
    }
  }

  managerInstance = null
  return getTranscriptManager()
}

/**
 * ä¾¿åˆ©å‡½æ•¸ï¼šå–å¾—ç•¶å‰ä½¿ç”¨çš„å¯¦ç¾é¡å‹
 */
export function getCurrentImplementation(): 'refactored' | 'legacy' {
  return isFeatureEnabled('useRefactoredTranscriptManager') ? 'refactored' : 'legacy'
}

/**
 * ä¾¿åˆ©å‡½æ•¸ï¼šåˆ‡æ›å¯¦ç¾ä¸¦é‡æ–°è¼‰å…¥
 */
export async function switchImplementation(useRefactored: boolean): Promise<ITranscriptManager> {
  const { enableFeature, disableFeature } = await import('./feature-flags')

  if (useRefactored) {
    enableFeature('useRefactoredTranscriptManager')
  } else {
    disableFeature('useRefactoredTranscriptManager')
  }

  return reloadTranscriptManager()
}

// æš´éœ²åˆ° window ä¾›èª¿è©¦ä½¿ç”¨
if (typeof window !== 'undefined') {
  (window as any).transcriptManagerAdapter = {
    getCurrentImplementation,
    switchToRefactored: () => switchImplementation(true),
    switchToLegacy: () => switchImplementation(false),
    reload: reloadTranscriptManager,
    getManager: getTranscriptManager,
  }

  console.log('ğŸ¯ [TranscriptManagerAdapter] èª¿è©¦ä»‹é¢å·²æš´éœ²åˆ° window.transcriptManagerAdapter')
  console.log('   åˆ‡æ›åˆ°æ–°å¯¦ç¾: window.transcriptManagerAdapter.switchToRefactored()')
  console.log('   åˆ‡æ›åˆ°èˆŠå¯¦ç¾: window.transcriptManagerAdapter.switchToLegacy()')
}


# END FILE CONTENTS


# File: frontend/lib/services/index.ts

"use client"

/**
 * æœå‹™å±¤çµ±ä¸€å…¥å£
 *
 * æä¾›æœå‹™å±¤æ‰€æœ‰æ¨¡çµ„çš„çµ±ä¸€åŒ¯å‡º
 */

// åŸºç¤æœå‹™é¡åˆ¥
export { BaseService, ServiceError } from './base-service'
export type { ServiceStatus } from './base-service'

// æœå‹™å®¹å™¨
export { ServiceContainer, ServiceContainerError, serviceContainer } from './service-container'
export type {
    ServiceContainerStatus,
    ServiceInitializationResult,
    ServiceCleanupResult
} from './service-container'

// å…·é«”æœå‹™å¯¦ç¾
export { SessionService } from './session-service'
export type { SessionServiceStatus } from './session-service'

export { RecordingService } from './recording-service'
export type { RecordingServiceStatus } from './recording-service'

export { TranscriptService } from './transcript-service'

// æœå‹™è¨»å†Š
export { ServiceRegistry } from './service-registry'

// æœå‹™ä»‹é¢å’Œéµå€¼
export type {
    ISessionService,
    IRecordingService,
    ITranscriptService,
    IServiceContainer,
    RecordingState,
    TranscriptMessage,
    TranscriptEntry,
    ServiceKey,
    ServiceTypeMap
} from './interfaces'

export { SERVICE_KEYS } from './interfaces'


# END FILE CONTENTS


# File: frontend/playwright.config.ts

import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
    testDir: '../tests/frontend',
    outputDir: '../tests/frontend/test-results',
    timeout: 60000,
    use: {
        headless: true,
        baseURL: 'http://localhost:3100',
    },
    webServer: {
        command: 'pnpm dev --port 3100',
        url: 'http://localhost:3100',
        timeout: 120000,
        reuseExistingServer: !process.env.CI,
        cwd: '.',
    },
    projects: [
        {
            name: 'chromium',
            use: { ...devices['Desktop Chrome'] },
        },
    ],
})


# END FILE CONTENTS


# File: frontend/components/ui/progress.tsx

"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }


# END FILE CONTENTS


# File: frontend/lib/app-store.ts

"use client"

import { useState, useCallback, useRef } from 'react'
import { serviceContainer, SERVICE_KEYS } from './services'
import type { RecordingFlowService, RecordingFlowListener } from './services/recording-flow-service'
import type { SessionResponse } from './api'
import { AppState, SessionStatus, SessionType, TranscriptEntry } from '../types/app-state'

/**
 * Store ç‹€æ…‹ä»‹é¢
 */
export interface AppStoreState {
  // æ‡‰ç”¨ç‹€æ…‹
  currentState: AppState
  isLoading: boolean
  error: string | null

  // æœƒè©±ç‹€æ…‹
  session: {
    id: string
    status: SessionStatus
    type: SessionType
  } | null

  // éŒ„éŸ³ç‹€æ…‹
  isRecording: boolean
  recordingTime: number

  // é€å­—ç¨¿ç‹€æ…‹
  transcriptEntries: TranscriptEntry[]

  // ç·¨è¼¯å™¨ç‹€æ…‹
  editorContent: string
}

/**
 * Store æ“ä½œä»‹é¢
 */
export interface AppStoreActions {
  // æ ¸å¿ƒæ¥­å‹™æ“ä½œ
  startRecording: (title?: string) => Promise<void>
  stopRecording: () => Promise<void>

  // ç·¨è¼¯å™¨æ“ä½œ
  updateEditorContent: (content: string) => void

  // ç‹€æ…‹é‡ç½®
  resetState: () => void

  // éŒ¯èª¤è™•ç†
  clearError: () => void
}

/**
 * Store Hook è¿”å›å€¼
 */
export interface AppStoreReturn {
  state: AppStoreState
  actions: AppStoreActions
}

/**
 * AppStore - çµ±ä¸€çš„ç‹€æ…‹ç®¡ç†
 *
 * è·è²¬ï¼š
 * 1. ç®¡ç†æ‡‰ç”¨ç‹€æ…‹
 * 2. èª¿ç”¨æœå‹™å±¤åŸ·è¡Œæ¥­å‹™é‚è¼¯
 * 3. è™•ç† loading å’ŒéŒ¯èª¤ç‹€æ…‹
 * 4. æä¾›ç°¡æ½”çš„ API çµ¦ UI å±¤
 */
export function useAppStore(): AppStoreReturn {
  // === ç‹€æ…‹å®šç¾© ===
  const [currentState, setCurrentState] = useState<AppState>('default')
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [session, setSession] = useState<AppStoreState['session']>(null)
  const [isRecording, setIsRecording] = useState(false)
  const [recordingTime, setRecordingTime] = useState(0)
  const [transcriptEntries, setTranscriptEntries] = useState<TranscriptEntry[]>([])
  const [editorContent, setEditorContent] = useState('')

  // === æœå‹™å¼•ç”¨ ===
  const recordingFlowServiceRef = useRef<RecordingFlowService | null>(null)
  const flowListenerRef = useRef<RecordingFlowListener | null>(null)

  // === åˆå§‹åŒ–æœå‹™ ===
  const initializeRecordingFlowService = useCallback(() => {
    if (!recordingFlowServiceRef.current) {
      recordingFlowServiceRef.current = serviceContainer.resolve<RecordingFlowService>(
        SERVICE_KEYS.RECORDING_FLOW_SERVICE
      )
    }
    return recordingFlowServiceRef.current
  }, [])

  // === æµç¨‹ç›£è½å™¨ ===
  const createFlowListener = useCallback((): RecordingFlowListener => {
    return {
      onTranscriptReceived: (transcript) => {
        console.log('ğŸ“ [AppStore] æ”¶åˆ°é€å­—ç¨¿:', transcript)
        setTranscriptEntries(prev => [...prev, transcript])
      },

      onFirstTranscriptReceived: () => {
        console.log('ğŸ¯ [AppStore] æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿ï¼Œè½‰æ›ç‹€æ…‹')
        setCurrentState('recording_active')
      },

      onRecordingStatusChange: (recording) => {
        console.log('ï¿½ï¿½ [AppStore] éŒ„éŸ³ç‹€æ…‹è®Šæ›´:', recording)
        setIsRecording(recording)
      },

      onTranscriptComplete: () => {
        console.log('âœ… [AppStore] é€å­—ç¨¿è½‰éŒ„å®Œæˆ')
        setCurrentState('finished')
      },

      onError: (errorMessage) => {
        console.error('âŒ [AppStore] éŒ„éŸ³æµç¨‹éŒ¯èª¤:', errorMessage)
        setError(errorMessage)
        setIsLoading(false)
        setCurrentState('default')
      }
    }
  }, [])

  // === éŒ„éŸ³æ™‚é–“è¿½è¹¤ ===
  const startRecordingTimeTracking = useCallback(() => {
    const interval = setInterval(() => {
      const service = recordingFlowServiceRef.current
      if (service && service.isActive()) {
        const time = service.getRecordingTime()
        setRecordingTime(time)
      } else {
        clearInterval(interval)
      }
    }, 1000)

    return interval
  }, [])

  // === æ¥­å‹™æ“ä½œ ===

  /**
   * é–‹å§‹éŒ„éŸ³æµç¨‹
   */
  const startRecording = useCallback(async (title?: string): Promise<void> => {
    console.log('ğŸ¤ [AppStore] é–‹å§‹éŒ„éŸ³æµç¨‹')

    try {
      // 1. è¨­ç½® loading ç‹€æ…‹
      setIsLoading(true)
      setError(null)
      setCurrentState('recording_waiting')

      // 2. åˆå§‹åŒ–æœå‹™
      const recordingFlowService = initializeRecordingFlowService()

      // 3. è¨­ç½®æµç¨‹ç›£è½å™¨
      if (flowListenerRef.current) {
        recordingFlowService.removeListener(flowListenerRef.current)
      }
      flowListenerRef.current = createFlowListener()
      recordingFlowService.addListener(flowListenerRef.current)

      // 4. å•Ÿå‹•éŒ„éŸ³æµç¨‹
      const result: RecordingFlowResult = await recordingFlowService.startRecordingFlow(title)

      if (result.success) {
        // æˆåŠŸï¼šæ›´æ–°æœƒè©±è³‡è¨Šå’Œç‹€æ…‹
        setSession({
          id: result.sessionId,
          status: 'active' as SessionStatus,
          type: 'recording' as SessionType
        })

        setCurrentState('recording_waiting')

        // å•Ÿå‹•æ™‚é–“è¿½è¹¤
        startRecordingTimeTracking()

        console.log('âœ… [AppStore] éŒ„éŸ³æµç¨‹å•Ÿå‹•æˆåŠŸ:', result.sessionId)
      } else {
        // å¤±æ•—ï¼šé¡¯ç¤ºéŒ¯èª¤
        throw new Error(result.error || 'éŒ„éŸ³æµç¨‹å•Ÿå‹•å¤±æ•—')
      }

    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      console.error('âŒ [AppStore] éŒ„éŸ³æµç¨‹å•Ÿå‹•å¤±æ•—:', error)

      setError(errorMessage)
      setCurrentState('default')
    } finally {
      setIsLoading(false)
    }
  }, [initializeRecordingFlowService, createFlowListener, startRecordingTimeTracking])

  /**
   * åœæ­¢éŒ„éŸ³æµç¨‹
   */
  const stopRecording = useCallback(async (): Promise<void> => {
    console.log('ğŸ›‘ [AppStore] åœæ­¢éŒ„éŸ³æµç¨‹')

    try {
      setIsLoading(true)
      setCurrentState('processing')

      const recordingFlowService = recordingFlowServiceRef.current
      if (recordingFlowService) {
        await recordingFlowService.stopRecordingFlow()

        // æ¸…ç†ç›£è½å™¨
        if (flowListenerRef.current) {
          recordingFlowService.removeListener(flowListenerRef.current)
          flowListenerRef.current = null
        }
      }

      // æ›´æ–°ç‹€æ…‹
      setIsRecording(false)
      setCurrentState('finished')

      console.log('âœ… [AppStore] éŒ„éŸ³æµç¨‹åœæ­¢æˆåŠŸ')

    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      console.error('âŒ [AppStore] åœæ­¢éŒ„éŸ³å¤±æ•—:', error)
      setError(errorMessage)
    } finally {
      setIsLoading(false)
    }
  }, [])

  /**
   * æ›´æ–°ç·¨è¼¯å™¨å…§å®¹
   */
  const updateEditorContent = useCallback((content: string) => {
    setEditorContent(content)
  }, [])

  /**
   * é‡ç½®ç‹€æ…‹
   */
  const resetState = useCallback(() => {
    console.log('ğŸ”„ [AppStore] é‡ç½®ç‹€æ…‹')

    // åœæ­¢éŒ„éŸ³æµç¨‹ï¼ˆå¦‚æœæœ‰ï¼‰
    const recordingFlowService = recordingFlowServiceRef.current
    if (recordingFlowService && recordingFlowService.isActive()) {
      recordingFlowService.stopRecordingFlow().catch(console.error)
    }

    // é‡ç½®æ‰€æœ‰ç‹€æ…‹
    setCurrentState('default')
    setIsLoading(false)
    setError(null)
    setSession(null)
    setIsRecording(false)
    setRecordingTime(0)
    setTranscriptEntries([])
    setEditorContent('')
  }, [])

  /**
   * æ¸…é™¤éŒ¯èª¤
   */
  const clearError = useCallback(() => {
    setError(null)
  }, [])

  // === è¿”å› Store ç‹€æ…‹å’Œæ“ä½œ ===
  return {
    state: {
      currentState,
      isLoading,
      error,
      session,
      isRecording,
      recordingTime,
      transcriptEntries,
      editorContent
    },
    actions: {
      startRecording,
      stopRecording,
      updateEditorContent,
      resetState,
      clearError
    }
  }
}


# END FILE CONTENTS


# END FILE CONTENTS


# File: frontend/refresh.ts



# END FILE CONTENTS


# File: frontend/e2e/offline-recovery.spec.ts

import { test, expect } from '@playwright/test'

test('offline 30s then online resumes', async ({ page }) => {
    await page.goto('/')
    await page.evaluate(() => window.dispatchEvent(new Event('offline')))
    await page.waitForTimeout(30_000)        // éŒ„éŸ³ & æ–·ç¶²
    await page.evaluate(() => window.dispatchEvent(new Event('online')))

    await expect(page.getByText('æš«å­˜æ®µè½å·²å…¨éƒ¨ä¸Šå‚³å®Œæˆ')).toBeVisible()
})


# END FILE CONTENTS


# File: pyproject.toml

[project]
name = "study-scriber"
version = "0.1.0"
description = "Cloud note tool: record, real-time transcript, Markdown notes & export as ZIP."
readme = "README.md"
requires-python = ">=3.12"
dependencies = [
    "fastapi",
    "uvicorn[standard]",
    "pydantic",
    "pydantic-settings",
    "python-dotenv",
    "psycopg2-binary",
    "uvloop",
    "httpx",
    "aiohttp",
    "loguru",
    "supabase",
    "gotrue",
    "postgrest",
    "realtime",
    "storage3",
    "openai",
    "aiofiles",
    "python-multipart",
    "google-generativeai",  # æä¾› google.generativeai.GenerativeModel
    # Task 5: ç›£æ§ä¾è³´
    "prometheus-client",
    # æ¸¬è©¦ä¾è³´
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
    "pytest-cov>=4.0.0",
]

[tool.setuptools.packages.find]
include = ["app*"]

[tool.pytest.ini_options]
addopts = "--cov=app"


# END FILE CONTENTS


# File: .cursor/rules/ui-rules/create-prototype.mdc

---
description:
globs:
alwaysApply: false
---
# Prototype Creation Rule (for Cursor)

Trigger phrases (case-insensitive)
â€¢ â€œcreate a new prototypeâ€
â€¢ â€œmake a new prototypeâ€
â€¢ â€œcreate prototypeâ€
â€¢ â€œmake prototypeâ€
â€¢ any similar wording

---

## Workflow

1. **Ask for a name (if missing)**
   If the request does **not** include a prototype name, prompt:
   > â€œWhat should the prototype be called?â€

2. **Copy the template**
   Duplicate `app/prototypes/_template` â†’ `app/prototypes/<prototype-name>`.

3. **Create / modify core files** inside the new folder:
   â€¢ `page.tsx`
   â€¢ `styles.module.css`
   â€¢ any additional components or utilities required

4. **Install dependencies** (only if new packages are needed)
   ```bash
   pnpm add <package>
   # or: npm i <package> / yarn add <package>
5.	Register on the homepage
In â app/page.tsx (or wherever the prototypes array lives), append:
{
  path: "/prototypes/<prototype-name>",
  label: "<Prototype Name>"
}
6.	Manual test
â€¢ Start the dev server
â€¢ Confirm the homepage link works
â€¢ Confirm the prototype page renders with no TypeScript / ESLint errors

---

All steps must succeed without errors before the task is considered complete.


# END FILE CONTENTS


# File: frontend/lib/feature-flags.ts

"use client"

// åŠŸèƒ½é–‹é—œé…ç½®
export interface FeatureFlags {
  useNewStateManagement: boolean
  useNewRecordingHook: boolean
  useNewSessionHook: boolean
  useNewTranscriptHook: boolean
  useNewAppStateHook: boolean
  useSimpleRecordingService: boolean  // ğŸ”§ Phase 2.5: ä½¿ç”¨é€²éšéŒ„éŸ³æœå‹™ (AdvancedAudioRecorder)
  enableStateSync: boolean
  enableDebugLogging: boolean
}

// é è¨­åŠŸèƒ½é–‹é—œè¨­å®šï¼ˆæ–°æ¨¡å¼å•Ÿç”¨ï¼‰
const defaultFeatureFlags: FeatureFlags = {
  useNewStateManagement: true,   // ğŸ†• å•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç†
  useNewRecordingHook: true,     // ğŸ†• å•Ÿç”¨æ–° recording hook
  useNewSessionHook: true,       // ğŸ†• å•Ÿç”¨æ–° session hook
  useNewTranscriptHook: true,    // ğŸ†• å•Ÿç”¨æ–° transcript hook
  useNewAppStateHook: true,      // ğŸ†• å•Ÿç”¨æ–° app state hook
  useSimpleRecordingService: true, // ğŸ”§ Phase 2.5: å•Ÿç”¨é€²éšéŒ„éŸ³æœå‹™ (ä¿®å¾© WebM Header)
  enableStateSync: true,         // é è¨­é–‹å•Ÿç‹€æ…‹åŒæ­¥
  enableDebugLogging: true,      // é è¨­é–‹å•Ÿèª¿è©¦æ—¥èªŒ
}

// å¾ localStorage è®€å–åŠŸèƒ½é–‹é—œè¨­å®š
function loadFeatureFlags(): FeatureFlags {
  if (typeof window === 'undefined') {
    return defaultFeatureFlags
  }

  try {
    const stored = localStorage.getItem('study-scriber-feature-flags')
    if (stored) {
      const parsed = JSON.parse(stored)
      return { ...defaultFeatureFlags, ...parsed }
    }
  } catch (error) {
    console.warn('ğŸš© [FeatureFlags] è®€å–åŠŸèƒ½é–‹é—œå¤±æ•—:', error)
  }

  return defaultFeatureFlags
}

// å„²å­˜åŠŸèƒ½é–‹é—œè¨­å®šåˆ° localStorage
function saveFeatureFlags(flags: Partial<FeatureFlags>): void {
  if (typeof window === 'undefined') return

  try {
    const current = loadFeatureFlags()
    const updated = { ...current, ...flags }
    localStorage.setItem('study-scriber-feature-flags', JSON.stringify(updated))
    console.log('ğŸš© [FeatureFlags] åŠŸèƒ½é–‹é—œå·²æ›´æ–°:', updated)
  } catch (error) {
    console.error('ğŸš© [FeatureFlags] å„²å­˜åŠŸèƒ½é–‹é—œå¤±æ•—:', error)
  }
}

// åŠŸèƒ½é–‹é—œç®¡ç†å™¨
class FeatureFlagManager {
  private flags: FeatureFlags

  constructor() {
    this.flags = loadFeatureFlags()
    this.exposeToWindow()
  }

  // æª¢æŸ¥åŠŸèƒ½æ˜¯å¦å•Ÿç”¨
  isEnabled(flag: keyof FeatureFlags): boolean {
    return this.flags[flag]
  }

  // å•Ÿç”¨åŠŸèƒ½
  enable(flag: keyof FeatureFlags): void {
    this.updateFlag(flag, true)
  }

  // åœç”¨åŠŸèƒ½
  disable(flag: keyof FeatureFlags): void {
    this.updateFlag(flag, false)
  }

  // åˆ‡æ›åŠŸèƒ½ç‹€æ…‹
  toggle(flag: keyof FeatureFlags): void {
    this.updateFlag(flag, !this.flags[flag])
  }

  // æ›´æ–°å–®ä¸€åŠŸèƒ½é–‹é—œ
  private updateFlag(flag: keyof FeatureFlags, value: boolean): void {
    this.flags = { ...this.flags, [flag]: value }
    saveFeatureFlags({ [flag]: value })

    console.log(`ğŸš© [FeatureFlags] ${flag}: ${value ? 'å•Ÿç”¨' : 'åœç”¨'}`)

    // å¦‚æœæ˜¯é—œéµåŠŸèƒ½ï¼Œçµ¦äºˆè­¦å‘Š
    if (flag === 'useNewStateManagement' && value) {
      console.warn('âš ï¸ [FeatureFlags] æ–°ç‹€æ…‹ç®¡ç†ç³»çµ±å·²å•Ÿç”¨ï¼Œè«‹ç¢ºä¿å·²å®Œæˆæ¸¬è©¦')
    }
  }

  // æ‰¹æ¬¡æ›´æ–°åŠŸèƒ½é–‹é—œ
  updateFlags(updates: Partial<FeatureFlags>): void {
    this.flags = { ...this.flags, ...updates }
    saveFeatureFlags(updates)
    console.log('ğŸš© [FeatureFlags] æ‰¹æ¬¡æ›´æ–°å®Œæˆ:', updates)
  }

  // é‡ç½®æ‰€æœ‰åŠŸèƒ½é–‹é—œ
  reset(): void {
    this.flags = defaultFeatureFlags
    if (typeof window !== 'undefined') {
      localStorage.removeItem('study-scriber-feature-flags')
    }
    console.log('ğŸš© [FeatureFlags] å·²é‡ç½®ç‚ºé è¨­å€¼')
  }

  // å–å¾—ç•¶å‰æ‰€æœ‰åŠŸèƒ½é–‹é—œç‹€æ…‹
  getAll(): FeatureFlags {
    return { ...this.flags }
  }

  // æš´éœ²åˆ° window ä¾›èª¿è©¦ä½¿ç”¨
  private exposeToWindow(): void {
    if (typeof window !== 'undefined') {
      (window as any).featureFlags = {
        enable: (flag: keyof FeatureFlags) => this.enable(flag),
        disable: (flag: keyof FeatureFlags) => this.disable(flag),
        toggle: (flag: keyof FeatureFlags) => this.toggle(flag),
        isEnabled: (flag: keyof FeatureFlags) => this.isEnabled(flag),
        getAll: () => this.getAll(),
        reset: () => this.reset(),

        // ä¾¿åˆ©æ–¹æ³•
        enableNewState: () => this.enable('useNewStateManagement'),
        disableNewState: () => this.disable('useNewStateManagement'),
        enableAll: () => this.updateFlags({
          useNewStateManagement: true,
          useNewRecordingHook: true,
          useNewSessionHook: true,
          useNewTranscriptHook: true,
          useNewAppStateHook: true,
        }),
        disableAll: () => this.updateFlags({
          useNewStateManagement: false,
          useNewRecordingHook: false,
          useNewSessionHook: false,
          useNewTranscriptHook: false,
          useNewAppStateHook: false,
        }),
      }

      console.log('ğŸš© [FeatureFlags] èª¿è©¦ä»‹é¢å·²æš´éœ²åˆ° window.featureFlags')
      console.log('   ä½¿ç”¨æ–¹æ³•: window.featureFlags.enableNewState()')
      console.log('   æŸ¥çœ‹ç‹€æ…‹: window.featureFlags.getAll()')
    }
  }
}

// å–®ä¾‹æ¨¡å¼
export const featureFlagManager = new FeatureFlagManager()

// ä¾¿åˆ©å‡½æ•¸
export const isFeatureEnabled = (flag: keyof FeatureFlags): boolean =>
  featureFlagManager.isEnabled(flag)

export const enableFeature = (flag: keyof FeatureFlags): void =>
  featureFlagManager.enable(flag)

export const disableFeature = (flag: keyof FeatureFlags): void =>
  featureFlagManager.disable(flag)


# END FILE CONTENTS


# File: frontend/lib/websocket.ts

"use client"

import { getWebSocketURL } from './api'

// WebSocket é€£æ¥ç‹€æ…‹
export type WebSocketState = 'connecting' | 'connected' | 'disconnected' | 'error'

// é€å­—ç¨¿æ¥æ”¶ä»‹é¢ (èˆ‡å¾Œç«¯æ¨é€æ ¼å¼ä¸€è‡´)
export interface TranscriptMessage {
  type: 'transcript_segment' | 'transcript_complete' | 'connection_established' | 'heartbeat_ack' | 'pong' | 'active' | 'error' | 'transcription_error'
  session_id?: string
  segment_id?: string
  text?: string
  message?: string  // ç”¨æ–¼é€£æ¥ç¢ºèªè¨Šæ¯æˆ–å®Œæˆé€šçŸ¥
  start_sequence?: number
  end_sequence?: number
  start_time?: number
  end_time?: number
  language?: string
  confidence?: number
  timestamp?: number
  phase?: 'waiting' | 'active'  // æ–°å¢ phase æ¬„ä½
  error_type?: string
  error_message?: string
  details?: any
}

// ACK/Missing è¨Šæ¯ä»‹é¢
export interface AckMissingMessage {
  ack: number
  missing: number[]
}

// WebSocket ç®¡ç†é¡åˆ¥
export class WebSocketManager {
  private ws: WebSocket | null = null
  private url: string
  private reconnectAttempts = 0
  private maxReconnectAttempts = 5
  private reconnectDelay = 1000
  private isManualClose = false

  constructor(url: string) {
    this.url = url
  }

  connect(): Promise<void> {
    return new Promise((resolve, reject) => {
      try {
        this.ws = new WebSocket(this.url)
        this.isManualClose = false

        this.ws.onopen = () => {
          console.log('âœ… WebSocket é€£æ¥æˆåŠŸ:', this.url)
          this.reconnectAttempts = 0
          resolve()
        }

        this.ws.onerror = (error) => {
          console.error('âŒ WebSocket é€£æ¥éŒ¯èª¤:', error)
          reject(error)
        }

        this.ws.onclose = (event) => {
          console.log('ğŸ”Œ WebSocket é€£æ¥é—œé–‰:', event.code, event.reason)

          if (!this.isManualClose && this.reconnectAttempts < this.maxReconnectAttempts) {
            this.reconnectAttempts++
            console.log(`ğŸ”„ å˜—è©¦é‡æ–°é€£æ¥ (${this.reconnectAttempts}/${this.maxReconnectAttempts})`)

            setTimeout(() => {
              this.connect()
            }, this.reconnectDelay * this.reconnectAttempts)
          }
        }
      } catch (error) {
        reject(error)
      }
    })
  }

  disconnect(): void {
    this.isManualClose = true
    if (this.ws) {
      this.ws.close()
      this.ws = null
    }
  }

  send(data: string | ArrayBuffer): void {
    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
      const dataInfo = data instanceof ArrayBuffer
        ? `Binary (${data.byteLength} bytes)`
        : `Text (${data.length} chars)`

      console.log('ğŸ“¡ [WebSocketManager] ç™¼é€è³‡æ–™', {
        type: dataInfo,
        url: this.url,
        readyState: this.ws.readyState,
        timestamp: new Date().toISOString()
      })

      this.ws.send(data)
    } else {
      console.warn('âš ï¸ WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ç™¼é€è³‡æ–™', {
        url: this.url,
        readyState: this.ws?.readyState || 'null'
      })
    }
  }

  onMessage(callback: (event: MessageEvent) => void): void {
    if (this.ws) {
      this.ws.onmessage = callback
    }
  }

  onClose(callback: (event: CloseEvent) => void): void {
    if (this.ws) {
      const originalOnClose = this.ws.onclose
      const ws = this.ws // ä¿å­˜å¼•ç”¨é¿å… null å•é¡Œ
      this.ws.onclose = (event) => {
        // å…ˆèª¿ç”¨æ–°çš„å›èª¿
        callback(event)
        // å†èª¿ç”¨åŸå§‹çš„è™•ç†å™¨
        if (originalOnClose) {
          originalOnClose.call(ws, event)
        }
      }
    }
  }

  get readyState(): number {
    return this.ws?.readyState ?? WebSocket.CLOSED
  }

  get isConnected(): boolean {
    return this.ws?.readyState === WebSocket.OPEN
  }
}

// éŸ³æª”ä¸Šå‚³ WebSocket ç®¡ç†
export class AudioUploadWebSocket extends WebSocketManager {
  private sequenceNumber = 0

  constructor(sessionId: string) {
    super(getWebSocketURL(`/ws/upload_audio/${sessionId}`))
  }

  uploadAudioChunk(audioBlob: Blob): void {
    console.log('ğŸ”Š [AudioUploadWebSocket] uploadAudioChunk è¢«èª¿ç”¨', {
      sequence: this.sequenceNumber,
      blobSize: audioBlob.size,
      wsState: this.readyState,
      isConnected: this.isConnected
    })

    if (!this.isConnected) {
      console.warn('âš ï¸ WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ä¸Šå‚³éŸ³æª”')
      return
    }

    // å»ºç«‹åŒ…å«åºè™Ÿçš„è³‡æ–™åŒ…
    const sequenceBuffer = new ArrayBuffer(4)
    const sequenceView = new DataView(sequenceBuffer)
    sequenceView.setUint32(0, this.sequenceNumber, true) // little-endian

    // åˆä½µåºè™Ÿå’ŒéŸ³æª”è³‡æ–™
    audioBlob.arrayBuffer().then(audioBuffer => {
      const combinedBuffer = new ArrayBuffer(sequenceBuffer.byteLength + audioBuffer.byteLength)
      const combinedView = new Uint8Array(combinedBuffer)

      combinedView.set(new Uint8Array(sequenceBuffer), 0)
      combinedView.set(new Uint8Array(audioBuffer), sequenceBuffer.byteLength)

      console.log('ğŸ”„ [AudioUploadWebSocket] æº–å‚™ç™¼é€ binary frame', {
        sequence: this.sequenceNumber,
        totalSize: combinedBuffer.byteLength,
        audioSize: audioBuffer.byteLength,
        sequenceSize: sequenceBuffer.byteLength
      })

      this.send(combinedBuffer)

      console.log(`âœ… [AudioUploadWebSocket] Binary frame å·²é€å‡º #${this.sequenceNumber}`, {
        size: `${audioBlob.size} bytes`,
        totalSize: `${combinedBuffer.byteLength} bytes`,
        timestamp: new Date().toISOString()
      })

      this.sequenceNumber++
    }).catch(error => {
      console.error('âŒ [AudioUploadWebSocket] è™•ç†éŸ³é »è³‡æ–™å¤±æ•—', {
        sequence: this.sequenceNumber,
        error: error.message || error
      })
    })
  }

  onAckMissing(callback: (data: AckMissingMessage) => void): void {
    this.onMessage((event) => {
      try {
        const message = JSON.parse(event.data)

        // æ ¹æ“šæ¶ˆæ¯é¡å‹é€²è¡Œåˆ†ç™¼
        switch (message.type) {
          case 'ack_missing':
            // ç¢ºèª data.missing å­˜åœ¨ä¸”æ˜¯é™£åˆ—
            if (message.missing && Array.isArray(message.missing)) {
              callback(message as AckMissingMessage)
            } else {
              console.error('âŒ æ”¶åˆ°çš„ ack_missing è¨Šæ¯æ ¼å¼ä¸æ­£ç¢º:', message)
            }
            break
          case 'ack':
            // è™•ç†éŸ³æª”åˆ‡ç‰‡ç¢ºèªè¨Šæ¯
            console.log('âœ… éŸ³æª”åˆ‡ç‰‡ç¢ºèª:', message.chunk_sequence || 'unknown')
            break
          case 'heartbeat_ack':
            // è™•ç†éŸ³æª”ä¸Šå‚³å¿ƒè·³ç¢ºèª
            console.log('ğŸ’“ éŸ³æª”ä¸Šå‚³å¿ƒè·³ç¢ºèª')
            break
          case 'connection_established':
            console.log('âœ… éŸ³æª”ä¸Šå‚³ WebSocket é€£æ¥å·²å»ºç«‹')
            break
          case 'error':
            console.error('âŒ éŸ³æª”ä¸Šå‚³æœå‹™ç«¯éŒ¯èª¤:', message.message)
            break
          default:
            console.warn('âš ï¸ æ”¶åˆ°æœªçŸ¥çš„éŸ³æª”ä¸Šå‚³è¨Šæ¯é¡å‹:', message.type)
        }
      } catch (error) {
        console.error('âŒ è§£æéŸ³æª”ä¸Šå‚³æœå‹™è¨Šæ¯å¤±æ•—:', error)
      }
    })
  }

  resetSequence(): void {
    this.sequenceNumber = 0
  }
}

// é€å­—ç¨¿æ¥æ”¶ WebSocket ç®¡ç† - ç°¡åŒ–ç‰ˆï¼Œåªè² è²¬åŸºç¤é€£æ¥
export class TranscriptWebSocket extends WebSocketManager {
  constructor(sessionId: string) {
    super(getWebSocketURL(`/ws/transcript_feed/${sessionId}`))
  }

  // è¨­å®šè¨Šæ¯è™•ç†å›èª¿
  onMessage(callback: (data: any) => void): void {
    super.onMessage((event) => {
      console.log('ğŸ”¥ [TranscriptWebSocket] åŸå§‹ WebSocket è¨Šæ¯:', {
        data: event.data,
        type: typeof event.data,
        length: event.data?.length,
        timestamp: new Date().toISOString()
      })

      try {
        const data = JSON.parse(event.data)
        console.log('âœ… [TranscriptWebSocket] JSON è§£ææˆåŠŸ:', {
          parsedData: data,
          dataType: data.type,
          sessionId: data.session_id
        })

        console.log('ğŸ¯ [TranscriptWebSocket] å³å°‡èª¿ç”¨ callback')
        callback(data)
        console.log('âœ… [TranscriptWebSocket] callback èª¿ç”¨å®Œæˆ')

      } catch (error) {
        console.error('âŒ TranscriptWebSocket è§£æè¨Šæ¯å¤±æ•—:', {
          error: error instanceof Error ? error.message : String(error),
          rawData: event.data
        })
      }
    })
  }

  // ç™¼é€ JSON è¨Šæ¯
  sendJson(message: any): void {
    if (this.isConnected) {
      this.send(JSON.stringify(message))
    }
  }
}

// WebSocket å·¥å» å‡½æ•¸
export const createAudioUploadWebSocket = (sessionId: string): AudioUploadWebSocket => {
  return new AudioUploadWebSocket(sessionId)
}

export const createTranscriptWebSocket = (sessionId: string): TranscriptWebSocket => {
  return new TranscriptWebSocket(sessionId)
}


# END FILE CONTENTS


# File: frontend/lib/__tests__/segmented-audio-recorder.test.ts

import { describe, test, expect, beforeEach, vi, afterEach } from 'vitest'
import { SegmentedAudioRecorder, checkSegmentedAudioRecordingSupport } from '../segmented-audio-recorder'

// Mock navigator.mediaDevices
const mockGetUserMedia = vi.fn()
Object.defineProperty(navigator, 'mediaDevices', {
    writable: true,
    value: {
        getUserMedia: mockGetUserMedia,
    },
})

// Mock MediaRecorder
const mockStart = vi.fn()
const mockStop = vi.fn()
const mockRequestData = vi.fn()

class MockMediaRecorder {
    start = mockStart
    stop = mockStop
    requestData = mockRequestData
    state: string = 'inactive'
    ondataavailable: ((event: any) => void) | null = null
    onerror: ((event: any) => void) | null = null

    constructor(stream: any, options: any) {
        // Store for verification
    }

    static isTypeSupported = vi.fn().mockReturnValue(true)
}

Object.defineProperty(window, 'MediaRecorder', {
    writable: true,
    value: MockMediaRecorder,
})

// Mock stream
const mockTrack = { stop: vi.fn() }
const mockStream = {
    getTracks: vi.fn(() => [mockTrack])
}

describe('SegmentedAudioRecorder', () => {
    let recorder: SegmentedAudioRecorder

    beforeEach(() => {
        vi.clearAllMocks()
        mockGetUserMedia.mockResolvedValue(mockStream)

        recorder = new SegmentedAudioRecorder({
            segmentDuration: 1000,
            mimeType: 'audio/webm;codecs=opus',
            audioBitsPerSecond: 64000
        })
    })

    afterEach(() => {
        recorder.cleanup()
    })

    describe('åˆå§‹åŒ–å’Œé…ç½®', () => {
        test('æ‡‰è©²ä½¿ç”¨é è¨­é…ç½®å‰µå»ºéŒ„éŸ³å™¨', () => {
            const defaultRecorder = new SegmentedAudioRecorder()

            expect(defaultRecorder.currentConfig).toEqual({
                segmentDuration: 10000,
                mimeType: 'audio/webm;codecs=opus',
                audioBitsPerSecond: 64000
            })
            expect(defaultRecorder.currentState).toBe('idle')
            expect(defaultRecorder.isRecording).toBe(false)
            expect(defaultRecorder.currentSequence).toBe(0)
        })

        test('æ‡‰è©²æ¥å—è‡ªè¨‚é…ç½®', () => {
            const customConfig = {
                segmentDuration: 3000,
                mimeType: 'audio/webm',
                audioBitsPerSecond: 64000
            }

            const customRecorder = new SegmentedAudioRecorder(customConfig)
            expect(customRecorder.currentConfig).toEqual(customConfig)
        })

        test('æ‡‰è©²æ­£ç¢ºè¨­ç½®äº‹ä»¶å›èª¿', () => {
            const onSegment = vi.fn()
            const onError = vi.fn()
            const onStateChange = vi.fn()

            recorder.onSegment(onSegment)
            recorder.onError(onError)
            recorder.onStateChange(onStateChange)

            // å›èª¿æ‡‰è©²è¢«æ­£ç¢ºè¨­ç½®ï¼ˆé€éå¾ŒçºŒè¡Œç‚ºé©—è­‰ï¼‰
            expect(recorder.currentState).toBe('idle')
        })
    })

    describe('éŸ³è¨Šæ¬Šé™å’Œåˆå§‹åŒ–', () => {
        test('æ‡‰è©²æˆåŠŸåˆå§‹åŒ–éŸ³è¨Šæ¬Šé™', async () => {
            await recorder.initialize()

            expect(mockGetUserMedia).toHaveBeenCalledWith({ audio: true })
        })

        test('æ‡‰è©²è™•ç†æ¬Šé™è¢«æ‹’çµ•çš„æƒ…æ³', async () => {
            const error = new Error('Permission denied')
            mockGetUserMedia.mockRejectedValueOnce(error)

            const onError = vi.fn()
            recorder.onError(onError)

            await expect(recorder.initialize()).rejects.toThrow('Permission denied')
        })

        test('æ‡‰è©²é¿å…é‡è¤‡åˆå§‹åŒ–', async () => {
            await recorder.initialize()
            await recorder.initialize() // ç¬¬äºŒæ¬¡èª¿ç”¨

            expect(mockGetUserMedia).toHaveBeenCalledTimes(1)
        })
    })

    describe('éŒ„éŸ³ç‹€æ…‹ç®¡ç†', () => {
        beforeEach(async () => {
            await recorder.initialize()
        })

        test('æ‡‰è©²æ­£ç¢ºé–‹å§‹éŒ„éŸ³', async () => {
            const onSegment = vi.fn()

            await recorder.start(onSegment)

            expect(recorder.isRecording).toBe(true)
            expect(recorder.currentState).toBe('recording')
            expect(mockStart).toHaveBeenCalled()
        })

        test('æ‡‰è©²é˜²æ­¢é‡è¤‡é–‹å§‹éŒ„éŸ³', async () => {
            const onSegment = vi.fn()

            await recorder.start(onSegment)

            await expect(recorder.start(onSegment)).rejects.toThrow('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
        })

        test('æ‡‰è©²æ­£ç¢ºåœæ­¢éŒ„éŸ³', async () => {
            const onSegment = vi.fn()

            await recorder.start(onSegment)
            recorder.stop()

            expect(recorder.isRecording).toBe(false)
            expect(recorder.currentState).toBe('idle')
        })
    })

    describe('åºè™Ÿç®¡ç†', () => {
        test('æ‡‰è©²å¾ 0 é–‹å§‹åºè™Ÿ', () => {
            expect(recorder.currentSequence).toBe(0)
        })

        test('æ‡‰è©²åœ¨é‡æ–°é–‹å§‹éŒ„éŸ³æ™‚é‡ç½®åºè™Ÿ', async () => {
            await recorder.initialize()
            const onSegment = vi.fn()

            await recorder.start(onSegment)
            recorder.stop()

            expect(recorder.currentSequence).toBe(0)
        })
    })

    describe('è³‡æºæ¸…ç†', () => {
        test('æ‡‰è©²æ­£ç¢ºæ¸…ç†æ‰€æœ‰è³‡æº', async () => {
            await recorder.initialize()
            const onSegment = vi.fn()
            await recorder.start(onSegment)

            recorder.cleanup()

            expect(recorder.isRecording).toBe(false)
            expect(recorder.currentSequence).toBe(0)
            expect(mockTrack.stop).toHaveBeenCalled()
        })
    })
})

describe('ç€è¦½å™¨æ”¯æ´æª¢æŸ¥', () => {
    test('æ‡‰è©²æª¢æŸ¥åŸºæœ¬ç€è¦½å™¨æ”¯æ´', async () => {
        const result = await checkSegmentedAudioRecordingSupport()
        expect(result.isSupported).toBe(true)
    })

    test('æ‡‰è©²æª¢æ¸¬ MediaDevices API ä¸æ”¯æ´', async () => {
        // ä½¿ç”¨ vi.stubGlobal ä¾†æ¨¡æ“¬ä¸æ”¯æ´çš„æƒ…æ³
        vi.stubGlobal('navigator', { ...navigator, mediaDevices: undefined })

        const result = await checkSegmentedAudioRecordingSupport()

        expect(result.isSupported).toBe(false)
        expect(result.error).toContain('ä¸æ”¯æ´ MediaDevices API')

        vi.unstubAllGlobals()
    })

    test('æ‡‰è©²æª¢æ¸¬ MediaRecorder API ä¸æ”¯æ´', async () => {
        // ç›´æ¥æ¸¬è©¦æ²’æœ‰ MediaRecorder çš„æƒ…æ³
        const originalMediaRecorder = global.MediaRecorder
        delete (global as any).MediaRecorder

        const result = await checkSegmentedAudioRecordingSupport()

        expect(result.isSupported).toBe(false)
        expect(result.error).toContain('ä¸æ”¯æ´ MediaRecorder API')

        // æ¢å¾©
        global.MediaRecorder = originalMediaRecorder
    })
})


# END FILE CONTENTS


# File: frontend/utils/export.ts

import { toast } from '@/hooks/use-toast'

export async function downloadZip(sid: string) {
    try {
        const res = await fetch(`/api/export/${sid}?type=zip`)
        if (!res.ok) {
            toast({ title: `Export failed: ${res.statusText}`, variant: 'destructive' })
            return
        }
        const blob = await res.blob()
        const url = window.URL.createObjectURL(blob)

        const a = document.createElement('a')
        a.href = url
        a.download = `${sid}.zip`
        a.style.display = 'none'
        document.body.appendChild(a)
        a.click()
        a.remove()
        setTimeout(() => URL.revokeObjectURL(url), 1_000)
        toast({ title: 'Export started', variant: 'default' })
    } catch (err) {
        console.error(err)
        toast({ title: 'Network error when exporting', variant: 'destructive' })
    }
}


# END FILE CONTENTS


# File: app/utils/timing.py

from app.core.config import get_settings
_CHUNK = get_settings().AUDIO_CHUNK_DURATION_SEC

def calc_times(seq: int):
    start = seq * _CHUNK
    return start, start + _CHUNK


# END FILE CONTENTS


# File: pytest.ini

[tool:pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts =
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --color=yes
    --durations=10
markers =
    asyncio: marks tests as async
    unit: marks tests as unit tests
    integration: marks tests as integration tests
    slow: marks tests as slow running
asyncio_mode = auto
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning


# END FILE CONTENTS


# File: frontend/lib/transcript-manager-new.ts

"use client"

import { TranscriptWebSocket } from './websocket'
import { useAppStore } from './app-store-zustand'
import type { TranscriptEntry } from '../types/app-state'
import {
    TranscriptSegmentMessage,
    TranscriptCompleteMessage,
    ErrorMessage,
    TranscriptionErrorMessage,
    ConnectionEstablishedMessage,
    HeartbeatAckMessage,
    PongMessage,
    PhaseMessage
} from '../types/websocket-messages'

/**
 * TranscriptManager - å‹åˆ¥å®‰å…¨çš„é€å­—ç¨¿ç®¡ç†å™¨
 *
 * é‡æ§‹ç‰¹è‰²ï¼š
 * âœ… ä½¿ç”¨ TypeScript discriminated union
 * âœ… äº‹ä»¶é©…å‹•æ¶æ§‹æ›¿ä»£ handleMessage å·¨å‹æ–¹æ³•
 * âœ… å‹åˆ¥å®‰å…¨çš„äº‹ä»¶è™•ç†å™¨
 * âœ… ç§»é™¤ WebSocketManager hack
 */
export class TranscriptManager {
    private static instance: TranscriptManager | null = null
    private connections: Map<string, TranscriptWebSocket> = new Map()
    private connectionStates: Map<string, boolean> = new Map()
    private heartbeatIntervals: Map<string, NodeJS.Timeout> = new Map()
    private reconnectAttempts: Map<string, number> = new Map()
    private maxReconnectAttempts = 5
    private heartbeatInterval = 10000 // 10ç§’
    private reconnectDelay = 2000 // 2ç§’

    private constructor() {
        // Singleton pattern
        if (typeof window !== 'undefined') {
            (window as any).transcriptManager = this
        }
    }

    static getInstance(): TranscriptManager {
        if (!TranscriptManager.instance) {
            TranscriptManager.instance = new TranscriptManager()
        }
        return TranscriptManager.instance
    }

    /* ============================================================
     * æ ¸å¿ƒé€£æ¥ç®¡ç†
     * ============================================================ */

    async connect(sessionId: string): Promise<void> {
        console.log(`ğŸ”— [TranscriptManager] é€£æ¥æœƒè©±: ${sessionId}`)

        // æª¢æŸ¥æ˜¯å¦å·²æœ‰é€£æ¥
        if (this.connections.has(sessionId) && this.isConnected(sessionId)) {
            console.log(`âœ… [TranscriptManager] æœƒè©± ${sessionId} å·²é€£æ¥`)
            return
        }

        // æ¸…ç†èˆŠé€£æ¥
        if (this.connections.has(sessionId)) {
            await this.disconnect(sessionId)
        }

        try {
            await this.establishConnection(sessionId)
            console.log(`âœ… [TranscriptManager] æœƒè©± ${sessionId} é€£æ¥æˆåŠŸ`)
        } catch (error) {
            console.error(`âŒ [TranscriptManager] æœƒè©± ${sessionId} é€£æ¥å¤±æ•—:`, error)
            throw error
        }
    }

    async disconnect(sessionId: string): Promise<void> {
        console.log(`ğŸ“± [TranscriptManager] æ–·é–‹æœƒè©±: ${sessionId}`)

        // åœæ­¢å¿ƒè·³
        this.stopHeartbeat(sessionId)

        // æ–·é–‹ WebSocket
        const ws = this.connections.get(sessionId)
        if (ws) {
            ws.disconnect()
            this.connections.delete(sessionId)
        }

        // æ¸…ç†ç‹€æ…‹
        this.connectionStates.set(sessionId, false)
        this.reconnectAttempts.delete(sessionId)
    }

    /* ============================================================
     * ç§æœ‰æ–¹æ³•ï¼šé€£æ¥å»ºç«‹å’Œäº‹ä»¶ç¶å®š
     * ============================================================ */

    private async establishConnection(sessionId: string): Promise<void> {
        const ws = new TranscriptWebSocket(sessionId)

        // âœ… ä½¿ç”¨å‹åˆ¥å®‰å…¨çš„äº‹ä»¶ç¶å®šï¼ˆç§»é™¤ hackï¼‰
        this.bindWebSocketEvents(ws, sessionId)

        // è¨­å®šé—œé–‰è™•ç†
        ws.onClose((event) => {
            console.log(`ğŸ”Œ [TranscriptManager] æœƒè©± ${sessionId} é€£æ¥é—œé–‰:`, event.code, event.reason)
            this.connectionStates.set(sessionId, false)
            this.stopHeartbeat(sessionId)

            // å¦‚æœä¸æ˜¯æ‰‹å‹•é—œé–‰ï¼Œå˜—è©¦é‡é€£
            if (event.code !== 1000) {
                this.scheduleReconnect(sessionId)
            }
        })

        // å»ºç«‹é€£æ¥
        await ws.connect()

        // ä¿å­˜é€£æ¥
        this.connections.set(sessionId, ws)
        this.connectionStates.set(sessionId, true)

        // å•Ÿå‹•å¿ƒè·³å’Œåˆå§‹åŒ–
        this.sendPing(sessionId)
        this.startHeartbeat(sessionId)
    }

    private bindWebSocketEvents(ws: TranscriptWebSocket, sessionId: string): void {
        console.log(`ğŸ¯ [TranscriptManager] ç¶å®šäº‹ä»¶è™•ç†å™¨: ${sessionId}`)

        // âœ… å‹åˆ¥å®‰å…¨çš„äº‹ä»¶ç›£è½å™¨
        ws.on('transcript_segment', (msg) => this.handleTranscriptSegment(sessionId, msg))
        ws.on('connection_established', (msg) => this.handleConnectionEstablished(sessionId, msg))
        ws.on('transcript_complete', (msg) => this.handleTranscriptComplete(sessionId, msg))
        ws.on('heartbeat_ack', (msg) => this.handleHeartbeatAck(sessionId, msg))
        ws.on('pong', (msg) => this.handlePong(sessionId, msg))
        ws.on('error', (msg) => this.handleError(sessionId, msg))
        ws.on('transcription_error', (msg) => this.handleTranscriptionError(sessionId, msg))
        ws.on('phase', (msg) => this.handlePhase(sessionId, msg))
    }

    /* ============================================================
     * å‹åˆ¥å®‰å…¨çš„äº‹ä»¶è™•ç†å™¨ï¼ˆå–ä»£å·¨å‹ handleMessageï¼‰
     * ============================================================ */

    private handleTranscriptSegment(sessionId: string, msg: TranscriptSegmentMessage): void {
        console.log('ğŸ“ [TranscriptManager] æ”¶åˆ°é€å­—ç¨¿ç‰‡æ®µ:', {
            sessionId,
            text: msg.text.substring(0, 50) + '...',
            start_time: msg.start_time,
            end_time: msg.end_time,
            confidence: msg.confidence
        })

        // è½‰æ›ç‚º UI æ ¼å¼ä¸¦æ¨é€åˆ° store
        // ä½¿ç”¨ start_time ä¸¦è½‰æ›ç‚º HH:MM:SS æ ¼å¼
        const startTimeInSeconds = msg.start_time ?? 0
        const hours = Math.floor(startTimeInSeconds / 3600)
        const minutes = Math.floor((startTimeInSeconds % 3600) / 60)
        const seconds = Math.floor(startTimeInSeconds % 60)

        const entry: TranscriptEntry = {
            startTime: startTimeInSeconds,
            time: `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`,
            text: msg.text
        }

        console.log('ğŸ¯ [TranscriptManager] æ¨é€åˆ° store:', entry)
        useAppStore.getState().addTranscriptEntry(entry)

        // æª¢æŸ¥ç‹€æ…‹è½‰æ›
        const currentState = useAppStore.getState()
        console.log('ğŸ“Š [TranscriptManager] Store ç‹€æ…‹:', {
            appState: currentState.appState,
            transcriptCount: currentState.transcriptEntries.length
        })
    }

    private handleConnectionEstablished(sessionId: string, msg: ConnectionEstablishedMessage): void {
        console.log('âœ… [TranscriptManager] é€£æ¥å·²å»ºç«‹:', {
            sessionId,
            message: msg.message,
            timestamp: msg.timestamp
        })
    }

    private handleTranscriptComplete(sessionId: string, msg: TranscriptCompleteMessage): void {
        console.log('ğŸ¯ [TranscriptManager] è½‰éŒ„å®Œæˆ:', {
            sessionId,
            message: msg.message,
            timestamp: msg.timestamp
        })
        // å¯ä»¥åœ¨é€™è£¡è§¸ç™¼å®Œæˆç‹€æ…‹æˆ–é€šçŸ¥
    }

    private handleHeartbeatAck(sessionId: string, msg: HeartbeatAckMessage): void {
        console.log('ğŸ’“ [TranscriptManager] å¿ƒè·³ç¢ºèª:', {
            sessionId,
            timestamp: msg.timestamp
        })
    }

    private handlePong(sessionId: string, msg: PongMessage): void {
        console.log('ğŸ“ [TranscriptManager] Pong å›æ‡‰:', {
            sessionId,
            timestamp: msg.timestamp
        })
    }

    private handleError(sessionId: string, msg: ErrorMessage): void {
        console.error('ğŸš¨ [TranscriptManager] æ”¶åˆ°éŒ¯èª¤:', {
            sessionId,
            error_type: msg.error_type,
            error_message: msg.error_message,
            details: msg.details
        })
        // å¯ä»¥åœ¨é€™è£¡è§¸ç™¼éŒ¯èª¤è™•ç†é‚è¼¯
    }

    private handleTranscriptionError(sessionId: string, msg: TranscriptionErrorMessage): void {
        console.error('ğŸš¨ [TranscriptManager] è½‰éŒ„éŒ¯èª¤:', {
            sessionId,
            error_type: msg.error_type,
            error_message: msg.error_message
        })
    }

    private handlePhase(sessionId: string, msg: PhaseMessage): void {
        console.log(`ğŸ“ [TranscriptManager] ç›¸ä½è®Šæ›´: ${msg.phase}`, {
            sessionId,
            phase: msg.phase
        })

        // ğŸ¯ æ ¹æ“š phase æ›´æ–°æ‡‰ç”¨ç‹€æ…‹
        if (msg.phase === 'active') {
            console.log('âœ… [TranscriptManager] æ”¶åˆ° active phaseï¼Œåˆ‡æ›åˆ° recording_active')
            useAppStore.getState().setState('recording_active')
        } else if (msg.phase === 'waiting') {
            console.log('â³ [TranscriptManager] æ”¶åˆ° waiting phaseï¼Œä¿æŒ recording_waiting')
            useAppStore.getState().setState('recording_waiting')
        }
    }

    /* ============================================================
     * å¿ƒè·³å’Œé‡é€£æ©Ÿåˆ¶
     * ============================================================ */

    private sendPing(sessionId: string): void {
        const ws = this.connections.get(sessionId)
        if (ws && ws.isConnected) {
            ws.sendJson({ type: 'ping' })
            console.log(`ğŸ“ [TranscriptManager] ç™¼é€ ping: ${sessionId}`)
        }
    }

    private sendHeartbeat(sessionId: string): void {
        const ws = this.connections.get(sessionId)
        if (ws && ws.isConnected) {
            try {
                ws.sendJson({
                    type: 'heartbeat',
                    timestamp: Date.now()
                })
                console.log(`ğŸ’“ [TranscriptManager] ç™¼é€å¿ƒè·³: ${sessionId}`)
            } catch (error) {
                console.error(`âŒ [TranscriptManager] å¿ƒè·³å¤±æ•— ${sessionId}:`, error)
                this.connectionStates.set(sessionId, false)
                this.scheduleReconnect(sessionId)
            }
        }
    }

    private startHeartbeat(sessionId: string): void {
        this.stopHeartbeat(sessionId)

        const interval = setInterval(() => {
            this.sendHeartbeat(sessionId)
        }, this.heartbeatInterval)

        this.heartbeatIntervals.set(sessionId, interval)
        console.log(`ğŸ’“ [TranscriptManager] å•Ÿå‹•å¿ƒè·³: ${sessionId}`)
    }

    private stopHeartbeat(sessionId: string): void {
        const interval = this.heartbeatIntervals.get(sessionId)
        if (interval) {
            clearInterval(interval)
            this.heartbeatIntervals.delete(sessionId)
            console.log(`ğŸ’“ [TranscriptManager] åœæ­¢å¿ƒè·³: ${sessionId}`)
        }
    }

    private scheduleReconnect(sessionId: string): void {
        const attempts = this.reconnectAttempts.get(sessionId) ?? 0

        if (attempts >= this.maxReconnectAttempts) {
            console.error(`âŒ [TranscriptManager] é‡é€£æ¬¡æ•¸å·²é”ä¸Šé™: ${sessionId}`)
            return
        }

        this.reconnectAttempts.set(sessionId, attempts + 1)
        const delay = this.reconnectDelay * Math.pow(2, attempts)

        console.log(`ğŸ”„ [TranscriptManager] æ’ç¨‹é‡é€£: ${sessionId} (${attempts + 1}/${this.maxReconnectAttempts}) ${delay}ms`)

        setTimeout(async () => {
            try {
                await this.establishConnection(sessionId)
                this.reconnectAttempts.set(sessionId, 0)
                console.log(`âœ… [TranscriptManager] é‡é€£æˆåŠŸ: ${sessionId}`)
            } catch (error) {
                console.error(`âŒ [TranscriptManager] é‡é€£å¤±æ•—: ${sessionId}`, error)
            }
        }, delay)
    }

    /* ============================================================
 * å‘å¾Œå…¼å®¹æ–¹æ³•ï¼ˆæ”¯æ´èˆŠçš„ APIï¼‰
 * ============================================================ */

    /**
     * @deprecated èˆŠ API å…¼å®¹æ€§ - è«‹ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼
     */
    addListener(sessionId: string, callback: (message: any) => void): void {
        console.warn('âš ï¸ [TranscriptManager] addListener å·²æ£„ç”¨ï¼Œè«‹ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼')
        // ç‚ºäº†å…¼å®¹æ€§ï¼Œæš«æ™‚ä¿ç•™ä½†ä¸å¯¦ä½œ
    }

    /**
     * @deprecated èˆŠ API å…¼å®¹æ€§ - è«‹ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼
     */
    removeListener(sessionId: string, callback: (message: any) => void): void {
        console.warn('âš ï¸ [TranscriptManager] removeListener å·²æ£„ç”¨ï¼Œè«‹ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼')
        // ç‚ºäº†å…¼å®¹æ€§ï¼Œæš«æ™‚ä¿ç•™ä½†ä¸å¯¦ä½œ
    }

    /* ============================================================
     * å…¬å…±å·¥å…·æ–¹æ³•
     * ============================================================ */

    isConnected(sessionId: string): boolean {
        const ws = this.connections.get(sessionId)
        const actualConnected = ws?.isConnected ?? false

        // åŒæ­¥ç‹€æ…‹
        const stateConnected = this.connectionStates.get(sessionId) ?? false
        if (stateConnected !== actualConnected) {
            this.connectionStates.set(sessionId, actualConnected)
        }

        return actualConnected
    }

    getConnectionCount(): number {
        return Array.from(this.connections.values()).filter(ws => ws.isConnected).length
    }

    async disconnectAll(): Promise<void> {
        console.log('ğŸ“± [TranscriptManager] æ¸…ç†æ‰€æœ‰é€£æ¥')
        const sessionIds = Array.from(this.connections.keys())
        await Promise.all(sessionIds.map(sessionId => this.disconnect(sessionId)))
    }
}

// åŒ¯å‡º Singleton å¯¦ä¾‹
export const transcriptManager = TranscriptManager.getInstance()


# END FILE CONTENTS


# File: frontend/lib/__tests__/initial-state-loader.test.ts

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { InitialStateLoader } from '../initial-state-loader'
import type { AppData } from '../../types/app-state'

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
    clear: vi.fn(),
}

// åœ¨æ¸¬è©¦ç’°å¢ƒä¸­è¨­ç½® localStorage mock
Object.defineProperty(window, 'localStorage', {
    value: localStorageMock
})

describe('InitialStateLoader', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        localStorageMock.getItem.mockReturnValue(null)
    })

    describe('loadInitialAppData', () => {
        test('æ‡‰è©²è¿”å›é è¨­ç‹€æ…‹ç•¶æ²’æœ‰æŒä¹…åŒ–è³‡æ–™æ™‚', () => {
            const result = InitialStateLoader.loadInitialAppData()

            expect(result).toEqual({
                state: 'default',
                transcriptEntries: [],
                editorContent: '',
                isRecording: false,
                recordingTime: 0,
                session: null,
            })
        })

        test('æ‡‰è©²è¼‰å…¥è‰ç¨¿ç­†è¨˜å…§å®¹', () => {
            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'draft_note') return 'æ¸¬è©¦è‰ç¨¿å…§å®¹'
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            expect(result.editorContent).toBe('æ¸¬è©¦è‰ç¨¿å…§å®¹')
            expect(localStorageMock.getItem).toHaveBeenCalledWith('draft_note')
        })

        test('æ‡‰è©²è¼‰å…¥ä¸Šæ¬¡æœƒè©±è³‡è¨Š', () => {
            const mockSession = {
                id: 'test-session-id',
                status: 'active',
                type: 'recording'
            }

            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'last_session') return JSON.stringify(mockSession)
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            expect(result.session).toEqual(mockSession)
            expect(localStorageMock.getItem).toHaveBeenCalledWith('last_session')
        })

        test('æ‡‰è©²å¿½ç•¥å·²å®Œæˆçš„æœƒè©±', () => {
            const completedSession = {
                id: 'test-session-id',
                status: 'completed',
                type: 'recording'
            }

            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'last_session') return JSON.stringify(completedSession)
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            expect(result.session).toBeNull()
        })

        test('æ‡‰è©²è¼‰å…¥å®Œæ•´çš„æ‡‰ç”¨ç‹€æ…‹', () => {
            const mockAppState = {
                state: 'recording_active',
                transcriptEntries: [
                    { time: '00:01', text: 'æ¸¬è©¦é€å­—ç¨¿' }
                ]
            }

            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'app_state_v1') return JSON.stringify(mockAppState)
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            expect(result.state).toBe('recording_active')
            expect(result.transcriptEntries).toEqual(mockAppState.transcriptEntries)
        })

        test('æ‡‰è©²è™•ç†ç„¡æ•ˆçš„ JSON è³‡æ–™', () => {
            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'last_session') return 'invalid json'
                return null
            })

            const result = InitialStateLoader.loadInitialAppData()

            // æ‡‰è©²è¿”å›é è¨­ç‹€æ…‹è€Œä¸æ˜¯æ‹‹å‡ºéŒ¯èª¤
            expect(result.session).toBeNull()
        })
    })

    describe('saveAppState', () => {
        test('æ‡‰è©²å„²å­˜æ‡‰ç”¨ç‹€æ…‹åˆ° localStorage', () => {
            const mockAppData: AppData = {
                state: 'recording_active',
                transcriptEntries: [{ time: '00:01', text: 'æ¸¬è©¦' }],
                editorContent: 'æ¸¬è©¦å…§å®¹',
                isRecording: true,
                recordingTime: 30,
                session: {
                    id: 'test-session',
                    status: 'active',
                    type: 'recording'
                }
            }

            InitialStateLoader.saveAppState(mockAppData)

            expect(localStorageMock.setItem).toHaveBeenCalledWith(
                'app_state_v1',
                JSON.stringify({
                    state: 'recording_active',
                    transcriptEntries: [{ time: '00:01', text: 'æ¸¬è©¦' }]
                })
            )

            expect(localStorageMock.setItem).toHaveBeenCalledWith(
                'last_session',
                JSON.stringify(mockAppData.session)
            )
        })

        test('æ‡‰è©²ç§»é™¤æœƒè©±è³‡è¨Šç•¶ session ç‚º null', () => {
            const mockAppData: AppData = {
                state: 'default',
                transcriptEntries: [],
                editorContent: '',
                isRecording: false,
                recordingTime: 0,
                session: null
            }

            InitialStateLoader.saveAppState(mockAppData)

            expect(localStorageMock.removeItem).toHaveBeenCalledWith('last_session')
        })
    })

    describe('clearPersistedState', () => {
        test('æ‡‰è©²æ¸…é™¤æŒä¹…åŒ–ç‹€æ…‹', () => {
            InitialStateLoader.clearPersistedState()

            expect(localStorageMock.removeItem).toHaveBeenCalledWith('app_state_v1')
            expect(localStorageMock.removeItem).toHaveBeenCalledWith('last_session')
            // ä¸æ‡‰è©²æ¸…é™¤ draft_note
            expect(localStorageMock.removeItem).not.toHaveBeenCalledWith('draft_note')
        })
    })

    describe('hasPersistedState', () => {
        test('ç•¶æœ‰æŒä¹…åŒ–ç‹€æ…‹æ™‚æ‡‰è©²è¿”å› true', () => {
            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'app_state_v1') return '{"state":"default"}'
                return null
            })

            expect(InitialStateLoader.hasPersistedState()).toBe(true)
        })

        test('ç•¶æ²’æœ‰æŒä¹…åŒ–ç‹€æ…‹æ™‚æ‡‰è©²è¿”å› false', () => {
            expect(InitialStateLoader.hasPersistedState()).toBe(false)
        })

        test('ç•¶æœ‰æœƒè©±è³‡è¨Šæ™‚æ‡‰è©²è¿”å› true', () => {
            localStorageMock.getItem.mockImplementation((key) => {
                if (key === 'last_session') return '{"id":"test"}'
                return null
            })

            expect(InitialStateLoader.hasPersistedState()).toBe(true)
        })
    })
})


# END FILE CONTENTS


# File: app/ws/upload_audio.py

"""
WebSocket éŸ³æª”ä¸Šå‚³æœå‹™

å¯¦ä½œéŸ³æª”åˆ‡ç‰‡å³æ™‚ä¸Šå‚³ã€é‡å‚³æ©Ÿåˆ¶èˆ‡ Cloudflare R2 æ•´åˆ
"""

import json
import logging
import asyncio
import struct
from typing import Dict, Set, Optional, List
from uuid import UUID
from datetime import datetime, timedelta

from fastapi import APIRouter, WebSocket, WebSocketDisconnect, WebSocketException, status, Path, Depends
from supabase import Client
from fastapi import HTTPException
from app.core.container import container
from app.services.stt.factory import get_provider
from ..db.database import get_supabase_client
from ..services.r2_client import get_r2_client, R2ClientError

logger = logging.getLogger(__name__)

router = APIRouter()

class AudioUploadManager:
    """éŸ³æª”ä¸Šå‚³ç®¡ç†å™¨"""

    def __init__(self, websocket: WebSocket, session_id: UUID, supabase_client: Client):
        self.websocket = websocket
        self.session_id = session_id
        self.supabase_client = supabase_client
        self.r2_client = get_r2_client()

        # ç‹€æ…‹ç®¡ç†
        self.is_connected = False
        self.received_chunks: Set[int] = set()  # å·²æ”¶åˆ°çš„åˆ‡ç‰‡åºè™Ÿ
        self.last_heartbeat = datetime.utcnow()
        self.upload_tasks: Dict[int, asyncio.Task] = {}  # ä¸Šå‚³ä»»å‹™è¿½è¹¤

        # è¨­å®š
        self.heartbeat_interval = 30  # å¿ƒè·³é–“éš”ï¼ˆç§’ï¼‰
        self.chunk_timeout = 10  # åˆ‡ç‰‡è™•ç†è¶…æ™‚ï¼ˆç§’ï¼‰
        self.max_pending_uploads = 5  # æœ€å¤§ä¸¦è¡Œä¸Šå‚³æ•¸

    async def _initialize_received_chunks(self):
        """å¾è³‡æ–™åº«åˆå§‹åŒ–å·²æ”¶åˆ°çš„åˆ‡ç‰‡é›†åˆ"""
        try:
            response = self.supabase_client.table("audio_files").select("chunk_sequence").eq("session_id", str(self.session_id)).execute()
            if response.data:
                self.received_chunks = {item['chunk_sequence'] for item in response.data}
                logger.info(f"å¾è³‡æ–™åº«æ¢å¾© {len(self.received_chunks)} å€‹å·²å­˜åœ¨çš„åˆ‡ç‰‡è¨˜éŒ„ for session {self.session_id}")
        except Exception as e:
            logger.error(f"å¾è³‡æ–™åº«åˆå§‹åŒ– received_chunks å¤±æ•—: {e}")
            # å³ä½¿åˆå§‹åŒ–å¤±æ•—ï¼Œä¹Ÿç¹¼çºŒåŸ·è¡Œï¼Œä½†ä½¿ç”¨ç©ºçš„é›†åˆ
            self.received_chunks = set()

    async def handle_connection(self):
        """è™•ç† WebSocket é€£æ¥"""
        logger.info("<<<<< RUNNING UPLOAD_AUDIO.PY CODE (v5) >>>>>")
        try:
            # æ¥å—é€£æ¥
            await self.websocket.accept()
            self.is_connected = True
            logger.info(f"WebSocket é€£æ¥å»ºç«‹: session_id={self.session_id}")

            # å¾è³‡æ–™åº«åŠ è¼‰å·²æœ‰çš„åˆ‡ç‰‡ï¼Œä»¥è™•ç†é‡é€£æƒ…æ³
            await self._initialize_received_chunks()

            # é©—è­‰æœƒè©±ç‹€æ…‹
            if not await self._validate_session():
                await self._send_error("Invalid session or session not in recording mode")
                return

            # ç™¼é€é€£æ¥ç¢ºèª
            await self._send_message({
                "type": "connection_established",
                "session_id": str(self.session_id),
                "timestamp": datetime.utcnow().isoformat()
            })

            # å•Ÿå‹•å¿ƒè·³æª¢æ¸¬
            heartbeat_task = asyncio.create_task(self._heartbeat_monitor())

            try:
                # ä¸»è¦æ¶ˆæ¯è™•ç†å¾ªç’°
                await self._message_loop()
            finally:
                # æ¸…ç†è³‡æº
                heartbeat_task.cancel()
                await self._cleanup()

        except WebSocketDisconnect:
            logger.info(f"WebSocket é€£æ¥æ–·é–‹: session_id={self.session_id}")
        except Exception as e:
            logger.error(f"WebSocket è™•ç†ç•°å¸¸: {e}")
            await self._send_error(f"Connection error: {str(e)}")
        finally:
            self.is_connected = False

    async def _validate_session(self) -> bool:
        """é©—è­‰æœƒè©±å­˜åœ¨ä¸”è™•æ–¼éŒ„éŸ³æ¨¡å¼"""
        try:
            response = self.supabase_client.table("sessions").select("*").eq("id", str(self.session_id)).single().execute()

            if not response.data:
                logger.warning(f"æœƒè©±ä¸å­˜åœ¨: {self.session_id}")
                return False

            session = response.data

            if session.get('status') != 'active':
                logger.warning(f"æœƒè©±éæ´»èºç‹€æ…‹: {self.session_id}, status={session.get('status')}")
                return False

            if session.get('type') != 'recording':
                logger.warning(f"æœƒè©±ééŒ„éŸ³æ¨¡å¼: {self.session_id}, type={session.get('type')}")
                return False

            return True
        except Exception as e:
            logger.error(f"æœƒè©±é©—è­‰æ™‚ç™¼ç”Ÿç•°å¸¸: {self.session_id}, error: {e}")
            return False

    async def _message_loop(self):
        """ä¸»è¦æ¶ˆæ¯è™•ç†å¾ªç’°"""
        while self.is_connected:
            try:
                # æ¥æ”¶æ¶ˆæ¯ï¼ˆäºŒé€²åˆ¶æˆ–æ–‡æœ¬ï¼‰
                data = await self.websocket.receive()

                if "bytes" in data:
                    # è™•ç†äºŒé€²åˆ¶éŸ³æª”åˆ‡ç‰‡
                    await self._handle_audio_chunk(data["bytes"])
                elif "text" in data:
                    # è™•ç†æ–‡æœ¬æ¶ˆæ¯ï¼ˆå¿ƒè·³ã€æ§åˆ¶æŒ‡ä»¤ç­‰ï¼‰
                    await self._handle_text_message(data["text"])

            except WebSocketDisconnect:
                # Case 1: å®¢æˆ¶ç«¯æ­£å¸¸ã€ä¹¾æ·¨åœ°é—œé–‰é€£æ¥
                logger.info("WebSocket gracefully disconnected by client.")
                self.is_connected = False # ç¢ºä¿è¿´åœˆçµ‚æ­¢
                break # ä¹¾æ·¨åœ°é€€å‡ºè¿´åœˆ

            except RuntimeError as e:
                # Case 2: é€£æ¥æ„å¤–ä¸­æ–·ï¼Œå°è‡´ receive() å¤±æ•—
                # æ³¨æ„ï¼šé€™è£¡çš„ "receive" å¿…é ˆæ˜¯é›™å¼•è™Ÿï¼Œæ‰èƒ½åŒ¹é…ç•°å¸¸æ¶ˆæ¯
                if 'Cannot call "receive" once a disconnect message has been received' in str(e):
                    logger.info(f"WebSocket connection closed (RuntimeError on receive), breaking loop: {e}")
                    self.is_connected = False # ç¢ºä¿è¿´åœˆçµ‚æ­¢
                    break # ä¹¾æ·¨åœ°é€€å‡ºè¿´åœˆ
                else:
                    # è™•ç†å…¶ä»–é¡å‹çš„ RuntimeError
                    logger.error(f"An unexpected runtime error occurred in message loop: {e}", exc_info=True)
                    await self._send_error(f"Message processing runtime error: {str(e)}")
                    # å³ä½¿ç™¼é€éŒ¯èª¤ï¼Œä¹Ÿè¦ä¸­æ–·è¿´åœˆ
                    self.is_connected = False
                    break

            except Exception as e:
                # Case 3: è™•ç†æ‰€æœ‰å…¶ä»–æœªé æœŸçš„éŒ¯èª¤
                logger.error(f"An unexpected error occurred in message loop: {e}", exc_info=True)
                await self._send_error(f"Message processing error: {str(e)}")
                # ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤å¾Œä¹Ÿä¸­æ–·è¿´åœˆï¼Œé¿å…ç„¡é™å¾ªç’°
                self.is_connected = False
                break

    async def _handle_audio_chunk(self, chunk_data: bytes):
        """è™•ç†éŸ³æª”åˆ‡ç‰‡æ•¸æ“š"""
        try:
            # è§£æåˆ‡ç‰‡æ ¼å¼ï¼š4å­—ç¯€åºè™Ÿ + éŸ³æª”æ•¸æ“š
            if len(chunk_data) < 4:
                await self._send_error("Invalid chunk format: too short")
                return

            # è§£åŒ…åºè™Ÿï¼ˆå°ç«¯åº unsigned intï¼‰
            chunk_sequence = struct.unpack('<I', chunk_data[:4])[0]
            audio_data = chunk_data[4:]

            if len(audio_data) == 0:
                await self._send_error(f"Empty audio data for chunk {chunk_sequence}")
                return

            logger.debug(f"æ”¶åˆ°éŸ³æª”åˆ‡ç‰‡: seq={chunk_sequence}, size={len(audio_data)}")

            # æª¢æŸ¥æ˜¯å¦ç‚ºé‡è¤‡åˆ‡ç‰‡
            if chunk_sequence in self.received_chunks:
                logger.debug(f"å¿½ç•¥é‡è¤‡åˆ‡ç‰‡: seq={chunk_sequence}")
                await self._send_ack(chunk_sequence)
                return

            # è¨˜éŒ„å·²æ”¶åˆ°çš„åˆ‡ç‰‡
            self.received_chunks.add(chunk_sequence)

            # é™åˆ¶ä¸¦è¡Œä¸Šå‚³æ•¸é‡
            if len(self.upload_tasks) >= self.max_pending_uploads:
                # ç­‰å¾…æœ€èˆŠçš„ä¸Šå‚³å®Œæˆ
                oldest_task = min(self.upload_tasks.values(), key=lambda t: t.get_name())
                await oldest_task

            # éåŒæ­¥ä¸Šå‚³åˆ° R2
            upload_task = asyncio.create_task(
                self._upload_chunk_to_r2(chunk_sequence, audio_data)
            )
            self.upload_tasks[chunk_sequence] = upload_task

        except Exception as e:
            logger.error(f"éŸ³æª”åˆ‡ç‰‡è™•ç†å¤±æ•—: {e}")
            await self._send_error(f"Chunk processing error: {str(e)}")

    async def _upload_chunk_to_r2(self, chunk_sequence: int, audio_data: bytes):
        """ä¸Šå‚³éŸ³æª”åˆ‡ç‰‡åˆ° R2 ä¸¦è§¸ç™¼è½‰éŒ„"""
        try:
            result = await self.r2_client.store_chunk_blob(
                session_id=self.session_id,
                chunk_sequence=chunk_sequence,
                blob_data=audio_data,
                supabase_client=self.supabase_client
            )

            if result['success']:
                # ä¸Šå‚³æˆåŠŸï¼Œç™¼é€ ACK
                await self._send_ack(chunk_sequence)
                logger.debug(f"åˆ‡ç‰‡ä¸Šå‚³æˆåŠŸ: seq={chunk_sequence}, size={len(audio_data)}")

                # è½‰éŒ„å‘¼å«
                provider = get_provider(self.session_id)
                logger.info(f"ğŸ¯ [WSè½‰éŒ„] é–‹å§‹è½‰éŒ„ seq={chunk_sequence} (provider={provider.name()})")
                result = await provider.transcribe(audio_data, self.session_id, chunk_sequence)
                if result:
                    logger.info(f"âœ… [WSè½‰éŒ„] seq={chunk_sequence} è½‰éŒ„æˆåŠŸ")
                    # TODO: å¾ŒçºŒå„²å­˜/æ¨æ’­ result
                else:
                    logger.warning(f"âš ï¸ [WSè½‰éŒ„] seq={chunk_sequence} è½‰éŒ„å¤±æ•—")
            else:
                # ä¸Šå‚³å¤±æ•—
                error_message = result.get('error', 'Unknown R2 upload error')
                await self._send_upload_error(chunk_sequence, error_message)
                # å¾ received_chunks ç§»é™¤ï¼Œå…è¨±é‡è©¦
                self.received_chunks.discard(chunk_sequence)
                logger.error(f"åˆ‡ç‰‡ä¸Šå‚³å¤±æ•—: seq={chunk_sequence}, error={error_message}")

        except Exception as e:
            logger.error(f"ä¸Šå‚³åˆ° R2 å¤±æ•—: seq={chunk_sequence}, error: {e}")
            await self._send_upload_error(chunk_sequence, str(e))
            # å¾ received_chunks ç§»é™¤ï¼Œå…è¨±é‡è©¦
            self.received_chunks.discard(chunk_sequence)
        finally:
            # æ¸…ç†è¿½è¹¤å­—å…¸ä¸­çš„ä»»å‹™
            self.upload_tasks.pop(chunk_sequence, None)

    async def _handle_text_message(self, message_text: str):
        """è™•ç†æ–‡æœ¬æ¶ˆæ¯"""
        try:
            message = json.loads(message_text)
            msg_type = message.get("type")

            if msg_type == "heartbeat":
                # æ›´æ–°å¿ƒè·³æ™‚é–“
                self.last_heartbeat = datetime.utcnow()
                await self._send_message({"type": "heartbeat_ack"})

            elif msg_type == "request_missing":
                # å®¢æˆ¶ç«¯è«‹æ±‚ç¼ºå¤±åˆ‡ç‰‡åˆ—è¡¨
                await self._send_missing_chunks()

            elif msg_type == "upload_complete":
                # å®¢æˆ¶ç«¯è¡¨ç¤ºä¸Šå‚³å®Œæˆ
                await self._handle_upload_complete()

            else:
                logger.warning(f"æœªçŸ¥æ¶ˆæ¯é¡å‹: {msg_type}")

        except json.JSONDecodeError:
            logger.error(f"JSON è§£æå¤±æ•—: {message_text}")
            await self._send_error("Invalid JSON message")
        except Exception as e:
            logger.error(f"æ–‡æœ¬æ¶ˆæ¯è™•ç†å¤±æ•—: {e}")
            await self._send_error(f"Text message error: {str(e)}")

    async def _send_ack(self, chunk_sequence: int):
        """ç™¼é€åˆ‡ç‰‡ç¢ºèª"""
        await self._send_message({
            "type": "ack",
            "chunk_sequence": chunk_sequence,
            "timestamp": datetime.utcnow().isoformat()
        })

    async def _send_upload_error(self, chunk_sequence: int, error_msg: str):
        """ç™¼é€ä¸Šå‚³éŒ¯èª¤"""
        await self._send_message({
            "type": "upload_error",
            "chunk_sequence": chunk_sequence,
            "error": error_msg,
            "timestamp": datetime.utcnow().isoformat()
        })

    async def _send_missing_chunks(self):
        """ç™¼é€ç¼ºå¤±åˆ‡ç‰‡åˆ—è¡¨ï¼ˆå¯¦ä½œé‡å‚³æ©Ÿåˆ¶ï¼‰"""
        # é€™è£¡å¯ä»¥å¯¦ä½œæ›´è¤‡é›œçš„ç¼ºå¤±æª¢æ¸¬é‚è¼¯
        # ç›®å‰ç°¡å–®è¿”å›å·²æ”¶åˆ°çš„åˆ‡ç‰‡åˆ—è¡¨
        await self._send_message({
            "type": "chunk_status",
            "received_chunks": sorted(list(self.received_chunks)),
            "total_received": len(self.received_chunks),
            "timestamp": datetime.utcnow().isoformat()
        })

    async def _handle_upload_complete(self):
        """è™•ç†ä¸Šå‚³å®Œæˆ"""
        # ç­‰å¾…æ‰€æœ‰é€²è¡Œä¸­çš„ä¸Šå‚³å®Œæˆ
        if self.upload_tasks:
            logger.info(f"ç­‰å¾… {len(self.upload_tasks)} å€‹ä¸Šå‚³ä»»å‹™å®Œæˆ")
            await asyncio.gather(*self.upload_tasks.values(), return_exceptions=True)

        # å‘å®¢æˆ¶ç«¯ç¢ºèªå…¨éƒ¨åˆ‡ç‰‡å·²æ¥æ”¶
        await self._send_message({
            "type": "all_chunks_received"
        })
        await self._send_message({
            "type": "upload_complete_ack",
            "total_chunks": len(self.received_chunks),
            "timestamp": datetime.utcnow().isoformat()
        })

        logger.info(f"éŸ³æª”ä¸Šå‚³å®Œæˆ: session_id={self.session_id}, chunks={len(self.received_chunks)}")

    async def _heartbeat_monitor(self):
        """å¿ƒè·³ç›£æ§å™¨ï¼Œè¶…æ™‚å‰‡é—œé–‰é€£æ¥"""
        while self.is_connected:
            await asyncio.sleep(self.heartbeat_interval)
            if datetime.utcnow() - self.last_heartbeat > timedelta(seconds=self.heartbeat_interval * 2):
                logger.warning(f"å¿ƒè·³è¶…æ™‚ï¼Œé—œé–‰é€£æ¥: session_id={self.session_id}")
                await self._send_error("Heartbeat timeout")
                await self.websocket.close(code=status.WS_1008_POLICY_VIOLATION)
                break

    async def _send_message(self, message: dict):
        """å®‰å…¨åœ°ç™¼é€æ¶ˆæ¯ï¼ˆå³ä½¿ is_connected ç‚º False äº¦å˜—è©¦å‚³é€ï¼Œä¾¿æ–¼å–®å…ƒæ¸¬è©¦é©—è­‰ï¼‰"""
        try:
            await self.websocket.send_text(json.dumps(message))
        except (WebSocketDisconnect, RuntimeError) as e:
            logger.warning(f"ç™¼é€æ¶ˆæ¯å¤±æ•—ï¼Œé€£æ¥å¯èƒ½å·²é—œé–‰: {e}")
            self.is_connected = False  # æ¨™è¨˜ç‚ºå·²æ–·é–‹

    async def _send_error(self, error_msg: str):
        """å®‰å…¨åœ°ç™¼é€éŒ¯èª¤æ¶ˆæ¯"""
        logger.error(f"WebSocket éŒ¯èª¤ç™¼é€è‡³å®¢æˆ¶ç«¯: {error_msg}")
        await self._send_message({
            "type": "error",
            "message": error_msg
        })

    async def _cleanup(self):
        """æ¸…ç†è³‡æºï¼Œä¾‹å¦‚ç­‰å¾…ä¸­çš„ä¸Šå‚³ä»»å‹™"""
        if self.upload_tasks:
            logger.info(f"ç­‰å¾… {len(self.upload_tasks)} å€‹ä¸Šå‚³ä»»å‹™å®Œæˆ...")
            await asyncio.gather(*self.upload_tasks.values())
        logger.info(f"æ¸…ç†å®Œæˆ: session_id={self.session_id}")


@router.websocket("/ws/upload_audio/{session_id}")
async def websocket_endpoint(
    websocket: WebSocket,
    session_id: UUID = Path(...),
    supabase_client: Client = Depends(get_supabase_client)
):
    """
    WebSocket ç«¯é»ï¼šè™•ç†éŸ³æª”ä¸Šå‚³

    - B-005: å»ºç«‹ WebSocket ç«¯é»
    - B-012: å¯¦ä½œ ACK/Missing é‡å‚³æ©Ÿåˆ¶
    - æ•´åˆ Cloudflare R2 ä¸Šå‚³èˆ‡ Azure OpenAI è½‰éŒ„
    """
    manager = AudioUploadManager(websocket, session_id, supabase_client)
    await manager.handle_connection()


def handle_ack_missing(received_chunks: Set[int], expected_total: Optional[int] = None) -> dict:
    """
    æ ¹æ“šå·²æ”¶åˆ°çš„åˆ‡ç‰‡åˆ—è¡¨ï¼Œç”¢ç”Ÿ ack/missing å ±å‘Š (B-012)

    Args:
        received_chunks: å·²æ”¶åˆ°çš„åˆ‡ç‰‡åºè™Ÿé›†åˆ
        expected_total: é æœŸçš„ç¸½åˆ‡ç‰‡æ•¸ï¼ˆå¯é¸ï¼‰

    Returns:
        dict: ACK/Missing ç‹€æ…‹éŸ¿æ‡‰
    """
    if not received_chunks:
        return {
            "type": "status",
            "received_count": 0,
            "missing_chunks": [],
            "status": "waiting"
        }

    # è¨ˆç®—ç¼ºå¤±çš„åˆ‡ç‰‡
    min_chunk = min(received_chunks)
    max_chunk = max(received_chunks)

    # å¦‚æœæœ‰æŒ‡å®šç¸½æ•¸ï¼Œä½¿ç”¨ç¸½æ•¸ï¼›å¦å‰‡åŸºæ–¼æœ€å¤§åºè™Ÿæ¨æ¸¬
    total_expected = expected_total or (max_chunk + 1)

    expected_chunks = set(range(total_expected))
    missing_chunks = sorted(list(expected_chunks - received_chunks))

    return {
        "type": "status",
        "received_count": len(received_chunks),
        "expected_total": total_expected,
        "missing_chunks": missing_chunks,
        "status": "complete" if not missing_chunks else "incomplete"
    }


# END FILE CONTENTS


# File: frontend/package.json

{
  "name": "my-v0-project",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "build": "next build",
    "dev": "next dev",
    "lint": "next lint",
    "start": "next start",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:run": "vitest run",
    "e2e": "playwright test"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.1",
    "@radix-ui/react-accordion": "1.2.2",
    "@radix-ui/react-alert-dialog": "1.1.4",
    "@radix-ui/react-aspect-ratio": "1.1.1",
    "@radix-ui/react-avatar": "1.1.2",
    "@radix-ui/react-checkbox": "1.1.3",
    "@radix-ui/react-collapsible": "1.1.2",
    "@radix-ui/react-context-menu": "2.2.4",
    "@radix-ui/react-dialog": "1.1.4",
    "@radix-ui/react-dropdown-menu": "2.1.4",
    "@radix-ui/react-hover-card": "1.1.4",
    "@radix-ui/react-label": "2.1.1",
    "@radix-ui/react-menubar": "1.1.4",
    "@radix-ui/react-navigation-menu": "1.2.3",
    "@radix-ui/react-popover": "1.1.4",
    "@radix-ui/react-progress": "1.1.1",
    "@radix-ui/react-radio-group": "1.2.2",
    "@radix-ui/react-scroll-area": "1.2.2",
    "@radix-ui/react-select": "2.1.4",
    "@radix-ui/react-separator": "1.1.1",
    "@radix-ui/react-slider": "1.2.2",
    "@radix-ui/react-slot": "1.1.1",
    "@radix-ui/react-switch": "1.1.2",
    "@radix-ui/react-tabs": "1.1.2",
    "@radix-ui/react-toast": "1.2.4",
    "@radix-ui/react-toggle": "1.1.1",
    "@radix-ui/react-toggle-group": "1.1.1",
    "@radix-ui/react-tooltip": "1.1.6",
    "axios": "^1.10.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "1.0.4",
    "date-fns": "4.1.0",
    "easymde": "latest",
    "embla-carousel-react": "8.5.1",
    "input-otp": "1.4.1",
    "lucide-react": "^0.454.0",
    "next": "15.2.4",
    "next-themes": "^0.4.4",
    "react": "^19",
    "react-day-picker": "8.10.1",
    "react-dom": "^19",
    "react-hook-form": "^7.54.1",
    "react-resizable-panels": "^2.1.7",
    "react-simplemde-editor": "latest",
    "recharts": "2.15.0",
    "sonner": "^1.7.1",
    "tailwind-merge": "^2.5.5",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.6",
    "zod": "^3.24.1",
    "zustand": "^5.0.6"
  },
  "devDependencies": {
    "@playwright/test": "^1.44.1",
    "@testing-library/jest-dom": "^6.6.3",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^14.6.1",
    "@types/node": "^22",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "@vitejs/plugin-react": "^4.6.0",
    "@vitest/ui": "^3.2.4",
    "autoprefixer": "^10.4.20",
    "eslint": "^9",
    "eslint-config-next": "15.3.4",
    "jsdom": "^26.1.0",
    "postcss": "^8.5.0",
    "tailwindcss": "^3.4.17",
    "typescript": "^5",
    "vitest": "^3.2.4"
  },
  "packageManager": "pnpm@10.7.0+sha1.66453f13fbf9078d3db193718206a8d738afdbdb"
}


# END FILE CONTENTS


# File: app/services/stt/__init__.py

from .interfaces import ISTTProvider           # å°å¤–æš´éœ²
__all__ = ["ISTTProvider"]


# END FILE CONTENTS


# File: frontend/hooks/use-session.test.ts

// @ts-expect-error: jest types for test runner
import '@types/jest'
import '@testing-library/jest-dom'
import { renderHook, act } from '@testing-library/react'
import { useSession } from './use-session'

jest.mock('../lib/api', () => ({
    sessionAPI: {
        getSession: jest.fn(),
    },
}))

const { sessionAPI } = require('../lib/api')

describe('useSession - waitUntilCompleted', () => {
    beforeEach(() => {
        jest.clearAllMocks()
    })

    it('should resolve true immediately if session is completed', async () => {
        sessionAPI.getSession.mockResolvedValue({ status: 'completed' })
        const { result } = renderHook(() => useSession())
        await act(async () => {
            const ok = await result.current.waitUntilCompleted('sid', 1000)
            expect(ok).toBe(true)
        })
        expect(sessionAPI.getSession).toHaveBeenCalledTimes(1)
    })

    it('should poll until completed then resolve true', async () => {
        const states = [
            { status: 'processing' },
            { status: 'processing' },
            { status: 'completed' },
        ]
        let call = 0
        sessionAPI.getSession.mockImplementation(() => Promise.resolve(states[call++]))
        const { result } = renderHook(() => useSession())
        await act(async () => {
            const ok = await result.current.waitUntilCompleted('sid', 2000)
            expect(ok).toBe(true)
        })
        expect(sessionAPI.getSession).toHaveBeenCalledTimes(3)
    })

    it('should return false if timeout before completed', async () => {
        sessionAPI.getSession.mockResolvedValue({ status: 'processing' })
        const { result } = renderHook(() => useSession())
        await act(async () => {
            const ok = await result.current.waitUntilCompleted('sid', 1600)
            expect(ok).toBe(false)
        })
        // 1600ms / 1500ms = 2 æ¬¡
        expect(sessionAPI.getSession).toHaveBeenCalledTimes(2)
    })

    it('should ignore 404 and retry until timeout', async () => {
        const error = { response: { status: 404 }, isAxiosError: true }
        sessionAPI.getSession.mockRejectedValue(error)
        const { result } = renderHook(() => useSession())
        await act(async () => {
            const ok = await result.current.waitUntilCompleted('sid', 1600)
            expect(ok).toBe(false)
        })
        expect(sessionAPI.getSession).toHaveBeenCalledTimes(2)
    })

    it('should throw on non-404 error', async () => {
        const error = { response: { status: 500 }, isAxiosError: true }
        sessionAPI.getSession.mockRejectedValue(error)
        const { result } = renderHook(() => useSession())
        await expect(result.current.waitUntilCompleted('sid', 1000)).rejects.toEqual(error)
    })
})


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/simple-recording-service.test.ts

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { SimpleRecordingService } from '../simple-recording-service'

// Mock AdvancedAudioRecorder
vi.mock('../../advanced-audio-recorder', () => ({
    AdvancedAudioRecorder: vi.fn().mockImplementation(() => ({
        start: vi.fn(),
        stop: vi.fn(),
        cleanup: vi.fn(),
        onSegment: vi.fn(),
        onError: vi.fn(),
    }))
}))

// Mock RestAudioUploader
vi.mock('../rest-audio-uploader', () => ({
    RestAudioUploader: vi.fn().mockImplementation(() => ({
        uploadSegment: vi.fn(),
        retryFailedSegments: vi.fn(),
        getCachedSegmentsCount: vi.fn(),
        cleanup: vi.fn(),
        onUploadSuccess: vi.fn(),
        onUploadError: vi.fn(),
        onCacheStored: vi.fn(),
    }))
}))

describe('SimpleRecordingService', () => {
    let service: SimpleRecordingService
    let mockStream: MediaStream
    let origGetUserMedia: any

    beforeEach(() => {
        service = new SimpleRecordingService()
        mockStream = { getTracks: vi.fn() } as any
        origGetUserMedia = navigator.mediaDevices.getUserMedia
        navigator.mediaDevices.getUserMedia = vi.fn().mockResolvedValue(mockStream)
    })

    afterEach(() => {
        vi.restoreAllMocks()
        navigator.mediaDevices.getUserMedia = origGetUserMedia
    })

    it('æ‡‰è©²æ­£ç¢ºåˆå§‹åŒ– audioRecorder èˆ‡ audioUploader ä¸¦é–‹å§‹éŒ„éŸ³', async () => {
        await service.startRecording('test-session')
        // audioRecorder, audioUploader æ‡‰è¢«å»ºç«‹
        expect(service['audioRecorder']).toBeDefined()
        expect(service['audioUploader']).toBeDefined()
        expect(service['recordingState'].isRecording).toBe(true)
    })

    it('æ‡‰è©²è™•ç†éº¥å…‹é¢¨æ¬Šé™ä¸è¶³', async () => {
        navigator.mediaDevices.getUserMedia = vi.fn().mockRejectedValue(new Error('Permission denied'))
        await expect(service.startRecording('fail-session')).rejects.toThrow('Permission denied')
        expect(service['audioRecorder']).toBeNull()
        expect(service['audioUploader']).toBeNull()
        expect(service['recordingState'].isRecording).toBe(false)
        expect(service['recordingState'].error).toMatch(/Permission denied/)
    })

    it('æ‡‰è©²è™•ç†åˆå§‹åŒ–å¤±æ•—', async () => {
        // æ¨¡æ“¬ stream å­˜åœ¨ä½† initMediaRecorder å¤±æ•—
        service['stream'] = mockStream
        service['sessionId'] = 'fail-session'
        // å¼·åˆ¶è®“ initMediaRecorder æ‹‹å‡ºéŒ¯èª¤
        service['initMediaRecorder'] = vi.fn().mockImplementation(() => { throw new Error('Init failed') })
        await expect(service.startRecording('fail-session')).rejects.toThrow('Init failed')
        expect(service['audioRecorder']).toBeNull()
        expect(service['audioUploader']).toBeNull()
        expect(service['recordingState'].isRecording).toBe(false)
        expect(service['recordingState'].error).toMatch(/Init failed/)
    })

    it('æ‡‰è©²è™•ç†é‡è¤‡å•Ÿå‹•éŒ„éŸ³', async () => {
        await service.startRecording('session-1')
        // å†æ¬¡å•Ÿå‹•éŒ„éŸ³
        service['stopRecording'] = vi.fn().mockResolvedValue(undefined)
        await service.startRecording('session-2')
        expect(service['stopRecording']).toHaveBeenCalled()
        expect(service['audioRecorder']).toBeDefined()
        expect(service['audioUploader']).toBeDefined()
        expect(service['recordingState'].isRecording).toBe(true)
        expect(service['recordingState'].currentSessionId).toBe('session-2')
    })
})


# END FILE CONTENTS


# File: frontend/lib/services/interfaces.ts

"use client"

import type { SessionResponse, STTProvider } from '../api'
import type { BaseService } from './base-service'

/**
 * æœå‹™å±¤ä»‹é¢å®šç¾©
 *
 * æä¾›çµ±ä¸€çš„æœå‹™å¥‘ç´„ï¼Œç¢ºä¿é¡å‹å®‰å…¨å’Œä¸€è‡´æ€§
 */

/**
 * éŒ„éŸ³æµç¨‹å•Ÿå‹•çµæœ
 *
 * RecordingFlowService.startRecordingFlow() çš„è¿”å›é¡å‹
 * æˆåŠŸæ™‚ç›´æ¥è¿”å› SessionResponseï¼Œå¤±æ•—æ™‚æ‹‹å‡º Error
 */
export type StartRecordingResult = SessionResponse

/**
 * æœƒè©±ç®¡ç†æœå‹™ä»‹é¢
 */
export interface ISessionService {
  /**
   * ç¢ºä¿éŒ„éŸ³æœƒè©±å­˜åœ¨ - å„ªé›…è™•ç†æœƒè©±è¡çª
   *
   * ç­–ç•¥ï¼š
   * 1. å„ªå…ˆå˜—è©¦å‰µå»ºæ–°çš„éŒ„éŸ³æœƒè©±
   * 2. è‹¥é‡åˆ° 409 è¡çªï¼Œæ”¹ç‚ºç²å–ç¾æœ‰æ´»èºæœƒè©±
   * 3. ç¢ºä¿è¿”å›å¯ç”¨çš„éŒ„éŸ³æœƒè©±
   */
  ensureRecordingSession(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse>

  /**
   * å‰µå»ºéŒ„éŸ³æœƒè©±
   */
  createRecordingSession(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse>

  /**
   * å‰µå»ºç´”ç­†è¨˜æœƒè©±
   */
  createNoteSession(title?: string, content?: string): Promise<SessionResponse>

  /**
   * å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼
   */
  upgradeToRecording(sessionId: string): Promise<SessionResponse>

  /**
   * å®Œæˆæœƒè©±
   */
  finishSession(sessionId: string): Promise<void>

  /**
   * æª¢æŸ¥æ´»èºæœƒè©±
   */
  checkActiveSession(): Promise<SessionResponse | null>

  /**
   * ç­‰å¾…æœƒè©±åœ¨è³‡æ–™åº«ä¸­å®Œå…¨å¯è¦‹
   */
  waitForSessionReady(sessionId: string, maxWaitTime?: number): Promise<boolean>

  /**
   * åˆªé™¤æœƒè©±
   */
  deleteSession(sessionId: string): Promise<void>
}

/**
 * éŒ„éŸ³ç‹€æ…‹
 */
export interface RecordingState {
  isRecording: boolean
  recordingTime: number
  currentSessionId: string | null
  error: string | null
}

/**
 * éŒ„éŸ³æœå‹™ä»‹é¢
 */
export interface IRecordingService extends BaseService {
  /**
   * é–‹å§‹éŒ„éŸ³
   */
  startRecording(sessionId: string): Promise<void>

  /**
   * åœæ­¢éŒ„éŸ³
   */
  stopRecording(): Promise<void>

  /**
   * å–å¾—ç•¶å‰éŒ„éŸ³ç‹€æ…‹
   */
  getRecordingState(): RecordingState

  /**
   * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
   */
  isRecording(): boolean

  /**
   * å–å¾—éŒ„éŸ³æ™‚é–“ï¼ˆç§’ï¼‰
   */
  getRecordingTime(): number

  /**
   * è«‹æ±‚éŒ„éŸ³æ¬Šé™
   */
  requestPermission(): Promise<boolean>
}

/**
 * é€å­—ç¨¿è¨Šæ¯é¡å‹
 */
export interface TranscriptMessage {
  type: string
  text?: string
  start_time?: number
  end_time?: number
  chunk_sequence?: number
  start_sequence?: number
  confidence?: number
  timestamp?: number
  phase?: string
  message?: string
  error_type?: string
  error_message?: string
  details?: any
}

/**
 * é€å­—ç¨¿é …ç›®
 */
export interface TranscriptEntry {
  startTime?: number
  time: string
  text: string
}

/**
 * é€å­—ç¨¿æœå‹™ä»‹é¢
 */
export interface ITranscriptService {
  /**
   * é€£æ¥é€å­—ç¨¿æœå‹™
   */
  connect(sessionId: string): Promise<void>

  /**
   * æ–·é–‹é€å­—ç¨¿æœå‹™
   */
  disconnect(sessionId?: string): Promise<void>

  /**
   * æ·»åŠ é€å­—ç¨¿ç›£è½å™¨
   */
  addTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void

  /**
   * ç§»é™¤é€å­—ç¨¿ç›£è½å™¨
   */
  removeTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void

  /**
   * æª¢æŸ¥é€£æ¥ç‹€æ…‹
   */
  isConnected(sessionId: string): boolean

  /**
   * æ¸…é™¤é€å­—ç¨¿
   */
  clearTranscripts(sessionId: string): void

  /**
   * é–‹å§‹éŒ„éŸ³
   */
  start(sessionId: string): Promise<void>
}

/**
 * æœå‹™å®¹å™¨ä»‹é¢
 */
export interface IServiceContainer {
  /**
   * è¨»å†Šæœå‹™
   */
  register<T>(key: string, factory: () => T): void

  /**
   * è¨»å†Šå–®ä¾‹æœå‹™
   */
  registerSingleton<T>(key: string, factory: () => T): void

  /**
   * è§£ææœå‹™
   */
  resolve<T>(key: string): T

  /**
   * æª¢æŸ¥æœå‹™æ˜¯å¦å·²è¨»å†Š
   */
  isRegistered(key: string): boolean

  /**
   * å–å¾—å·²è¨»å†Šçš„æœå‹™æ¸…å–®
   */
  getRegisteredServices(): string[]
}

/**
 * æœå‹™è¨»å†Šéµå€¼å¸¸æ•¸
 * é¿å…å­—ä¸²æ‹¼å¯«éŒ¯èª¤ï¼Œæä¾›é¡å‹å®‰å…¨çš„æœå‹™éµå€¼
 */
export const SERVICE_KEYS = {
  SESSION_SERVICE: 'SessionService',
  RECORDING_SERVICE: 'RecordingService',
  TRANSCRIPT_SERVICE: 'TranscriptService',
  RECORDING_FLOW_SERVICE: 'RecordingFlowService'
} as const

/**
 * æœå‹™éµå€¼é¡å‹
 */
export type ServiceKey = typeof SERVICE_KEYS[keyof typeof SERVICE_KEYS]

/**
 * åŒ¯å‡ºæœå‹™é¡å‹æ˜ å°„
 * æä¾›ç·¨è­¯æ™‚é¡å‹æª¢æŸ¥
 */
export interface ServiceTypeMap {
  [SERVICE_KEYS.SESSION_SERVICE]: ISessionService
  [SERVICE_KEYS.RECORDING_SERVICE]: IRecordingService
  [SERVICE_KEYS.TRANSCRIPT_SERVICE]: ITranscriptService
}


# END FILE CONTENTS


# File: app/db/database.py

"""
StudyScriber Supabase è³‡æ–™åº«é€£æ¥é…ç½®

å°ˆç‚º Supabase PostgreSQL è¨­è¨ˆçš„è³‡æ–™åº«é€£æ¥æ¨¡çµ„
ä½¿ç”¨ Supabase å®¢æˆ¶ç«¯ API é€²è¡Œè³‡æ–™åº«æ“ä½œ
"""
import logging
from .supabase_config import get_supabase_client

# è¨­ç½®æ—¥èªŒ
logger = logging.getLogger(__name__)

def get_supabase_db():
    """
    å–å¾— Supabase å®¢æˆ¶ç«¯çš„ä¾è³´æ³¨å…¥å‡½å¼ã€‚

    å–ä»£èˆŠçš„ get_async_session å’Œ get_database_session_safeã€‚
    ç”¨æ–¼ FastAPI çš„ Depends()ã€‚
    """
    return get_supabase_client()

async def check_database_connection():
    """
    æª¢æŸ¥ Supabase è³‡æ–™åº«é€£æ¥ç‹€æ…‹
    """
    try:
        client = get_supabase_client()
        # å˜—è©¦åŸ·è¡Œä¸€å€‹ç°¡å–®çš„æŸ¥è©¢
        client.table('sessions').select("id").limit(1).execute()
        logger.info("âœ… Supabase è³‡æ–™åº«é€£æ¥æ­£å¸¸")
        return True
    except Exception as e:
        logger.error(f"âŒ Supabase è³‡æ–™åº«é€£æ¥å¤±æ•—: {e}")
        logger.error("ğŸ’¡ è«‹æª¢æŸ¥ SUPABASE_URL å’Œ SUPABASE_KEY ç’°å¢ƒè®Šæ•¸")
        return False

async def check_tables_exist() -> bool:
    """
    æª¢æŸ¥æ‰€æœ‰å¿…è¦çš„ Supabase è³‡æ–™åº«è¡¨æ ¼æ˜¯å¦å­˜åœ¨

    Returns:
        bool: å¦‚æœæ‰€æœ‰è¡¨æ ¼éƒ½å­˜åœ¨å‰‡å›å‚³ Trueï¼Œå¦å‰‡å›å‚³ False
    """
    required_tables = [
        'sessions',
        'audio_files',
        'transcript_segments',
        'transcripts',
        'notes'
    ]
    client = get_supabase_client()

    try:
        for table_name in required_tables:
            try:
                # å˜—è©¦æŸ¥è©¢è¡¨æ ¼ä¾†æª¢æŸ¥æ˜¯å¦å­˜åœ¨
                client.table(table_name).select("id", head=True).limit(1).execute()
                logger.info(f"âœ… è¡¨æ ¼ '{table_name}' å­˜åœ¨ä¸”å¯è¨ªå•")
            except Exception:
                logger.error(f"âŒ è¡¨æ ¼ '{table_name}' ä¸å­˜åœ¨æˆ–ç„¡æ³•è¨ªå•ã€‚")
                return False
        logger.info("âœ… æ‰€æœ‰æ ¸å¿ƒè¡¨æ ¼éƒ½å­˜åœ¨")
        return True
    except Exception as e:
        logger.error(f"âŒ æª¢æŸ¥è¡¨æ ¼æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
        return False

async def auto_init_database():
    """
    è‡ªå‹•æª¢æ¸¬ä¸¦åˆå§‹åŒ– Supabase è³‡æ–™åº«

    æª¢æŸ¥è¡¨æ ¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å‰‡æç¤ºä½¿ç”¨è€…æ‰‹å‹•åŸ·è¡Œ SQL è…³æœ¬
    """
    logger.info("ğŸ” æª¢æŸ¥ Supabase è³‡æ–™åº«è¡¨æ ¼ç‹€æ…‹...")

    if await check_tables_exist():
        logger.info("âœ… Supabase è³‡æ–™åº«è¡¨æ ¼å·²å­˜åœ¨ï¼Œè·³éåˆå§‹åŒ–")
        return

    logger.warning("ğŸš§ åµæ¸¬åˆ°ç¼ºå¤±çš„è¡¨æ ¼")
    logger.warning("ğŸ“‹ è«‹åœ¨ Supabase Dashboard çš„ SQL Editor ä¸­åŸ·è¡Œä»¥ä¸‹è…³æœ¬ï¼š")
    logger.warning("   app/db/supabase_init.sql")
    logger.warning("ğŸ’¡ æˆ–åƒè€ƒ README.md ä¸­çš„è©³ç´°è¨­å®šæŒ‡å—")

    raise RuntimeError(
        "è³‡æ–™åº«è¡¨æ ¼å°šæœªå»ºç«‹ã€‚è«‹åœ¨ Supabase Dashboard ä¸­åŸ·è¡Œ app/db/supabase_init.sql è…³æœ¬ã€‚"
    )

# ç‚ºäº†å…¼å®¹èˆŠçš„å‘½åï¼Œä¿ç•™ä¸€å€‹åˆ¥å
get_supabase_client_safe = get_supabase_db

# æ–°å¢ï¼šå›å‚³ç›®å‰è³‡æ–™åº«æ¨¡å¼ï¼ˆSupabase å›ºå®šï¼‰

def get_database_mode() -> str:
    """å–å¾—ç›®å‰è³‡æ–™åº«é€£ç·šæ¨¡å¼ã€‚"""
    return "supabase"


async def get_database_stats() -> dict:
    """å–å¾— Supabase è³‡æ–™åº«çµ±è¨ˆè³‡è¨Šï¼ˆç°¡æ˜“å ä½å¯¦ä½œï¼‰ã€‚"""
    # åœ¨å®Œæ•´å¯¦ä½œä¸­å¯ä»¥å‘¼å« Supabase RPC æˆ–è³‡è¨Šè¦–åœ–
    return {
        "tables": "unknown",
        "status": "placeholder",
    }


# END FILE CONTENTS


# File: frontend/components/recording-state.tsx

"use client"

import { RecordingWaitingState } from "./recording-waiting-state"
import { RecordingActiveState } from "./recording-active-state"
import type { TranscriptEntry } from "../types/app-state"

interface RecordingStateProps {
  transcriptEntries: TranscriptEntry[]
  recordingTime: number
  onStopRecording: () => void
  error?: string | null
}

export function RecordingState({ transcriptEntries, recordingTime, onStopRecording, error }: RecordingStateProps) {
  if (transcriptEntries.length === 0) {
    return (
      <RecordingWaitingState
        recordingTime={recordingTime}
        onStopRecording={onStopRecording}
        transcriptEntries={transcriptEntries}
        error={error}
      />
    )
  }
  return (
    <RecordingActiveState
      transcriptEntries={transcriptEntries}
      recordingTime={recordingTime}
      onStopRecording={onStopRecording}
    />
  )
}


# END FILE CONTENTS


# File: frontend/components/ui/hover-card.tsx

"use client"

import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }


# END FILE CONTENTS


# File: frontend/hooks/use-mobile.tsx

import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}


# END FILE CONTENTS


# File: README.md

# StudyScriber

> é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼šé‚ŠéŒ„é‚Šè½‰éŒ„ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³æ¨¡å¼

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

StudyScriber æ˜¯ä¸€å€‹å…ˆé€²çš„é›²ç«¯ç­†è¨˜æ‡‰ç”¨ç¨‹å¼ï¼Œå°ˆç‚ºå­¸ç¿’è€…å’Œå°ˆæ¥­äººå£«è¨­è¨ˆã€‚å®ƒæä¾›å…©ç¨®ä¸»è¦æ¨¡å¼ï¼š

- **ç´”ç­†è¨˜æ¨¡å¼**ï¼šå°ˆæ³¨æ–¼ Markdown ç­†è¨˜ç·¨è¼¯ï¼Œæ”¯æ´è‡ªå‹•å„²å­˜
- **éŒ„éŸ³æ¨¡å¼**ï¼šé‚ŠéŒ„éŸ³é‚Šåšç­†è¨˜ï¼Œå³æ™‚è½‰éŒ„ç‚ºé€å­—ç¨¿

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### å¾Œç«¯
- **FastAPI** - ç¾ä»£ Python Web æ¡†æ¶
- **Supabase PostgreSQL** - é›²ç«¯è³‡æ–™åº«å¹³å°
- **SQLAlchemy 2.0** - ORM èˆ‡è³‡æ–™åº«æŠ½è±¡å±¤
- **Supabase Python SDK** - å®˜æ–¹å®¢æˆ¶ç«¯
- **Azure OpenAI** - Whisper èªéŸ³è½‰éŒ„æœå‹™
- **Google Vertex AI** - Gemini 2.5 Pro èªéŸ³è½‰éŒ„æœå‹™
- **Cloudflare R2** - éŸ³æª”é›²ç«¯å„²å­˜

#### ğŸ¯ é›™ STT Provider æ¶æ§‹
StudyScriber æ”¯æ´å¤šç¨®èªéŸ³è½‰æ–‡å­—å¼•æ“ï¼Œä½¿ç”¨è€…å¯è‡ªç”±é¸æ“‡ï¼š

- **Whisper (Azure OpenAI)**ï¼šé«˜ç²¾ç¢ºåº¦ã€å¤šèªè¨€æ”¯æ´ã€å¿«é€ŸéŸ¿æ‡‰
- **Gemini 2.5 Pro (Vertex AI)**ï¼šæœ€æ–° AI æŠ€è¡“ã€ä¸Šä¸‹æ–‡ç†è§£ã€é«˜å“è³ªè½‰éŒ„

##### æŠ€è¡“ç‰¹è‰²ï¼š
- **çµ±ä¸€ä»‹é¢**ï¼šæ‰€æœ‰ STT Provider å¯¦ä½œç›¸åŒçš„ `ISTTProvider` ä»‹é¢
- **Factory æ¨¡å¼**ï¼šæ ¹æ“šæœƒè©±è¨­å®šå‹•æ…‹é¸æ“‡ Provider
- **ç‹€æ…‹ç®¡ç†**ï¼šæ¯å€‹æœƒè©±çš„ STT Provider ç¨ç«‹ç®¡ç†
- **å‰ç«¯æ•´åˆ**ï¼šçµ±ä¸€çš„ UI å…ƒä»¶æ”¯æ´ Provider åˆ‡æ›

#### ğŸš€ WebM ç›´æ¥è½‰éŒ„æ¶æ§‹ (v2)
StudyScriber æ¡ç”¨é©å‘½æ€§çš„ **WebM ç›´æ¥è½‰éŒ„æ¶æ§‹**ï¼Œå¤§å¹…æå‡æ•ˆèƒ½ï¼š

- **ç›´æ¥è½‰éŒ„æµç¨‹**ï¼šå‰ç«¯éŒ„éŸ³ (WebM) â†’ ç›´æ¥ç™¼é€åˆ° Whisper API â†’ å³æ™‚è½‰éŒ„
- **æ¶ˆé™¤è½‰æ›ç“¶é ¸**ï¼šè·³éæ¯å€‹ chunk çš„ FFmpeg è½‰æ›æ­¥é©Ÿï¼Œç¯€çœ 60% è™•ç†æ™‚é–“
- **éŒ¯èª¤ç‡é™ä½ 80%**ï¼šç§»é™¤ FFmpeg ç›¸é—œè½‰æ›éŒ¯èª¤é»
- **å‘å¾Œç›¸å®¹**ï¼šä¿ç•™ FFmpeg é‚è¼¯ç”¨æ–¼éŒ„éŸ³çµæŸå¾Œçš„ WAV æª”æ¡ˆç”Ÿæˆ

### å‰ç«¯
- **React** - ä½¿ç”¨è€…ä»‹é¢æ¡†æ¶
- **React Hooks** - ç‹€æ…‹ç®¡ç†
- **Socket.IO** - å³æ™‚é€šè¨Š
- **Markdown Editor** - ç­†è¨˜ç·¨è¼¯å™¨

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

- Python 3.12+
- **Supabase å¸³æˆ¶** 
- **Azure OpenAI å¸³æˆ¶** (å¿…é ˆï¼ŒWhisper èªéŸ³è½‰éŒ„æœå‹™)
- **Google Cloud å¸³æˆ¶** (å¯é¸ï¼ŒGemini 2.5 Pro èªéŸ³è½‰éŒ„æœå‹™)
- **Cloudflare å¸³æˆ¶** (å¯é¸ï¼ŒéŸ³æª”å„²å­˜)
- Node.js 18+ (å‰ç«¯é–‹ç™¼ç”¨)

### 1. å»ºç«‹ Supabase å°ˆæ¡ˆ

1. å‰å¾€ [Supabase](https://supabase.com) è¨»å†Šå¸³æˆ¶
2. å»ºç«‹æ–°å°ˆæ¡ˆï¼Œè¨˜ä¸‹ï¼š
   - **Project URL**: `https://your-project-ref.supabase.co`
   - **API Key**: åœ¨ Settings > API ä¸­æ‰¾åˆ° `anon public` é‡‘é‘°

### 2. è¨­å®šå°ˆæ¡ˆ

```bash
# å…‹éš†å°ˆæ¡ˆ
git clone <repository-url>
cd study-scriber

# å»ºç«‹è™›æ“¬ç’°å¢ƒ
python -m venv .venv
source .venv/bin/activate  # macOS/Linux
# æˆ– .venv\Scripts\activate  # Windows

# å®‰è£ä¾è³´
uv sync  # æˆ– pip install -e .
```

### 3. é…ç½®ç’°å¢ƒè®Šæ•¸

è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬ï¼š
```bash
cp .env.example .env
```

ç·¨è¼¯ `.env` æª”æ¡ˆï¼š
```env
# === Supabase è¨­å®š (å¿…é ˆ) ===
DB_MODE=supabase
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your-anon-public-key

# === Azure OpenAI æœå‹™ (Whisper STT - å¿…é ˆ) ===
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-01
WHISPER_DEPLOYMENT_NAME=whisper-1

# === Google Vertex AI æœå‹™ (Gemini STT - å¯é¸) ===
STT_PROVIDER_DEFAULT=whisper  # é è¨­ STT Provider: whisper æˆ– gemini
GEMINI_ENDPOINT=us-central1-aiplatform.googleapis.com  # Vertex AI ç«¯é»
GEMINI_API_KEY=your-gcp-service-account-key  # GCP æœå‹™å¸³æˆ¶ API Key
GEMINI_PROMPT=è«‹è¼¸å‡ºé€å­—ç¨¿ï¼š  # è‡ªè¨‚ Gemini æç¤ºè©
GEMINI_MAX_REQUESTS=90  # æ¯åˆ†é˜æœ€å¤§è«‹æ±‚æ•¸

# === Cloudflare R2 å„²å­˜ (å¯é¸) ===
R2_ACCOUNT_ID=your-account-id
R2_API_TOKEN=your-r2-api-token
R2_BUCKET_NAME=studyscriber-audio
```

### 4. åˆå§‹åŒ– Supabase è³‡æ–™åº«

#### æ–¹æ³• A: ä½¿ç”¨ Supabase Dashboard (æ¨è–¦)

1. é–‹å•Ÿ [Supabase Dashboard](https://supabase.com/dashboard)
2. é¸æ“‡æ‚¨çš„å°ˆæ¡ˆ
3. é»é¸å·¦å´é¸å–®çš„ **SQL Editor**
4. è¤‡è£½ `app/db/supabase_init.sql` æª”æ¡ˆçš„å®Œæ•´å…§å®¹
5. è²¼ä¸Šåˆ° SQL Editor ä¸­
6. é»é¸ **Run** åŸ·è¡Œ

#### æ–¹æ³• B: ä½¿ç”¨æŒ‡ä»¤è¡Œå·¥å…·

```bash
# å®‰è£ Supabase CLI (å¯é¸)
npm install -g supabase

# ç™»å…¥ä¸¦é€£æ¥å°ˆæ¡ˆ
supabase login
supabase link --project-ref your-project-ref

# åŸ·è¡Œåˆå§‹åŒ–è…³æœ¬
supabase db reset --linked
```

### 5. é©—è­‰è¨­å®š

åŸ·è¡Œæ•´åˆæ¸¬è©¦ï¼š
```bash
python test_final_integration.py
```

å¦‚æœçœ‹åˆ°ä»¥ä¸‹è¼¸å‡ºï¼Œè¡¨ç¤ºè¨­å®šæˆåŠŸï¼š
```
ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼StudyScriber T1 + T2 æ•´åˆå®Œå…¨æˆåŠŸï¼
âœ¨ ç¾åœ¨å¯ä»¥é–‹å§‹é–‹ç™¼ T3 (éŸ³æª”è™•ç†) å’Œ T4 (é€å­—ç¨¿) åŠŸèƒ½äº†ï¼
```

### 6. è¨­å®šå‰ç«¯ç’°å¢ƒè®Šæ•¸

```bash
cd frontend
cp .env.example .env.local
```

ç·¨è¼¯ `frontend/.env.local` æª”æ¡ˆï¼š
```env
# StudyScriber Frontend Environment Variables
NEXT_PUBLIC_API_URL=http://127.0.0.1:8000
NEXT_PUBLIC_WS_URL=ws://127.0.0.1:8000
NODE_ENV=development
```

### 7. é…ç½® STT Provider (å¯é¸)

StudyScriber æ”¯æ´å…©ç¨®èªéŸ³è½‰æ–‡å­—å¼•æ“ï¼š

#### Whisper (Azure OpenAI) - é è¨­
- é«˜ç²¾ç¢ºåº¦è½‰éŒ„
- å¤šèªè¨€æ”¯æ´
- å¿«é€ŸéŸ¿æ‡‰æ™‚é–“
- è¨­å®šï¼šåƒ…éœ€ Azure OpenAI ç›¸é—œç’°å¢ƒè®Šæ•¸

#### Gemini 2.5 Pro (Vertex AI) - å¯é¸
- æœ€æ–° AI æŠ€è¡“
- å„ªç§€çš„ä¸Šä¸‹æ–‡ç†è§£
- é«˜å“è³ªè½‰éŒ„çµæœ
- è¨­å®šï¼šéœ€é¡å¤–é…ç½® Google Cloud æœå‹™

##### å•Ÿç”¨ Gemini çš„æ­¥é©Ÿï¼š

1. **å»ºç«‹ Google Cloud å°ˆæ¡ˆ**
   - å‰å¾€ [Google Cloud Console](https://console.cloud.google.com/)
   - å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ
   - å•Ÿç”¨ Vertex AI API

2. **å»ºç«‹æœå‹™å¸³æˆ¶**
   - å‰å¾€ IAM & Admin > Service Accounts
   - å»ºç«‹æ–°çš„æœå‹™å¸³æˆ¶
   - ä¸‹è¼‰ JSON é‡‘é‘°æª”æ¡ˆ
   - å°‡é‡‘é‘°å…§å®¹è½‰æ›ç‚º API Key æ ¼å¼

3. **è¨­å®šç’°å¢ƒè®Šæ•¸**
   ```env
   STT_PROVIDER_DEFAULT=gemini
   GEMINI_ENDPOINT=us-central1-aiplatform.googleapis.com
   GEMINI_API_KEY=your-gcp-service-account-key
   ```

4. **UI ä¸­åˆ‡æ› Provider**
   - åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­é»æ“Šè¨­å®šæŒ‰éˆ•
   - é¸æ“‡ã€ŒèªéŸ³è½‰æ–‡å­—å¼•æ“ã€
   - åˆ‡æ›åˆ° Gemini 2.5 Pro

### 8. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

**é‡è¦ï¼šè«‹æŒ‰é †åºå•Ÿå‹•ï¼Œé¿å…åˆå§‹åŒ–ç«¶é€Ÿå•é¡Œ**

#### å¾Œç«¯ (Terminal 1) - å…ˆå•Ÿå‹•
```bash
uv run python main.py
```
ç­‰å¾…çœ‹åˆ°ä»¥ä¸‹è¨Šæ¯è¡¨ç¤º Backend å®Œå…¨å•Ÿå‹•ï¼š
```
ğŸš€ StudyScriber æ­£åœ¨å•Ÿå‹•...
âœ… Transcription service initialized and registered.
INFO:     Application startup complete.
```

#### å‰ç«¯ (Terminal 2) - å¾Œå•Ÿå‹•
```bash
cd frontend
pnpm install  # é¦–æ¬¡é‹è¡Œ
pnpm dev
```

- å¾Œç«¯ API æœå‹™ï¼š`http://localhost:8000`
- å‰ç«¯æ‡‰ç”¨ç¨‹å¼ï¼š`http://localhost:3000`

> **æ³¨æ„**: å¦‚æœå‰ç«¯å•Ÿå‹•æ™‚å‡ºç¾ç¶²è·¯éŒ¯èª¤ï¼Œé€™é€šå¸¸æ˜¯å› ç‚º Backend é‚„åœ¨å•Ÿå‹•ä¸­ã€‚æ–°ç‰ˆæœ¬å·²åŠ å…¥é‡è©¦æ©Ÿåˆ¶ï¼Œæœƒè‡ªå‹•è™•ç†é€™å€‹å•é¡Œã€‚

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
study-scriber/
â”œâ”€â”€ app/                          # FastAPI æ‡‰ç”¨ç¨‹å¼
â”‚   â”œâ”€â”€ api/                     # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ sessions.py         # Session ç®¡ç† API
â”‚   â”‚   â””â”€â”€ notes.py            # ç­†è¨˜ API
â”‚   â”œâ”€â”€ ws/                      # WebSocket ç«¯é»
â”‚   â”œâ”€â”€ services/                # æ¥­å‹™é‚è¼¯æœå‹™
â”‚   â”‚   â””â”€â”€ stt/                # STT Provider æœå‹™
â”‚   â”‚       â”œâ”€â”€ base.py         # ISTTProvider ä»‹é¢
â”‚   â”‚       â”œâ”€â”€ whisper_provider.py  # Whisper STT Provider
â”‚   â”‚       â”œâ”€â”€ gemini_provider.py   # Gemini STT Provider
â”‚   â”‚       â””â”€â”€ factory.py      # Provider Factory
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåŠŸèƒ½ (FFmpeg, etc.)
â”‚   â”œâ”€â”€ db/                      # è³‡æ–™åº«é…ç½®èˆ‡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ supabase_config.py  # Supabase é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ supabase_init.sql   # è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
â”‚   â”‚   â”œâ”€â”€ database.py         # è³‡æ–™åº«é€£æ¥
â”‚   â”‚   â””â”€â”€ models.py           # SQLAlchemy æ¨¡å‹
â”‚   â”œâ”€â”€ middleware/              # ä¸­ä»‹è»Ÿé«”
â”‚   â””â”€â”€ schemas/                 # Pydantic æ¨¡å‹
â”œâ”€â”€ test_final_integration.py    # æ•´åˆæ¸¬è©¦è…³æœ¬
â”œâ”€â”€ main.py                      # æ‡‰ç”¨ç¨‹å¼å…¥å£é»
â”œâ”€â”€ .env.example                 # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â””â”€â”€ pyproject.toml              # å°ˆæ¡ˆé…ç½®
```

## ğŸ¯ STT Provider åŠŸèƒ½

StudyScriber æ”¯æ´å¤šç¨®èªéŸ³è½‰æ–‡å­—å¼•æ“ï¼Œæä¾›æ›´å¤šé¸æ“‡å’Œéˆæ´»æ€§ï¼š

### æ”¯æ´çš„ STT Provider

| Provider | å¼•æ“ | ç‰¹è‰² | è¨­å®šé›£åº¦ |
|----------|------|------|----------|
| **Whisper** | Azure OpenAI | é«˜ç²¾ç¢ºåº¦ã€å¤šèªè¨€æ”¯æ´ã€å¿«é€ŸéŸ¿æ‡‰ | ç°¡å–® |
| **Gemini 2.5 Pro** | Google Vertex AI | æœ€æ–° AI æŠ€è¡“ã€ä¸Šä¸‹æ–‡ç†è§£ã€é«˜å“è³ªè½‰éŒ„ | ä¸­ç­‰ |

### åŠŸèƒ½ç‰¹è‰²

- **UI å³æ™‚åˆ‡æ›**ï¼šåœ¨è¨­å®šä¸­éš¨æ™‚åˆ‡æ› STT Provider
- **æœƒè©±ç´šåˆ¥ç®¡ç†**ï¼šæ¯å€‹æœƒè©±å¯ä½¿ç”¨ä¸åŒçš„ STT Provider
- **ç‹€æ…‹é¡¯ç¤º**ï¼šé€å­—ç¨¿ä¸­é¡¯ç¤º Provider å¾½ç«  (W/G)
- **çµ±ä¸€ä»‹é¢**ï¼šæ‰€æœ‰ Provider å›å‚³ç›¸åŒæ ¼å¼çš„è½‰éŒ„çµæœ
- **éŒ¯èª¤è™•ç†**ï¼šå„ Provider ç¨ç«‹çš„éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶

### ä½¿ç”¨æ–¹å¼

1. **é–‹å§‹éŒ„éŸ³å‰**ï¼šåœ¨è¨­å®šä¸­é¸æ“‡åå¥½çš„ STT Provider
2. **å»ºç«‹æœƒè©±**ï¼šç³»çµ±æœƒä½¿ç”¨æ‚¨é¸æ“‡çš„ Provider
3. **éŒ„éŸ³éç¨‹**ï¼šé€å­—ç¨¿æœƒé¡¯ç¤ºå°æ‡‰çš„ Provider å¾½ç« 
4. **æœƒè©±åˆ‡æ›**ï¼šä¸åŒæœƒè©±å¯ä½¿ç”¨ä¸åŒçš„ Provider

## ğŸ—„ï¸ Supabase è³‡æ–™åº«æ¶æ§‹

### ä¸»è¦è¡¨æ ¼

- **sessions** - æœƒè©±ç®¡ç†ï¼ˆç´”ç­†è¨˜æˆ–éŒ„éŸ³æ¨¡å¼ï¼‰ï¼Œæ”¯æ´ active/completed/error ç‹€æ…‹
- **notes** - Markdown ç­†è¨˜å…§å®¹ï¼Œæ”¯æ´å®¢æˆ¶ç«¯æ™‚é–“æˆ³è¡çªæª¢æ¸¬
- **audio_files** - éŸ³æª”åˆ‡ç‰‡è¨˜éŒ„
- **transcript_segments** - é€å­—ç¨¿ç‰‡æ®µ
- **transcripts** - å®Œæ•´é€å­—ç¨¿

### é—œéµç‰¹æ€§

- **UUID ä¸»éµ** - ä½¿ç”¨ `gen_random_uuid()` è‡ªå‹•ç”Ÿæˆ
- **è‡ªå‹•æ™‚é–“æˆ³** - é€éè§¸ç™¼å™¨è‡ªå‹•æ›´æ–° `updated_at`
- **å–®ä¸€æ´»èºæœƒè©±** - è³‡æ–™åº«å±¤ç´šä¿è­‰åŒæ™‚åªæœ‰ä¸€å€‹ active session
- **å®Œæ•´ç´„æŸ** - å¤–éµã€æª¢æŸ¥ç´„æŸã€å”¯ä¸€ç´„æŸç¢ºä¿è³‡æ–™å®Œæ•´æ€§
- **ç´šè¯åˆªé™¤** - åˆªé™¤ session æ™‚è‡ªå‹•æ¸…ç†é—œè¯è³‡æ–™

### è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬èªªæ˜

`app/db/supabase_init.sql` åŒ…å«ï¼š

1. **è‡ªå®šç¾©é¡å‹ (Enum)**
   - `session_type`: `'note_only'`, `'recording'`
   - `session_status`: `'active'`, `'completed'`, `'error'`
   - `lang_code`: `'zh-TW'`, `'en-US'`

2. **è¡¨æ ¼å»ºç«‹**
   - æ‰€æœ‰å¿…è¦çš„è¡¨æ ¼å’Œæ¬„ä½
   - é©ç•¶çš„è³‡æ–™é¡å‹å’Œç´„æŸ

3. **ç´¢å¼•å»ºç«‹**
   - æŸ¥è©¢æ•ˆèƒ½æœ€ä½³åŒ–
   - å”¯ä¸€ç´„æŸç¢ºä¿è³‡æ–™å®Œæ•´æ€§

4. **è§¸ç™¼å™¨è¨­å®š**
   - è‡ªå‹•æ›´æ–°æ™‚é–“æˆ³
   - å–®ä¸€æ´»èºæœƒè©±ä¿è­·

## ğŸ§ª æ¸¬è©¦

### å‰ç«¯å–®å…ƒæ¸¬è©¦

å°ˆæ¡ˆå·²æ•´åˆ **Vitest** æ¸¬è©¦æ¡†æ¶ï¼Œæä¾› API å±¤èˆ‡æ ¸å¿ƒåŠŸèƒ½çš„å–®å…ƒæ¸¬è©¦ã€‚

```bash
cd frontend

# åŸ·è¡Œæ¸¬è©¦
pnpm test

# åŸ·è¡Œæ¸¬è©¦ä¸¦é¡¯ç¤º UI
pnpm test:ui

# å–®æ¬¡åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pnpm test:run
```

### æ¸¬è©¦è¦†è“‹ç¯„åœ

- âœ… **API é…ç½®æ¸¬è©¦** - é©—è­‰ç’°å¢ƒè®Šæ•¸é…ç½®
- âœ… **WebSocket URL å»ºæ§‹** - ç¢ºä¿ URL æ­£ç¢ºç”Ÿæˆ
- âœ… **API æ–¹æ³•å­˜åœ¨æ€§** - é©—è­‰æ‰€æœ‰å¿…è¦çš„ API æ–¹æ³•

### æ–°å¢æ¸¬è©¦

æ¸¬è©¦æª”æ¡ˆä½æ–¼ï¼š
- `frontend/lib/api.test.ts` - API å±¤æ¸¬è©¦
- `frontend/src/test-setup.ts` - æ¸¬è©¦ç’°å¢ƒè¨­å®š

## ğŸ”§ é–‹ç™¼æŒ‡å—

### æ¸¬è©¦è³‡æ–™åº«é€£æ¥

```bash
# å®Œæ•´æ•´åˆæ¸¬è©¦
python test_final_integration.py

# å¿«é€Ÿé€£æ¥æ¸¬è©¦
python -c "
from app.db.supabase_config import get_supabase_client
client = get_supabase_client()
response = client.table('sessions').select('*').execute()
print(f'âœ… é€£æ¥æˆåŠŸï¼Œæ‰¾åˆ° {len(response.data)} å€‹ sessions')
"
```

### API æ–‡ä»¶

å•Ÿå‹•æœå‹™å¾Œï¼Œè¨ªå•ä»¥ä¸‹ç¶²å€æŸ¥çœ‹ API æ–‡ä»¶ï¼š

- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`

### å¥åº·æª¢æŸ¥

```bash
curl http://localhost:8000/health
```

## ğŸ› ï¸ Supabase ç®¡ç†

### æŸ¥çœ‹è³‡æ–™

åœ¨ Supabase Dashboard ä¸­ï¼š
1. é»é¸ **Table Editor**
2. ç€è¦½å„å€‹è¡¨æ ¼çš„è³‡æ–™
3. å¯ä»¥ç›´æ¥åœ¨ Dashboard ä¸­ç·¨è¼¯è³‡æ–™

### ç›£æ§æ•ˆèƒ½

åœ¨ Supabase Dashboard ä¸­ï¼š
1. é»é¸ **Logs**
2. æŸ¥çœ‹ API è«‹æ±‚è¨˜éŒ„
3. ç›£æ§è³‡æ–™åº«æ•ˆèƒ½æŒ‡æ¨™

### å‚™ä»½èˆ‡é‚„åŸ

Supabase è‡ªå‹•æä¾›ï¼š
- æ¯æ—¥è‡ªå‹•å‚™ä»½
- æ™‚é–“é»é‚„åŸ (Point-in-time recovery)
- å¯åœ¨ Dashboard çš„ **Settings > Database** ä¸­ç®¡ç†

## ğŸš¨ å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼é¸æ“‡ Supabaseï¼Ÿ

A: Supabase æä¾›ï¼š
- **å…è²»é¡åº¦å……è¶³** - é©åˆé–‹ç™¼å’Œå°å‹å°ˆæ¡ˆ
- **PostgreSQL å®Œæ•´åŠŸèƒ½** - æ”¯æ´è¤‡é›œæŸ¥è©¢å’Œç´„æŸ
- **å…§å»ºèªè­‰** - æœªä¾†æ“´å±•ä½¿ç”¨è€…ç³»çµ±
- **å³æ™‚åŠŸèƒ½** - æ”¯æ´ WebSocket å’Œå³æ™‚åŒæ­¥
- **å„²å­˜æœå‹™** - æ•´åˆéŸ³æª”å„²å­˜
- **99.9% å¯ç”¨æ€§** - ç”Ÿç”¢ç´šåˆ¥ç©©å®šæ€§

### Q: å¦‚ä½•é‡ç½®è³‡æ–™åº«ï¼Ÿ

A: åœ¨ Supabase Dashboard çš„ SQL Editor ä¸­åŸ·è¡Œï¼š
```sql
-- åˆªé™¤æ‰€æœ‰è¡¨æ ¼
DROP TABLE IF EXISTS notes CASCADE;
DROP TABLE IF EXISTS transcripts CASCADE;
DROP TABLE IF EXISTS transcript_segments CASCADE;
DROP TABLE IF EXISTS audio_files CASCADE;
DROP TABLE IF EXISTS sessions CASCADE;

-- åˆªé™¤è‡ªå®šç¾©é¡å‹
DROP TYPE IF EXISTS session_type CASCADE;
DROP TYPE IF EXISTS session_status CASCADE;
DROP TYPE IF EXISTS lang_code CASCADE;
```
ç„¶å¾Œé‡æ–°åŸ·è¡Œ `supabase_init.sql`ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹è©³ç´°éŒ¯èª¤ï¼Ÿ

A: åœ¨ `.env` ä¸­è¨­å®šï¼š
```env
DEBUG=true
```
é€™å°‡å•Ÿç”¨è©³ç´°çš„ SQL æŸ¥è©¢æ—¥èªŒã€‚

## ğŸ¤ è²¢ç»æŒ‡å—

1. Fork å°ˆæ¡ˆ
2. å»ºç«‹ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. ç¢ºä¿æ‰€æœ‰æ¸¬è©¦é€šé (`python test_final_integration.py`)
4. æäº¤è®Šæ›´ (`git commit -m 'Add amazing feature'`)
5. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
6. é–‹å•Ÿ Pull Request

## ğŸ“„ æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ã€‚è©³æƒ…è«‹è¦‹ [LICENSE](LICENSE) æª”æ¡ˆã€‚

## ğŸ”— ç›¸é—œé€£çµ

- **[ğŸ”§ éŸ³é »åˆ‡ç‰‡é…ç½®æŒ‡å—](AUDIO_CHUNK_CONFIG.md)** - ç’°å¢ƒè®Šæ•¸é…ç½®éŒ„éŸ³åˆ‡ç‰‡æ™‚é–“
- [å°ˆæ¡ˆéœ€æ±‚æ–‡ä»¶ (PRD)](PRD.md)
- [æŠ€è¡“è¦æ ¼æ›¸ (SPEC)](SPEC.md)
- [æ¸¬è©¦å ±å‘Š](T1_T4_Test_Final_Report.md)
- [é–‹ç™¼ä»»å‹™æ¸…å–®](Todos.md)
- [Supabase å®˜æ–¹æ–‡ä»¶](https://supabase.com/docs)
- [API æ–‡ä»¶](http://localhost:8000/docs)

---

**StudyScriber** - è®“å­¸ç¿’æ›´æœ‰æ•ˆç‡ ğŸš€


# END FILE CONTENTS


# File: frontend/hooks/use-toast.ts

"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }


# END FILE CONTENTS


# File: frontend/lib/services/transcript-service-adapted.ts

"use client"

import { BaseService } from './base-service'
import { ITranscriptService, TranscriptMessage } from './interfaces'
import { getTranscriptManager, type ITranscriptManager } from '../transcript-manager-adapter'

/**
 * é€å­—ç¨¿æœå‹™è³‡è¨Šä»‹é¢
 */
interface TranscriptServiceInfo {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    connectedSessions: string[]
    activeListeners: Record<string, number>
    totalConnections: number
    transcriptManagerConnections: number
    implementationType: 'refactored' | 'legacy'
}

/**
 * TranscriptService - é©é…å™¨ç‰ˆæœ¬
 *
 * ä½¿ç”¨ TranscriptManager é©é…å™¨ï¼Œæ ¹æ“šåŠŸèƒ½æ——æ¨™è‡ªå‹•é¸æ“‡å¯¦ç¾ï¼š
 * - æ–°çš„é‡æ§‹å¯¦ç¾ï¼ˆtranscript-manager-new.tsï¼‰
 * - èˆŠçš„å¯¦ç¾ï¼ˆtranscript-manager.tsï¼‰
 */
export class TranscriptServiceAdapted extends BaseService implements ITranscriptService {
    protected readonly serviceName = 'TranscriptServiceAdapted'

    private connectedSessions: Set<string> = new Set()
    private sessionListeners: Map<string, Set<(message: TranscriptMessage) => void>> = new Map()
    private transcriptManager: ITranscriptManager | null = null

    /**
     * å–å¾— TranscriptManager å¯¦ä¾‹ï¼ˆæ ¹æ“šåŠŸèƒ½æ——æ¨™å‹•æ…‹é¸æ“‡ï¼‰
     */
    private async getManager(): Promise<ITranscriptManager> {
        if (!this.transcriptManager) {
            this.transcriptManager = await getTranscriptManager()
            this.logInfo(`å·²è¼‰å…¥ TranscriptManager (${this.getCurrentImplementationType()})`)
        }
        return this.transcriptManager
    }

    /**
 * å–å¾—ç•¶å‰å¯¦ç¾é¡å‹
 */
    private getCurrentImplementationType(): 'refactored' | 'legacy' {
        try {
            const { getCurrentImplementation } = require('../transcript-manager-adapter')
            return getCurrentImplementation()
        } catch (error) {
            console.warn('âš ï¸ [TranscriptServiceAdapted] ç„¡æ³•å–å¾—å¯¦ç¾é¡å‹ï¼Œé è¨­ç‚º legacy')
            return 'legacy'
        }
    }

    /**
     * åˆå§‹åŒ–æœå‹™
     */
    async initialize(): Promise<void> {
        this.logInfo('åˆå§‹åŒ–é€å­—ç¨¿æœå‹™ (é©é…å™¨ç‰ˆæœ¬)')

        // é å…ˆè¼‰å…¥ TranscriptManager å¯¦ä¾‹
        await this.getManager()
        this.logSuccess(`TranscriptManager å·²è¼‰å…¥ (${this.getCurrentImplementationType()})`)
    }

    /**
     * æ¸…ç†æœå‹™è³‡æº
     */
    async cleanup(): Promise<void> {
        this.logInfo('æ¸…ç†é€å­—ç¨¿æœå‹™è³‡æº')

        // æ–·é–‹æ‰€æœ‰é€£æ¥
        const sessionIds = Array.from(this.connectedSessions)
        for (const sessionId of sessionIds) {
            await this.disconnect(sessionId)
        }

        this.connectedSessions.clear()
        this.sessionListeners.clear()
        this.transcriptManager = null // é‡ç½®å¯¦ä¾‹
    }

    /**
     * é€£æ¥é€å­—ç¨¿æœå‹™
     */
    async connect(sessionId: string): Promise<void> {
        if (!this.isRunning) {
            throw new Error('TranscriptService å°šæœªå•Ÿå‹•ï¼Œè«‹å…ˆèª¿ç”¨ start()')
        }

        try {
            this.logInfo(`é€£æ¥é€å­—ç¨¿æœå‹™: ${sessionId}`)

            // ä½¿ç”¨é©é…å™¨ç²å– TranscriptManager ä¸¦å»ºç«‹é€£æ¥
            const manager = await this.getManager()
            await manager.connect(sessionId)

            // è¨˜éŒ„é€£æ¥ç‹€æ…‹
            this.connectedSessions.add(sessionId)

            this.logSuccess(`é€å­—ç¨¿æœå‹™é€£æ¥æˆåŠŸ: ${sessionId} (${this.getCurrentImplementationType()})`)
        } catch (error) {
            this.handleError(`é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—: ${sessionId}`, error)
            throw error
        }
    }

    /**
     * æ–·é–‹é€å­—ç¨¿æœå‹™
     */
    async disconnect(sessionId?: string): Promise<void> {
        try {
            const manager = await this.getManager()

            if (sessionId) {
                this.logInfo(`æ–·é–‹é€å­—ç¨¿æœå‹™: ${sessionId}`)

                // ç§»é™¤æ‰€æœ‰ç›£è½å™¨ï¼ˆåƒ…é©ç”¨æ–¼èˆŠå¯¦ç¾ï¼‰
                const listeners = this.sessionListeners.get(sessionId)
                if (listeners && (manager as any).removeListener) {
                    listeners.forEach(callback => {
                        (manager as any).removeListener(sessionId, callback)
                    })
                    this.sessionListeners.delete(sessionId)
                }

                // æ–·é–‹é€£æ¥
                await manager.disconnect(sessionId)
                this.connectedSessions.delete(sessionId)

                this.logSuccess(`é€å­—ç¨¿æœå‹™æ–·é–‹æˆåŠŸ: ${sessionId}`)
            } else {
                // æ–·é–‹æ‰€æœ‰é€£æ¥
                this.logInfo('æ–·é–‹æ‰€æœ‰é€å­—ç¨¿æœå‹™é€£æ¥')
                await manager.disconnectAll()
                this.connectedSessions.clear()
                this.sessionListeners.clear()
            }
        } catch (error) {
            this.handleError(`æ–·é–‹é€å­—ç¨¿æœå‹™å¤±æ•—: ${sessionId || 'all'}`, error)
            throw error
        }
    }

    /**
     * æ·»åŠ é€å­—ç¨¿ç›£è½å™¨
     */
    addTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
        if (!this.isRunning) {
            throw new Error('TranscriptService å°šæœªå•Ÿå‹•ï¼Œè«‹å…ˆèª¿ç”¨ start()')
        }

        this.logInfo(`æ·»åŠ é€å­—ç¨¿ç›£è½å™¨: ${sessionId}`)

        // è¨˜éŒ„ç›£è½å™¨
        if (!this.sessionListeners.has(sessionId)) {
            this.sessionListeners.set(sessionId, new Set())
        }
        this.sessionListeners.get(sessionId)!.add(callback)

        // ç‚ºå…¼å®¹æ€§ï¼Œå˜—è©¦æ·»åŠ ç›£è½å™¨ï¼ˆèˆŠå¯¦ç¾ï¼‰
        this.getManager().then(manager => {
            if ((manager as any).addListener && typeof (manager as any).addListener === 'function') {
                try {
                    (manager as any).addListener(sessionId, callback)
                    this.logInfo(`å·²æ·»åŠ ç›£è½å™¨ (legacy API): ${sessionId}`)
                } catch (error) {
                    this.logWarning('èˆŠå¯¦ç¾ addListener èª¿ç”¨å¤±æ•—:', error)
                }
            } else {
                // æ–°å¯¦ç¾ä½¿ç”¨äº‹ä»¶é©…å‹•ï¼Œä¸éœ€è¦æ‰‹å‹•æ·»åŠ ç›£è½å™¨
                this.logInfo('æ–°å¯¦ç¾ä½¿ç”¨äº‹ä»¶é©…å‹•æ–¹å¼ï¼Œç„¡éœ€æ‰‹å‹•æ·»åŠ ç›£è½å™¨')
            }
        }).catch(error => {
            this.logWarning('æ·»åŠ ç›£è½å™¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error)
        })
    }

    /**
     * ç§»é™¤é€å­—ç¨¿ç›£è½å™¨
     */
    removeTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
        this.logInfo(`ç§»é™¤é€å­—ç¨¿ç›£è½å™¨: ${sessionId}`)

        // å¾è¨˜éŒ„ä¸­ç§»é™¤
        const listeners = this.sessionListeners.get(sessionId)
        if (listeners) {
            listeners.delete(callback)
            if (listeners.size === 0) {
                this.sessionListeners.delete(sessionId)
            }
        }

        // åªæœ‰èˆŠå¯¦ç¾æ‰æ”¯æ´ removeListener æ–¹æ³•
        this.getManager().then(manager => {
            if ((manager as any).removeListener) {
                (manager as any).removeListener(sessionId, callback)
            }
        })
    }

    /**
     * æª¢æŸ¥é€£æ¥ç‹€æ…‹
     */
    isConnected(sessionId: string): boolean {
        if (!this.transcriptManager) return false
        return this.transcriptManager.isConnected(sessionId)
    }

    /**
     * æ¸…é™¤é€å­—ç¨¿
     */
    clearTranscripts(sessionId: string): void {
        this.logInfo(`æ¸…é™¤é€å­—ç¨¿: ${sessionId}`)
        // TranscriptManager ä¸å„²å­˜é€å­—ç¨¿æ•¸æ“šï¼Œé€™å€‹æ–¹æ³•ä¸»è¦ç”¨æ–¼è§¸ç™¼ç‹€æ…‹æ¸…é™¤
        // å¯¦éš›çš„æ¸…é™¤é‚è¼¯æ‡‰è©²åœ¨ç‹€æ…‹ç®¡ç†å±¤å¯¦ç¾
    }

    /**
     * å–å¾—æœå‹™ç‹€æ…‹è³‡è¨Š
     */
    getServiceInfo(): TranscriptServiceInfo {
        return {
            serviceName: this.serviceName,
            isInitialized: this.isInitialized,
            isRunning: this.isRunning,
            connectedSessions: Array.from(this.connectedSessions),
            activeListeners: Object.fromEntries(
                Array.from(this.sessionListeners.entries()).map(([sessionId, listeners]) => [
                    sessionId,
                    listeners.size
                ])
            ),
            totalConnections: this.connectedSessions.size,
            transcriptManagerConnections: this.transcriptManager?.getConnectionCount() || 0,
            implementationType: this.getCurrentImplementationType()
        }
    }

    /**
     * å¼·åˆ¶é‡æ–°è¼‰å…¥ TranscriptManagerï¼ˆç”¨æ–¼åŠŸèƒ½æ——æ¨™è®Šæ›´å¾Œï¼‰
     */
    async reloadManager(): Promise<void> {
        this.logInfo('é‡æ–°è¼‰å…¥ TranscriptManager')

        // å…ˆæ–·é–‹æ‰€æœ‰é€£æ¥
        await this.cleanup()

        // é‡æ–°åˆå§‹åŒ–
        await this.initialize()

        this.logSuccess(`TranscriptManager å·²é‡æ–°è¼‰å…¥ (${this.getCurrentImplementationType()})`)
    }
}


# END FILE CONTENTS


# File: app/services/stt/gemini_provider.py

from __future__ import annotations

import base64
import logging
from datetime import datetime
from typing import Dict, Any
from uuid import UUID

import google.generativeai as genai

from app.core.config import get_settings
from app.core.ffmpeg import webm_to_pcm
from .base import ISTTProvider

logger = logging.getLogger(__name__)
settings = get_settings()


class GeminiProvider(ISTTProvider):
    """ä½¿ç”¨ Vertex AI Gemini 2.5 Pro çš„èªéŸ³è½‰æ–‡å­— Providerã€‚"""

    def __init__(self) -> None:
        # å»¶é²è¼‰å…¥ï¼Œé¿å…æœªè¨­å®š API Key ä»å»ºç«‹ç‰©ä»¶
        self._model: genai.GenerativeModel | None = None

    # ------------- ä»‹é¢å¯¦ä½œ -------------
    def name(self) -> str:  # type: ignore[override]
        return "gemini"

    def max_rpm(self) -> int:  # type: ignore[override]
        return settings.GEMINI_MAX_REQUESTS if hasattr(settings, "GEMINI_MAX_REQUESTS") else 60

    async def transcribe(self, webm: bytes, session_id: UUID, chunk_seq: int) -> Dict[str, Any]:  # type: ignore[override]
        """å°‡ WebM è½‰ç‚º PCMï¼Œé€è‡³ Gemini å–å¾—çµæœã€‚"""
        logger.info(f"ğŸ™ï¸ [Gemini] é–‹å§‹è½‰éŒ„ chunk {chunk_seq} (session {session_id})")

        # åˆå§‹åŒ–æ¨¡å‹
        if self._model is None:
            try:
                # ä½¿ç”¨æ–°ç‰ˆ google-generativeai éœ€è¦å…ˆå…¨åŸŸè¨­å®š API Key
                genai.configure(api_key=settings.GEMINI_API_KEY)
                # å»ºç«‹æ¨¡å‹ï¼Œä¸å†æ¥å— api_key/base_url åƒæ•¸
                self._model = genai.GenerativeModel("gemini-2.5-pro-preview")
            except Exception as e:
                logger.error(f"[Gemini] åˆå§‹åŒ–æ¨¡å‹å¤±æ•—: {e}")
                raise

        # 1. è½‰æª”
        pcm_bytes = await webm_to_pcm(webm)

        # 2. çµ„ prompt
        prompt = getattr(settings, "GEMINI_PROMPT", "è«‹è¼¸å‡ºé€å­—ç¨¿ï¼š")

        # 3. å‘¼å« API - ä½¿ç”¨ inline_data æ–¹å¼å‚³ééŸ³è¨Š (ç¬¦åˆæ–°ç‰ˆ google-generativeai SDK)
        try:
            from google.generativeai import types as genai_types  # type: ignore

            parts = [
                {"text": prompt},
                genai_types.Part.from_bytes(data=pcm_bytes, mime_type="audio/wav"),
            ]

            res = await self._model.generate_content_async(contents=parts)

            text = res.text.strip() if hasattr(res, "text") else ""
        except Exception as e:
            logger.error(f"[Gemini] è½‰éŒ„å¤±æ•—: {e}")
            raise

        logger.info(f"âœ… [Gemini] chunk {chunk_seq} è½‰éŒ„å®Œæˆï¼Œé•·åº¦ {len(text)} å­—")
        return {
            "text": text,
            "chunk_sequence": chunk_seq,
            "session_id": str(session_id),
            "timestamp": datetime.utcnow().isoformat(),
            "start_time": chunk_seq * settings.AUDIO_CHUNK_DURATION_SEC,
            "end_time": (chunk_seq + 1) * settings.AUDIO_CHUNK_DURATION_SEC,
            "provider": self.name(),
        }


# END FILE CONTENTS


# File: app/schemas/note.py

"""
StudyScriber Note Pydantic æ¨¡å‹

å®šç¾©ç­†è¨˜ç›¸é—œçš„è«‹æ±‚å’ŒéŸ¿æ‡‰æ¨¡å‹
"""

from datetime import datetime
from typing import Optional
from uuid import UUID
from pydantic import BaseModel, Field, ConfigDict, field_validator


class NoteSaveRequest(BaseModel):
    """å„²å­˜ç­†è¨˜è«‹æ±‚"""
    content: str = Field(description="ç­†è¨˜å…§å®¹ï¼ˆMarkdown æ ¼å¼ï¼‰")
    client_ts: Optional[datetime] = Field(None, description="å®¢æˆ¶ç«¯æ™‚é–“æˆ³")

    @field_validator('content')
    @classmethod
    def validate_content_length(cls, v: str) -> str:
        """é©—è­‰ç­†è¨˜å…§å®¹é•·åº¦ï¼ˆé™åˆ¶ 1MBï¼‰"""
        if len(v.encode('utf-8')) > 1024 * 1024:  # 1MB limit
            raise ValueError('ç­†è¨˜å…§å®¹è¶…é 1MB é™åˆ¶')
        return v


class NoteOut(BaseModel):
    """ç­†è¨˜è¼¸å‡ºæ¨¡å‹"""
    model_config = ConfigDict(
        from_attributes=True,
        json_encoders={UUID: str}  # æ·»åŠ  UUID åˆ°å­—ä¸²çš„åºåˆ—åŒ–å™¨
    )

    session_id: UUID = Field(description="æœƒè©± ID")
    content: str = Field(description="ç­†è¨˜å…§å®¹")
    updated_at: datetime = Field(description="ä¼ºæœå™¨æ›´æ–°æ™‚é–“")
    client_ts: Optional[datetime] = Field(None, description="å®¢æˆ¶ç«¯æ™‚é–“æˆ³")


class NoteSaveResponse(BaseModel):
    """ç­†è¨˜å„²å­˜éŸ¿æ‡‰"""
    success: bool = Field(description="å„²å­˜æ˜¯å¦æˆåŠŸ")
    message: str = Field(description="å›æ‡‰è¨Šæ¯")
    server_ts: datetime = Field(description="ä¼ºæœå™¨æ™‚é–“æˆ³")
    note: Optional[NoteOut] = Field(None, description="æ›´æ–°å¾Œçš„ç­†è¨˜è³‡æ–™")


class NoteConflictError(BaseModel):
    """ç­†è¨˜è¡çªéŒ¯èª¤ï¼ˆå®¢æˆ¶ç«¯æ™‚é–“æˆ³è¼ƒèˆŠï¼‰"""
    model_config = ConfigDict(json_encoders={UUID: str})

    error: str = Field("note_conflict", description="éŒ¯èª¤é¡å‹")
    message: str = Field(description="éŒ¯èª¤è¨Šæ¯")
    server_note: NoteOut = Field(description="ä¼ºæœå™¨ç«¯è¼ƒæ–°çš„ç­†è¨˜è³‡æ–™")
    client_ts: Optional[datetime] = Field(None, description="å®¢æˆ¶ç«¯æ™‚é–“æˆ³")
    server_ts: datetime = Field(description="ä¼ºæœå™¨æ™‚é–“æˆ³")


# END FILE CONTENTS


# File: frontend/lib/advanced-audio-recorder.ts

"use client"

import { getAudioChunkIntervalMs } from './config'

/**
 * AdvancedAudioRecorder - é€²éšåˆ†æ®µéŸ³è¨ŠéŒ„è£½å™¨
 *
 * Phase 2.5 WebM Header ä¿®å¾©ï¼šå¯¦ä½œç„¡ç¸« MediaRecorder åˆ‡æ›ç­–ç•¥
 * è§£æ±º MediaRecorder.start(timeslice) åªåœ¨ç¬¬ä¸€å€‹æ®µè½åŒ…å«å®Œæ•´ container header çš„å•é¡Œ
 *
 * æ ¸å¿ƒç­–ç•¥ï¼š
 * - å¯é…ç½®æ™‚é–“é‡æ–°å‰µå»º MediaRecorder å¯¦ä¾‹
 * - ä½¿ç”¨é å»ºç­–ç•¥ï¼šæå‰å‰µå»ºä¸‹ä¸€å€‹ MediaRecorderï¼Œé¿å…å»ºç«‹å»¶é²
 * - ç„¡ç¸«è§’è‰²è½‰æ›ï¼šstopâ†’start é–“éš™ â‰ˆ 1-3ms
 * - ç¢ºä¿æ¯å€‹æ®µè½éƒ½åŒ…å«å®Œæ•´ WebM EBML header
 * - æ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®åˆ‡ç‰‡æ™‚é–“
 */

export interface AudioSegment {
    blob: Blob
    timestamp: number
    duration: number
    sequence: number
}

export interface AdvancedAudioRecorderConfig {
    segmentDuration: number // æ®µè½æ™‚é•·ï¼ˆæ¯«ç§’ï¼‰
    mimeType: string
    audioBitsPerSecond: number
}

const DEFAULT_CONFIG: AdvancedAudioRecorderConfig = {
    segmentDuration: getAudioChunkIntervalMs(), // å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
    mimeType: 'audio/webm;codecs=opus',
    audioBitsPerSecond: 128000, // 128 kbps for configurable chunks
}

export class AdvancedAudioRecorder {
    private stream: MediaStream | null = null
    private config: AdvancedAudioRecorderConfig
    private isRecording: boolean = false
    private sequence: number = 0

    // é›™ MediaRecorder ç­–ç•¥
    private currentRecorder: MediaRecorder | null = null
    private nextRecorder: MediaRecorder | null = null
    private swapTimer: ReturnType<typeof setTimeout> | null = null

    // äº‹ä»¶å›èª¿
    private onSegmentCallback?: (segment: AudioSegment) => void
    private onErrorCallback?: (error: Error) => void

    constructor(config: Partial<AdvancedAudioRecorderConfig> = {}) {
        this.config = { ...DEFAULT_CONFIG, ...config }
    }

    /**
     * åˆå§‹åŒ–éŒ„éŸ³å™¨ - ç²å–éŸ³è¨Šæ¬Šé™
     */
    async initialize(): Promise<void> {
        if (this.stream) {
            return // å·²åˆå§‹åŒ–
        }

        try {
            this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })
            console.log('ğŸ¤ [AdvancedAudioRecorder] éŸ³è¨Šæ¬Šé™ç²å–æˆåŠŸ')
        } catch (error) {
            const errorMsg = error instanceof Error ? error.message : 'ç²å–éŸ³è¨Šæ¬Šé™å¤±æ•—'
            this.handleError(new Error(errorMsg))
            throw error
        }
    }

    /**
     * é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨é›™ MediaRecorder ç„¡ç¸«åˆ‡æ›ç­–ç•¥
     */
    async start(onSegmentAvailable: (segment: AudioSegment) => void): Promise<void> {
        if (this.isRecording) {
            throw new Error('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
        }

        if (!this.stream) {
            await this.initialize()
        }

        this.onSegmentCallback = onSegmentAvailable
        this.sequence = 0
        this.isRecording = true

        console.log('ğŸ¬ [AdvancedAudioRecorder] é–‹å§‹é€²éšéŒ„éŸ³', {
            segmentDuration: this.config.segmentDuration,
            mimeType: this.config.mimeType,
            audioBitsPerSecond: this.config.audioBitsPerSecond
        })

        // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦
        if (!this.checkMediaRecorderSupport()) {
            throw new Error('ç€è¦½å™¨ä¸æ”¯æ´æ‰€éœ€çš„éŸ³é »éŒ„è£½åŠŸèƒ½')
        }

        try {
            // å•Ÿå‹•é›™ MediaRecorder ç­–ç•¥
            await this.initializeRecorders()
            this.startCurrentRecorder()
            this.scheduleNextSwap()

            console.log('âœ… [AdvancedAudioRecorder] é›™ MediaRecorder ç­–ç•¥å•Ÿå‹•æˆåŠŸ')
        } catch (error) {
            this.isRecording = false
            this.handleError(error instanceof Error ? error : new Error('å•Ÿå‹•éŒ„éŸ³å¤±æ•—'))
            throw error
        }
    }

    /**
     * åœæ­¢éŒ„éŸ³
     */
    stop(): void {
        console.log('â¹ï¸ [AdvancedAudioRecorder] åœæ­¢é€²éšéŒ„éŸ³')

        this.isRecording = false

        // æ¸…é™¤åˆ‡æ›è¨ˆæ™‚å™¨
        if (this.swapTimer) {
            clearTimeout(this.swapTimer)
            this.swapTimer = null
        }

        // åœæ­¢ç•¶å‰éŒ„éŸ³å™¨
        if (this.currentRecorder && this.currentRecorder.state !== 'inactive') {
            this.currentRecorder.stop()
        }

        // æ¸…ç†ä¸‹ä¸€å€‹éŒ„éŸ³å™¨
        this.cleanupRecorder(this.nextRecorder)
        this.nextRecorder = null
    }

    /**
     * æ¸…ç†è³‡æº
     */
    cleanup(): void {
        this.stop()

        if (this.stream) {
            this.stream.getTracks().forEach(track => track.stop())
            this.stream = null
        }

        this.cleanupRecorder(this.currentRecorder)
        this.cleanupRecorder(this.nextRecorder)
        this.currentRecorder = null
        this.nextRecorder = null
        this.sequence = 0

        console.log('ğŸ§¹ [AdvancedAudioRecorder] å·²æ¸…ç†')
    }

    /**
     * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
     */
    get recording(): boolean {
        return this.isRecording
    }

    /**
     * ç²å–ç•¶å‰åºè™Ÿ
     */
    get currentSequence(): number {
        return this.sequence
    }

    /**
     * é‡ç½®åºè™Ÿ
     */
    resetSequence(): void {
        this.sequence = 0
        console.log('ğŸ”„ [AdvancedAudioRecorder] åºè™Ÿå·²é‡ç½®ç‚º 0')
    }

    /**
     * ç²å–ç•¶å‰é…ç½®
     */
    get currentConfig(): AdvancedAudioRecorderConfig {
        return { ...this.config }
    }

    // ============ ç§æœ‰æ–¹æ³• ============

    /**
     * æª¢æŸ¥ MediaRecorder æ”¯æ´åº¦
     */
    private checkMediaRecorderSupport(): boolean {
        if (!window.MediaRecorder) {
            this.handleError(new Error('ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API'))
            return false
        }

        if (!MediaRecorder.isTypeSupported(this.config.mimeType)) {
            this.handleError(new Error(`ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${this.config.mimeType}`))
            return false
        }

        return true
    }

    /**
     * åˆå§‹åŒ–é›™ MediaRecorder
     */
    private async initializeRecorders(): Promise<void> {
        try {
            this.currentRecorder = this.createMediaRecorder()
            this.nextRecorder = this.createMediaRecorder()
            console.log('ğŸ”„ [AdvancedAudioRecorder] é›™ MediaRecorder åˆå§‹åŒ–å®Œæˆ')
        } catch (error) {
            throw new Error(`MediaRecorder åˆå§‹åŒ–å¤±æ•—: ${error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'}`)
        }
    }

    /**
     * å‰µå»º MediaRecorder å¯¦ä¾‹
     */
    private createMediaRecorder(): MediaRecorder {
        if (!this.stream) {
            throw new Error('éŸ³è¨Šæµæœªåˆå§‹åŒ–')
        }

        const recorder = new MediaRecorder(this.stream, {
            mimeType: this.config.mimeType,
            audioBitsPerSecond: this.config.audioBitsPerSecond,
        })

        // è¨­å®šäº‹ä»¶è™•ç†
        recorder.ondataavailable = (event) => {
            if (event.data.size > 0 && this.isRecording) {
                console.log(`ğŸ“¦ [AdvancedAudioRecorder] æ®µè½ #${this.sequence} å®Œæˆ`, {
                    size: event.data.size,
                    mimeType: this.config.mimeType,
                    hasCompleteHeader: true // æ¯å€‹æ®µè½éƒ½æœ‰å®Œæ•´æª”é ­
                })

                const segment: AudioSegment = {
                    blob: event.data,
                    timestamp: Date.now(),
                    duration: this.config.segmentDuration,
                    sequence: this.sequence++,
                }

                // å›èª¿é€šçŸ¥æœ‰æ–°æ®µè½å¯ç”¨
                this.onSegmentCallback?.(segment)
            }
        }

        recorder.onerror = (event) => {
            console.error('âŒ [AdvancedAudioRecorder] MediaRecorder éŒ¯èª¤:', event)
            this.handleError(new Error(`MediaRecorder éŒ¯èª¤: ${event}`))
        }

        return recorder
    }

    /**
     * å•Ÿå‹•ç•¶å‰éŒ„éŸ³å™¨
     */
    private startCurrentRecorder(): void {
        if (!this.currentRecorder) {
            throw new Error('ç•¶å‰éŒ„éŸ³å™¨æœªåˆå§‹åŒ–')
        }

        console.log(`ğŸµ [AdvancedAudioRecorder] é–‹å§‹éŒ„éŸ³æ®µè½ #${this.sequence}`)
        this.currentRecorder.start() // ä¸ä½¿ç”¨ timesliceï¼Œè®“ stop() è§¸ç™¼å®Œæ•´æ®µè½
    }

    /**
     * æ’ç¨‹ä¸‹ä¸€æ¬¡åˆ‡æ›
     */
    private scheduleNextSwap(): void {
        if (!this.isRecording) return

        this.swapTimer = setTimeout(() => {
            if (this.isRecording) {
                this.swapRecorders()
            }
        }, this.config.segmentDuration)
    }

    /**
     * åŸ·è¡Œ MediaRecorder è§’è‰²è½‰æ›
     */
    private swapRecorders(): void {
        try {
            console.log('ğŸ”„ [AdvancedAudioRecorder] åŸ·è¡Œ MediaRecorder åˆ‡æ›')

            // æ­¥é©Ÿ 1: åœæ­¢ç•¶å‰éŒ„éŸ³å™¨ï¼ˆè§¸ç™¼ dataavailableï¼‰
            if (this.currentRecorder && this.currentRecorder.state === 'recording') {
                this.currentRecorder.stop()
            }

            // æ­¥é©Ÿ 2: å•Ÿå‹•å‚™ç”¨éŒ„éŸ³å™¨
            if (this.nextRecorder) {
                this.nextRecorder.start()
                console.log(`ğŸµ [AdvancedAudioRecorder] åˆ‡æ›åˆ°æ®µè½ #${this.sequence}`)
            }

            // æ­¥é©Ÿ 3: è§’è‰²è½‰æ›
            const oldRecorder = this.currentRecorder
            this.currentRecorder = this.nextRecorder

            // æ­¥é©Ÿ 4: æº–å‚™ä¸‹ä¸€å€‹éŒ„éŸ³å™¨
            try {
                this.nextRecorder = this.createMediaRecorder()
            } catch (error) {
                console.error('âŒ [AdvancedAudioRecorder] å‰µå»ºä¸‹ä¸€å€‹éŒ„éŸ³å™¨å¤±æ•—:', error)
                this.handleError(error instanceof Error ? error : new Error('å‰µå»ºéŒ„éŸ³å™¨å¤±æ•—'))
                return
            }

            // æ­¥é©Ÿ 5: æ¸…ç†èˆŠéŒ„éŸ³å™¨
            this.cleanupRecorder(oldRecorder)

            // æ­¥é©Ÿ 6: æ’ç¨‹ä¸‹ä¸€æ¬¡åˆ‡æ›
            if (this.isRecording) {
                this.scheduleNextSwap()
            }

        } catch (error) {
            console.error('âŒ [AdvancedAudioRecorder] åˆ‡æ›éŒ„éŸ³å™¨å¤±æ•—:', error)
            this.handleError(error instanceof Error ? error : new Error('åˆ‡æ›éŒ„éŸ³å™¨å¤±æ•—'))
        }
    }

    /**
     * æ¸…ç† MediaRecorder
     */
    private cleanupRecorder(recorder: MediaRecorder | null): void {
        if (!recorder) return

        try {
            if (recorder.state !== 'inactive') {
                recorder.stop()
            }
        } catch (error) {
            console.warn('âš ï¸ [AdvancedAudioRecorder] æ¸…ç†éŒ„éŸ³å™¨æ™‚ç™¼ç”Ÿè­¦å‘Š:', error)
        }
    }

    /**
     * éŒ¯èª¤è™•ç†
     */
    private handleError(error: Error): void {
        console.error('âŒ [AdvancedAudioRecorder] éŒ¯èª¤:', error)
        this.isRecording = false
        this.onErrorCallback?.(error)
    }

    // ============ äº‹ä»¶å›èª¿è¨­å®š ============

    onSegment(callback: (segment: AudioSegment) => void): void {
        this.onSegmentCallback = callback
    }

    onError(callback: (error: Error) => void): void {
        this.onErrorCallback = callback
    }
}

/**
 * æª¢æŸ¥é€²éšéŸ³è¨ŠéŒ„è£½æ”¯æ´
 */
export async function checkAdvancedAudioRecordingSupport(): Promise<{ isSupported: boolean; error?: string }> {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API' }
    }

    if (!window.MediaRecorder) {
        return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API' }
    }

    // æª¢æŸ¥ MIME é¡å‹æ”¯æ´
    if (!MediaRecorder.isTypeSupported(DEFAULT_CONFIG.mimeType)) {
        return { isSupported: false, error: `ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${DEFAULT_CONFIG.mimeType}` }
    }

    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
        // ç«‹å³åœæ­¢ä¸²æµä»¥é‡‹æ”¾è³‡æº
        stream.getTracks().forEach(track => track.stop())
        return { isSupported: true }
    } catch (error) {
        return { isSupported: false, error: `ç„¡æ³•ç²å–éº¥å…‹é¢¨æ¬Šé™: ${error}` }
    }
}


# END FILE CONTENTS


# File: frontend/components/ui/pagination.tsx

import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}


# END FILE CONTENTS


# File: frontend/lib/rest-audio-uploader.ts

"use client"

/**
 * RestAudioUploader - REST API éŸ³é »ä¸Šå‚³å™¨
 *
 * Phase 2 é‡æ§‹ï¼šæ›¿æ› WebSocket ç‚º REST API ä¸Šå‚³
 *
 * ç‰¹é»ï¼š
 * - ä½¿ç”¨ fetch POST `/api/segment` ä¸Šå‚³å®Œæ•´ 10s æª”æ¡ˆ
 * - å¯¦ä½œä¸Šå‚³éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
 * - ä½¿ç”¨ IndexedDB æš«å­˜å¤±æ•—çš„æª”æ¡ˆ
 * - ç°¡åŒ–çš„éŒ¯èª¤è™•ç†æµç¨‹
 */

import { appConfig } from './config'

export interface UploadSegmentResponse {
    ack: number
    size: number
    status: 'success' | 'error'
    error?: string
}

export interface FailedSegment {
    sessionId: string
    sequence: number
    blob: Blob
    timestamp: number
    retryCount: number
}

export class RestAudioUploader {
    private sessionId: string | null = null
    private uploadQueue: Map<number, Blob> = new Map()
    private retryCount: Map<number, number> = new Map()
    private maxRetries = 3

    // äº‹ä»¶å›èª¿
    private onUploadSuccessCallback?: (seq: number, response: UploadSegmentResponse) => void
    private onUploadErrorCallback?: (seq: number, error: string) => void
    private onCacheStoredCallback?: (seq: number) => void

    constructor() {
        if (typeof window !== 'undefined') {
            this.initIndexedDB()
        }
    }

    /**
     * åˆå§‹åŒ– IndexedDB å­˜å„²
     */
    private async initIndexedDB(): Promise<void> {
        if (typeof window === 'undefined' || !window.indexedDB) {
            console.warn('âš ï¸ [RestAudioUploader] IndexedDB ä¸å¯ç”¨ï¼ˆæœå‹™å™¨ç«¯æ¸²æŸ“ï¼‰')
            return
        }

        return new Promise((resolve, reject) => {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onerror = () => {
                console.error('âŒ [RestAudioUploader] IndexedDB é–‹å•Ÿå¤±æ•—')
                reject(new Error('IndexedDB åˆå§‹åŒ–å¤±æ•—'))
            }

            request.onsuccess = () => {
                console.log('âœ… [RestAudioUploader] IndexedDB åˆå§‹åŒ–æˆåŠŸ')
                resolve()
            }

            request.onupgradeneeded = (event) => {
                const db = (event.target as IDBOpenDBRequest).result

                if (!db.objectStoreNames.contains('failedSegments')) {
                    const store = db.createObjectStore('failedSegments', { keyPath: 'id' })
                    store.createIndex('sessionId', 'sessionId', { unique: false })
                    store.createIndex('timestamp', 'timestamp', { unique: false })
                }
            }
        })
    }

    /**
     * è¨­å®š session ID
     */
    setSessionId(sessionId: string): void {
        this.sessionId = sessionId
        console.log('ğŸ¯ [RestAudioUploader] Session ID è¨­å®š:', sessionId)
    }

    /**
     * é‡ç½®åºè™Ÿå’Œä¸Šå‚³ç‹€æ…‹
     */
    resetSequence(): void {
        this.uploadQueue.clear()
        this.retryCount.clear()
        console.log('ğŸ”„ [RestAudioUploader] ä¸Šå‚³ç‹€æ…‹å·²é‡ç½®')
    }

    /**
     * ä¸Šå‚³éŸ³é »æ®µè½
     */
    async uploadSegment(sequence: number, blob: Blob): Promise<UploadSegmentResponse> {
        if (!this.sessionId) {
            throw new Error('Session ID æœªè¨­å®š')
        }

        console.log(`ğŸ“¤ [RestAudioUploader] æº–å‚™ä¸Šå‚³æ®µè½ #${sequence}`, {
            size: blob.size,
            mimeType: blob.type,
            sessionId: this.sessionId
        })

        try {
            const formData = new FormData()
            formData.append('file', blob, `seg${sequence}.webm`)

            const response = await fetch(`${appConfig.apiUrl}/api/segment?sid=${this.sessionId}&seq=${sequence}`, {
                method: 'POST',
                body: formData
            })

            if (!response.ok) {
                if (response.status === 409) {
                    // 409 è¦–ç‚ºå†ªç­‰æˆåŠŸ
                    console.log(`âœ… [RestAudioUploader] æ®µè½ #${sequence} å·²å­˜åœ¨ï¼Œè¦–ç‚ºä¸Šå‚³æˆåŠŸ`)
                    const successResponse = { ack: sequence, size: blob.size, status: 'success' as const }
                    
                    // é‡ç½®é‡è©¦è¨ˆæ•¸
                    this.retryCount.delete(sequence)
                    
                    // è§¸ç™¼æˆåŠŸå›èª¿
                    this.onUploadSuccessCallback?.(sequence, successResponse)
                    
                    return successResponse
                }
                throw new Error(`HTTP ${response.status}: ${response.statusText}`)
            }

            const result: UploadSegmentResponse = await response.json()

            console.log(`âœ… [RestAudioUploader] æ®µè½ #${sequence} ä¸Šå‚³æˆåŠŸ`, result)

            // é‡ç½®é‡è©¦è¨ˆæ•¸
            this.retryCount.delete(sequence)

            // è§¸ç™¼æˆåŠŸå›èª¿
            this.onUploadSuccessCallback?.(sequence, result)

            return result

        } catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'ä¸Šå‚³å¤±æ•—'
            console.error(`âŒ [RestAudioUploader] æ®µè½ #${sequence} ä¸Šå‚³å¤±æ•—:`, errorMessage)

            // è™•ç†é‡è©¦é‚è¼¯
            await this.handleUploadFailure(sequence, blob, errorMessage)

            throw new Error(errorMessage)
        }
    }

    /**
     * è™•ç†ä¸Šå‚³å¤±æ•— - é‡è©¦æˆ–æš«å­˜
     */
    private async handleUploadFailure(sequence: number, blob: Blob, error: string): Promise<void> {
        const currentRetries = this.retryCount.get(sequence) || 0

        if (currentRetries < this.maxRetries) {
            // å˜—è©¦é‡è©¦
            this.retryCount.set(sequence, currentRetries + 1)
            console.log(`ğŸ”„ [RestAudioUploader] æ®µè½ #${sequence} æº–å‚™é‡è©¦ (${currentRetries + 1}/${this.maxRetries})`)

            // å»¶é²é‡è©¦ï¼ˆæ¼¸é€²å¼å»¶é²ï¼‰
            const delay = Math.pow(2, currentRetries) * 1000 // 1s, 2s, 4s
            setTimeout(() => {
                this.retryUpload(sequence, blob)
            }, delay)

        } else {
            // é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼Œæš«å­˜åˆ° IndexedDB
            console.warn(`âš ï¸ [RestAudioUploader] æ®µè½ #${sequence} é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼Œæš«å­˜åˆ°æœ¬åœ°`)
            await this.cacheFailedSegment(sequence, blob)

            // è§¸ç™¼éŒ¯èª¤å›èª¿
            this.onUploadErrorCallback?.(sequence, `é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸: ${error}`)
        }
    }

    /**
     * é‡è©¦ä¸Šå‚³
     */
    private async retryUpload(sequence: number, blob: Blob): Promise<void> {
        try {
            await this.uploadSegment(sequence, blob)
        } catch (error) {
            // é‡è©¦å¤±æ•—æœƒå†æ¬¡è§¸ç™¼ handleUploadFailure
            console.log(`âš ï¸ [RestAudioUploader] æ®µè½ #${sequence} é‡è©¦å¤±æ•—`)
        }
    }

    /**
     * æš«å­˜å¤±æ•—çš„æ®µè½åˆ° IndexedDB
     */
    private async cacheFailedSegment(sequence: number, blob: Blob): Promise<void> {
        if (!this.sessionId || typeof window === 'undefined' || !window.indexedDB) return

        try {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onsuccess = () => {
                const db = request.result
                const transaction = db.transaction(['failedSegments'], 'readwrite')
                const store = transaction.objectStore('failedSegments')

                const failedSegment: FailedSegment = {
                    sessionId: this.sessionId!,
                    sequence,
                    blob,
                    timestamp: Date.now(),
                    retryCount: this.retryCount.get(sequence) || 0
                }

                const addRequest = store.put({
                    id: `${this.sessionId}_${sequence}`,
                    ...failedSegment
                })

                addRequest.onsuccess = () => {
                    console.log(`ğŸ’¾ [RestAudioUploader] æ®µè½ #${sequence} å·²æš«å­˜åˆ°æœ¬åœ°`)
                    this.onCacheStoredCallback?.(sequence)
                }

                addRequest.onerror = () => {
                    console.error(`âŒ [RestAudioUploader] æ®µè½ #${sequence} æš«å­˜å¤±æ•—`)
                }
            }

        } catch (error) {
            console.error('âŒ [RestAudioUploader] IndexedDB æš«å­˜éŒ¯èª¤:', error)
        }
    }

    /**
     * é‡æ–°ä¸Šå‚³æš«å­˜çš„å¤±æ•—æ®µè½
     */
    async retryFailedSegments(): Promise<void> {
        if (!this.sessionId || typeof window === 'undefined' || !window.indexedDB) return

        try {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onsuccess = () => {
                const db = request.result
                const transaction = db.transaction(['failedSegments'], 'readonly')
                const store = transaction.objectStore('failedSegments')
                const index = store.index('sessionId')
                const getRequest = index.getAll(this.sessionId)

                getRequest.onsuccess = async () => {
                    const failedSegments = getRequest.result

                    if (failedSegments.length === 0) {
                        console.log('âœ… [RestAudioUploader] æ²’æœ‰æš«å­˜çš„å¤±æ•—æ®µè½')
                        return
                    }

                    console.log(`ğŸ”„ [RestAudioUploader] ç™¼ç¾ ${failedSegments.length} å€‹æš«å­˜æ®µè½ï¼Œé–‹å§‹é‡æ–°ä¸Šå‚³`)

                    for (const segment of failedSegments) {
                        try {
                            await this.uploadSegment(segment.sequence, segment.blob)

                            // ä¸Šå‚³æˆåŠŸï¼Œå¾ IndexedDB ä¸­ç§»é™¤
                            await this.removeFailedSegment(`${segment.sessionId}_${segment.sequence}`)

                        } catch (error) {
                            console.warn(`âš ï¸ [RestAudioUploader] æš«å­˜æ®µè½ #${segment.sequence} é‡æ–°ä¸Šå‚³å¤±æ•—`)
                        }
                    }
                }
            }

        } catch (error) {
            console.error('âŒ [RestAudioUploader] é‡æ–°ä¸Šå‚³æš«å­˜æ®µè½å¤±æ•—:', error)
        }
    }

    /**
     * å¾ IndexedDB ä¸­ç§»é™¤æˆåŠŸä¸Šå‚³çš„æ®µè½
     */
    private async removeFailedSegment(id: string): Promise<void> {
        if (typeof window === 'undefined' || !window.indexedDB) return

        try {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onsuccess = () => {
                const db = request.result
                const transaction = db.transaction(['failedSegments'], 'readwrite')
                const store = transaction.objectStore('failedSegments')

                const deleteRequest = store.delete(id)
                deleteRequest.onsuccess = () => {
                    console.log(`ğŸ—‘ï¸ [RestAudioUploader] å·²ç§»é™¤æš«å­˜æ®µè½: ${id}`)
                }
            }

        } catch (error) {
            console.error('âŒ [RestAudioUploader] ç§»é™¤æš«å­˜æ®µè½å¤±æ•—:', error)
        }
    }

    /**
     * ç²å–æš«å­˜çš„å¤±æ•—æ®µè½æ•¸é‡
     */
    async getCachedSegmentsCount(): Promise<number> {
        if (!this.sessionId || typeof window === 'undefined' || !window.indexedDB) return 0

        return new Promise((resolve) => {
            const request = indexedDB.open('AudioSegmentCache', 1)

            request.onsuccess = () => {
                const db = request.result
                const transaction = db.transaction(['failedSegments'], 'readonly')
                const store = transaction.objectStore('failedSegments')
                const index = store.index('sessionId')
                const countRequest = index.count(this.sessionId!)

                countRequest.onsuccess = () => {
                    resolve(countRequest.result)
                }

                countRequest.onerror = () => {
                    resolve(0)
                }
            }

            request.onerror = () => {
                resolve(0)
            }
        })
    }

    /**
     * æ¸…ç†è³‡æº
     */
    cleanup(): void {
        this.sessionId = null
        this.uploadQueue.clear()
        this.retryCount.clear()
        console.log('ğŸ§¹ [RestAudioUploader] å·²æ¸…ç†')
    }

    // äº‹ä»¶å›èª¿è¨­å®š
    onUploadSuccess(callback: (seq: number, response: UploadSegmentResponse) => void): void {
        this.onUploadSuccessCallback = callback
    }

    onUploadError(callback: (seq: number, error: string) => void): void {
        this.onUploadErrorCallback = callback
    }

    onCacheStored(callback: (seq: number) => void): void {
        this.onCacheStoredCallback = callback
    }
}

// é è¨­å¯¦ä¾‹
export const restAudioUploader = new RestAudioUploader()


# END FILE CONTENTS


# File: .cursorignore

/node_modules
/build
/temp
/xnotes
/.claude
/__pycache__
CLAUDE.local.md

# END FILE CONTENTS


# File: app/db/supabase_config.py

"""
StudyScriber Supabase é…ç½®ç®¡ç†

æ•´åˆ Supabase è³‡æ–™åº«èˆ‡ SQLAlchemy ORM
"""

import os
import re
from typing import Optional
from dotenv import load_dotenv
from supabase import create_client, Client

# è¼‰å…¥ç’°å¢ƒè®Šæ•¸
load_dotenv()

class SupabaseConfig:
    """Supabase é…ç½®ç®¡ç†é¡åˆ¥"""

    def __init__(self):
        self.supabase_url = os.getenv("SUPABASE_URL")
        self.supabase_key = os.getenv("SUPABASE_KEY")  # å¯ä»¥æ˜¯ anon key æˆ– service key
        self.db_mode = os.getenv("DB_MODE")

    def is_configured(self) -> bool:
        """æª¢æŸ¥ Supabase æ˜¯å¦å·²æ­£ç¢ºé…ç½®"""
        return (
            self.db_mode == "supabase" and
            bool(self.supabase_url) and
            bool(self.supabase_key)
        )

    def get_database_url(self) -> str:
        """
        æ ¹æ“šè¨­å®šæ¨¡å¼å›å‚³è³‡æ–™åº«é€£æ¥å­—ä¸²

        Returns:
            str: PostgreSQL é€£æ¥å­—ä¸²
        """
        if self.db_mode == "supabase":
            if not self.supabase_url or not self.supabase_key:
                raise ValueError("SUPABASE_URL å’Œ SUPABASE_KEY æ˜¯å¿…é ˆçš„")

            # å¾ Supabase URL æå– PostgreSQL é€£æ¥è³‡è¨Š
            # Supabase URL æ ¼å¼: https://your-project-ref.supabase.co
            # PostgreSQL é€£æ¥æ ¼å¼: postgresql+asyncpg://postgres:[password]@db.your-project-ref.supabase.co:5432/postgres

            # æå–å°ˆæ¡ˆ ID
            url_match = re.match(r'https://([^.]+)\.supabase\.co', self.supabase_url)
            if not url_match:
                raise ValueError(f"ç„¡æ•ˆçš„ Supabase URL æ ¼å¼: {self.supabase_url}")

            project_ref = url_match.group(1)

            # ä½¿ç”¨ service_role key ä½œç‚ºå¯†ç¢¼ï¼ˆå¦‚æœæä¾›çš„æ˜¯ service_role keyï¼‰
            # å¦‚æœæ˜¯ anon keyï¼Œæˆ‘å€‘éœ€è¦ä½¿ç”¨ä¸åŒçš„æ–¹æ³•
            if self.supabase_key.startswith('eyJ'):  # JWT token (anon key)
                # å°æ–¼ anon keyï¼Œæˆ‘å€‘ä¸èƒ½ç›´æ¥é€£æ¥ PostgreSQLï¼Œå¿…é ˆä½¿ç”¨ Supabase å®¢æˆ¶ç«¯
                # é€™è£¡æˆ‘å€‘å›å‚³ä¸€å€‹ç‰¹æ®Šçš„æ¨™è­˜ç¬¦ï¼Œè®“ database.py çŸ¥é“è¦ä½¿ç”¨ Supabase å®¢æˆ¶ç«¯
                return f"supabase+client://{project_ref}"
            else:
                # å‡è¨­æ˜¯ service_role keyï¼Œå¯ä»¥ç›´æ¥é€£æ¥ PostgreSQL
                return f"postgresql+asyncpg://postgres:{self.supabase_key}@db.{project_ref}.supabase.co:5432/postgres"
        else:
            # ä½¿ç”¨æœ¬åœ°è³‡æ–™åº«
            return os.getenv(
                "DATABASE_URL",
                "postgresql+asyncpg://postgres:password@localhost:5432/studyscriber"
            )

    def get_client(self) -> Optional[Client]:
        """
        å»ºç«‹ Supabase å®¢æˆ¶ç«¯é€£æ¥

        Returns:
            Optional[Client]: Supabase å®¢æˆ¶ç«¯å¯¦ä¾‹ï¼Œå¦‚æœæ˜¯æœ¬åœ°æ¨¡å¼å‰‡å›å‚³ None
        """
        if self.is_configured():
            return create_client(self.supabase_url, self.supabase_key)
        return None

    def is_supabase_mode(self) -> bool:
        """æª¢æŸ¥æ˜¯å¦ç‚º Supabase æ¨¡å¼"""
        return self.db_mode == "supabase"


# å…¨åŸŸé…ç½®å¯¦ä¾‹
supabase_config = SupabaseConfig()

# ä¾¿åˆ©å‡½å¼
def get_supabase_client() -> Client:
    """ç²å– Supabase å®¢æˆ¶ç«¯å¯¦ä¾‹"""
    client = supabase_config.get_client()
    if client is None:
        raise ValueError("Supabase å®¢æˆ¶ç«¯ç„¡æ³•åˆå§‹åŒ–ï¼Œè«‹æª¢æŸ¥ç’°å¢ƒé…ç½®")
    return client


# END FILE CONTENTS


# File: app/lib/httpx_timeout.py

from httpx import Timeout
from app.core.config import get_settings

def get_httpx_timeout() -> Timeout:
    """
    ä¾æ“šè¨­å®šæª”å›å‚³ httpx.Timeout ç‰©ä»¶ã€‚
    é€™æ¨£ä»»ä½• provider å¼•ç”¨æ™‚éƒ½ä¸æœƒ NameErrorã€‚
    """
    s = get_settings()
    return Timeout(
        connect=s.HTTPX_CONNECT_TIMEOUT,   # e.g. 5
        read=s.HTTPX_READ_TIMEOUT,         # 55
        write=s.HTTPX_WRITE_TIMEOUT,       # 30
        pool=s.HTTPX_POOL_TIMEOUT,         # 5
    )


# END FILE CONTENTS


# File: app/__init__.py

"""
StudyScriber API Application

é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼šé‚ŠéŒ„é‚Šè½‰éŒ„ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³æ¨¡å¼
"""

__version__ = "0.1.0"


# END FILE CONTENTS


# File: frontend/components/ui/tabs.tsx

"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/session-service-409.test.ts

/**
 * SessionService 409 è¡çªè™•ç†æ¸¬è©¦
 *
 * æ¸¬è©¦ ensureRecordingSession æ–¹æ³•åœ¨é‡åˆ°æœƒè©±è¡çªæ™‚çš„è™•ç†é‚è¼¯
 */

import { describe, test, expect, vi, beforeEach, afterEach } from 'vitest'
import { SessionService } from '../session-service'
import { sessionAPI } from '../../api'
import type { SessionResponse } from '../../api'

// Mock sessionAPI
vi.mock('../../api', () => ({
    sessionAPI: {
        createSession: vi.fn(),
        getActiveSession: vi.fn(),
        upgradeToRecording: vi.fn(),
        finishSession: vi.fn(),
        deleteSession: vi.fn()
    }
}))

describe('SessionService - 409 è¡çªè™•ç†', () => {
    let sessionService: SessionService
    const mockSessionAPI = sessionAPI as any

    // æ¸¬è©¦ç”¨çš„æœƒè©±æ•¸æ“š
    const mockExistingSession: SessionResponse = {
        id: 'existing-session-123',
        title: 'ç¾æœ‰éŒ„éŸ³æœƒè©±',
        type: 'recording',
        status: 'active',
        language: 'zh-TW',
        created_at: '2024-01-01T00:00:00Z',
        updated_at: '2024-01-01T00:00:00Z'
    }

    const mockNewSession: SessionResponse = {
        id: 'new-session-456',
        title: 'æ–°éŒ„éŸ³æœƒè©±',
        type: 'recording',
        status: 'active',
        language: 'zh-TW',
        created_at: '2024-01-01T01:00:00Z',
        updated_at: '2024-01-01T01:00:00Z'
    }

    const mockNoteSession: SessionResponse = {
        id: 'note-session-789',
        title: 'ç¾æœ‰ç­†è¨˜æœƒè©±',
        type: 'note_only',
        status: 'active',
        language: 'zh-TW',
        created_at: '2024-01-01T02:00:00Z',
        updated_at: '2024-01-01T02:00:00Z'
    }

    beforeEach(() => {
        sessionService = new SessionService()
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('ensureRecordingSession - æˆåŠŸæƒ…å¢ƒ', () => {
        test('ç•¶æ²’æœ‰ç¾æœ‰æœƒè©±æ™‚ï¼Œæ‡‰è©²æˆåŠŸå‰µå»ºæ–°çš„éŒ„éŸ³æœƒè©±', async () => {
            // Arrange
            mockSessionAPI.createSession.mockResolvedValueOnce(mockNewSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(result).toEqual(mockNewSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'æ¸¬è©¦æ¨™é¡Œ',
                type: 'recording',
                content: undefined
            })
            expect(mockSessionAPI.getActiveSession).not.toHaveBeenCalled()
        })
    })

    describe('ensureRecordingSession - 409 è¡çªè™•ç†', () => {
        test('ç•¶å‰µå»ºæœƒè©±é‡åˆ° 409 è¡çªæ™‚ï¼Œæ‡‰è©²ç²å–ç¾æœ‰çš„éŒ„éŸ³æœƒè©±', async () => {
            // Arrange
            const conflictError = {
                response: {
                    status: 409,
                    data: { detail: 'å·²æœ‰æ´»èºæœƒè©±' }
                },
                isAxiosError: true
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockExistingSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(result).toEqual(mockExistingSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'æ¸¬è©¦æ¨™é¡Œ',
                type: 'recording',
                content: undefined
            })
            expect(mockSessionAPI.getActiveSession).toHaveBeenCalledOnce()
        })

        test('ç•¶é‡åˆ° 409 ä½†ç¾æœ‰æœƒè©±æ˜¯ç­†è¨˜æœƒè©±æ™‚ï¼Œæ‡‰è©²å‡ç´šç‚ºéŒ„éŸ³æœƒè©±', async () => {
            // Arrange
            const conflictError = {
                response: { status: 409 },
                isAxiosError: true
            }

            const upgradedSession: SessionResponse = {
                ...mockNoteSession,
                type: 'recording'
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            // ç¬¬ä¸€æ¬¡èª¿ç”¨ - ensureRecordingSession ä¸­æª¢æŸ¥ç¾æœ‰æœƒè©±
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockNoteSession)
            // ç¬¬äºŒæ¬¡èª¿ç”¨ - upgradeToRecording ä¸­æª¢æŸ¥æœƒè©±ç‹€æ…‹
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockNoteSession)
            mockSessionAPI.upgradeToRecording.mockResolvedValueOnce(upgradedSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')

            // Assert
            expect(result).toEqual(upgradedSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalled()
            expect(mockSessionAPI.getActiveSession).toHaveBeenCalledTimes(2)
            expect(mockSessionAPI.upgradeToRecording).toHaveBeenCalledWith(mockNoteSession.id)
        })

        test('ç•¶é‡åˆ° 409 ä½†ç„¡æ³•ç²å–ç¾æœ‰æœƒè©±æ™‚ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Arrange
            const conflictError = {
                response: { status: 409 },
                isAxiosError: true
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(null)

            // Act & Assert
            await expect(
                sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')
            ).rejects.toThrow('æœƒè©±è¡çªä½†ç„¡æ³•ç²å–ç¾æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢')

            expect(mockSessionAPI.createSession).toHaveBeenCalled()
            expect(mockSessionAPI.getActiveSession).toHaveBeenCalledOnce()
        })

        test('ç•¶é‡åˆ°é 409 éŒ¯èª¤æ™‚ï¼Œæ‡‰è©²ç›´æ¥æ‹‹å‡ºåŸéŒ¯èª¤', async () => {
            // Arrange
            const networkError = new Error('ç¶²è·¯é€£æ¥å¤±æ•—')
            mockSessionAPI.createSession.mockRejectedValueOnce(networkError)

            // Act & Assert
            await expect(
                sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ')
            ).rejects.toThrow()

            expect(mockSessionAPI.createSession).toHaveBeenCalled()
            expect(mockSessionAPI.getActiveSession).not.toHaveBeenCalled()
        })
    })

    describe('ensureRecordingSession - é‚Šç·£æƒ…æ³', () => {
        test('ç•¶æ¨™é¡Œç‚ºç©ºæ™‚ï¼Œæ‡‰è©²ä½¿ç”¨é è¨­æ¨™é¡Œ', async () => {
            // Arrange
            mockSessionAPI.createSession.mockResolvedValueOnce(mockNewSession)

            // Act
            const result = await sessionService.ensureRecordingSession()

            // Assert
            expect(result).toEqual(mockNewSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: expect.stringMatching(/éŒ„éŸ³ç­†è¨˜ \d{1,2}\/\d{1,2}\/\d{4}/),
                type: 'recording',
                content: undefined
            })
        })

        test('ç•¶æä¾›å…§å®¹æ™‚ï¼Œæ‡‰è©²æ­£ç¢ºå‚³éçµ¦ API', async () => {
            // Arrange
            mockSessionAPI.createSession.mockResolvedValueOnce(mockNewSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ¸¬è©¦æ¨™é¡Œ', 'æ¸¬è©¦å…§å®¹')

            // Assert
            expect(result).toEqual(mockNewSession)
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'æ¸¬è©¦æ¨™é¡Œ',
                type: 'recording',
                content: 'æ¸¬è©¦å…§å®¹'
            })
        })
    })

    describe('ensureRecordingSession - æ•´åˆæµç¨‹æ¸¬è©¦', () => {
        test('å®Œæ•´çš„ 409 è¡çªè™•ç†æµç¨‹ï¼šå‰µå»ºå¤±æ•— â†’ ç²å–ç¾æœ‰æœƒè©± â†’ å‡ç´šæœƒè©±', async () => {
            // Arrange
            const conflictError = {
                response: { status: 409 },
                isAxiosError: true
            }

            const upgradedSession: SessionResponse = {
                ...mockNoteSession,
                type: 'recording'
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            // ç¬¬ä¸€æ¬¡èª¿ç”¨ - ensureRecordingSession ä¸­æª¢æŸ¥ç¾æœ‰æœƒè©±
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockNoteSession)
            // ç¬¬äºŒæ¬¡èª¿ç”¨ - upgradeToRecording ä¸­æª¢æŸ¥æœƒè©±ç‹€æ…‹
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockNoteSession)
            mockSessionAPI.upgradeToRecording.mockResolvedValueOnce(upgradedSession)

            // Act
            const result = await sessionService.ensureRecordingSession('æ•´åˆæ¸¬è©¦')

            // Assert - é©—è­‰èª¿ç”¨é †åºå’Œåƒæ•¸
            expect(mockSessionAPI.createSession).toHaveBeenCalledWith({
                title: 'æ•´åˆæ¸¬è©¦',
                type: 'recording',
                content: undefined
            })
            expect(mockSessionAPI.getActiveSession).toHaveBeenCalledAfter(
                mockSessionAPI.createSession as any
            )
            expect(mockSessionAPI.upgradeToRecording).toHaveBeenCalledWith(mockNoteSession.id)
            expect(result).toEqual(upgradedSession)
        })

        test('å„ªé›…çš„éŒ¯èª¤æ¢å¾©ï¼šAPI èª¿ç”¨é †åºæ­£ç¢ºä¸”éŒ¯èª¤è™•ç†é©ç•¶', async () => {
            // Arrange
            const conflictError = {
                response: { status: 409 },
                isAxiosError: true
            }

            mockSessionAPI.createSession.mockRejectedValueOnce(conflictError)
            mockSessionAPI.getActiveSession.mockResolvedValueOnce(mockExistingSession)

            // Act
            const result = await sessionService.ensureRecordingSession('éŒ¯èª¤æ¢å¾©æ¸¬è©¦')

            // Assert - é©—è­‰æœ€çµ‚çµæœæ­£ç¢º
            expect(result).toEqual(mockExistingSession)
            expect(result.type).toBe('recording')
            expect(result.status).toBe('active')

            // é©—è­‰ä¸éœ€è¦å‡ç´šï¼ˆå› ç‚ºç¾æœ‰æœƒè©±å·²ç¶“æ˜¯éŒ„éŸ³æœƒè©±ï¼‰
            expect(mockSessionAPI.upgradeToRecording).not.toHaveBeenCalled()
        })
    })
})


# END FILE CONTENTS


# File: frontend/components/ui/switch.tsx

"use client"

import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }


# END FILE CONTENTS


# File: docs/ADD_GEMINI.md

## âœ¨ Feature Specï¼šå¯åˆ‡æ› Whisper â‡† Gemini (2.5 Pro) èªéŸ³è½‰æ–‡å­—

### 0. ç›®æ¨™
1. ä½¿ç”¨è€…å¯åœ¨ UI é¸æ“‡ **Whisper** æˆ– **Gemini 2.5 Pro** ä½œç‚ºè½‰éŒ„å¼•æ“  
2. é¸å®šå¾Œå»ºç«‹ä¹‹ session åŠå…¶æ‰€æœ‰åˆ‡ç‰‡éƒ½èµ°å°æ‡‰ Provider  
3. ç„¡è«– Providerï¼Œå‰ç«¯å¾—åˆ° *ä¸€è‡´* çš„ `transcript_segment` Payload

---

### 1. æ–°å¢ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸                 | ç¯„ä¾‹å€¼                                  | èªªæ˜                                 |
| -------------------- | --------------------------------------- | ------------------------------------ |
| STT_PROVIDER_DEFAULT | whisper                                 | é è¨­ Provider (`whisper` / `gemini`) |
| GEMINI_ENDPOINT      | `us-central1-aiplatform.googleapis.com` | Vertex AI ç«¯é»                       |
| GEMINI_API_KEY       | `ya29.~â€¦`                               | GCP æœå‹™å¸³æˆ¶ *API Key*               |
| GEMINI_PROMPT        | `è«‹è¼¸å‡ºé€å­—ç¨¿â€¦`                         | é è¨­ system prompt                   |
| GEMINI_MAX_REQUESTS  | 90                                      | 1 min å…§å¯å‘¼å«æ¬¡æ•¸ (RateLimiter ç”¨)  |

---

### 2. DB è®Šæ›´

```sql
ALTER TABLE sessions
ADD COLUMN stt_provider VARCHAR(20) NOT NULL DEFAULT 'whisper';
```

---

### 3. å¾Œç«¯

#### 3-1 ç›®éŒ„çµæ§‹

```
app/services/stt/
 â”œâ”€ base.py             # ISTTProvider ä»‹é¢
 â”œâ”€ whisper_provider.py # èˆŠ SimpleAudioTranscriptionService ç§»å…¥
 â”œâ”€ gemini_provider.py  # å…¨æ–°å¯¦ä½œ
 â””â”€ factory.py          # get_provider(session_id)
```

#### 3-2 ä»‹é¢ `base.py`

```python
class ISTTProvider(ABC):
    @abstractmethod
    async def transcribe(self, webm: bytes, session_id: UUID, chunk_seq: int) -> dict: ...
    @abstractmethod
    def name(self) -> str: ...
    @abstractmethod
    def max_rpm(self) -> int: ...
```

#### 3-3 Gemini å¯¦ä½œï¼ˆæ ¸å¿ƒç‰‡æ®µï¼‰

```python
class GeminiProvider(ISTTProvider):
    def __init__(self):
        self.model = GenerativeModel("gemini-2.5-pro-preview",
                                     api_key=settings.GEMINI_API_KEY)

    async def transcribe(self, webm: bytes, session_id: UUID, chunk_seq: int):
        pcm = await ffmpeg_webm_to_pcm(webm)          # å…±ç”¨è½‰æª”å·¥å…·
        b64 = base64.b64encode(pcm).decode()
        prompt = settings.GEMINI_PROMPT
        res = await self.model.generate_content_async(
            contents=[{"role":"user","parts":[
              {"text": prompt},
              {"audio":{"mime_type":"audio/wav","data":b64}}
            ]}]
        )
        text = res.text.strip()
        return {"text": text,
                "start_offset": 0,
                "end_offset": 0}      # Gemini ç„¡æ®µè½ â†’ 0~D

    def name(self):     return "gemini"
    def max_rpm(self):  return settings.GEMINI_MAX_REQUESTS
```

#### 3-4 Factory

```python
def get_provider(session_id: UUID) -> ISTTProvider:
    provider = cache.get(session_id)    # ç°¡æ˜“ LRU
    if provider: return provider

    record = supabase.table("sessions")\
        .select("stt_provider").eq("id", str(session_id)).single().execute()
    name = record.data["stt_provider"]
    if name == "gemini":
        provider = GeminiProvider()
    else:
        provider = WhisperProvider()
    cache[session_id] = provider
    return provider
```

#### 3-5 QueueManager æ•´åˆ

```python
provider = get_provider(session_id)
rate_limiter = SlidingWindowRateLimiter(max_requests=provider.max_rpm())
result = await provider.transcribe(webm, session_id, chunk_seq)
```

> ğŸ¯ `transcript_segment` JSON å¢åŠ  `"provider": "gemini" | "whisper"` ï¼ˆä¾›å‰ç«¯é¡¯ç¤ºå°å¾½ç« ï¼‰ã€‚

---

### 4. API

| Method | Path                          | Body/Query                                                       | èªªæ˜                                                             |
| ------ | ----------------------------- | ---------------------------------------------------------------- | ---------------------------------------------------------------- |
| POST   | `/api/session`                | `{ "type":"recording", "title":"...", "stt_provider":"gemini" }` | å¤šä¸€å€‹ `stt_provider` æ¬„ä½ï¼Œé è¨­ `settings.STT_PROVIDER_DEFAULT` |
| PATCH  | `/api/session/{sid}/provider` | `{ "stt_provider":"whisper" }`                                   | (å¯é¸) æœƒè©±ä¸­é€”åˆ‡æ›ï¼Œåƒ…åœ¨ *å°šæœªä¸Šå‚³éŸ³æª”* æ™‚å…è¨±                  |

---

### 5. å‰ç«¯

#### 5-1 UI

1. `SettingsDrawer` â†’ æ–°å¢ã€ŒèªéŸ³è½‰æ–‡å­—å¼•æ“ã€é¸é …  
   - `Whisper (Azure) / Gemini 2.5 Pro (Vertex AI)`
2. é»æ“Šã€Œæ›´æ›ã€é–‹ `ProviderSelectModal`  
   - radio + Save  
3. é¸å®šå¾Œï¼š
   - è‹¥å°šæœªæœ‰ session â†’ å­˜ localStorage, `useAppStore.setProvider`
   - è‹¥å·²æœ‰ active session â†’ å‘¼å« `PATCH /provider`

#### 5-2 Zustand Store

```ts
type STTProvider = 'whisper' | 'gemini'

provider: STTProvider
setProvider: (p: STTProvider)=> set({ provider:p })
```

#### 5-3 é–‹å§‹éŒ„éŸ³æµç¨‹

```ts
await ensureFreshRecordingSession(
  { title, stt_provider: get().provider }   // å‚³åˆ°å¾Œç«¯
)
```

#### 5-4 Transcript UI

åœ¨å­—å¹•åˆ—åŠ ä¸€å€‹å° tagï¼š

```jsx
{entry.provider === 'gemini' && <Badge>G</Badge>}
```

---

### 6. æ¸¬è©¦

| é¡å‹             | Case                                        | æ–·è¨€                                 |
| ---------------- | ------------------------------------------- | ------------------------------------ |
| unit (MSW)       | POST `/session` with `stt_provider=gemini`  | å› 201, body.stt_provider = gemini   |
| e2e (Playwright) | åˆ‡åˆ° Gemini éŒ„ 30 s                         | UI å‡ºç¾ provider æ¨™ç±¤ & å­—å¹•é †åºæ­£ç¢º |
| backend          | GeminiProvider.transcribe() mock Base64 Wav | å›å‚³ dict.text â‰  ''                  |

---

### 7. æ–‡ä»¶ï¼ˆREADME ç¯„ç‰‡æ®µï¼‰

```md
### âš™ï¸ åˆ‡æ› STT Provider

.env
```
| key                  | whisper | gemini                                |
| -------------------- | ------- | ------------------------------------- |
| STT_PROVIDER_DEFAULT | whisper | gemini                                |
| GEMINI_ENDPOINT      | â€“       | us-central1-aiplatform.googleapis.com |
| GEMINI_API_KEY       | â€“       | <your-gcp-key>                        |

åœ¨ UI â†’ Settings â†’ STT Provider å¯ Runtime åˆ‡æ›ã€‚
```

---

å®Œæˆä»¥ä¸Š Checklistï¼ˆ#0â€Šâ€“â€Š#10 ç‚º **å¿…éœ€**ï¼‰ï¼Œå³å¯åœ¨åŒä¸€æ”¯ App å…§è‡ªç”±åˆ‡æ› Whisper èˆ‡ Gemini 2.5 Pro ä½œç‚ºè½‰éŒ„å¼•æ“ã€‚



# END FILE CONTENTS


# File: frontend/components/ui/command.tsx

"use client"

import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

const CommandDialog = ({ children, ...props }: DialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}


# END FILE CONTENTS


# File: .cursor/rules/react.mdc

---
description:
globs: *.js,*.jsx,*.ts,*.tsx
alwaysApply: false
---
<!-- Source: https://github.com/sanjeed5/awesome-cursor-rules-mdc/blob/main/rules-mdc/react.mdc -->

# React Best Practices: A Comprehensive Guide

This document outlines the best practices for developing React applications, covering various aspects from code organization to security and testing. Following these guidelines leads to more maintainable, scalable, and performant applications.

## 1. Code Organization and Structure

### 1.1 Directory Structure

A well-defined directory structure is crucial for maintainability. Here's a recommended structure:


src/
  â”œâ”€â”€ components/
  â”‚   â”œâ”€â”€ Button/
  â”‚   â”‚   â”œâ”€â”€ Button.jsx
  â”‚   â”‚   â”œâ”€â”€ Button.module.css
  â”‚   â”‚   â””â”€â”€ Button.test.jsx
  â”‚   â”œâ”€â”€ Input/
  â”‚   â”‚   â”œâ”€â”€ Input.jsx
  â”‚   â”‚   â”œâ”€â”€ Input.module.css
  â”‚   â”‚   â””â”€â”€ Input.test.jsx
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ contexts/
  â”‚   â”œâ”€â”€ AuthContext.jsx
  â”‚   â””â”€â”€ ThemeContext.jsx
  â”œâ”€â”€ hooks/
  â”‚   â”œâ”€â”€ useAuth.js
  â”‚   â””â”€â”€ useTheme.js
  â”œâ”€â”€ pages/
  â”‚   â”œâ”€â”€ Home.jsx
  â”‚   â”œâ”€â”€ About.jsx
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ services/
  â”‚   â”œâ”€â”€ api.js
  â”‚   â””â”€â”€ auth.js
  â”œâ”€â”€ utils/
  â”‚   â”œâ”€â”€ helpers.js
  â”‚   â””â”€â”€ validators.js
  â”œâ”€â”€ App.jsx
  â”œâ”€â”€ index.jsx
  â””â”€â”€ ...


-   **`components/`**: Reusable UI components.
    -   Each component has its own directory containing the component file, associated styles (using CSS modules), and tests.
-   **`contexts/`**: React context providers.
-   **`hooks/`**: Custom React hooks.
-   **`pages/`**: Top-level components representing different routes or views.
-   **`services/`**: API interaction logic.
-   **`utils/`**: Utility functions.

### 1.2 File Naming Conventions

-   **Components**: Use PascalCase (e.g., `MyComponent.jsx`).
-   **Hooks**: Use camelCase prefixed with `use` (e.g., `useMyHook.js`).
-   **Contexts**: Use PascalCase suffixed with `Context` (e.g., `MyContext.jsx`).
-   **Services/Utils**: Use camelCase (e.g., `apiService.js`, `stringUtils.js`).
-   **CSS Modules**: Use `.module.css` or `.module.scss` (e.g., `Button.module.css`).

### 1.3 Module Organization

-   **Co-location**: Keep related files (component, styles, tests) together in the same directory.
-   **Single Responsibility**: Each module should have a clear and specific purpose.
-   **Avoid Circular Dependencies**: Ensure modules don't depend on each other in a circular manner.

### 1.4 Component Architecture

-   **Atomic Design**: Consider using Atomic Design principles (Atoms, Molecules, Organisms, Templates, Pages) to structure components.
-   **Composition over Inheritance**: Favor component composition to reuse code and functionality.
-   **Presentational and Container Components**: Separate UI rendering (presentational) from state management and logic (container).

### 1.5 Code Splitting Strategies

-   **Route-Based Splitting**: Use `React.lazy` and `Suspense` to load components only when a specific route is accessed.  This is very common and improves initial load time.
-   **Component-Based Splitting**: Split large components into smaller chunks that can be loaded on demand.
-   **Bundle Analyzer**: Use a tool like `webpack-bundle-analyzer` to identify large dependencies and optimize bundle size.

## 2. Common Patterns and Anti-patterns

### 2.1 Design Patterns

-   **Higher-Order Components (HOCs)**: Reusable logic that wraps components (use with caution; prefer hooks).
-   **Render Props**: Sharing code using a prop whose value is a function.
-   **Compound Components**: Components that work together implicitly (e.g., `Tabs`, `Tab`).
-   **Hooks**: Reusable stateful logic that can be shared across functional components.

### 2.2 Recommended Approaches

-   **Form Handling**: Use controlled components with local state or a form library like Formik or React Hook Form.
-   **API Calls**: Use `useEffect` hook to make API calls and manage loading states.
-   **Conditional Rendering**: Use short-circuit evaluation (`&&`) or ternary operators for simple conditions; use separate components for complex scenarios.
-   **List Rendering**: Always provide a unique and stable `key` prop when rendering lists.

### 2.3 Anti-patterns and Code Smells

-   **Direct DOM Manipulation**: Avoid directly manipulating the DOM; let React handle updates.
-   **Mutating State Directly**: Always use `setState` or the state updater function to modify state.
-   **Inline Styles**: Use CSS modules or styled-components for maintainable styles.
-   **Over-Engineering**: Avoid using complex solutions for simple problems.
-   **Prop Drilling**: Passing props through multiple levels of components without them being used.

### 2.4 State Management Best Practices

-   **Local State**: Use `useState` for component-specific state.
-   **Context API**: Use `useContext` for global state accessible to many components, but avoid for very frequently updated data.
-   **Redux/Mobx**: Use these libraries for complex state management in large applications.
-   **Recoil/Zustand**: Lightweight alternatives to Redux, often easier to set up and use.
-   **Immutable Data**: Treat state as immutable to prevent unexpected side effects.

### 2.5 Error Handling Patterns

-   **Error Boundaries**: Wrap components with error boundaries to catch errors during rendering and prevent crashes.
-   **Try-Catch Blocks**: Use try-catch blocks for handling errors in asynchronous operations and event handlers.
-   **Centralized Error Logging**: Implement a centralized error logging service to track errors and improve application stability.

## 3. Performance Considerations

### 3.1 Optimization Techniques

-   **Memoization**: Use `React.memo`, `useMemo`, and `useCallback` to prevent unnecessary re-renders and recalculations.
-   **Virtualization**: Use libraries like `react-window` or `react-virtualized` to efficiently render large lists or tables.
-   **Debouncing/Throttling**: Limit the rate at which functions are executed (e.g., in input fields).
-   **Code Splitting**: Load code on demand using `React.lazy` and `Suspense`.

### 3.2 Memory Management

-   **Avoid Memory Leaks**: Clean up event listeners, timers, and subscriptions in `useEffect`'s cleanup function.
-   **Release Unused Objects**: Avoid holding onto large objects in memory when they are no longer needed.
-   **Garbage Collection**: Understand how JavaScript's garbage collection works and avoid creating unnecessary objects.

### 3.3 Rendering Optimization

-   **Minimize State Updates**: Avoid unnecessary state updates that trigger re-renders.
-   **Batch Updates**: Batch multiple state updates into a single update using `ReactDOM.unstable_batchedUpdates`.
-   **Keys**: Ensure that keys are unique and consistent across renders.

### 3.4 Bundle Size Optimization

-   **Tree Shaking**: Remove unused code during the build process.
-   **Minification**: Reduce the size of JavaScript and CSS files.
-   **Image Optimization**: Compress and optimize images to reduce file size.
-   **Dependency Analysis**: Use tools like `webpack-bundle-analyzer` to identify large dependencies.

### 3.5 Lazy Loading Strategies

-   **Route-Based Lazy Loading**: Load components when a user navigates to a specific route.
-   **Component-Based Lazy Loading**: Load components when they are about to be rendered.
-   **Intersection Observer**: Load components when they become visible in the viewport.

## 4. Security Best Practices

### 4.1 Common Vulnerabilities and Prevention

-   **Cross-Site Scripting (XSS)**: Sanitize user input to prevent malicious code injection.
-   **Cross-Site Request Forgery (CSRF)**: Use anti-CSRF tokens to protect against unauthorized requests.
-   **Denial of Service (DoS)**: Implement rate limiting and request validation to prevent abuse.
-   **Injection Attacks**: Avoid directly embedding user input into database queries or system commands.

### 4.2 Input Validation

-   **Client-Side Validation**: Validate user input in the browser to provide immediate feedback.
-   **Server-Side Validation**: Always validate user input on the server to prevent malicious data.
-   **Sanitize Input**: Sanitize user input to remove potentially harmful characters or code.

### 4.3 Authentication and Authorization

-   **Secure Authentication**: Use secure authentication mechanisms like OAuth 2.0 or JWT.
-   **Role-Based Access Control (RBAC)**: Implement RBAC to control access to resources based on user roles.
-   **Multi-Factor Authentication (MFA)**: Enable MFA to add an extra layer of security.

### 4.4 Data Protection Strategies

-   **Encryption**: Encrypt sensitive data at rest and in transit.
-   **Data Masking**: Mask sensitive data in logs and UI displays.
-   **Regular Backups**: Create regular backups of application data.

### 4.5 Secure API Communication

-   **HTTPS**: Use HTTPS to encrypt communication between the client and the server.
-   **API Keys**: Protect API keys and secrets.
-   **CORS**: Configure Cross-Origin Resource Sharing (CORS) to prevent unauthorized access to APIs.

## 5. Testing Approaches

### 5.1 Unit Testing

-   **Test Components**: Test individual components in isolation.
-   **Testing Library**: Use React Testing Library for UI testing, focusing on user behavior.
-   **Jest**: Use Jest as the test runner.

### 5.2 Integration Testing

-   **Test Component Interactions**: Test how components interact with each other.
-   **Mock API Calls**: Mock API calls to test component behavior in different scenarios.
-   **React Testing Library**: Effective for testing integration points in components.

### 5.3 End-to-End (E2E) Testing

-   **Test Full Application Flows**: Test complete user flows, such as login, registration, and checkout.
-   **Cypress/Playwright**: Use tools like Cypress or Playwright for E2E testing.
-   **Automated Browser Tests**: Automate browser tests to ensure application stability.

### 5.4 Test Organization

-   **Co-locate Tests**: Keep test files close to the components they test (e.g., `Button.test.jsx` in the `Button` directory).
-   **Descriptive Names**: Use descriptive names for test files and test cases.
-   **Test Suites**: Organize tests into logical suites.

### 5.5 Mocking and Stubbing

-   **Mock Modules**: Mock external modules or API calls to isolate components during testing.
-   **Stub Functions**: Stub function implementations to control component behavior.
-   **Jest Mocks**: Utilize Jest's mocking capabilities for effective unit testing.

## 6. Common Pitfalls and Gotchas

### 6.1 Frequent Mistakes

-   **Ignoring Keys in Lists**: Forgetting to provide unique and stable `key` props when rendering lists.
-   **Incorrect State Updates**: Mutating state directly instead of using `setState` or the state updater function.
-   **Missing Dependencies in `useEffect`**: Not including all dependencies in the dependency array of the `useEffect` hook.
-   **Over-Using State**: Storing derived data in state instead of calculating it on demand.

### 6.2 Edge Cases

-   **Asynchronous State Updates**: Handling state updates in asynchronous operations.
-   **Race Conditions**: Preventing race conditions when making multiple API calls.
-   **Handling Errors in Event Handlers**: Properly handling errors in event handlers to prevent crashes.

### 6.3 Version-Specific Issues

-   **React 16 vs. React 17/18**: Understanding differences in lifecycle methods, error handling, and concurrent mode.
-   **Deprecated Features**: Being aware of deprecated features and using recommended alternatives.

### 6.4 Compatibility Concerns

-   **Browser Compatibility**: Ensuring compatibility with different browsers and devices.
-   **Library Compatibility**: Ensuring compatibility between React and other libraries.

### 6.5 Debugging Strategies

-   **React DevTools**: Use React DevTools to inspect component hierarchies, props, and state.
-   **Console Logging**: Use console logging to debug code and track variables.
-   **Breakpoints**: Set breakpoints in the code to step through execution and inspect variables.

## 7. Tooling and Environment

### 7.1 Recommended Development Tools

-   **VS Code**: A popular code editor with excellent React support.
-   **Create React App**: A tool for quickly setting up a new React project.
-   **React DevTools**: A browser extension for inspecting React components.
-   **ESLint**: A linter for enforcing code style and preventing errors.
-   **Prettier**: A code formatter for automatically formatting code.

### 7.2 Build Configuration

-   **Webpack/Vite**: Configure Webpack or Vite to bundle and optimize code.
-   **Babel**: Configure Babel to transpile JavaScript code to older versions.
-   **Environment Variables**: Use environment variables to configure different environments.

### 7.3 Linting and Formatting

-   **ESLint**: Configure ESLint with recommended React rules.
-   **Prettier**: Configure Prettier to automatically format code.
-   **Husky/lint-staged**: Use Husky and lint-staged to run linters and formatters before committing code.

### 7.4 Deployment Best Practices

-   **Static Hosting**: Host static assets on a CDN.
-   **Server-Side Rendering (SSR)**: Use SSR to improve SEO and initial load time.
-   **Continuous Deployment**: Automate the deployment process using CI/CD.

### 7.5 CI/CD Integration

-   **GitHub Actions/GitLab CI**: Use GitHub Actions or GitLab CI to automate testing, linting, and deployment.
-   **Automated Testing**: Run automated tests on every commit or pull request.
-   **Automated Deployment**: Automatically deploy code to production after successful tests.

By following these best practices, React developers can build high-quality, maintainable, and scalable applications that meet the demands of modern web development. Continual education and adaptation to emerging trends in the React ecosystem are crucial for sustained success.


# END FILE CONTENTS


# File: frontend/lib/transcript-manager-adapter.ts

"use client"

import { isFeatureEnabled } from './feature-flags'

/**
 * TranscriptManager é©é…å™¨
 *
 * æ ¹æ“šåŠŸèƒ½æ——æ¨™ `useRefactoredTranscriptManager` é¸æ“‡ä½¿ç”¨ï¼š
 * - æ–°çš„é‡æ§‹å¯¦ç¾ï¼ˆtranscript-manager-new.tsï¼‰
 * - èˆŠçš„å¯¦ç¾ï¼ˆtranscript-manager.tsï¼‰
 *
 * é€™å…è¨±æˆ‘å€‘é€²è¡Œå®‰å…¨çš„æ¼¸é€²å¼åˆ‡æ›å’Œæ¸¬è©¦
 */

// å®šç¾©é€šç”¨ä»‹é¢ï¼Œç¢ºä¿æ–°èˆŠå¯¦ç¾å…¼å®¹
export interface ITranscriptManager {
  connect(sessionId: string): Promise<void>
  disconnect(sessionId: string): Promise<void>
  disconnectAll(): Promise<void>
  isConnected(sessionId: string): boolean
  getConnectionCount(): number
}

let managerInstance: ITranscriptManager | null = null

/**
 * å–å¾— TranscriptManager å¯¦ä¾‹
 * æ ¹æ“šåŠŸèƒ½æ——æ¨™è‡ªå‹•é¸æ“‡å¯¦ç¾
 */
export async function getTranscriptManager(): Promise<ITranscriptManager> {
  const useRefactored = isFeatureEnabled('useRefactoredTranscriptManager')

  console.log(`ğŸ¯ [TranscriptManagerAdapter] ä½¿ç”¨ ${useRefactored ? 'æ–°' : 'èˆŠ'} å¯¦ç¾`)

  if (useRefactored) {
    // å‹•æ…‹å°å…¥æ–°å¯¦ç¾
    if (!managerInstance || !(managerInstance as any).isRefactored) {
      const { TranscriptManager } = await import('./transcript-manager-new')
      managerInstance = TranscriptManager.getInstance()
        ; (managerInstance as any).isRefactored = true
      console.log('âœ… [TranscriptManagerAdapter] å·²è¼‰å…¥é‡æ§‹å¾Œçš„ TranscriptManager')
    }
  } else {
    // å‹•æ…‹å°å…¥èˆŠå¯¦ç¾
    if (!managerInstance || (managerInstance as any).isRefactored) {
      const { transcriptManager } = await import('./transcript-manager')
      managerInstance = transcriptManager
        ; (managerInstance as any).isRefactored = false
      console.log('âœ… [TranscriptManagerAdapter] å·²è¼‰å…¥åŸå§‹ TranscriptManager')
    }
  }

  return managerInstance
}

/**
 * å¼·åˆ¶é‡æ–°è¼‰å…¥ TranscriptManagerï¼ˆç”¨æ–¼åŠŸèƒ½æ——æ¨™è®Šæ›´å¾Œï¼‰
 */
export async function reloadTranscriptManager(): Promise<ITranscriptManager> {
  // æ¸…ç†ç¾æœ‰å¯¦ä¾‹
  if (managerInstance) {
    try {
      await managerInstance.disconnectAll()
    } catch (error) {
      console.warn('âš ï¸ [TranscriptManagerAdapter] æ¸…ç†èˆŠå¯¦ä¾‹æ™‚ç™¼ç”ŸéŒ¯èª¤:', error)
    }
  }

  managerInstance = null
  return getTranscriptManager()
}

/**
 * ä¾¿åˆ©å‡½æ•¸ï¼šå–å¾—ç•¶å‰ä½¿ç”¨çš„å¯¦ç¾é¡å‹
 */
export function getCurrentImplementation(): 'refactored' | 'legacy' {
  return isFeatureEnabled('useRefactoredTranscriptManager') ? 'refactored' : 'legacy'
}

/**
 * ä¾¿åˆ©å‡½æ•¸ï¼šåˆ‡æ›å¯¦ç¾ä¸¦é‡æ–°è¼‰å…¥
 */
export async function switchImplementation(useRefactored: boolean): Promise<ITranscriptManager> {
  const { enableFeature, disableFeature } = await import('./feature-flags')

  if (useRefactored) {
    enableFeature('useRefactoredTranscriptManager')
  } else {
    disableFeature('useRefactoredTranscriptManager')
  }

  return reloadTranscriptManager()
}

// æš´éœ²åˆ° window ä¾›èª¿è©¦ä½¿ç”¨
if (typeof window !== 'undefined') {
  (window as any).transcriptManagerAdapter = {
    getCurrentImplementation,
    switchToRefactored: () => switchImplementation(true),
    switchToLegacy: () => switchImplementation(false),
    reload: reloadTranscriptManager,
    getManager: getTranscriptManager,
  }

  console.log('ğŸ¯ [TranscriptManagerAdapter] èª¿è©¦ä»‹é¢å·²æš´éœ²åˆ° window.transcriptManagerAdapter')
  console.log('   åˆ‡æ›åˆ°æ–°å¯¦ç¾: window.transcriptManagerAdapter.switchToRefactored()')
  console.log('   åˆ‡æ›åˆ°èˆŠå¯¦ç¾: window.transcriptManagerAdapter.switchToLegacy()')
}


# END FILE CONTENTS


# File: docs/stop-processing-finish-flow.md

# Stop â†’ Processing â†’ Finished ç‹€æ…‹æµè¦æ ¼

## 1. éŒ„éŸ³æµç¨‹ç‹€æ…‹æµ
- ä½¿ç”¨è€…æŒ‰ä¸‹ Stop åœæ­¢éŒ„éŸ³å¾Œï¼ŒAppState é€²å…¥ `processing` ç‹€æ…‹ï¼Œé¡¯ç¤º ProcessingOverlayï¼ŒWebSocket é€£ç·šä¿æŒã€‚
- å¾Œç«¯æœƒå°‡å°šæœªå®Œæˆçš„éŸ³è¨Šåˆ‡ç‰‡å…¨éƒ¨è™•ç†å®Œç•¢ï¼Œé€ä¸€æ¨é€ transcript_segmentã€‚
- æœ€å¾Œä¸€å€‹åˆ‡ç‰‡è™•ç†å®Œç•¢å¾Œï¼Œå¾Œç«¯å»£æ’­ `{type: "transcript_complete"}`ã€‚
- å‰ç«¯æ”¶åˆ° `transcript_complete`ï¼š
  - AppState è½‰ç‚º `finished`
  - æ–·é–‹ WS é€£ç·š
  - é—œé–‰ ProcessingOverlay

## 2. WebSocket ä¿æŒåŸå‰‡
- åœæ­¢éŒ„éŸ³å¾Œï¼Œå‰ç«¯ä¸ç«‹å³æ–·é–‹ transcript WebSocketï¼Œå¿…é ˆç­‰æ”¶åˆ° `transcript_complete` æ‰æ–·ç·šã€‚
- é€™æ¨£å¯ç¢ºä¿æ‰€æœ‰é€å­—ç¨¿ç‰‡æ®µéƒ½èƒ½å®Œæ•´æ”¶åˆ°ã€‚

## 3. transcript_complete è™•ç†
- å‰ç«¯ handleTranscriptMessage éœ€æ–°å¢ `transcript_complete` åˆ†æ”¯ï¼š
  - è½‰æ›ç‹€æ…‹ç‚º finished
  - æ–·é–‹ WS
  - æ¨™è¨˜æµç¨‹çµæŸ

## 4. ProcessingOverlay é¡¯ç¤ºè¦å‰‡
- åªåœ¨ AppState = `processing` æ™‚é¡¯ç¤ºã€‚
- Stop â†’ processing â†’ (æ”¶åˆ° complete) â†’ finishedï¼ŒOverlay è‡ªå‹•æ¶ˆå¤±ã€‚

## 5. ç›¸é—œç’°å¢ƒè®Šæ•¸ fallback
- `labelIntervalSec` éœ€æ­£ç¢º fallbackï¼Œé¿å… undefinedã€‚

## 6. å¾Œç«¯è¡Œç‚º
- æ‰€æœ‰ STT providerï¼ˆwhisper/gpt4o/geminiï¼‰éƒ½éœ€åœ¨æœ€å¾Œä¸€ç‰‡æ®µå¾Œå»£æ’­ `transcript_complete`ã€‚
- å·²ç¢ºèª save_and_push_result() æœƒå»£æ’­æ­¤è¨Šæ¯ã€‚

---

## æ¸¬è©¦é‡é»
- Stop å¾Œé€²å…¥ processingï¼Œæ”¶åˆ° transcript_complete é€²å…¥ finished
- Overlay åªåœ¨ processing é¡¯ç¤º
- provider è·¯å¾‘çš†æœƒå»£æ’­ transcript_complete 


# END FILE CONTENTS


# File: frontend/test-transcript-integration.js

 

# END FILE CONTENTS


# File: frontend/lib/services/recording-service.ts

"use client"

import { BaseService } from './base-service'
import { IRecordingService, RecordingState } from './interfaces'
import { AudioRecorder, AudioChunk, checkAudioRecordingSupport } from '../audio-recorder'
import { AudioUploadWebSocket, AckMissingMessage } from '../websocket'
import { getAudioChunkIntervalMs, getAudioConfigInfo } from '../config'

/**
 * RecordingService - éŒ„éŸ³ç®¡ç†æœå‹™
 *
 * æ•´åˆç¾æœ‰çš„éŒ„éŸ³ç›¸é—œé‚è¼¯ï¼Œæä¾›ï¼š
 * - éŸ³é »éŒ„è£½ç®¡ç†ï¼ˆé‡ç”¨ AudioRecorderï¼‰
 * - WebSocket éŸ³é »ä¸Šå‚³ï¼ˆé‡ç”¨ AudioUploadWebSocketï¼‰
 * - éŒ„éŸ³ç‹€æ…‹ç®¡ç†
 * - éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
 * - å¿ƒè·³ç›£æ¸¬
 */
export class RecordingService extends BaseService implements IRecordingService {
  protected readonly serviceName = 'RecordingService'

  // éŒ„éŸ³å™¨å’Œ WebSocket å¼•ç”¨
  private audioRecorder: AudioRecorder | null = null
  private audioUploadWs: AudioUploadWebSocket | null = null

  // éŒ„éŸ³ç‹€æ…‹
  private recordingState: RecordingState = {
    isRecording: false,
    recordingTime: 0,
    currentSessionId: null,
    error: null
  }

  // è¨ˆæ™‚å™¨å’Œé‡è©¦æ©Ÿåˆ¶
  private recordingTimer: ReturnType<typeof setInterval> | null = null
  private heartbeatTimer: ReturnType<typeof setInterval> | null = null
  private audioChunks: AudioChunk[] = []
  private retryCounts = new Map<number, number>()

  /**
   * æœå‹™åˆå§‹åŒ–
   * æª¢æŸ¥éŸ³é »éŒ„è£½æ”¯æ´åº¦
   */
  async initialize(): Promise<void> {
    this.logInfo('æœå‹™åˆå§‹åŒ–é–‹å§‹')

    // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦
    const supportCheck = await checkAudioRecordingSupport()
    if (!supportCheck.isSupported) {
      const errorMessage = `éŸ³é »éŒ„è£½ä¸æ”¯æ´: ${supportCheck.error || 'æœªçŸ¥éŒ¯èª¤'}`
      this.logWarning('ç€è¦½å™¨æ”¯æ´åº¦æª¢æŸ¥å¤±æ•—', supportCheck.error)
      throw new Error(errorMessage)
    }

    this.logSuccess('ç€è¦½å™¨æ”¯æ´åº¦æª¢æŸ¥é€šé')
    this.logSuccess('åˆå§‹åŒ–å®Œæˆ')
  }

  /**
   * æœå‹™æ¸…ç†
   */
  async cleanup(): Promise<void> {
    this.logInfo('æœå‹™æ¸…ç†é–‹å§‹')

    // å¦‚æœæ­£åœ¨éŒ„éŸ³ï¼Œå…ˆåœæ­¢
    if (this.recordingState.isRecording) {
      await this.stopRecording()
    }

    // æ¸…ç†éŸ³é »éŒ„è£½å™¨
    if (this.audioRecorder) {
      this.audioRecorder.cleanup()
      this.audioRecorder = null
    }

    // æ¸…ç†è¨ˆæ™‚å™¨
    this.clearTimers()

    // é‡ç½®ç‹€æ…‹
    this.resetRecordingState()

    this.logSuccess('æ¸…ç†å®Œæˆ')
  }

  /**
   * é–‹å§‹éŒ„éŸ³
   * é‡ç”¨ç¾æœ‰çš„éŸ³é »éŒ„è£½å’Œ WebSocket ä¸Šå‚³é‚è¼¯
   */
  async startRecording(sessionId: string): Promise<void> {
    this.logInfo('é–‹å§‹éŒ„éŸ³', { sessionId })

    try {
      // æª¢æŸ¥æ˜¯å¦å·²åœ¨éŒ„éŸ³
      if (this.recordingState.isRecording) {
        this.logWarning('å·²åœ¨éŒ„éŸ³ä¸­ï¼Œè·³éé‡è¤‡å•Ÿå‹•')
        return
      }

      // é‡ç½®ç‹€æ…‹
      this.resetRecordingState()
      this.recordingState.currentSessionId = sessionId

      // æ­¥é©Ÿ 1: åˆå§‹åŒ–éŸ³é »éŒ„è£½å™¨
      this.logInfo('æ­¥é©Ÿ 1: åˆå§‹åŒ–éŸ³é »éŒ„è£½å™¨')
      const chunkInterval = getAudioChunkIntervalMs()

      console.log('ğŸ¯ [RecordingService] éŸ³é »é…ç½®', {
        chunkInterval: `${chunkInterval}ms (${chunkInterval / 1000}ç§’)`,
        mimeType: 'audio/webm;codecs=opus',
        configInfo: getAudioConfigInfo()
      })

      this.audioRecorder = new AudioRecorder({
        chunkInterval, // ä½¿ç”¨ç’°å¢ƒè®Šæ•¸é…ç½®çš„åˆ‡ç‰‡é–“éš”
        mimeType: 'audio/webm;codecs=opus'
      })

      this.logInfo(`éŸ³è¨Šé…ç½®: ${getAudioConfigInfo()}`)

      // è¨­å®šéŸ³é »éŒ„è£½å™¨äº‹ä»¶è™•ç†
      this.setupAudioRecorderEvents()

      // æ­¥é©Ÿ 2: é–‹å§‹éŸ³é »éŒ„è£½ï¼ˆåŒ…å«ç²å–æ¬Šé™ï¼‰
      this.logInfo('æ­¥é©Ÿ 2: é–‹å§‹éŸ³é »éŒ„è£½ï¼ˆåŒ…å«ç²å–æ¬Šé™ï¼‰')

      // æ­¥é©Ÿ 3: å»ºç«‹éŸ³é »ä¸Šå‚³ WebSocket
      this.logInfo('æ­¥é©Ÿ 3: å»ºç«‹éŸ³é »ä¸Šå‚³ WebSocket')
      this.audioUploadWs = new AudioUploadWebSocket(sessionId)

      // è¨­å®š WebSocket äº‹ä»¶è™•ç†
      this.setupWebSocketEvents()

      // é€£æ¥ WebSocket
      await this.audioUploadWs.connect()

      // é©—è­‰ WebSocket é€£æ¥
      if (!this.audioUploadWs.isConnected) {
        throw new Error('éŸ³é »ä¸Šå‚³ WebSocket é€£æ¥å¤±æ•—')
      }

      // æ­¥é©Ÿ 4: å•Ÿå‹•å¿ƒè·³æ©Ÿåˆ¶
      this.logInfo('æ­¥é©Ÿ 4: å•Ÿå‹•å¿ƒè·³æ©Ÿåˆ¶')
      this.startHeartbeat()

      // æ­¥é©Ÿ 5: é–‹å§‹éŒ„éŸ³
      this.logInfo('æ­¥é©Ÿ 5: é–‹å§‹éŸ³é »éŒ„è£½')
      await this.audioRecorder.start((chunk: AudioChunk) => {
        this.handleAudioChunk(chunk)
      })

      // æ­¥é©Ÿ 6: å•Ÿå‹•éŒ„éŸ³è¨ˆæ™‚å™¨
      this.logInfo('æ­¥é©Ÿ 6: å•Ÿå‹•éŒ„éŸ³è¨ˆæ™‚å™¨')
      this.startRecordingTimer()

      // æ›´æ–°éŒ„éŸ³ç‹€æ…‹
      this.recordingState.isRecording = true
      this.recordingState.error = null

      this.logSuccess('éŒ„éŸ³å•Ÿå‹•æˆåŠŸ', {
        sessionId,
        chunkConfig: getAudioConfigInfo(),
        mimeType: 'audio/webm;codecs=opus'
      })

    } catch (error) {
      // éŒ¯èª¤æ™‚æ¸…ç†è³‡æº
      await this.cleanupRecordingResources()
      this.recordingState.error = error instanceof Error ? error.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      this.handleError('é–‹å§‹éŒ„éŸ³', error)
    }
  }

  /**
   * åœæ­¢éŒ„éŸ³
   * ä¿æŒ WebSocket é€£æ¥ä»¥æ¥æ”¶å‰©é¤˜çš„è™•ç†çµæœ
   */
  async stopRecording(): Promise<void> {
    this.logInfo('åœæ­¢éŒ„éŸ³')

    try {
      // æ›´æ–°ç‹€æ…‹
      this.recordingState.isRecording = false

      // åœæ­¢éŸ³é »éŒ„è£½å™¨
      if (this.audioRecorder) {
        this.audioRecorder.stop()
        this.logInfo('éŸ³é »éŒ„è£½å™¨å·²åœæ­¢')
      }

      // åœæ­¢è¨ˆæ™‚å™¨
      this.clearTimers()

      // æ¸…ç†éŸ³é »éŒ„è£½å™¨ï¼ˆä¿ç•™ WebSocket é€£æ¥ï¼‰
      if (this.audioRecorder) {
        this.audioRecorder.cleanup()
        this.audioRecorder = null
      }

      // æ–·é–‹éŸ³é »ä¸Šå‚³ WebSocket
      if (this.audioUploadWs) {
        this.audioUploadWs.disconnect()
        this.audioUploadWs = null
      }

      this.logSuccess('éŒ„éŸ³åœæ­¢æˆåŠŸ', {
        sessionId: this.recordingState.currentSessionId,
        recordingTime: this.recordingState.recordingTime
      })

    } catch (error) {
      this.recordingState.error = error instanceof Error ? error.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      this.handleError('åœæ­¢éŒ„éŸ³', error)
    }
  }

  /**
   * å–å¾—ç•¶å‰éŒ„éŸ³ç‹€æ…‹
   */
  getRecordingState(): RecordingState {
    return { ...this.recordingState }
  }

  /**
   * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
   */
  isRecording(): boolean {
    return this.recordingState.isRecording
  }

  /**
   * å–å¾—éŒ„éŸ³æ™‚é–“ï¼ˆç§’ï¼‰
   */
  getRecordingTime(): number {
    console.log('â° [RecordingService] getRecordingTime', this.recordingState.recordingTime)
    return this.recordingState.recordingTime
  }

  /**
   * è¨­å®šéŸ³é »éŒ„è£½å™¨äº‹ä»¶è™•ç†
   */
  private setupAudioRecorderEvents(): void {
    if (!this.audioRecorder) return

    // è™•ç†éŒ„è£½éŒ¯èª¤
    this.audioRecorder.onError((error: Error) => {
      this.logWarning('éŸ³é »éŒ„è£½å™¨éŒ¯èª¤', error.message)
      this.recordingState.error = error.message
    })

    // è™•ç†ç‹€æ…‹è®ŠåŒ–
    this.audioRecorder.onStateChange((state) => {
      this.logInfo('éŸ³é »éŒ„è£½å™¨ç‹€æ…‹è®ŠåŒ–', state)
    })
  }

  /**
   * è¨­å®š WebSocket äº‹ä»¶è™•ç†
   */
  private setupWebSocketEvents(): void {
    if (!this.audioUploadWs) return

    // è™•ç† ACK/Missing è¨Šæ¯
    this.audioUploadWs.onAckMissing((data: AckMissingMessage) => {
      this.handleAckMissing(data)
    })

    // è™•ç† WebSocket é—œé–‰
    this.audioUploadWs.onClose((event) => {
      this.logWarning('éŸ³é »ä¸Šå‚³ WebSocket é€£æ¥é—œé–‰', {
        code: event.code,
        reason: event.reason
      })
    })
  }

  /**
   * è™•ç†éŸ³é »åˆ‡ç‰‡
   * å„²å­˜åˆ‡ç‰‡ä¸¦ä¸Šå‚³
   */
  private handleAudioChunk(chunk: AudioChunk): void {
    console.log('ğŸ¤ [RecordingService] æ”¶åˆ°éŸ³é »åˆ‡ç‰‡', {
      sequence: chunk.sequence,
      size: chunk.blob.size,
      duration: chunk.duration,
      timestamp: new Date().toISOString()
    })

    this.logInfo('æ”¶åˆ°éŸ³é »åˆ‡ç‰‡', {
      sequence: chunk.sequence,
      size: chunk.blob.size,
      duration: chunk.duration
    })

    // å„²å­˜åˆ‡ç‰‡ä¾›é‡å‚³ä½¿ç”¨
    this.audioChunks[chunk.sequence] = chunk

    // å¦‚æœ WebSocket å·²é€£æ¥ï¼Œç«‹å³ä¸Šå‚³
    if (this.audioUploadWs?.isConnected) {
      console.log('ğŸ“¤ [RecordingService] æº–å‚™ä¸Šå‚³éŸ³é »åˆ‡ç‰‡', {
        sequence: chunk.sequence,
        wsState: this.audioUploadWs.readyState,
        wsUrl: `/ws/upload_audio/${this.recordingState.currentSessionId}`
      })

      this.audioUploadWs.uploadAudioChunk(chunk.blob)

      console.log('âœ… [RecordingService] éŸ³é »åˆ‡ç‰‡å·²é€å‡º', {
        sequence: chunk.sequence,
        size: chunk.blob.size,
        time: new Date().toISOString()
      })

      this.logInfo('éŸ³é »åˆ‡ç‰‡å·²ä¸Šå‚³', { sequence: chunk.sequence })
    } else {
      console.error('âŒ [RecordingService] WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ä¸Šå‚³éŸ³é »åˆ‡ç‰‡', {
        sequence: chunk.sequence,
        wsState: this.audioUploadWs?.readyState || 'null',
        isConnected: this.audioUploadWs?.isConnected || false
      })

      this.logWarning('WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ä¸Šå‚³éŸ³é »åˆ‡ç‰‡', { sequence: chunk.sequence })
    }
  }

  /**
   * è™•ç† ACK/Missing è¨Šæ¯
   * å¯¦ç¾éŸ³é »åˆ‡ç‰‡é‡å‚³æ©Ÿåˆ¶
   */
  private handleAckMissing(data: AckMissingMessage): void {
    this.logInfo('æ”¶åˆ° ACK/Missing è¨Šæ¯', {
      ack: data.ack,
      missing: data.missing
    })

    if (data.missing.length > 0) {
      this.logWarning('æª¢æ¸¬åˆ°éºå¤±çš„éŸ³é »åˆ‡ç‰‡ï¼Œæº–å‚™é‡å‚³', data.missing)

      // é‡å‚³éºå¤±çš„åˆ‡ç‰‡
      data.missing.forEach(sequence => {
        const retryCount = this.retryCounts.get(sequence) ?? 0

        if (retryCount < 5) { // æœ€å¤šé‡å‚³ 5 æ¬¡
          this.retryCounts.set(sequence, retryCount + 1)

          // å°‹æ‰¾å°æ‡‰çš„éŸ³é »åˆ‡ç‰‡é€²è¡Œé‡å‚³
          if (this.audioChunks[sequence]) {
            this.logInfo('é‡å‚³éŸ³é »åˆ‡ç‰‡', {
              sequence,
              retryCount: retryCount + 1,
              maxRetries: 5
            })
            this.audioUploadWs?.uploadAudioChunk(this.audioChunks[sequence].blob)
          } else {
            this.logWarning('æ‰¾ä¸åˆ°è¦é‡å‚³çš„éŸ³é »åˆ‡ç‰‡', { sequence })
          }
        } else {
          this.logWarning('éŸ³é »åˆ‡ç‰‡é‡å‚³æ¬¡æ•¸å·²é”ä¸Šé™', {
            sequence,
            maxRetries: 5
          })
        }
      })
    }
  }

  /**
   * å•Ÿå‹•éŒ„éŸ³è¨ˆæ™‚å™¨
   */
  private startRecordingTimer(): void {
    this.clearRecordingTimer()
    this.recordingState.recordingTime = 0

    console.log('â±ï¸ [RecordingService] è¨ˆæ™‚å™¨å•Ÿå‹•')
    this.recordingTimer = setInterval(() => {
      this.recordingState.recordingTime += 1

      // æ¯ 30 ç§’è¨˜éŒ„ä¸€æ¬¡éŒ„éŸ³æ™‚é–“
      if (this.recordingState.recordingTime % 30 === 0) {
        this.logInfo('éŒ„éŸ³é€²è¡Œä¸­', {
          recordingTime: this.recordingState.recordingTime,
          minutes: Math.floor(this.recordingState.recordingTime / 60)
        })
      }
    }, 1000)
  }

  /**
   * å•Ÿå‹•å¿ƒè·³æ©Ÿåˆ¶
   */
  private startHeartbeat(): void {
    this.clearHeartbeatTimer()

    this.heartbeatTimer = setInterval(() => {
      if (this.audioUploadWs?.isConnected) {
        this.audioUploadWs.send(JSON.stringify({
          type: 'heartbeat',
          timestamp: Date.now()
        }))
        this.logInfo('ç™¼é€å¿ƒè·³è¨Šè™Ÿ')
      }
    }, 30000) // æ¯ 30 ç§’ç™¼é€ä¸€æ¬¡å¿ƒè·³
  }

  /**
   * æ¸…ç†æ‰€æœ‰è¨ˆæ™‚å™¨
   */
  private clearTimers(): void {
    this.clearRecordingTimer()
    this.clearHeartbeatTimer()
  }

  /**
   * æ¸…ç†éŒ„éŸ³è¨ˆæ™‚å™¨
   */
  private clearRecordingTimer(): void {
    if (this.recordingTimer) {
      clearInterval(this.recordingTimer)
      this.recordingTimer = null
      console.log('â¹ï¸ [RecordingService] è¨ˆæ™‚å™¨æ¸…é™¤')
    }
  }

  /**
   * æ¸…ç†å¿ƒè·³è¨ˆæ™‚å™¨
   */
  private clearHeartbeatTimer(): void {
    if (this.heartbeatTimer) {
      clearInterval(this.heartbeatTimer)
      this.heartbeatTimer = null
    }
  }

  /**
   * é‡ç½®éŒ„éŸ³ç‹€æ…‹
   */
  private resetRecordingState(): void {
    this.recordingState = {
      isRecording: false,
      recordingTime: 0,
      currentSessionId: null,
      error: null
    }
    this.audioChunks = []
    this.retryCounts.clear()
  }

  /**
   * æ¸…ç†éŒ„éŸ³ç›¸é—œè³‡æº
   * éŒ¯èª¤è™•ç†æ™‚ä½¿ç”¨
   */
  private async cleanupRecordingResources(): Promise<void> {
    try {
      // åœæ­¢éŸ³é »éŒ„è£½å™¨
      if (this.audioRecorder) {
        this.audioRecorder.stop()
        this.audioRecorder.cleanup()
        this.audioRecorder = null
      }

      // é—œé–‰ WebSocket é€£æ¥
      if (this.audioUploadWs) {
        this.audioUploadWs.disconnect()
        this.audioUploadWs = null
      }

      // æ¸…ç†è¨ˆæ™‚å™¨
      this.clearTimers()

      // é‡ç½®ç‹€æ…‹
      this.recordingState.isRecording = false

      this.logInfo('éŒ„éŸ³è³‡æºæ¸…ç†å®Œæˆ')
    } catch (error) {
      this.logWarning('æ¸…ç†éŒ„éŸ³è³‡æºæ™‚ç™¼ç”ŸéŒ¯èª¤', error)
    }
  }

  /**
   * ç²å–æœå‹™è©³ç´°ç‹€æ…‹
   * æ“´å±•åŸºç¤ç‹€æ…‹ï¼ŒåŒ…å«éŒ„éŸ³ç‰¹å®šä¿¡æ¯
   */
  async getDetailedStatus(): Promise<RecordingServiceStatus> {
    const baseStatus = this.getStatus()
    const supportCheck = await checkAudioRecordingSupport()

    return {
      ...baseStatus,
      recordingState: this.getRecordingState(),
      audioSupport: {
        supported: supportCheck.isSupported,
        errors: supportCheck.error ? [supportCheck.error] : []
      },
      audioRecorderState: this.audioRecorder?.currentState ?? null,
      webSocketConnected: this.audioUploadWs?.isConnected ?? false,
      chunksCount: this.audioChunks.length,
      retryCount: Array.from(this.retryCounts.values()).reduce((sum, count) => sum + count, 0)
    }
  }
}

/**
 * RecordingService è©³ç´°ç‹€æ…‹ä»‹é¢
 */
export interface RecordingServiceStatus {
  serviceName: string
  isInitialized: boolean
  isRunning: boolean
  timestamp: string
  recordingState: RecordingState
  audioSupport: {
    supported: boolean
    errors: string[]
  }
  audioRecorderState: string | null
  webSocketConnected: boolean
  chunksCount: number
  retryCount: number
}


# END FILE CONTENTS


# File: .gptree_config

# GPTree Local Config
version: 2

# Whether to use .gitignore
useGitIgnore: true
# File types to include (e.g., .py,.js)
includeFileTypes: *
# File types to exclude when includeFileTypes is '*'
excludeFileTypes: 
# Output file name
outputFile: gptree_output.txt
# Whether to output the file locally or relative to the project directory
outputFileLocally: true
# Whether to copy the output to the clipboard
copyToClipboard: false
# Whether to use safe mode (prevent overly large files from being combined)
safeMode: true
# Whether to store the files chosen in the config file (--save, -s)
storeFilesChosen: true
# Whether to include line numbers in the output (--line-numbers, -n)
lineNumbers: false
# Whether to show ignored files in the directory tree
showIgnoredInTree: false
# Whether to show only default ignored files in the directory tree while still respecting gitignore
showDefaultIgnoredInTree: false
# Previously selected files (when using the -s or --save flag previously)
previousFiles: frontend/components/ui/ExportButton.test.tsx,app/ws/__init__.py,app/ws/transcript_feed.py,frontend/hooks/use-session.test.ts,frontend/__tests__/integration/state-transitions.test.ts,frontend/e2e/service-layer-integration.spec.ts,frontend/hooks/use-session.ts,frontend/package.json,frontend/lib/services/__tests__/session-service.test.ts,app/api/__init__.py,app/services/stt/base.py,app/db/supabase_config.py,frontend/lib/__tests__/state-machine.test.ts,frontend/public/placeholder-user.jpg,frontend/components/ui/toast.tsx,frontend/components/ui/toggle-group.tsx,frontend/components/ui/separator.tsx,docs/traceback-debug-spec.md,frontend/hooks/use-app-state-adapter.ts,app/api/notes.py,app/db/database.py,app/services/azure_whisper.py,.gptree_config,app/services/stt/factory.py,frontend/components/ui/carousel.tsx,frontend/hooks/use-recording-adapter.ts,frontend/components/ui/sheet.tsx,frontend/lib/services/__tests__/simple-recording-service.test.ts,frontend/components/recording-state.tsx,uv.lock,frontend/components/ui/command.tsx,frontend/utils/export.ts,frontend/components/ui/sidebar.tsx,frontend/constants/providers.ts,app/middleware/__init__.py,frontend/hooks/use-local-draft.ts,frontend/src/test-setup.ts,frontend/README.md,docs/export-transcript-format.md,frontend/components/ui/popover.tsx,.editorconfig,app/services/stt/save_utils.py,app/services/stt/__init__.py,docs/lang-map-refactor.md,frontend/hooks/use-transcript-adapter.ts,PRD.md,frontend/lib/__tests__/initial-state-loader.test.ts,frontend/utils/event-bus.ts,package.json,docs/export-wait-until-completed-20240608.md,frontend/lib/__tests__/segmented-audio-recorder.test.ts,frontend/app/globals.css,app/db/supabase_init.sql,frontend/.eslintrc.json,frontend/components/default-state.tsx,frontend/lib/services/session-service.ts,frontend/e2e/transcript-integration.spec.ts,frontend/lib/services/transcript-service-adapted.ts,frontend/lib/typed-emitter.ts,.dockerignore,app/core/container.py,frontend/components/ui/collapsible.tsx,frontend/types/state-transitions.ts,frontend/components/theme-provider.tsx,frontend/components/ui/textarea.tsx,docs/export-spec.md,frontend/hooks/use-session-adapter.ts,frontend/components/ui/alert.tsx,frontend/components/ui/switch.tsx,frontend/components/recording-active-state.tsx,app/services/__init__.py,frontend/types/websocket-messages.ts,app/api/sessions.py,frontend/tailwind.config.ts,frontend/lib/services/service-registry.ts,frontend/lib/stream/audio-uploader.ts,frontend/lib/__tests__/network-restorer.test.ts,app/core/__init__.py,.cursor/rules/python.mdc,app/lib/prom_helpers.py,frontend/components/ui/slider.tsx,frontend/lib/state-machine.ts,frontend/components/ui/use-mobile.tsx,frontend/components/ui/calendar.tsx,frontend/public/placeholder-logo.svg,app/api/export.py,.cursor/rules/react.mdc,frontend/lib/advanced-audio-recorder.ts,frontend/lib/services/interfaces.ts,app/services/transcript_feed.py,frontend/components/ui/button.tsx,pytest.ini,frontend/hooks/use-session-new.ts,frontend/components/ui/use-toast.ts,frontend/types/app-state.ts,frontend/lib/segmented-audio-recorder.ts,frontend/types/app-state-context.ts,frontend/public/placeholder.svg,frontend/components/provider-context-menu.tsx,app/__init__.py,app/core/webm_header_repairer.py,frontend/components/ui/navigation-menu.tsx,frontend/lib/services/recording-flow-service.ts,frontend/components/ui/accordion.tsx,app/utils/validators.py,frontend/components/ui/input.tsx,frontend/hooks/use-notes.ts,frontend/hooks/use-transcript-new.ts,app/db/__init__.py,e2e/export-api.spec.ts,main.py,app/services/stt/lang_map.py,frontend/components/ui/aspect-ratio.tsx,app/services/stt/gpt4o_provider.py,frontend/components/ui/badge.tsx,app/schemas/note.py,frontend/hooks/use-mobile.tsx,frontend/__tests__/integration/app-state-provider.test.tsx,frontend/__tests__/integration/state-transitions.test.tsx,frontend/components/ui/resizable.tsx,frontend/postcss.config.mjs,.cursor/rules/frontend.mdc,SPEC.md,app/ws/upload_audio.py,frontend/components/NetworkRestorerClient.tsx,frontend/hooks/use-recording-new.ts,frontend/lib/feature-flags.ts,frontend/components/ui/radio-group.tsx,frontend/lib/services/__tests__/session-service-409.test.ts,frontend/components/ui/pagination.tsx,frontend/lib/utils.ts,frontend/e2e/export-api.spec.ts,frontend/lib/__tests__/state-management.test.ts,app/schemas/session.py,frontend/lib/transcript-manager.ts,README.md,frontend/components.json,Todos.md,frontend/lib/services/simple-recording-service.ts,frontend/lib/migration-adapter.ts,app/services/azure_openai_v2.py,frontend/components/ui/sonner.tsx,.env.example,frontend/components/ui/chart.tsx,frontend/app/layout.tsx,frontend/styles/globals.css,frontend/lib/rest-audio-uploader.ts,app/services/stt/gemini_provider.py,docs/export-tdd-tasks.md,frontend/components/ui/breadcrumb.tsx,frontend/utils/time.ts,frontend/components/ui/input-otp.tsx,frontend/components/ui/dropdown-menu.tsx,frontend/app/page.tsx,.cursor/rules/backend.mdc,frontend/lib/services/base-service.ts,docs/stop-processing-finish-flow.md,frontend/e2e/offline-recovery.spec.ts,.cursor/rules/ui-rules/create-prototype.mdc,app/core/ffmpeg.py,frontend/components/ui/scroll-area.tsx,docs/webm-to-wav-gpt4o.md,frontend/lib/api.test.ts,frontend/next.config.mjs,frontend/hooks/use-app-state.ts,app/utils/timer.py,app/utils/timing.py,frontend/components/ui/label.tsx,frontend/lib/services/recording-service.ts,frontend/lib/app-state-reducer.ts,frontend/lib/services/__tests__/recording-service.test.ts,.cursorignore,frontend/lib/transcript-manager-new.ts,frontend/pnpm-lock.yaml,frontend/components/ui/checkbox.tsx,frontend/public/placeholder-logo.png,frontend/components/ui/toaster.tsx,frontend/components/ui/drawer.tsx,frontend/providers/app-state-provider-wrapper.tsx,frontend/study-scriber.tsx,frontend/components/ui/form.tsx,frontend/.env.example,frontend/components/SessionLoadingOverlay.tsx,frontend/test-transcript-integration.js,frontend/hooks/use-app-state-context.ts,frontend/tsconfig.json,app/api/segments.py,frontend/app-store-zustand.ts,frontend/components/ui/avatar.tsx,app/services/r2_client.py,frontend/lib/initial-state-loader.ts,frontend/lib/audio-recorder.ts,frontend/__tests__/integration/websocket-state-sync.test.ts,.cursor/rules/rules.mdc,frontend/lib/stream/__tests__/audio-uploader.test.ts,playwright.config.ts,frontend/components/recording-waiting-state.tsx,frontend/components/ui/table.tsx,app/lib/httpx_timeout.py,frontend/components/upload-status-indicator.tsx,frontend/constants/languages.ts,frontend/lib/__tests__/advanced-audio-recorder.test.ts,frontend/vitest.config.ts,frontend/lib/services/transcript-service.ts,.cursor/rules/ui-rules/shadcn-tailwind-ui-guideline.mdc,frontend/hooks/use-recording.ts,pyproject.toml,frontend/components/ui/select.tsx,frontend/lib/services/service-container.ts,frontend/hooks/use-transcript.ts,pnpm-lock.yaml,frontend/components/ui/tabs.tsx,frontend/lib/api.ts,frontend/components/ui/toggle.tsx,frontend/lib/__tests__/migration-adapter.test.ts,frontend/lib/__tests__/rest-audio-uploader-409.test.ts,frontend/lib/interfaces.ts,app/core/audio_vad.py,app/utils/__init__.py,frontend/components/ui/skeleton.tsx,frontend/hooks/use-app-state-new.ts,frontend/hooks/use-toast.ts,docs/skip-silence-spec.md,frontend/lib/simple-audio-recorder.ts,frontend/refresh.ts,app/services/stt/interfaces.py,app/core/config.py,frontend/hooks/useNetworkRestorer.ts,frontend/components/ui/hover-card.tsx,docs/auto-retry-upload-spec.md,frontend/components/waiting-state.tsx,frontend/components/ui/ExportButton.tsx,.cursor/rules/playwright-e2e-testing.mdc,frontend/components/ui/dialog.tsx,frontend/components/ui/context-menu.tsx,frontend/lib/config.ts,frontend/components/ui/menubar.tsx,frontend/lib/app-store-zustand.ts,app/lib/rate_limit.py,frontend/lib/services/__tests__/recording-flow-service.test.ts,docs/ADD_GEMINI.md,frontend/components/ui/alert-dialog.tsx,frontend/components/ui/card.tsx,frontend/components/ui/tooltip.tsx,app/schemas/__init__.py,app/lib/settings_utils.py,frontend/lib/services/__tests__/transcript-service.test.ts,frontend/components/finish-state.tsx,app/services/stt/whisper_provider.py,frontend/lib/websocket.ts,frontend/lib/transcript-manager-adapter.ts,frontend/public/placeholder.jpg,frontend/lib/services/index.ts,frontend/playwright.config.ts,frontend/components/ui/progress.tsx,frontend/lib/app-store.ts


# END FILE CONTENTS


# File: .dockerignore

frontend/
.git/
node_modules/
__pycache__/
*.log
*.md
.venv
.serena
.cursor
.vscode


# END FILE CONTENTS


# File: frontend/lib/services/transcript-service.ts

"use client"

import { BaseService } from './base-service'
import { ITranscriptService, TranscriptMessage } from './interfaces'
import { transcriptManager } from '../transcript-manager'

/**
 * é€å­—ç¨¿æœå‹™è³‡è¨Šä»‹é¢
 */
interface TranscriptServiceInfo {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    connectedSessions: string[]
    activeListeners: Record<string, number>
    totalConnections: number
    transcriptManagerConnections: number
}

/**
 * TranscriptService - é€å­—ç¨¿æœå‹™
 *
 * è·è²¬ï¼š
 * - å°è£ TranscriptManager çš„ API ç‚ºæœå‹™å±¤æ¥å£
 * - æä¾›çµ±ä¸€çš„é€å­—ç¨¿é€£æ¥å’Œæ¶ˆæ¯è™•ç†
 * - ä¿æŒ TranscriptManager çš„ç¨ç«‹æ€§å’Œ WebSocket é‡é€£æ©Ÿåˆ¶
 * - æ”¯æŒå¤šæœƒè©±çš„é€å­—ç¨¿ç®¡ç†
 */
export class TranscriptService extends BaseService implements ITranscriptService {
    protected readonly serviceName = 'TranscriptService'

    private connectedSessions: Set<string> = new Set()
    private sessionListeners: Map<string, Set<(message: TranscriptMessage) => void>> = new Map()

    /**
     * åˆå§‹åŒ–æœå‹™
     */
    async initialize(): Promise<void> {
        this.logInfo('åˆå§‹åŒ–é€å­—ç¨¿æœå‹™')
        // TranscriptManager æ˜¯ Singletonï¼Œç„¡éœ€ç‰¹åˆ¥åˆå§‹åŒ–
    }

    /**
     * æ¸…ç†æœå‹™è³‡æº
     */
    async cleanup(): Promise<void> {
        this.logInfo('æ¸…ç†é€å­—ç¨¿æœå‹™è³‡æº')

        // æ–·é–‹æ‰€æœ‰é€£æ¥
        const sessionIds = Array.from(this.connectedSessions)
        for (const sessionId of sessionIds) {
            await this.disconnect(sessionId)
        }

        this.connectedSessions.clear()
        this.sessionListeners.clear()
    }

    /**
     * é€£æ¥é€å­—ç¨¿æœå‹™
     */
    async connect(sessionId: string): Promise<void> {
        if (!this.isRunning) {
            throw new Error('TranscriptService å°šæœªå•Ÿå‹•ï¼Œè«‹å…ˆèª¿ç”¨ start()')
        }

        try {
            this.logInfo(`é€£æ¥é€å­—ç¨¿æœå‹™: ${sessionId}`)

            // ä½¿ç”¨ TranscriptManager å»ºç«‹é€£æ¥
            await transcriptManager.connect(sessionId)

            // è¨˜éŒ„é€£æ¥ç‹€æ…‹
            this.connectedSessions.add(sessionId)

            this.logSuccess(`é€å­—ç¨¿æœå‹™é€£æ¥æˆåŠŸ: ${sessionId}`)
        } catch (error) {
            this.handleError(`é€å­—ç¨¿æœå‹™é€£æ¥å¤±æ•—: ${sessionId}`, error)
        }
    }

    /**
     * æ–·é–‹é€å­—ç¨¿æœå‹™
     */
    async disconnect(sessionId?: string): Promise<void> {
        try {
            if (sessionId) {
                this.logInfo(`æ–·é–‹é€å­—ç¨¿æœå‹™: ${sessionId}`)

                // ç§»é™¤æ‰€æœ‰ç›£è½å™¨
                const listeners = this.sessionListeners.get(sessionId)
                if (listeners) {
                    listeners.forEach(callback => {
                        transcriptManager.removeListener(sessionId, callback)
                    })
                    this.sessionListeners.delete(sessionId)
                }

                // æ–·é–‹é€£æ¥
                await transcriptManager.disconnect(sessionId)
                this.connectedSessions.delete(sessionId)

                this.logSuccess(`é€å­—ç¨¿æœå‹™æ–·é–‹æˆåŠŸ: ${sessionId}`)
            } else {
                // æ–·é–‹æ‰€æœ‰é€£æ¥
                this.logInfo('æ–·é–‹æ‰€æœ‰é€å­—ç¨¿æœå‹™é€£æ¥')
                const sessionIds = Array.from(this.connectedSessions)
                for (const id of sessionIds) {
                    await this.disconnect(id)
                }
            }
        } catch (error) {
            this.handleError(`æ–·é–‹é€å­—ç¨¿æœå‹™å¤±æ•—: ${sessionId || 'all'}`, error)
        }
    }

    /**
     * æ·»åŠ é€å­—ç¨¿ç›£è½å™¨
     */
    addTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
        if (!this.isRunning) {
            throw new Error('TranscriptService å°šæœªå•Ÿå‹•ï¼Œè«‹å…ˆèª¿ç”¨ start()')
        }

        this.logInfo(`æ·»åŠ é€å­—ç¨¿ç›£è½å™¨: ${sessionId}`)

        // è¨˜éŒ„ç›£è½å™¨
        if (!this.sessionListeners.has(sessionId)) {
            this.sessionListeners.set(sessionId, new Set())
        }
        this.sessionListeners.get(sessionId)!.add(callback)

        // æ·»åŠ åˆ° TranscriptManager
        transcriptManager.addListener(sessionId, callback)
    }

    /**
     * ç§»é™¤é€å­—ç¨¿ç›£è½å™¨
     */
    removeTranscriptListener(sessionId: string, callback: (message: TranscriptMessage) => void): void {
        this.logInfo(`ç§»é™¤é€å­—ç¨¿ç›£è½å™¨: ${sessionId}`)

        // å¾è¨˜éŒ„ä¸­ç§»é™¤
        const listeners = this.sessionListeners.get(sessionId)
        if (listeners) {
            listeners.delete(callback)
            if (listeners.size === 0) {
                this.sessionListeners.delete(sessionId)
            }
        }

        // å¾ TranscriptManager ç§»é™¤
        transcriptManager.removeListener(sessionId, callback)
    }

    /**
     * æª¢æŸ¥é€£æ¥ç‹€æ…‹
     */
    isConnected(sessionId: string): boolean {
        return transcriptManager.isConnected(sessionId)
    }

    /**
     * æ¸…é™¤é€å­—ç¨¿
     *
     * æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸æœƒæ¸…é™¤ TranscriptManager ä¸­çš„æ•¸æ“šï¼Œ
     * å› ç‚º TranscriptManager æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œåªè² è²¬ WebSocket é€£æ¥ã€‚
     * å¯¦éš›çš„é€å­—ç¨¿æ•¸æ“šæ‡‰è©²ç”±ç‹€æ…‹ç®¡ç†å±¤è™•ç†ã€‚
     */
    clearTranscripts(sessionId: string): void {
        this.logInfo(`æ¸…é™¤é€å­—ç¨¿: ${sessionId}`)
        // TranscriptManager ä¸å„²å­˜é€å­—ç¨¿æ•¸æ“šï¼Œé€™å€‹æ–¹æ³•ä¸»è¦ç”¨æ–¼è§¸ç™¼ç‹€æ…‹æ¸…é™¤
        // å¯¦éš›çš„æ¸…é™¤é‚è¼¯æ‡‰è©²åœ¨ç‹€æ…‹ç®¡ç†å±¤å¯¦ç¾
    }

    /**
     * å–å¾—æœå‹™ç‹€æ…‹è³‡è¨Š
     */
    getServiceInfo(): TranscriptServiceInfo {
        return {
            serviceName: this.serviceName,
            isInitialized: this.isInitialized,
            isRunning: this.isRunning,
            connectedSessions: Array.from(this.connectedSessions),
            activeListeners: Object.fromEntries(
                Array.from(this.sessionListeners.entries()).map(([sessionId, listeners]) => [
                    sessionId,
                    listeners.size
                ])
            ),
            totalConnections: this.connectedSessions.size,
            transcriptManagerConnections: transcriptManager.getConnectionCount()
        }
    }
}


# END FILE CONTENTS


# File: frontend/lib/migration-adapter.ts

"use client"

import { useEffect, useRef, useCallback } from "react"
import { AppData, AppState, SessionStatus, SessionType, TranscriptEntry } from "../types/app-state"
import { AppStateContextValue } from "../types/app-state-context"
import { isFeatureEnabled } from "./feature-flags"

// Legacy Hook ä»‹é¢å®šç¾©
export interface LegacyAppStateHook {
    appData: AppData
    isLoading: boolean
    error: string | null
    startRecording: (title?: string) => Promise<void>
    stopRecording: () => Promise<void>
    newNote: () => Promise<void>
    saveLocalDraft: (content: string) => void
    session: { id: string; status: SessionStatus; type: SessionType } | null
    recordingError: string | null
    transcriptError: string | null
    createNoteSession: (title?: string) => Promise<void>
    sessionLoading: boolean
}

// ç‹€æ…‹åŒæ­¥æ©‹æ¥å™¨
export class StateSyncBridge {
    private newContext: AppStateContextValue | null = null
    private legacyHook: LegacyAppStateHook | null = null
    private syncEnabled: boolean = true
    private lastSyncTimestamp: number = 0
    private syncInProgress: boolean = false

    constructor() {
        this.exposeToWindow()
    }

    // è¨»å†Šæ–° Context
    registerNewContext(context: AppStateContextValue): void {
        this.newContext = context
        console.log('ğŸ”„ [StateSyncBridge] æ–° Context å·²è¨»å†Š')
        this.performSync('new-context-registered')
    }

    // è¨»å†ŠèˆŠ Hook
    registerLegacyHook(hook: LegacyAppStateHook): void {
        this.legacyHook = hook
        console.log('ğŸ”„ [StateSyncBridge] èˆŠ Hook å·²è¨»å†Š')
        this.performSync('legacy-hook-registered')
    }

    // åŸ·è¡Œç‹€æ…‹åŒæ­¥
    private performSync(trigger: string): void {
        if (!this.syncEnabled || this.syncInProgress) return
        if (!this.newContext || !this.legacyHook) return

        this.syncInProgress = true
        const syncTimestamp = Date.now()

        try {
            // é¿å…éæ–¼é »ç¹çš„åŒæ­¥
            if (syncTimestamp - this.lastSyncTimestamp < 100) {
                this.syncInProgress = false
                return
            }

            console.log(`ğŸ”„ [StateSyncBridge] åŸ·è¡Œç‹€æ…‹åŒæ­¥ (è§¸ç™¼: ${trigger})`)

            // æ±ºå®šåŒæ­¥æ–¹å‘ï¼šæ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šèª°æ˜¯ä¸»è¦æ•¸æ“šæº
            const useNewAsSource = isFeatureEnabled('useNewStateManagement')

            if (useNewAsSource) {
                this.syncFromNewToLegacy()
            } else {
                this.syncFromLegacyToNew()
            }

            this.lastSyncTimestamp = syncTimestamp
        } catch (error) {
            console.error('ğŸ”„ [StateSyncBridge] åŒæ­¥å¤±æ•—:', error)
        } finally {
            this.syncInProgress = false
        }
    }

    // å¾æ–°ç³»çµ±åŒæ­¥åˆ°èˆŠç³»çµ±
    private syncFromNewToLegacy(): void {
        if (!this.newContext || !this.legacyHook) return

        const newData = this.newContext.appData
        const legacyData = this.legacyHook.appData

        // æª¢æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
        const needsSync = this.detectDifferences(newData, legacyData)

        if (needsSync.length > 0) {
            console.log('ğŸ”„ [StateSyncBridge] å¾æ–°ç³»çµ±åŒæ­¥åˆ°èˆŠç³»çµ±:', needsSync)
            // æ³¨æ„ï¼šé€™è£¡ä¸èƒ½ç›´æ¥ä¿®æ”¹ legacyDataï¼Œéœ€è¦é€é legacy hook çš„æ–¹æ³•
            // å¯¦éš›å¯¦ä½œæ™‚éœ€è¦æ ¹æ“š legacy hook çš„ API ä¾†åŒæ­¥
        }
    }

    // å¾èˆŠç³»çµ±åŒæ­¥åˆ°æ–°ç³»çµ±
    private syncFromLegacyToNew(): void {
        if (!this.newContext || !this.legacyHook) return

        const legacyData = this.legacyHook.appData
        const newData = this.newContext.appData

        // æª¢æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
        const needsSync = this.detectDifferences(legacyData, newData)

        if (needsSync.length > 0) {
            console.log('ğŸ”„ [StateSyncBridge] å¾èˆŠç³»çµ±åŒæ­¥åˆ°æ–°ç³»çµ±:', needsSync)

            // åŒæ­¥å„å€‹æ¬„ä½
            if (needsSync.includes('state')) {
                this.newContext.setState(legacyData.state)
            }
            if (needsSync.includes('isRecording')) {
                this.newContext.setRecording(legacyData.isRecording)
            }
            if (needsSync.includes('recordingTime')) {
                this.newContext.setRecordingTime(legacyData.recordingTime)
            }
            if (needsSync.includes('editorContent')) {
                this.newContext.setEditorContent(legacyData.editorContent)
            }
            if (needsSync.includes('transcriptEntries')) {
                this.newContext.setTranscriptEntries(legacyData.transcriptEntries)
            }
            if (needsSync.includes('session')) {
                this.newContext.setSession(legacyData.session || null)
            }
        }
    }

    // æª¢æ¸¬å…©å€‹ç‹€æ…‹ä¹‹é–“çš„å·®ç•°
    private detectDifferences(source: AppData, target: AppData): string[] {
        const differences: string[] = []

        if (source.state !== target.state) {
            differences.push('state')
        }
        if (source.isRecording !== target.isRecording) {
            differences.push('isRecording')
        }
        if (source.recordingTime !== target.recordingTime) {
            differences.push('recordingTime')
        }
        if (source.editorContent !== target.editorContent) {
            differences.push('editorContent')
        }
        if (source.transcriptEntries.length !== target.transcriptEntries.length) {
            differences.push('transcriptEntries')
        }
        if (JSON.stringify(source.session) !== JSON.stringify(target.session)) {
            differences.push('session')
        }

        return differences
    }

    // å•Ÿç”¨/åœç”¨åŒæ­¥
    enableSync(): void {
        this.syncEnabled = true
        console.log('ğŸ”„ [StateSyncBridge] ç‹€æ…‹åŒæ­¥å·²å•Ÿç”¨')
    }

    disableSync(): void {
        this.syncEnabled = false
        console.log('ğŸ”„ [StateSyncBridge] ç‹€æ…‹åŒæ­¥å·²åœç”¨')
    }

    // æ‰‹å‹•è§¸ç™¼åŒæ­¥
    manualSync(): void {
        this.performSync('manual-trigger')
    }

    // å–å¾—åŒæ­¥ç‹€æ…‹
    getSyncStatus(): { enabled: boolean; lastSync: number; inProgress: boolean } {
        return {
            enabled: this.syncEnabled,
            lastSync: this.lastSyncTimestamp,
            inProgress: this.syncInProgress,
        }
    }

    // æš´éœ²åˆ° window ä¾›èª¿è©¦ä½¿ç”¨
    private exposeToWindow(): void {
        if (typeof window !== 'undefined') {
            (window as any).stateSyncBridge = {
                enableSync: () => this.enableSync(),
                disableSync: () => this.disableSync(),
                manualSync: () => this.manualSync(),
                getStatus: () => this.getSyncStatus(),
            }

            console.log('ğŸ”„ [StateSyncBridge] èª¿è©¦ä»‹é¢å·²æš´éœ²åˆ° window.stateSyncBridge')
        }
    }
}

// å–®ä¾‹æ¨¡å¼
export const stateSyncBridge = new StateSyncBridge()

// Legacy Hook é©é…å™¨
export function useLegacyHookAdapter(legacyHook: LegacyAppStateHook): LegacyAppStateHook {
    const hasRegistered = useRef(false)

    useEffect(() => {
        if (!hasRegistered.current && isFeatureEnabled('enableStateSync')) {
            stateSyncBridge.registerLegacyHook(legacyHook)
            hasRegistered.current = true
        }
    }, [legacyHook])

    // å¦‚æœå•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç†ï¼Œè¿”å›é©é…å¾Œçš„ç‰ˆæœ¬
    if (isFeatureEnabled('useNewStateManagement')) {
        // TODO: è¿”å›é©é…å¾Œçš„ç‰ˆæœ¬ï¼Œé€™è£¡æš«æ™‚è¿”å›åŸç‰ˆæœ¬
        return legacyHook
    }

    return legacyHook
}

// New Context é©é…å™¨
export function useNewContextAdapter(newContext: AppStateContextValue): AppStateContextValue {
    const hasRegistered = useRef(false)

    useEffect(() => {
        if (!hasRegistered.current && isFeatureEnabled('enableStateSync')) {
            stateSyncBridge.registerNewContext(newContext)
            hasRegistered.current = true
        }
    }, [newContext])

    return newContext
}

// æ··åˆæ¨¡å¼ Hook - æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨å“ªå€‹ç³»çµ±
export function useHybridState(
    legacyHook: LegacyAppStateHook,
    newContext: AppStateContextValue
): LegacyAppStateHook {
    const useNew = isFeatureEnabled('useNewStateManagement')

    // è¨»å†Šåˆ°åŒæ­¥æ©‹æ¥å™¨
    useEffect(() => {
        if (isFeatureEnabled('enableStateSync')) {
            stateSyncBridge.registerLegacyHook(legacyHook)
            stateSyncBridge.registerNewContext(newContext)
        }
    }, [legacyHook, newContext])

    if (useNew) {
        // å°‡æ–° Context é©é…ç‚º Legacy Hook ä»‹é¢
        return {
            appData: newContext.appData,
            isLoading: newContext.isLoading,
            error: newContext.error,
            // TODO: å¯¦ä½œå…¶ä»–æ–¹æ³•çš„é©é…
            startRecording: legacyHook.startRecording,
            stopRecording: legacyHook.stopRecording,
            newNote: legacyHook.newNote,
            saveLocalDraft: legacyHook.saveLocalDraft,
            session: newContext.appData.session || null,
            recordingError: legacyHook.recordingError,
            transcriptError: legacyHook.transcriptError,
            createNoteSession: legacyHook.createNoteSession,
            sessionLoading: legacyHook.sessionLoading,
        }
    }

    return legacyHook
}


# END FILE CONTENTS


# File: frontend/app-store-zustand.ts

export type AppState =
    | 'default'
    | 'session_creating'
    | 'recording_waiting'
    | 'recording_active'
    | 'processing'
    | 'finished'


# END FILE CONTENTS


# File: frontend/components/ui/breadcrumb.tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:w-3.5 [&>svg]:h-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}


# END FILE CONTENTS


# File: frontend/components/ui/alert-dialog.tsx

"use client"

import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}


# END FILE CONTENTS


# File: frontend/__tests__/integration/app-state-provider.test.tsx

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { render, screen, act } from '@testing-library/react'
import { createElement } from 'react'
import { AppStateProviderWrapper } from '../../providers/app-state-provider-wrapper'
import { useAppState } from '../../hooks/use-app-state-adapter'
import { featureFlagManager } from '../../lib/feature-flags'

// Mock å¤–éƒ¨ä¾è³´
vi.mock('../../hooks/use-session-adapter', () => ({
    useSession: vi.fn(() => ({
        currentSession: null,
        isLoading: false,
        error: null,
        createNoteSession: vi.fn(),
        createRecordingSession: vi.fn(),
        upgradeToRecording: vi.fn(),
        finishSession: vi.fn(),
        deleteSession: vi.fn(),
        checkActiveSession: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-recording-adapter', () => ({
    useRecording: vi.fn(() => ({
        isRecording: false,
        recordingTime: 0,
        transcripts: [],
        error: null,
        startRecording: vi.fn(),
        stopRecording: vi.fn(),
        clearTranscripts: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-notes', () => ({
    useNotes: vi.fn(() => ({
        noteContent: '',
        loadNote: vi.fn(),
        clearNote: vi.fn(),
    }))
}))

vi.mock('../../hooks/use-transcript-adapter', () => ({
    useTranscript: vi.fn(() => ({
        isConnected: false,
        error: null,
        autoScrollEnabled: true,
        disconnect: vi.fn(),
        clearTranscripts: vi.fn(),
        enableAutoScroll: vi.fn(),
        disableAutoScroll: vi.fn(),
        scrollToLatest: vi.fn(),
    }))
}))

vi.mock('@/components/ui/use-toast', () => ({
    useToast: vi.fn(() => ({
        toast: vi.fn(),
    }))
}))

// æ¸¬è©¦çµ„ä»¶
function TestComponent() {
    const { appData, isLoading, error } = useAppState()

    return createElement('div', { 'data-testid': 'test-component' }, [
        createElement('div', { 'data-testid': 'app-state', key: 'state' }, appData.state),
        createElement('div', { 'data-testid': 'is-recording', key: 'recording' }, String(appData.isRecording)),
        createElement('div', { 'data-testid': 'is-loading', key: 'loading' }, String(isLoading)),
        createElement('div', { 'data-testid': 'error', key: 'error' }, error || 'null'),
    ])
}

describe('AppStateProvider æ•´åˆæ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        // é‡ç½®åŠŸèƒ½é–‹é—œ
        featureFlagManager.reset()
        // æ¸…é™¤ localStorage
        localStorage.clear()
    })

    test('åœ¨åŠŸèƒ½é–‹é—œé—œé–‰æ™‚æ‡‰è©²ä½¿ç”¨èˆŠç³»çµ±', () => {
        // ç¢ºä¿åŠŸèƒ½é–‹é—œé—œé–‰
        featureFlagManager.disable('useNewStateManagement')
        featureFlagManager.disable('useNewAppStateHook')

        render(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥çµ„ä»¶æ˜¯å¦æ­£å¸¸æ¸²æŸ“
        expect(screen.getByTestId('test-component')).toBeInTheDocument()
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')
        expect(screen.getByTestId('is-recording')).toHaveTextContent('false')
        // æ³¨æ„ï¼šèˆŠç³»çµ±åœ¨åˆå§‹åŒ–æ™‚å¯èƒ½æœƒæœ‰ loading ç‹€æ…‹ï¼Œé€™æ˜¯æ­£å¸¸çš„
        expect(screen.getByTestId('is-loading')).toBeInTheDocument()
        expect(screen.getByTestId('error')).toHaveTextContent('null')
    })

    test('åœ¨å•Ÿç”¨ useNewStateManagement æ™‚æ‡‰è©²ä½¿ç”¨æ–°ç³»çµ±', () => {
        // å•Ÿç”¨æ–°ç‹€æ…‹ç®¡ç†
        featureFlagManager.enable('useNewStateManagement')

        render(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥çµ„ä»¶æ˜¯å¦æ­£å¸¸æ¸²æŸ“
        expect(screen.getByTestId('test-component')).toBeInTheDocument()
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')
        expect(screen.getByTestId('is-recording')).toHaveTextContent('false')
        expect(screen.getByTestId('is-loading')).toHaveTextContent('false')
        expect(screen.getByTestId('error')).toHaveTextContent('null')
    })

    test('åœ¨å•Ÿç”¨ useNewAppStateHook æ™‚æ‡‰è©²ä½¿ç”¨æ–°ç³»çµ±', () => {
        // å•Ÿç”¨æ–° AppState Hook
        featureFlagManager.enable('useNewAppStateHook')

        render(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥çµ„ä»¶æ˜¯å¦æ­£å¸¸æ¸²æŸ“
        expect(screen.getByTestId('test-component')).toBeInTheDocument()
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')
        expect(screen.getByTestId('is-recording')).toHaveTextContent('false')
        expect(screen.getByTestId('is-loading')).toHaveTextContent('false')
        expect(screen.getByTestId('error')).toHaveTextContent('null')
    })

    test('Provider æ‡‰è©²èƒ½å¤ åŒ…è£å¤šå€‹å­çµ„ä»¶', () => {
        featureFlagManager.enable('useNewStateManagement')

        function MultipleChildrenTest() {
            return createElement('div', null, [
                createElement(TestComponent, { key: 'child1' }),
                createElement(TestComponent, { key: 'child2' }),
            ])
        }

        render(
            createElement(AppStateProviderWrapper, null,
                createElement(MultipleChildrenTest)
            )
        )

        // æª¢æŸ¥æ‰€æœ‰å­çµ„ä»¶éƒ½èƒ½æ­£å¸¸å­˜å–ç‹€æ…‹
        const components = screen.getAllByTestId('test-component')
        expect(components).toHaveLength(2)

        components.forEach(component => {
            expect(component).toBeInTheDocument()
        })
    })

    test('åŠŸèƒ½é–‹é—œåˆ‡æ›æ‡‰è©²ä¸æœƒå½±éŸ¿çµ„ä»¶æ¸²æŸ“', () => {
        // é–‹å§‹æ™‚é—œé–‰åŠŸèƒ½é–‹é—œ
        featureFlagManager.disable('useNewStateManagement')
        featureFlagManager.disable('useNewAppStateHook')

        const { rerender } = render(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥åˆå§‹ç‹€æ…‹
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')

        // å•Ÿç”¨åŠŸèƒ½é–‹é—œä¸¦é‡æ–°æ¸²æŸ“
        act(() => {
            featureFlagManager.enable('useNewStateManagement')
        })

        rerender(
            createElement(AppStateProviderWrapper, null,
                createElement(TestComponent)
            )
        )

        // æª¢æŸ¥ç‹€æ…‹ä»ç„¶æ­£å¸¸
        expect(screen.getByTestId('app-state')).toHaveTextContent('default')
        expect(screen.getByTestId('is-recording')).toHaveTextContent('false')
    })
})


# END FILE CONTENTS


# File: frontend/components/ui/toaster.tsx

"use client"

import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/recording-service.test.ts

"use client"

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { RecordingService } from '../recording-service'
import { AudioRecorder } from '../../audio-recorder'
import { AudioUploadWebSocket } from '../../websocket'

// Mock AudioRecorder
vi.mock('../../audio-recorder', () => ({
    AudioRecorder: vi.fn().mockImplementation(() => ({
        initialize: vi.fn(),
        startRecording: vi.fn(),
        stopRecording: vi.fn(),
        onChunk: vi.fn(),
        onError: vi.fn(),
    }))
}))

// Mock AudioUploadWebSocket
vi.mock('../../websocket', () => ({
    AudioUploadWebSocket: vi.fn().mockImplementation(() => ({
        connect: vi.fn(),
        disconnect: vi.fn(),
        uploadAudioChunk: vi.fn(),
        onAckMissing: vi.fn(),
        isConnected: false,
        send: vi.fn(),
    }))
}))

// Mock transcriptManager
const mockTranscriptManager = {
    connect: vi.fn(),
    disconnect: vi.fn(),
    addListener: vi.fn(),
    removeListener: vi.fn(),
    isConnected: vi.fn(),
}

vi.mock('../../transcript-manager', () => ({
    transcriptManager: mockTranscriptManager
}))

describe('RecordingService', () => {
    let recordingService: RecordingService
    let mockAudioRecorder: any
    let mockWebSocket: any

    beforeEach(() => {
        recordingService = new RecordingService()
        mockAudioRecorder = new AudioRecorder({})
        mockWebSocket = new AudioUploadWebSocket('')
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('æœå‹™åˆå§‹åŒ–', () => {
        it('æ‡‰è©²æ­£ç¢ºåˆå§‹åŒ– RecordingService', () => {
            expect(recordingService).toBeDefined()
            expect(recordingService['serviceName']).toBe('RecordingService')
        })

        it('æ‡‰è©²æ­£ç¢ºå•Ÿå‹•å’Œåœæ­¢æœå‹™', async () => {
            await recordingService.start()
            expect(recordingService['isRunning']).toBe(true)

            await recordingService.stop()
            expect(recordingService['isRunning']).toBe(false)
        })

        it('æ‡‰è©²è¿”å›åˆå§‹éŒ„éŸ³ç‹€æ…‹', () => {
            const state = recordingService.getRecordingState()

            expect(state).toEqual({
                isRecording: false,
                recordingTime: 0,
                currentSessionId: null,
                error: null
            })
        })
    })

    describe('startRecording', () => {
        const sessionId = 'test-session-id'

        beforeEach(() => {
            // Mock browser environment
            Object.defineProperty(global, 'window', {
                value: {
                    addEventListener: vi.fn(),
                    removeEventListener: vi.fn(),
                },
                writable: true
            })
        })

        it('æ‡‰è©²æˆåŠŸé–‹å§‹éŒ„éŸ³', async () => {
            // Setup mocks
            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording(sessionId)

            // Verify AudioRecorder was initialized and started
            expect(AudioRecorder).toHaveBeenCalled()
            expect(mockAudioRecorder.initialize).toHaveBeenCalled()
            expect(mockAudioRecorder.startRecording).toHaveBeenCalled()

            // Verify WebSocket was connected
            expect(AudioUploadWebSocket).toHaveBeenCalledWith(sessionId)
            expect(mockWebSocket.connect).toHaveBeenCalled()

            // Verify transcript manager was connected
            expect(mockTranscriptManager.connect).toHaveBeenCalledWith(sessionId)

            // Verify recording state
            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(true)
            expect(state.currentSessionId).toBe(sessionId)
        })

        it('æ‡‰è©²è™•ç†éŸ³é »åˆå§‹åŒ–å¤±æ•—', async () => {
            const initError = new Error('Microphone permission denied')
            mockAudioRecorder.initialize.mockRejectedValue(initError)

            await expect(recordingService.startRecording(sessionId))
                .rejects.toThrow('Microphone permission denied')

            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
            expect(state.error).toBe('Microphone permission denied')
        })

        it('æ‡‰è©²è™•ç† WebSocket é€£æ¥å¤±æ•—', async () => {
            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockWebSocket.connect.mockRejectedValue(new Error('WebSocket connection failed'))

            await expect(recordingService.startRecording(sessionId))
                .rejects.toThrow('WebSocket connection failed')
        })

        it('æ‡‰è©²è™•ç† TranscriptManager é€£æ¥å¤±æ•—', async () => {
            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockRejectedValue(new Error('Transcript connection failed'))

            await expect(recordingService.startRecording(sessionId))
                .rejects.toThrow('Transcript connection failed')
        })

        it('æ‡‰è©²åœ¨ç€è¦½å™¨ç’°å¢ƒæª¢æŸ¥å¤±æ•—æ™‚æ‹‹å‡ºéŒ¯èª¤', async () => {
            // Remove window object to simulate non-browser environment
            delete (global as any).window

            await expect(recordingService.startRecording(sessionId))
                .rejects.toThrow('æ­¤åŠŸèƒ½åƒ…åœ¨ç€è¦½å™¨ç’°å¢ƒä¸­å¯ç”¨')
        })

        it('æ‡‰è©²è™•ç†é‡è¤‡é–‹å§‹éŒ„éŸ³è«‹æ±‚', async () => {
            // Setup successful first recording
            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording(sessionId)

            // Try to start recording again
            await expect(recordingService.startRecording('another-session'))
                .rejects.toThrow('éŒ„éŸ³å·²åœ¨é€²è¡Œä¸­')
        })
    })

    describe('stopRecording', () => {
        beforeEach(async () => {
            // Setup recording state
            Object.defineProperty(global, 'window', {
                value: {
                    addEventListener: vi.fn(),
                    removeEventListener: vi.fn(),
                },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')
        })

        it('æ‡‰è©²æˆåŠŸåœæ­¢éŒ„éŸ³', async () => {
            await recordingService.stopRecording()

            // Verify audio recorder was stopped
            expect(mockAudioRecorder.stopRecording).toHaveBeenCalled()

            // Verify WebSocket was disconnected
            expect(mockWebSocket.disconnect).toHaveBeenCalled()

            // Verify recording state
            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
            expect(state.currentSessionId).toBeNull()
        })

        it('æ‡‰è©²è™•ç†åœæ­¢éŒ„éŸ³éŒ¯èª¤', async () => {
            mockAudioRecorder.stopRecording.mockImplementation(() => {
                throw new Error('Stop recording failed')
            })

            await expect(recordingService.stopRecording())
                .rejects.toThrow('Stop recording failed')
        })

        it('æ‡‰è©²åœ¨æ²’æœ‰éŒ„éŸ³æ™‚æ­£å¸¸è™•ç†åœæ­¢è«‹æ±‚', async () => {
            // Stop recording first
            await recordingService.stopRecording()

            // Try to stop again
            await expect(recordingService.stopRecording()).resolves.not.toThrow()
        })
    })

    describe('éŒ„éŸ³ç‹€æ…‹ç®¡ç†', () => {
        it('æ‡‰è©²æ­£ç¢ºè¿½è¹¤éŒ„éŸ³æ™‚é–“', async () => {
            // Mock timer
            vi.useFakeTimers()

            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')

            // Advance timer by 5 seconds
            vi.advanceTimersByTime(5000)

            const state = recordingService.getRecordingState()
            expect(state.recordingTime).toBe(5)

            vi.useRealTimers()
        })

        it('æ‡‰è©²æ­£ç¢ºå ±å‘ŠéŒ„éŸ³ç‹€æ…‹', async () => {
            expect(recordingService.isRecording()).toBe(false)

            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')
            expect(recordingService.isRecording()).toBe(true)

            await recordingService.stopRecording()
            expect(recordingService.isRecording()).toBe(false)
        })

        it('æ‡‰è©²æ­£ç¢ºå ±å‘ŠéŒ„éŸ³æ™‚é–“', () => {
            expect(recordingService.getRecordingTime()).toBe(0)
        })
    })

    describe('éŸ³é »åˆ‡ç‰‡è™•ç†', () => {
        it('æ‡‰è©²è™•ç†éŸ³é »åˆ‡ç‰‡ä¸Šå‚³', () => {
            const mockChunk = {
                sequence: 1,
                blob: new Blob(['test audio data'], { type: 'audio/webm' })
            }

            // Simulate chunk received
            const chunkHandler = mockAudioRecorder.onChunk.mock.calls[0]?.[0]
            if (chunkHandler) {
                chunkHandler(mockChunk)
            }

            // Verify WebSocket upload was called
            expect(mockWebSocket.uploadAudioChunk).toHaveBeenCalledWith(mockChunk.blob)
        })

        it('æ‡‰è©²è™•ç† ACK/Missing é‡å‚³æ©Ÿåˆ¶', () => {
            const ackMissingData = {
                acknowledged: [1, 2],
                missing: [3, 4]
            }

            // Simulate ACK/Missing message
            const ackHandler = mockWebSocket.onAckMissing.mock.calls[0]?.[0]
            if (ackHandler) {
                ackHandler(ackMissingData)
            }

            // Verify retry logic would be triggered for missing chunks
            expect(ackMissingData.missing).toEqual([3, 4])
        })
    })

    describe('éŒ¯èª¤è™•ç†', () => {
        it('æ‡‰è©²è™•ç†éŸ³é »éŒ„è£½å™¨éŒ¯èª¤', async () => {
            const audioError = new Error('Audio recording error')

            // Simulate audio recorder error
            const errorHandler = mockAudioRecorder.onError.mock.calls[0]?.[0]
            if (errorHandler) {
                errorHandler(audioError)
            }

            const state = recordingService.getRecordingState()
            expect(state.error).toBe('Audio recording error')
        })

        it('æ‡‰è©²æ¸…é™¤éŒ¯èª¤ç‹€æ…‹', () => {
            // Set error state
            recordingService['recordingState'].error = 'Test error'

            // Clear error (this would be called internally)
            recordingService['recordingState'].error = null

            const state = recordingService.getRecordingState()
            expect(state.error).toBeNull()
        })
    })

    describe('è³‡æºæ¸…ç†', () => {
        it('æ‡‰è©²åœ¨éŒ¯èª¤æ™‚æ¸…ç†è³‡æº', async () => {
            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockRejectedValue(new Error('Start failed'))

            await expect(recordingService.startRecording('test-session'))
                .rejects.toThrow('Start failed')

            // Verify cleanup was performed
            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
            expect(state.currentSessionId).toBeNull()
        })

        it('æ‡‰è©²åœ¨æœå‹™åœæ­¢æ™‚æ¸…ç†æ‰€æœ‰è³‡æº', async () => {
            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')
            await recordingService.stop()

            // Verify all resources are cleaned up
            expect(mockAudioRecorder.stopRecording).toHaveBeenCalled()
            expect(mockWebSocket.disconnect).toHaveBeenCalled()

            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
        })
    })

    describe('ä¸¦ç™¼å’Œç«¶çˆ­æ¢ä»¶', () => {
        it('æ‡‰è©²é˜²æ­¢ä¸¦ç™¼éŒ„éŸ³æ“ä½œ', async () => {
            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            // Start first recording
            const promise1 = recordingService.startRecording('session-1')

            // Try to start second recording immediately
            const promise2 = recordingService.startRecording('session-2')

            const results = await Promise.allSettled([promise1, promise2])

            // One should succeed, one should fail
            expect(results.filter(r => r.status === 'fulfilled')).toHaveLength(1)
            expect(results.filter(r => r.status === 'rejected')).toHaveLength(1)
        })

        it('æ‡‰è©²è™•ç†å¿«é€Ÿçš„é–‹å§‹-åœæ­¢æ“ä½œ', async () => {
            Object.defineProperty(global, 'window', {
                value: { addEventListener: vi.fn(), removeEventListener: vi.fn() },
                writable: true
            })

            mockAudioRecorder.initialize.mockResolvedValue(undefined)
            mockAudioRecorder.startRecording.mockResolvedValue(undefined)
            mockWebSocket.connect.mockResolvedValue(undefined)
            mockWebSocket.isConnected = true
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.isConnected.mockReturnValue(true)

            await recordingService.startRecording('test-session')
            await recordingService.stopRecording()

            const state = recordingService.getRecordingState()
            expect(state.isRecording).toBe(false)
        })
    })

    describe('æœå‹™ç‹€æ…‹å ±å‘Š', () => {
        it('æ‡‰è©²å ±å‘Šæ­£ç¢ºçš„æœå‹™è³‡è¨Š', async () => {
            const status = await recordingService.getDetailedStatus()

            expect(status).toMatchObject({
                serviceName: 'RecordingService',
                isInitialized: expect.any(Boolean),
                isRunning: expect.any(Boolean),
                recordingState: expect.any(Object),
                audioSupport: expect.any(Object),
                webSocketConnected: expect.any(Boolean)
            })
        })
    })
})


# END FILE CONTENTS


# File: frontend/types/state-transitions.ts

import { AppState, SessionStatus, SessionType } from "./app-state"

// ç‹€æ…‹è½‰æ›è§¸ç™¼å™¨é¡å‹
export type StateTransitionTrigger =
  | "USER_START_RECORDING"          // ç”¨æˆ¶é–‹å§‹éŒ„éŸ³
  | "USER_STOP_RECORDING"           // ç”¨æˆ¶åœæ­¢éŒ„éŸ³
  | "FIRST_TRANSCRIPT_RECEIVED"     // æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿
  | "SESSION_CREATED"               // Session å»ºç«‹å®Œæˆ
  | "SESSION_UPGRADED"              // Session å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼
  | "PROCESSING_STARTED"            // é–‹å§‹è™•ç†å‰©é¤˜é€å­—ç¨¿
  | "PROCESSING_COMPLETED"          // è™•ç†å®Œæˆ
  | "ERROR_OCCURRED"                // ç™¼ç”ŸéŒ¯èª¤
  | "USER_NEW_NOTE"                 // ç”¨æˆ¶é–‹æ–°ç­†è¨˜
  | "TRANSCRIPT_COMPLETED"          // è½‰éŒ„å®Œå…¨å®Œæˆ

// ç‹€æ…‹è½‰æ›æ¢ä»¶
export interface StateTransitionCondition {
  currentState: AppState
  targetState: AppState
  trigger: StateTransitionTrigger

  // é¡å¤–æ¢ä»¶æª¢æŸ¥
  sessionExists?: boolean
  sessionStatus?: SessionStatus
  sessionType?: SessionType
  isRecording?: boolean
  hasTranscripts?: boolean

  // è‡ªå®šç¾©é©—è­‰å‡½æ•¸
  customValidator?: (context: StateTransitionContext) => boolean
}

// ç‹€æ…‹è½‰æ›ä¸Šä¸‹æ–‡
export interface StateTransitionContext {
  currentState: AppState
  isRecording: boolean
  transcriptCount: number
  session: {
    id: string
    status: SessionStatus
    type: SessionType
  } | null
  error: string | null
  pendingSessionTitle?: string  // å¾…å»ºç«‹æœƒè©±çš„æ¨™é¡Œ
}

// ç‹€æ…‹è½‰æ›çµæœ
export interface StateTransitionResult {
  success: boolean
  newState: AppState
  error?: string
  sideEffects?: StateTransitionSideEffect[]
}

// å‰¯ä½œç”¨é¡å‹
export type StateTransitionSideEffect =
  | { type: "CREATE_SESSION"; sessionType: SessionType; title?: string }
  | { type: "UPGRADE_SESSION" }
  | { type: "FINISH_SESSION" }
  | { type: "START_RECORDING" }
  | { type: "STOP_RECORDING" }
  | { type: "CONNECT_WEBSOCKET" }
  | { type: "DISCONNECT_WEBSOCKET" }
  | { type: "CLEAR_TRANSCRIPTS" }
  | { type: "SAVE_DRAFT" }
  | { type: "SHOW_ERROR"; message: string }

// ç‹€æ…‹è½‰æ›è¦å‰‡å®šç¾©
export const STATE_TRANSITION_RULES: StateTransitionCondition[] = [
  // å¾ default ç‹€æ…‹é–‹å§‹éŒ„éŸ³
  {
    currentState: "default",
    targetState: "recording_waiting",
    trigger: "USER_START_RECORDING",
    customValidator: (context) => {
      // ç¢ºä¿æ²’æœ‰å…¶ä»–æ´»èºçš„éŒ„éŸ³ session
      return !context.session || context.session.status === "completed" || context.session.status === "error"
    }
  },

  // å¾ recording_waiting é‡æ–°é–‹å§‹éŒ„éŸ³ï¼ˆè™•ç†é‡è©¦æƒ…æ³ï¼‰
  {
    currentState: "recording_waiting",
    targetState: "recording_waiting",
    trigger: "USER_START_RECORDING",
    customValidator: (context) => {
      // å…è¨±åœ¨æ²’æœ‰ session æˆ– session ç‹€æ…‹ç•°å¸¸æ™‚é‡æ–°é–‹å§‹
      return !context.session || context.session.status === "completed" || context.session.status === "error"
    }
  },

  // Session å»ºç«‹å®Œæˆå¾Œä¿æŒåœ¨ default ç‹€æ…‹
  {
    currentState: "default",
    targetState: "default",
    trigger: "SESSION_CREATED",
    sessionExists: true,
    sessionStatus: "draft"
  },

  // ä¿®å¾©ï¼šå¾ recording_waiting ç‹€æ…‹è™•ç† SESSION_CREATEDï¼Œä¿æŒåœ¨ recording_waiting ç­‰å¾… WebSocket é€£æ¥
  {
    currentState: "recording_waiting",
    targetState: "recording_waiting",
    trigger: "SESSION_CREATED",
    sessionExists: true,
    sessionStatus: "active",
    sessionType: "recording"
  },

  // å¾ recording_waiting æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿è½‰ç‚º recording_active
  {
    currentState: "recording_waiting",
    targetState: "recording_active",
    trigger: "FIRST_TRANSCRIPT_RECEIVED",
    sessionExists: true,
    sessionStatus: "active",
    sessionType: "recording",
    isRecording: true,
    hasTranscripts: true
  },

  // å¾ recording_waiting æˆ– recording_active åœæ­¢éŒ„éŸ³è½‰ç‚º processing
  {
    currentState: "recording_waiting",
    targetState: "processing",
    trigger: "USER_STOP_RECORDING",
    sessionExists: true,
    sessionType: "recording"
  },
  {
    currentState: "recording_active",
    targetState: "processing",
    trigger: "USER_STOP_RECORDING",
    sessionExists: true,
    sessionType: "recording"
  },

  // å¾ processing å®Œæˆè½‰éŒ„è½‰ç‚º finished
  {
    currentState: "processing",
    targetState: "finished",
    trigger: "PROCESSING_COMPLETED",
    sessionExists: true,
    sessionStatus: "completed"
  },

  // ä¿®å¾©ï¼šå¾ä»»ä½•ç‹€æ…‹ç™¼ç”ŸéŒ¯èª¤å›åˆ° default
  {
    currentState: "recording_waiting",
    targetState: "default",
    trigger: "ERROR_OCCURRED"
  },
  {
    currentState: "recording_active",
    targetState: "default",
    trigger: "ERROR_OCCURRED"
  },
  {
    currentState: "processing",
    targetState: "default",
    trigger: "ERROR_OCCURRED"
  },

  // å¾ finished æˆ–ä»»ä½•ç‹€æ…‹é–‹æ–°ç­†è¨˜å›åˆ° default
  {
    currentState: "finished",
    targetState: "default",
    trigger: "USER_NEW_NOTE"
  },
  {
    currentState: "recording_waiting",
    targetState: "default",
    trigger: "USER_NEW_NOTE"
  },
  {
    currentState: "recording_active",
    targetState: "default",
    trigger: "USER_NEW_NOTE"
  }
]

// ç‹€æ…‹è½‰æ›å‰¯ä½œç”¨æ˜ å°„
export const STATE_TRANSITION_SIDE_EFFECTS: Record<string, StateTransitionSideEffect[]> = {
  // default -> recording_waiting: å»ºç«‹æœƒè©±ã€é–‹å§‹éŒ„éŸ³ä¸¦é€£æ¥ WebSocket
  "default->recording_waiting->USER_START_RECORDING": [
    { type: "CREATE_SESSION", sessionType: "recording" },
    { type: "START_RECORDING" },
    { type: "CONNECT_WEBSOCKET" }
  ],

  // recording_waiting -> recording_waiting: é‡æ–°é–‹å§‹éŒ„éŸ³ï¼ˆé‡è©¦æƒ…æ³ï¼‰
  "recording_waiting->recording_waiting->USER_START_RECORDING": [
    { type: "CREATE_SESSION", sessionType: "recording" },
    { type: "START_RECORDING" },
    { type: "CONNECT_WEBSOCKET" }
  ],

  // recording_waiting/recording_active -> processing: åœæ­¢éŒ„éŸ³
  "recording_waiting->processing->USER_STOP_RECORDING": [
    { type: "STOP_RECORDING" }
  ],
  "recording_active->processing->USER_STOP_RECORDING": [
    { type: "STOP_RECORDING" }
  ],

  // processing -> finished: å®Œæˆ session
  "processing->finished->PROCESSING_COMPLETED": [
    { type: "FINISH_SESSION" }
  ],

  // ä»»ä½•ç‹€æ…‹ -> default (æ–°ç­†è¨˜): æ¸…ç†ç‹€æ…‹
  "finished->default->USER_NEW_NOTE": [
    { type: "CLEAR_TRANSCRIPTS" },
    { type: "SAVE_DRAFT" }
  ],
  "recording_waiting->default->USER_NEW_NOTE": [
    { type: "STOP_RECORDING" },
    { type: "DISCONNECT_WEBSOCKET" },
    { type: "CLEAR_TRANSCRIPTS" }
  ],
  "recording_active->default->USER_NEW_NOTE": [
    { type: "STOP_RECORDING" },
    { type: "DISCONNECT_WEBSOCKET" },
    { type: "CLEAR_TRANSCRIPTS" }
  ],

  // éŒ¯èª¤è™•ç†
  "recording_waiting->default->ERROR_OCCURRED": [
    { type: "STOP_RECORDING" },
    { type: "DISCONNECT_WEBSOCKET" },
    { type: "SHOW_ERROR", message: "éŒ„éŸ³éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤" }
  ],
  "recording_active->default->ERROR_OCCURRED": [
    { type: "STOP_RECORDING" },
    { type: "DISCONNECT_WEBSOCKET" },
    { type: "SHOW_ERROR", message: "éŒ„éŸ³éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤" }
  ],
  "processing->default->ERROR_OCCURRED": [
    { type: "SHOW_ERROR", message: "è™•ç†è½‰éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤" }
  ]
}


# END FILE CONTENTS


# File: frontend/.eslintrc.json

{
  "extends": [
    "next/core-web-vitals",
    "next/typescript"
  ]
}


# END FILE CONTENTS


# File: frontend/components/ui/scroll-area.tsx

"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }


# END FILE CONTENTS


# File: docs/lang-map-refactor.md

# Lang-map Refactor è¦æ ¼èˆ‡è¨­è¨ˆ

## ç›®æ¨™
1. å‰ç«¯ä¸‹æ‹‰å¯é¸ Provider (whisper / gpt4o) èˆ‡èªè¨€ (zh-TW / en-US â€¦)
2. å¾Œç«¯ `sessions.lang_code` æ°¸é å­˜ BCP-47ï¼ˆzh-TWã€en-USâ€¦ï¼‰
3. å„ Provider åœ¨å‘¼å«å¤–éƒ¨ API å‰ï¼Œè‡ªè¡ŒæŠŠ lang_code è½‰æˆè©² API æ”¯æ´æ ¼å¼
   - Whisper    : zh â†’ zh, en â†’ en  (ISO-639-1, å°å¯«)
   - GPT-4o-STT : zh â†’ zh, en â†’ en  (å¯å‚³ auto)
4. å…¶ä»–ç¨‹å¼ç¢¼ä¸å† hard-code èªè¨€ç¢¼

## ä¸»è¦æª”æ¡ˆ/è·¯å¾‘
- backend
  - app/services/stt/interfaces.py
  - app/services/stt/lang_map.py
  - app/services/stt/whisper_provider.py
  - app/services/stt/gpt4o_provider.py
  - app/services/stt/factory.py
  - app/api/segments.py
  - migrations/20250713_add_enum_lang.sql
- frontend
  - frontend/constants/languages.ts
  - frontend/constants/providers.ts
  - frontend/hooks/useSession.ts

## è¨­è¨ˆé‡é»
- èªè¨€ç¢¼è½‰æ›é›†ä¸­æ–¼ lang_map.pyï¼ŒProvider ç«¯è‡ªå‹•è½‰æ›
- session.lang_code æ°¸é å­˜ BCP-47
- å‰ç«¯/å¾Œç«¯çš†ç§»é™¤ hard-codeï¼Œçµ±ä¸€ import å¸¸æ•¸
- SQL migration è£œ enum type æ”¯æ´ zh/en

## TDD/Tidy First æµç¨‹
- å…ˆå¯«æ¸¬è©¦èˆ‡å‹åˆ¥ï¼Œé€æ­¥é‡æ§‹ provider/factory
- æ¯æ­¥é©Ÿ commit åˆ†æ˜ï¼Œçµæ§‹èˆ‡è¡Œç‚ºåˆ†é›¢
- æ–‡ä»¶åŒæ­¥æ›´æ–°

## æ¸¬è©¦
- lang_map.py å–®å…ƒæ¸¬è©¦
- provider/factory æµç¨‹æ•´åˆæ¸¬è©¦
- å‰ç«¯ä¸‹æ‹‰é¸å–®èˆ‡ session å»ºç«‹æµç¨‹æ¸¬è©¦

## åŸ·è¡Œæ­¥é©Ÿ
1. åŸ·è¡Œ SQL migration
2. .env WHISPER_LANGUAGE å¯ä¿ç•™ zh-TWï¼ˆä¸å½±éŸ¿ï¼‰
3. npm run dev + uv pip run main.py
4. å‰ç«¯é¸ provider + èªè¨€ï¼Œä¸Šå‚³å¾Œæ‡‰ï¼š
   - Whisper â†’ 200 OKï¼Œèªè¨€æ¬„å­˜ zh-TW
   - GPT-4o â†’ TODO NotImplementedï¼ˆå…ˆå› 501ï¼‰ 


# END FILE CONTENTS


# File: frontend/components/ui/toggle-group.tsx

"use client"

import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }


# END FILE CONTENTS


# File: frontend/components/ui/radio-group.tsx

"use client"

import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }


# END FILE CONTENTS


# File: app/core/__init__.py



# END FILE CONTENTS


# File: frontend/components/ui/navigation-menu.tsx

import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}


# END FILE CONTENTS


# File: frontend/components/ui/textarea.tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<"textarea">
>(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Textarea.displayName = "Textarea"

export { Textarea }


# END FILE CONTENTS


# File: app/core/audio_vad.py

import asyncio, shlex, re
from app.core.config import get_settings

async def is_silent(wav: bytes) -> bool:
    """
    è‹¥æ•´æ®µéŸ³è¨Šéƒ½åœ¨éœéŸ³é–€æª»ä»¥ä¸‹ï¼Œå› True
    """
    s = get_settings()
    noise_db = s.SILENCE_NOISE_DB
    duration = s.SILENCE_DURATION_SEC
    cmd = (
        f"ffmpeg -v info -i pipe:0 "
        f"-af silencedetect=noise={noise_db}dB:d={duration} "
        f"-f null -"
    )
    proc = await asyncio.create_subprocess_exec(
        *shlex.split(cmd),
        stdin=asyncio.subprocess.PIPE,
        stderr=asyncio.subprocess.PIPE,
        stdout=asyncio.subprocess.PIPE,
    )
    _, err = await proc.communicate(wav)
    log = err.decode()

    # FFmpeg åªåœ¨åµæ¸¬åˆ°éŸ³è¨Šæ™‚å°å‡º "silence_end"
    return "silence_end" not in log


# END FILE CONTENTS


# File: frontend/lib/typed-emitter.ts

/* ============================================================
 * è¼•é‡å‹åˆ¥å®‰å…¨ EventEmitterï¼ˆç„¡ Node polyfillï¼‰
 * ============================================================
 */
export type Listener<T> = (payload: T) => void

export class TypedEmitter<Events extends Record<string, any>> {
  private listeners: {
    [K in keyof Events]?: Set<Listener<Events[K]>>
  } = {}

  on<K extends keyof Events>(event: K, listener: Listener<Events[K]>): this {
    (this.listeners[event] ??= new Set()).add(listener)
    return this
  }

  off<K extends keyof Events>(event: K, listener: Listener<Events[K]>): this {
    this.listeners[event]?.delete(listener)
    return this
  }

  emit<K extends keyof Events>(event: K, payload: Events[K]): boolean {
    this.listeners[event]?.forEach((l) => l(payload))
    return !!this.listeners[event]?.size
  }

  removeAllListeners<K extends keyof Events>(event?: K): this {
    if (event) this.listeners[event]?.clear()
    else Object.values(this.listeners).forEach((s) => s?.clear())
    return this
  }
}

# END FILE CONTENTS


# File: docs/webm-to-wav-gpt4o.md

# WebM â†’ WAV + GPT4oProvider ä¸Šå‚³è¦æ ¼

## ç›®æ¨™
- å°‡ 16-bit mono 16kHz WebM éŸ³è¨Šè½‰æª”ç‚º RIFF-WAV
- ç”± GPT4oProvider ä¸Šå‚³ wav bytes çµ¦ OpenAI APIï¼ˆgpt-4o-transcribeï¼‰
- æ”¯æ´ R2 å¿«å–

## è½‰æª”æµç¨‹
1. å‘¼å« `webm_to_wav(webm: bytes) -> bytes`ï¼š
   - ä½¿ç”¨ ffmpeg è½‰ webm â†’ 16-bit mono 16kHz RIFF-WAV
   - å¤±æ•—æ™‚å›å‚³ None
2. GPT4oProvider:
   - å…ˆæª¢æŸ¥æ ¼å¼ï¼Œåƒ…æ”¯æ´ webm/wav
   - å‘¼å« webm_to_wav å–å¾— wav bytes
   - å¤±æ•—æ™‚ log error ä¸¦ return None
   - æˆåŠŸæ™‚å¯é¸æ“‡æ€§å¿«å–åˆ° R2ï¼ˆput_object, content_type='audio/wav'ï¼‰
   - ä¸Šå‚³æ ¼å¼ï¼š
     ```python
     file_tuple = ("audio.wav", BytesIO(wav_bytes), "audio/wav")
     response = await client.audio.transcriptions.create(
         model=model_name,
         file=file_tuple,
         language="zh-TW",
         response_format="json",
     )
     ```
   - å›å‚³ response['text']

## æ¸¬è©¦é‡é»
- webm_to_wav æœƒæ­£ç¢ºç”¢ç”Ÿ RIFF headerã€16kHzã€monoã€16-bit
- å¤±æ•—æ™‚å›å‚³ None
- GPT4oProvider æœƒå‘¼å« webm_to_wavï¼Œä¸¦æ­£ç¢ºå‚³é€ (filename, BytesIO, mime)
- R2 cache è¡Œç‚ºæ­£ç¢º
- å¤±æ•—æ™‚ log error ä¸¦ return None

## å¯¦ä½œç¾æ³
- `webm_to_wav(webm: bytes) -> Optional[bytes]` å·²å¯¦ä½œæ–¼ `app/core/ffmpeg.py`
- å¤±æ•—æ™‚å›å‚³ None ä¸¦ log error
- å–®å…ƒæ¸¬è©¦å·²è¦†è“‹æˆåŠŸèˆ‡å¤±æ•—æƒ…å¢ƒï¼Œæ¸¬è©¦æª”æ¡ˆï¼š`tests/unit/test_ffmpeg.py`ï¼Œclass: `TestWebMToWav`

## è½‰éŒ„æ¬„ä½å®Œæ•´æ€§è¦æ ¼ï¼ˆ2024-06ï¼‰

### 1. gpt4o_provider.py transcribe() å›å‚³æ ¼å¼
- å¿…é ˆå›å‚³ dictï¼Œä¸”æ¬„ä½é½Šå…¨ï¼š
  - text
  - chunk_sequence
  - timestamp
  - language
  - start_offset
  - end_offset

### 2. SimpleAudioTranscriptionService._save_and_push_result æ¬„ä½æª¢æŸ¥
- å¿…è¦æ¬„ä½ï¼š{"text","chunk_sequence","timestamp","start_offset","end_offset"}
- è‹¥ç¼ºæ¬„ä½ï¼šlog error ä¸¦ returnï¼Œä¸å¯«å…¥ DBã€ä¸æ¨é€ WebSocket
- æ¸¬è©¦è¦†è“‹ï¼špytest é©—è­‰ç¼ºæ¬„ä½æ™‚åª log errorï¼Œä¸æ‹‹ä¾‹å¤–

## ç›¸é—œæª”æ¡ˆ
- app/core/ffmpeg.py
- app/services/stt/gpt4o_provider.py
- tests/unit/test_ffmpeg.py
- tests/test_stt_providers.py 


# END FILE CONTENTS


# File: PRD.md

# StudyScriber PRD

---

## 1. å°ˆæ¡ˆé¡˜æ™¯

æä¾›ã€Œé‚ŠéŒ„é‚Šè½‰éŒ„ã€çš„é›²ç«¯ç­†è¨˜ï¼Œè®“å…§éƒ¨è¨“ç·´ã€è¬›åº§ç­†è¨˜ä¸€æ¬¡åˆ°ä½ï¼šå¯é¸éŒ„éŸ³ã€å³æ™‚é€å­—ç¨¿ã€Markdown ç­†è¨˜èˆ‡åŒ¯å‡ºï¼Œä¸€æ¢é¾å®Œæˆã€‚

---

## 2. ç”¢å“å®šä½

| é …ç›®     | æè¿°                                                               |
| -------- | ------------------------------------------------------------------ |
| ç›®æ¨™æ—ç¾¤ | æˆå¹´è‡ªå­¸è€…                                                         |
| ç—›é»     | å‚™èª²ï¼è½èª²åŒæ™‚è¦åšç­†è¨˜ã€æ•´ç†é€å­—ç¨¿è€—æ™‚ã€æœ‰æ™‚åªéœ€è¦ç­†è¨˜åŠŸèƒ½         |
| æ ¸å¿ƒåƒ¹å€¼ | 1 å€‹ç•«é¢å®Œæˆã€Œç´”ç­†è¨˜ã€æˆ–ã€ŒéŒ„éŸ³ â†’ å³æ™‚é€å­—ç¨¿ â†’ ç­†è¨˜ã€ï¼Œèª²å¾Œä¸€éµåŒ¯å‡º |

---

## 3. åŠŸèƒ½åˆ—è¡¨

1. **é›²ç«¯ Markdown ç­†è¨˜**  
   éš¨æ™‚æ’°å¯« Markdown ç­†è¨˜

2. **éŒ„éŸ³èˆ‡å³æ™‚é€å­—ç¨¿**  
   é‚ŠéŒ„éŸ³é‚Šè‡ªå‹•ç”¢ç”Ÿé€å­—ç¨¿ï¼Œæ”¯æ´å¤šåœ‹èªè¨€

3. **å¤šç¨®èªéŸ³è¾¨è­˜å¼•æ“é¸æ“‡**  
   å¯åˆ‡æ› Whisper æˆ– GPT-4o-transcribe Model

4. **ä¸€éµåŒ¯å‡º**  
   ç­†è¨˜ã€é€å­—ç¨¿å¯ä¸€éµåŒ¯å‡º ZIP æª”



# END FILE CONTENTS


# File: frontend/lib/initial-state-loader.ts

"use client"

import type { AppData } from '../types/app-state'

/**
 * åˆå§‹ç‹€æ…‹è¼‰å…¥å™¨
 * è² è²¬å¾ localStorage æˆ–å…¶ä»–æŒä¹…åŒ–å­˜å„²è¼‰å…¥åˆå§‹ç‹€æ…‹
 */
export class InitialStateLoader {
    private static readonly STORAGE_KEYS = {
        DRAFT_NOTE: 'draft_note',
        LAST_SESSION: 'last_session',
        APP_STATE: 'app_state_v1',
    } as const

    /**
     * è¼‰å…¥åˆå§‹æ‡‰ç”¨ç‹€æ…‹
     * å„ªå…ˆé †åºï¼šlocalStorage > é è¨­ç‹€æ…‹
     */
    static loadInitialAppData(): AppData {
        console.log('ğŸ”„ [InitialStateLoader] é–‹å§‹è¼‰å…¥åˆå§‹ç‹€æ…‹')

        try {
            // 1. è¼‰å…¥è‰ç¨¿ç­†è¨˜
            const draftContent = this.loadDraftNote()

            // 2. è¼‰å…¥ä¸Šæ¬¡æœƒè©±è³‡è¨Šï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            const lastSession = this.loadLastSession()

            // 3. è¼‰å…¥å®Œæ•´æ‡‰ç”¨ç‹€æ…‹ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            const savedAppState = this.loadSavedAppState()

            // ä¿®æ­£ï¼šå¦‚æœå„²å­˜çš„ç‹€æ…‹æ˜¯æš«æ™‚æ€§æˆ–å·²å®Œæˆçš„ï¼Œå‰‡é‡ç½®ç‚ºé è¨­ç‹€æ…‹
            console.log('ğŸ” [InitialStateLoader] æª¢æŸ¥å„²å­˜çš„ç‹€æ…‹:', {
                savedState: savedAppState?.state,
                shouldReset: savedAppState?.state && ['recording_waiting', 'recording_active', 'processing', 'finished'].includes(savedAppState.state)
            })

            const validInitialState =
                savedAppState?.state &&
                    !['recording_waiting', 'recording_active', 'processing', 'finished'].includes(savedAppState.state)
                    ? savedAppState.state
                    : 'default'

            console.log('ğŸ” [InitialStateLoader] æœ€çµ‚åˆå§‹ç‹€æ…‹:', validInitialState)

            const initialAppData: AppData = {
                state: validInitialState,
                transcriptEntries: savedAppState?.transcriptEntries || [],
                editorContent: draftContent || '',
                isRecording: false, // é‡å•Ÿå¾Œæ°¸é ä¸æ‡‰è©²æ˜¯éŒ„éŸ³ç‹€æ…‹
                recordingTime: 0,   // é‡å•Ÿå¾Œé‡ç½®éŒ„éŸ³æ™‚é–“
                session: lastSession, // å¯èƒ½ç‚º null
            }

            console.log('ğŸ”„ [InitialStateLoader] åˆå§‹ç‹€æ…‹è¼‰å…¥å®Œæˆ:', {
                hasDraftContent: !!draftContent,
                hasLastSession: !!lastSession,
                hasSavedAppState: !!savedAppState,
                state: initialAppData.state,
                transcriptCount: initialAppData.transcriptEntries.length
            })

            return initialAppData
        } catch (error) {
            console.error('âŒ [InitialStateLoader] è¼‰å…¥åˆå§‹ç‹€æ…‹å¤±æ•—:', error)
            return this.getDefaultAppData()
        }
    }

    /**
     * è¼‰å…¥è‰ç¨¿ç­†è¨˜å…§å®¹
     */
    private static loadDraftNote(): string {
        try {
            const draft = localStorage.getItem(this.STORAGE_KEYS.DRAFT_NOTE)
            return draft || ''
        } catch (error) {
            console.warn('âš ï¸ [InitialStateLoader] è¼‰å…¥è‰ç¨¿ç­†è¨˜å¤±æ•—:', error)
            return ''
        }
    }

    /**
     * è¼‰å…¥ä¸Šæ¬¡æœƒè©±è³‡è¨Š
     */
    private static loadLastSession(): AppData['session'] {
        try {
            const sessionData = localStorage.getItem(this.STORAGE_KEYS.LAST_SESSION)
            if (!sessionData) return null

            const session = JSON.parse(sessionData)

            // é©—è­‰æœƒè©±è³‡æ–™çµæ§‹
            if (session && typeof session === 'object' && session.id) {
                // åªæœ‰åœ¨æœƒè©±ç‹€æ…‹ä¸æ˜¯ completed æˆ– error æ™‚æ‰æ¢å¾©
                if (session.status === 'completed' || session.status === 'error') {
                    console.log('ğŸ”„ [InitialStateLoader] ä¸Šæ¬¡æœƒè©±å·²å®Œæˆï¼Œä¸æ¢å¾©:', session.status)
                    return null
                }

                console.log('ğŸ”„ [InitialStateLoader] æ¢å¾©ä¸Šæ¬¡æœƒè©±:', {
                    id: session.id,
                    status: session.status,
                    type: session.type
                })
                return session
            }

            return null
        } catch (error) {
            console.warn('âš ï¸ [InitialStateLoader] è¼‰å…¥ä¸Šæ¬¡æœƒè©±å¤±æ•—:', error)
            return null
        }
    }

    /**
     * è¼‰å…¥å®Œæ•´çš„æ‡‰ç”¨ç‹€æ…‹
     */
    private static loadSavedAppState(): Partial<AppData> | null {
        try {
            const stateData = localStorage.getItem(this.STORAGE_KEYS.APP_STATE)
            if (!stateData) return null

            const savedState = JSON.parse(stateData)

            // é©—è­‰ç‹€æ…‹è³‡æ–™çµæ§‹
            if (savedState && typeof savedState === 'object') {
                console.log('ğŸ”„ [InitialStateLoader] è¼‰å…¥å·²å„²å­˜çš„æ‡‰ç”¨ç‹€æ…‹')
                return savedState
            }

            return null
        } catch (error) {
            console.warn('âš ï¸ [InitialStateLoader] è¼‰å…¥æ‡‰ç”¨ç‹€æ…‹å¤±æ•—:', error)
            return null
        }
    }

    /**
     * ç²å–é è¨­æ‡‰ç”¨ç‹€æ…‹
     */
    private static getDefaultAppData(): AppData {
        console.log('ğŸ”„ [InitialStateLoader] ä½¿ç”¨é è¨­ç‹€æ…‹')
        return {
            state: 'default',
            transcriptEntries: [],
            editorContent: '',
            isRecording: false,
            recordingTime: 0,
            session: null,
        }
    }

    /**
     * å„²å­˜æ‡‰ç”¨ç‹€æ…‹åˆ° localStorage
     */
    static saveAppState(appData: AppData): void {
        try {
            // å„²å­˜å®Œæ•´æ‡‰ç”¨ç‹€æ…‹ï¼ˆæ’é™¤æ•æ„Ÿè³‡è¨Šï¼‰
            const stateToSave = {
                state: appData.state,
                transcriptEntries: appData.transcriptEntries,
                // ä¸å„²å­˜ editorContentï¼ˆå·²å–®ç¨å„²å­˜ç‚º draft_noteï¼‰
                // ä¸å„²å­˜ isRecording å’Œ recordingTimeï¼ˆé‡å•Ÿå¾Œæ‡‰é‡ç½®ï¼‰
            }

            localStorage.setItem(this.STORAGE_KEYS.APP_STATE, JSON.stringify(stateToSave))

            // å„²å­˜æœƒè©±è³‡è¨Š
            if (appData.session) {
                localStorage.setItem(this.STORAGE_KEYS.LAST_SESSION, JSON.stringify(appData.session))
            } else {
                localStorage.removeItem(this.STORAGE_KEYS.LAST_SESSION)
            }

            console.log('ğŸ’¾ [InitialStateLoader] æ‡‰ç”¨ç‹€æ…‹å·²å„²å­˜')
        } catch (error) {
            console.error('âŒ [InitialStateLoader] å„²å­˜æ‡‰ç”¨ç‹€æ…‹å¤±æ•—:', error)
        }
    }

    /**
     * æ¸…é™¤æ‰€æœ‰æŒä¹…åŒ–ç‹€æ…‹
     */
    static clearPersistedState(): void {
        try {
            localStorage.removeItem(this.STORAGE_KEYS.APP_STATE)
            localStorage.removeItem(this.STORAGE_KEYS.LAST_SESSION)
            // æ³¨æ„ï¼šä¸æ¸…é™¤ DRAFT_NOTEï¼Œå› ç‚ºé‚£æ˜¯ç”¨æˆ¶çš„è‰ç¨¿å…§å®¹

            console.log('ğŸ—‘ï¸ [InitialStateLoader] æŒä¹…åŒ–ç‹€æ…‹å·²æ¸…é™¤')
        } catch (error) {
            console.error('âŒ [InitialStateLoader] æ¸…é™¤æŒä¹…åŒ–ç‹€æ…‹å¤±æ•—:', error)
        }
    }

    /**
     * æª¢æŸ¥æ˜¯å¦æœ‰æŒä¹…åŒ–ç‹€æ…‹
     */
    static hasPersistedState(): boolean {
        try {
            return !!(
                localStorage.getItem(this.STORAGE_KEYS.APP_STATE) ||
                localStorage.getItem(this.STORAGE_KEYS.LAST_SESSION)
            )
        } catch (error) {
            console.warn('âš ï¸ [InitialStateLoader] æª¢æŸ¥æŒä¹…åŒ–ç‹€æ…‹å¤±æ•—:', error)
            return false
        }
    }
}


# END FILE CONTENTS


# File: docs/skip-silence-spec.md

# éœéŸ³æ®µéæ¿¾è¦æ ¼

## ç›®æ¨™

- éŸ³è¨Šåˆ‡ç‰‡è‹¥ç‚ºã€Œå®Œå…¨éœéŸ³ã€ï¼Œä¸ç”¢ç”Ÿé€å­—ç¨¿ã€ä¸æ¨é€ WebSocketï¼Œå‰ç«¯ä¸é¡¯ç¤ºã€‚

## æµç¨‹èªªæ˜

1. **éœéŸ³åµæ¸¬ util**ï¼ˆ`app/core/audio_vad.py`ï¼‰
   - ä½¿ç”¨ ffmpeg `silencedetect`ï¼Œåˆ¤æ–·ä¸€æ®µ wav æ˜¯å¦ã€Œå…¨éƒ¨éœéŸ³ã€ã€‚
   - åƒæ•¸ï¼š
     - dB é–€æª»ï¼ˆ`SILENCE_NOISE_DB`ï¼Œé è¨­ -35ï¼‰
     - æŒçºŒç§’æ•¸ï¼ˆ`SILENCE_DURATION_SEC`ï¼Œé è¨­ 0.3ï¼‰
   - åƒæ•¸å¯ç”± config/env è¨­å®šã€‚
   - è‹¥æ•´æ®µéŸ³è¨Šéƒ½åœ¨é–€æª»ä»¥ä¸‹ï¼Œå›å‚³ Trueã€‚

2. **STT Provider æ•´åˆ**ï¼ˆå¦‚ `gpt4o_provider.py`ï¼‰
   - è½‰æª”å¾Œå‘¼å« `is_silent`ï¼Œè‹¥ç‚ºéœéŸ³ç›´æ¥ return Noneï¼Œä¸é€å» STTã€‚
   - ééœéŸ³æ‰å‘¼å« STT APIã€‚

3. **å¤–å±¤æµç¨‹**ï¼ˆå¦‚ `segments.py`ï¼‰
   - è‹¥ transcribe å›å‚³ Noneï¼Œåƒ…è¨˜éŒ„ warningï¼Œä¸å‘¼å« `save_and_push_result`ï¼Œä¸æ¨é€ WebSocketã€‚
   - å‰ç«¯ä¸æœƒé¡¯ç¤ºè©²æ®µã€‚

## åƒæ•¸è¨­è¨ˆ

- `SILENCE_NOISE_DB`ï¼šéœéŸ³åˆ¤æ–· dB é–€æª»ï¼Œé è¨­ -35ï¼Œå¯ç”±ç’°å¢ƒè®Šæ•¸èª¿æ•´ã€‚
- `SILENCE_DURATION_SEC`ï¼šéœéŸ³åˆ¤æ–·æŒçºŒç§’æ•¸ï¼Œé è¨­ 0.3ï¼Œå¯ç”±ç’°å¢ƒè®Šæ•¸èª¿æ•´ã€‚

## æ¸¬è©¦èˆ‡é©—è­‰

- `is_silent` å·²æœ‰å–®å…ƒæ¸¬è©¦ï¼Œmock ffmpeg è¡Œç‚ºï¼Œé©—è­‰éœéŸ³/ééœéŸ³çš†æ­£ç¢ºã€‚
- Provider å±¤æœ‰æ¸¬è©¦ï¼Œé©—è­‰é‡åˆ°éœéŸ³æ™‚æœƒ return Noneã€‚
- å¤–å±¤æµç¨‹å·²é©—è­‰ï¼ŒNone ä¸æœƒæ¨é€é€å­—ç¨¿ã€‚

## å‚™è¨»

- è‹¥éœ€èª¿æ•´åˆ¤æ–·éˆæ•åº¦ï¼Œå»ºè­°å„ªå…ˆèª¿æ•´ dB é–€æª»ã€‚
- è‹¥ chunk é•·åº¦æœ‰è®Šå‹•ï¼Œéœ€åŒæ­¥è€ƒæ…®éœéŸ³æŒçºŒç§’æ•¸åƒæ•¸ã€‚ 


# END FILE CONTENTS


# File: frontend/hooks/use-app-state-adapter.ts

"use client"

import { useAppState as useAppStateLegacy } from './use-app-state'
import { useAppStateNew } from './use-app-state-new'
import { isFeatureEnabled } from '../lib/feature-flags'
import type { AppData } from '../types/app-state'

// çµ±ä¸€çš„ UseAppState ä»‹é¢
interface UseAppStateReturn {
    // æ‡‰ç”¨ç‹€æ…‹
    appData: AppData
    isLoading: boolean
    error: string | null

    // æœƒè©±ç®¡ç†
    createNoteSession: (title?: string) => Promise<void>
    createRecordingSession: (title?: string) => Promise<void>
    upgradeToRecording: () => Promise<void>
    finishSession: () => Promise<void>
    newNote: () => Promise<void>

    // éŒ„éŸ³æ§åˆ¶
    startRecording: (title?: string) => Promise<void>
    stopRecording: () => Promise<void>

    // æœ¬åœ°è‰ç¨¿
    saveLocalDraft: (content: string) => void

    // å¤–éƒ¨ç‹€æ…‹
    session: any
    sessionLoading: boolean
    sessionError: string | null

    // éŒ„éŸ³ç‹€æ…‹
    recordingError: string | null

    // é€å­—ç¨¿ç‹€æ…‹
    transcriptConnected: boolean
    transcriptError: string | null
    transcriptAutoScroll: boolean
    enableAutoScroll: () => void
    disableAutoScroll: () => void
    scrollToLatest: () => void
}

/**
 * useAppState é©é…å™¨ Hook
 * æ ¹æ“šåŠŸèƒ½é–‹é—œæ±ºå®šä½¿ç”¨æ–°èˆŠç‰ˆæœ¬çš„ useAppState
 * ç¢ºä¿ API å®Œå…¨ç›¸å®¹ï¼Œç¾æœ‰çµ„ä»¶ç„¡éœ€ä¿®æ”¹
 */
export function useAppState(): UseAppStateReturn {
    const useNewAppStateHook = isFeatureEnabled('useNewAppStateHook')
    const useNewStateManagement = isFeatureEnabled('useNewStateManagement')

    console.log('ğŸ”„ [useAppStateAdapter] åŠŸèƒ½é–‹é—œç‹€æ…‹:', {
        useNewAppStateHook,
        useNewStateManagement,
        willUseNewVersion: useNewAppStateHook || useNewStateManagement
    })

    // å¦‚æœå•Ÿç”¨æ–° AppState Hook æˆ–æ–°ç‹€æ…‹ç®¡ç†ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬
    if (useNewAppStateHook || useNewStateManagement) {
        console.log('ğŸ”„ [useAppStateAdapter] ä½¿ç”¨æ–°ç‰ˆæœ¬ useAppStateNew')
        return useAppStateNew()
    }

    // å¦å‰‡ä½¿ç”¨èˆŠç‰ˆæœ¬
    console.log('ğŸ”„ [useAppStateAdapter] ä½¿ç”¨èˆŠç‰ˆæœ¬ useAppState')
    return useAppStateLegacy()
}

// å°å‡ºèˆŠç‰ˆæœ¬ä¾›ç›´æ¥ä½¿ç”¨ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ç‰¹æ®Šæƒ…æ³ï¼‰
export { useAppState as useAppStateLegacy } from './use-app-state'
export { useAppStateNew } from './use-app-state-new'


# END FILE CONTENTS


# File: frontend/public/placeholder.svg

<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1200" fill="none"><rect width="1200" height="1200" fill="#EAEAEA" rx="3"/><g opacity=".5"><g opacity=".5"><path fill="#FAFAFA" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/></g><path stroke="url(#a)" stroke-width="2.418" d="M0-1.209h553.581" transform="scale(1 -1) rotate(45 1163.11 91.165)"/><path stroke="url(#b)" stroke-width="2.418" d="M404.846 598.671h391.726"/><path stroke="url(#c)" stroke-width="2.418" d="M599.5 795.742V404.017"/><path stroke="url(#d)" stroke-width="2.418" d="m795.717 796.597-391.441-391.44"/><path fill="#fff" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/><g clip-path="url(#e)"><path fill="#666" fill-rule="evenodd" d="M616.426 586.58h-31.434v16.176l3.553-3.554.531-.531h9.068l.074-.074 8.463-8.463h2.565l7.18 7.181V586.58Zm-15.715 14.654 3.698 3.699 1.283 1.282-2.565 2.565-1.282-1.283-5.2-5.199h-6.066l-5.514 5.514-.073.073v2.876a2.418 2.418 0 0 0 2.418 2.418h26.598a2.418 2.418 0 0 0 2.418-2.418v-8.317l-8.463-8.463-7.181 7.181-.071.072Zm-19.347 5.442v4.085a6.045 6.045 0 0 0 6.046 6.045h26.598a6.044 6.044 0 0 0 6.045-6.045v-7.108l1.356-1.355-1.282-1.283-.074-.073v-17.989h-38.689v23.43l-.146.146.146.147Z" clip-rule="evenodd"/></g><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/></g><defs><linearGradient id="a" x1="554.061" x2="-.48" y1=".083" y2=".087" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="b" x1="796.912" x2="404.507" y1="599.963" y2="599.965" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="c" x1="600.792" x2="600.794" y1="403.677" y2="796.082" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="d" x1="404.85" x2="796.972" y1="403.903" y2="796.02" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><clipPath id="e"><path fill="#fff" d="M581.364 580.535h38.689v38.689h-38.689z"/></clipPath></defs></svg>

# END FILE CONTENTS


# File: frontend/components/ui/button.tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }


# END FILE CONTENTS


# File: frontend/components/ui/chart.tsx

"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([_, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}


# END FILE CONTENTS


# File: .cursor/rules/rules.mdc

---
description:
globs:
alwaysApply: true
---
<!-- Source:
1. https://tidyfirst.substack.com/p/augmented-coding-beyond-the-vibes
2. https://github.com/arthow4n/live-language-mate/blob/master/CLAUDE.md -->

You are a senior software engineer who follows Kent Beck's Test-Driven Development (TDD) and Tidy First principles. Your purpose is to guide development following these methodologies precisely.


# Basic Rules

1. If the project has a PRD or SPEC, read them carefully to ensure that what you're doing is consistent and aligned with the correct objectives.
2. When you are coding or implementing the test, implement only enough code to fulfill that need or make the test pass.


# User Preferences

-  **Language Preference**: Communicate using Traditional Chinese (zh-tw) from Taiwan
-  **Simplicity Principle**: Avoid overly complex tool settings and configuration files


## Planning and task management

- Prioritize the use of Task Manager for task analysis and scheduling.
- When executing tasks from the Todos checklist, report and explain after completing each task, check it off, and then proceed to the next task.
- You are meant to work on your own unattended once the user has approved your initial work plan, you should plan ahead for working on your own.
- When planning, the plan is always for yourself to be able to follow the plan and work on the task immediately after the plan is approved by the user.
- When planning, automatically break down the task into smaller tasks and utilise the TodoRead & TodoWrite tools.
- When planning, plan ahead to see if you need to update any tests.
- When planning, think and review the plan yourself to see if you are over-engineering, you should focus on only making the absolutely relevant and needed chagnes. You need to review your own plan at least review 2 times.
- When planning is completed, write the spec to  ./docs as a markdown, using its functionality as the filename.
- Before you start working, make sure to step back and break down the plan into smaller todo items.


## Development process

- You should do TDD:
  1. Review the code paths that will be tested from beginning to end, then think how to write the correct test case.
  2. Write a test case that is failing, which will be fixed after correct implementation.
  3. Start implementation.
  4. Fix until test passes.
  5. Commit and push after each task is done.
- If test is failng more than 3 times in a row, step back and read again the code path from beginning to end, think how to address the issue systematically before you rerun the test again.
- Question yourself are your soution and test addressing what the user asked for.
- Always use environment-variable config files for clean, unified managementâ€”never hard-code.
- Don't skip anything in your todo.

# CORE DEVELOPMENT PRINCIPLES

- Always follow the TDD cycle: Red â†’ Green â†’ Refactor

- Write the simplest failing test first

- Implement the minimum code needed to make tests pass

- Refactor only after tests are passing

- Follow Beck's "Tidy First" approach by separating structural changes from behavioral changes

- Maintain high code quality throughout development

# TDD METHODOLOGY GUIDANCE

- Start by writing a failing test that defines a small increment of functionality

- Use meaningful test names that describe behavior (e.g., "shouldSumTwoPositiveNumbers")

- Make test failures clear and informative

- Write just enough code to make the test pass - no more

- Once tests pass, consider if refactoring is needed

- Repeat the cycle for new functionality

# TIDY FIRST APPROACH

- Separate all changes into two distinct types:

1. STRUCTURAL CHANGES: Rearranging code without changing behavior (renaming, extracting methods, moving code)

2. BEHAVIORAL CHANGES: Adding or modifying actual functionality

- Never mix structural and behavioral changes in the same commit

- Always make structural changes first when both are needed

# CODE QUALITY STANDARDS

- Eliminate duplication ruthlessly

- Express intent clearly through naming and structure

- Make dependencies explicit

- Keep methods small and focused on a single responsibility

- Minimize state and side effects

- Use the simplest solution that could possibly work

# REFACTORING GUIDELINES

- Refactor only when tests are passing (in the "Green" phase)

- Use established refactoring patterns with their proper names

- Make one refactoring change at a time

- Run tests after each refactoring step

- Prioritize refactorings that remove duplication or improve clarity

# EXAMPLE WORKFLOW

When approaching a new feature:

1. Write a simple failing test for a small part of the feature

2. Implement the bare minimum to make it pass

3. Run tests to confirm they pass (Green)

4. Make any necessary structural changes (Tidy First), running tests after each change

5. Commit structural changes separately

6. Add another test for the next small increment of functionality

7. Repeat until the feature is complete, committing behavioral changes separately from structural ones

Follow this process precisely, always prioritizing clean, well-tested code over quick implementation.

Always write one test at a time, make it run, then improve structure. Always run all the tests (except long-running tests) each time.



# Engineering mindset

- You should follow the existing code style, if you are about to implement something new or write a new test, search for existing files to understand the current style and convention.
- You should actively look for reusing shared function/component/hook etc, and search for another potentially extractable/sharable code to move to shared code.
- Avoid over-engineering. Keep thinking and reviewing whether if your solution is over-engineered, step back, look around and see if you can simplify your solution and its related code paths and only make the absolutely necessary changes.
- For asynchronous logic flow, no matter in test, code or UI, make sure to implement them in a way where the cause and effect can be logically followed, for example by using async-await, event handler, or callback. Avoid using timeout/polling to handle asynchronous logic flow, if timeout/polling is really the only way to implement the logic, make sure to comment why timeout/polling is used instead of the other better approaches.
- Don't leave unnecessary comment, unmaintained comment can become stale and adds confusion. You should only leave comment for explaining the motivation behind the code, not to repeat what the code is doing.
- Make sure your code can be logically followed, there should not be implicit flow.
- Make sure the cause and effect in the code flow is deterministic, you should not cause race condition.
- If you belive something might be caused by a race condition or a timing issue, you should default to step back and read through all the related code paths from beginning to end, and then make a comprehensive argument about why it's really a race condition or timing issue. This is to make sure you don't just blindly guess and fix the wrong problem.

# Tool usage

- Always use MCP tools, including Serena and Context7, for research and feasibility analysis evaluation before editing code.
- Batch your tool calls, use many tools at once.


# Other Rules

Always follow the instructions in these rules:

- @frontend.mdc
- @backend.mdc
- @ui-rules/shadcn-tailwind-ui-guideline.mdc



# END FILE CONTENTS


# File: frontend/components/ui/table.tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}


# END FILE CONTENTS


# File: SPEC.md

# Technical Specification


## Frontend Stack

- pnpm for Package manager
- React 18 with TypeScript
- Next.js for framework
- Tailwind CSS + shadcn/ui components
- Zustand-like context for state management
- Zod 4, therefore the imports should be `from "zod/v4"`, you may fetch `https://zod.dev/v4/changelog` if you are unsure how to write.
- Playwright MCP for e2e test

```ts
// Bad: Zod 3
import { z } from 'zod';
z.object({ name: z.string() }).strict();
z.object({ name: z.string() }).passthrough();

// Good: Zod 4
import { z } from 'zod/v4';
z.strictObject({ name: z.string() });
z.looseObject({ name: z.string() });
```


## Backend Stack

- Python version 3.10+
  - Use `uv` for virtual environment management
  - Pin all dependency versions in requirements.txt or pyproject.toml
- Separate production and development dependencies
- FastAPI for web framework with async support
- Pydantic v2 for data validation and settings management
- Supabase as database
- Azure OpenAI for transcription services
- WebSocket for real-time communication
- Cloudflare R2 for audio storage
- FFmpeg for audio processing


## File Structure

- Frontend File organization
  - Components in `frontend/components/(ui)/`
  - Custom hooks in `frontend/hooks/`
  - Utilities in `frontend/lib/`
  - Type definitions in `frontend/types/`
  - Services in `frontend/lib/services/`
  - Constants in `frontend/constants/`


- Backend File organization
  - Models in `app/schemas/`
  - Services in `app/services/`
  - API routes in `app/api/`
  - Core utilities in `app/core/`
  - Database related in `app/db/`
  - WebSocket handlers in `app/ws/`
  


### 1. å¾Œç«¯ FastAPI (ç°¡åŒ–æ¶æ§‹ - REST API æ¨¡å¼)

| #     | å‡½å¼ / å”ç¨‹                                              | æ‰€å±¬æ¨¡çµ„              | è²¬ä»»                                         | I/O                                                |
| ----- | -------------------------------------------------------- | --------------------- | -------------------------------------------- | -------------------------------------------------- |
| B-001 | `create_session(title:str=None, type:str) -> SessionOut` | api.sessions          | POST /api/session                            | in: type, title(å¯é¸)ï¼›out: sid, status, type      |
| B-002 | `finish_session(sid:UUID)`                               | api.sessions          | PATCH /api/session/{sid}/finish              | in: sidï¼›204                                       |
| B-015 | `upgrade_session_to_recording(sid:UUID)`                 | api.sessions          | PATCH /api/session/{sid}/upgrade             | in: sidï¼›out: updated session                      |
| B-003 | `save_note(sid:UUID, content:str, client_ts:datetime)`   | api.notes             | PUT /api/notes/{sid}                         | in: content, client_ts(å¯é¸)ï¼›out: server_ts, note |
| B-004 | `export_resource(sid:UUID, type:str)`                    | api.export            | GET /api/export/{sid}?type=                  | StreamingResponse                                  |
| B-020 | `upload_segment(sid:UUID, seq:int, file:UploadFile)`     | api.segments          | POST /api/segment - ä¸Šå‚³ 10s WebM éŸ³æª”åˆ‡ç‰‡   | in: WebM fileï¼›out: {"ack": seq}                   |
| B-006 | `ws_transcript_feed(ws:WebSocket, sid:UUID)`             | ws.transcript_feed    | æ¨é€ Azure OpenAI é€å­—ç¨¿çµæœ                 | â†“ {"text","timestamp",...}                         |
| B-007 | `store_segment_blob(sid, seq, blob)`                     | services.storage      | ä¸Šå‚³åˆ° Cloudflare R2 + æ›´æ–° DB `audio_files` | â€”                                                  |
| B-021 | `ffmpeg_webm_to_pcm(webm_bytes) -> bytes`                | core.ffmpeg           | WebMâ†’16k mono PCM (è™•ç†å®Œæ•´ 10s æª”æ¡ˆ)        | in: WebM blobï¼›out: PCM bytes                      |
| B-010 | `azure_openai_client() -> OpenAI`                        | services.azure_openai | å»ºç«‹ Azure OpenAI å®¢æˆ¶ç«¯                     | return client                                      |
| B-022 | `whisper_transcribe(pcm_bytes) -> str`                   | services.azure_openai | å–®æª”è½‰éŒ„ï¼šWebM/PCM â†’ Azure OpenAI Whisper    | in: audio bytesï¼›out: transcript text              |
| B-023 | `process_and_transcribe(sid, seq, webm)`                 | api.segments          | èƒŒæ™¯ä»»å‹™ï¼šè½‰æª” + STT + å„²å­˜ + å»£æ’­           | BackgroundTasks                                    |
| B-013 | `mark_session_error(sid, reason)`                        | db.crud               | æ›´æ–° sessions.status=error                   | â€”                                                  |
| B-014 | `single_active_guard()`                                  | middleware            | ä¿è­‰åŒæ™‚åƒ… 1 active session                  | 429 on violation                                   |
| B-016 | `check_tables_exist()`                                   | db.database           | æª¢æŸ¥æ ¸å¿ƒè¡¨æ ¼æ˜¯å¦å­˜åœ¨                         | return bool                                        |
| B-017 | `auto_init_database()`                                   | db.database           | è‡ªå‹•æª¢æ¸¬ä¸¦åˆå§‹åŒ–è³‡æ–™åº«                       | å•Ÿå‹•æ™‚åŸ·è¡Œ                                         |
| B-018 | `init_r2_client() -> S3Client`                           | services.r2_client    | åˆå§‹åŒ– Cloudflare R2 å®¢æˆ¶ç«¯                  | return S3Client                                    |
| B-019 | `generate_r2_presigned_url(bucket, key, expires)`        | services.r2_client    | ç”Ÿæˆ R2 é ç°½å URL                           | return presigned_url                               |

### âš ï¸ ç§»é™¤çš„åŠŸèƒ½ (ç°¡åŒ–æ¶æ§‹)
- âŒ `ws_upload_audio` - æ”¹ç”¨ REST API
- âŒ `handle_ack_missing` - ä¸å†éœ€è¦ chunk ack/missing æ©Ÿåˆ¶
- âŒ `ffmpeg_spawn` - æ”¹ç‚ºè™•ç†å®Œæ•´æª”æ¡ˆï¼Œä¸éœ€è¦ä¸²æµ
- âŒ `transcribe_audio_batch` - æ”¹ç‚ºå–®æª”è™•ç†

### 2. å‰ç«¯ Reactï¼ˆHook / Utilityï¼‰

| #     | å‡½å¼                                 | æ¨¡çµ„                | è²¬ä»»                                                                                       | I/O                                                                          |
| ----- | ------------------------------------ | ------------------- | ------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------- |
| F-001 | `useAppState.setState(state)`        | hooks/useAppState   | ç®¡ç†å‰ç«¯æ‡‰ç”¨ç‹€æ…‹è½‰æ›                                                                       | 'default'\|'recording_waiting'\|'recording_active'\|'processing'\|'finished' |
| F-002 | `useSession.createNoteSession()`     | hooks/useSession    | POST /session (type=note_only)                                                             | return sid                                                                   |
| F-003 | `useSession.upgradeToRecording(sid)` | hooks/useSession    | PATCH /session/{sid}/upgrade                                                               | return updated session                                                       |
| F-004 | `useRecorder.startRecording()`       | hooks/useRecorder   | a. å»ºç«‹/å‡ç´š session<br>b. ç‹€æ…‹è½‰ç‚º recording_waiting<br>c. å•Ÿ MediaRecorder timeslice=10s | return sid                                                                   |
| F-005 | `useRecorder.stopRecording()`        | hooks/useRecorder   | a. åœæ­¢éŒ„éŸ³<br>b. ç‹€æ…‹è½‰ç‚º processing<br>c. ç­‰å¾…è½‰éŒ„å®Œæˆ                                   | â€”                                                                            |
| F-024 | `uploadSegment(seq, blob)`           | hooks/useRecorder   | fetch POST /api/segment ä¸Šå‚³ 10s WebM æª”æ¡ˆ                                                 | â€”                                                                            |
| F-025 | `handleUploadError(seq, blob)`       | hooks/useRecorder   | ä¸Šå‚³å¤±æ•—è™•ç†ï¼Œæš«å­˜åˆ° IndexedDB                                                             | â€”                                                                            |
| F-008 | `useTranscript.connect(sid)`         | hooks/useTranscript | å»º `/ws/transcript_feed` é€£ç·š                                                              | â€”                                                                            |
| F-009 | `mergeSegment(seg)`                  | hooks/useTranscript | ç›¸é„° â‰¤1 s åˆä½µæ®µè½                                                                         | æ›´æ–° segments state                                                          |
| F-010 | `onTranscriptComplete()`             | hooks/useTranscript | è½‰éŒ„å®Œæˆå›èª¿ï¼Œç‹€æ…‹è½‰ç‚º finished                                                            | â€”                                                                            |
| F-011 | `autoScroll()`                       | hooks/useTranscript | è‹¥é–å®šåˆ°åº•å‰‡æ²åº•                                                                           | â€”                                                                            |
| F-012 | `unlockOnScroll()`                   | hooks/useTranscript | ä½¿ç”¨è€…æ»¾å‹•é›¢åº• >60 px                                                                      | set locked=false                                                             |
| F-013 | `toLatest()`                         | hooks/useTranscript | smooth scroll bottomï¼›é–å®š                                                                 | â€”                                                                            |
| F-014 | `useLocalDraft(field,val)`           | hooks/useLocalDraft | 5 s debounce å­˜ localStorage                                                               | â€”                                                                            |
| F-015 | `loadDraft()`                        | hooks/useLocalDraft | è¼‰å…¥ draft_note                                                                            | return {note}                                                                |
| F-016 | `clearDraft()`                       | hooks/useLocalDraft | removeItem('draft_*')                                                                      | â€”                                                                            |
| F-017 | `useAutoSave(sid, content)`          | hooks/useAutoSave   | æ¯ 10 s PUT /notes                                                                         | â€”                                                                            |
| F-018 | `newNote()`                          | hooks/useAppState   | æ¸…ç©ºç•¶å‰è³‡æ–™ï¼Œç‹€æ…‹å›åˆ° default<br>å¦‚æœå­˜åœ¨æ´»èºæœƒè©±ï¼Œå…ˆåˆªé™¤è©²æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“š           | â€”                                                                            |
| F-019 | `downloadZip(sid)`                   | utils/export        | GET /export/{sid}?type=zip                                                                 | è§¸ç™¼ download                                                                |
| F-020 | `showToast(text,type)`               | utils/ui            | çµ±ä¸€éŒ¯èª¤ï¼æç¤º                                                                             | â€”                                                                            |

### 3. å‰ç«¯ UI Component Methodsï¼ˆç‹€æ…‹å°æ‡‰ï¼‰

| #     | å…ƒä»¶                | å‡ºç¾ç‹€æ…‹                                                  | ä¸»è¦æ–¹æ³• / callback                    |
| ----- | ------------------- | --------------------------------------------------------- | -------------------------------------- |
| C-001 | `RecordButton`      | default, recording_waiting, recording_active              | `onClick => startRecording()           | stopRecording()` |
| C-002 | `MarkdownEditor`    | default, recording_waiting, recording_active, finished    | `onChange => saveDraft() / autoSave()` |
| C-003 | `TranscriptPane`    | recording_waiting, recording_active, processing, finished | `onScroll => unlockOnScroll()`         |
| C-004 | `ToLatestButton`    | recording_waiting, finished                               | `onClick => toLatest()`                |
| C-005 | `ProcessingOverlay` | processing                                                | é¡¯ç¤ºè½‰éŒ„é€²åº¦èˆ‡ç­‰å¾…å‹•ç•«                 |
| C-006 | `ExportButton`      | finished                                                  | `onClick => downloadZip()`             |
| C-007 | `NewNoteButton`     | finished                                                  | `onClick => newNote()`                 |
| C-008 | `StatusIndicator`   | all states                                                | é¡¯ç¤ºç•¶å‰ç‹€æ…‹ï¼ˆéŒ„éŸ³ä¸­/è™•ç†ä¸­/å·²å®Œæˆï¼‰   |

**å„ç‹€æ…‹ç•«é¢çµ„æˆ**ï¼š

| ç‹€æ…‹              | é¡¯ç¤ºå…ƒä»¶                                                                              |
| ----------------- | ------------------------------------------------------------------------------------- |
| default           | MarkdownEditor + RecordButton + NewNoteButton                                         |
| recording_waiting | MarkdownEditor + TranscriptPane + NewNoteButton + RecordButton(åœæ­¢) + ToLatestButton |
| recording_active  | MarkdownEditor + TranscriptPane + NewNoteButton + RecordButton(åœæ­¢) + ToLatestButton |
| processing        | MarkdownEditor + TranscriptPane + ProcessingOverlay                                   |
| finished          | MarkdownEditor + TranscriptPane + ExportButton + NewNoteButton + ToLatestButton       |

**NewNoteButton åœ¨ä¸åŒç‹€æ…‹çš„è¡Œç‚º**ï¼š

| ç‹€æ…‹              | NewNoteButton è¡Œç‚º       | èªªæ˜                                                                                           |
| ----------------- | ------------------------ | ---------------------------------------------------------------------------------------------- |
| default           | æ¸…ç©ºç•¶å‰æœƒè©±ä¸¦é–‹å§‹æ–°ç­†è¨˜ | å¦‚æœå­˜åœ¨æ´»èºæœƒè©±ï¼Œæœƒå…ˆåˆªé™¤è©²æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼›æ¸…ç©ºç·¨è¼¯å™¨å…§å®¹å’Œæœ¬åœ°è‰ç¨¿ï¼›ç‹€æ…‹ä¿æŒåœ¨ default |
| recording_waiting | åœæ­¢éŒ„éŸ³ä¸¦æ¸…ç©ºç•¶å‰æœƒè©±   | åœæ­¢éŒ„éŸ³ï¼Œåˆªé™¤ç•¶å‰æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼Œå›åˆ° default ç‹€æ…‹                                      |
| recording_active  | åœæ­¢éŒ„éŸ³ä¸¦æ¸…ç©ºç•¶å‰æœƒè©±   | åœæ­¢éŒ„éŸ³ï¼Œåˆªé™¤ç•¶å‰æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼Œå›åˆ° default ç‹€æ…‹                                      |
| finished          | æ¸…ç©ºç•¶å‰æœƒè©±ä¸¦é–‹å§‹æ–°ç­†è¨˜ | åˆªé™¤å·²å®Œæˆçš„æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼Œæ¸…ç©ºç·¨è¼¯å™¨å…§å®¹ï¼Œå›åˆ° default ç‹€æ…‹                            |

### 4. Supabase PostgreSQL è³‡æ–™åº«æ¶æ§‹

**æ¶æ§‹ç‰¹è‰²**ï¼š
- âœ… **é›²ç«¯åŸç”Ÿ**ï¼šå°ˆç‚º Supabase è¨­è¨ˆï¼Œäº«å—å®Œæ•´é›²ç«¯æœå‹™
- âœ… **æª”æ¡ˆåˆ†é›¢**ï¼šéŸ³è¨Šæª”æ¡ˆä½¿ç”¨å…è²»çš„ Cloudflare R2 å„²å­˜ï¼Œé™ä½æˆæœ¬
- âœ… **è‡ªå‹•åˆå§‹åŒ–**ï¼šæä¾›å®Œæ•´ SQL è…³æœ¬ï¼Œä¸€éµå»ºç«‹æ‰€æœ‰è¡¨æ ¼
- âœ… **é«˜å¯ç”¨æ€§**ï¼šSupabase æä¾› 99.9% å¯ç”¨æ€§ä¿è­‰


```Mermaid

sequenceDiagram
    %% ==== Participants ====
    actor User as ğŸ‘¤ ä½¿ç”¨è€…
    participant Browser as ğŸŒ ç€è¦½å™¨
    participant BE as âš¡ FastAPI
    participant R2 as â˜ï¸ R2 Storage
    participant DB as ğŸ’¾ Supabase
    participant STT as ğŸ¤– STT Model
    participant WS as ğŸ”Œ Websocket

    %% ==== å³æ™‚éŒ„éŸ³æµç¨‹ ====
    rect rgb(240,248,255)
        Note over User,WS: ğŸ™ï¸ å³æ™‚éŒ„éŸ³èˆ‡è½‰éŒ„
        User ->> Browser: é»æ“Šé–‹å§‹éŒ„éŸ³
        Browser ->>+ BE: é–‹æ–° Session 

        par å„²å­˜èˆ‡è½‰éŒ„
            BE ->>+ R2: å„²å­˜ WebM
            BE ->>+ STT: WebM â†’ Whisper
            STT -->> BE: å›è¦† Transcript JSON
            BE -->> WS: å‚³å…¥é€å­—ç¨¿
            BE ->>+ DB: INSERT transcript_segments
        end

        WS -->> Browser: é€å‡ºé€å­—ç¨¿
        Browser -->> User: æ›´æ–°é€å­—ç¨¿
    end
        WS -->> Browser: é€å‡ºé€å­—ç¨¿
        Browser -->> User: æ›´æ–°é€å­—ç¨¿
    end

    %% ==== åŒ¯å‡ºåŠŸèƒ½ ====
    rect rgb(248,255,248)
        Note over User,WS: ğŸ“¥ åŒ¯å‡ºç­†è¨˜èˆ‡é€å­—ç¨¿
        User ->> Browser: é»æ“ŠåŒ¯å‡º
        Browser ->>+ BE: GET /api/export?type=zip
        BE ->>+ DB: SELECT note & transcript
        DB -->>- BE: æ–‡å­—å…§å®¹
        BE ->>+ R2: è®€å–éŸ³è¨Šæª”æ¡ˆ
        R2 -->>- BE: WebM files
        BE -->>- Browser: ZIP æª”æ¡ˆ
        Browser -->> User: ä¸‹è¼‰å®Œæˆ
    end

```

```mermaid
erDiagram
    sessions {
        UUID id PK "gen_random_uuid()"
        VARCHAR title "æœƒè©±æ¨™é¡Œ(å¯é¸)"
        session_type type "note_only/recording"
        session_status status "active/completed/error"
        lang_code language "zh-TW/en-US"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
        TIMESTAMPZ updated_at "æ›´æ–°æ™‚é–“"
        TIMESTAMPTZ completed_at "å®Œæˆæ™‚é–“"
    }

    audio_files {
        UUID id PK "gen_random_uuid()"
        UUID session_id FK "é—œè¯æœƒè©±ID"
        INT chunk_sequence "éŸ³æª”åˆ‡ç‰‡åºè™Ÿ"
        TEXT r2_key "Cloudflare R2 ç‰©ä»¶éµå€¼"
        TEXT r2_bucket "Cloudflare R2 å„²å­˜æ¡¶åç¨±"
        INT file_size "æª”æ¡ˆå¤§å°"
        DECIMAL duration_seconds "æ™‚é•·(ç§’)"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
    }

    transcript_segments {
        UUID id PK "gen_random_uuid()"
        UUID session_id FK "é—œè¯æœƒè©±ID"
        INT chunk_sequence "é€å­—ç¨¿ç‰‡æ®µåºè™Ÿ"
        DECIMAL start_time "é–‹å§‹æ™‚é–“(ç§’)"
        DECIMAL end_time "çµæŸæ™‚é–“(ç§’)"
        TEXT text "é€å­—ç¨¿å…§å®¹"
        DECIMAL confidence "ä¿¡å¿ƒåº¦"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
    }

    transcripts {
        UUID id PK "gen_random_uuid()"
        UUID session_id FK "é—œè¯æœƒè©±ID(UNIQUE)"
        TEXT full_text "å®Œæ•´é€å­—ç¨¿"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
        TIMESTAMPTZ updated_at "æ›´æ–°æ™‚é–“"
    }

    notes {
        UUID id PK "gen_random_uuid()"
        UUID session_id FK "é—œè¯æœƒè©±ID(UNIQUE)"
        TEXT content "ç­†è¨˜å…§å®¹(Markdown)"
        TIMESTAMPTZ client_ts "å®¢æˆ¶ç«¯æ™‚é–“æˆ³(å¯é¸)"
        TIMESTAMPTZ created_at "å»ºç«‹æ™‚é–“"
        TIMESTAMPTZ updated_at "æ›´æ–°æ™‚é–“"
    }

    sessions ||--o{ audio_files : "ä¸€å°å¤š(å¯é¸)<br/>ç´”ç­†è¨˜æ¨¡å¼ç„¡éŸ³æª”"
    sessions ||--o{ transcript_segments : "ä¸€å°å¤š(å¯é¸)<br/>ç´”ç­†è¨˜æ¨¡å¼ç„¡é€å­—ç¨¿"
    sessions ||--o| transcripts : "ä¸€å°ä¸€(å¯é¸)<br/>ç´”ç­†è¨˜æ¨¡å¼ç„¡é€å­—ç¨¿"
    sessions ||--|| notes : "ä¸€å°ä¸€(å¿…é ˆ)<br/>æ‰€æœ‰æœƒè©±éƒ½æœ‰ç­†è¨˜"
```

### 5. å‰ç«¯ç‹€æ…‹ç®¡ç†

**å‰ç«¯æ‡‰ç”¨ç‹€æ…‹ (AppState)**ï¼š
```typescript
type AppState = 
  | 'default'           // é è¨­ç•«é¢ï¼šå¯å¯«ç­†è¨˜ï¼Œé¡¯ç¤ºéŒ„éŸ³æŒ‰éˆ•
  | 'recording_waiting' // éŒ„éŸ³ä¸­ï¼Œå°šæœªæ”¶åˆ°é€å­—ç¨¿
  | 'recording_active'  // éŒ„éŸ³ä¸­ï¼Œå·²æ”¶åˆ°é€å­—ç¨¿ä¸¦å³æ™‚é¡¯ç¤º
  | 'processing'        // è™•ç†ç•«é¢ï¼šåœæ­¢éŒ„éŸ³å¾Œï¼Œè™•ç†å‰©é¤˜é€å­—ç¨¿
  | 'finished'          // å®Œæ•´é€å­—ç¨¿ç•«é¢ï¼šå¯ç·¨è¼¯ç­†è¨˜ã€åŒ¯å‡ºã€é–‹æ–°ç­†è¨˜
```

**ç‹€æ…‹è½‰æ›è¦å‰‡**ï¼š
```
default â†’ recording_waiting           // æŒ‰ä¸‹éŒ„éŸ³æŒ‰éˆ•
recording_waiting â†’ recording_active  // æ”¶åˆ°ç¬¬ä¸€æ®µé€å­—ç¨¿
recording_active â†’ processing         // æŒ‰ä¸‹åœæ­¢éŒ„éŸ³
processing â†’ finished                 // é€å­—ç¨¿è™•ç†å®Œæˆ
finished â†’ default                    // æŒ‰ä¸‹ New note
default â†’ finished                    // ç´”ç­†è¨˜æ¨¡å¼ç›´æ¥å®Œæˆï¼ˆæœªä¾†åŠŸèƒ½ï¼‰
```

**å„ç‹€æ…‹åŠŸèƒ½å°ç…§**ï¼š

| ç‹€æ…‹              | ç­†è¨˜ç·¨è¼¯ | éŒ„éŸ³åŠŸèƒ½ | é€å­—ç¨¿é¡¯ç¤º | åŒ¯å‡ºåŠŸèƒ½ | ç‰¹æ®ŠåŠŸèƒ½   |
| ----------------- | -------- | -------- | ---------- | -------- | ---------- |
| default           | âœ… å¯ç·¨è¼¯ | âœ… å¯é–‹å§‹ | âŒ ç„¡       | âŒ ç„¡     | draft æš«å­˜ |
| recording_waiting | âœ… å¯ç·¨è¼¯ | âœ… å¯åœæ­¢ | â³ ç­‰å¾…ä¸­   | âŒ ç„¡     | è¨ˆæ™‚å™¨     |
| recording_active  | âœ… å¯ç·¨è¼¯ | âœ… å¯åœæ­¢ | âœ… å³æ™‚é¡¯ç¤º | âŒ ç„¡     | éŸ³æª”ä¸Šå‚³   |
| processing        | âŒ é–å®š   | âŒ ç„¡     | âœ… æ›´æ–°ä¸­   | âŒ ç„¡     | ç­‰å¾…å‹•ç•«   |
| finished          | âœ… å¯ç·¨è¼¯ | âŒ ç„¡     | âœ… å®Œæ•´é¡¯ç¤º | âœ… å¯åŒ¯å‡º | New note   |

**å¾Œç«¯ Session ç‹€æ…‹å°æ‡‰**ï¼š

| å‰ç«¯ç‹€æ…‹          | å¾Œç«¯ Session Status | Session Type        | èªªæ˜                           |
| ----------------- | ------------------- | ------------------- | ------------------------------ |
| default           | draft               | note_only           | è‰ç¨¿ç‹€æ…‹ï¼Œå°šæœªæ­£å¼å»ºç«‹ session |
| default (å·²å»ºç«‹)  | active              | note_only           | ç´”ç­†è¨˜ session                 |
| recording_waiting | active              | recording           | éŒ„éŸ³ä¸­ï¼Œå°šæœªæ”¶åˆ°é€å­—ç¨¿         |
| recording_active  | active              | recording           | éŒ„éŸ³ä¸­ï¼Œå·²æ”¶åˆ°é€å­—ç¨¿ä¸¦å³æ™‚é¡¯ç¤º |
| processing        | active              | recording           | éŒ„éŸ³çµæŸï¼Œè½‰éŒ„è™•ç†ä¸­           |
| finished          | completed           | note_only/recording | å¯åŒ¯å‡ºå®Œæ•´è³‡æ–™                 |

### 6. Azure OpenAI æ•´åˆæ¶æ§‹ (REST API ç°¡åŒ–ç‰ˆ)

**æŠ€è¡“é¸æ“‡ç†ç”±**ï¼š
- âœ… **ä¼æ¥­ç´šå“è³ª**ï¼šAzure OpenAI æä¾›ç©©å®šçš„ Whisper æ¨¡å‹æœå‹™
- âœ… **å¤šèªè¨€æ”¯æ´**ï¼šå„ªç§€çš„ä¸­æ–‡èªéŸ³è­˜åˆ¥æº–ç¢ºåº¦
- âœ… **API æ•´åˆ**ï¼šæ¨™æº– OpenAI SDKï¼Œé–‹ç™¼ç°¡å–®
- âœ… **è³‡æ–™å®‰å…¨**ï¼šMicrosoft æä¾›ä¼æ¥­ç´šè³‡æ–™ä¿è­·
- âœ… **æ¶æ§‹ç°¡åŒ–**ï¼šä½¿ç”¨å®Œæ•´ 10s æª”æ¡ˆï¼Œæé«˜æˆåŠŸç‡

**å·¥ä½œæµç¨‹**ï¼š
```
å‰ç«¯éŒ„éŸ³ (10s WebM) â†’ REST API ä¸Šå‚³å®Œæ•´æª”æ¡ˆ â†’ å„²å­˜åˆ° R2 â†’ 
FFmpeg è½‰æ› â†’ Azure OpenAI Whisper API â†’ WebSocket æ¨é€è½‰éŒ„çµæœ
```

---

## 8. ä½¿ç”¨å ´æ™¯èˆ‡ç‹€æ…‹æµç¨‹

### å ´æ™¯ 1ï¼šç´”ç­†è¨˜æ¨¡å¼ï¼ˆä¸éŒ„éŸ³ï¼‰

- **ç›®æ¨™**ï¼šè®“ä½¿ç”¨è€…èƒ½å¿«é€Ÿé–‹å§‹åšç­†è¨˜ï¼Œç„¡éœ€é€²è¡Œç¹ç‘£çš„è¨­å®šã€‚
- **æµç¨‹**ï¼š
  1. **é€²å…¥é é¢**ï¼šä½¿ç”¨è€…æ‰“é–‹æ‡‰ç”¨ï¼Œçœ‹åˆ°é è¨­ç•«é¢ï¼ˆ`default` ç‹€æ…‹ï¼‰ã€‚
  2. **è¼¸å…¥å…§å®¹**ï¼š
     - åœ¨ `MarkdownEditor` ä¸­è¼¸å…¥ç­†è¨˜ï¼Œå…§å®¹æš«å­˜æ–¼ `localStorage`ï¼ˆ`draft_note`ï¼‰ã€‚
  3. **å»ºç«‹æœƒè©±**ï¼š
     - ä½¿ç”¨è€…é¦–æ¬¡è¼¸å…¥æ™‚ï¼Œè‡ªå‹•è§¸ç™¼ `createNoteSession()`ï¼Œåœ¨å¾Œç«¯å»ºç«‹ä¸€å€‹ `note_only` é¡å‹çš„ sessionã€‚
     - æˆåŠŸå¾Œï¼Œ`useAutoSave` hook å•Ÿå‹•ï¼Œæ¯ 10 ç§’å°‡ç­†è¨˜å…§å®¹åŒæ­¥åˆ°å¾Œç«¯ã€‚
  4. **å®Œæˆç­†è¨˜**ï¼š
     - ä½¿ç”¨è€…å¯ä»¥éš¨æ™‚é›¢é–‹ï¼Œç­†è¨˜å·²å„²å­˜ã€‚
     - ï¼ˆæœªä¾†åŠŸèƒ½ï¼‰å¯æ‰‹å‹•é»æ“Šã€Œå®Œæˆã€ï¼Œå°‡ session ç‹€æ…‹æ”¹ç‚º `completed`ã€‚

```mermaid
graph TD
    A((ä½¿ç”¨è€…é€²å…¥é é¢)) --> B[é è¨­ç•«é¢<br/>default ç‹€æ…‹]
    
    B --> C[è¼¸å…¥ç­†è¨˜å…§å®¹]
    
    C --> D[æš«å­˜è‡³ localStorage<br/>draft_note]
    
    D --> E{é¦–æ¬¡è¼¸å…¥ï¼Ÿ}
    
    E -->|æ˜¯| F[è‡ªå‹•è§¸ç™¼<br/>createNoteSession]
    E -->|å¦| G[ç¹¼çºŒç·¨è¼¯]
    
    F --> H[å»ºç«‹ note_only<br/>é¡å‹ session]
    
    H --> I[å•Ÿå‹• useAutoSave hook]
    
    I --> J[æ¯ 10 ç§’åŒæ­¥<br/>ç­†è¨˜è‡³å¾Œç«¯]
    
    G --> J
    J --> K[ä½¿ç”¨è€…é›¢é–‹<br/>ç­†è¨˜å·²å„²å­˜]
    J --> L[æ‰‹å‹•é»æ“Šå®Œæˆ<br/>æœªä¾†åŠŸèƒ½]
    
    L --> M[session ç‹€æ…‹<br/>æ”¹ç‚º completed]
    
    %% æ¨£å¼å®šç¾©
    classDef startEndStyle fill:#e8f5e8,stroke:#4caf50,stroke-width:3px,color:#000
    classDef processStyle fill:#e3f2fd,stroke:#2196f3,stroke-width:2px,color:#000
    classDef decisionStyle fill:#fff3e0,stroke:#ff9800,stroke-width:2px,color:#000
    classDef dataStyle fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,color:#000
    classDef autoStyle fill:#e8f5e8,stroke:#4caf50,stroke-width:2px,color:#000
    classDef futureStyle fill:#f5f5f5,stroke:#9e9e9e,stroke-width:2px,color:#666,stroke-dasharray: 5 5
    
    %% æ‡‰ç”¨æ¨£å¼
    class A,K startEndStyle
    class B,C,F,H,I processStyle
    class E decisionStyle
    class D,J dataStyle
    class G autoStyle
    class L,M futureStyle

```

### å ´æ™¯ 2ï¼šå…ˆç­†è¨˜å¾ŒéŒ„éŸ³

- **ç›®æ¨™**ï¼šå…è¨±ä½¿ç”¨è€…åœ¨å·²æœ‰ç­†è¨˜çš„åŸºç¤ä¸Šï¼Œéš¨æ™‚é–‹å§‹éŒ„éŸ³ã€‚
- **æµç¨‹**ï¼š
  1. **é–‹å§‹ç­†è¨˜**ï¼šåŒã€Œå ´æ™¯ 1ã€ï¼Œä½¿ç”¨è€…å·²å»ºç«‹ä¸€å€‹ `note_only` æœƒè©±ä¸¦æœ‰ä¸€äº›ç­†è¨˜å…§å®¹ã€‚
  2. **é»æ“ŠéŒ„éŸ³**ï¼šä½¿ç”¨è€…é»æ“Š `RecordButton`ã€‚
  3. **å‡ç´šæœƒè©±**ï¼š
     - å‘¼å« `upgradeToRecording()`ï¼Œå°‡å¾Œç«¯ session type å¾ `note_only` æ”¹ç‚º `recording`ã€‚
     - å‰ç«¯ç‹€æ…‹å¾ `default` è½‰ç‚º `recording_waiting`ã€‚
  4. **é–‹å§‹éŒ„éŸ³**ï¼šåŒã€Œå ´æ™¯ 3ã€çš„éŒ„éŸ³æµç¨‹ã€‚

### å ´æ™¯ 3ï¼šé‚ŠéŒ„é‚Šè¨˜æ¨¡å¼

- **ç›®æ¨™**ï¼šæä¾›æœ€æ ¸å¿ƒçš„ã€ŒéŒ„éŸ³ + å³æ™‚é€å­—ç¨¿ + ç­†è¨˜ã€æ•´åˆé«”é©—ã€‚
- **æµç¨‹**ï¼š
  1. **å»ºç«‹æœƒè©±**ï¼š
     - ä½¿ç”¨è€…åœ¨ `default` ç‹€æ…‹ä¸‹ï¼Œç›´æ¥é»æ“Š `RecordButton`ã€‚
     - å‘¼å« `createRecordingSession()` å»ºç«‹ `recording` é¡å‹çš„ sessionã€‚
     - å‰ç«¯ç‹€æ…‹ç«‹å³è½‰ç‚º `recording_waiting`ã€‚
  2. **éŒ„éŸ³èˆ‡ä¸Šå‚³**ï¼š
     - `MediaRecorder` é–‹å§‹éŒ„éŸ³ï¼Œä½¿ç”¨ `timeslice=10000`ï¼Œæ¯ 10 ç§’ç”¢ç”Ÿä¸€å€‹å®Œæ•´ WebM æª”æ¡ˆã€‚
     - `ondataavailable` äº‹ä»¶è§¸ç™¼ï¼Œä½¿ç”¨ `fetch` POST åˆ° `/api/segment` ä¸Šå‚³æª”æ¡ˆã€‚
     - å¾Œç«¯ç«‹å³å›æ‡‰ `{"ack": seq}`ï¼Œå‰ç«¯è™•ç†éŒ¯èª¤æ™‚æš«å­˜åˆ° IndexedDBã€‚
  3. **å³æ™‚é€å­—ç¨¿**ï¼š
     - `ws_transcript_feed` WebSocket é€£ç·šå»ºç«‹ã€‚
     - å¾Œç«¯æ”¶åˆ°æª”æ¡ˆå¾Œï¼Œåœ¨èƒŒæ™¯åŸ·è¡Œ FFmpeg è½‰æ› + Whisper API è½‰éŒ„ã€‚
     - Whisper API è¿”å›è½‰éŒ„çµæœï¼Œå¾Œç«¯é€é WebSocket æ¨é€çµ¦å‰ç«¯ã€‚
     - `TranscriptPane` æ¯ 10 ç§’æ”¶åˆ°ä¸€æ‰¹é€å­—ç¨¿ç‰‡æ®µã€‚
  4. **åŒæ­¥ç­†è¨˜**ï¼š
     - ä½¿ç”¨è€…å¯ä»¥åœ¨ `MarkdownEditor` ä¸­éš¨æ™‚è¼¸å…¥ç­†è¨˜ï¼Œ`useAutoSave` æœƒå®šæœŸå„²å­˜ã€‚
  5. **åœæ­¢éŒ„éŸ³**ï¼š
     - ä½¿ç”¨è€…é»æ“Š `RecordButton` (æ­¤æ™‚ç‚ºåœæ­¢åœ–ç¤º)ã€‚
     - `stopRecording()` è¢«å‘¼å«ï¼Œ`MediaRecorder` åœæ­¢ã€‚
     - å‰ç«¯ç‹€æ…‹è½‰ç‚º `processing`ã€‚
  6. **ç­‰å¾…è½‰éŒ„å®Œæˆ**ï¼š
     - `ProcessingOverlay` é¡¯ç¤ºï¼Œé–å®šç·¨è¼¯å€ã€‚
     - å¾Œç«¯è™•ç†å‰©é¤˜çš„éŸ³æª”åˆ‡ç‰‡ï¼Œä¸¦å°‡æœ€å¾Œçš„é€å­—ç¨¿æ¨é€å›ä¾†ã€‚
  7. **å®Œæˆ**ï¼š
     - ç•¶å¾Œç«¯æ¨é€ `transcript_complete` è¨Šæ¯æ™‚ï¼Œå‰ç«¯ç‹€æ…‹è½‰ç‚º `finished`ã€‚
     - `ProcessingOverlay` æ¶ˆå¤±ï¼Œä½¿ç”¨è€…å¯ä»¥æª¢è¦–å®Œæ•´é€å­—ç¨¿ã€ç·¨è¼¯ç­†è¨˜ã€ä¸¦åŒ¯å‡ºã€‚
  8. **åŒ¯å‡ºèˆ‡æ–°ç­†è¨˜**ï¼š
     - `ExportButton` å¯ç”¨ï¼Œé»æ“Šä¸‹è¼‰åŒ…å« `.mp4`ã€`transcript.txt` å’Œ `note.md` çš„ ZIP æª”ã€‚
     - `NewNoteButton` å¯ç”¨ï¼Œé»æ“Šæ¸…ç©ºç•¶å‰ç•«é¢ï¼Œå›åˆ° `default` ç‹€æ…‹ï¼Œé–‹å§‹æ–°çš„ç­†è¨˜ã€‚


# END FILE CONTENTS


# File: frontend/components/waiting-state.tsx

"use client"

import { Loader2 } from "lucide-react"

export function WaitingState() {
  return (
    <div className="h-full flex flex-col items-center justify-center p-6 space-y-4">
      <Loader2 className="w-8 h-8 animate-spin text-muted-foreground" />
      <div className="text-center">
        <div className="text-lg font-medium text-foreground">Transcription in progress,</div>
        <div className="text-lg font-medium text-foreground">please wait.</div>
      </div>
    </div>
  )
}


# END FILE CONTENTS


# File: frontend/hooks/use-recording-new.ts

"use client"

import { useState, useCallback, useRef, useEffect } from 'react'
import { useAppStateContext } from './use-app-state-context'
import { isFeatureEnabled } from '../lib/feature-flags'
import { SERVICE_KEYS, serviceContainer } from '../lib/services'
import type { IRecordingService, ITranscriptService, TranscriptMessage } from '../lib/services'

interface UseRecordingNewReturn {
  isRecording: boolean
  recordingTime: number
  transcripts: TranscriptMessage[]
  transcriptCompleted: boolean
  error: string | null
  startRecording: (sessionId: string) => Promise<void>
  stopRecording: () => void
  clearTranscripts: () => void
}

/**
 * useRecordingNew - éŒ„éŸ³ç®¡ç† Hook (é©é…å™¨å±¤)
 *
 * é‡æ§‹ç‚ºé©é…å™¨å±¤ï¼š
 * - å…§éƒ¨èª¿ç”¨ RecordingService å’Œ TranscriptService è€Œéç›´æ¥ç®¡ç†éŸ³é »éŒ„è£½å™¨
 * - ä¿æŒå°å¤–æ¥å£å®Œå…¨ä¸è®Šï¼Œç¢ºä¿çµ„ä»¶å±¤ç„¡æ„ŸçŸ¥è®Šæ›´
 * - ç°¡åŒ–è¤‡é›œçš„éŒ„éŸ³é‚è¼¯ï¼Œå§”è¨—çµ¦æœå‹™å±¤è™•ç†
 */
export function useRecordingNew(): UseRecordingNewReturn {
  // ä½¿ç”¨æ–°çš„ Context ç‹€æ…‹ç®¡ç†
  const context = useAppStateContext()

  // æœ¬åœ°ç‹€æ…‹ï¼ˆå°‡é€æ¼¸é·ç§»åˆ° Contextï¼‰
  const [localError, setLocalError] = useState<string | null>(null)
  const [localTranscriptCompleted, setLocalTranscriptCompleted] = useState(false)

  // æœå‹™å¼•ç”¨
  const recordingServiceRef = useRef<IRecordingService | null>(null)
  const transcriptServiceRef = useRef<ITranscriptService | null>(null)
  const currentSessionIdRef = useRef<string | null>(null)

  // å…¨åŸŸå”¯ä¸€éŒ„éŸ³è¨ˆæ™‚å™¨ - ä½¿ç”¨ useRef ä¿æŒç©©å®šå¼•ç”¨
  const recTimerRef = useRef<ReturnType<typeof setInterval> | null>(null)
  const recordingStartedAtRef = useRef<number | null>(null)

  // waitingâ†’active è¶…æ™‚ä¿éšª
  const waitingTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null)

  console.log('ğŸ”„ [useRecordingNew] Hook åˆå§‹åŒ– (é©é…å™¨å±¤)ï¼ŒåŠŸèƒ½é–‹é—œç‹€æ…‹:', {
    useNewStateManagement: isFeatureEnabled('useNewStateManagement'),
    useNewRecordingHook: isFeatureEnabled('useNewRecordingHook'),
    contextState: context.appData.state,
    contextIsRecording: context.appData.isRecording,
    contextRecordingTime: context.appData.recordingTime,
    timestamp: new Date().toISOString()
  })

  // æ¸…é™¤ waiting è¶…æ™‚
  const clearWaitingTimeout = useCallback(() => {
    if (waitingTimeoutRef.current) {
      clearTimeout(waitingTimeoutRef.current)
      waitingTimeoutRef.current = null
      console.log('â° [useRecordingNew] Waiting è¶…æ™‚å·²æ¸…é™¤')
    }
  }, [])

  // åˆå§‹åŒ–æœå‹™å¯¦ä¾‹
  const initializeServices = useCallback(() => {
    if (!recordingServiceRef.current) {
      try {
        recordingServiceRef.current = serviceContainer.resolve<IRecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
        console.log('âœ… [useRecordingNew] RecordingService åˆå§‹åŒ–æˆåŠŸ')
      } catch (error) {
        console.error('âŒ [useRecordingNew] ç„¡æ³•è§£æ RecordingService:', error)
        throw new Error('éŒ„éŸ³æœå‹™åˆå§‹åŒ–å¤±æ•—')
      }
    }

    if (!transcriptServiceRef.current) {
      try {
        transcriptServiceRef.current = serviceContainer.resolve<ITranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)
        console.log('âœ… [useRecordingNew] TranscriptService åˆå§‹åŒ–æˆåŠŸ')
      } catch (error) {
        console.error('âŒ [useRecordingNew] ç„¡æ³•è§£æ TranscriptService:', error)
        throw new Error('é€å­—ç¨¿æœå‹™åˆå§‹åŒ–å¤±æ•—')
      }
    }
  }, [])

  // è™•ç†é€å­—ç¨¿æ¥æ”¶ - æ•´åˆ Context
  const handleTranscript = useCallback((transcript: TranscriptMessage) => {
    console.log('ğŸ“ [useRecordingNew] æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯:', {
      type: transcript.type,
      text: transcript.text,
      textLength: transcript.text?.length || 0,
      start_time: transcript.start_time,
      end_time: transcript.end_time,
      start_sequence: transcript.start_sequence,
      confidence: transcript.confidence,
      sessionId: currentSessionIdRef.current,
      timestamp: new Date().toISOString(),
    })

    // è™•ç†è½‰éŒ„å®Œæˆé€šçŸ¥
    if (transcript.type === 'transcript_complete' || transcript.message === 'transcription_complete') {
      console.log('âœ… [useRecordingNew] é€å­—ç¨¿è½‰éŒ„å®Œæˆï¼Œè¨­å®š transcriptCompleted=true')
      setLocalTranscriptCompleted(true)
      return
    }

    // è™•ç† active phase è¨Šæ¯ï¼ˆé‡è¦ï¼šé€™æœƒè§¸ç™¼ç‹€æ…‹è½‰æ›ï¼‰
    if (transcript.type === 'active' || transcript.phase === 'active') {
      console.log('ğŸš€ [useRecordingNew] æ”¶åˆ° active phase è¨Šæ¯ï¼Œè½‰éŒ„é–‹å§‹')
      // æ¸…é™¤ waiting è¶…æ™‚
      clearWaitingTimeout()
      // ä½¿ç”¨ç‹€æ…‹æ©Ÿè§¸ç™¼è½‰æ›
      const result = context.transition('FIRST_TRANSCRIPT_RECEIVED')
      if (result?.success) {
        console.log('âœ… [useRecordingNew] ç‹€æ…‹æ©Ÿè½‰æ›æˆåŠŸ: recording_waiting â†’ recording_active')
      }
      return
    }

    // åªè™•ç†é€å­—ç¨¿ç‰‡æ®µé¡å‹çš„è¨Šæ¯
    if (transcript.type !== 'transcript_segment') {
      console.log('âš ï¸ [useRecordingNew] è·³ééé€å­—ç¨¿ç‰‡æ®µè¨Šæ¯:', transcript.type)
      return
    }

    if (!transcript.text) {
      console.log('âš ï¸ [useRecordingNew] è·³éç©ºæ–‡å­—é€å­—ç¨¿')
      return
    }

    console.log('ğŸ”„ [useRecordingNew] é–‹å§‹è™•ç†é€å­—ç¨¿ç‰‡æ®µ...', {
      text: transcript.text,
      textPreview: transcript.text.substring(0, 50) + '...',
      sequence: transcript.start_sequence,
      startTime: transcript.start_time,
      endTime: transcript.end_time
    })

    // ä½¿ç”¨ Context æ›´æ–°é€å­—ç¨¿ - è½‰æ›ç‚º TranscriptEntry æ ¼å¼
    const startTime = transcript.start_time ?? 0
    const hours = Math.floor(startTime / 3600)
    const minutes = Math.floor((startTime % 3600) / 60)
    const seconds = Math.floor(startTime % 60)
    const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

    const transcriptEntry = {
      time: timeStr,
      text: transcript.text ?? '',
    }

    // å¦‚æœæ˜¯ç¬¬ä¸€å€‹é€å­—ç¨¿ç‰‡æ®µä¸”ç‹€æ…‹é‚„æ˜¯ waitingï¼Œå…ˆè§¸ç™¼ç‹€æ…‹è½‰æ›
    const isFirstTranscript = context.appData.state === 'recording_waiting' && context.appData.transcriptEntries.length === 0

    context.addTranscriptEntry(transcriptEntry)
    console.log('âœ… [useRecordingNew] é€å­—ç¨¿å·²æ·»åŠ åˆ° Context')

    if (isFirstTranscript) {
      // æ¸…é™¤ waiting è¶…æ™‚
      clearWaitingTimeout()
      const result = context.transition('FIRST_TRANSCRIPT_RECEIVED')
      if (result?.success) {
        console.log('âœ… [useRecordingNew] æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿ç‰‡æ®µï¼Œç‹€æ…‹æ©Ÿè½‰æ›: recording_waiting â†’ recording_active')
      } else {
        console.warn('âš ï¸ [useRecordingNew] ç‹€æ…‹æ©Ÿè½‰æ›å¤±æ•—:', result?.error)
      }
    }
  }, [context, clearWaitingTimeout])

  // é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨æœå‹™å±¤
  const startRecording = useCallback(async (sessionId: string): Promise<void> => {
    try {
      setLocalError(null)
      context.setError(null)
      setLocalTranscriptCompleted(false)
      currentSessionIdRef.current = sessionId

      // ç«‹å³å•Ÿå‹•è¨ˆæ™‚å™¨
      if (recTimerRef.current) {
        clearInterval(recTimerRef.current)
        recTimerRef.current = null
      }
      recordingStartedAtRef.current = Date.now()
      context.setRecordingTime(0)
      recTimerRef.current = setInterval(() => {
        if (recordingStartedAtRef.current) {
          const sec = Math.floor((Date.now() - recordingStartedAtRef.current) / 1000)
          context.setRecordingTime(sec)
        }
      }, 1000)

      context.setRecording(true)
      console.log('â±ï¸ [useRecordingNew] è¨ˆæ™‚å™¨ç«‹å³å•Ÿå‹•')

      // è¨­ç½® waitingâ†’active è¶…æ™‚ä¿éšªï¼ˆ20ç§’ï¼‰
      clearWaitingTimeout()
      waitingTimeoutRef.current = setTimeout(() => {
        if (context.appData.state === 'recording_waiting') {
          console.warn('âš ï¸ [useRecordingNew] 20ç§’å…§æœªæ”¶åˆ°é€å­—ç¨¿ï¼Œå¼·åˆ¶è½‰æ›åˆ° recording_active')
          const result = context.transition('FIRST_TRANSCRIPT_RECEIVED')
          if (result?.success) {
            console.log('âœ… [useRecordingNew] è¶…æ™‚ä¿éšªè§¸ç™¼: recording_waiting â†’ recording_active')
          } else {
            console.error('âŒ [useRecordingNew] è¶…æ™‚ä¿éšªè½‰æ›å¤±æ•—:', result?.error)
          }
        }
      }, 20000)
      console.log('â° [useRecordingNew] å·²è¨­ç½® 20 ç§’ waiting è¶…æ™‚ä¿éšª')

      // åˆå§‹åŒ–æœå‹™
      initializeServices()
      const recordingService = recordingServiceRef.current!
      console.log('Recorder instance', recordingService)
      const transcriptService = transcriptServiceRef.current!

      // ç¢ºä¿å…ˆå»ºç«‹ WebSocket é€£ç·šå†è¨»å†Šç›£è½å™¨ï¼Œé¿å…æ¼æ¥è¨Šæ¯
      await transcriptService.connect(sessionId)

      // è¨­ç½®éŒ„éŸ³ç‹€æ…‹ç›£è½ï¼ˆä¿ç•™åŸæœ¬ interval ä½œç‚ºå‚™ç”¨ï¼‰
      const checkRecordingState = () => {
        const state = recordingService.getRecordingState()
        context.setRecording(state.isRecording)
        // context.setRecordingTime(state.recordingTime) // ç”± recTimer ä¸»å°
        if (state.error) {
          setLocalError(state.error)
          context.setError(state.error)
        }
      }
      const stateCheckInterval = setInterval(checkRecordingState, 1000)

      transcriptService.addTranscriptListener(sessionId, handleTranscript)
      await recordingService.startRecording(sessionId)

      const cleanup = () => {
        clearInterval(stateCheckInterval)
        transcriptService.removeTranscriptListener(sessionId, handleTranscript)
        if (recTimerRef.current) {
          clearInterval(recTimerRef.current)
          recTimerRef.current = null
          recordingStartedAtRef.current = null
          console.log('â¹ï¸ [useRecordingNew] è¨ˆæ™‚å™¨å·²æ¸…é™¤')
        }
        // æ¸…é™¤ waiting è¶…æ™‚
        clearWaitingTimeout()
      }
      (globalThis as any).currentRecordingCleanup = cleanup
      console.log('âœ… [useRecordingNew] éŒ„éŸ³é–‹å§‹æˆåŠŸ (æœå‹™å±¤)ï¼ŒSession ID:', sessionId)
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      setLocalError(errorMessage)
      context.setError(errorMessage)
      console.error('âŒ [useRecordingNew] é–‹å§‹éŒ„éŸ³å¤±æ•—:', err)
      // æ¸…é™¤ waiting è¶…æ™‚
      clearWaitingTimeout()
    }
  }, [initializeServices, handleTranscript, context, clearWaitingTimeout])

  // åœæ­¢éŒ„éŸ³ - ä½¿ç”¨æœå‹™å±¤
  const stopRecording = useCallback(() => {
    try {
      console.log('ğŸ›‘ [useRecordingNew] åœæ­¢éŒ„éŸ³ (é©é…å™¨å±¤)')
      // æ¸…é™¤ recTimer
      if (recTimerRef.current) {
        clearInterval(recTimerRef.current)
        recTimerRef.current = null
        recordingStartedAtRef.current = null
        console.log('â¹ï¸ [useRecordingNew] è¨ˆæ™‚å™¨å·²æ¸…é™¤')
      }
      // æ¸…é™¤ waiting è¶…æ™‚
      clearWaitingTimeout()
      // åŸ·è¡Œæ¸…ç†å‡½æ•¸
      const cleanup = (globalThis as any).currentRecordingCleanup
      if (cleanup) {
        cleanup()
        delete (globalThis as any).currentRecordingCleanup
      }
      // ä½¿ç”¨æœå‹™å±¤åœæ­¢éŒ„éŸ³
      const recordingService = recordingServiceRef.current
      if (recordingService) {
        recordingService.stopRecording()
      }

      // æ›´æ–° Context ç‹€æ…‹
      context.setRecording(false)

      console.log('âœ… [useRecordingNew] éŒ„éŸ³åœæ­¢æˆåŠŸ (æœå‹™å±¤)ï¼Œç­‰å¾…è½‰éŒ„å®Œæˆ')

    } catch (err) {
      console.error('âŒ [useRecordingNew] åœæ­¢éŒ„éŸ³å¤±æ•—:', err)
      const errorMessage = 'åœæ­¢éŒ„éŸ³æ™‚ç™¼ç”ŸéŒ¯èª¤'
      setLocalError(errorMessage)
      context.setError(errorMessage)
    }
  }, [context, clearWaitingTimeout])

  // æ¸…ç©ºé€å­—ç¨¿ - æ•´åˆ Context
  const clearTranscripts = useCallback(() => {
    context.setTranscriptEntries([])
    setLocalTranscriptCompleted(false)
    console.log('ğŸ”„ [useRecordingNew] é€å­—ç¨¿å·²æ¸…é™¤ (é©é…å™¨å±¤)')
  }, [context])

  // æ¸…ç†è³‡æº
  useEffect(() => {
    return () => {
      // æ¸…ç†é€å­—ç¨¿ç›£è½å™¨
      if (currentSessionIdRef.current && transcriptServiceRef.current) {
        transcriptServiceRef.current.removeTranscriptListener(currentSessionIdRef.current, handleTranscript)
      }

      // æ¸…ç†éŒ„éŸ³ç‹€æ…‹æª¢æŸ¥
      const cleanup = (globalThis as any).currentRecordingCleanup
      if (cleanup) {
        cleanup()
        delete (globalThis as any).currentRecordingCleanup
      }

      // æ¸…ç†è¨ˆæ™‚å™¨
      if (recTimerRef.current) {
        clearInterval(recTimerRef.current)
        recTimerRef.current = null
        recordingStartedAtRef.current = null
        console.log('ğŸ”š [useRecordingNew] useEffect cleanup: è¨ˆæ™‚å™¨å·²æ¸…é™¤')
      }

      // æ¸…ç† waiting è¶…æ™‚
      clearWaitingTimeout()
    }
  }, [handleTranscript, clearWaitingTimeout])

  // çµ„ä»¶çœŸæ­£å¸è¼‰æ™‚çš„æ¸…ç†ï¼ˆä¾‹å¦‚é é¢åˆ‡æ›ï¼‰
  useEffect(() => {
    const handleUnload = () => {
      console.log('ğŸ”š [useRecordingNew] é é¢å¸è¼‰ï¼Œæ¸…ç†æ‰€æœ‰è³‡æº (é©é…å™¨å±¤)')
      const cleanup = (globalThis as any).currentRecordingCleanup
      if (cleanup) {
        cleanup()
        delete (globalThis as any).currentRecordingCleanup
      }

      const recordingService = recordingServiceRef.current
      if (recordingService) {
        recordingService.stopRecording()
      }
    }

    window.addEventListener('beforeunload', handleUnload)
    return () => {
      window.removeEventListener('beforeunload', handleUnload)
    }
  }, [])

  // è½‰æ› TranscriptMessage[] ç‚ºå‘å¾Œç›¸å®¹æ ¼å¼
  const compatibleTranscripts: TranscriptMessage[] = context.appData.transcriptEntries.map((entry, index) => ({
    type: 'transcript_segment',
    text: entry.text,
    start_time: 0, // ç°¡åŒ–è™•ç†ï¼Œå¯¦éš›æ‡‰è©²å¾ time å­—ä¸²è§£æ
    end_time: 0,
    start_sequence: index,
    confidence: 1.0,
    timestamp: Date.now(),
  }))

  // è¿”å›ä»‹é¢ä¿æŒèˆ‡èˆŠç‰ˆç›¸å®¹
  return {
    isRecording: context.appData.isRecording,
    recordingTime: context.appData.recordingTime,
    transcripts: compatibleTranscripts,
    transcriptCompleted: localTranscriptCompleted,
    error: context.error || localError,
    startRecording,
    stopRecording,
    clearTranscripts,
  }
}


# END FILE CONTENTS


# File: frontend/.env.example

# StudyScriber Frontend Environment Variables
# è¤‡è£½æ­¤æ–‡ä»¶ç‚º .env.local ä¸¦å¡«å…¥å¯¦éš›çš„é…ç½®å€¼

# å¾Œç«¯ API åŸºç¤ URL
NEXT_PUBLIC_API_URL=http://127.0.0.1:8000

# WebSocket åŸºç¤ URL
NEXT_PUBLIC_WS_URL=ws://127.0.0.1:8000

# é–‹ç™¼æ¨¡å¼é…ç½®
NODE_ENV=development

# éŸ³è¨Šåˆ‡ç‰‡é–“éš”é…ç½® (å½±éŸ¿å‰ç«¯éŒ„éŸ³é–“éš”ï¼Œéœ€èˆ‡å¾Œç«¯ä¿æŒä¸€è‡´)
# æ–¹æ³•ä¸€ï¼šç›´æ¥è¨­å®šæ¯«ç§’æ•¸ (å„ªå…ˆç´šè¼ƒé«˜)
# NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_MS=10000

# æ–¹æ³•äºŒï¼šè¨­å®šç§’æ•¸ (æœƒè‡ªå‹•è½‰æ›ç‚ºæ¯«ç§’)
NEXT_PUBLIC_AUDIO_CHUNK_INTERVAL_SEC=10

# å¦‚æœéƒ½æœªè¨­å®šï¼Œé è¨­ç‚º 10 ç§’ (10000ms)
# å»ºè­°å€¼ï¼š5-30ç§’ï¼Œéœ€èˆ‡å¾Œç«¯ AUDIO_CHUNK_DURATION_SEC ä¿æŒä¸€è‡´


# END FILE CONTENTS


# File: app/ws/__init__.py

"""
WebSocket æ¨¡çµ„

æä¾›å³æ™‚éŸ³è¨Šä¸Šå‚³å’Œé€å­—ç¨¿æ¨é€åŠŸèƒ½
"""

"""app.ws package åˆå§‹åŒ–æª”

é¿å…åœ¨ import æ™‚é€ æˆå¾ªç’°ä¾è³´ï¼Œæš«ä¸ä¸»å‹•è¼‰å…¥ upload_audioã€‚éœ€è¦æ™‚è«‹ç›´æ¥å¾ `app.ws.upload_audio` å°å…¥ç›®æ¨™ã€‚"""

__all__ = []


# END FILE CONTENTS


# File: frontend/components/ui/sheet.tsx

"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}


# END FILE CONTENTS


# File: app/schemas/session.py

"""
StudyScriber Session Pydantic æ¨¡å‹

å®šç¾©æœƒè©±ç›¸é—œçš„è«‹æ±‚å’ŒéŸ¿æ‡‰æ¨¡å‹
"""
import enum
from datetime import datetime
from typing import Optional
from uuid import UUID
from pydantic import BaseModel, Field, ConfigDict

class SessionType(str, enum.Enum):
    """æœƒè©±é¡å‹"""
    NOTE_ONLY = "note_only"
    RECORDING = "recording"

class SessionStatus(str, enum.Enum):
    """æœƒè©±ç‹€æ…‹"""
    ACTIVE = "active"
    COMPLETED = "completed"
    ERROR = "error"

class LanguageCode(str, enum.Enum):
    """æ”¯æ´çš„èªè¨€ä»£ç¢¼"""
    ZH_TW = "zh-TW"
    EN_US = "en-US"


class SessionCreateRequest(BaseModel):
    """å»ºç«‹æœƒè©±è«‹æ±‚"""
    title: Optional[str] = Field(None, max_length=150, description="æœƒè©±æ¨™é¡Œ")
    type: SessionType = Field(SessionType.NOTE_ONLY, description="æœƒè©±é¡å‹")
    language: LanguageCode = Field(LanguageCode.ZH_TW, description="èªè¨€è¨­å®š")
    stt_provider: Optional[str] = Field(None, description="èªéŸ³è½‰æ–‡å­— Provider ('whisper' or 'gemini')")
    content: Optional[str] = Field(None, description="åˆå§‹ç­†è¨˜å…§å®¹")
    start_ts: Optional[int] = Field(None, description="éŒ„éŸ³é–‹å§‹æ™‚é–“æˆ³ï¼ˆæ¯«ç§’ï¼‰")


class SessionOut(BaseModel):
    """æœƒè©±è¼¸å‡ºæ¨¡å‹"""
    id: UUID
    type: SessionType
    status: SessionStatus
    title: Optional[str] = None
    language: LanguageCode
    created_at: datetime
    updated_at: datetime
    completed_at: Optional[datetime] = None

    class Config:
        from_attributes = True


class SessionUpgradeRequest(BaseModel):
    """æœƒè©±å‡ç´šè«‹æ±‚ï¼ˆç´”ç­†è¨˜ â†’ éŒ„éŸ³ï¼‰"""
    language: Optional[LanguageCode] = Field(None, description="éŒ„éŸ³èªè¨€è¨­å®š")


class SessionFinishRequest(BaseModel):
    """å®Œæˆæœƒè©±è«‹æ±‚"""
    duration: Optional[int] = Field(None, ge=0, description="æœ€çµ‚éŒ„éŸ³æ™‚é•·ï¼ˆç§’ï¼‰")


class SessionStatusResponse(BaseModel):
    """æœƒè©±ç‹€æ…‹éŸ¿æ‡‰"""
    success: bool = Field(description="æ“ä½œæ˜¯å¦æˆåŠŸ")
    message: str = Field(description="å›æ‡‰è¨Šæ¯")
    session: Optional[SessionOut] = Field(None, description="æœƒè©±è³‡æ–™")


class ActiveSessionError(BaseModel):
    """æ´»èºæœƒè©±è¡çªéŒ¯èª¤"""
    model_config = ConfigDict(json_encoders={UUID: str})

    error: str = Field("active_session_exists", description="éŒ¯èª¤é¡å‹")
    message: str = Field(description="éŒ¯èª¤è¨Šæ¯")
    active_session_id: UUID = Field(description="ç›®å‰æ´»èºæœƒè©± ID")


class SessionProviderUpdateRequest(BaseModel):
    """æ›´æ–°æœƒè©± STT Provider è«‹æ±‚"""
    stt_provider: str = Field(..., description="èªéŸ³è½‰æ–‡å­— Provider ('whisper' or 'gemini')")
    
    class Config:
        json_schema_extra = {
            "example": {
                "stt_provider": "gemini"
            }
        }


# END FILE CONTENTS


# File: frontend/components/ui/input.tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }


# END FILE CONTENTS


# File: frontend/lib/services/__tests__/transcript-service.test.ts

"use client"

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { TranscriptService } from '../transcript-service'
import { transcriptManager } from '../../transcript-manager'
import type { TranscriptMessage } from '../interfaces'

// Mock transcriptManager
const mockTranscriptManager = {
    connect: vi.fn(),
    disconnect: vi.fn(),
    addListener: vi.fn(),
    removeListener: vi.fn(),
    isConnected: vi.fn(),
    getCurrentTranscripts: vi.fn(),
    clearTranscripts: vi.fn(),
    getConnectionCount: vi.fn(),
}

vi.mock('../../transcript-manager', () => ({
    transcriptManager: mockTranscriptManager
}))

describe('TranscriptService', () => {
    let transcriptService: TranscriptService

    beforeEach(() => {
        transcriptService = new TranscriptService()
        vi.clearAllMocks()
    })

    afterEach(() => {
        vi.restoreAllMocks()
    })

    describe('æœå‹™åˆå§‹åŒ–', () => {
        it('æ‡‰è©²æ­£ç¢ºåˆå§‹åŒ– TranscriptService', () => {
            expect(transcriptService).toBeDefined()
            expect(transcriptService['serviceName']).toBe('TranscriptService')
        })

        it('æ‡‰è©²æ­£ç¢ºå•Ÿå‹•å’Œåœæ­¢æœå‹™', async () => {
            await transcriptService.start()
            expect(transcriptService['isRunning']).toBe(true)

            await transcriptService.stop()
            expect(transcriptService['isRunning']).toBe(false)
        })
    })

    describe('connect', () => {
        const sessionId = 'test-session-id'

        it('æ‡‰è©²æˆåŠŸé€£æ¥é€å­—ç¨¿æœå‹™', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await transcriptService.connect(sessionId)

            expect(mockTranscriptManager.connect).toHaveBeenCalledWith(sessionId)
            expect(transcriptService['connectedSessions'].has(sessionId)).toBe(true)
        })

        it('æ‡‰è©²è™•ç†é€£æ¥å¤±æ•—', async () => {
            const connectError = new Error('Connection failed')
            mockTranscriptManager.connect.mockRejectedValue(connectError)

            await expect(transcriptService.connect(sessionId))
                .rejects.toThrow('Connection failed')

            expect(transcriptService['connectedSessions'].has(sessionId)).toBe(false)
        })

        it('æ‡‰è©²è™•ç†é‡è¤‡é€£æ¥è«‹æ±‚', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            // é¦–æ¬¡é€£æ¥
            await transcriptService.connect(sessionId)

            // é‡è¤‡é€£æ¥ï¼ˆæ‡‰è©²è¢«å¿½ç•¥ï¼‰
            await transcriptService.connect(sessionId)

            expect(mockTranscriptManager.connect).toHaveBeenCalledTimes(1)
        })

        it('æ‡‰è©²æ”¯æ´å¤šå€‹æœƒè©±åŒæ™‚é€£æ¥', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await transcriptService.connect('session-1')
            await transcriptService.connect('session-2')

            expect(transcriptService['connectedSessions'].has('session-1')).toBe(true)
            expect(transcriptService['connectedSessions'].has('session-2')).toBe(true)
            expect(mockTranscriptManager.connect).toHaveBeenCalledTimes(2)
        })
    })

    describe('disconnect', () => {
        const sessionId = 'test-session-id'

        beforeEach(async () => {
            // Setup connected state
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            await transcriptService.connect(sessionId)
        })

        it('æ‡‰è©²æˆåŠŸæ–·é–‹ç‰¹å®šæœƒè©±', async () => {
            mockTranscriptManager.disconnect.mockResolvedValue(undefined)

            await transcriptService.disconnect(sessionId)

            expect(mockTranscriptManager.disconnect).toHaveBeenCalledWith(sessionId)
            expect(transcriptService['connectedSessions'].has(sessionId)).toBe(false)
        })

        it('æ‡‰è©²æ–·é–‹æ‰€æœ‰æœƒè©±ï¼ˆç•¶ä¸æŒ‡å®š sessionId æ™‚ï¼‰', async () => {
            // é€£æ¥å¤šå€‹æœƒè©±
            await transcriptService.connect('session-2')
            mockTranscriptManager.disconnect.mockResolvedValue(undefined)

            await transcriptService.disconnect()

            expect(mockTranscriptManager.disconnect).toHaveBeenCalledTimes(2)
            expect(transcriptService['connectedSessions'].size).toBe(0)
        })

        it('æ‡‰è©²æ¸…ç†å°æ‡‰çš„ç›£è½å™¨', async () => {
            const callback = vi.fn()

            // æ·»åŠ ç›£è½å™¨
            transcriptService.addTranscriptListener(sessionId, callback)

            mockTranscriptManager.disconnect.mockResolvedValue(undefined)
            await transcriptService.disconnect(sessionId)

            expect(mockTranscriptManager.removeListener).toHaveBeenCalledWith(sessionId, callback)
            expect(transcriptService['sessionListeners'].has(sessionId)).toBe(false)
        })

        it('æ‡‰è©²è™•ç†æ–·é–‹ä¸å­˜åœ¨çš„æœƒè©±', async () => {
            await expect(transcriptService.disconnect('non-existent'))
                .resolves.not.toThrow()
        })

        it('æ‡‰è©²è™•ç†æ–·é–‹å¤±æ•—', async () => {
            const disconnectError = new Error('Disconnect failed')
            mockTranscriptManager.disconnect.mockRejectedValue(disconnectError)

            await expect(transcriptService.disconnect(sessionId))
                .rejects.toThrow('Disconnect failed')
        })
    })

    describe('addTranscriptListener', () => {
        const sessionId = 'test-session-id'
        const callback = vi.fn()

        it('æ‡‰è©²æˆåŠŸæ·»åŠ é€å­—ç¨¿ç›£è½å™¨', () => {
            transcriptService.addTranscriptListener(sessionId, callback)

            expect(mockTranscriptManager.addListener).toHaveBeenCalledWith(sessionId, callback)
            expect(transcriptService['sessionListeners'].get(sessionId)?.has(callback)).toBe(true)
        })

        it('æ‡‰è©²æ”¯æ´åŒä¸€æœƒè©±å¤šå€‹ç›£è½å™¨', () => {
            const callback2 = vi.fn()

            transcriptService.addTranscriptListener(sessionId, callback)
            transcriptService.addTranscriptListener(sessionId, callback2)

            const listeners = transcriptService['sessionListeners'].get(sessionId)
            expect(listeners?.has(callback)).toBe(true)
            expect(listeners?.has(callback2)).toBe(true)
            expect(listeners?.size).toBe(2)
        })

        it('æ‡‰è©²é˜²æ­¢é‡è¤‡æ·»åŠ ç›¸åŒç›£è½å™¨', () => {
            transcriptService.addTranscriptListener(sessionId, callback)
            transcriptService.addTranscriptListener(sessionId, callback)

            expect(mockTranscriptManager.addListener).toHaveBeenCalledTimes(1)
            expect(transcriptService['sessionListeners'].get(sessionId)?.size).toBe(1)
        })

        it('æ‡‰è©²è™•ç†ä¸åŒæœƒè©±çš„ç›£è½å™¨', () => {
            const callback2 = vi.fn()

            transcriptService.addTranscriptListener('session-1', callback)
            transcriptService.addTranscriptListener('session-2', callback2)

            expect(transcriptService['sessionListeners'].get('session-1')?.has(callback)).toBe(true)
            expect(transcriptService['sessionListeners'].get('session-2')?.has(callback2)).toBe(true)
        })
    })

    describe('removeTranscriptListener', () => {
        const sessionId = 'test-session-id'
        const callback = vi.fn()

        beforeEach(() => {
            transcriptService.addTranscriptListener(sessionId, callback)
        })

        it('æ‡‰è©²æˆåŠŸç§»é™¤é€å­—ç¨¿ç›£è½å™¨', () => {
            transcriptService.removeTranscriptListener(sessionId, callback)

            expect(mockTranscriptManager.removeListener).toHaveBeenCalledWith(sessionId, callback)
            expect(transcriptService['sessionListeners'].get(sessionId)?.has(callback)).toBe(false)
        })

        it('æ‡‰è©²è™•ç†ç§»é™¤ä¸å­˜åœ¨çš„ç›£è½å™¨', () => {
            const nonExistentCallback = vi.fn()

            expect(() => transcriptService.removeTranscriptListener(sessionId, nonExistentCallback))
                .not.toThrow()
        })

        it('æ‡‰è©²è™•ç†ç§»é™¤ä¸å­˜åœ¨æœƒè©±çš„ç›£è½å™¨', () => {
            expect(() => transcriptService.removeTranscriptListener('non-existent', callback))
                .not.toThrow()
        })

        it('æ‡‰è©²åœ¨ç§»é™¤æœ€å¾Œä¸€å€‹ç›£è½å™¨æ™‚æ¸…ç†æœƒè©±è¨˜éŒ„', () => {
            transcriptService.removeTranscriptListener(sessionId, callback)

            expect(transcriptService['sessionListeners'].has(sessionId)).toBe(false)
        })
    })

    describe('isConnected', () => {
        const sessionId = 'test-session-id'

        it('æ‡‰è©²å ±å‘Šæ­£ç¢ºçš„é€£æ¥ç‹€æ…‹', async () => {
            expect(transcriptService.isConnected(sessionId)).toBe(false)

            mockTranscriptManager.connect.mockResolvedValue(undefined)
            await transcriptService.connect(sessionId)

            expect(transcriptService.isConnected(sessionId)).toBe(true)

            mockTranscriptManager.disconnect.mockResolvedValue(undefined)
            await transcriptService.disconnect(sessionId)

            expect(transcriptService.isConnected(sessionId)).toBe(false)
        })

        it('æ‡‰è©²è™•ç†ä¸å­˜åœ¨çš„æœƒè©±', () => {
            expect(transcriptService.isConnected('non-existent')).toBe(false)
        })
    })

    describe('é€å­—ç¨¿æ•¸æ“šè™•ç†', () => {
        const sessionId = 'test-session-id'
        const mockTranscript: TranscriptMessage = {
            id: 'transcript-1',
            text: 'Hello world',
            timestamp: '2024-01-01T00:00:00Z',
            confidence: 0.95,
            isPartial: false,
            sessionId
        }

        it('æ‡‰è©²æ­£ç¢ºè™•ç†é€å­—ç¨¿è¨Šæ¯', () => {
            const callback = vi.fn()
            transcriptService.addTranscriptListener(sessionId, callback)

            // æ¨¡æ“¬æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯
            const listenerCall = mockTranscriptManager.addListener.mock.calls.find(
                call => call[0] === sessionId
            )
            const transcriptCallback = listenerCall?.[1]

            if (transcriptCallback) {
                transcriptCallback(mockTranscript)
            }

            expect(callback).toHaveBeenCalledWith(mockTranscript)
        })

        it('æ‡‰è©²è™•ç†éƒ¨åˆ†é€å­—ç¨¿', () => {
            const callback = vi.fn()
            const partialTranscript: TranscriptMessage = {
                ...mockTranscript,
                text: 'Hello wor...',
                isPartial: true,
                confidence: 0.7
            }

            transcriptService.addTranscriptListener(sessionId, callback)

            // æ¨¡æ“¬æ”¶åˆ°éƒ¨åˆ†é€å­—ç¨¿
            const listenerCall = mockTranscriptManager.addListener.mock.calls.find(
                call => call[0] === sessionId
            )
            const transcriptCallback = listenerCall?.[1]

            if (transcriptCallback) {
                transcriptCallback(partialTranscript)
            }

            expect(callback).toHaveBeenCalledWith(partialTranscript)
        })

        it('æ‡‰è©²æ”¯æ´å¤šå€‹ç›£è½å™¨åŒæ™‚æ¥æ”¶è¨Šæ¯', () => {
            const callback1 = vi.fn()
            const callback2 = vi.fn()

            transcriptService.addTranscriptListener(sessionId, callback1)
            transcriptService.addTranscriptListener(sessionId, callback2)

            // æ¨¡æ“¬æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯
            const listenerCalls = mockTranscriptManager.addListener.mock.calls.filter(
                call => call[0] === sessionId
            )

            listenerCalls.forEach(call => {
                const transcriptCallback = call[1]
                if (transcriptCallback) {
                    transcriptCallback(mockTranscript)
                }
            })

            expect(callback1).toHaveBeenCalledWith(mockTranscript)
            expect(callback2).toHaveBeenCalledWith(mockTranscript)
        })
    })

    describe('éŒ¯èª¤è™•ç†', () => {
        const sessionId = 'test-session-id'

        it('æ‡‰è©²è™•ç† TranscriptManager é€£æ¥éŒ¯èª¤', async () => {
            const connectionError = new Error('WebSocket connection failed')
            mockTranscriptManager.connect.mockRejectedValue(connectionError)

            await expect(transcriptService.connect(sessionId))
                .rejects.toThrow('WebSocket connection failed')

            expect(transcriptService.isConnected(sessionId)).toBe(false)
        })

        it('æ‡‰è©²è™•ç† TranscriptManager æ–·é–‹éŒ¯èª¤', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            await transcriptService.connect(sessionId)

            const disconnectError = new Error('Disconnect failed')
            mockTranscriptManager.disconnect.mockRejectedValue(disconnectError)

            await expect(transcriptService.disconnect(sessionId))
                .rejects.toThrow('Disconnect failed')
        })

        it('æ‡‰è©²åœ¨é€£æ¥å¤±æ•—æ™‚æ¸…ç†ç‹€æ…‹', async () => {
            const connectionError = new Error('Connection failed')
            mockTranscriptManager.connect.mockRejectedValue(connectionError)

            try {
                await transcriptService.connect(sessionId)
            } catch {
                // é æœŸçš„éŒ¯èª¤
            }

            expect(transcriptService['connectedSessions'].has(sessionId)).toBe(false)
        })
    })

    describe('ä¸¦ç™¼å ´æ™¯æ¸¬è©¦', () => {
        it('æ‡‰è©²è™•ç†ä¸¦ç™¼é€£æ¥è«‹æ±‚', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            const promises = [
                transcriptService.connect('session-1'),
                transcriptService.connect('session-2'),
                transcriptService.connect('session-3')
            ]

            await Promise.all(promises)

            expect(transcriptService['connectedSessions'].size).toBe(3)
            expect(mockTranscriptManager.connect).toHaveBeenCalledTimes(3)
        })

        it('æ‡‰è©²è™•ç†ä¸¦ç™¼çš„é€£æ¥å’Œæ–·é–‹æ“ä½œ', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.disconnect.mockResolvedValue(undefined)

            // é€£æ¥æœƒè©±
            await transcriptService.connect('session-1')

            const promises = [
                transcriptService.connect('session-2'),
                transcriptService.disconnect('session-1'),
                transcriptService.connect('session-3')
            ]

            await Promise.all(promises)

            expect(transcriptService['connectedSessions'].has('session-1')).toBe(false)
            expect(transcriptService['connectedSessions'].has('session-2')).toBe(true)
            expect(transcriptService['connectedSessions'].has('session-3')).toBe(true)
        })

        it('æ‡‰è©²è™•ç†å¿«é€Ÿçš„æ·»åŠ å’Œç§»é™¤ç›£è½å™¨æ“ä½œ', () => {
            const callbacks = Array.from({ length: 5 }, () => vi.fn())
            const sessionId = 'test-session'

            // å¿«é€Ÿæ·»åŠ å¤šå€‹ç›£è½å™¨
            callbacks.forEach(callback => {
                transcriptService.addTranscriptListener(sessionId, callback)
            })

            expect(transcriptService['sessionListeners'].get(sessionId)?.size).toBe(5)

            // å¿«é€Ÿç§»é™¤ç›£è½å™¨
            callbacks.forEach(callback => {
                transcriptService.removeTranscriptListener(sessionId, callback)
            })

            expect(transcriptService['sessionListeners'].has(sessionId)).toBe(false)
        })
    })

    describe('è³‡æºæ¸…ç†', () => {
        it('æ‡‰è©²åœ¨æœå‹™åœæ­¢æ™‚æ¸…ç†æ‰€æœ‰è³‡æº', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            mockTranscriptManager.disconnect.mockResolvedValue(undefined)

            // é€£æ¥å¤šå€‹æœƒè©±
            await transcriptService.connect('session-1')
            await transcriptService.connect('session-2')

            // æ·»åŠ ç›£è½å™¨
            const callback1 = vi.fn()
            const callback2 = vi.fn()
            transcriptService.addTranscriptListener('session-1', callback1)
            transcriptService.addTranscriptListener('session-2', callback2)

            // åœæ­¢æœå‹™
            await transcriptService.stop()

            // é©—è­‰è³‡æºæ¸…ç†
            expect(transcriptService['connectedSessions'].size).toBe(0)
            expect(transcriptService['sessionListeners'].size).toBe(0)
        })

        it('æ‡‰è©²è™•ç†æ¸…ç†éç¨‹ä¸­çš„éŒ¯èª¤', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)
            await transcriptService.connect('session-1')

            // æ¨¡æ“¬æ–·é–‹æ™‚ç™¼ç”ŸéŒ¯èª¤
            mockTranscriptManager.disconnect.mockRejectedValue(new Error('Cleanup error'))

            // æœå‹™åœæ­¢æ‡‰è©²ä¸æœƒæ‹‹å‡ºéŒ¯èª¤
            await expect(transcriptService.stop()).resolves.not.toThrow()
        })
    })

    describe('æœå‹™ç‹€æ…‹å ±å‘Š', () => {
        it('æ‡‰è©²å ±å‘Šæ­£ç¢ºçš„æœå‹™è³‡è¨Š', () => {
            const info = transcriptService.getServiceInfo()

            expect(info).toMatchObject({
                serviceName: 'TranscriptService',
                isInitialized: expect.any(Boolean),
                isRunning: expect.any(Boolean),
                connectedSessions: expect.any(Array),
                activeListeners: expect.any(Object),
                totalConnections: expect.any(Number)
            })
        })

        it('æ‡‰è©²æ­£ç¢ºå ±å‘Šé€£æ¥æ•¸é‡', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await transcriptService.connect('session-1')
            await transcriptService.connect('session-2')

            const info = transcriptService.getServiceInfo()

            expect(info.connectedSessions).toHaveLength(2)
            expect(info.totalConnections).toBe(2)
        })

        it('æ‡‰è©²æ­£ç¢ºå ±å‘Šç›£è½å™¨æ•¸é‡', () => {
            const callback1 = vi.fn()
            const callback2 = vi.fn()

            transcriptService.addTranscriptListener('session-1', callback1)
            transcriptService.addTranscriptListener('session-1', callback2)
            transcriptService.addTranscriptListener('session-2', callback1)

            const info = transcriptService.getServiceInfo()

            expect(info.activeListeners['session-1']).toBe(2)
            expect(info.activeListeners['session-2']).toBe(1)
        })
    })

    describe('é‚Šç•Œæ¢ä»¶æ¸¬è©¦', () => {
        it('æ‡‰è©²è™•ç†ç©ºå­—ç¬¦ä¸²æœƒè©± ID', async () => {
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await expect(transcriptService.connect('')).resolves.not.toThrow()
            expect(transcriptService.isConnected('')).toBe(true)
        })

        it('æ‡‰è©²è™•ç†ç‰¹æ®Šå­—ç¬¦çš„æœƒè©± ID', async () => {
            const specialSessionId = 'session-123!@#$%^&*()'
            mockTranscriptManager.connect.mockResolvedValue(undefined)

            await transcriptService.connect(specialSessionId)
            expect(transcriptService.isConnected(specialSessionId)).toBe(true)
        })

        it('æ‡‰è©²è™•ç† null/undefined å›èª¿å‡½æ•¸', () => {
            expect(() => transcriptService.addTranscriptListener('session', null as any))
                .not.toThrow()

            expect(() => transcriptService.addTranscriptListener('session', undefined as any))
                .not.toThrow()
        })
    })
})


# END FILE CONTENTS


# File: frontend/components/ui/carousel.tsx

"use client"

import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}


# END FILE CONTENTS


# File: app/services/stt/whisper_provider.py

from __future__ import annotations

import logging
from uuid import UUID
from typing import Any, Dict, Optional
from app.services.stt.base import ISTTProvider
from app.services.azure_whisper import AzureWhisperService
from app.services.stt.lang_map import to_whisper
from app.db.database import get_supabase_client

import json
from app.core.config import get_settings

logger = logging.getLogger(__name__)

__all__ = ["WhisperProvider", "save_and_push_result"]

class WhisperProvider(ISTTProvider):
    name = "whisper"
    _service: Optional[AzureWhisperService] = None

    def __init__(self) -> None:
        if self._service is None:
            self._service = AzureWhisperService()

    def max_rpm(self) -> int:
        # å¯æ ¹æ“šè¨­å®šèª¿æ•´
        from app.core.config import get_settings
        settings = get_settings()
        return getattr(settings, "WHISPER_MAX_REQUESTS", 180)


    async def transcribe(self, audio: bytes, session_id: UUID, chunk_seq: int) -> Dict[str, Any] | None:
        # æŸ¥è©¢ canonical lang_code
        supa = get_supabase_client()
        row = supa.table("sessions").select("lang_code").eq("id", str(session_id)).single().execute()
        canonical = (row.data or {}).get("lang_code", "zh-TW")
        api_language = to_whisper(canonical)
        return await self._service.transcribe(
            audio, session_id, chunk_seq,
            api_language=api_language,
            canonical_lang=canonical
        )

async def save_and_push_result(session_id: UUID, chunk_seq: int, data: dict):
    """å…±ç”¨ï¼šæŠŠçµæœå¯«å…¥ transcript_segments ä¸¦é€é WebSocket æ¨é€"""
    from app.ws.transcript_feed import manager
    from app.db.database import get_supabase_client

    settings = get_settings()
    supa = get_supabase_client()
    seg = {
        "session_id": str(session_id),
        "chunk_sequence": chunk_seq,
        "text": data["text"],
        "start_time": chunk_seq * settings.AUDIO_CHUNK_DURATION_SEC,
        "end_time": (chunk_seq + 1) * settings.AUDIO_CHUNK_DURATION_SEC,
        "confidence": 1.0,
        "lang_code": data["lang_code"],
    }
    row = supa.table("transcript_segments").insert(seg).execute()

    # WebSocket
    await manager.broadcast(
        json.dumps({
            "type": "transcript_segment",
            "session_id": str(session_id),
            "segment_id": row.data[0]["id"],
            **seg
        }),
        str(session_id)
    )


# END FILE CONTENTS


# File: frontend/utils/event-bus.ts

type Handler = (payload?: unknown) => void
const bus = new Map<string, Set<Handler>>()

export function on(event: string, fn: Handler) {
    (bus.get(event) ?? bus.set(event, new Set()).get(event))!.add(fn)
}
export function off(event: string, fn: Handler) {
    bus.get(event)?.delete(fn)
}
export function emit(event: string, payload?: unknown) {
    bus.get(event)?.forEach(fn => fn(payload))
}


# END FILE CONTENTS


# File: .cursor/rules/python.mdc

---
description: Python best practices and patterns for modern software development with Flask and SQLite
globs: **/*.py, src/**/*.py, tests/**/*.py
alwaysApply: false
---
<!-- Source: https://github.com/sanjeed5/awesome-cursor-rules-mdc/tree/main/rules-mdc -->

# Python Best Practices

## Project Structure
- Use src-layout with `src/your_package_name/`
- Place tests in `tests/` directory parallel to `src/`
- Keep configuration in `config/` or as environment variables
- Store requirements in `requirements.txt` or `pyproject.toml`
- Place static files in `static/` directory
- Use `templates/` for Jinja2 templates

## Code Style
- Follow Black code formatting
- Use isort for import sorting
- Follow PEP 8 naming conventions:
  - snake_case for functions and variables
  - PascalCase for classes
  - UPPER_CASE for constants
- Maximum line length of 88 characters (Black default)
- Use absolute imports over relative imports

## Type Hints
- Use type hints for all function parameters and returns
- Import types from `typing` module
- Use `Optional[Type]` instead of `Type | None`
- Use `TypeVar` for generic types
- Define custom types in `types.py`
- Use `Protocol` for duck typing

## Flask Structure
- Use Flask factory pattern
- Organize routes using Blueprints
- Use Flask-SQLAlchemy for database
- Implement proper error handlers
- Use Flask-Login for authentication
- Structure views with proper separation of concerns

## Database
- Use SQLAlchemy ORM
- Implement database migrations with Alembic
- Use proper connection pooling
- Define models in separate modules
- Implement proper relationships
- Use proper indexing strategies

## Authentication
- Use Flask-Login for session management
- Implement Google OAuth using Flask-OAuth
- Hash passwords with bcrypt
- Use proper session security
- Implement CSRF protection
- Use proper role-based access control

## API Design
- Use Flask-RESTful for REST APIs
- Implement proper request validation
- Use proper HTTP status codes
- Handle errors consistently
- Use proper response formats
- Implement proper rate limiting

## Testing
- Use pytest for testing
- Write tests for all routes
- Use pytest-cov for coverage
- Implement proper fixtures
- Use proper mocking with pytest-mock
- Test all error scenarios

## Security
- Use HTTPS in production
- Implement proper CORS
- Sanitize all user inputs
- Use proper session configuration
- Implement proper logging
- Follow OWASP guidelines

## Performance
- Use proper caching with Flask-Caching
- Implement database query optimization
- Use proper connection pooling
- Implement proper pagination
- Use background tasks for heavy operations
- Monitor application performance

## Error Handling
- Create custom exception classes
- Use proper try-except blocks
- Implement proper logging
- Return proper error responses
- Handle edge cases properly
- Use proper error messages

## Documentation
- Use Google-style docstrings
- Document all public APIs
- Keep README.md updated
- Use proper inline comments
- Generate API documentation
- Document environment setup

## Development Workflow
- Always use virtual environments (uv)
- Implement pre-commit hooks
- Use proper Git workflow
- Follow semantic versioning
- Use proper CI/CD practices
- Implement proper logging

## Dependencies
- Pin dependency versions
- Use requirements.txt for production
- Separate dev dependencies
- Use proper package versions
- Regularly update dependencies
- Check for security vulnerabilities


# END FILE CONTENTS


# File: app/core/container.py

"""
ä¸€å€‹ç°¡å–®çš„ä¾è³´æ³¨å…¥å®¹å™¨
"""
from typing import Dict, Any, Type, Callable

class Container:
    def __init__(self):
        self._providers: Dict[Type, Callable[[], Any]] = {}

    def register(self, type_hint: Type, provider: Callable[[], Any]):
        """è¨»å†Šä¸€å€‹æœå‹™æä¾›è€…"""
        self._providers[type_hint] = provider

    def resolve(self, type_hint: Type) -> Any:
        """è§£æä¸€å€‹æœå‹™å¯¦ä¾‹"""
        provider = self._providers.get(type_hint)
        if not provider:
            raise Exception(f"No provider registered for {type_hint}")
        return provider()

# å…¨åŸŸå®¹å™¨å¯¦ä¾‹
container = Container()


# END FILE CONTENTS


# File: frontend/components/ui/resizable.tsx

"use client"

import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }


# END FILE CONTENTS


# File: frontend/components/ui/toast.tsx

"use client"

import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}


# END FILE CONTENTS


# File: frontend/lib/services/index.ts

"use client"

/**
 * æœå‹™å±¤çµ±ä¸€å…¥å£
 *
 * æä¾›æœå‹™å±¤æ‰€æœ‰æ¨¡çµ„çš„çµ±ä¸€åŒ¯å‡º
 */

// åŸºç¤æœå‹™é¡åˆ¥
export { BaseService, ServiceError } from './base-service'
export type { ServiceStatus } from './base-service'

// æœå‹™å®¹å™¨
export { ServiceContainer, ServiceContainerError, serviceContainer } from './service-container'
export type {
    ServiceContainerStatus,
    ServiceInitializationResult,
    ServiceCleanupResult
} from './service-container'

// å…·é«”æœå‹™å¯¦ç¾
export { SessionService } from './session-service'
export type { SessionServiceStatus } from './session-service'

export { RecordingService } from './recording-service'
export type { RecordingServiceStatus } from './recording-service'

export { TranscriptService } from './transcript-service'

// æœå‹™è¨»å†Š
export { ServiceRegistry } from './service-registry'

// æœå‹™ä»‹é¢å’Œéµå€¼
export type {
    ISessionService,
    IRecordingService,
    ITranscriptService,
    IServiceContainer,
    RecordingState,
    TranscriptMessage,
    TranscriptEntry,
    ServiceKey,
    ServiceTypeMap
} from './interfaces'

export { SERVICE_KEYS } from './interfaces'


# END FILE CONTENTS


# File: app/utils/__init__.py

"""
å·¥å…·æ¨¡çµ„

æä¾›å„ç¨®å…±ç”¨çš„å·¥å…·å‡½æ•¸å’Œé©—è­‰å™¨
"""


# END FILE CONTENTS


# File: frontend/lib/stream/__tests__/audio-uploader.test.ts

import { describe, test, expect, beforeEach, vi, afterEach } from 'vitest'
import { AudioUploader } from '../audio-uploader'

// Mock WebSocket
class MockWebSocket {
    static CONNECTING = 0
    static OPEN = 1
    static CLOSING = 2
    static CLOSED = 3

    readyState: number = MockWebSocket.CONNECTING
    onopen: ((event: Event) => void) | null = null
    onclose: ((event: CloseEvent) => void) | null = null
    onerror: ((event: Event) => void) | null = null
    onmessage: ((event: MessageEvent) => void) | null = null

    send = vi.fn()
    close = vi.fn()

    constructor(public url: string) {
        // æ¨¡æ“¬ç•°æ­¥é€£æ¥
        setTimeout(() => {
            this.readyState = MockWebSocket.OPEN
            this.onopen?.(new Event('open'))
        }, 10)
    }

    // æ¨¡æ“¬é€£æ¥é—œé–‰
    simulateClose(wasClean: boolean = true, code: number = 1000, reason: string = '') {
        this.readyState = MockWebSocket.CLOSED
        const closeEvent = new CloseEvent('close', { wasClean, code, reason })
        this.onclose?.(closeEvent)
    }

    // æ¨¡æ“¬æ”¶åˆ°æ¶ˆæ¯
    simulateMessage(data: any) {
        const messageEvent = new MessageEvent('message', { data: JSON.stringify(data) })
        this.onmessage?.(messageEvent)
    }

    // æ¨¡æ“¬éŒ¯èª¤
    simulateError() {
        this.onerror?.(new Event('error'))
    }
}

// Mock å…¨å±€ WebSocket
Object.defineProperty(global, 'WebSocket', {
    writable: true,
    value: MockWebSocket,
})

// Mock ç’°å¢ƒè®Šæ•¸
const originalEnv = process.env
beforeEach(() => {
    process.env = { ...originalEnv }
    process.env.NEXT_PUBLIC_WS_URL = 'ws://localhost:8000'
})

afterEach(() => {
    process.env = originalEnv
})

describe('AudioUploader', () => {
    let uploader: AudioUploader
    let mockWebSocket: MockWebSocket

    beforeEach(() => {
        vi.clearAllMocks()
        uploader = new AudioUploader()

        // æ””æˆª WebSocket å‰µå»º
        const originalWebSocket = global.WebSocket
        global.WebSocket = vi.fn((url: string) => {
            mockWebSocket = new MockWebSocket(url)
            return mockWebSocket
        }) as any
    })

    afterEach(() => {
        uploader.close()
    })

    describe('é€£æ¥ç®¡ç†', () => {
        test('æ‡‰è©²æˆåŠŸå»ºç«‹ WebSocket é€£æ¥', async () => {
            const connectPromise = uploader.connect('test-session-id')

            // ç­‰å¾…é€£æ¥å®Œæˆ
            await connectPromise

            expect(uploader.isConnected).toBe(true)
            expect(uploader.currentSessionId).toBe('test-session-id')
            expect(uploader.currentSequence).toBe(0)
        })

        test('æ‡‰è©²ä½¿ç”¨æ­£ç¢ºçš„ WebSocket URL', async () => {
            await uploader.connect('test-session-id')

            expect(global.WebSocket).toHaveBeenCalledWith(
                'ws://localhost:8000/ws/upload_audio/test-session-id'
            )
        })

        test('æ‡‰è©²åœ¨é€£æ¥æ™‚é‡ç½®ç‹€æ…‹', async () => {
            // å…ˆç™¼é€ä¸€äº›æ•¸æ“šä¾†æ”¹è®Šåºè™Ÿ
            await uploader.connect('session-1')
            uploader.send(new Blob(['test']))

            expect(uploader.currentSequence).toBe(1)

            // é‡æ–°é€£æ¥æ‡‰è©²é‡ç½®
            await uploader.connect('session-2')

            expect(uploader.currentSequence).toBe(0)
            expect(uploader.currentSessionId).toBe('session-2')
        })

        test('æ‡‰è©²æ­£ç¢ºé—œé–‰é€£æ¥', () => {
            uploader.close()

            expect(uploader.isConnected).toBe(false)
            expect(uploader.currentSessionId).toBe(null)
            expect(uploader.currentSequence).toBe(0)
        })
    })

    describe('æ•¸æ“šå‚³é€', () => {
        beforeEach(async () => {
            await uploader.connect('test-session-id')
        })

        test('æ‡‰è©²æ­£ç¢ºç™¼é€éŸ³è¨Šæ•¸æ“š', () => {
            const testBlob = new Blob(['test audio data'], { type: 'audio/webm' })

            uploader.send(testBlob)

            // æ‡‰è©²ç™¼é€å…©æ¬¡ï¼šåºè™Ÿ + æ•¸æ“š
            expect(mockWebSocket.send).toHaveBeenCalledTimes(2)

            // é©—è­‰åºè™Ÿç™¼é€ï¼ˆ4 å­—ç¯€ï¼‰
            const sequenceCall = mockWebSocket.send.mock.calls[0][0]
            expect(sequenceCall).toBeInstanceOf(ArrayBuffer)
            expect(sequenceCall.byteLength).toBe(4)

            // é©—è­‰æ•¸æ“šç™¼é€
            const blobCall = mockWebSocket.send.mock.calls[1][0]
            expect(blobCall).toBe(testBlob)
        })

        test('æ‡‰è©²æ­£ç¢ºéå¢åºè™Ÿ', () => {
            const blob1 = new Blob(['audio 1'])
            const blob2 = new Blob(['audio 2'])

            uploader.send(blob1)
            uploader.send(blob2)

            expect(uploader.currentSequence).toBe(2)
            expect(mockWebSocket.send).toHaveBeenCalledTimes(4) // 2 åºè™Ÿ + 2 æ•¸æ“š
        })

        test('æ‡‰è©²æ”¯æ´è‡ªè¨‚åºè™Ÿç™¼é€', () => {
            const testBlob = new Blob(['test'])

            uploader.send(testBlob, 42)

            // å…§éƒ¨åºè™Ÿä¸æ‡‰è©²æ”¹è®Š
            expect(uploader.currentSequence).toBe(0)

            // ä½†æ‡‰è©²ç™¼é€æŒ‡å®šçš„åºè™Ÿ
            const sequenceCall = mockWebSocket.send.mock.calls[0][0]
            const view = new DataView(sequenceCall)
            expect(view.getUint32(0, false)).toBe(42) // big-endian
        })

        test('æ‡‰è©²è™•ç† WebSocket æœªé€£æ¥çš„æƒ…æ³', () => {
            mockWebSocket.readyState = MockWebSocket.CLOSED

            const testBlob = new Blob(['test'])
            uploader.send(testBlob)

            // ä¸æ‡‰è©²ç™¼é€ä»»ä½•æ•¸æ“š
            expect(mockWebSocket.send).not.toHaveBeenCalled()
        })
    })

    describe('é‡é€£æ©Ÿåˆ¶', () => {
        beforeEach(async () => {
            await uploader.connect('test-session-id')
        })

        test('æ‡‰è©²åœ¨éæ­£å¸¸é—œé–‰æ™‚å˜—è©¦é‡é€£', async () => {
            // æ¨¡æ“¬éæ­£å¸¸é—œé–‰
            mockWebSocket.simulateClose(false, 1006, 'Connection lost')

            // ç­‰å¾…é‡é€£é‚è¼¯è§¸ç™¼
            await new Promise(resolve => setTimeout(resolve, 100))

            // æ‡‰è©²å˜—è©¦é‡æ–°å‰µå»º WebSocket
            expect(global.WebSocket).toHaveBeenCalledTimes(2)
        })

        test('æ‡‰è©²åœ¨æ­£å¸¸é—œé–‰æ™‚ä¸å˜—è©¦é‡é€£', () => {
            const originalCreateWebSocket = global.WebSocket

            // æ¨¡æ“¬æ­£å¸¸é—œé–‰
            mockWebSocket.simulateClose(true, 1000, 'Normal closure')

            // ä¸æ‡‰è©²å˜—è©¦é‡é€£
            expect(global.WebSocket).toHaveBeenCalledTimes(1)
        })

        test('æ‡‰è©²æœ‰é‡é€£æ¬¡æ•¸é™åˆ¶', async () => {
            // æ¨¡æ“¬é€£çºŒå¤±æ•—çš„é‡é€£
            const originalConnect = uploader.connect
            let connectCallCount = 0

            uploader.connect = vi.fn().mockImplementation(() => {
                connectCallCount++
                if (connectCallCount <= 5) {
                    throw new Error('Connection failed')
                }
                return originalConnect.call(uploader, 'test-session-id')
            })

            // è§¸ç™¼é‡é€£
            mockWebSocket.simulateClose(false, 1006, 'Connection lost')

            // ç­‰å¾…é‡é€£å˜—è©¦
            await new Promise(resolve => setTimeout(resolve, 200))

            // æ‡‰è©²æœ‰é‡é€£æ¬¡æ•¸é™åˆ¶
            expect(connectCallCount).toBeLessThanOrEqual(5)
        })
    })

    describe('ä¼ºæœå™¨æ¶ˆæ¯è™•ç†', () => {
        beforeEach(async () => {
            await uploader.connect('test-session-id')
        })

        test('æ‡‰è©²è™•ç† ACK æ¶ˆæ¯', () => {
            const consoleSpy = vi.spyOn(console, 'log').mockImplementation(() => { })

            mockWebSocket.simulateMessage({
                type: 'ack',
                chunk_sequence: 5
            })

            expect(consoleSpy).toHaveBeenCalledWith(
                expect.stringContaining('éŸ³è¨Šåˆ‡ç‰‡ #5 ç¢ºèªæ”¶åˆ°')
            )

            consoleSpy.mockRestore()
        })

        test('æ‡‰è©²è™•ç†ä¸Šå‚³éŒ¯èª¤æ¶ˆæ¯', () => {
            const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => { })

            mockWebSocket.simulateMessage({
                type: 'upload_error',
                chunk_sequence: 3,
                error: 'Upload failed'
            })

            expect(consoleSpy).toHaveBeenCalledWith(
                expect.stringContaining('ä¸Šå‚³éŒ¯èª¤ #3'),
                'Upload failed'
            )

            consoleSpy.mockRestore()
        })

        test('æ‡‰è©²è™•ç†é€£æ¥å»ºç«‹æ¶ˆæ¯', () => {
            const consoleSpy = vi.spyOn(console, 'log').mockImplementation(() => { })

            mockWebSocket.simulateMessage({
                type: 'connection_established'
            })

            expect(consoleSpy).toHaveBeenCalledWith(
                expect.stringContaining('é€£æ¥å·²å»ºç«‹')
            )

            consoleSpy.mockRestore()
        })

        test('æ‡‰è©²è™•ç†é JSON æ¶ˆæ¯', () => {
            const consoleSpy = vi.spyOn(console, 'log').mockImplementation(() => { })

            // æ¨¡æ“¬é JSON æ•¸æ“š
            const messageEvent = new MessageEvent('message', { data: 'plain text' })
            mockWebSocket.onmessage?.(messageEvent)

            expect(consoleSpy).toHaveBeenCalledWith(
                expect.stringContaining('æ”¶åˆ°é JSON æ¶ˆæ¯'),
                'plain text'
            )

            consoleSpy.mockRestore()
        })
    })

    describe('é–‹ç™¼æ¨¡å¼è¨ºæ–·', () => {
        const originalNodeEnv = process.env.NODE_ENV

        beforeEach(async () => {
            // ä½¿ç”¨ vi.stubEnv ä¾†æ¨¡æ“¬ç’°å¢ƒè®Šæ•¸
            vi.stubEnv('NODE_ENV', 'development')
            await uploader.connect('test-session-id')

            // æ¸…é™¤ window.__rec
            delete (window as any).__rec
        })

        afterEach(() => {
            vi.unstubAllEnvs()
        })

        test('æ‡‰è©²åœ¨é–‹ç™¼æ¨¡å¼ä¸‹è¨˜éŒ„è¨ºæ–·ä¿¡æ¯', () => {
            const testBlob = new Blob(['test'], { type: 'audio/webm' })

            uploader.send(testBlob)

            expect((window as any).__rec).toBeDefined()
            expect((window as any).__rec.chunksSent).toBe(1)
            expect((window as any).__rec.totalBytes).toBe(testBlob.size)
            expect((window as any).__rec.sessionId).toBe('test-session-id')
        })

        test('æ‡‰è©²ç´¯ç©è¨ºæ–·çµ±è¨ˆ', () => {
            const blob1 = new Blob(['data1'])
            const blob2 = new Blob(['data2'])

            uploader.send(blob1)
            uploader.send(blob2)

            const rec = (window as any).__rec
            expect(rec.chunksSent).toBe(2)
            expect(rec.totalBytes).toBe(blob1.size + blob2.size)
            expect(rec.lastSequence).toBe(1)
        })
    })

    describe('é€£æ¥ç‹€æ…‹', () => {
        test('æ‡‰è©²æ­£ç¢ºå ±å‘Šé€£æ¥ç‹€æ…‹', async () => {
            expect(uploader.connectionState).toBe('NOT_CREATED')

            const connectPromise = uploader.connect('test-session-id')
            expect(uploader.connectionState).toBe('CONNECTING')

            await connectPromise
            expect(uploader.connectionState).toBe('OPEN')

            uploader.close()
            expect(uploader.connectionState).toBe('NOT_CREATED')
        })

        test('æ‡‰è©²æ­£ç¢ºæª¢æŸ¥é€£æ¥ç‹€æ…‹', async () => {
            expect(uploader.isConnected).toBe(false)

            await uploader.connect('test-session-id')
            expect(uploader.isConnected).toBe(true)

            uploader.close()
            expect(uploader.isConnected).toBe(false)
        })
    })
})


# END FILE CONTENTS


# File: pnpm-lock.yaml

lockfileVersion: '9.0'

settings:
  autoInstallPeers: true
  excludeLinksFromLockfile: false

importers:

  .:
    devDependencies:
      '@playwright/test':
        specifier: ^1.54.1
        version: 1.54.1
      jszip:
        specifier: ^3.10.1
        version: 3.10.1

packages:

  '@playwright/test@1.54.1':
    resolution: {integrity: sha512-FS8hQ12acieG2dYSksmLOF7BNxnVf2afRJdCuM1eMSxj6QTSE6G4InGF7oApGgDb65MX7AwMVlIkpru0yZA4Xw==}
    engines: {node: '>=18'}
    hasBin: true

  core-util-is@1.0.3:
    resolution: {integrity: sha512-ZQBvi1DcpJ4GDqanjucZ2Hj3wEO5pZDS89BWbkcrvdxksJorwUDDZamX9ldFkp9aw2lmBDLgkObEA4DWNJ9FYQ==}

  fsevents@2.3.2:
    resolution: {integrity: sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==}
    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}
    os: [darwin]

  immediate@3.0.6:
    resolution: {integrity: sha512-XXOFtyqDjNDAQxVfYxuF7g9Il/IbWmmlQg2MYKOH8ExIT1qg6xc4zyS3HaEEATgs1btfzxq15ciUiY7gjSXRGQ==}

  inherits@2.0.4:
    resolution: {integrity: sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==}

  isarray@1.0.0:
    resolution: {integrity: sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==}

  jszip@3.10.1:
    resolution: {integrity: sha512-xXDvecyTpGLrqFrvkrUSoxxfJI5AH7U8zxxtVclpsUtMCq4JQ290LY8AW5c7Ggnr/Y/oK+bQMbqK2qmtk3pN4g==}

  lie@3.3.0:
    resolution: {integrity: sha512-UaiMJzeWRlEujzAuw5LokY1L5ecNQYZKfmyZ9L7wDHb/p5etKaxXhohBcrw0EYby+G/NA52vRSN4N39dxHAIwQ==}

  pako@1.0.11:
    resolution: {integrity: sha512-4hLB8Py4zZce5s4yd9XzopqwVv/yGNhV1Bl8NTmCq1763HeK2+EwVTv+leGeL13Dnh2wfbqowVPXCIO0z4taYw==}

  playwright-core@1.54.1:
    resolution: {integrity: sha512-Nbjs2zjj0htNhzgiy5wu+3w09YetDx5pkrpI/kZotDlDUaYk0HVA5xrBVPdow4SAUIlhgKcJeJg4GRKW6xHusA==}
    engines: {node: '>=18'}
    hasBin: true

  playwright@1.54.1:
    resolution: {integrity: sha512-peWpSwIBmSLi6aW2auvrUtf2DqY16YYcCMO8rTVx486jKmDTJg7UAhyrraP98GB8BoPURZP8+nxO7TSd4cPr5g==}
    engines: {node: '>=18'}
    hasBin: true

  process-nextick-args@2.0.1:
    resolution: {integrity: sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==}

  readable-stream@2.3.8:
    resolution: {integrity: sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==}

  safe-buffer@5.1.2:
    resolution: {integrity: sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==}

  setimmediate@1.0.5:
    resolution: {integrity: sha512-MATJdZp8sLqDl/68LfQmbP8zKPLQNV6BIZoIgrscFDQ+RsvK/BxeDQOgyxKKoh0y/8h3BqVFnCqQ/gd+reiIXA==}

  string_decoder@1.1.1:
    resolution: {integrity: sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==}

  util-deprecate@1.0.2:
    resolution: {integrity: sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==}

snapshots:

  '@playwright/test@1.54.1':
    dependencies:
      playwright: 1.54.1

  core-util-is@1.0.3: {}

  fsevents@2.3.2:
    optional: true

  immediate@3.0.6: {}

  inherits@2.0.4: {}

  isarray@1.0.0: {}

  jszip@3.10.1:
    dependencies:
      lie: 3.3.0
      pako: 1.0.11
      readable-stream: 2.3.8
      setimmediate: 1.0.5

  lie@3.3.0:
    dependencies:
      immediate: 3.0.6

  pako@1.0.11: {}

  playwright-core@1.54.1: {}

  playwright@1.54.1:
    dependencies:
      playwright-core: 1.54.1
    optionalDependencies:
      fsevents: 2.3.2

  process-nextick-args@2.0.1: {}

  readable-stream@2.3.8:
    dependencies:
      core-util-is: 1.0.3
      inherits: 2.0.4
      isarray: 1.0.0
      process-nextick-args: 2.0.1
      safe-buffer: 5.1.2
      string_decoder: 1.1.1
      util-deprecate: 1.0.2

  safe-buffer@5.1.2: {}

  setimmediate@1.0.5: {}

  string_decoder@1.1.1:
    dependencies:
      safe-buffer: 5.1.2

  util-deprecate@1.0.2: {}


# END FILE CONTENTS


# File: frontend/hooks/use-session.ts

"use client"

import { useState, useCallback, useMemo } from 'react'
import axios from 'axios'
import { sessionAPI, type SessionCreateRequest, type SessionResponse } from '../lib/api'

interface UseSessionReturn {
    currentSession: SessionResponse | null
    isLoading: boolean
    error: string | null
    createNoteSession: (title?: string, content?: string) => Promise<SessionResponse | null>
    createRecordingSession: (title?: string, content?: string, lang_code?: string, stt_provider?: string) => Promise<SessionResponse | null>
    upgradeToRecording: () => Promise<SessionResponse | null>
    finishSession: () => Promise<void>
    deleteSession: () => Promise<void>
    clearSession: () => void
    checkActiveSession: () => Promise<SessionResponse | null>
}

export function useSession(): UseSessionReturn {
    const [currentSession, setCurrentSession] = useState<SessionResponse | null>(null)
    const [isLoading, setIsLoading] = useState(false)
    const [error, setError] = useState<string | null>(null)

    const clearError = useCallback(() => {
        setError(null)
    }, [])

    const checkActiveSession = useCallback(async (): Promise<SessionResponse | null> => {
        setIsLoading(true)
        clearError()

        try {
            const activeSession = await sessionAPI.getActiveSession()
            if (activeSession) {
                setCurrentSession(activeSession)
                console.log('âœ… å·²æ¢å¾©æ´»èºæœƒè©±ç‹€æ…‹:', activeSession)
                return activeSession
            } else {
                console.log('â„¹ï¸ æ²’æœ‰æ´»èºæœƒè©±ï¼Œä½¿ç”¨é è¨­ç‹€æ…‹')
                return null
            }
        } catch (err) {
            // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œä¸”æ˜¯åˆå§‹åŒ–éšæ®µï¼Œå‰‡éœé»˜è™•ç†
            if (err instanceof Error && err.message.includes('Network Error')) {
                console.warn('âš ï¸ Backend API é€£ç·šæš«æ™‚å¤±æ•—ï¼Œå°‡åœ¨å¾ŒçºŒé‡è©¦:', err.message)
                return null // éœé»˜å¤±æ•—ï¼Œä¸è¨­ç½®éŒ¯èª¤ç‹€æ…‹
            }

            const errorMessage = err instanceof Error ? err.message : 'æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ æª¢æŸ¥æ´»èºæœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            setIsLoading(false)
        }
    }, [clearError])
    const createNoteSession = useCallback(async (title?: string, content?: string): Promise<SessionResponse | null> => {
        setIsLoading(true)
        clearError()

        try {
            const sessionData: SessionCreateRequest = {
                title,
                type: 'note_only',
                content,
            }

            const session = await sessionAPI.createSession(sessionData)
            setCurrentSession(session)
            console.log('âœ… ç´”ç­†è¨˜æœƒè©±å»ºç«‹æˆåŠŸ:', session)
            return session
        } catch (err) {
            // ç‰¹åˆ¥è™•ç† 409 è¡çªéŒ¯èª¤
            if (axios.isAxiosError(err) && err.response?.status === 409) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                setError(conflictMessage)
                console.error('âŒ æœƒè©±è¡çªéŒ¯èª¤ (409):', err.response?.data?.detail || err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹æœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å»ºç«‹ç´”ç­†è¨˜æœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            setIsLoading(false)
        }
    }, [clearError])

    const createRecordingSession = useCallback(async (title?: string, content?: string, lang_code?: string, stt_provider?: string): Promise<SessionResponse | null> => {
        setIsLoading(true)
        clearError()

        try {
            const sessionData: SessionCreateRequest = {
                title,
                type: 'recording',
                content,
                lang_code,
                stt_provider,
            }

            const session = await sessionAPI.createSession(sessionData)
            setCurrentSession(session)
            console.log('âœ… éŒ„éŸ³æœƒè©±å»ºç«‹æˆåŠŸ:', session)
            return session
        } catch (err) {
            // ç‰¹åˆ¥è™•ç† 409 è¡çªéŒ¯èª¤
            if (axios.isAxiosError(err) && err.response?.status === 409) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                setError(conflictMessage)
                console.error('âŒ æœƒè©±è¡çªéŒ¯èª¤ (409):', err.response?.data?.detail || err.message)
                return null
            }

            const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            setIsLoading(false)
        }
    }, [clearError])

    const upgradeToRecording = useCallback(async (): Promise<SessionResponse | null> => {
        if (!currentSession) {
            setError('æ²’æœ‰æ´»èºçš„æœƒè©±å¯ä»¥å‡ç´š')
            return null
        }

        if (currentSession.type === 'recording') {
            console.log('ğŸ”„ æœƒè©±å·²ç¶“æ˜¯éŒ„éŸ³æ¨¡å¼')
            return currentSession
        }

        setIsLoading(true)
        clearError()

        try {
            const updatedSession = await sessionAPI.upgradeToRecording(currentSession.id)
            setCurrentSession(updatedSession)
            console.log('âœ… æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼æˆåŠŸ:', updatedSession)
            return updatedSession
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å‡ç´šæœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å‡ç´šæœƒè©±å¤±æ•—:', err)
            return null
        } finally {
            setIsLoading(false)
        }
    }, [currentSession, clearError])

    const finishSession = useCallback(async (): Promise<void> => {
        if (!currentSession) {
            console.log('ğŸ”„ æ²’æœ‰æ´»èºçš„æœƒè©±éœ€è¦å®Œæˆ')
            return
        }

        setIsLoading(true)
        clearError()

        try {
            await sessionAPI.finishSession(currentSession.id)
            console.log('âœ… æœƒè©±å®ŒæˆæˆåŠŸ:', currentSession.id)
            // ä¿æŒ session è³‡æ–™ï¼Œåªæ›´æ–°ç‹€æ…‹
            setCurrentSession((prev: SessionResponse | null) => prev ? { ...prev, status: 'completed' } : null)
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å®Œæˆæœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å®Œæˆæœƒè©±å¤±æ•—:', err)
        } finally {
            setIsLoading(false)
        }
    }, [currentSession, clearError])

    const deleteSession = useCallback(async (): Promise<void> => {
        if (!currentSession) {
            console.log('ğŸ”„ æ²’æœ‰æ´»èºçš„æœƒè©±éœ€è¦åˆªé™¤')
            return
        }

        setIsLoading(true)
        clearError()

        try {
            await sessionAPI.deleteSession(currentSession.id)
            console.log('âœ… æœƒè©±åˆªé™¤æˆåŠŸ:', currentSession.id)
            setCurrentSession(null)
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'åˆªé™¤æœƒè©±å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ åˆªé™¤æœƒè©±å¤±æ•—:', err)
        } finally {
            setIsLoading(false)
        }
    }, [currentSession, clearError])

    const clearSession = useCallback(() => {
        setCurrentSession(null)
        setError(null)
        console.log('ğŸ”„ æœƒè©±å·²æ¸…é™¤')
    }, [])

    return useMemo(() => ({
        currentSession,
        isLoading,
        error,
        createNoteSession,
        createRecordingSession,
        upgradeToRecording,
        finishSession,
        deleteSession,
        clearSession,
        checkActiveSession,
    }), [
        currentSession,
        isLoading,
        error,
        createNoteSession,
        createRecordingSession,
        upgradeToRecording,
        finishSession,
        deleteSession,
        clearSession,
        checkActiveSession,
    ])
}


# END FILE CONTENTS


# File: frontend/lib/__tests__/migration-adapter.test.ts

import { describe, test, expect, beforeEach, vi } from 'vitest'
import { StateSyncBridge } from '../migration-adapter'
import { AppStateContextValue } from '../../types/app-state-context'
import { LegacyAppStateHook } from '../migration-adapter'

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
}
Object.defineProperty(window, 'localStorage', { value: localStorageMock })

describe('StateSyncBridge', () => {
    let bridge: StateSyncBridge
    let mockNewContext: AppStateContextValue
    let mockLegacyHook: LegacyAppStateHook

    beforeEach(() => {
        bridge = new StateSyncBridge()

        // Mock new context
        mockNewContext = {
            appData: {
                state: 'default',
                transcriptEntries: [],
                editorContent: '',
                isRecording: false,
                recordingTime: 0,
                session: null,
            },
            isLoading: false,
            error: null,
            dispatch: vi.fn(),
            setState: vi.fn(),
            setRecording: vi.fn(),
            setRecordingTime: vi.fn(),
            setEditorContent: vi.fn(),
            setTranscriptEntries: vi.fn(),
            addTranscriptEntry: vi.fn(),
            setSession: vi.fn(),
            updateSessionStatus: vi.fn(),
            resetState: vi.fn(),
            setLoading: vi.fn(),
            setError: vi.fn(),
        }

        // Mock legacy hook
        mockLegacyHook = {
            appData: {
                state: 'default',
                transcriptEntries: [],
                editorContent: '',
                isRecording: false,
                recordingTime: 0,
                session: null,
            },
            isLoading: false,
            error: null,
            startRecording: vi.fn(),
            stopRecording: vi.fn(),
            newNote: vi.fn(),
            saveLocalDraft: vi.fn(),
            session: null,
            recordingError: null,
            transcriptError: null,
            createNoteSession: vi.fn(),
            sessionLoading: false,
        }
    })

    test('should register new context successfully', () => {
        bridge.registerNewContext(mockNewContext)
        expect(bridge.getSyncStatus().enabled).toBe(true)
    })

    test('should register legacy hook successfully', () => {
        bridge.registerLegacyHook(mockLegacyHook)
        expect(bridge.getSyncStatus().enabled).toBe(true)
    })

    test('should enable and disable sync', () => {
        bridge.disableSync()
        expect(bridge.getSyncStatus().enabled).toBe(false)

        bridge.enableSync()
        expect(bridge.getSyncStatus().enabled).toBe(true)
    })

    test('should provide sync status', () => {
        const status = bridge.getSyncStatus()
        expect(status).toHaveProperty('enabled')
        expect(status).toHaveProperty('lastSync')
        expect(status).toHaveProperty('inProgress')
    })
})


# END FILE CONTENTS


# File: frontend/components/ui/sonner.tsx

"use client"

import { useTheme } from "next-themes"
import { Toaster as Sonner } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster }


# END FILE CONTENTS


# File: frontend/components.json

{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}

# END FILE CONTENTS


# File: frontend/components/ui/skeleton.tsx

import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }


# END FILE CONTENTS


# File: .cursor/rules/playwright-e2e-testing.mdc

---
alwaysApply: false
---

<!-- Source: https://github.com/PatrickJS/awesome-cursorrules/blob/main/rules/playwright-e2e-testing-cursorrules-prompt-file/.cursorrules -->

# Auto-detect TypeScript Usage

Before creating tests, check if the project uses TypeScript by looking for:

- tsconfig.json file
- .ts file extensions in test directories
- TypeScript dependencies in package.json
  Adjust file extensions (.ts/.js) and syntax based on this detection.

# End-to-End UI Testing Focus

Generate tests that focus on critical user flows (e.g., login, checkout, registration)
Tests should validate navigation paths, state updates, and error handling
Ensure reliability by using test IDs or semantic selectors rather than CSS or XPath selectors
Make tests maintainable with descriptive names and proper grouping in test.describe blocks
Use Playwright's page.route for API mocking to create isolated, deterministic tests

# Best Practices

**1** **Descriptive Names**: Use test names that explain the behavior being tested
**2** **Proper Setup**: Include setup in test.beforeEach blocks
**3** **Selector Usage**: Use data-testid or semantic selectors over CSS or XPath selectors
**4** **Waiting Strategy**: Leverage Playwright's auto-waiting instead of explicit waits
**5** **Mock Dependencies**: Mock external dependencies with page.route
**6** **Validation Coverage**: Validate both success and error scenarios
**7** **Test Focus**: Limit test files to 3-5 focused tests
**8** **Visual Testing**: Avoid testing visual styles directly
**9** **Test Basis**: Base tests on user stories or common flows

# Input/Output Expectations

**Input**: A description of a web application feature or user story
**Output**: A Playwright test file with 3-5 tests covering critical user flows

# Example End-to-End Test

When testing a login page, implement the following pattern:

```js
import { test, expect } from '@playwright/test';

test.describe('Login Page', () => {
  test.beforeEach(async ({ page }) => {
    await page.route('/api/login', (route) => {
      const body = route.request().postDataJSON();
      if (body.username === 'validUser' && body.password === 'validPass') {
        route.fulfill({
          status: 200,
          body: JSON.stringify({ message: 'Login successful' }),
        });
      } else {
        route.fulfill({
          status: 401,
          body: JSON.stringify({ error: 'Invalid credentials' }),
        });
      }
    });
    await page.goto('/login');
  });

  test('should allow user to log in with valid credentials', async ({
    page,
  }) => {
    await page.locator('[data-testid="username"]').fill('validUser');
    await page.locator('[data-testid="password"]').fill('validPass');
    await page.locator('[data-testid="submit"]').click();
    await expect(page.locator('[data-testid="welcome-message"]')).toBeVisible();
    await expect(page.locator('[data-testid="welcome-message"]')).toHaveText(
      /Welcome, validUser/
    );
  });

  test('should show an error message for invalid credentials', async ({
    page,
  }) => {
    await page.locator('[data-testid="username"]').fill('invalidUser');
    await page.locator('[data-testid="password"]').fill('wrongPass');
    await page.locator('[data-testid="submit"]').click();
    await expect(page.locator('[data-testid="error-message"]')).toBeVisible();
    await expect(page.locator('[data-testid="error-message"]')).toHaveText(
      'Invalid credentials'
    );
  });
});
```


# END FILE CONTENTS


# File: frontend/hooks/use-app-state.ts

"use client"

import { useState, useCallback, useEffect, useRef } from "react"
import type { AppData, AppState, SessionStatus, SessionType } from "../types/app-state"
import { useSession } from "./use-session"
import { useRecording } from "./use-recording"
import { useNotes } from "./use-notes"
import { useTranscript } from "./use-transcript"
import { TranscriptMessage } from "../lib/websocket"
import { useToast } from "@/components/ui/use-toast"

// å‰å¾Œç«¯ç‹€æ…‹æ˜ å°„è¦å‰‡
const mapBackendToFrontendState = (
  status: SessionStatus,
  type: SessionType,
  isRecording: boolean,
  transcriptsPresent: boolean
): AppState => {
  const timestamp = Date.now()
  const isoTimestamp = new Date().toISOString()

  console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] è¼¸å…¥åƒæ•¸ (è©³ç´°æ™‚åº):', {
    status,
    type,
    isRecording,
    transcriptsPresent,
    timestamp,
    isoTimestamp,
    note: 'æª¢æŸ¥æ™‚åºå’Œé‚è¼¯æµç¨‹'
  })

  let resultState: AppState

  // è©³ç´°çš„ç‹€æ…‹è½‰æ›é‚è¼¯å’Œæ™‚åºè¿½è¹¤
  switch (status) {
    case "draft":
      resultState = "default"
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] draft â†’ default (æ™‚åºæ­£å¸¸)')
      break
    case "active":
      if (type === "recording") {
        if (!isRecording) {
          resultState = "default"
          console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] recording session ä½† isRecording=false â†’ default (æ™‚åºæª¢æŸ¥é€šé)', {
            timestamp,
            reason: 'recording session inactive'
          })
        } else {
          // é—œéµçš„ç‹€æ…‹è½‰æ›é‚è¼¯ï¼šrecording_waiting â†’ recording_active
          if (transcriptsPresent) {
            resultState = "recording_active"
            console.log(`ğŸ”„ [ç‹€æ…‹æ˜ å°„] âœ… é—œéµè½‰æ›: recording_waiting â†’ recording_active (æ™‚åºæˆåŠŸ)`, {
              transcriptsPresent,
              timestamp,
              trigger: 'first_transcript_received'
            })
          } else {
            resultState = "recording_waiting"
            console.log(`ğŸ”„ [ç‹€æ…‹æ˜ å°„] ä¿æŒ recording_waiting ç‹€æ…‹ (ç­‰å¾…é€å­—ç¨¿)`, {
              transcriptsPresent,
              timestamp,
              waiting: 'for_first_transcript'
            })
          }
        }
      } else {
        resultState = "default"
        console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] active session ä½† type != recording â†’ default', {
          type,
          timestamp
        })
      }
      break
    case "processing":
      resultState = "processing"
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] processing â†’ processing (æ™‚åºæ­£å¸¸)', { timestamp })
      break
    case "completed":
      resultState = "finished"
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] completed â†’ finished (æ™‚åºæ­£å¸¸)', { timestamp })
      break
    case "error":
      resultState = "default" // éŒ¯èª¤æ™‚å›åˆ°é è¨­ç‹€æ…‹
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] error â†’ default (éŒ¯èª¤æ¢å¾©)', {
        timestamp,
        recovery: true
      })
      break
    default:
      resultState = "default"
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] unknown â†’ default (å®‰å…¨å›é€€)', {
        unknownStatus: status,
        timestamp
      })
      break
  }

  console.log(`ğŸ”„ [ç‹€æ…‹æ˜ å°„] æœ€çµ‚çµæœ (æ™‚åºè¿½è¹¤): ${status}(${type}) â†’ ${resultState}`, {
    inputParams: { status, type, isRecording, transcriptsPresent },
    output: resultState,
    timestamp,
    duration: Date.now() - timestamp
  })

  return resultState
}

export function useAppState() {
  const [appData, setAppData] = useState<AppData>({
    state: "default",
    transcriptEntries: [],
    editorContent: "",
    isRecording: false,
    recordingTime: 0,
    session: null,
  })

  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  // ä½¿ç”¨å„å€‹å°ˆé–€çš„ hooks
  const session = useSession()
  const recording = useRecording()
  const notes = useNotes()
  const transcript = useTranscript()
  const { toast } = useToast()

  // ä½¿ç”¨ useRef è¿½è¹¤å‰ä¸€å€‹ç‹€æ…‹å€¼ï¼Œé¿å…å¾ªç’°ä¾è³´
  const prevStateRef = useRef<AppState>('default')
  const prevTranscriptCompletedRef = useRef(false)
  const prevErrorStateRef = useRef<{ recording: string | null, transcript: string | null }>({
    recording: null,
    transcript: null
  })

  // å„ªåŒ–çš„ç‹€æ…‹æ˜ å°„å‡½æ•¸ï¼Œç¢ºä¿æ™‚åºå¯é æ¸¬æ€§
  const mapStateFromSession = useCallback((
    currentSession: any,
    isRecording: boolean,
    transcripts: any[]
  ) => {
    const executionTimestamp = Date.now()

    if (!currentSession) {
      console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] ç„¡æ´»èºæœƒè©± â†’ default', { executionTimestamp })
      return 'default'
    }

    // å¯¦ä½œæ›´å¯é çš„ transcriptsPresent è¨ˆç®—
    const transcriptsPresent = Array.isArray(transcripts) && transcripts.length > 0

    console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] åŸ·è¡Œæ™‚åºæª¢æŸ¥:', {
      sessionId: currentSession.id,
      sessionStatus: currentSession.status,
      sessionType: currentSession.type,
      isRecording,
      transcriptCount: transcripts.length,
      transcriptsPresent,
      executionTimestamp,
      transcriptsSample: transcripts.slice(0, 2).map(t => ({
        text: t.text?.substring(0, 30) + '...',
        start_time: t.start_time,
        type: t.type
      })),
      note: 'æ™‚åºåŒæ­¥æª¢æŸ¥å®Œæˆ'
    })

    const result = mapBackendToFrontendState(
      currentSession.status,
      currentSession.type,
      isRecording,
      transcriptsPresent
    )

    console.log('ğŸ”„ [ç‹€æ…‹æ˜ å°„] åŸ·è¡Œçµæœ:', {
      input: {
        sessionStatus: currentSession.status,
        sessionType: currentSession.type,
        isRecording,
        transcriptsPresent
      },
      output: result,
      executionTimestamp,
      executionDuration: Date.now() - executionTimestamp
    })

    return result
  }, [])

  // ç‹€æ…‹åŒæ­¥ï¼šå‰ç«¯ç‹€æ…‹èˆ‡å¾Œç«¯ session status å°æ‡‰ - å¼·åŒ–ä¸€è‡´æ€§
  useEffect(() => {
    const activeSession = session.currentSession
    const effectExecutionTime = Date.now()

    console.log('ğŸ”„ [ç‹€æ…‹åŒæ­¥] useEffect è§¸ç™¼ (å¼·åŒ–ä¸€è‡´æ€§ç‰ˆ):', {
      hasActiveSession: !!activeSession,
      sessionId: activeSession?.id,
      sessionStatus: activeSession?.status,
      sessionType: activeSession?.type,
      recordingIsRecording: recording.isRecording,
      appDataIsRecording: appData.isRecording,
      isRecordingConsistent: recording.isRecording === appData.isRecording,
      transcriptCount: transcript.transcripts.length,
      recordingTranscriptCount: recording.transcripts.length,
      currentAppState: prevStateRef.current,
      effectExecutionTime,
      note: 'å¼·åŒ–éŒ„éŸ³ç‹€æ…‹ä¸€è‡´æ€§æª¢æŸ¥'
    })

    if (activeSession) {
      // ç¢ºä¿ä½¿ç”¨æœ€æ–°çš„ recording.transcripts ç‹€æ…‹
      const latestTranscripts = recording.transcripts
      const transcriptsPresent = Array.isArray(latestTranscripts) && latestTranscripts.length > 0

      console.log('ğŸ”„ [ç‹€æ…‹åŒæ­¥] é€å­—ç¨¿ç‹€æ…‹è¨ˆç®— (æ™‚åºä¿è­‰):', {
        recordingTranscriptCount: latestTranscripts.length,
        transcriptsPresent,
        latestTranscriptTime: latestTranscripts[latestTranscripts.length - 1]?.start_time,
        latestTranscriptText: latestTranscripts[latestTranscripts.length - 1]?.text?.substring(0, 30) + '...',
        effectExecutionTime,
        note: 'å·²ç¢ºä¿æ™‚åºåŒæ­¥'
      })

      // é—œéµä¿®å¾©ï¼šå¼·åˆ¶ä½¿ç”¨ recording.isRecording è€Œä¸æ˜¯ appData.isRecording
      // é€™ç¢ºä¿ç‹€æ…‹æ˜ å°„é‚è¼¯ä½¿ç”¨æœ€æ–°çš„éŒ„éŸ³ç‹€æ…‹
      const frontendState = mapStateFromSession(
        activeSession,
        recording.isRecording, // ç›´æ¥ä½¿ç”¨ recording hook çš„ç‹€æ…‹
        latestTranscripts
      )

      // æª¢æŸ¥æ˜¯å¦éœ€è¦åŒæ™‚æ›´æ–° isRecording å’Œ state
      const needsIsRecordingUpdate = appData.isRecording !== recording.isRecording
      const needsStateUpdate = frontendState !== prevStateRef.current

      if (needsIsRecordingUpdate || needsStateUpdate) {
        console.log(`ğŸ”„ [ç‹€æ…‹åŒæ­¥] åŸ·è¡Œç‹€æ…‹æ›´æ–°:`, {
          needsIsRecordingUpdate,
          needsStateUpdate,
          appDataIsRecording: appData.isRecording,
          recordingIsRecording: recording.isRecording,
          previousState: prevStateRef.current,
          newState: frontendState,
          stateChangeTimestamp: Date.now(),
          executionDuration: Date.now() - effectExecutionTime,
          triggerSource: 'comprehensive_state_sync'
        })

        setAppData(prev => ({
          ...prev,
          state: frontendState,
          isRecording: recording.isRecording, // åŒæ™‚å¼·åˆ¶åŒæ­¥ isRecording
        }))

        prevStateRef.current = frontendState
      } else {
        console.log('ğŸ”„ [ç‹€æ…‹åŒæ­¥] æ‰€æœ‰ç‹€æ…‹ä¸€è‡´ï¼Œè·³éæ›´æ–°', {
          currentState: frontendState,
          isRecording: recording.isRecording,
          executionTime: Date.now() - effectExecutionTime
        })
      }
    }
  }, [session.currentSession, recording.isRecording, recording.transcripts, mapStateFromSession])
  // ä¾è³´æ–¼ recording.transcripts è€Œé lengthï¼Œç¢ºä¿å…§å®¹è®ŠåŒ–æ™‚è§¸ç™¼ç‹€æ…‹åŒæ­¥

  // åˆå§‹åŒ–æ‡‰ç”¨ç‹€æ…‹ - åªåœ¨çµ„ä»¶æ›è¼‰æ™‚åŸ·è¡Œä¸€æ¬¡
  useEffect(() => {
    let isMounted = true

    const initializeApp = async () => {
      console.log('ğŸš€ åˆå§‹åŒ–æ‡‰ç”¨ç‹€æ…‹...')
      setIsLoading(true)

      try {
        // æª¢æŸ¥æ˜¯å¦æœ‰æ´»èºæœƒè©±
        const activeSession = await session.checkActiveSession()
        if (!isMounted) return // çµ„ä»¶å·²å¸è¼‰ï¼Œåœæ­¢åŸ·è¡Œ

        if (activeSession) {
          // è¼‰å…¥ç­†è¨˜å…§å®¹
          await notes.loadNote(activeSession.id)
        } else {
          // æª¢æŸ¥æ˜¯å¦æœ‰æœ¬åœ°è‰ç¨¿
          const draftContent = localStorage.getItem('draft_note')
          if (draftContent) {
            setAppData(prev => ({ ...prev, editorContent: draftContent }))
            console.log('ğŸ“ è¼‰å…¥æœ¬åœ°è‰ç¨¿')
          }
        }
      } catch (error) {
        if (!isMounted) return // çµ„ä»¶å·²å¸è¼‰ï¼Œåœæ­¢åŸ·è¡Œ

        // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œä¸è¦æ‹‹å‡ºéŒ¯èª¤ï¼Œè®“ç”¨æˆ¶æ­£å¸¸ä½¿ç”¨æ‡‰ç”¨
        if (error instanceof Error && error.message.includes('Network Error')) {
          console.warn('âš ï¸ åˆå§‹åŒ–æ™‚ Backend é€£ç·šå¤±æ•—ï¼Œä½¿ç”¨é›¢ç·šæ¨¡å¼:', error.message)

          // æª¢æŸ¥æ˜¯å¦æœ‰æœ¬åœ°è‰ç¨¿
          const draftContent = localStorage.getItem('draft_note')
          if (draftContent) {
            setAppData(prev => ({ ...prev, editorContent: draftContent }))
            console.log('ğŸ“ é›¢ç·šæ¨¡å¼ï¼šè¼‰å…¥æœ¬åœ°è‰ç¨¿')
          }
        } else {
          console.error('âŒ åˆå§‹åŒ–å¤±æ•—:', error)
          setError(error instanceof Error ? error.message : 'åˆå§‹åŒ–å¤±æ•—')
        }
      } finally {
        if (isMounted) {
          setIsLoading(false)
        }
      }
    }

    initializeApp()

    return () => {
      isMounted = false
    }
  }, []) // ç©ºä¾è³´é …ï¼Œåªåœ¨çµ„ä»¶æ›è¼‰æ™‚åŸ·è¡Œä¸€æ¬¡

  // åŒæ­¥éŒ„éŸ³ç‹€æ…‹ - å¼·åŒ–ä¸€è‡´æ€§æª¢æŸ¥
  useEffect(() => {
    console.log('ğŸ”„ [éŒ„éŸ³ç‹€æ…‹åŒæ­¥] æ›´æ–° appData.isRecording:', {
      from: appData.isRecording,
      to: recording.isRecording,
      recordingTime: recording.recordingTime,
      timestamp: Date.now(),
      needsUpdate: appData.isRecording !== recording.isRecording
    })

    // å¼·åˆ¶åŒæ­¥éŒ„éŸ³ç‹€æ…‹ï¼Œç¢ºä¿ä¸€è‡´æ€§
    setAppData(prev => {
      const needsUpdate = prev.isRecording !== recording.isRecording || prev.recordingTime !== recording.recordingTime

      if (needsUpdate) {
        console.log('ğŸ”„ [éŒ„éŸ³ç‹€æ…‹åŒæ­¥] åŸ·è¡Œç‹€æ…‹æ›´æ–°:', {
          prevIsRecording: prev.isRecording,
          newIsRecording: recording.isRecording,
          prevRecordingTime: prev.recordingTime,
          newRecordingTime: recording.recordingTime
        })
      }

      return {
        ...prev,
        isRecording: recording.isRecording,
        recordingTime: recording.recordingTime,
      }
    })
  }, [recording.isRecording, recording.recordingTime])

  // ç§»é™¤é‡è¤‡çš„ç‹€æ…‹ä¸€è‡´æ€§æª¢æŸ¥ï¼Œå·²æ•´åˆåˆ°ä¸»è¦ç‹€æ…‹åŒæ­¥é‚è¼¯ä¸­

  // åŒæ­¥ç­†è¨˜å…§å®¹
  useEffect(() => {
    setAppData(prev => ({
      ...prev,
      editorContent: notes.noteContent,
    }))
  }, [notes.noteContent])

  // è™•ç†é€å­—ç¨¿æ›´æ–° - çµ±ä¸€ä½¿ç”¨ recording.transcripts
  useEffect(() => {
    console.log('ğŸ“ [é€å­—ç¨¿æ›´æ–°] useEffect è§¸ç™¼:', {
      recordingTranscriptCount: recording.transcripts.length,
      recordingTranscripts: recording.transcripts,
      currentState: appData.state,
      isRecording: appData.isRecording,
      note: 'çµ±ä¸€ä½¿ç”¨ recording.transcriptsï¼Œé¿å…é›™é‡ç®¡ç†'
    })

    const transcriptEntries = recording.transcripts.map((transcriptMsg: TranscriptMessage) => {
      // ä½¿ç”¨ start_time ä¸¦è½‰æ›ç‚º HH:MM:SS æ ¼å¼
      const startTime = transcriptMsg.start_time ?? 0
      const hours = Math.floor(startTime / 3600)
      const minutes = Math.floor((startTime % 3600) / 60)
      const seconds = Math.floor(startTime % 60)
      const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

      console.log('ğŸ“ [é€å­—ç¨¿è½‰æ›] å–®å€‹ç‰‡æ®µ:', {
        text: transcriptMsg.text,
        timeStr,
        startTime,
        type: transcriptMsg.type
      })

      return {
        time: timeStr,
        text: transcriptMsg.text ?? '',
      }
    })

    console.log('ğŸ“ [é€å­—ç¨¿æ›´æ–°] è½‰æ›å®Œæˆ:', {
      entriesCount: transcriptEntries.length,
      entries: transcriptEntries,
      firstEntry: transcriptEntries[0]?.text?.substring(0, 30) + '...',
      appDataBefore: appData.transcriptEntries
    })

    setAppData(prev => {
      console.log('ğŸ“ [é€å­—ç¨¿æ›´æ–°] setAppData åŸ·è¡Œ:', {
        prevTranscriptEntries: prev.transcriptEntries,
        newTranscriptEntries: transcriptEntries,
        isChanged: prev.transcriptEntries !== transcriptEntries
      })
      return {
        ...prev,
        transcriptEntries,
      }
    })
  }, [recording.transcripts])

  // ç›£è½è½‰éŒ„å®Œæˆï¼Œè‡ªå‹•è½‰ç‚º finished ç‹€æ…‹
  useEffect(() => {
    const currentCompleted = transcript.isCompleted
    const wasCompleted = prevTranscriptCompletedRef.current

    // åªåœ¨è½‰éŒ„ç‹€æ…‹å¾ false è®Šç‚º true æ™‚è™•ç†
    if (currentCompleted && !wasCompleted && prevStateRef.current === "processing") {
      console.log('ğŸ”„ [è½‰éŒ„å®Œæˆ] è½‰éŒ„å®Œæˆï¼Œè½‰ç‚º finished ç‹€æ…‹')

      setAppData(prev => {
        const newState = "finished"
        prevStateRef.current = newState
        return { ...prev, state: newState }
      })

      // å®Œæˆæœƒè©±
      if (session.currentSession) {
        session.finishSession().catch(console.error)
      }
    }

    prevTranscriptCompletedRef.current = currentCompleted
  }, [
    transcript.isCompleted,
    session.currentSession,
    session.finishSession
  ])

  // ç›£è½éŒ„éŸ³å’Œè½‰éŒ„éŒ¯èª¤ï¼Œè™•ç†éŒ¯èª¤ç‹€æ…‹
  useEffect(() => {
    const recordingError = recording.error
    const transcriptError = transcript.error
    const prevErrors = prevErrorStateRef.current

    // åªåœ¨éŒ¯èª¤ç‹€æ…‹çœŸæ­£æ”¹è®Šæ™‚è™•ç†ï¼ˆé¿å…é‡è¤‡è™•ç†åŒæ¨£çš„éŒ¯èª¤ï¼‰
    if ((recordingError !== prevErrors.recording) || (transcriptError !== prevErrors.transcript)) {
      if (recordingError || transcriptError) {
        console.log('ğŸš¨ [éŒ¯èª¤è™•ç†] æª¢æ¸¬åˆ°éŒ¯èª¤:', {
          recordingError,
          transcriptError,
          currentState: prevStateRef.current,
          sessionId: session.currentSession?.id
        })

        const currentState = prevStateRef.current

        // å¦‚æœæ˜¯éŒ„éŸ³ç›¸é—œéŒ¯èª¤ï¼Œåœæ­¢éŒ„éŸ³ä¸¦å›åˆ°é è¨­ç‹€æ…‹
        if (currentState === "recording_waiting" || currentState === "recording_active") {
          console.log('ğŸš¨ [éŒ¯èª¤è™•ç†] éŒ„éŸ³ç‹€æ…‹éŒ¯èª¤ï¼Œåœæ­¢éŒ„éŸ³ä¸¦å›åˆ°é è¨­ç‹€æ…‹')

          // åœæ­¢éŒ„éŸ³
          recording.stopRecording()

          // æ¸…ç†é€£ç·š
          transcript.disconnect()

          // å›åˆ°é è¨­ç‹€æ…‹
          setAppData(prev => {
            prevStateRef.current = "default"
            return { ...prev, state: "default" }
          })

          // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const errorMessage = recordingError || transcriptError || 'éŒ„éŸ³æˆ–è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤'
          toast({
            title: 'éŒ„éŸ³éŒ¯èª¤',
            description: errorMessage,
            variant: 'destructive',
          })
        }

        // å¦‚æœæ˜¯è™•ç†ç‹€æ…‹çš„éŒ¯èª¤ï¼Œä¹Ÿå›åˆ°é è¨­ç‹€æ…‹
        if (currentState === "processing") {
          console.log('ğŸš¨ [éŒ¯èª¤è™•ç†] è™•ç†ç‹€æ…‹éŒ¯èª¤ï¼Œå›åˆ°é è¨­ç‹€æ…‹')

          setAppData(prev => {
            prevStateRef.current = "default"
            return { ...prev, state: "default" }
          })

          const errorMessage = transcriptError || recordingError || 'è™•ç†è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤'
          toast({
            title: 'è™•ç†éŒ¯èª¤',
            description: errorMessage,
            variant: 'destructive',
          })
        }
      }

      // æ›´æ–°éŒ¯èª¤ç‹€æ…‹è¿½è¹¤
      prevErrorStateRef.current = {
        recording: recordingError,
        transcript: transcriptError
      }
    }
  }, [recording.error, transcript.error, session.currentSession, recording, transcript, toast])

  // å»ºç«‹ç´”ç­†è¨˜æœƒè©±
  const createNoteSession = useCallback(async (title?: string) => {
    setIsLoading(true)
    setError(null)

    try {
      const newSession = await session.createNoteSession(title)
      if (newSession) {
        // è¼‰å…¥ç­†è¨˜å…§å®¹
        await notes.loadNote(newSession.id)

        // æ¸…é™¤æœ¬åœ°è‰ç¨¿
        localStorage.removeItem('draft_note')

        console.log('âœ… ç´”ç­†è¨˜æœƒè©±å»ºç«‹æˆåŠŸ')

        toast({
          title: 'ç­†è¨˜æœƒè©±å·²å»ºç«‹',
          description: `æœƒè©± "${title}" å»ºç«‹æˆåŠŸ`,
        })
      }
    } catch (err) {
      // ç‰¹åˆ¥è™•ç†æœƒè©±è¡çªéŒ¯èª¤
      if (err instanceof Error && err.message.includes('æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çª')) {
        const conflictMsg = 'åµæ¸¬åˆ°æœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
        console.error("ğŸ¤ startRecording: æœƒè©±è¡çªéŒ¯èª¤:", err.message)
        setError(conflictMsg)
        toast({
          title: 'æœƒè©±è¡çª',
          description: 'ç›®å‰å·²æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–ç­‰å¾…ç•¶å‰æœƒè©±çµæŸ',
          variant: 'destructive'
        })
        return
      }

      const msg = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      console.error("ğŸ¤ startRecording: æµç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:", msg)
      setError(msg)
      toast({ title: 'éŒ„éŸ³å¤±æ•—', description: msg, variant: 'destructive' })
    } finally {
      setIsLoading(false)
      console.log("ğŸ¤ startRecording: æµç¨‹çµæŸ")
    }
  }, [session, recording, transcript, appData.editorContent, toast])

  // å»ºç«‹éŒ„éŸ³æœƒè©±
  const createRecordingSession = useCallback(async (title?: string) => {
    setIsLoading(true)
    setError(null)

    try {
      const newSession = await session.createRecordingSession(title, appData.editorContent)
      if (newSession) {
        // è¼‰å…¥ç­†è¨˜å…§å®¹
        await notes.loadNote(newSession.id)

        // æ¸…é™¤æœ¬åœ°è‰ç¨¿
        localStorage.removeItem('draft_note')

        console.log('âœ… éŒ„éŸ³æœƒè©±å»ºç«‹æˆåŠŸ')

        toast({
          title: 'éŒ„éŸ³æœƒè©±å·²å»ºç«‹',
          description: `æœƒè©± "${title}" å»ºç«‹æˆåŠŸ`,
        })
      }
    } catch (err) {
      // ç‰¹åˆ¥è™•ç†æœƒè©±è¡çªéŒ¯èª¤
      if (err instanceof Error && err.message.includes('æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çª')) {
        const conflictMsg = 'åµæ¸¬åˆ°æœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
        console.error("ğŸ¤ createRecordingSession: æœƒè©±è¡çªéŒ¯èª¤:", err.message)
        setError(conflictMsg)
        toast({
          title: 'æœƒè©±è¡çª',
          description: 'ç›®å‰å·²æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–ç­‰å¾…ç•¶å‰æœƒè©±çµæŸ',
          variant: 'destructive'
        })
        return
      }

      const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å»ºç«‹å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [session, notes, toast, appData.editorContent])

  // é–‹å§‹éŒ„éŸ³ - æ”¯æ´å››ç‹€æ…‹æµç¨‹
  const startRecording = useCallback(async (title?: string) => {
    console.log("ğŸ¤ startRecording: æµç¨‹é–‹å§‹")
    setIsLoading(true)
    try {
      // å…ˆæª¢æŸ¥æ˜¯å¦æœ‰æ´»èºæœƒè©±ï¼Œç¢ºä¿å‰ç«¯ç‹€æ…‹èˆ‡å¾Œç«¯åŒæ­¥
      console.log("ğŸ¤ startRecording: æª¢æŸ¥æ´»èºæœƒè©±ç‹€æ…‹")
      const latestActiveSession = await session.checkActiveSession()

      let sessionToRecord = latestActiveSession || session.currentSession
      console.log("ğŸ¤ startRecording: æœƒè©±ç‹€æ…‹æª¢æŸ¥çµæœ:", {
        latestActiveSession: latestActiveSession?.id,
        currentSession: session.currentSession?.id,
        finalSessionToUse: sessionToRecord?.id
      })

      if (latestActiveSession && !session.currentSession) {
        console.log("ğŸ¤ startRecording: æª¢æ¸¬åˆ°æ´»èºæœƒè©±ï¼ŒåŒæ­¥å‰ç«¯ç‹€æ…‹")
      }

      if (!sessionToRecord) {
        console.log("ğŸ¤ startRecording: æ²’æœ‰ sessionï¼Œå»ºç«‹æ–°çš„éŒ„éŸ³ session")
        const newSession = await session.createRecordingSession(title, appData.editorContent)
        if (!newSession) {
          console.error("ğŸ¤ startRecording: å»ºç«‹ session å¤±æ•—ï¼Œå›å‚³å€¼ç‚º null")
          throw new Error('ç„¡æ³•å»ºç«‹æ–°çš„éŒ„éŸ³æœƒè©±')
        }
        console.log("ğŸ¤ startRecording: Session å»ºç«‹æˆåŠŸ:", newSession)
        sessionToRecord = newSession
        localStorage.removeItem('draft_note')
      } else if (sessionToRecord.type === 'note_only') {
        console.log("ğŸ¤ startRecording: åµæ¸¬åˆ° note_only sessionï¼Œé€²è¡Œå‡ç´š")
        const upgradedSession = await session.upgradeToRecording()
        if (!upgradedSession) {
          console.error("ğŸ¤ startRecording: å‡ç´š session å¤±æ•—ï¼Œå›å‚³å€¼ç‚º null")
          throw new Error('ç„¡æ³•å‡ç´šæœƒè©±')
        }
        console.log("ğŸ¤ startRecording: Session å‡ç´šæˆåŠŸ:", upgradedSession)
        sessionToRecord = upgradedSession
      } else if (sessionToRecord.type === 'recording') {
        console.log("ğŸ¤ startRecording: ä½¿ç”¨ç¾æœ‰çš„éŒ„éŸ³æœƒè©±:", sessionToRecord.id)
      }

      console.log("ğŸ¤ startRecording: æº–å‚™å‘¼å« recording.startRecording")
      // recording.startRecording ä½¿ç”¨ TranscriptManagerï¼Œçµ±ä¸€ç®¡ç†é€å­—ç¨¿é€£æ¥
      await recording.startRecording(sessionToRecord.id)
      console.log("ğŸ¤ startRecording: recording.startRecording å‘¼å«å®Œç•¢")

      console.log("ğŸ¤ startRecording: è·³é transcript.connectï¼Œé¿å…é›™é‡ç›£è½å™¨")
      // ç§»é™¤é‡è¤‡é€£æ¥ï¼šuseRecording å·²ç¶“é€é TranscriptManager é€£æ¥é€å­—ç¨¿
      // é¿å… useTranscript å’Œ useRecording åŒæ™‚æ·»åŠ ç›£è½å™¨å°è‡´ç«¶çˆ­æ¢ä»¶
      console.log("ğŸ¤ startRecording: é€å­—ç¨¿å°‡ç”± useRecording hook çµ±ä¸€ç®¡ç†")

      toast({ title: 'éŒ„éŸ³é–‹å§‹' })
    } catch (err) {
      // ç‰¹åˆ¥è™•ç†æœƒè©±è¡çªéŒ¯èª¤
      if (err instanceof Error && err.message.includes('æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çª')) {
        const conflictMsg = 'åµæ¸¬åˆ°æœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
        console.error("ğŸ¤ startRecording: æœƒè©±è¡çªéŒ¯èª¤:", err.message)
        setError(conflictMsg)
        toast({
          title: 'æœƒè©±è¡çª',
          description: 'ç›®å‰å·²æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–ç­‰å¾…ç•¶å‰æœƒè©±çµæŸ',
          variant: 'destructive'
        })
        return
      }

      const msg = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      console.error("ğŸ¤ startRecording: æµç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:", msg)
      setError(msg)
      toast({ title: 'éŒ„éŸ³å¤±æ•—', description: msg, variant: 'destructive' })
    } finally {
      setIsLoading(false)
      console.log("ğŸ¤ startRecording: æµç¨‹çµæŸ")
    }
  }, [session, recording, transcript, appData.editorContent, toast])

  // å‡ç´šæœƒè©±ç‚ºéŒ„éŸ³æ¨¡å¼
  const upgradeToRecording = useCallback(async () => {
    setIsLoading(true)
    setError(null)

    try {
      const updatedSession = await session.upgradeToRecording()
      if (updatedSession) {
        console.log('âœ… æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼æˆåŠŸ')

        toast({
          title: 'å‡ç´šæˆåŠŸ',
          description: 'æœƒè©±å·²å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼',
        })
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å‡ç´šæœƒè©±å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ å‡ç´šæœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å‡ç´šå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [session, toast])

  // åœæ­¢éŒ„éŸ³ - è‡ªå‹•è½‰ç‚º processing ç‹€æ…‹
  const stopRecording = useCallback(async () => {
    setIsLoading(true)
    setError(null)

    try {
      await recording.stopRecording()

      // æ–·é–‹ transcript é€£æ¥
      transcript.disconnect()

      // ç‹€æ…‹è½‰ç‚º processing
      setAppData(prev => ({ ...prev, state: "processing" }))

      console.log('âœ… éŒ„éŸ³åœæ­¢ï¼Œé–‹å§‹è™•ç†é€å­—ç¨¿')

      toast({
        title: 'è™•ç†ä¸­',
        description: 'æ­£åœ¨è™•ç†éŒ„éŸ³å…§å®¹ï¼Œè«‹ç¨å€™...',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ åœæ­¢éŒ„éŸ³å¤±æ•—:', err)

      toast({
        title: 'åœæ­¢å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [recording, toast])

  // å®Œæˆæœƒè©±
  const finishSession = useCallback(async () => {
    setIsLoading(true)
    setError(null)

    try {
      await session.finishSession()
      console.log('âœ… æœƒè©±å®Œæˆ')

      toast({
        title: 'æœƒè©±å®Œæˆ',
        description: 'æ‚¨å¯ä»¥åŒ¯å‡ºç­†è¨˜æˆ–é–‹å§‹æ–°çš„ç­†è¨˜',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å®Œæˆæœƒè©±å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ å®Œæˆæœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å®Œæˆå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [session, toast])

  // é–‹æ–°ç­†è¨˜ - æ¸…ç©ºç•¶å‰è³‡æ–™ï¼Œç‹€æ…‹å›åˆ° default
  const newNote = useCallback(async () => {
    setIsLoading(true)
    setError(null)

    try {
      // å¦‚æœæœ‰æ´»èºæœƒè©±ï¼Œå…ˆåˆªé™¤å®ƒ
      if (session.currentSession) {
        console.log('ğŸ—‘ï¸ åˆªé™¤ç•¶å‰æ´»èºæœƒè©±:', session.currentSession.id)
        await session.deleteSession()
        console.log('âœ… æœƒè©±åˆªé™¤æˆåŠŸ')
      }

      // æ¸…ç©ºç•¶å‰è³‡æ–™
      setAppData({
        state: "default",
        transcriptEntries: [],
        editorContent: "",
        isRecording: false,
        recordingTime: 0,
      })

      // æ¸…é™¤éŒ„éŸ³å’Œé€å­—ç¨¿ç‹€æ…‹
      recording.clearTranscripts()
      transcript.clearTranscripts()
      notes.clearNote()

      // æ¸…é™¤æœ¬åœ°è‰ç¨¿
      localStorage.removeItem('draft_note')

      console.log('ğŸ”„ å·²é–‹å§‹æ–°ç­†è¨˜')

      toast({
        title: 'æ–°ç­†è¨˜',
        description: 'å·²æ¸…ç©ºå…§å®¹ï¼Œå¯ä»¥é–‹å§‹æ–°çš„ç­†è¨˜',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'é–‹å§‹æ–°ç­†è¨˜å¤±æ•—'
      setError(errorMessage)
      console.error('âŒ é–‹å§‹æ–°ç­†è¨˜å¤±æ•—:', err)

      toast({
        title: 'æ“ä½œå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      setIsLoading(false)
    }
  }, [session, recording, transcript, notes, toast])

  // è‡ªå‹•å„²å­˜ç­†è¨˜å…§å®¹åˆ°æœ¬åœ°è‰ç¨¿
  const saveLocalDraft = useCallback((content: string) => {
    if (!session.currentSession && content.trim()) {
      localStorage.setItem('draft_note', content)
    }
  }, [session.currentSession])

  return {
    // æ‡‰ç”¨ç‹€æ…‹
    appData,
    isLoading,
    error,

    // æœƒè©±ç®¡ç†
    createNoteSession,
    createRecordingSession,
    upgradeToRecording,
    finishSession,
    newNote,

    // éŒ„éŸ³æ§åˆ¶
    startRecording,
    stopRecording,

    // æœ¬åœ°è‰ç¨¿
    saveLocalDraft,

    // å¤–éƒ¨ç‹€æ…‹
    session: session.currentSession,
    sessionLoading: session.isLoading,
    sessionError: session.error,

    // éŒ„éŸ³ç‹€æ…‹
    recordingError: recording.error,

    // é€å­—ç¨¿ç‹€æ…‹
    transcriptConnected: transcript.isConnected,
    transcriptError: transcript.error,
    transcriptAutoScroll: transcript.autoScrollEnabled,
    enableAutoScroll: transcript.enableAutoScroll,
    disableAutoScroll: transcript.disableAutoScroll,
    scrollToLatest: transcript.scrollToLatest,
  }
}

export { mapBackendToFrontendState }


# END FILE CONTENTS


# File: frontend/lib/segmented-audio-recorder.ts

"use client"

import { getAudioChunkIntervalMs } from './config'

// éŸ³è¨ŠéŒ„è£½ç‹€æ…‹
export type SegmentedAudioRecorderState = 'idle' | 'recording' | 'paused' | 'error'

// éŸ³è¨ŠéŒ„è£½é…ç½®
export interface SegmentedAudioRecorderConfig {
  segmentDuration: number // æ¯å€‹æ®µè½æ™‚é•·ï¼ˆæ¯«ç§’ï¼‰
  mimeType: string // éŸ³è¨Šæ ¼å¼
  audioBitsPerSecond?: number // éŸ³è¨Šä½å…ƒç‡
}

// éŸ³è¨Šæ®µè½è³‡æ–™
export interface AudioSegment {
  blob: Blob
  timestamp: number
  duration: number
  sequence: number
}

// é è¨­é…ç½®
const DEFAULT_CONFIG: SegmentedAudioRecorderConfig = {
  segmentDuration: getAudioChunkIntervalMs(), // å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
  mimeType: 'audio/webm;codecs=opus',
  audioBitsPerSecond: 64000, // 64 kbps for configurable chunksï¼ˆé™ä½ä½å…ƒç‡ï¼‰
}

/**
 * SegmentedAudioRecorder - åˆ†æ®µå¼éŸ³è¨ŠéŒ„è£½å™¨
 *
 * æ ¸å¿ƒç‰¹é»ï¼š
 * - ä½¿ç”¨éè¿´å•Ÿå‹•/åœæ­¢ MediaRecorder æ¨¡å¼
 * - æ¯å€‹ segment åŒ…å«å®Œæ•´ WebM Header
 * - æ”¯æ´å¯é…ç½®çš„åˆ‡ç‰‡æ™‚é•·ï¼ˆé è¨­ 5 ç§’ï¼‰
 * - è§£æ±º Azure OpenAI Whisper API æª”é ­å•é¡Œ
 */
export class SegmentedAudioRecorder {
  private stream: MediaStream | null = null
  private config: SegmentedAudioRecorderConfig
  private state: SegmentedAudioRecorderState = 'idle'
  private sequence: number = 0
  private recording = false
  private segmentTimeout: NodeJS.Timeout | null = null

  // äº‹ä»¶å›èª¿
  private onSegmentCallback?: (segment: AudioSegment) => void
  private onStateChangeCallback?: (state: SegmentedAudioRecorderState) => void
  private onErrorCallback?: (error: Error) => void
  private onStartCallback?: () => void

  constructor(config: Partial<SegmentedAudioRecorderConfig> = {}) {
    this.config = { ...DEFAULT_CONFIG, ...config }
  }

  /**
   * åˆå§‹åŒ–éŒ„éŸ³å™¨ - ç²å–éŸ³è¨Šæ¬Šé™
   */
  async initialize(): Promise<void> {
    if (this.stream) {
      return // å·²åˆå§‹åŒ–
    }

    try {
      this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })
      console.log('ğŸ¤ [SegmentedAudioRecorder] éŸ³è¨Šæ¬Šé™ç²å–æˆåŠŸ')
    } catch (error) {
      const errorMsg = error instanceof Error ? error.message : 'ç²å–éŸ³è¨Šæ¬Šé™å¤±æ•—'
      this.handleError(new Error(errorMsg))
      throw error
    }
  }

  /**
   * é–‹å§‹éŒ„éŸ³ - å•Ÿå‹•éè¿´åˆ†æ®µéŒ„éŸ³
   */
  async start(onSegmentAvailable: (segment: AudioSegment) => void): Promise<void> {
    if (this.recording) {
      throw new Error('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
    }

    if (!this.stream) {
      await this.initialize()
    }

    this.onSegmentCallback = onSegmentAvailable
    this.recording = true
    this.sequence = 0

    console.log('ğŸ¬ [SegmentedAudioRecorder] é–‹å§‹åˆ†æ®µéŒ„éŸ³', {
      segmentDuration: this.config.segmentDuration,
      mimeType: this.config.mimeType,
      audioBitsPerSecond: this.config.audioBitsPerSecond
    })

    this.setState('recording')
    this.startSegment()
  }

  /**
   * æ ¸å¿ƒéè¿´å‡½å¼ - å•Ÿå‹•å–®å€‹éŒ„éŸ³æ®µè½
   */
  private startSegment(): void {
    if (!this.recording || !this.stream) {
      return
    }

    console.log(`ğŸµ [SegmentedAudioRecorder] é–‹å§‹éŒ„éŸ³æ®µè½ #${this.sequence}`)

    // å»ºç«‹æ–°çš„ MediaRecorder å¯¦ä¾‹
    const mediaRecorder = new MediaRecorder(this.stream, {
      mimeType: this.config.mimeType,
      audioBitsPerSecond: this.config.audioBitsPerSecond,
    })

    // æ–°å¢ï¼šè¨­å®šéŒ„éŸ³é–‹å§‹äº‹ä»¶è™•ç†
    mediaRecorder.onstart = () => {
      console.log(`ğŸš€ [SegmentedAudioRecorder] æ®µè½ #${this.sequence} éŒ„éŸ³çœŸæ­£é–‹å§‹`)
      // åªåœ¨ç¬¬ä¸€å€‹æ®µè½è§¸ç™¼ onstart å›èª¿
      if (this.sequence === 0 && this.onStartCallback) {
        console.log('ğŸ¯ [SegmentedAudioRecorder] è§¸ç™¼éŒ„éŸ³é–‹å§‹å›èª¿')
        this.onStartCallback()
      }
    }

    // è¨­å®šè³‡æ–™æ¥æ”¶è™•ç†
    mediaRecorder.ondataavailable = (event) => {
      if (event.data.size > 0) {
        console.log(`ğŸ“¦ [SegmentedAudioRecorder] æ®µè½ #${this.sequence} å®Œæˆ`, {
          size: event.data.size,
          mimeType: this.config.mimeType,
          containsCompleteHeader: true // æ¯å€‹æ®µè½éƒ½æœ‰å®Œæ•´æª”é ­
        })

        const segment: AudioSegment = {
          blob: event.data,
          timestamp: Date.now(),
          duration: this.config.segmentDuration,
          sequence: this.sequence++,
        }

        // å›èª¿é€šçŸ¥æœ‰æ–°æ®µè½å¯ç”¨
        this.onSegmentCallback?.(segment)
      }
    }

    // éŒ¯èª¤è™•ç†
    mediaRecorder.onerror = (event) => {
      console.error(`âŒ [SegmentedAudioRecorder] æ®µè½ #${this.sequence} éŒ¯èª¤:`, event)
      this.handleError(new Error(`MediaRecorder éŒ¯èª¤: ${event}`))
    }

    // é–‹å§‹éŒ„è£½æ­¤æ®µè½
    mediaRecorder.start()

    // è¨­å®šè¨ˆæ™‚å™¨ï¼Œåœ¨æŒ‡å®šæ™‚é–“å¾ŒçµæŸæ­¤æ®µè½ä¸¦é–‹å§‹ä¸‹ä¸€æ®µ
    this.segmentTimeout = setTimeout(() => {
      if (mediaRecorder.state === 'recording') {
        // è«‹æ±‚æ•¸æ“šä¸¦åœæ­¢ MediaRecorder
        mediaRecorder.requestData() // è§¸ç™¼ ondataavailable
        mediaRecorder.stop()        // çµæŸæ­¤æ®µ

        // å¦‚æœä»åœ¨éŒ„éŸ³ç‹€æ…‹ï¼Œéè¿´é–‹å§‹ä¸‹ä¸€æ®µ
        if (this.recording) {
          // çŸ­æš«å»¶é²ç¢ºä¿å‰ä¸€æ®µå®Œå…¨çµæŸ
          setTimeout(() => {
            this.startSegment()
          }, 50)
        }
      }
    }, this.config.segmentDuration)
  }

  /**
   * åœæ­¢éŒ„éŸ³
   */
  stop(): void {
    console.log('â¹ï¸ [SegmentedAudioRecorder] åœæ­¢éŒ„éŸ³')

    this.recording = false

    // æ¸…é™¤è¨ˆæ™‚å™¨
    if (this.segmentTimeout) {
      clearTimeout(this.segmentTimeout)
      this.segmentTimeout = null
    }

    this.setState('idle')
  }

  /**
   * æ¸…ç†è³‡æº
   */
  cleanup(): void {
    this.stop()

    if (this.stream) {
      this.stream.getTracks().forEach(track => track.stop())
      this.stream = null
    }

    this.sequence = 0
    console.log('ğŸ§¹ SegmentedAudioRecorder å·²æ¸…ç†')
  }

  /**
   * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
   */
  get isRecording(): boolean {
    return this.recording
  }

  /**
   * ç²å–ç•¶å‰åºè™Ÿ
   */
  get currentSequence(): number {
    return this.sequence
  }

  /**
   * ç²å–ç•¶å‰ç‹€æ…‹
   */
  get currentState(): SegmentedAudioRecorderState {
    return this.state
  }

  /**
   * ç²å–ç•¶å‰é…ç½®
   */
  get currentConfig(): SegmentedAudioRecorderConfig {
    return { ...this.config }
  }

  // è¨­å®šç‹€æ…‹
  private setState(newState: SegmentedAudioRecorderState): void {
    this.state = newState
    this.onStateChangeCallback?.(newState)
  }

  // éŒ¯èª¤è™•ç†
  private handleError(error: Error): void {
    console.error('âŒ SegmentedAudioRecorder éŒ¯èª¤:', error)
    this.setState('error')
    this.recording = false
    this.onErrorCallback?.(error)
  }

  // äº‹ä»¶å›èª¿è¨­å®š
  onSegment(callback: (segment: AudioSegment) => void): void {
    this.onSegmentCallback = callback
  }

  onStateChange(callback: (state: SegmentedAudioRecorderState) => void): void {
    this.onStateChangeCallback = callback
  }

  onError(callback: (error: Error) => void): void {
    this.onErrorCallback = callback
  }

  onStart(callback: () => void): void {
    this.onStartCallback = callback
  }
}

// å·¥å» å‡½æ•¸
export const createSegmentedAudioRecorder = (config?: Partial<SegmentedAudioRecorderConfig>): SegmentedAudioRecorder => {
  return new SegmentedAudioRecorder(config)
}

/**
 * æª¢æŸ¥ç€è¦½å™¨åˆ†æ®µå¼éŸ³è¨ŠéŒ„è£½æ”¯æ´
 */
export async function checkSegmentedAudioRecordingSupport(): Promise<{ isSupported: boolean; error?: string }> {
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API' }
  }

  if (!window.MediaRecorder) {
    return { isSupported: false, error: 'ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorder API' }
  }

  // æª¢æŸ¥ MIME é¡å‹æ”¯æ´
  if (!MediaRecorder.isTypeSupported(DEFAULT_CONFIG.mimeType)) {
    return { isSupported: false, error: `ä¸æ”¯æ´éŸ³è¨Šæ ¼å¼: ${DEFAULT_CONFIG.mimeType}` }
  }

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
    // ç«‹å³åœæ­¢ä¸²æµä»¥é‡‹æ”¾è³‡æº
    stream.getTracks().forEach(track => track.stop())
    return { isSupported: true }
  } catch (error) {
    return { isSupported: false, error: `ç„¡æ³•ç²å–éº¥å…‹é¢¨æ¬Šé™: ${error}` }
  }
}


# END FILE CONTENTS


# File: frontend/components/ui/collapsible.tsx

"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }


# END FILE CONTENTS


# File: frontend/lib/__tests__/network-restorer.test.ts

import { describe, expect, it, vi } from 'vitest'
import { emit } from '@/utils/event-bus'
import * as uploader from '@/lib/rest-audio-uploader'
import * as tm from '@/lib/transcript-manager'

describe('network restorer', () => {
    it('should retry and reconnect', async () => {
        const spyRetry = vi.spyOn(uploader.restAudioUploader, 'retryFailedSegments').mockResolvedValue({ uploaded: 1, remaining: 0 })
        const spyConnect = vi.spyOn(tm.transcriptManager, 'connect').mockReturnValue(Promise.resolve() as any)
        const spyIsConnected = vi.spyOn(tm.transcriptManager, 'isConnected').mockReturnValue(false)

        emit('network:restored')
        await vi.runAllTicks()

        expect(spyRetry).toHaveBeenCalled()
        expect(spyConnect).toHaveBeenCalled()
    })
})


# END FILE CONTENTS


# File: frontend/hooks/use-app-state-context.ts

"use client"

import React, { createContext, useContext, useReducer, useCallback, useEffect, useState } from "react"
import { AppStateContextValue, initialContextState } from "../types/app-state-context"
import { appStateReducer, AppStateReducerState } from "../lib/app-state-reducer"
import { InitialStateLoader } from "../lib/initial-state-loader"
import { AppState, SessionStatus, SessionType, TranscriptEntry } from "../types/app-state"
import { StateMachineManager } from '../lib/state-machine';
import { StateTransitionTrigger } from "../types/state-transitions";
import { ServiceRegistry, SERVICE_KEYS, serviceContainer } from "../lib/services";
import type { ISessionService, IRecordingService, ITranscriptService, TranscriptMessage } from "../lib/services";

const AppStateContext = createContext<AppStateContextValue | null>(null)

export function AppStateProvider({ children }: { children: React.ReactNode }) {
  const [state, dispatch] = useReducer(appStateReducer, initialContextState as AppStateReducerState)
  const [stateMachineManager, setStateMachineManager] = useState<StateMachineManager | null>(null);
  const [servicesInitialized, setServicesInitialized] = useState(false);

  // åˆå§‹åŒ–æœå‹™å±¤
  useEffect(() => {
    async function initializeServices() {
      try {
        console.log('ğŸš€ [AppStateProvider] åˆå§‹åŒ–æœå‹™å±¤...')

        // è¨»å†Šä¸¦åˆå§‹åŒ–æ‰€æœ‰æœå‹™
        await ServiceRegistry.initializeServices()

        setServicesInitialized(true)
        console.log('âœ… [AppStateProvider] æœå‹™å±¤åˆå§‹åŒ–å®Œæˆ')
      } catch (error) {
        console.error('âŒ [AppStateProvider] æœå‹™å±¤åˆå§‹åŒ–å¤±æ•—:', error)
      }
    }

    initializeServices()
  }, [])

  // è¼‰å…¥åˆå§‹ç‹€æ…‹ä¸¦åˆå§‹åŒ–ç‹€æ…‹æ©Ÿ
  useEffect(() => {
    if (!servicesInitialized) {
      console.log('â³ [AppStateProvider] ç­‰å¾…æœå‹™å±¤åˆå§‹åŒ–...')
      return
    }

    console.log('ğŸ”„ [AppStateProvider] è¼‰å…¥åˆå§‹ç‹€æ…‹...')

    // æª¢æŸ¥æ˜¯å¦åœ¨ç€è¦½å™¨ç’°å¢ƒ
    if (typeof window !== 'undefined') {
      try {
        const initialAppData = InitialStateLoader.loadInitialAppData()

        // æ›´æ–° Context ç‹€æ…‹
        dispatch({ type: "SET_APP_STATE", payload: initialAppData.state })
        dispatch({ type: "SET_EDITOR_CONTENT", payload: initialAppData.editorContent })
        dispatch({ type: "SET_TRANSCRIPT_ENTRIES", payload: initialAppData.transcriptEntries })

        if (initialAppData.session) {
          dispatch({ type: "SET_SESSION", payload: initialAppData.session })
        }

        // åˆå§‹åŒ–ç‹€æ…‹æ©Ÿä¸¦è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨
        const smManager = new StateMachineManager({
          currentState: initialAppData.state,
          isRecording: initialAppData.isRecording,
          transcriptCount: initialAppData.transcriptEntries.length,
          session: initialAppData.session || null,
          error: null
        });

        // å–å¾—æœå‹™å¯¦ä¾‹
        const sessionService = serviceContainer.resolve<ISessionService>(SERVICE_KEYS.SESSION_SERVICE)
        const recordingService = serviceContainer.resolve<IRecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
        const transcriptService = serviceContainer.resolve<ITranscriptService>(SERVICE_KEYS.TRANSCRIPT_SERVICE)

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - CREATE_SESSION
        smManager.registerSideEffectHandler('CREATE_SESSION', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ—ï¸ [å‰¯ä½œç”¨] CREATE_SESSION: å»ºç«‹æœƒè©±', effect);

            try {
              if (effect.type === 'CREATE_SESSION') {
                // ä¿®å¾©ï¼šå»ºç«‹æœƒè©±å‰å…ˆæª¢æŸ¥ç¾æœ‰æ´»èºæœƒè©±
                console.log('ğŸ” [å‰¯ä½œç”¨] CREATE_SESSION: æª¢æŸ¥ç¾æœ‰æ´»èºæœƒè©±')
                const existingSession = await sessionService.checkActiveSession()

                if (existingSession) {
                  console.log('âš ï¸ [å‰¯ä½œç”¨] CREATE_SESSION: ç™¼ç¾ç¾æœ‰æ´»èºæœƒè©±ï¼Œå˜—è©¦è‡ªå‹•æ¸…ç†', {
                    existingSessionId: existingSession.id,
                    status: existingSession.status,
                    type: existingSession.type
                  })

                  try {
                    // å˜—è©¦åˆªé™¤ç¾æœ‰æ´»èºæœƒè©±
                    await sessionService.deleteSession(existingSession.id)
                    console.log('âœ… [å‰¯ä½œç”¨] CREATE_SESSION: æˆåŠŸæ¸…ç†ç¾æœ‰æœƒè©±', existingSession.id)
                  } catch (cleanupError) {
                    console.warn('âš ï¸ [å‰¯ä½œç”¨] CREATE_SESSION: æ¸…ç†ç¾æœ‰æœƒè©±å¤±æ•—ï¼Œç¹¼çºŒå˜—è©¦å‰µå»º', cleanupError)
                  }
                }

                const sessionData = await sessionService.createRecordingSession(
                  effect.title || `éŒ„éŸ³ç­†è¨˜ ${new Date().toLocaleString()}`
                )

                // æ–°å¢ï¼šç­‰å¾…æœƒè©±åœ¨è³‡æ–™åº«ä¸­å®Œå…¨å¯è¦‹
                const isReady = await sessionService.waitForSessionReady(sessionData.id)

                if (!isReady) {
                  throw new Error('æœƒè©±å‰µå»ºè¶…æ™‚ï¼Œç„¡æ³•ç¢ºèªæœƒè©±ç‹€æ…‹')
                }

                // æ›´æ–° Context ç‹€æ…‹
                dispatch({
                  type: "SET_SESSION",
                  payload: {
                    id: sessionData.id,
                    status: sessionData.status as SessionStatus,
                    type: effect.sessionType
                  }
                })

                console.log('âœ… [å‰¯ä½œç”¨] CREATE_SESSION å®Œæˆ:', sessionData.id)

                // ç§»é™¤ setTimeoutï¼Œæ”¹ç‚ºåŒæ­¥è§¸ç™¼ SESSION_CREATED è½‰æ›
                if (stateMachineManager) {
                  stateMachineManager.getStateMachine().transition('SESSION_CREATED')
                }
              }
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] CREATE_SESSION å¤±æ•—:', error)

              // ä¿®å¾©ï¼šæä¾›æ›´æ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯
              let errorMessage = 'å»ºç«‹æœƒè©±å¤±æ•—'
              if (error instanceof Error) {
                if (error.message.includes('409') || error.message.includes('è¡çª')) {
                  errorMessage = 'æœƒè©±è¡çªï¼šè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–è¯ç¹«æŠ€è¡“æ”¯æ´'
                } else if (error.message.includes('è¶…æ™‚')) {
                  errorMessage = 'æœƒè©±å‰µå»ºè¶…æ™‚ï¼šè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥å¾Œé‡è©¦'
                }
              }

              dispatch({ type: "SET_ERROR", payload: errorMessage })

              // ä¿®å¾©ï¼šç¢ºä¿æ¸…ç† session ç‹€æ…‹
              dispatch({ type: "SET_SESSION", payload: null })

              // ç§»é™¤ setTimeoutï¼Œæ”¹ç‚ºåŒæ­¥è§¸ç™¼éŒ¯èª¤è½‰æ›
              if (stateMachineManager) {
                stateMachineManager.getStateMachine().transition('ERROR_OCCURRED')
              }
            }
          }
        });



        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - START_RECORDING
        smManager.registerSideEffectHandler('START_RECORDING', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ¤ [å‰¯ä½œç”¨] START_RECORDING: é–‹å§‹éŒ„éŸ³', effect);

            try {
              const currentSession = smManager.getStateMachine().getContext().session
              if (!currentSession) {
                throw new Error('æ²’æœ‰æ´»èºçš„æœƒè©±')
              }

              await recordingService.startRecording(currentSession.id)

              // æ›´æ–°éŒ„éŸ³ç‹€æ…‹
              dispatch({ type: "SET_RECORDING", payload: true })

              console.log('âœ… [å‰¯ä½œç”¨] START_RECORDING å®Œæˆ')
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] START_RECORDING å¤±æ•—:', error)
              dispatch({ type: "SET_ERROR", payload: 'é–‹å§‹éŒ„éŸ³å¤±æ•—' })

              // è§¸ç™¼éŒ¯èª¤è½‰æ›
              setTimeout(() => {
                if (stateMachineManager) {
                  stateMachineManager.getStateMachine().transition('ERROR_OCCURRED')
                }
              }, 100)
            }
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - CONNECT_WEBSOCKET
        smManager.registerSideEffectHandler('CONNECT_WEBSOCKET', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ”Œ [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: é€£æ¥ WebSocket', effect);

            try {
              const currentSession = smManager.getStateMachine().getContext().session
              if (!currentSession) {
                throw new Error('æ²’æœ‰æ´»èºçš„æœƒè©±')
              }

              // ä¿®å¾©ï¼šæ·»åŠ é€£æ¥è¶…æ™‚è™•ç†
              const WEBSOCKET_TIMEOUT = 10000; // 10ç§’è¶…æ™‚

              const connectionPromise = async () => {
                // æ–°å¢ï¼šWebSocket é€£æ¥å‰æœƒè©±ç‹€æ…‹é æª¢
                console.log('ğŸ” [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: é–‹å§‹æœƒè©±ç‹€æ…‹é æª¢', currentSession.id)

                const activeSession = await sessionService.checkActiveSession()
                if (!activeSession) {
                  throw new Error(`æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—ï¼šæ²’æœ‰æ´»èºçš„æœƒè©±`)
                }

                if (activeSession.id !== currentSession.id) {
                  throw new Error(`æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—ï¼šæ´»èºæœƒè©± ${activeSession.id} èˆ‡æœŸæœ›çš„æœƒè©± ${currentSession.id} ä¸åŒ¹é…`)
                }

                if (activeSession.status !== 'active') {
                  throw new Error(`æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—ï¼šæœƒè©± ${activeSession.id} ç‹€æ…‹ç‚º ${activeSession.status}ï¼ŒæœŸæœ›ç‚º active`)
                }

                if (activeSession.type !== 'recording') {
                  throw new Error(`æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—ï¼šæœƒè©± ${activeSession.id} é¡å‹ç‚º ${activeSession.type}ï¼ŒæœŸæœ›ç‚º recording`)
                }

                console.log('âœ… [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: æœƒè©±ç‹€æ…‹é æª¢é€šé', {
                  sessionId: activeSession.id,
                  status: activeSession.status,
                  type: activeSession.type
                })

                // é€£æ¥ä¸¦æ·»åŠ ç›£è½å™¨ - ä½¿ç”¨é æª¢é€šéçš„æœƒè©± ID
                await transcriptService.connect(activeSession.id)

                return activeSession
              }

              // ä¿®å¾©ï¼šä½¿ç”¨ Promise.race å¯¦ç¾è¶…æ™‚æ©Ÿåˆ¶
              const timeoutPromise = new Promise<never>((_, reject) => {
                setTimeout(() => reject(new Error('WebSocket é€£æ¥è¶…æ™‚')), WEBSOCKET_TIMEOUT)
              })

              const activeSession = await Promise.race([connectionPromise(), timeoutPromise])

              // æ·»åŠ é€å­—ç¨¿ç›£è½å™¨
              const handleTranscript = (message: TranscriptMessage) => {
                if (message.type === 'transcript_segment' && message.text) {
                  const startTime = message.start_time ?? 0
                  const hours = Math.floor(startTime / 3600)
                  const minutes = Math.floor((startTime % 3600) / 60)
                  const seconds = Math.floor(startTime % 60)
                  const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

                  // æ·»åŠ é€å­—ç¨¿åˆ° Context
                  dispatch({
                    type: "ADD_TRANSCRIPT_ENTRY",
                    payload: {
                      time: timeStr,
                      text: message.text
                    }
                  })

                  // å¦‚æœæ˜¯ç¬¬ä¸€å€‹é€å­—ç¨¿ï¼Œè§¸ç™¼è½‰æ›
                  const currentContext = smManager.getStateMachine().getContext()
                  if (currentContext.transcriptCount === 0) {
                    setTimeout(() => {
                      smManager.getStateMachine().transition('FIRST_TRANSCRIPT_RECEIVED')
                    }, 100)
                  }
                } else if (message.type === 'transcript_complete') {
                  // è½‰éŒ„å®Œæˆ
                  setTimeout(() => {
                    smManager.getStateMachine().transition('PROCESSING_COMPLETED')
                  }, 100)
                } else if (message.type === 'error') {
                  console.error('ğŸš¨ [å‰¯ä½œç”¨] é€å­—ç¨¿éŒ¯èª¤:', message)
                  dispatch({ type: "SET_ERROR", payload: 'é€å­—ç¨¿è™•ç†éŒ¯èª¤' })

                  setTimeout(() => {
                    smManager.getStateMachine().transition('ERROR_OCCURRED')
                  }, 100)
                }
              }

              transcriptService.addTranscriptListener(activeSession.id, handleTranscript)

              console.log('âœ… [å‰¯ä½œç”¨] CONNECT_WEBSOCKET å®Œæˆ')
            } catch (error: unknown) {
              console.error('âŒ [å‰¯ä½œç”¨] CONNECT_WEBSOCKET å¤±æ•—:', error)

              // å€åˆ†ä¸åŒé¡å‹çš„éŒ¯èª¤æä¾›æ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯
              let errorMessage = 'é€£æ¥é€å­—ç¨¿æœå‹™å¤±æ•—'
              if (error instanceof Error) {
                if (error.message.includes('æœƒè©±ç‹€æ…‹é æª¢å¤±æ•—')) {
                  errorMessage = 'æœƒè©±ç‹€æ…‹é©—è­‰å¤±æ•—'
                } else if (error.message.includes('æ²’æœ‰æ´»èºçš„æœƒè©±')) {
                  errorMessage = 'æ²’æœ‰å¯ç”¨çš„æœƒè©±'
                } else if (error.message.includes('WebSocket é€£æ¥è¶…æ™‚')) {
                  errorMessage = 'WebSocket é€£æ¥è¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥'
                }
              }

              dispatch({ type: "SET_ERROR", payload: errorMessage })

              setTimeout(() => {
                if (stateMachineManager) {
                  stateMachineManager.getStateMachine().transition('ERROR_OCCURRED')
                }
              }, 100)
            }
          }
        });



        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - STOP_RECORDING
        smManager.registerSideEffectHandler('STOP_RECORDING', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ›‘ [å‰¯ä½œç”¨] STOP_RECORDING: åœæ­¢éŒ„éŸ³', effect);

            try {
              await recordingService.stopRecording()

              // æ›´æ–°éŒ„éŸ³ç‹€æ…‹
              dispatch({ type: "SET_RECORDING", payload: false })
              dispatch({ type: "SET_RECORDING_TIME", payload: 0 })

              console.log('âœ… [å‰¯ä½œç”¨] STOP_RECORDING å®Œæˆ')
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] STOP_RECORDING å¤±æ•—:', error)
              dispatch({ type: "SET_ERROR", payload: 'åœæ­¢éŒ„éŸ³å¤±æ•—' })
            }
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - DISCONNECT_WEBSOCKET
        smManager.registerSideEffectHandler('DISCONNECT_WEBSOCKET', {
          handleSideEffect: async (effect) => {
            console.log('ğŸ”Œ [å‰¯ä½œç”¨] DISCONNECT_WEBSOCKET: æ–·é–‹ WebSocket', effect);

            try {
              const currentSession = smManager.getStateMachine().getContext().session
              if (currentSession) {
                await transcriptService.disconnect(currentSession.id)
              }

              console.log('âœ… [å‰¯ä½œç”¨] DISCONNECT_WEBSOCKET å®Œæˆ')
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] DISCONNECT_WEBSOCKET å¤±æ•—:', error)
            }
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - FINISH_SESSION
        smManager.registerSideEffectHandler('FINISH_SESSION', {
          handleSideEffect: async (effect) => {
            console.log('âœ… [å‰¯ä½œç”¨] FINISH_SESSION: å®Œæˆæœƒè©±', effect);

            try {
              const currentSession = smManager.getStateMachine().getContext().session
              if (currentSession) {
                await sessionService.finishSession(currentSession.id)

                // æ›´æ–°æœƒè©±ç‹€æ…‹
                dispatch({
                  type: "UPDATE_SESSION_STATUS",
                  payload: "completed" as SessionStatus
                })
              }

              console.log('âœ… [å‰¯ä½œç”¨] FINISH_SESSION å®Œæˆ')
            } catch (error) {
              console.error('âŒ [å‰¯ä½œç”¨] FINISH_SESSION å¤±æ•—:', error)
              dispatch({ type: "SET_ERROR", payload: 'å®Œæˆæœƒè©±å¤±æ•—' })
            }
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - CLEAR_TRANSCRIPTS
        smManager.registerSideEffectHandler('CLEAR_TRANSCRIPTS', {
          handleSideEffect: (effect) => {
            console.log('ğŸ§¹ [å‰¯ä½œç”¨] CLEAR_TRANSCRIPTS: æ¸…é™¤é€å­—ç¨¿', effect);
            dispatch({ type: "SET_TRANSCRIPT_ENTRIES", payload: [] })
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - SAVE_DRAFT
        smManager.registerSideEffectHandler('SAVE_DRAFT', {
          handleSideEffect: (effect) => {
            console.log('ğŸ’¾ [å‰¯ä½œç”¨] SAVE_DRAFT: å„²å­˜è‰ç¨¿', effect);
            // ç•¶å‰å·²æœ‰è‡ªå‹•å„²å­˜æ©Ÿåˆ¶ï¼Œé€™è£¡å¯ä»¥è§¸ç™¼ç«‹å³å„²å­˜
          }
        });

        // è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨ - SHOW_ERROR
        smManager.registerSideEffectHandler('SHOW_ERROR', {
          handleSideEffect: (effect) => {
            console.log('ğŸš¨ [å‰¯ä½œç”¨] SHOW_ERROR: é¡¯ç¤ºéŒ¯èª¤', effect);
            if (effect.type === 'SHOW_ERROR') {
              dispatch({ type: "SET_ERROR", payload: effect.message })
            }
          }
        });

        // ä¿®å¾©ï¼šæ–°å¢ ERROR_CLEANUP å‰¯ä½œç”¨è™•ç†å™¨ï¼Œç¢ºä¿éŒ¯èª¤æ™‚ç‹€æ…‹å®Œå…¨é‡ç½®
        smManager.registerSideEffectHandler('ERROR_CLEANUP', {
          handleSideEffect: (effect) => {
            console.log('ğŸ§¹ [å‰¯ä½œç”¨] ERROR_CLEANUP: æ¸…ç†éŒ¯èª¤ç‹€æ…‹', effect);

            // æ¸…ç†æ‰€æœ‰ç›¸é—œç‹€æ…‹
            dispatch({ type: "SET_SESSION", payload: null })
            dispatch({ type: "SET_RECORDING", payload: false })
            dispatch({ type: "SET_RECORDING_TIME", payload: 0 })

            console.log('âœ… [å‰¯ä½œç”¨] ERROR_CLEANUP: ç‹€æ…‹æ¸…ç†å®Œæˆ')
          }
        });

        setStateMachineManager(smManager);

        console.log('âœ… [AppStateProvider] åˆå§‹ç‹€æ…‹è¼‰å…¥å®Œæˆ:', {
          state: initialAppData.state,
          hasSession: !!initialAppData.session,
          transcriptCount: initialAppData.transcriptEntries.length,
          contentLength: initialAppData.editorContent.length
        })
      } catch (error) {
        console.error('âŒ [AppStateProvider] è¼‰å…¥åˆå§‹ç‹€æ…‹å¤±æ•—:', error)
      }
    }
  }, [servicesInitialized])

  // éŒ„éŸ³æ™‚é–“è¿½è¹¤
  useEffect(() => {
    let intervalId: NodeJS.Timeout | null = null

    if (state.appData.isRecording && servicesInitialized) {
      intervalId = setInterval(() => {
        const recordingService = serviceContainer.resolve<IRecordingService>(SERVICE_KEYS.RECORDING_SERVICE)
        console.log('Context instance', recordingService)
        const recordingTime = recordingService.getRecordingTime()
        dispatch({ type: "SET_RECORDING_TIME", payload: recordingTime })
      }, 1000)
    }

    return () => {
      if (intervalId) {
        clearInterval(intervalId)
      }
    }
  }, [state.appData.isRecording, servicesInitialized])

  // ç‹€æ…‹æŒä¹…åŒ–
  useEffect(() => {
    // æª¢æŸ¥æ˜¯å¦åœ¨ç€è¦½å™¨ç’°å¢ƒä¸”ç‹€æ…‹å·²åˆå§‹åŒ–
    if (typeof window !== 'undefined' && state.appData) {
      try {
        // å»¶é²å„²å­˜ï¼Œé¿å…åœ¨åˆå§‹è¼‰å…¥æ™‚ç«‹å³å„²å­˜
        const timeoutId = setTimeout(() => {
          InitialStateLoader.saveAppState(state.appData)
        }, 1000) // 1ç§’å»¶é²

        return () => clearTimeout(timeoutId)
      } catch (error) {
        console.error('âŒ [AppStateProvider] ç‹€æ…‹æŒä¹…åŒ–å¤±æ•—:', error)
      }
    }
  }, [state.appData])

  // å°‡ç‹€æ…‹è®Šæ›´åŒæ­¥åˆ°ç‹€æ…‹æ©Ÿ
  useEffect(() => {
    if (stateMachineManager) {
      stateMachineManager.getStateMachine().updateContext({
        currentState: state.appData.state,
        isRecording: state.appData.isRecording,
        transcriptCount: state.appData.transcriptEntries.length,
        session: state.appData.session,
        error: state.error
      });
    }
  }, [state, stateMachineManager]);

  const transition = useCallback((trigger: StateTransitionTrigger) => {
    if (!stateMachineManager) {
      console.error("ç‹€æ…‹æ©Ÿå°šæœªåˆå§‹åŒ–");
      return null;
    }
    const result = stateMachineManager.getStateMachine().transition(trigger);
    if (result.success) {
      dispatch({ type: 'SET_APP_STATE', payload: result.newState });
    }
    return result;
  }, [stateMachineManager]);

  const setState = useCallback((newState: AppState) => {
    dispatch({ type: "SET_STATE", payload: newState })
  }, [])

  const setRecording = useCallback((isRecording: boolean) => {
    dispatch({ type: "SET_RECORDING", payload: isRecording })
  }, [])

  const setRecordingTime = useCallback((time: number) => {
    dispatch({ type: "SET_RECORDING_TIME", payload: time })
  }, [])

  const setEditorContent = useCallback((content: string) => {
    dispatch({ type: "SET_EDITOR_CONTENT", payload: content })
  }, [])

  const setTranscriptEntries = useCallback((entries: TranscriptEntry[]) => {
    dispatch({ type: "SET_TRANSCRIPT_ENTRIES", payload: entries })
  }, [])

  const addTranscriptEntry = useCallback((entry: TranscriptEntry) => {
    dispatch({ type: "ADD_TRANSCRIPT_ENTRY", payload: entry })
  }, [])

  const setSession = useCallback((session: { id: string; status: SessionStatus; type: SessionType } | null) => {
    dispatch({ type: "SET_SESSION", payload: session })
  }, [])

  const updateSessionStatus = useCallback((status: SessionStatus) => {
    dispatch({ type: "UPDATE_SESSION_STATUS", payload: status })
  }, [])

  const resetState = useCallback(() => {
    dispatch({ type: "RESET_STATE" })
  }, [])

  const setLoading = useCallback((loading: boolean) => {
    dispatch({ type: "SET_LOADING", payload: loading })
  }, [])

  const setError = useCallback((error: string | null) => {
    dispatch({ type: "SET_ERROR", payload: error })
  }, [])

  const contextValue: AppStateContextValue = {
    appData: state.appData,
    isLoading: state.isLoading,
    error: state.error,
    dispatch,
    setState,
    setRecording,
    setRecordingTime,
    setEditorContent,
    setTranscriptEntries,
    addTranscriptEntry,
    setSession,
    updateSessionStatus,
    resetState,
    setLoading,
    setError,
    transition,
  }

  return React.createElement(
    AppStateContext.Provider,
    { value: contextValue },
    children
  )
}

export function useAppStateContext(): AppStateContextValue {
  const context = useContext(AppStateContext)
  if (!context) {
    throw new Error("useAppStateContext å¿…é ˆåœ¨ AppStateProvider å…§ä½¿ç”¨")
  }
  return context
}

export { AppStateContext }


# END FILE CONTENTS


# File: frontend/components/ui/input-otp.tsx

"use client"

import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }


# END FILE CONTENTS


# File: frontend/lib/services/simple-recording-service.ts

"use client"

import { BaseService } from './base-service'
import { IRecordingService, RecordingState } from './interfaces'
import { AdvancedAudioRecorder, AudioSegment, checkAdvancedAudioRecordingSupport } from '../advanced-audio-recorder'
import { RestAudioUploader, UploadSegmentResponse } from '../rest-audio-uploader'
import { getAudioChunkIntervalMs } from '../config'
import { toast } from '@/hooks/use-toast'

/**
 * SimpleRecordingService - ç°¡åŒ–éŒ„éŸ³ç®¡ç†æœå‹™
 *
 * Phase 2.5 é‡æ§‹ï¼šä½¿ç”¨ AdvancedAudioRecorder ä¿®å¾© WebM Header å•é¡Œ
 * æ•´åˆ AdvancedAudioRecorder + RestAudioUploader
 *
 * ç‰¹é»ï¼š
 * - ä½¿ç”¨ AdvancedAudioRecorderï¼ˆé›™ MediaRecorder ç„¡ç¸«åˆ‡æ›ç­–ç•¥ï¼‰
 * - ä½¿ç”¨ RestAudioUploaderï¼ˆREST API ä¸Šå‚³ï¼‰
 * - ç§»é™¤ ack/missing é‡å‚³æ©Ÿåˆ¶
 * - ç°¡åŒ–éŒ¯èª¤è™•ç†å’Œç‹€æ…‹ç®¡ç†
 * - æ”¯æ´å¤±æ•—æª”æ¡ˆæš«å­˜åˆ° IndexedDB
 */
export class SimpleRecordingService extends BaseService implements IRecordingService {
    protected readonly serviceName = 'SimpleRecordingService'

    // éŒ„éŸ³å™¨å’Œä¸Šå‚³å™¨å¼•ç”¨
    private audioRecorder: AdvancedAudioRecorder | null = null
    private audioUploader: RestAudioUploader | null = null

    // éŒ„éŸ³ç‹€æ…‹
    private recordingState: RecordingState = {
        isRecording: false,
        recordingTime: 0,
        currentSessionId: null,
        error: null
    }

    // è¨ˆæ™‚å™¨
    private recordingTimer: ReturnType<typeof setInterval> | null = null
    private uploadedSegments = new Set<number>()
    private failedSegments = new Set<number>()

    // åœ¨ class SimpleRecordingService å…§éƒ¨åŠ ä¸Šï¼š
    public stream: MediaStream | null = null
    private sessionId: string | null = null
    private timerStart: number | null = null

    /**
     * æœå‹™åˆå§‹åŒ–
     */
    async initialize(): Promise<void> {
        this.logInfo('æœå‹™åˆå§‹åŒ–é–‹å§‹')

        // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦
        const supportCheck = await checkAdvancedAudioRecordingSupport()
        if (!supportCheck.isSupported) {
            const errorMessage = `éŸ³é »éŒ„è£½ä¸æ”¯æ´: ${supportCheck.error || 'æœªçŸ¥éŒ¯èª¤'}`
            this.logWarning('ç€è¦½å™¨æ”¯æ´åº¦æª¢æŸ¥å¤±æ•—', supportCheck.error)
            throw new Error(errorMessage)
        }

        this.logSuccess('ç€è¦½å™¨æ”¯æ´åº¦æª¢æŸ¥é€šé')
        this.logSuccess('åˆå§‹åŒ–å®Œæˆ')
    }

    /**
     * æœå‹™æ¸…ç†
     */
    async cleanup(): Promise<void> {
        this.logInfo('æœå‹™æ¸…ç†é–‹å§‹')

        // å¦‚æœæ­£åœ¨éŒ„éŸ³ï¼Œå…ˆåœæ­¢
        if (this.recordingState.isRecording) {
            await this.stopRecording()
        }

        // æ¸…ç†éŸ³é »éŒ„è£½å™¨
        if (this.audioRecorder) {
            this.audioRecorder.cleanup()
            this.audioRecorder = null
        }

        // æ¸…ç†ä¸Šå‚³å™¨
        if (this.audioUploader) {
            this.audioUploader.cleanup()
            this.audioUploader = null
        }

        // æ¸…ç†è¨ˆæ™‚å™¨
        this.clearRecordingTimer()

        // é‡ç½®ç‹€æ…‹
        this.resetRecordingState()

        this.logSuccess('æ¸…ç†å®Œæˆ')
    }

    /**
     * é–‹å§‹éŒ„éŸ³
     */
    async startRecording(sessionId: string): Promise<void> {
        try {
            this.logInfo(`é–‹å§‹éŒ„éŸ³ - sessionId: ${sessionId}`)

            // å¦‚æœå·²ç¶“åœ¨éŒ„éŸ³ï¼Œå…ˆåœæ­¢
            if (this.recordingState.isRecording) {
                this.logWarning('å·²åœ¨éŒ„éŸ³ä¸­ï¼Œå…ˆåœæ­¢ç¾æœ‰éŒ„éŸ³')
                await this.stopRecording()
            }

            this.sessionId = sessionId
            this.recordingState.currentSessionId = sessionId

            // è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™
            await this.ensureStarted()

            // åˆå§‹åŒ–éŒ„éŸ³å™¨å’Œä¸Šå‚³å™¨
            await this.initMediaRecorder()

            // æ›´æ–°ç‹€æ…‹
            this.recordingState.isRecording = true
            this.recordingState.error = null

            // å•Ÿå‹•è¨ˆæ™‚å™¨
            this.timerStart = Date.now()
            this.startRecordingTimer()

            this.logSuccess(`éŒ„éŸ³å·²é–‹å§‹ - sessionId: ${sessionId}`)
        } catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
            this.recordingState.error = errorMessage
            this.handleError('é–‹å§‹éŒ„éŸ³', error)
            throw error
        }
    }

    /**
     * åœæ­¢éŒ„éŸ³
     */
    async stopRecording(): Promise<void> {
        this.logInfo('åœæ­¢éŒ„éŸ³')

        try {
            // æ›´æ–°ç‹€æ…‹
            this.recordingState.isRecording = false

            // åœæ­¢éŸ³é »éŒ„è£½å™¨
            if (this.audioRecorder) {
                this.audioRecorder.stop()
                this.logInfo('éŸ³é »éŒ„è£½å™¨å·²åœæ­¢')
            }

            // åœæ­¢è¨ˆæ™‚å™¨
            this.clearRecordingTimer()

            // æ¸…ç†éŸ³é »éŒ„è£½å™¨
            if (this.audioRecorder) {
                this.audioRecorder.cleanup()
                this.audioRecorder = null
            }

            this.logSuccess('éŒ„éŸ³åœæ­¢æˆåŠŸ', {
                sessionId: this.recordingState.currentSessionId,
                recordingTime: this.recordingState.recordingTime,
                uploadedSegments: this.uploadedSegments.size,
                failedSegments: this.failedSegments.size
            })

        } catch (error) {
            this.recordingState.error = error instanceof Error ? error.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
            this.handleError('åœæ­¢éŒ„éŸ³', error)
        }
    }

    /**
     * å–å¾—ç•¶å‰éŒ„éŸ³ç‹€æ…‹
     */
    getRecordingState(): RecordingState {
        return { ...this.recordingState }
    }

    /**
     * æª¢æŸ¥æ˜¯å¦æ­£åœ¨éŒ„éŸ³
     */
    isRecording(): boolean {
        return this.recordingState.isRecording
    }

    /**
     * å–å¾—éŒ„éŸ³æ™‚é–“ï¼ˆç§’ï¼‰
     */
    getRecordingTime(): number {
        return this.timerStart ? (Date.now() - this.timerStart) / 1000 | 0 : 0
    }

    /**
     * è¨­å®šéŸ³é »éŒ„è£½å™¨äº‹ä»¶è™•ç†
     */
    private setupAudioRecorderEvents(): void {
        if (!this.audioRecorder) return

        // è™•ç†éŒ„è£½éŒ¯èª¤
        this.audioRecorder.onError((error: Error) => {
            this.logWarning('éŸ³é »éŒ„è£½å™¨éŒ¯èª¤', error.message)
            this.recordingState.error = error.message
        })
    }

    /**
     * è¨­å®šä¸Šå‚³å™¨äº‹ä»¶è™•ç†
     */
    private setupUploaderEvents(): void {
        if (!this.audioUploader) return

        // è™•ç†ä¸Šå‚³æˆåŠŸ
        this.audioUploader.onUploadSuccess((seq: number, response: UploadSegmentResponse) => {
            this.uploadedSegments.add(seq)
            this.logInfo('éŸ³é »æ®µè½ä¸Šå‚³æˆåŠŸ', {
                sequence: seq,
                size: response.size,
                totalUploaded: this.uploadedSegments.size
            })
        })

        // è™•ç†ä¸Šå‚³éŒ¯èª¤
        this.audioUploader.onUploadError((seq: number, error: string) => {
            this.failedSegments.add(seq)
            this.logWarning('éŸ³é »æ®µè½ä¸Šå‚³å¤±æ•—', {
                sequence: seq,
                error,
                totalFailed: this.failedSegments.size
            })
        })

        // è™•ç†æš«å­˜åˆ°æœ¬åœ°
        this.audioUploader.onCacheStored((seq: number) => {
            this.logInfo('éŸ³é »æ®µè½å·²æš«å­˜åˆ°æœ¬åœ°', {
                sequence: seq,
                message: 'å¯ç¨å¾Œé‡æ–°ä¸Šå‚³'
            })
        })
    }

    /**
     * è™•ç†éŸ³é »æ®µè½
     */
    private async handleAudioSegment(segment: any): Promise<void> {
        console.log('ğŸ¤ [SimpleRecordingService] æ”¶åˆ°éŸ³é »æ®µè½', {
            sequence: segment.sequence,
            size: segment.blob.size,
            duration: segment.duration,
            timestamp: new Date().toISOString()
        })

        this.logInfo(`æ”¶åˆ°éŸ³é »æ®µè½ - sequence: ${segment.sequence}, size: ${segment.blob.size}, duration: ${segment.duration}`)

        // ä½¿ç”¨ REST API ä¸Šå‚³
        if (this.audioUploader) {
            try {
                await this.audioUploader.uploadSegment(segment.sequence, segment.blob)
            } catch (error) {
                // éŒ¯èª¤å·²ç”± audioUploader è™•ç†ï¼ˆé‡è©¦æˆ–æš«å­˜ï¼‰
                console.log(`âš ï¸ [SimpleRecordingService] æ®µè½ #${segment.sequence} ä¸Šå‚³è™•ç†ä¸­`)
            }
        } else {
            this.logWarning(`éŸ³é »ä¸Šå‚³å™¨æœªåˆå§‹åŒ– - sequence: ${segment.sequence}`)
        }
    }

    /**
     * é‡æ–°ä¸Šå‚³æš«å­˜çš„å¤±æ•—æ®µè½
     */
    async retryFailedUploads(): Promise<void> {
        this.logInfo('é–‹å§‹é‡æ–°ä¸Šå‚³æš«å­˜çš„å¤±æ•—æ®µè½')

        if (this.audioUploader) {
            try {
                await this.audioUploader.retryFailedSegments()
                this.logSuccess('æš«å­˜æ®µè½é‡æ–°ä¸Šå‚³å®Œæˆ')
            } catch (error) {
                this.logWarning('é‡æ–°ä¸Šå‚³æš«å­˜æ®µè½å¤±æ•—', error)
            }
        }
    }

    /**
     * å–å¾—æš«å­˜çš„å¤±æ•—æ®µè½æ•¸é‡
     */
    async getCachedSegmentsCount(): Promise<number> {
        if (this.audioUploader) {
            return await this.audioUploader.getCachedSegmentsCount()
        }
        return 0
    }

    /**
     * å•Ÿå‹•éŒ„éŸ³è¨ˆæ™‚å™¨
     */
    private startRecordingTimer(): void {
        this.clearRecordingTimer()
        this.recordingState.recordingTime = 0

        console.log('â±ï¸ [SimpleRecordingService] è¨ˆæ™‚å™¨å•Ÿå‹•')
        this.recordingTimer = setInterval(() => {
            this.recordingState.recordingTime += 1

            // æ¯ 30 ç§’è¨˜éŒ„ä¸€æ¬¡éŒ„éŸ³æ™‚é–“
            if (this.recordingState.recordingTime % 30 === 0) {
                this.logInfo('éŒ„éŸ³é€²è¡Œä¸­', {
                    recordingTime: this.recordingState.recordingTime,
                    minutes: Math.floor(this.recordingState.recordingTime / 60),
                    uploadedSegments: this.uploadedSegments.size,
                    failedSegments: this.failedSegments.size
                })
            }
        }, 1000)
    }

    /**
     * æ¸…ç†éŒ„éŸ³è¨ˆæ™‚å™¨
     */
    private clearRecordingTimer(): void {
        if (this.recordingTimer) {
            clearInterval(this.recordingTimer)
            this.recordingTimer = null
            console.log('â¹ï¸ [SimpleRecordingService] è¨ˆæ™‚å™¨æ¸…é™¤')
        }
    }

    /**
     * é‡ç½®éŒ„éŸ³ç‹€æ…‹
     */
    private resetRecordingState(): void {
        this.recordingState = {
            isRecording: false,
            recordingTime: 0,
            currentSessionId: null,
            error: null
        }
        this.uploadedSegments.clear()
        this.failedSegments.clear()
    }

    /**
     * æ¸…ç†éŒ„éŸ³ç›¸é—œè³‡æº
     */
    private async cleanupRecordingResources(): Promise<void> {
        try {
            // åœæ­¢éŸ³é »éŒ„è£½å™¨
            if (this.audioRecorder) {
                this.audioRecorder.stop()
                this.audioRecorder.cleanup()
                this.audioRecorder = null
            }

            // æ¸…ç†ä¸Šå‚³å™¨
            if (this.audioUploader) {
                this.audioUploader.cleanup()
                this.audioUploader = null
            }

            // æ¸…ç†è¨ˆæ™‚å™¨
            this.clearRecordingTimer()

            // é‡ç½®ç‹€æ…‹
            this.recordingState.isRecording = false

            this.logInfo('éŒ„éŸ³è³‡æºæ¸…ç†å®Œæˆ')
        } catch (error) {
            this.logWarning('æ¸…ç†éŒ„éŸ³è³‡æºæ™‚ç™¼ç”ŸéŒ¯èª¤', error)
        }
    }

    /**
     * ç²å–æœå‹™è©³ç´°ç‹€æ…‹
     */
    async getDetailedStatus(): Promise<SimpleRecordingServiceStatus> {
        const baseStatus = this.getStatus()
        const supportCheck = await checkAdvancedAudioRecordingSupport()
        const cachedCount = await this.getCachedSegmentsCount()

        return {
            ...baseStatus,
            recordingState: this.getRecordingState(),
            audioSupport: {
                supported: supportCheck.isSupported,
                errors: supportCheck.error ? [supportCheck.error] : []
            },
            audioRecorderState: this.audioRecorder?.recording ? 'recording' : 'idle',
            uploadStats: {
                uploaded: this.uploadedSegments.size,
                failed: this.failedSegments.size,
                cached: cachedCount
            }
        }
    }

    async requestPermission(): Promise<boolean> {
        try {
            this.stream = await navigator.mediaDevices.getUserMedia({ audio: true })
            return true
        } catch (e) {
            toast({ title: 'éœ€è¦éº¥å…‹é¢¨æ¬Šé™æ‰èƒ½éŒ„éŸ³', variant: 'destructive' })
            return false
        }
    }

    private async ensureStarted() {
        if (!this.stream) await this.start()
    }

    /**
     * åˆå§‹åŒ– MediaRecorder å’Œç›¸é—œå…ƒä»¶
     */
    private async initMediaRecorder(): Promise<void> {
        try {
            this.logInfo('åˆå§‹åŒ– MediaRecorder')

            if (!this.stream) {
                throw new Error('éŸ³è¨Šä¸²æµæœªåˆå§‹åŒ–')
            }

            if (!this.sessionId) {
                throw new Error('Session ID æœªè¨­å®š')
            }

            // å‰µå»ºéŸ³é »éŒ„è£½å™¨
            const chunkInterval = (await import('../config')).getAudioChunkIntervalMs()
            const { AdvancedAudioRecorder } = await import('../advanced-audio-recorder')
            this.audioRecorder = new AdvancedAudioRecorder({
                segmentDuration: chunkInterval,
                mimeType: 'audio/webm;codecs=opus',
                audioBitsPerSecond: 128000
            })

            // è¨­å®šéŒ„è£½å™¨äº‹ä»¶ï¼ˆéŒ¯èª¤è™•ç†ï¼‰
            this.setupAudioRecorderEvents()

            // å‰µå»ºä¸Šå‚³å™¨
            const { RestAudioUploader } = await import('../rest-audio-uploader')
            this.audioUploader = new RestAudioUploader()
            this.audioUploader.setSessionId(this.sessionId)

            // è¨­å®šä¸Šå‚³å™¨äº‹ä»¶
            this.setupUploaderEvents()

            // é–‹å§‹éŒ„éŸ³ä¸¦å‚³å…¥æ®µè½è™•ç† callback
            await this.audioRecorder.start(async (segment) => {
                await this.handleAudioSegment(segment)
            })

            this.logSuccess(`MediaRecorder åˆå§‹åŒ–å®Œæˆä¸¦é–‹å§‹éŒ„éŸ³ - sessionId: ${this.sessionId}, chunkInterval: ${chunkInterval}ms`)
        } catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
            this.logWarning(`åˆå§‹åŒ– MediaRecorder å¤±æ•—: ${errorMessage}`)
            throw error
        }
    }

    // è‹¥æœ‰ sessionId è®Šå‹•éœ€æ±‚ï¼Œå¯åŠ ä¸Šï¼š
    private updateSessionId(newSessionId: string): void {
        this.sessionId = newSessionId
        this.recordingState.currentSessionId = newSessionId
        if (this.audioUploader) {
            this.audioUploader.setSessionId(newSessionId)
        }
    }
}

/**
 * SimpleRecordingService è©³ç´°ç‹€æ…‹ä»‹é¢
 */
export interface SimpleRecordingServiceStatus {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    timestamp: string
    recordingState: RecordingState
    audioSupport: {
        supported: boolean
        errors: string[]
    }
    audioRecorderState: string
    uploadStats: {
        uploaded: number
        failed: number
        cached: number
    }
}


# END FILE CONTENTS


# File: app/api/notes.py

"""
StudyScriber Notes ç®¡ç† API ç«¯é»

å¯¦ä½œç­†è¨˜å„²å­˜ã€è‡ªå‹•å„²å­˜èˆ‡ UPSERT é‚è¼¯
"""

from datetime import datetime
from uuid import UUID
from fastapi import APIRouter, Depends, HTTPException, status
from supabase import Client
import json

from app.db.database import get_supabase_client
from app.schemas.note import (
    NoteSaveRequest, NoteOut, NoteSaveResponse, NoteConflictError
)

# å»ºç«‹è·¯ç”±å™¨
router = APIRouter(prefix="/api", tags=["ç­†è¨˜ç®¡ç†"])


@router.put("/notes/{session_id}", response_model=NoteSaveResponse)
async def save_note(
    session_id: UUID,
    request: NoteSaveRequest,
    supabase: Client = Depends(get_supabase_client)
) -> NoteSaveResponse:
    """
    å„²å­˜ç­†è¨˜å…§å®¹ (B-003)

    - å¯¦ä½œ UPSERT é‚è¼¯ï¼šæœ‰å‰‡æ›´æ–°ï¼Œç„¡å‰‡å»ºç«‹
    - æ™‚é–“æˆ³ç®¡ç†ï¼šæª¢æŸ¥å®¢æˆ¶ç«¯æ™‚é–“æˆ³é¿å…è¦†è“‹è¼ƒæ–°å…§å®¹
    - æ¬Šé™æª¢æŸ¥ï¼šç¢ºä¿æœƒè©±å­˜åœ¨ä¸”å¯ç·¨è¼¯
    - è‡ªå‹•æ›´æ–°æœƒè©±çš„ updated_at æ™‚é–“æˆ³
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨ä¸”å¯ç·¨è¼¯
        session = await _ensure_session_editable(supabase, session_id)

        # æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç­†è¨˜
        existing_note = await _get_existing_note(supabase, session_id)

        if existing_note:
            # æ›´æ–°ç¾æœ‰ç­†è¨˜
            updated_note = await _update_note(supabase, existing_note, request)
        else:
            # å»ºç«‹æ–°ç­†è¨˜
            updated_note = await _create_note(supabase, session_id, request)

        # æ›´æ–°æœƒè©±æ™‚é–“æˆ³
        await _update_session_timestamp(supabase, session_id)

        # æº–å‚™æ™‚é–“æˆ³
        server_ts = datetime.fromisoformat(updated_note['updated_at'].replace('Z', '+00:00')) if 'Z' in updated_note['updated_at'] else datetime.fromisoformat(updated_note['updated_at'])

        return NoteSaveResponse(
            success=True,
            message="ç­†è¨˜å·²æˆåŠŸå„²å­˜",
            server_ts=server_ts,
            note=NoteOut.model_validate(updated_note)
        )

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"å„²å­˜ç­†è¨˜æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.get("/notes/{session_id}", response_model=NoteOut)
async def get_note(
    session_id: UUID,
    supabase: Client = Depends(get_supabase_client)
) -> NoteOut:
    """
    å–å¾—ç­†è¨˜å…§å®¹

    - ç”¨æ–¼å‰ç«¯è¼‰å…¥ç¾æœ‰ç­†è¨˜
    - å¦‚æœç­†è¨˜ä¸å­˜åœ¨å‰‡è¿”å›ç©ºç™½ç­†è¨˜
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨
        await _ensure_session_exists(supabase, session_id)

        # æŸ¥è©¢ç­†è¨˜
        note = await _get_existing_note(supabase, session_id)

        if not note:
            # å¦‚æœç­†è¨˜ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºç™½ç­†è¨˜
            note = {
                'session_id': str(session_id),
                'content': "",
                'updated_at': datetime.utcnow().isoformat(),
                'client_ts': None
            }

        return NoteOut.model_validate(note)

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"å–å¾—ç­†è¨˜æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


# ç§æœ‰è¼”åŠ©å‡½å¼

async def _ensure_session_exists(supabase: Client, session_id: UUID) -> dict:
    """ç¢ºä¿æœƒè©±å­˜åœ¨"""
    response = supabase.table("sessions").select("*").eq("id", str(session_id)).limit(1).execute()

    if not response.data:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail={"error": "session_not_found", "message": "æŒ‡å®šçš„æœƒè©±ä¸å­˜åœ¨"}
        )

    return response.data[0]


async def _ensure_session_editable(supabase: Client, session_id: UUID) -> dict:
    """ç¢ºä¿æœƒè©±å­˜åœ¨ä¸”å¯ç·¨è¼¯"""
    session = await _ensure_session_exists(supabase, session_id)

    # æª¢æŸ¥æœƒè©±ç‹€æ…‹æ˜¯å¦å…è¨±ç·¨è¼¯
    if session.get('status') == 'error':
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail={
                "error": "session_not_editable",
                "message": f"æœƒè©±ç‹€æ…‹ç‚º {session.get('status')}ï¼Œç„¡æ³•ç·¨è¼¯ç­†è¨˜"
            }
        )

    return session


async def _get_existing_note(supabase: Client, session_id: UUID) -> dict | None:
    """å–å¾—ç¾æœ‰ç­†è¨˜"""
    response = supabase.table("notes").select("id, session_id, content, client_ts, created_at, updated_at").eq("session_id", str(session_id)).limit(1).execute()

    return response.data[0] if response.data else None


async def _update_note(supabase: Client, note: dict, request: NoteSaveRequest) -> dict:
    """æ›´æ–°ç¾æœ‰ç­†è¨˜"""
    # æª¢æŸ¥æ™‚é–“æˆ³è¡çªï¼ˆå¦‚æœæä¾›å®¢æˆ¶ç«¯æ™‚é–“æˆ³ï¼‰
    if request.client_ts:
        note_updated_at = datetime.fromisoformat(note['updated_at'].replace('Z', '+00:00'))
        if note_updated_at > request.client_ts:
            # æº–å‚™ä¼ºæœå™¨ç«¯ç­†è¨˜è³‡æ–™
            server_note_data = {
                'session_id': str(note['session_id']),
                'content': note['content'],
                'updated_at': note_updated_at,
                'client_ts': note.get('client_ts')
            }

            # å»ºç«‹éŒ¯èª¤ç‰©ä»¶
            conflict_error = NoteConflictError(
                message="å®¢æˆ¶ç«¯ç­†è¨˜ç‰ˆæœ¬è¼ƒèˆŠï¼Œè«‹é‡æ–°è¼‰å…¥æœ€æ–°ç‰ˆæœ¬",
                server_note=NoteOut.model_validate(server_note_data),
                client_ts=request.client_ts,
                server_ts=note_updated_at
            )

            # ä½¿ç”¨ model_dump_json ç¢ºä¿å®Œå…¨åºåˆ—åŒ–
            error_detail_str = conflict_error.model_dump_json()
            error_detail = json.loads(error_detail_str)

            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail=error_detail
            )

    # æ›´æ–°ç­†è¨˜å…§å®¹
    update_data = {
        'content': request.content,
        'client_ts': request.client_ts.isoformat() if request.client_ts else None,
        'updated_at': datetime.utcnow().isoformat()
    }

    response = supabase.table("notes").update(update_data).eq("session_id", str(note['session_id'])).execute()

    if not response.data:
        raise HTTPException(status_code=500, detail="ç„¡æ³•æ›´æ–°ç­†è¨˜")

    return response.data[0]


async def _create_note(supabase: Client, session_id: UUID, request: NoteSaveRequest) -> dict:
    """å»ºç«‹æ–°ç­†è¨˜"""
    current_time = datetime.utcnow().isoformat()
    note_data = {
        'session_id': str(session_id),
        'content': request.content,
        'client_ts': request.client_ts.isoformat() if request.client_ts else None,
        'updated_at': current_time
    }

    response = supabase.table("notes").insert(note_data).execute()

    if not response.data:
        raise HTTPException(status_code=500, detail="ç„¡æ³•å»ºç«‹ç­†è¨˜")

    return response.data[0]


async def _update_session_timestamp(supabase: Client, session_id: UUID) -> None:
    """æ›´æ–°æœƒè©±æ™‚é–“æˆ³"""
    update_data = {
        'updated_at': datetime.utcnow().isoformat()
    }

    supabase.table("sessions").update(update_data).eq("id", str(session_id)).execute()


# END FILE CONTENTS


# File: app/services/stt/base.py

from __future__ import annotations

import abc
from typing import Dict, Any
from uuid import UUID

__all__ = ["ISTTProvider"]

class ISTTProvider(abc.ABC):
    """èªéŸ³è½‰æ–‡å­— Provider ä»‹é¢ã€‚æ‰€æœ‰è½‰éŒ„æœå‹™éœ€å¯¦ä½œæ­¤ä»‹é¢ã€‚"""

    @abc.abstractmethod
    async def transcribe(self, webm: bytes, session_id: UUID, chunk_seq: int) -> Dict[str, Any]:
        """è½‰éŒ„æŒ‡å®š WebM éŸ³è¨Šã€‚

        Args:
            webm: åŸå§‹ WebM éŸ³è¨ŠäºŒé€²ä½è³‡æ–™ã€‚
            session_id: æœƒè©± IDã€‚
            chunk_seq: åˆ‡ç‰‡åºè™Ÿã€‚

        Returns:
            dict: éœ€åŒ…å« text, start_offset, end_offset ç­‰æ¬„ä½ï¼Œå‰ç«¯ä¿æŒä¸€è‡´ã€‚"""

    @abc.abstractmethod
    def name(self) -> str:
        """å›å‚³ Provider åç¨± (ä¾‹å¦‚ 'whisper', 'gemini')"""

    @abc.abstractmethod
    def max_rpm(self) -> int:
        """API é€Ÿç‡é™åˆ¶ï¼šæ¯åˆ†é˜æœ€å¤§è«‹æ±‚æ•¸ (RateLimiter ç”¨)"""


# END FILE CONTENTS


# File: main.py

"""
StudyScriber FastAPI æ‡‰ç”¨ç¨‹å¼ä¸»å…¥å£

é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼šé‚ŠéŒ„é‚Šè½‰éŒ„ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³æ¨¡å¼
"""

import os
import uvicorn
from contextlib import asynccontextmanager
from fastapi import FastAPI, HTTPException, WebSocket
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import JSONResponse, Response
from datetime import datetime
import logging

# Task 5: Prometheus ç›£æ§æ”¯æ´
try:
    from prometheus_client import generate_latest, CONTENT_TYPE_LATEST
    PROMETHEUS_AVAILABLE = True
except ImportError:
    PROMETHEUS_AVAILABLE = False

from app.db.database import auto_init_database, check_database_connection, check_tables_exist, get_database_stats, get_database_mode
from app.api.sessions import router as sessions_router
from app.api.notes import router as notes_router
from app.api.segments import router as segments_router
from app.ws.upload_audio import router as upload_audio_router
from app.ws.transcript_feed import router as transcript_feed_router
from app.core.ffmpeg import check_ffmpeg_health
from app.core.config import settings
from app.core.container import container
from app.services.stt.factory import get_provider
from app.services.azure_openai_v2 import queue_manager

# é…ç½®æ—¥èªŒ
logging.basicConfig(level=settings.LOG_LEVEL, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

@asynccontextmanager
async def lifespan(app: FastAPI):
    """
    æ‡‰ç”¨ç¨‹å¼ç”Ÿå‘½é€±æœŸç®¡ç†

    å•Ÿå‹•æ™‚åˆå§‹åŒ–è³‡æ–™åº«ï¼Œé—œé–‰æ™‚æ¸…ç†è³‡æº
    """
    # å•Ÿå‹•æ™‚åŸ·è¡Œ
    logger.info("ğŸš€ StudyScriber æ­£åœ¨å•Ÿå‹•...")
    check_ffmpeg_health()
    await check_database_connection()

    # Task 3: å•Ÿå‹•éšŠåˆ—ç®¡ç†å™¨
    try:
        await queue_manager.start_workers()
        logger.info("âœ… è½‰éŒ„éšŠåˆ—ç®¡ç†å™¨å•Ÿå‹•æˆåŠŸ")
    except Exception as e:
        logger.error(f"âŒ éšŠåˆ—ç®¡ç†å™¨å•Ÿå‹•å¤±æ•—: {e}")

    yield

    # é—œé–‰æ™‚åŸ·è¡Œ
    logger.info("ğŸ”„ StudyScriber æ­£åœ¨é—œé–‰...")

    # Task 3: åœæ­¢éšŠåˆ—ç®¡ç†å™¨
    try:
        await queue_manager.stop_workers()
        logger.info("âœ… è½‰éŒ„éšŠåˆ—ç®¡ç†å™¨å·²åœæ­¢")
    except Exception as e:
        logger.warning(f"âš ï¸ éšŠåˆ—ç®¡ç†å™¨åœæ­¢æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")

# å»ºç«‹ FastAPI æ‡‰ç”¨ç¨‹å¼
app = FastAPI(
    title="StudyScriber API",
    description="é›²ç«¯ç­†è¨˜æ‡‰ç”¨ï¼šé‚ŠéŒ„é‚Šè½‰éŒ„ï¼Œæ”¯æ´ç´”ç­†è¨˜èˆ‡éŒ„éŸ³æ¨¡å¼",
    version="0.1.0",
    lifespan=lifespan
)

# CORS è¨­å®š
cors_origins = os.getenv("CORS_ORIGINS", "http://localhost:3000").split(",")
app.add_middleware(
    CORSMiddleware,
    allow_origins=cors_origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# è¨»å†Šè·¯ç”±
app.include_router(sessions_router)
app.include_router(notes_router)
app.include_router(segments_router)
app.include_router(upload_audio_router)
app.include_router(transcript_feed_router)


@app.get("/")
async def root():
    """æ ¹è·¯ç”± - API ç‹€æ…‹æª¢æŸ¥"""
    return {
        "message": "StudyScriber API is running",
        "version": "0.1.0",
        "status": "healthy"
    }


@app.get("/debug/container")
async def debug_container():
    """é™¤éŒ¯ç«¯é» - æª¢æŸ¥ provider ç‹€æ…‹"""
    try:
        # æŸ¥è©¢ provider ç‹€æ…‹
        # é€™è£¡åƒ…ç¤ºç¯„æŸ¥è©¢ä¸€å€‹ sessionï¼ˆå¯æ ¹æ“šå¯¦éš›éœ€æ±‚èª¿æ•´ï¼‰
        from uuid import UUID
        test_session_id = UUID("00000000-0000-0000-0000-000000000000")  # TODO: æ”¹ç‚ºå¯¦éš› session id
        provider = get_provider(test_session_id)
        return {
            "status": "success",
            "provider": provider.name(),
            "class_name": type(provider).__name__,
        }
    except Exception as e:
        return {
            "status": "error",
            "error": str(e)
        }


@app.get("/health")
async def health_check():
    """å¥åº·æª¢æŸ¥ç«¯é»"""
    try:
        db_ok = await check_database_connection()
        if not db_ok:
            raise HTTPException(status_code=503, detail="Database connection failed")
        tables_ok = await check_tables_exist()
        if not tables_ok:
            raise HTTPException(status_code=503, detail="Database tables missing")
        ffmpeg_health = check_ffmpeg_health()
        # æŸ¥è©¢ provider ç‹€æ…‹
        from uuid import UUID
        test_session_id = UUID("00000000-0000-0000-0000-000000000000")  # TODO: æ”¹ç‚ºå¯¦éš› session id
        try:
            provider = get_provider(test_session_id)
            provider_available = provider is not None
        except Exception as e:
            logger.warning(f"Provider è§£æå¤±æ•—: {e}")
            provider_available = False
        return {
            "status": "healthy",
            "database": "connected",
            "tables": "available",
            "services": {
                "ffmpeg": {
                    "available": ffmpeg_health['ffmpeg_available'],
                    "status": ffmpeg_health['status'],
                    "version": ffmpeg_health.get('version', 'N/A'),
                    "processes": {
                        "active": ffmpeg_health.get('active_processes', 0),
                        "pooled": ffmpeg_health.get('pooled_processes', 0),
                        "max": ffmpeg_health.get('max_processes', 3)
                    }
                },
                "provider": {
                    "available": provider_available,
                    "service": provider.name() if provider_available else "Disabled"
                }
            }
        }
    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(status_code=503, detail=f"Health check failed: {str(e)}")


@app.get("/database")
async def database_info():
    """è³‡æ–™åº«è³‡è¨Šç«¯é»"""
    try:
        # å–å¾—è³‡æ–™åº«çµ±è¨ˆ
        db_stats = await get_database_stats()

        # å–å¾—é€£æ¥æ¨¡å¼
        connection_mode = get_database_mode()

        # æª¢æŸ¥é€£æ¥ç‹€æ…‹
        connection_ok = await check_database_connection()

        # æª¢æŸ¥è¡¨æ ¼ç‹€æ…‹
        tables_ok = await check_tables_exist()

        return {
            "status": "success",
            "timestamp": datetime.utcnow().isoformat(),
            "connection": {
                "mode": connection_mode,
                "status": "connected" if connection_ok else "disconnected",
                "tables_available": tables_ok
            },
            "statistics": db_stats
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ç„¡æ³•å–å¾—è³‡æ–™åº«è³‡è¨Š: {str(e)}")


@app.get("/performance")
async def performance_stats():
    """æ•ˆèƒ½çµ±è¨ˆç«¯é»"""
    try:
        # å–å¾—è½‰éŒ„æœå‹™æ•ˆèƒ½çµ±è¨ˆ
        # é€™è£¡éœ€è¦æ ¹æ“šå¯¦éš›çš„ provider æ¶æ§‹ä¾†èª¿æ•´ï¼Œ
        # ä¾‹å¦‚ï¼Œå¦‚æœ provider æœ¬èº«æœ‰ get_performance_report æ–¹æ³•
        # å‰‡å¯ä»¥å¾ provider ç²å–ï¼Œå¦å‰‡è¿”å›é è¨­å€¼ã€‚
        # ç›®å‰ï¼Œæˆ‘å€‘åªä¿ç•™äº† queue_manager çš„å•Ÿå‹•/é—œé–‰ï¼Œ
        # æ‰€ä»¥é€™è£¡è¿”å›ä¸€å€‹é è¨­å€¼ã€‚
        return {
            "status": "success",
            "timestamp": datetime.utcnow().isoformat(),
            "transcription_service": {"status": "no_stats_available"},
            "ffmpeg_service": {
                "status": "N/A",
                "available": False,
                "active_processes": 0,
                "pooled_processes": 0
            }
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ç„¡æ³•å–å¾—æ•ˆèƒ½çµ±è¨ˆ: {str(e)}")


@app.get("/debug/queue")
async def debug_queue():
    """Task 3 & 4: é™¤éŒ¯ç«¯é» - æª¢æŸ¥éšŠåˆ—ç‹€æ…‹"""
    try:
        stats = queue_manager.get_stats()
        return {
            "status": "success",
            "queue_stats": stats,
            "timestamp": datetime.utcnow().isoformat()
        }
    except Exception as e:
        return {
            "status": "error",
            "queue_stats": {
                "error": str(e)
            }
        }


@app.get("/metrics")
async def metrics():
    """Task 5: Prometheus ç›£æ§æŒ‡æ¨™ç«¯é»"""
    if not PROMETHEUS_AVAILABLE:
        raise HTTPException(
            status_code=503,
            detail="Prometheus metrics not available - prometheus-client not installed"
        )

    try:
        # ç”Ÿæˆ Prometheus æ ¼å¼çš„ç›£æ§æŒ‡æ¨™
        metrics_data = generate_latest()
        return Response(
            content=metrics_data,
            media_type=CONTENT_TYPE_LATEST,
            headers={
                "Content-Type": CONTENT_TYPE_LATEST,
                "Cache-Control": "no-cache, no-store, must-revalidate",
                "Pragma": "no-cache",
                "Expires": "0"
            }
        )
    except Exception as e:
        logger.error(f"Failed to generate metrics: {e}")
        raise HTTPException(
            status_code=500,
            detail=f"Failed to generate metrics: {str(e)}"
        )


# å…¨åŸŸä¾‹å¤–è™•ç†å™¨
@app.exception_handler(Exception)
async def global_exception_handler(request, exc):
    """å…¨åŸŸä¾‹å¤–è™•ç†"""
    return JSONResponse(
        status_code=500,
        content={
            "error": "Internal server error",
            "message": str(exc),
            "path": str(request.url)
        }
    )


if __name__ == "__main__":
    # è¨­ç½® workers=1 ç¢ºä¿åœ¨å–®ä¸€é€²ç¨‹ä¸­é‹è¡Œï¼Œ
    # é€™å°æ–¼ä½¿ç”¨å…§å­˜å­˜å„² WebSocket é€£æ¥ç‹€æ…‹è‡³é—œé‡è¦ã€‚
    # å¤šé€²ç¨‹æœƒå°è‡´æ¯å€‹é€²ç¨‹æœ‰ç¨ç«‹çš„ ConnectionManager å¯¦ä¾‹ã€‚
    uvicorn.run(
        "main:app",
        host="0.0.0.0",
        port=8000,
        reload=True,
        workers=1
    )


# END FILE CONTENTS


# File: frontend/playwright.config.ts

import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
    testDir: '../tests/frontend',
    outputDir: '../tests/frontend/test-results',
    timeout: 60000,
    use: {
        headless: true,
        baseURL: 'http://localhost:3100',
    },
    webServer: {
        command: 'pnpm dev --port 3100',
        url: 'http://localhost:3100',
        timeout: 120000,
        reuseExistingServer: !process.env.CI,
        cwd: '.',
    },
    projects: [
        {
            name: 'chromium',
            use: { ...devices['Desktop Chrome'] },
        },
    ],
})


# END FILE CONTENTS


# File: frontend/components/recording-waiting-state.tsx

"use client"

import { useState, useCallback } from "react"
import { ScrollArea } from "@/components/ui/scroll-area"
import { Button } from "@/components/ui/button"
import { Square, AlertCircle } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"
import type { TranscriptEntry } from "../types/app-state"

interface RecordingWaitingStateProps {
    recordingTime: number
    onStopRecording: () => void
    transcriptEntries: TranscriptEntry[]
    error?: string | null
}

export function RecordingWaitingState({
    recordingTime,
    onStopRecording,
    transcriptEntries,
    error
}: RecordingWaitingStateProps) {
    const [isAutoScrollLocked, setIsAutoScrollLocked] = useState(true)

    const toggleAutoScrollLock = useCallback(() => {
        setIsAutoScrollLocked(prev => !prev)
    }, [])

    const formatTime = (seconds: number) => {
        const mins = Math.floor(seconds / 60)
        const secs = seconds % 60
        return `${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`
    }

    return (
        <div className="h-full flex flex-col">
            <ScrollArea className="flex-1">
                {error && (
                    <Alert variant="destructive" className="m-4">
                        <AlertCircle className="h-4 w-4" />
                        <AlertDescription>{error}</AlertDescription>
                    </Alert>
                )}

                {transcriptEntries.length > 0 ? (
                    <div className="p-4 space-y-4">
                        {transcriptEntries.map((entry, index) => (
                            <div key={index} className="flex gap-4 text-sm">
                                <span className="text-muted-foreground font-mono">{entry.time}</span>
                                <span className="flex-1">{entry.text}</span>
                            </div>
                        ))}
                    </div>
                ) : (
                    <div className="flex flex-col items-center justify-center h-full p-8 text-muted-foreground text-center space-y-2">
                        <div className="text-sm">
                            Recordingâ€¦ {formatTime(recordingTime)}
                        </div>
                        <div className="text-xs">
                            {error ? "è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤" : "è½‰éŒ„ä¸­"}
                        </div>
                    </div>
                )}
            </ScrollArea>

            <div className="p-4 border-t border-border flex justify-end">
                <Button onClick={onStopRecording} variant="destructive" size="sm" className="flex items-center gap-2">
                    <Square className="w-4 h-4" />
                    Stop
                </Button>
            </div>
        </div>
    )
}


# END FILE CONTENTS


# File: frontend/e2e/service-layer-integration.spec.ts

import { test, expect } from '@playwright/test'

/**
 * æœå‹™å±¤æ•´åˆæ¸¬è©¦ - å®Œæ•´é©—è­‰é‡æ§‹å¾Œçš„ç³»çµ±
 */

test.describe('æœå‹™å±¤æ•´åˆæ¸¬è©¦', () => {
    let consoleLogs: string[] = []
    let consoleErrors: string[] = []

    test.beforeEach(async ({ page }) => {
        consoleLogs = []
        consoleErrors = []

        // ç›£è½ console è¼¸å‡º
        page.on('console', (msg) => {
            const text = `[${msg.type()}] ${msg.text()}`
            console.log(`ğŸ–¥ï¸  ${text}`)

            if (msg.type() === 'error') {
                consoleErrors.push(text)
            } else {
                consoleLogs.push(text)
            }
        })

        page.on('pageerror', (error) => {
            console.log(`âŒ Page Error: ${error.message}`)
            consoleErrors.push(`PAGE_ERROR: ${error.message}`)
        })

        console.log('ğŸš€ å°èˆªåˆ°æ‡‰ç”¨...')
        await page.goto('/')
        await page.waitForLoadState('networkidle')
        console.log('âœ… é é¢è¼‰å…¥å®Œæˆ')
    })

    test('åŸºç¤æ¶æ§‹é©—è­‰', async ({ page }) => {
        console.log('\nğŸ”§ é©—è­‰æœå‹™å±¤åŸºç¤æ¶æ§‹...')

        await expect(page.locator('body')).toBeVisible()
        await page.waitForTimeout(3000)

        const result = await page.evaluate(() => ({
            hasWindow: typeof window !== 'undefined',
            windowKeys: Object.keys(window).length,
            appElements: document.querySelectorAll('[id*="root"], main, .app').length
        }))

        console.log('ğŸ“Š åŸºç¤æª¢æŸ¥:', result)
        console.log(`ğŸ“Š Console Logs: ${consoleLogs.length}`)
        console.log(`âŒ Errors: ${consoleErrors.length}`)
    })

    test('éŒ„éŸ³åŠŸèƒ½å®Œæ•´æ¸¬è©¦', async ({ page }) => {
        console.log('\nğŸ¤ æ¸¬è©¦éŒ„éŸ³åŠŸèƒ½...')

        await page.context().grantPermissions(['microphone'])

        const buttons = await page.locator('button').all()
        console.log(`ğŸ“Š æ‰¾åˆ° ${buttons.length} å€‹æŒ‰éˆ•`)

        for (const button of buttons.slice(0, 3)) {
            const text = await button.textContent()
            const isVisible = await button.isVisible()
            const isEnabled = await button.isEnabled()

            console.log(`ğŸ“‹ æŒ‰éˆ•: "${text}" - å¯è¦‹:${isVisible}, å•Ÿç”¨:${isEnabled}`)

            if (isVisible && isEnabled && text?.trim()) {
                console.log(`ğŸ”„ é»æ“Š: "${text}"`)
                const logsBefore = consoleLogs.length

                await button.click()
                await page.waitForTimeout(2000)

                const newLogs = consoleLogs.slice(logsBefore)
                console.log(`ğŸ“ æ–°å¢ ${newLogs.length} æ¢æ—¥èªŒ`)
                newLogs.forEach(log => console.log(`   ${log}`))
            }
        }
    })

    test('æœå‹™å±¤æ—¥èªŒåˆ†æ', async ({ page }) => {
        console.log('\nğŸ” åˆ†ææœå‹™å±¤æ—¥èªŒ...')

        await page.waitForTimeout(2000)

        // è§¸ç™¼ä¸€äº›äº’å‹•
        const elements = page.locator('button, input, [role="button"]')
        const count = await elements.count()

        for (let i = 0; i < Math.min(3, count); i++) {
            try {
                await elements.nth(i).click()
                await page.waitForTimeout(500)
            } catch { }
        }

        // åˆ†ææ—¥èªŒ
        const serviceLogs = consoleLogs.filter(log =>
            log.toLowerCase().includes('service') ||
            log.toLowerCase().includes('container')
        )

        const recordingLogs = consoleLogs.filter(log =>
            log.toLowerCase().includes('record') ||
            log.toLowerCase().includes('audio')
        )

        const stateLogs = consoleLogs.filter(log =>
            log.toLowerCase().includes('state') ||
            log.toLowerCase().includes('action')
        )

        console.log('\nğŸ“Š æ—¥èªŒåˆ†æ:')
        console.log(`   æœå‹™å±¤: ${serviceLogs.length}`)
        console.log(`   éŒ„éŸ³: ${recordingLogs.length}`)
        console.log(`   ç‹€æ…‹: ${stateLogs.length}`)
        console.log(`   ç¸½è¨ˆ: ${consoleLogs.length}`)
        console.log(`   éŒ¯èª¤: ${consoleErrors.length}`)

        if (serviceLogs.length > 0) {
            console.log('\nğŸ”§ æœå‹™å±¤æ—¥èªŒ:')
            serviceLogs.forEach(log => console.log(`   ${log}`))
        }

        if (recordingLogs.length > 0) {
            console.log('\nğŸ¤ éŒ„éŸ³æ—¥èªŒ:')
            recordingLogs.forEach(log => console.log(`   ${log}`))
        }
    })

    test.afterEach(async () => {
        console.log('\nğŸ“‹ æ¸¬è©¦ç¸½çµ:')
        console.log(`ğŸ“Š Console Logs: ${consoleLogs.length}`)
        console.log(`âŒ Errors: ${consoleErrors.length}`)

        if (consoleErrors.length > 0) {
            console.log('\nâŒ éŒ¯èª¤è©³æƒ…:')
            consoleErrors.forEach(error => console.log(`   ${error}`))
        }

        console.log('ğŸ æ¸¬è©¦å®Œæˆ\n' + '='.repeat(50))
    })
})


# END FILE CONTENTS


# File: frontend/styles/globals.css

@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  font-family: Arial, Helvetica, sans-serif;
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 0 0% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 3.9%;
    --primary: 0 0% 9%;
    --primary-foreground: 0 0% 98%;
    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 9%;
    --muted: 0 0% 96.1%;
    --muted-foreground: 0 0% 45.1%;
    --accent: 0 0% 96.1%;
    --accent-foreground: 0 0% 9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 89.8%;
    --input: 0 0% 89.8%;
    --ring: 0 0% 3.9%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
  .dark {
    --background: 0 0% 3.9%;
    --foreground: 0 0% 98%;
    --card: 0 0% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 0 0% 98%;
    --primary-foreground: 0 0% 9%;
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;
    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 83.1%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}


# END FILE CONTENTS


# File: app/api/__init__.py



# END FILE CONTENTS


# File: frontend/__tests__/integration/state-transitions.test.ts

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { StateMachine } from '../../lib/state-machine'
import { featureFlagManager } from '../../lib/feature-flags'
import type { AppState } from '../../types/app-state'
import type { StateTransitionContext } from '../../types/state-transitions'

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
    clear: vi.fn(),
}

Object.defineProperty(window, 'localStorage', {
    value: localStorageMock
})

describe('ç‹€æ…‹è½‰æ›æ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        featureFlagManager.reset()
        featureFlagManager.enable('useNewStateManagement')
        localStorageMock.getItem.mockReturnValue(null)
    })

    describe('åŸºæœ¬ç‹€æ…‹è½‰æ›', () => {
        test('æ‡‰è©²æ”¯æ´ default â†’ recording_waiting è½‰æ›', () => {
            const stateMachine = new StateMachine('default')

            const canTransition = stateMachine.canTransition('START_RECORDING')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('START_RECORDING')
            expect(newState).toBe('recording_waiting')
        })

        test('æ‡‰è©²æ”¯æ´ recording_waiting â†’ recording_active è½‰æ›', () => {
            const stateMachine = new StateMachine('recording_waiting')

            const canTransition = stateMachine.canTransition('RECORDING_STARTED')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('RECORDING_STARTED')
            expect(newState).toBe('recording_active')
        })

        test('æ‡‰è©²æ”¯æ´ recording_active â†’ processing è½‰æ›', () => {
            const stateMachine = new StateMachine('recording_active')

            const canTransition = stateMachine.canTransition('STOP_RECORDING')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('STOP_RECORDING')
            expect(newState).toBe('processing')
        })

        test('æ‡‰è©²æ”¯æ´ processing â†’ finished è½‰æ›', () => {
            const stateMachine = new StateMachine('processing')

            const canTransition = stateMachine.canTransition('PROCESSING_COMPLETE')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('PROCESSING_COMPLETE')
            expect(newState).toBe('finished')
        })
    })

    describe('ç‹€æ…‹è½‰æ›é™åˆ¶', () => {
        test('ä¸æ‡‰è©²å…è¨±ç„¡æ•ˆçš„ç‹€æ…‹è½‰æ›', () => {
            const stateMachine = new StateMachine('default')

            // ä¸èƒ½ç›´æ¥å¾ default è·³åˆ° recording_active
            const canTransition = stateMachine.canTransition('RECORDING_STARTED')
            expect(canTransition).toBe(false)

            // å˜—è©¦ç„¡æ•ˆè½‰æ›æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
            expect(() => {
                stateMachine.transition('RECORDING_STARTED')
            }).toThrow()
        })

        test('finished ç‹€æ…‹æ‡‰è©²åªèƒ½é‡ç½®åˆ° default', () => {
            const stateMachine = new StateMachine('finished')

            // åªèƒ½é‡ç½®
            expect(stateMachine.canTransition('RESET')).toBe(true)
            expect(stateMachine.canTransition('START_RECORDING')).toBe(false)
            expect(stateMachine.canTransition('STOP_RECORDING')).toBe(false)

            const newState = stateMachine.transition('RESET')
            expect(newState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´å¾ä»»ä½•ç‹€æ…‹é‡ç½®åˆ° default', () => {
            const states: AppState[] = ['default', 'recording_waiting', 'recording_active', 'processing', 'finished']

            states.forEach(state => {
                const stateMachine = new StateMachine(state)
                expect(stateMachine.canTransition('RESET')).toBe(true)
                expect(stateMachine.transition('RESET')).toBe('default')
            })
        })
    })

    describe('å®Œæ•´ç‹€æ…‹æµç¨‹', () => {
        test('æ‡‰è©²æ”¯æ´å®Œæ•´çš„éŒ„éŸ³æµç¨‹', () => {
            const stateMachine = new StateMachine('default')

            // å®Œæ•´æµç¨‹ï¼šdefault â†’ recording_waiting â†’ recording_active â†’ processing â†’ finished
            expect(stateMachine.getCurrentState()).toBe('default')

            // é–‹å§‹éŒ„éŸ³
            const waitingState = stateMachine.transition('START_RECORDING')
            expect(waitingState).toBe('recording_waiting')

            // éŒ„éŸ³é–‹å§‹
            const activeState = stateMachine.transition('RECORDING_STARTED')
            expect(activeState).toBe('recording_active')

            // åœæ­¢éŒ„éŸ³
            const processingState = stateMachine.transition('STOP_RECORDING')
            expect(processingState).toBe('processing')

            // è™•ç†å®Œæˆ
            const finishedState = stateMachine.transition('PROCESSING_COMPLETE')
            expect(finishedState).toBe('finished')

            // é‡ç½®
            const resetState = stateMachine.transition('RESET')
            expect(resetState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´ç­†è¨˜æ¨¡å¼æµç¨‹', () => {
            const stateMachine = new StateMachine('default')

            // ç­†è¨˜æ¨¡å¼ï¼šdefault â†’ finished (ç›´æ¥å®Œæˆ)
            expect(stateMachine.getCurrentState()).toBe('default')

            const finishedState = stateMachine.transition('FINISH_SESSION')
            expect(finishedState).toBe('finished')
        })
    })

    describe('éŒ¯èª¤æ¢å¾©', () => {
        test('æ‡‰è©²æ”¯æ´éŒ¯èª¤ç‹€æ…‹æ¢å¾©', () => {
            const stateMachine = new StateMachine('recording_active')

            // å¾éŒ„éŸ³ä¸­ç™¼ç”ŸéŒ¯èª¤
            const errorState = stateMachine.transition('ERROR')
            expect(errorState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´æœƒè©±å‡ç´š', () => {
            const stateMachine = new StateMachine('default')

            // å‡ç´šåˆ°éŒ„éŸ³æ¨¡å¼
            const upgradedState = stateMachine.transition('UPGRADE_TO_RECORDING')
            expect(upgradedState).toBe('recording_waiting')
        })
    })

    describe('ä¸¦ç™¼ç‹€æ…‹è®Šæ›´', () => {
        test('ç‹€æ…‹æ©Ÿæ‡‰è©²æ˜¯ç·šç¨‹å®‰å…¨çš„', () => {
            const stateMachine = new StateMachine('default')
            const results: AppState[] = []

            // æ¨¡æ“¬ä¸¦ç™¼è½‰æ›
            const transitions = [
                'START_RECORDING',
                'RESET',
                'START_RECORDING',
                'RESET'
            ]

            transitions.forEach(trigger => {
                try {
                    const newState = stateMachine.transition(trigger as any)
                    results.push(newState)
                } catch (error) {
                    // æŸäº›è½‰æ›å¯èƒ½å¤±æ•—ï¼Œé€™æ˜¯é æœŸçš„
                }
            })

            // æœ€å¾Œç‹€æ…‹æ‡‰è©²æ˜¯æœ‰æ•ˆçš„
            const finalState = stateMachine.getCurrentState()
            const validStates: AppState[] = ['default', 'recording_waiting', 'recording_active', 'processing', 'finished']
            expect(validStates).toContain(finalState)
        })
    })

    describe('ç‹€æ…‹æ­·å²', () => {
        test('æ‡‰è©²è¨˜éŒ„ç‹€æ…‹è½‰æ›æ­·å²', () => {
            const stateMachine = new StateMachine('default')

            stateMachine.transition('START_RECORDING')
            stateMachine.transition('RECORDING_STARTED')
            stateMachine.transition('STOP_RECORDING')

            const history = stateMachine.getHistory()
            expect(history).toHaveLength(4) // åŒ…å«åˆå§‹ç‹€æ…‹
            expect(history[0]).toBe('default')
            expect(history[1]).toBe('recording_waiting')
            expect(history[2]).toBe('recording_active')
            expect(history[3]).toBe('processing')
        })

        test('æ‡‰è©²æ”¯æ´å›åˆ°ä¸Šä¸€å€‹ç‹€æ…‹', () => {
            const stateMachine = new StateMachine('default')

            stateMachine.transition('START_RECORDING')
            stateMachine.transition('RECORDING_STARTED')

            const canGoBack = stateMachine.canGoBack()
            expect(canGoBack).toBe(true)

            const previousState = stateMachine.goBack()
            expect(previousState).toBe('recording_waiting')
            expect(stateMachine.getCurrentState()).toBe('recording_waiting')
        })
    })
})


# END FILE CONTENTS


# File: frontend/lib/interfaces.ts

export interface ISessionService {
    ensureFreshRecordingSession(): Promise<void>
}


# END FILE CONTENTS


# File: frontend/lib/app-state-reducer.ts

import { AppStateAction, initialAppData } from "../types/app-state-context"
import { AppData } from "../types/app-state"

export interface AppStateReducerState {
  appData: AppData
  isLoading: boolean
  error: string | null
}

export function appStateReducer(
  state: AppStateReducerState,
  action: AppStateAction
): AppStateReducerState {
  console.log('ğŸ”„ [AppStateReducer] Action:', action.type, action)

  switch (action.type) {
    case "SET_STATE":
    case "SET_APP_STATE":  // åˆ¥åï¼Œç‚ºäº†å‘å¾Œç›¸å®¹
      return {
        ...state,
        appData: {
          ...state.appData,
          state: action.payload,
        },
      }

    case "SET_RECORDING":
      return {
        ...state,
        appData: {
          ...state.appData,
          isRecording: action.payload,
        },
      }

    case "SET_RECORDING_TIME":
      console.log('â° [AppStateReducer] æ›´æ–°éŒ„éŸ³æ™‚é–“:', action.payload)
      return {
        ...state,
        appData: {
          ...state.appData,
          recordingTime: action.payload,
        },
      }

    case "SET_EDITOR_CONTENT":
      return {
        ...state,
        appData: {
          ...state.appData,
          editorContent: action.payload,
        },
      }

    case "SET_TRANSCRIPT_ENTRIES":
      return {
        ...state,
        appData: {
          ...state.appData,
          transcriptEntries: action.payload,
        },
      }

    case "ADD_TRANSCRIPT_ENTRY":
      return {
        ...state,
        appData: {
          ...state.appData,
          transcriptEntries: [...state.appData.transcriptEntries, action.payload],
        },
      }

    case "SET_SESSION":
      return {
        ...state,
        appData: {
          ...state.appData,
          session: action.payload,
        },
      }

    case "UPDATE_SESSION_STATUS":
      if (!state.appData.session) {
        console.warn('ğŸ”„ [AppStateReducer] è©¦åœ–æ›´æ–°ä¸å­˜åœ¨çš„ session ç‹€æ…‹')
        return state
      }
      return {
        ...state,
        appData: {
          ...state.appData,
          session: {
            ...state.appData.session,
            status: action.payload,
          },
        },
      }

    case "RESET_STATE":
      return {
        ...state,
        appData: initialAppData,
        error: null,
      }

    case "SET_LOADING":
      return {
        ...state,
        isLoading: action.payload,
      }

    case "SET_ERROR":
      return {
        ...state,
        error: action.payload,
      }

    case "CLEAR_ERROR":
      return {
        ...state,
        error: null,
      }

    default:
      console.warn('ğŸ”„ [AppStateReducer] æœªçŸ¥çš„ action type:', action)
      return state
  }
}


# END FILE CONTENTS


# File: frontend/components/SessionLoadingOverlay.tsx

import React from 'react'

export default function SessionLoadingOverlay() {
    return (
        <div className="fixed inset-0 flex items-center justify-center bg-white/60 z-50">
            <div className="animate-spin rounded-full h-12 w-12 border-y-4 border-gray-400"></div>
            <p className="ml-4 text-gray-700">æº–å‚™éŒ„éŸ³æœƒè©±ä¸­â€¦</p>
        </div>
    )
}


# END FILE CONTENTS


# File: frontend/lib/app-store-zustand.ts

"use client"

import { create } from 'zustand'
import { serviceContainer, SERVICE_KEYS } from './services'
import type { ISessionService } from './services/interfaces'
import { AppState, SessionStatus, SessionType, TranscriptEntry } from '../types/app-state'
import { TranscriptManager } from './transcript-manager'

/**
 * App ç‹€æ…‹ä»‹é¢
 */
import { STTProvider } from './api'

interface AppStoreState {
  // æ‡‰ç”¨ç‹€æ…‹
  appState: AppState
  isLoading: boolean
  error: string | null

  // æœƒè©±ç‹€æ…‹
  session: {
    id: string
    status: SessionStatus
    type: SessionType
  } | null

  // éŒ„éŸ³ç‹€æ…‹
  isRecording: boolean
  recordingTime: number
  recordingStartTime: number | null

  // å…§éƒ¨è¨ˆæ™‚å™¨
  timerId: NodeJS.Timeout | null

  // é€å­—ç¨¿ç‹€æ…‹
  transcriptEntries: TranscriptEntry[]

  // ç·¨è¼¯å™¨ç‹€æ…‹
  editorContent: string

  // STT Provider ç‹€æ…‹
  sttProvider: STTProvider
}

/**
 * App æ“ä½œä»‹é¢
 */
interface AppStoreActions {
  // æ ¸å¿ƒæ¥­å‹™æ“ä½œ
  startRecording: (title?: string) => Promise<void>
  stopRecording: () => Promise<void>

  // ç‹€æ…‹ç®¡ç†
  setState: (appState: AppState) => void
  setSession: (session: AppStoreState['session']) => void
  setRecording: (isRecording: boolean) => void
  setError: (error: string | null) => void
  clearError: () => void

  // ç·¨è¼¯å™¨æ“ä½œ
  updateEditorContent: (content: string) => void
  addTranscriptEntry: (entry: TranscriptEntry) => void

  // è¨ˆæ™‚å™¨æ“ä½œ
  startTimer: () => void
  stopTimer: () => void
  cleanup: () => void

  // éŒ„éŸ³æ™‚é–“æ“ä½œ
  setRecordingStart: (timestamp: number) => void

  // ç‹€æ…‹é‡ç½®
  resetState: () => void

  // STT Provider æ“ä½œ
  setSttProvider: (provider: STTProvider) => void
}

/**
 * å®Œæ•´çš„ Store é¡å‹
 */
type AppStore = AppStoreState & AppStoreActions

/**
 * åŸºæ–¼ Zustand çš„ App Store
 *
 * å¯¦ç¾ç”¨æˆ¶è¦æ±‚çš„æœƒè©±è¡çªè™•ç†ç­–ç•¥ï¼š
 * 1. startRecording æ™‚å„ªå…ˆèª¿ç”¨ ensureRecordingSession
 * 2. å„ªé›…è™•ç† 409 è¡çªï¼Œè‡ªå‹•è¼‰å…¥ç¾æœ‰æœƒè©±
 * 3. æä¾›æ¸…æ™°çš„ç‹€æ…‹ç®¡ç†å’ŒéŒ¯èª¤è™•ç†
 */
export const useAppStore = create<AppStore>((set, get) => ({
  // === åˆå§‹ç‹€æ…‹ ===
  appState: 'default' as AppState,
  isLoading: false,
  error: null,
  session: null,
  isRecording: false,
  recordingTime: 0,
  recordingStartTime: null,
  timerId: null,
  transcriptEntries: [],
  editorContent: '',
  sttProvider: 'gpt4o' as STTProvider,

  // === æ ¸å¿ƒæ¥­å‹™æ“ä½œ ===

  /**
   * é–‹å§‹éŒ„éŸ³ - ä½¿ç”¨é›™ WebSocket å®Œæ•´éŒ„éŸ³æµç¨‹
   */
  startRecording: async (title?: string) => {
    console.log('ğŸ¤ [AppStore] é–‹å§‹é›™ WebSocket éŒ„éŸ³æµç¨‹')

    // 1. è¨­ç½®ç­‰å¾…ç‹€æ…‹
    set({
      appState: 'recording_waiting',
      isLoading: true,
      error: null
    })

    try {
      // 2. ç²å–ç•¶å‰çš„éŒ„éŸ³é–‹å§‹æ™‚é–“ï¼ˆç”± onstart äº‹ä»¶è¨­ç½®ï¼‰
      const currentState = get()
      const startTs = currentState.recordingStartTime

      const startTsDate = typeof startTs === 'number' ? new Date(startTs as number).toISOString() : 'N/A'
      const hasStartTime = typeof startTs === 'number'

      console.log('ğŸ• [AppStore] éŒ„éŸ³é–‹å§‹æ™‚é–“:', {
        startTs,
        startTsDate,
        hasStartTime
      })

      // 3. ç²å– RecordingFlowService
      const { RecordingFlowService } = await import('./services/recording-flow-service')
      const recordingFlowService = new RecordingFlowService()
      await recordingFlowService.initialize()

      // 4. å•Ÿå‹•å®Œæ•´éŒ„éŸ³æµç¨‹ï¼ˆåŒ…å«é›™ WebSocketï¼‰ï¼Œå‚³éé–‹å§‹æ™‚é–“æˆ³å’Œ STT Provider
      console.log('ğŸ” [AppStore] å•Ÿå‹•å®Œæ•´éŒ„éŸ³æµç¨‹...')
      const sessionResponse = await recordingFlowService.startRecordingFlow(
        title || `éŒ„éŸ³ç­†è¨˜ ${new Date().toLocaleString()}`,
        undefined, // content
        startTs,   // å‚³ééŒ„éŸ³é–‹å§‹æ™‚é–“æˆ³
        currentState.sttProvider // å‚³é STT Provider
      )

      console.log('âœ… [AppStore] é›™ WebSocket éŒ„éŸ³æµç¨‹å•Ÿå‹•æˆåŠŸ:', {
        sessionId: sessionResponse.id,
        withStartTs: !!startTs
      })

      // 5. æ›´æ–°ç‹€æ…‹ï¼Œä¿æŒç­‰å¾…é€å­—ç¨¿
      set({
        appState: 'recording_waiting',
        session: {
          id: sessionResponse.id,
          status: sessionResponse.status as SessionStatus,
          type: sessionResponse.type as SessionType
        },
        isRecording: true,
        isLoading: false
      })

      // 6. ä¸éœ€è¦å†æ¬¡å•Ÿå‹•è¨ˆæ™‚å™¨ï¼Œå› ç‚ºå·²ç¶“åœ¨ setRecordingStart ä¸­å•Ÿå‹•äº†
      console.log('ğŸ• [AppStore] è¨ˆæ™‚å™¨å·²åœ¨ onstart äº‹ä»¶ä¸­å•Ÿå‹•ï¼ŒéŒ„éŸ³æ™‚é–“:', currentState.recordingTime)

        // 7. å„²å­˜æœå‹™å¯¦ä¾‹ä¾›åœæ­¢æ™‚ä½¿ç”¨
        ; (globalThis as any).currentRecordingFlowService = recordingFlowService

      console.log('ğŸ¯ [AppStore] é›™ WebSocket éŒ„éŸ³æ¨¡å¼å•Ÿå‹•æˆåŠŸ')

    } catch (error) {
      // 8. éŒ¯èª¤è™•ç†
      const errorMessage = error instanceof Error ? error.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      console.error('âŒ [AppStore] ç„¡æ³•é–‹å§‹éŒ„éŸ³:', error)

      // æ¸…ç†è¨ˆæ™‚å™¨ï¼ˆå¦‚æœå·²å•Ÿå‹•ï¼‰
      get().stopTimer()

      set({
        appState: 'default',
        error: errorMessage,
        isLoading: false,
        session: null,
        isRecording: false
      })

      console.error('ğŸš¨ [AppStore] é›™ WebSocket éŒ„éŸ³å•Ÿå‹•å¤±æ•—ï¼Œè«‹é‡è©¦')
    }
  },

  /**
   * åœæ­¢éŒ„éŸ³ - åœæ­¢é›™ WebSocket éŒ„éŸ³æµç¨‹
   */
  stopRecording: async () => {
    console.log('ğŸ›‘ [AppStore] åœæ­¢é›™ WebSocket éŒ„éŸ³æµç¨‹')

    // åœæ­¢è¨ˆæ™‚å™¨
    get().stopTimer()

    set({
      appState: 'processing',
      isLoading: true
    })

    try {
      // ç²å–ä¸¦èª¿ç”¨ RecordingFlowService
      const recordingFlowService = (globalThis as any).currentRecordingFlowService

      if (recordingFlowService) {
        await recordingFlowService.stopRecordingFlow()
        await recordingFlowService.cleanup()

          // æ¸…ç†å…¨å±€å¼•ç”¨
          ; (globalThis as any).currentRecordingFlowService = null

        console.log('âœ… [AppStore] RecordingFlowService åœæ­¢æˆåŠŸ')
      } else {
        console.warn('âš ï¸ [AppStore] æ²’æœ‰æ‰¾åˆ°æ´»èºçš„ RecordingFlowService')
      }

      set({
        appState: 'finished',
        isRecording: false,
        isLoading: false
      })

      console.log('âœ… [AppStore] é›™ WebSocket éŒ„éŸ³åœæ­¢æˆåŠŸ')

    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      console.error('âŒ [AppStore] åœæ­¢éŒ„éŸ³å¤±æ•—:', error)

      set({
        error: errorMessage,
        isLoading: false
      })
    }
  },

  // === ç‹€æ…‹ç®¡ç†æ“ä½œ ===

  setState: (appState: AppState) => {
    set({ appState })
  },

  setSession: (session: AppStoreState['session']) => {
    set({ session })
  },

  setRecording: (isRecording: boolean) => {
    set({ isRecording })
  },

  setError: (error: string | null) => {
    set({ error })
  },

  clearError: () => {
    set({ error: null })
  },

  // === STT Provider æ“ä½œ ===

  setSttProvider: (provider: STTProvider) => {
    set({ sttProvider: provider })
    console.log('ğŸ”§ [AppStore] STT Provider å·²æ›´æ–°:', provider)
  },

  // === ç·¨è¼¯å™¨æ“ä½œ ===

  updateEditorContent: (content: string) => {
    set({ editorContent: content })
  },

  addTranscriptEntry: (entry: TranscriptEntry) => {
    console.log('[S] add entry', entry.text.slice(0, 20))

    set((state) => {
      // å°‡æ–°æ¢ç›®åŠ å…¥ä¸¦æŒ‰æ•¸å€¼æ™‚é–“æ’åº
      const timeToSeconds = (t: string): number => {
        const parts = t.split(':').map(Number)
        if (parts.length === 3) {
          const [hh, mm, ss] = parts
          return hh * 3600 + mm * 60 + ss
        } else if (parts.length === 2) {
          const [mm, ss] = parts
          return mm * 60 + ss
        }
        return 0
      }

      const getStart = (e: TranscriptEntry): number => e.startTime ?? timeToSeconds(e.time)

      const newEntries = [...state.transcriptEntries, entry].sort(
        (a, b) => getStart(a) - getStart(b)
      )
      return {
        transcriptEntries: newEntries,
        // ğŸ¯ æ”¶åˆ°ç¬¬ä¸€å€‹é€å­—ç¨¿æ™‚ï¼Œå¾ recording_waiting â†’ recording_active
        appState: state.appState === 'recording_waiting' ? 'recording_active' : state.appState
      }
    })
  },

  setRecordingTime: (time: number) => {
    set({ recordingTime: time })
  },

  // è¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“ä¸¦å•Ÿå‹•åŸºæ–¼å¯¦éš›æ™‚é–“çš„è¨ˆæ™‚å™¨
  setRecordingStart: (timestamp: number) => {
    console.log('ğŸš€ [AppStore] è¨­ç½®éŒ„éŸ³é–‹å§‹æ™‚é–“:', new Date(timestamp).toISOString())
    set({ recordingStartTime: timestamp, recordingTime: 0 })

    // å•Ÿå‹•åŸºæ–¼å¯¦éš›æ™‚é–“çš„è¨ˆæ™‚å™¨
    get().startTimer()
  },

  // è¨ˆæ™‚é‚è¼¯ - ä¿®æ”¹ç‚ºåŸºæ–¼å¯¦éš›æ™‚é–“æˆ³çš„è¨ˆç®—
  startTimer: () => {
    const currentState = get()
    if (currentState.timerId) return // é˜²æ­¢é‡è¤‡å•Ÿå‹•

    const timerId = setInterval(() => {
      const state = get()
      if (state.recordingStartTime) {
        const elapsed = Math.floor((Date.now() - state.recordingStartTime) / 1000)
        set({ recordingTime: elapsed })
      } else {
        // Fallback åˆ°èˆŠé‚è¼¯
        set(prevState => ({ recordingTime: prevState.recordingTime + 1 }))
      }
    }, 1000)

    set({ timerId })
    console.log('ğŸ• [AppStore] éŒ„éŸ³è¨ˆæ™‚å™¨å·²å•Ÿå‹•')
  },

  stopTimer: () => {
    const currentState = get()
    if (currentState.timerId) {
      clearInterval(currentState.timerId)
      set({ timerId: null, recordingTime: 0, recordingStartTime: null })
      console.log('â¹ï¸ [AppStore] éŒ„éŸ³è¨ˆæ™‚å™¨å·²åœæ­¢ä¸¦é‡ç½®')
    }
  },

  cleanup: () => {
    const currentState = get()
    if (currentState.timerId) {
      clearInterval(currentState.timerId)
      set({ timerId: null })
      console.log('ğŸ§¹ [AppStore] è¨ˆæ™‚å™¨å·²æ¸…ç†')
    }
  },

  // === ç‹€æ…‹é‡ç½® ===

  resetState: () => {
    console.log('ğŸ”„ [AppStore] é‡ç½®ç‹€æ…‹')

    // æ¸…ç†è¨ˆæ™‚å™¨
    const currentState = get()
    if (currentState.timerId) {
      clearInterval(currentState.timerId)
    }

    set({
      appState: 'default',
      isLoading: false,
      error: null,
      session: null,
      isRecording: false,
      recordingTime: 0,
      recordingStartTime: null,
      timerId: null,
      transcriptEntries: [],
      editorContent: '',
      sttProvider: 'gpt4o' as STTProvider,
    })
  }
}))

/**
 * ä¾¿åˆ©çš„ Hookï¼šåªç²å–ç‹€æ…‹
 */
export const useAppState = () => useAppStore((state: AppStore) => ({
  appState: state.appState,
  isLoading: state.isLoading,
  error: state.error,
  session: state.session,
  isRecording: state.isRecording,
  recordingTime: state.recordingTime,
  transcriptEntries: state.transcriptEntries,
  editorContent: state.editorContent
}))

/**
 * ä¾¿åˆ©çš„ Hookï¼šåªç²å–æ“ä½œ
 */
export const useAppActions = () => useAppStore((state: AppStore) => ({
  startRecording: state.startRecording,
  stopRecording: state.stopRecording,
  setState: state.setState,
  setSession: state.setSession,
  setRecording: state.setRecording,
  setError: state.setError,
  clearError: state.clearError,
  updateEditorContent: state.updateEditorContent,
  addTranscriptEntry: state.addTranscriptEntry,
  setRecordingStart: state.setRecordingStart,
  resetState: state.resetState
}))

export default useAppStore


# END FILE CONTENTS


# File: app/lib/settings_utils.py

"""
settings_utils.py
é›†ä¸­æ”¾ä¸€äº›æœƒåœ¨å¤šå€‹æ¨¡çµ„ç”¨åˆ°ã€ä½†å¿…é ˆå‹•æ…‹è®€å–
get_settings() çš„å°å‡½å¼ï¼Œé¿å… module import æ™‚
æŠŠ settings ç¶æ­»ã€‚
"""

from app.core.config import get_settings


def get_chunk_duration() -> int:
    """
    å›å‚³ç›®å‰ .env ä¸­æŒ‡å®šçš„åˆ‡ç‰‡é•·åº¦ (ç§’)ã€‚
    æ¯æ¬¡å‘¼å«éƒ½é‡æ–°èµ° get_settings()ï¼Œç¢ºä¿èˆ‡
    .env â†’ Settings ä¸€è‡´ã€‚
    """
    return get_settings().AUDIO_CHUNK_DURATION_SEC


def get_filter_thresholds():
    """
    å›å‚³ (no_speech_thresh, logprob_thresh, compression_thresh)ã€‚
    åŒæ¨£æ¯æ¬¡é‡æ–°è®€å–è¨­å®šã€‚
    """
    s = get_settings()
    return s.FILTER_NO_SPEECH, s.FILTER_LOGPROB, s.FILTER_COMPRESSION


# END FILE CONTENTS


# File: frontend/components/ui/badge.tsx

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }


# END FILE CONTENTS


# File: app/api/segments.py

"""
StudyScriber éŸ³æª”åˆ‡ç‰‡ä¸Šå‚³ API
"""

import logging
from uuid import UUID
from fastapi import APIRouter, UploadFile, File, BackgroundTasks, Depends, HTTPException
from starlette.status import HTTP_201_CREATED, HTTP_400_BAD_REQUEST, HTTP_409_CONFLICT
from supabase import Client

from app.core.config import Settings, get_settings
from app.db.database import get_supabase_client
from app.services.r2_client import get_r2_client
from app.services.azure_openai_v2 import SimpleAudioTranscriptionService
from app.services.transcript_feed import get_transcript_hub
from app.core.container import container
from app.utils.validators import valid_webm
from app.services.stt.factory import get_provider
from app.services.stt.save_utils import save_and_push_result


logger = logging.getLogger(__name__)

router = APIRouter(prefix="/api", tags=["éŸ³æª”ä¸Šå‚³"])

MAX_FILE_SIZE = 5 * 1024 * 1024  # 5 MB


@router.post("/segment", status_code=HTTP_201_CREATED)
async def upload_segment(
    sid: UUID,
    seq: int,
    file: UploadFile = File(...),
    background: BackgroundTasks = BackgroundTasks(),
    settings: Settings = Depends(get_settings),
    supabase: Client = Depends(get_supabase_client)
):
    """
    ä¸Šå‚³ 10 ç§’ WebM éŸ³æª”åˆ‡ç‰‡ (B-020)

    ä½¿ç”¨ Content-Length + UploadFile.spool_max_size é›™ä¿éšª
    ç«‹å³å›æ‡‰ ackï¼ŒèƒŒæ™¯è™•ç†è½‰éŒ„
    """

    # --- åŸºæœ¬é©—è­‰ ---
    if file.content_type not in ("audio/webm", "audio/webm;codecs=opus"):
        raise HTTPException(HTTP_400_BAD_REQUEST, "Unsupported media type. Expected audio/webm")

    # è®€å–æª”æ¡ˆå…§å®¹
    blob = await file.read()

    # æª”æ¡ˆå¤§å°æª¢æŸ¥
    if len(blob) > MAX_FILE_SIZE:
        raise HTTPException(HTTP_400_BAD_REQUEST, f"File too large: {len(blob)} bytes > {MAX_FILE_SIZE} bytes (5MB)")

    # æœƒè©±é©—è­‰ - æª¢æŸ¥ session å­˜åœ¨ä¸”ç‹€æ…‹æ­£ç¢º
    try:
        session_response = supabase.table("sessions").select("*").eq("id", str(sid)).eq("status", "active").limit(1).execute()
        if not session_response.data:
            raise HTTPException(HTTP_400_BAD_REQUEST, "Session not found or not active")

        session = session_response.data[0]
        if session.get('type') != 'recording':
            raise HTTPException(HTTP_400_BAD_REQUEST, "Session is not in recording mode")

    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Session validation error: {e}")
        raise HTTPException(HTTP_400_BAD_REQUEST, "Session validation failed")

    # åºè™Ÿå”¯ä¸€æ€§æª¢æŸ¥ - (session_id, seq) UNIQUE
    try:
        existing_response = supabase.table("audio_files").select("id").eq("session_id", str(sid)).eq("chunk_sequence", seq).limit(1).execute()
        if existing_response.data:
            raise HTTPException(HTTP_409_CONFLICT, f"Sequence {seq} already uploaded for this session. Please retry with next sequence or skip.")
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Sequence uniqueness check error: {e}")
        raise HTTPException(HTTP_400_BAD_REQUEST, "Sequence validation failed")

    # WebM æª”æ¡ˆæ ¼å¼åŸºæœ¬é©—è­‰
    if not valid_webm(blob[:32]):
        raise HTTPException(HTTP_400_BAD_REQUEST, "Invalid WebM header. Please ensure file is properly encoded WebM format.")

    logger.info(f"âœ… Validated WebM segment upload: session={sid}, seq={seq}, size={len(blob)} bytes")

    # --- ç«‹å³å› Ackï¼Œä¸¦ä¸ŸèƒŒæ™¯ä»»å‹™ ---
    background.add_task(process_and_transcribe, sid, seq, blob)
    return {"ack": seq, "size": len(blob), "status": "accepted"}


async def process_and_transcribe(sid: UUID, seq: int, webm_blob: bytes):
    """
    èƒŒæ™¯ä»»å‹™ï¼šè™•ç†éŸ³æª”åˆ‡ç‰‡ä¸¦åŸ·è¡Œè½‰éŒ„

    æµç¨‹ï¼šR2 å„²å­˜ â†’ è³‡æ–™åº«è¨˜éŒ„ â†’ FFmpeg è½‰æ› â†’ Whisper è½‰éŒ„ â†’ WebSocket å»£æ’­
    """
    transcript_hub = get_transcript_hub()

    try:
        logger.info(f"ğŸš€ [èƒŒæ™¯è½‰éŒ„] é–‹å§‹è™•ç†åˆ‡ç‰‡ {seq} (session: {sid}, size: {len(webm_blob)} bytes)")

        # 1. å„²å­˜è‡³ Cloudflare R2
        r2_client = get_r2_client()
        blob_path = await r2_client.store_segment(sid, seq, webm_blob)
        logger.info(f"ğŸ“ [R2 å„²å­˜] åˆ‡ç‰‡ {seq} å·²å„²å­˜è‡³ {blob_path}")

        # 2. è¨˜éŒ„åˆ°è³‡æ–™åº« audio_files è¡¨
        supabase = get_supabase_client()
        app_settings = get_settings()
        audio_file_data = {
            "session_id": str(sid),
            "chunk_sequence": seq,
            "r2_key": blob_path,
            "r2_bucket": r2_client.bucket_name,
            "file_size": len(webm_blob),
            "duration_seconds": app_settings.AUDIO_CHUNK_DURATION_SEC  # å¾ç’°å¢ƒè®Šæ•¸è®€å–åˆ‡ç‰‡æ™‚é•·
        }

        audio_response = supabase.table("audio_files").insert(audio_file_data).execute()
        if not audio_response.data:
            raise Exception("Failed to insert audio file record")

        logger.info(f"ğŸ“ [è³‡æ–™åº«] éŸ³æª”è¨˜éŒ„å·²å»ºç«‹: {audio_response.data[0]['id']}")

        # 3. å•Ÿå‹•è½‰éŒ„æœå‹™
        try:
            provider = get_provider(sid)
            logger.info(f"ğŸ¯ [è½‰éŒ„å•Ÿå‹•] é–‹å§‹è½‰éŒ„åˆ‡ç‰‡ {seq} (provider={provider.name})")
            result = await provider.transcribe(webm_blob, sid, seq)
            if result:
                await save_and_push_result(sid, seq, result)
                logger.info(f"âœ… [è½‰éŒ„å•Ÿå‹•] åˆ‡ç‰‡ {seq} è½‰éŒ„æˆåŠŸ")
            else:
                logger.warning(f"âš ï¸ [è½‰éŒ„å•Ÿå‹•] åˆ‡ç‰‡ {seq} è½‰éŒ„å¤±æ•—")
        except Exception as transcription_error:
            logger.error(f"âŒ [è½‰éŒ„æœå‹™éŒ¯èª¤] åˆ‡ç‰‡ {seq}: {transcription_error}")
            await transcript_hub.broadcast_error(str(sid), "transcription_service_error", str(transcription_error), seq)

        logger.info(f"âœ… [èƒŒæ™¯è½‰éŒ„] åˆ‡ç‰‡ {seq} è™•ç†å®Œæˆ")

    except Exception as e:
        logger.error(f"âŒ [èƒŒæ™¯è½‰éŒ„] åˆ‡ç‰‡ {seq} è™•ç†å¤±æ•—: {e}")
        # æ¨™è¨˜åˆ‡ç‰‡éŒ¯èª¤ç‹€æ…‹
        await _mark_segment_error(sid, seq, str(e))
        # å»£æ’­éŒ¯èª¤åˆ°å‰ç«¯
        await transcript_hub.broadcast_error(str(sid), "processing_error", str(e), seq)


async def _mark_segment_error(sid: UUID, seq: int, error_message: str):
    """æ¨™è¨˜åˆ‡ç‰‡è™•ç†éŒ¯èª¤"""
    try:
        supabase = get_supabase_client()
        # å¯ä»¥è€ƒæ…®åœ¨ audio_files è¡¨æ·»åŠ  error_message æ¬„ä½ï¼Œæˆ–å»ºç«‹éŒ¯èª¤è¨˜éŒ„è¡¨
        logger.error(f"åˆ‡ç‰‡éŒ¯èª¤è¨˜éŒ„: session={sid}, seq={seq}, error={error_message}")
    except Exception as e:
        logger.error(f"è¨˜éŒ„åˆ‡ç‰‡éŒ¯èª¤å¤±æ•—: {e}")





# END FILE CONTENTS


# File: frontend/components/ui/card.tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }


# END FILE CONTENTS


# File: frontend/components/ui/avatar.tsx

"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }


# END FILE CONTENTS


# File: frontend/components/upload-status-indicator.tsx

"use client"

import { useState, useEffect } from 'react'
import { Button } from './ui/button'
import { Alert, AlertDescription } from './ui/alert'
import { Badge } from './ui/badge'
import { RefreshCw, Upload, AlertTriangle, CheckCircle, Wifi, WifiOff } from 'lucide-react'
import { restAudioUploader } from '../lib/rest-audio-uploader'

interface UploadStats {
    uploaded: number
    failed: number
    cached: number
    retrying: boolean
}

interface UploadStatusIndicatorProps {
    sessionId?: string
    isRecording?: boolean
    className?: string
}

/**
 * UploadStatusIndicator - ä¸Šå‚³ç‹€æ…‹æŒ‡ç¤ºå™¨
 *
 * Phase 2 é‡æ§‹ï¼šé¡¯ç¤º REST API ä¸Šå‚³ç‹€æ…‹
 *
 * åŠŸèƒ½ï¼š
 * - é¡¯ç¤ºä¸Šå‚³çµ±è¨ˆï¼ˆæˆåŠŸ/å¤±æ•—/æš«å­˜ï¼‰
 * - æç¤ºæš«å­˜æª”æ¡ˆå¯é‡æ–°ä¸Šå‚³
 * - æ”¯æ´æ‰‹å‹•é‡è©¦åŠŸèƒ½
 * - ç¶²è·¯ç‹€æ…‹æŒ‡ç¤º
 */
export function UploadStatusIndicator({
    sessionId,
    isRecording = false,
    className = ""
}: UploadStatusIndicatorProps) {
    const [uploadStats, setUploadStats] = useState<UploadStats>({
        uploaded: 0,
        failed: 0,
        cached: 0,
        retrying: false
    })
    const [isOnline, setIsOnline] = useState(true)
    const [lastUpdate, setLastUpdate] = useState(Date.now())

    // ç›£è½ç¶²è·¯ç‹€æ…‹
    useEffect(() => {
        const handleOnline = () => setIsOnline(true)
        const handleOffline = () => setIsOnline(false)

        window.addEventListener('online', handleOnline)
        window.addEventListener('offline', handleOffline)

        return () => {
            window.removeEventListener('online', handleOnline)
            window.removeEventListener('offline', handleOffline)
        }
    }, [])

    // è¨­ç½®ä¸Šå‚³å™¨äº‹ä»¶ç›£è½
    useEffect(() => {
        if (!sessionId) return

        restAudioUploader.setSessionId(sessionId)

        // ç›£è½ä¸Šå‚³æˆåŠŸ
        const handleUploadSuccess = (seq: number) => {
            setUploadStats(prev => ({
                ...prev,
                uploaded: prev.uploaded + 1
            }))
            setLastUpdate(Date.now())
        }

        // ç›£è½ä¸Šå‚³å¤±æ•—
        const handleUploadError = (seq: number) => {
            setUploadStats(prev => ({
                ...prev,
                failed: prev.failed + 1
            }))
            setLastUpdate(Date.now())
        }

        // ç›£è½æš«å­˜åˆ°æœ¬åœ°
        const handleCacheStored = (seq: number) => {
            setUploadStats(prev => ({
                ...prev,
                cached: prev.cached + 1
            }))
            setLastUpdate(Date.now())
        }

        restAudioUploader.onUploadSuccess(handleUploadSuccess)
        restAudioUploader.onUploadError(handleUploadError)
        restAudioUploader.onCacheStored(handleCacheStored)

        return () => {
            // æ¸…ç†äº‹ä»¶ç›£è½å™¨
            restAudioUploader.onUploadSuccess(() => { })
            restAudioUploader.onUploadError(() => { })
            restAudioUploader.onCacheStored(() => { })
        }
    }, [sessionId])

    // å®šæœŸæ›´æ–°æš«å­˜æ•¸é‡
    useEffect(() => {
        const updateCachedCount = async () => {
            if (sessionId && restAudioUploader) {
                const count = await restAudioUploader.getCachedSegmentsCount()
                setUploadStats(prev => ({
                    ...prev,
                    cached: count
                }))
            }
        }

        updateCachedCount()
        const interval = setInterval(updateCachedCount, 10000) // æ¯ 10 ç§’æ›´æ–°ä¸€æ¬¡

        return () => clearInterval(interval)
    }, [sessionId])

    // é‡æ–°ä¸Šå‚³æš«å­˜æª”æ¡ˆ
    const handleRetryUploads = async () => {
        if (!sessionId || uploadStats.retrying) return

        setUploadStats(prev => ({ ...prev, retrying: true }))

        try {
            await restAudioUploader.retryFailedSegments()

            // æ›´æ–°æš«å­˜æ•¸é‡
            const newCachedCount = await restAudioUploader.getCachedSegmentsCount()
            setUploadStats(prev => ({
                ...prev,
                cached: newCachedCount,
                retrying: false
            }))

            console.log('âœ… [UploadStatusIndicator] é‡æ–°ä¸Šå‚³å®Œæˆ')
        } catch (error) {
            console.error('âŒ [UploadStatusIndicator] é‡æ–°ä¸Šå‚³å¤±æ•—:', error)
            setUploadStats(prev => ({ ...prev, retrying: false }))
        }
    }

    // å¦‚æœä¸åœ¨éŒ„éŸ³ä¸”æ²’æœ‰çµ±è¨ˆæ•¸æ“šï¼Œä¸é¡¯ç¤º
    if (!isRecording && uploadStats.uploaded === 0 && uploadStats.failed === 0 && uploadStats.cached === 0) {
        return null
    }

    return (
        <div className={`space-y-2 ${className}`}>
            {/* ç¶²è·¯ç‹€æ…‹æŒ‡ç¤º */}
            <div className="flex items-center gap-2 text-sm text-muted-foreground">
                {isOnline ? (
                    <Wifi className="h-4 w-4 text-green-500" />
                ) : (
                    <WifiOff className="h-4 w-4 text-red-500" />
                )}
                <span>{isOnline ? 'ç·šä¸Š' : 'é›¢ç·š'}</span>
            </div>

            {/* ä¸Šå‚³çµ±è¨ˆ */}
            <div className="flex items-center gap-2 flex-wrap">
                {uploadStats.uploaded > 0 && (
                    <Badge variant="default" className="flex items-center gap-1">
                        <CheckCircle className="h-3 w-3" />
                        å·²ä¸Šå‚³ {uploadStats.uploaded}
                    </Badge>
                )}

                {uploadStats.failed > 0 && (
                    <Badge variant="destructive" className="flex items-center gap-1">
                        <AlertTriangle className="h-3 w-3" />
                        å¤±æ•— {uploadStats.failed}
                    </Badge>
                )}

                {uploadStats.cached > 0 && (
                    <Badge variant="secondary" className="flex items-center gap-1">
                        <Upload className="h-3 w-3" />
                        æš«å­˜ {uploadStats.cached}
                    </Badge>
                )}
            </div>

            {/* æš«å­˜æª”æ¡ˆæç¤º */}
            {uploadStats.cached > 0 && (
                <Alert>
                    <AlertTriangle className="h-4 w-4" />
                    <AlertDescription className="flex items-center justify-between">
                        <span>
                            æœ‰ {uploadStats.cached} å€‹éŸ³é »æ®µè½æš«å­˜åœ¨æœ¬åœ°ã€‚
                            {isOnline ? 'å¯ä»¥é‡æ–°ä¸Šå‚³' : 'è«‹ç­‰å¾…ç¶²è·¯é€£ç·š'}
                        </span>
                        {isOnline && (
                            <Button
                                size="sm"
                                variant="outline"
                                onClick={handleRetryUploads}
                                disabled={uploadStats.retrying}
                                className="ml-2"
                            >
                                {uploadStats.retrying ? (
                                    <>
                                        <RefreshCw className="h-3 w-3 mr-1 animate-spin" />
                                        é‡æ–°ä¸Šå‚³ä¸­...
                                    </>
                                ) : (
                                    <>
                                        <Upload className="h-3 w-3 mr-1" />
                                        é‡æ–°ä¸Šå‚³
                                    </>
                                )}
                            </Button>
                        )}
                    </AlertDescription>
                </Alert>
            )}

            {/* éŒ„éŸ³æ™‚çš„å³æ™‚ç‹€æ…‹ */}
            {isRecording && (
                <div className="text-xs text-muted-foreground">
                    ä¸Šæ¬¡æ›´æ–°ï¼š{new Date(lastUpdate).toLocaleTimeString()}
                </div>
            )}
        </div>
    )
}


# END FILE CONTENTS


# File: frontend/public/placeholder-logo.svg

<svg xmlns="http://www.w3.org/2000/svg" width="215" height="48" fill="none"><path fill="#000" d="M57.588 9.6h6L73.828 38h-5.2l-2.36-6.88h-11.36L52.548 38h-5.2l10.24-28.4Zm7.16 17.16-4.16-12.16-4.16 12.16h8.32Zm23.694-2.24c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.486-7.72.12 3.4c.534-1.227 1.307-2.173 2.32-2.84 1.04-.693 2.267-1.04 3.68-1.04 1.494 0 2.76.387 3.8 1.16 1.067.747 1.827 1.813 2.28 3.2.507-1.44 1.294-2.52 2.36-3.24 1.094-.747 2.414-1.12 3.96-1.12 1.414 0 2.64.307 3.68.92s1.84 1.52 2.4 2.72c.56 1.2.84 2.667.84 4.4V38h-4.96V25.92c0-1.813-.293-3.187-.88-4.12-.56-.96-1.413-1.44-2.56-1.44-.906 0-1.68.213-2.32.64-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.84-.48 3.04V38h-4.56V25.92c0-1.2-.133-2.213-.4-3.04-.24-.827-.626-1.453-1.16-1.88-.506-.427-1.133-.64-1.88-.64-.906 0-1.68.227-2.32.68-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.827-.48 3V38h-4.96V16.8h4.48Zm26.723 10.6c0-2.24.427-4.187 1.28-5.84.854-1.68 2.067-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.84 0 3.494.413 4.96 1.24 1.467.827 2.64 2.08 3.52 3.76.88 1.653 1.347 3.693 1.4 6.12v1.32h-15.08c.107 1.813.614 3.227 1.52 4.24.907.987 2.134 1.48 3.68 1.48.987 0 1.88-.253 2.68-.76a4.803 4.803 0 0 0 1.84-2.2l5.08.36c-.64 2.027-1.84 3.64-3.6 4.84-1.733 1.173-3.733 1.76-6 1.76-2.08 0-3.906-.453-5.48-1.36-1.573-.907-2.786-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84Zm15.16-2.04c-.213-1.733-.76-3.013-1.64-3.84-.853-.827-1.893-1.24-3.12-1.24-1.44 0-2.6.453-3.48 1.36-.88.88-1.44 2.12-1.68 3.72h9.92ZM163.139 9.6V38h-5.04V9.6h5.04Zm8.322 7.2.24 5.88-.64-.36c.32-2.053 1.094-3.56 2.32-4.52 1.254-.987 2.787-1.48 4.6-1.48 2.32 0 4.107.733 5.36 2.2 1.254 1.44 1.88 3.387 1.88 5.84V38h-4.96V25.92c0-1.253-.12-2.28-.36-3.08-.24-.8-.64-1.413-1.2-1.84-.533-.427-1.253-.64-2.16-.64-1.44 0-2.573.48-3.4 1.44-.8.933-1.2 2.307-1.2 4.12V38h-4.96V16.8h4.48Zm30.003 7.72c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.443 8.16V38h-5.6v-5.32h5.6Z"/><path fill="#171717" fill-rule="evenodd" d="m7.839 40.783 16.03-28.054L20 6 0 40.783h7.839Zm8.214 0H40L27.99 19.894l-4.02 7.032 3.976 6.914H20.02l-3.967 6.943Z" clip-rule="evenodd"/></svg>

# END FILE CONTENTS


# File: frontend/lib/services/service-container.ts

"use client"

import { BaseService, ServiceStatus } from './base-service'

/**
 * ServiceContainer - æœå‹™ä¾è³´æ³¨å…¥å®¹å™¨
 *
 * åƒè€ƒå¾Œç«¯ container.py æ¨¡å¼ï¼Œæä¾›ï¼š
 * - Singleton æ¨¡å¼ (åƒè€ƒ TranscriptManager.getInstance())
 * - é¡å‹å®‰å…¨çš„æœå‹™è¨»å†Šå’Œè§£æ
 * - æœå‹™ç”Ÿå‘½é€±æœŸç®¡ç†
 * - ä¾è³´é—œä¿‚ç®¡ç†
 */
export class ServiceContainer {
    /**
     * Singleton å¯¦ä¾‹
     */
    private static instance: ServiceContainer | null = null

    /**
     * æœå‹™å·¥å» å‡½æ•¸æ˜ å°„è¡¨
     * key: æœå‹™è­˜åˆ¥ç¬¦, value: æœå‹™å·¥å» å‡½æ•¸
     */
    private readonly providers = new Map<string, () => any>()

    /**
     * å–®ä¾‹æœå‹™å¯¦ä¾‹å¿«å–
     * key: æœå‹™è­˜åˆ¥ç¬¦, value: æœå‹™å¯¦ä¾‹
     */
    private readonly singletons = new Map<string, any>()

    /**
     * å·²è¨»å†Šçš„å–®ä¾‹æœå‹™æ¨™è­˜
     */
    private readonly singletonKeys = new Set<string>()

    /**
     * ç§æœ‰å»ºæ§‹å­ (Singleton æ¨¡å¼)
     */
    private constructor() {
        // é–‹ç™¼æ¨¡å¼ä¸‹å°‡å¯¦ä¾‹æ›åˆ°å…¨åŸŸä»¥åˆ©é™¤éŒ¯
        if (typeof window !== 'undefined') {
            ; (window as any).serviceContainer = this
            console.log('ğŸ”§ [ServiceContainer] æœå‹™å®¹å™¨å·²åˆå§‹åŒ–')
        }
    }

    /**
     * å–å¾— ServiceContainer å¯¦ä¾‹ (Singleton)
     */
    static getInstance(): ServiceContainer {
        if (!ServiceContainer.instance) {
            ServiceContainer.instance = new ServiceContainer()
        }
        return ServiceContainer.instance
    }

    /**
     * è¨»å†Šæœå‹™å·¥å» å‡½æ•¸
     * åƒè€ƒå¾Œç«¯ container.py çš„ register æ–¹æ³•
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     * @param factory æœå‹™å·¥å» å‡½æ•¸
     */
    register<T>(key: string, factory: () => T): void {
        if (this.providers.has(key)) {
            console.warn(`âš ï¸ [ServiceContainer] æœå‹™ "${key}" å·²å­˜åœ¨ï¼Œå°‡è¢«è¦†è“‹`)
        }

        this.providers.set(key, factory)
        console.log(`âœ… [ServiceContainer] æœå‹™ "${key}" è¨»å†ŠæˆåŠŸ`)
    }

    /**
     * è¨»å†Šå–®ä¾‹æœå‹™
     * å–®ä¾‹æœå‹™åªæœƒè¢«å‰µå»ºä¸€æ¬¡ï¼Œå¾ŒçºŒèª¿ç”¨è¿”å›åŒä¸€å¯¦ä¾‹
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     * @param factory æœå‹™å·¥å» å‡½æ•¸
     */
    registerSingleton<T>(key: string, factory: () => T): void {
        this.register(key, factory)
        this.singletonKeys.add(key)
        console.log(`âœ… [ServiceContainer] å–®ä¾‹æœå‹™ "${key}" è¨»å†ŠæˆåŠŸ`)
    }

    /**
     * è§£ææœå‹™å¯¦ä¾‹
     * åƒè€ƒå¾Œç«¯ container.py çš„ resolve æ–¹æ³•
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     * @returns æœå‹™å¯¦ä¾‹
     * @throws å¦‚æœæœå‹™æœªè¨»å†Š
     */
    resolve<T>(key: string): T {
        // æª¢æŸ¥å–®ä¾‹å¿«å–
        if (this.singletonKeys.has(key) && this.singletons.has(key)) {
            return this.singletons.get(key) as T
        }

        // å–å¾—å·¥å» å‡½æ•¸
        const provider = this.providers.get(key)
        if (!provider) {
            const error = `æœå‹™ "${key}" æœªè¨»å†Š`
            console.error(`âŒ [ServiceContainer] ${error}`)
            throw new Error(error)
        }

        try {
            const instance = provider() as T

            // å–®ä¾‹æœå‹™å¿«å–å¯¦ä¾‹
            if (this.singletonKeys.has(key)) {
                this.singletons.set(key, instance)
            }

            console.log(`âœ… [ServiceContainer] æœå‹™ "${key}" è§£ææˆåŠŸ`)
            return instance
        } catch (error) {
            console.error(`âŒ [ServiceContainer] å‰µå»ºæœå‹™ "${key}" å¤±æ•—:`, error)
            throw error
        }
    }

    /**
     * æª¢æŸ¥æœå‹™æ˜¯å¦å·²è¨»å†Š
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     */
    isRegistered(key: string): boolean {
        return this.providers.has(key)
    }

    /**
     * å–å¾—æ‰€æœ‰å·²è¨»å†Šçš„æœå‹™è­˜åˆ¥ç¬¦
     */
    getRegisteredServices(): string[] {
        return Array.from(this.providers.keys())
    }

    /**
     * æ¸…é™¤æŒ‡å®šæœå‹™è¨»å†Š
     *
     * @param key æœå‹™è­˜åˆ¥ç¬¦
     */
    unregister(key: string): boolean {
        const hasProvider = this.providers.delete(key)
        this.singletons.delete(key)
        this.singletonKeys.delete(key)

        if (hasProvider) {
            console.log(`ğŸ—‘ï¸ [ServiceContainer] æœå‹™ "${key}" å·²æ¸…é™¤`)
        }

        return hasProvider
    }

    /**
     * æ¸…é™¤æ‰€æœ‰æœå‹™è¨»å†Š
     * ä¸»è¦ç”¨æ–¼æ¸¬è©¦ç’°å¢ƒ
     */
    clear(): void {
        const count = this.providers.size
        this.providers.clear()
        this.singletons.clear()
        this.singletonKeys.clear()
        console.log(`ğŸ—‘ï¸ [ServiceContainer] å·²æ¸…é™¤ ${count} å€‹æœå‹™`)
    }

    /**
     * ç²å–å®¹å™¨ç‹€æ…‹æ‘˜è¦
     */
    getContainerStatus(): ServiceContainerStatus {
        const registeredServices = this.getRegisteredServices()
        const activeSingletons = Array.from(this.singletons.keys())

        return {
            totalServices: registeredServices.length,
            activeSingletonsCount: activeSingletons.length,
            registeredServices,
            activeSingletons,
            timestamp: new Date().toISOString()
        }
    }

    /**
     * åˆå§‹åŒ–æ‰€æœ‰å·²è¨»å†Šçš„ BaseService å¯¦ä¾‹
     * ç”¨æ–¼æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•æ™‚çµ±ä¸€åˆå§‹åŒ–æœå‹™
     */
    async initializeServices(): Promise<ServiceInitializationResult[]> {
        const results: ServiceInitializationResult[] = []
        const services = this.getRegisteredServices()

        console.log(`ğŸš€ [ServiceContainer] é–‹å§‹åˆå§‹åŒ– ${services.length} å€‹æœå‹™...`)

        for (const serviceKey of services) {
            try {
                const service = this.resolve(serviceKey)

                // æª¢æŸ¥æ˜¯å¦ç‚º BaseService å¯¦ä¾‹
                if (service instanceof BaseService) {
                    await service.start()
                    results.push({
                        serviceKey,
                        success: true,
                        status: service.getStatus()
                    })
                    console.log(`âœ… [ServiceContainer] æœå‹™ "${serviceKey}" åˆå§‹åŒ–æˆåŠŸ`)
                } else {
                    // é BaseService å¯¦ä¾‹ï¼Œè·³éåˆå§‹åŒ–
                    results.push({
                        serviceKey,
                        success: true,
                        status: null,
                        message: 'é BaseService å¯¦ä¾‹ï¼Œè·³éåˆå§‹åŒ–'
                    })
                    console.log(`â„¹ï¸ [ServiceContainer] æœå‹™ "${serviceKey}" é BaseService å¯¦ä¾‹ï¼Œè·³éåˆå§‹åŒ–`)
                }
            } catch (error) {
                results.push({
                    serviceKey,
                    success: false,
                    error: error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
                })
                console.error(`âŒ [ServiceContainer] æœå‹™ "${serviceKey}" åˆå§‹åŒ–å¤±æ•—:`, error)
            }
        }

        const successCount = results.filter(r => r.success).length
        console.log(`ğŸ¯ [ServiceContainer] æœå‹™åˆå§‹åŒ–å®Œæˆ: ${successCount}/${services.length} æˆåŠŸ`)

        return results
    }

    /**
     * æ¸…ç†æ‰€æœ‰å·²å•Ÿå‹•çš„ BaseService å¯¦ä¾‹
     * ç”¨æ–¼æ‡‰ç”¨ç¨‹å¼é—œé–‰æ™‚çµ±ä¸€æ¸…ç†è³‡æº
     */
    async cleanupServices(): Promise<ServiceCleanupResult[]> {
        const results: ServiceCleanupResult[] = []
        const singletonKeys = Array.from(this.singletons.keys())

        console.log(`ğŸ›‘ [ServiceContainer] é–‹å§‹æ¸…ç† ${singletonKeys.length} å€‹å–®ä¾‹æœå‹™...`)

        for (const serviceKey of singletonKeys) {
            try {
                const service = this.singletons.get(serviceKey)

                if (service instanceof BaseService && service.isRunning) {
                    await service.stop()
                    results.push({
                        serviceKey,
                        success: true
                    })
                    console.log(`âœ… [ServiceContainer] æœå‹™ "${serviceKey}" æ¸…ç†æˆåŠŸ`)
                } else {
                    results.push({
                        serviceKey,
                        success: true,
                        message: 'æœå‹™æœªé‹è¡Œæˆ–é BaseService å¯¦ä¾‹'
                    })
                }
            } catch (error) {
                results.push({
                    serviceKey,
                    success: false,
                    error: error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
                })
                console.error(`âŒ [ServiceContainer] æœå‹™ "${serviceKey}" æ¸…ç†å¤±æ•—:`, error)
            }
        }

        const successCount = results.filter(r => r.success).length
        console.log(`ğŸ¯ [ServiceContainer] æœå‹™æ¸…ç†å®Œæˆ: ${successCount}/${singletonKeys.length} æˆåŠŸ`)

        return results
    }
}

/**
 * æœå‹™å®¹å™¨éŒ¯èª¤é¡åˆ¥
 */
export class ServiceContainerError extends Error {
    readonly errorType: 'UNREGISTERED_SERVICE' | 'CREATION_FAILED' | 'UNKNOWN'
    readonly serviceKey: string
    readonly originalError?: unknown

    constructor(
        message: string,
        errorType: 'UNREGISTERED_SERVICE' | 'CREATION_FAILED' | 'UNKNOWN',
        serviceKey: string,
        originalError?: unknown
    ) {
        super(message)
        this.name = 'ServiceContainerError'
        this.errorType = errorType
        this.serviceKey = serviceKey
        this.originalError = originalError
    }
}

/**
 * å®¹å™¨ç‹€æ…‹ä»‹é¢
 */
export interface ServiceContainerStatus {
    totalServices: number
    activeSingletonsCount: number
    registeredServices: string[]
    activeSingletons: string[]
    timestamp: string
}

/**
 * æœå‹™åˆå§‹åŒ–çµæœä»‹é¢
 */
export interface ServiceInitializationResult {
    serviceKey: string
    success: boolean
    status?: ServiceStatus | null
    error?: string
    message?: string
}

/**
 * æœå‹™æ¸…ç†çµæœä»‹é¢
 */
export interface ServiceCleanupResult {
    serviceKey: string
    success: boolean
    error?: string
    message?: string
}

/**
 * åŒ¯å‡ºå…¨åŸŸå®¹å™¨å¯¦ä¾‹ (Singleton)
 * æ–¹ä¾¿å…¶ä»–æ¨¡çµ„ä½¿ç”¨
 */
export const serviceContainer = ServiceContainer.getInstance()


# END FILE CONTENTS


# File: frontend/components/ui/select.tsx

"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}


# END FILE CONTENTS


# File: frontend/tsconfig.json

{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "target": "ES6",
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}


# END FILE CONTENTS


# File: frontend/components/ui/calendar.tsx

"use client"

import * as React from "react"
import { ChevronLeft, ChevronRight } from "lucide-react"
import { DayPicker } from "react-day-picker"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

export type CalendarProps = React.ComponentProps<typeof DayPicker>

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  )
}
Calendar.displayName = "Calendar"

export { Calendar }


# END FILE CONTENTS


# File: app/core/webm_header_repairer.py

"""
WebM æª”é ­ä¿®å¾©æ ¸å¿ƒé‚è¼¯
æä¾›æª”é ­æå–ã€é©—è­‰å’Œé‡çµ„åŠŸèƒ½ï¼Œè§£æ±º MediaRecorder å¾ŒçºŒ chunk ç¼ºä¹ EBML æª”é ­çš„å•é¡Œ
"""

import logging
import time
from typing import Optional, Tuple
from dataclasses import dataclass

from .ffmpeg import detect_webm_header_info, is_webm_header_complete, WebMHeaderInfo

logger = logging.getLogger(__name__)


@dataclass
class HeaderRepairResult:
    """æª”é ­ä¿®å¾©çµæœ"""
    success: bool = False
    repaired_data: Optional[bytes] = None
    original_header_size: int = 0
    audio_data_size: int = 0
    repair_time_ms: float = 0.0
    error_message: Optional[str] = None


@dataclass
class HeaderExtractionResult:
    """æª”é ­æå–çµæœ"""
    success: bool = False
    header_data: Optional[bytes] = None
    header_info: Optional[WebMHeaderInfo] = None
    extraction_time_ms: float = 0.0
    error_message: Optional[str] = None


class WebMHeaderRepairer:
    """
    WebM æª”é ­ä¿®å¾©æ ¸å¿ƒå¼•æ“

    è² è²¬å¾ç¬¬ä¸€å€‹å®Œæ•´ chunk æå–æª”é ­æ¨¡æ¿ï¼Œä¸¦å°‡å…¶æ‡‰ç”¨åˆ°å¾ŒçºŒç¼ºä¹æª”é ­çš„ chunk ä¸­
    """

    def __init__(self):
        """åˆå§‹åŒ– WebM æª”é ­ä¿®å¾©å™¨"""
        self._repair_stats = {
            'total_extractions': 0,
            'successful_extractions': 0,
            'total_repairs': 0,
            'successful_repairs': 0,
            'total_repair_time_ms': 0.0
        }
        logger.info("WebMHeaderRepairer åˆå§‹åŒ–å®Œæˆ")

    def extract_header(self, complete_webm_chunk: bytes) -> HeaderExtractionResult:
        """
        å¾å®Œæ•´çš„ WebM chunk ä¸­æå–æª”é ­æ¨¡æ¿

        Args:
            complete_webm_chunk: åŒ…å«å®Œæ•´æª”é ­çš„ WebM chunk æ•¸æ“š

        Returns:
            HeaderExtractionResult: æª”é ­æå–çµæœ
        """
        start_time = time.time()
        result = HeaderExtractionResult()

        try:
            self._repair_stats['total_extractions'] += 1

            # 1. é©—è­‰è¼¸å…¥æ•¸æ“š
            if not complete_webm_chunk or len(complete_webm_chunk) < 32:
                result.error_message = "è¼¸å…¥æ•¸æ“šé•·åº¦ä¸è¶³"
                return result

            # 2. æª¢æ¸¬æª”é ­å®Œæ•´æ€§
            header_info = detect_webm_header_info(complete_webm_chunk)
            if not header_info.is_complete:
                result.error_message = f"æª”é ­ä¸å®Œæ•´: {header_info.error_message}"
                return result

            # 3. æå–æª”é ­æ•¸æ“šï¼ˆå¾é–‹å§‹åˆ°ç¬¬ä¸€å€‹ Clusterï¼‰
            if header_info.header_size > 0:
                header_data = complete_webm_chunk[:header_info.header_size]

                # 4. é©—è­‰æå–çš„æª”é ­
                if self._validate_extracted_header(header_data):
                    result.success = True
                    result.header_data = header_data
                    result.header_info = header_info
                    self._repair_stats['successful_extractions'] += 1

                    logger.debug(f"æˆåŠŸæå–æª”é ­: å¤§å°={len(header_data)} bytes, "
                               f"ç·¨ç¢¼å™¨={header_info.codec_type}, "
                               f"éŸ³è»Œæ•¸={header_info.track_count}")
                else:
                    result.error_message = "æå–çš„æª”é ­é©—è­‰å¤±æ•—"
            else:
                result.error_message = "ç„¡æ³•ç¢ºå®šæª”é ­å¤§å°"

        except Exception as e:
            result.error_message = f"æª”é ­æå–ç•°å¸¸: {str(e)}"
            logger.error(f"æª”é ­æå–ç™¼ç”ŸéŒ¯èª¤: {e}")

        finally:
            result.extraction_time_ms = (time.time() - start_time) * 1000

        return result

    def repair_chunk(self, header_template: bytes, incomplete_chunk: bytes) -> HeaderRepairResult:
        """
        ä½¿ç”¨æª”é ­æ¨¡æ¿ä¿®å¾©ä¸å®Œæ•´çš„ WebM chunk

        Args:
            header_template: å¾å®Œæ•´ chunk æå–çš„æª”é ­æ¨¡æ¿
            incomplete_chunk: ç¼ºä¹æª”é ­çš„ WebM chunk

        Returns:
            HeaderRepairResult: ä¿®å¾©çµæœ
        """
        start_time = time.time()
        result = HeaderRepairResult()

        try:
            self._repair_stats['total_repairs'] += 1

            # 1. é©—è­‰è¼¸å…¥
            if not header_template or not incomplete_chunk:
                result.error_message = "è¼¸å…¥åƒæ•¸ç„¡æ•ˆ"
                return result

            if len(header_template) < 32 or len(incomplete_chunk) < 8:
                result.error_message = "æ•¸æ“šé•·åº¦ä¸è¶³"
                return result

            # 2. æª¢æ¸¬ incomplete_chunk æ˜¯å¦å·²ç¶“æœ‰æª”é ­
            if is_webm_header_complete(incomplete_chunk):
                # å¦‚æœå·²ç¶“æœ‰å®Œæ•´æª”é ­ï¼Œç›´æ¥è¿”å›åŸæ•¸æ“š
                result.success = True
                result.repaired_data = incomplete_chunk
                result.original_header_size = 0
                result.audio_data_size = len(incomplete_chunk)
                logger.debug("Chunk å·²æœ‰å®Œæ•´æª”é ­ï¼Œç„¡éœ€ä¿®å¾©")
                return result

            # 3. æª¢æ¸¬ incomplete_chunk ä¸­çš„éŸ³é »æ•¸æ“šèµ·å§‹ä½ç½®
            audio_data_start = self._find_audio_data_start(incomplete_chunk)
            if audio_data_start == -1:
                result.error_message = "ç„¡æ³•åœ¨ incomplete chunk ä¸­æ‰¾åˆ°æœ‰æ•ˆçš„éŸ³é »æ•¸æ“š"
                return result

            # 4. æå–éŸ³é »æ•¸æ“š
            audio_data = incomplete_chunk[audio_data_start:]
            if len(audio_data) < 8:
                result.error_message = "éŸ³é »æ•¸æ“šé•·åº¦ä¸è¶³"
                return result

            # 5. ä¿®å¾©æª”é ­ä¸­çš„æ™‚é–“æˆ³ä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
            repaired_header = self._update_header_timestamps(header_template, incomplete_chunk)

            # 6. æ‹¼æ¥ä¿®å¾©å¾Œçš„æ•¸æ“š
            repaired_data = repaired_header + audio_data

            # 7. é©—è­‰ä¿®å¾©çµæœ
            if self.validate_repaired_chunk(repaired_data):
                result.success = True
                result.repaired_data = repaired_data
                result.original_header_size = len(repaired_header)
                result.audio_data_size = len(audio_data)
                self._repair_stats['successful_repairs'] += 1

                logger.debug(f"æˆåŠŸä¿®å¾© chunk: æª”é ­={len(repaired_header)} bytes, "
                           f"éŸ³é »={len(audio_data)} bytes, "
                           f"ç¸½è¨ˆ={len(repaired_data)} bytes")
            else:
                result.error_message = "ä¿®å¾©å¾Œçš„æ•¸æ“šé©—è­‰å¤±æ•—"

        except Exception as e:
            result.error_message = f"æª”é ­ä¿®å¾©ç•°å¸¸: {str(e)}"
            logger.error(f"æª”é ­ä¿®å¾©ç™¼ç”ŸéŒ¯èª¤: {e}")

        finally:
            repair_time_ms = (time.time() - start_time) * 1000
            result.repair_time_ms = repair_time_ms
            self._repair_stats['total_repair_time_ms'] += repair_time_ms

        return result

    def validate_repaired_chunk(self, repaired_chunk: bytes) -> bool:
        """
        é©—è­‰ä¿®å¾©å¾Œçš„ WebM chunk æ˜¯å¦æœ‰æ•ˆ

        Args:
            repaired_chunk: ä¿®å¾©å¾Œçš„ WebM æ•¸æ“š

        Returns:
            bool: True è¡¨ç¤ºé©—è­‰é€šéï¼ŒFalse è¡¨ç¤ºé©—è­‰å¤±æ•—
        """
        try:
            if not repaired_chunk or len(repaired_chunk) < 32:
                return False

            # 1. æª¢æŸ¥æ˜¯å¦æœ‰å®Œæ•´çš„æª”é ­
            if not is_webm_header_complete(repaired_chunk):
                logger.debug("ä¿®å¾©å¾Œçš„ chunk æª”é ­ä»ä¸å®Œæ•´")
                return False

            # 2. æª¢æ¸¬æª”é ­è³‡è¨Š
            header_info = detect_webm_header_info(repaired_chunk)
            if not header_info.is_complete:
                logger.debug(f"æª”é ­é©—è­‰å¤±æ•—: {header_info.error_message}")
                return False

            # 3. æª¢æŸ¥æ•¸æ“šé•·åº¦åˆç†æ€§
            if header_info.header_size >= len(repaired_chunk):
                logger.debug("æª”é ­å¤§å°ç•°å¸¸ï¼Œç­‰æ–¼æˆ–è¶…éç¸½æ•¸æ“šå¤§å°")
                return False

            # 4. æª¢æŸ¥æ˜¯å¦æœ‰éŸ³é »æ•¸æ“š
            audio_data_size = len(repaired_chunk) - header_info.header_size
            if audio_data_size < 8:
                logger.debug("éŸ³é »æ•¸æ“šé•·åº¦ä¸è¶³")
                return False

            logger.debug(f"ä¿®å¾©é©—è­‰é€šé: æª”é ­={header_info.header_size} bytes, "
                        f"éŸ³é »={audio_data_size} bytes, "
                        f"ç·¨ç¢¼å™¨={header_info.codec_type}")

            return True

        except Exception as e:
            logger.error(f"ä¿®å¾©é©—è­‰ç™¼ç”ŸéŒ¯èª¤: {e}")
            return False

    def get_repair_statistics(self) -> dict:
        """
        ç²å–ä¿®å¾©çµ±è¨ˆä¿¡æ¯

        Returns:
            dict: åŒ…å«ä¿®å¾©çµ±è¨ˆæ•¸æ“šçš„å­—å…¸
        """
        stats = self._repair_stats.copy()

        # è¨ˆç®—æˆåŠŸç‡
        if stats['total_extractions'] > 0:
            stats['extraction_success_rate'] = stats['successful_extractions'] / stats['total_extractions']
        else:
            stats['extraction_success_rate'] = 0.0

        if stats['total_repairs'] > 0:
            stats['repair_success_rate'] = stats['successful_repairs'] / stats['total_repairs']
            stats['average_repair_time_ms'] = stats['total_repair_time_ms'] / stats['total_repairs']
        else:
            stats['repair_success_rate'] = 0.0
            stats['average_repair_time_ms'] = 0.0

        return stats

    def _validate_extracted_header(self, header_data: bytes) -> bool:
        """
        é©—è­‰æå–çš„æª”é ­æ˜¯å¦æœ‰æ•ˆ

        Args:
            header_data: æå–çš„æª”é ­æ•¸æ“š

        Returns:
            bool: True è¡¨ç¤ºæœ‰æ•ˆï¼ŒFalse è¡¨ç¤ºç„¡æ•ˆ
        """
        try:
            # æª¢æŸ¥åŸºæœ¬é•·åº¦
            if len(header_data) < 32:
                return False

            # æª¢æŸ¥ EBML header æ¨™è¨˜
            if header_data[:4] != b'\x1A\x45\xDF\xA3':
                return False

            # ä½¿ç”¨ç¾æœ‰çš„æª”é ­æª¢æ¸¬åŠŸèƒ½é€²è¡Œæ·±åº¦é©—è­‰
            header_info = detect_webm_header_info(header_data)
            return header_info.has_ebml_header and header_info.has_segment

        except Exception:
            return False

    def _find_audio_data_start(self, incomplete_chunk: bytes) -> int:
        """
        åœ¨ä¸å®Œæ•´çš„ chunk ä¸­å°‹æ‰¾éŸ³é »æ•¸æ“šçš„èµ·å§‹ä½ç½®

        Args:
            incomplete_chunk: ä¸å®Œæ•´çš„ WebM chunk

        Returns:
            int: éŸ³é »æ•¸æ“šèµ·å§‹ä½ç½®ï¼Œ-1 è¡¨ç¤ºæœªæ‰¾åˆ°
        """
        try:
            # 1. æª¢æŸ¥æ˜¯å¦ä»¥ Cluster å…ƒç´ é–‹å§‹ (0x1F43B675)
            cluster_marker = b'\x1F\x43\xB6\x75'
            if incomplete_chunk.startswith(cluster_marker):
                return 0  # ç›´æ¥å¾ Cluster é–‹å§‹

            # 2. åœ¨å‰ 64 bytes ä¸­æœå°‹ Cluster æ¨™è¨˜
            search_range = min(len(incomplete_chunk), 64)
            for i in range(search_range - len(cluster_marker) + 1):
                if incomplete_chunk[i:i + len(cluster_marker)] == cluster_marker:
                    return i

            # 3. å¦‚æœæ²’æ‰¾åˆ° Clusterï¼Œæª¢æŸ¥æ˜¯å¦åŒ…å«å…¶ä»–éŸ³é »æ•¸æ“šæ¨™è¨˜
            # SimpleBlock (0xA3) æˆ– Block (0xA1)
            audio_markers = [b'\xA3', b'\xA1']
            for marker in audio_markers:
                for i in range(search_range):
                    if incomplete_chunk[i:i + len(marker)] == marker:
                        return max(0, i - 8)  # å¾€å‰ä¸€é»ä»¥åŒ…å«å¯èƒ½çš„é•·åº¦è³‡è¨Š

            # 4. å¦‚æœéƒ½æ²’æ‰¾åˆ°ï¼Œå‡è¨­å¾é–‹å§‹å°±æ˜¯éŸ³é »æ•¸æ“š
            logger.debug("æœªæ‰¾åˆ°æ˜ç¢ºçš„éŸ³é »æ•¸æ“šæ¨™è¨˜ï¼Œå‡è¨­å¾é ­é–‹å§‹")
            return 0

        except Exception as e:
            logger.debug(f"å°‹æ‰¾éŸ³é »æ•¸æ“šèµ·å§‹ä½ç½®æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
            return 0  # é è¨­å¾é–‹å§‹è™•ç†

    def _update_header_timestamps(self, header_template: bytes, incomplete_chunk: bytes) -> bytes:
        """
        æ›´æ–°æª”é ­ä¸­çš„æ™‚é–“æˆ³ä¿¡æ¯ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

        Args:
            header_template: åŸå§‹æª”é ­æ¨¡æ¿
            incomplete_chunk: ä¸å®Œæ•´çš„ chunkï¼ˆå¯èƒ½åŒ…å«æ™‚é–“æˆ³ä¿¡æ¯ï¼‰

        Returns:
            bytes: æ›´æ–°å¾Œçš„æª”é ­æ•¸æ“š
        """
        try:
            # ç›®å‰å…ˆè¿”å›åŸå§‹æª”é ­æ¨¡æ¿
            # æœªä¾†å¯ä»¥å¯¦ä½œæ›´è¤‡é›œçš„æ™‚é–“æˆ³æ›´æ–°é‚è¼¯
            return header_template

        except Exception as e:
            logger.debug(f"æ›´æ–°æª”é ­æ™‚é–“æˆ³æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
            return header_template


# END FILE CONTENTS


# File: frontend/app/layout.tsx

import type { Metadata } from 'next'
import './globals.css'
import { AppStateProviderWrapper } from '../providers/app-state-provider-wrapper'

export const metadata: Metadata = {
  title: 'study-scriber',
  description: 'study-scriber',
  generator: 'study-scriber',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en" data-testid="html-root">
      <body>
        <AppStateProviderWrapper>
          {children}
        </AppStateProviderWrapper>
      </body>
    </html>
  )
}


# END FILE CONTENTS


# File: frontend/components/ui/separator.tsx

"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }


# END FILE CONTENTS


# File: frontend/hooks/use-notes.ts

"use client"

import { useState, useCallback, useRef, useEffect, useMemo } from 'react'
import { notesAPI, type NoteUpdateRequest, type NoteResponse } from '../lib/api'
import { useLocalDraft } from './use-local-draft'

interface UseNotesReturn {
    noteContent: string
    lastSaved: Date | null
    isSaving: boolean
    error: string | null
    updateNote: (content: string) => void
    saveNote: (sessionId: string) => Promise<void>
    loadNote: (sessionId: string) => Promise<void>
    clearNote: () => void
    // æœ¬åœ°è‰ç¨¿ç›¸é—œ
    hasDraft: boolean
    lastDraftTime: Date | null
    restoreDraft: () => void
    clearDraft: () => void
}

export function useNotes(): UseNotesReturn {
    const [noteContent, setNoteContent] = useState('')
    const [lastSaved, setLastSaved] = useState<Date | null>(null)
    const [isSaving, setIsSaving] = useState(false)
    const [error, setError] = useState<string | null>(null)

    const autoSaveTimeoutRef = useRef<NodeJS.Timeout | null>(null)
    const lastContentRef = useRef('')
    const currentSessionIdRef = useRef<string | null>(null)

    // ä½¿ç”¨æœ¬åœ°è‰ç¨¿åŠŸèƒ½
    const localDraft = useLocalDraft(currentSessionIdRef.current || undefined)

    // æ¸…é™¤è‡ªå‹•å„²å­˜è¨ˆæ™‚å™¨
    const clearAutoSaveTimeout = useCallback(() => {
        if (autoSaveTimeoutRef.current) {
            clearTimeout(autoSaveTimeoutRef.current)
            autoSaveTimeoutRef.current = null
        }
    }, [])

    // åŸ·è¡Œå„²å­˜æ“ä½œ
    const performSave = useCallback(async (sessionId: string, content: string): Promise<void> => {
        if (!content.trim() || content === lastContentRef.current) {
            return // æ²’æœ‰è®Šæ›´ï¼Œä¸éœ€è¦å„²å­˜
        }

        setIsSaving(true)
        setError(null)

        try {
            const updateData: NoteUpdateRequest = {
                content,
                client_ts: new Date().toISOString()
            }

            await notesAPI.updateNote(sessionId, updateData)

            setLastSaved(new Date())
            lastContentRef.current = content
            console.log('âœ… ç­†è¨˜å„²å­˜æˆåŠŸ')

        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'å„²å­˜ç­†è¨˜å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ å„²å­˜ç­†è¨˜å¤±æ•—:', err)
        } finally {
            setIsSaving(false)
        }
    }, [])

    // æ‰‹å‹•å„²å­˜ç­†è¨˜
    const saveNote = useCallback(async (sessionId: string): Promise<void> => {
        clearAutoSaveTimeout()
        await performSave(sessionId, noteContent)
    }, [noteContent, performSave, clearAutoSaveTimeout])

    // æ›´æ–°ç­†è¨˜å…§å®¹ï¼ˆè§¸ç™¼è‡ªå‹•å„²å­˜ï¼‰
    const updateNote = useCallback((content: string): void => {
        setNoteContent(content)

        // ç«‹å³å„²å­˜æœ¬åœ°è‰ç¨¿
        localDraft.saveDraft(content)

        // å¦‚æœæœ‰ session IDï¼Œè¨­å®šè‡ªå‹•å„²å­˜åˆ°ä¼ºæœå™¨
        if (currentSessionIdRef.current) {
            clearAutoSaveTimeout()

            // 10 ç§’å¾Œè‡ªå‹•å„²å­˜åˆ°ä¼ºæœå™¨
            autoSaveTimeoutRef.current = setTimeout(() => {
                performSave(currentSessionIdRef.current!, content)
            }, 10000)
        }
    }, [performSave, clearAutoSaveTimeout, localDraft])

    // è¼‰å…¥ç­†è¨˜
    const loadNote = useCallback(async (sessionId: string): Promise<void> => {
        currentSessionIdRef.current = sessionId
        setError(null)

        try {
            const note = await notesAPI.getNote(sessionId)
            const serverContent = note.content
            const serverTimestamp = new Date(note.updated_at)

            // æª¢æŸ¥æ˜¯å¦æœ‰è¼ƒæ–°çš„æœ¬åœ°è‰ç¨¿
            if (localDraft.hasDraft && localDraft.isDraftNewer(serverTimestamp)) {
                console.log('âš ï¸ ç™¼ç¾è¼ƒæ–°çš„æœ¬åœ°è‰ç¨¿ï¼Œä½¿ç”¨è‰ç¨¿å…§å®¹')
                setNoteContent(localDraft.draftContent)
                lastContentRef.current = localDraft.draftContent
                // ä¸è¨­å®š lastSavedï¼Œå› ç‚ºè‰ç¨¿å…§å®¹å°šæœªåŒæ­¥åˆ°ä¼ºæœå™¨
            } else {
                setNoteContent(serverContent)
                lastContentRef.current = serverContent
                setLastSaved(serverTimestamp)
                // æ¸…é™¤éæ™‚çš„æœ¬åœ°è‰ç¨¿
                localDraft.clearDraft()
            }

            console.log('âœ… ç­†è¨˜è¼‰å…¥æˆåŠŸ')

        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'è¼‰å…¥ç­†è¨˜å¤±æ•—'
            setError(errorMessage)
            console.error('âŒ è¼‰å…¥ç­†è¨˜å¤±æ•—:', err)

            // å¦‚æœç­†è¨˜ä¸å­˜åœ¨ï¼Œæª¢æŸ¥æ˜¯å¦æœ‰æœ¬åœ°è‰ç¨¿
            if (errorMessage.includes('404') || errorMessage.includes('not found')) {
                if (localDraft.hasDraft) {
                    console.log('ğŸ“ ä½¿ç”¨æœ¬åœ°è‰ç¨¿å…§å®¹')
                    setNoteContent(localDraft.draftContent)
                } else {
                    setNoteContent('')
                }
                lastContentRef.current = ''
                console.log('ğŸ”„ åˆå§‹åŒ–ç©ºç­†è¨˜')
            }
        }
    }, [localDraft])

    // æ¸…é™¤ç­†è¨˜
    const clearNote = useCallback(() => {
        clearAutoSaveTimeout()
        setNoteContent('')
        setLastSaved(null)
        setError(null)
        lastContentRef.current = ''
        currentSessionIdRef.current = null
        localDraft.clearDraft()
        console.log('ğŸ”„ ç­†è¨˜å·²æ¸…é™¤')
    }, [clearAutoSaveTimeout, localDraft])

    // é‚„åŸæœ¬åœ°è‰ç¨¿
    const restoreDraft = useCallback(() => {
        const draftContent = localDraft.loadDraft()
        if (draftContent) {
            setNoteContent(draftContent)
            console.log('ğŸ”„ å·²é‚„åŸæœ¬åœ°è‰ç¨¿')
        }
    }, [localDraft])

    // çµ„ä»¶å¸è¼‰æ™‚æ¸…ç†
    useEffect(() => {
        return () => {
            clearAutoSaveTimeout()
        }
    }, [clearAutoSaveTimeout])

    return useMemo(() => ({
        noteContent,
        lastSaved,
        isSaving,
        error,
        updateNote,
        saveNote,
        loadNote,
        clearNote,
        hasDraft: localDraft.hasDraft,
        lastDraftTime: localDraft.lastDraftTime,
        restoreDraft,
        clearDraft: localDraft.clearDraft,
    }), [
        noteContent,
        lastSaved,
        isSaving,
        error,
        updateNote,
        saveNote,
        loadNote,
        clearNote,
        localDraft.hasDraft,
        localDraft.lastDraftTime,
        restoreDraft,
        localDraft.clearDraft,
    ])
}


# END FILE CONTENTS


# File: frontend/components/ui/popover.tsx

"use client"

import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }


# END FILE CONTENTS


# File: app/lib/prom_helpers.py

from prometheus_client import REGISTRY
from typing import Any

def metric_exists(name: str) -> bool:
    """åˆ¤æ–· default CollectorRegistry è£¡æ˜¯å¦å·²æœ‰åŒå metric"""
    return any(m.name == name for m in REGISTRY.collect())

def safe_counter(name: str, documentation: str, labelnames: list[str] | None = None) -> Any:
    from prometheus_client import Counter
    if name in REGISTRY._names_to_collectors:
        return REGISTRY._names_to_collectors[name]
    return Counter(name, documentation, labelnames or [])

def safe_gauge(name: str, documentation: str, labelnames: list[str] | None = None) -> Any:
    from prometheus_client import Gauge
    if name in REGISTRY._names_to_collectors:
        return REGISTRY._names_to_collectors[name]
    return Gauge(name, documentation, labelnames or [])

def safe_summary(name: str, documentation: str, labelnames: list[str] | None = None) -> Any:
    from prometheus_client import Summary
    if name in REGISTRY._names_to_collectors:
        return REGISTRY._names_to_collectors[name]
    return Summary(name, documentation, labelnames or [])


# END FILE CONTENTS


# File: frontend/components/ui/checkbox.tsx

"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }


# END FILE CONTENTS


# File: frontend/hooks/use-app-state-new.ts

"use client"

import { useCallback, useEffect, useState, useRef } from "react"
import { useAppStateContext } from "./use-app-state-context"
import { useSession } from "./use-session-adapter"
import { useRecording } from "./use-recording-adapter"
import { useNotes } from "./use-notes"
import { useTranscript } from "./use-transcript-adapter"
import { useToast } from "@/components/ui/use-toast"
import type { AppData } from "../types/app-state"
import { StateMachineManager } from '../lib/state-machine';

/**
 * æ–°ç‰ˆæœ¬çš„ useAppState Hook
 * ä½¿ç”¨ Context ç‹€æ…‹ç®¡ç†ï¼Œå¤§å¹…ç°¡åŒ–åŸæœ¬ 868 è¡Œçš„è¤‡é›œé‚è¼¯
 * å°‡ç‹€æ…‹ç®¡ç†å§”è¨—çµ¦ AppStateContextï¼ŒHook åªè² è²¬æ¥­å‹™é‚è¼¯
 */
export function useAppStateNew() {
  const context = useAppStateContext()
  const { appData, isLoading, error, dispatch, transition } = context
  const session = useSession()
  const recording = useRecording()
  const notes = useNotes()
  const transcript = useTranscript()
  const { toast } = useToast()

  console.log('ğŸ”„ [useAppStateNew] Hook åˆå§‹åŒ–:', {
    currentState: appData.state,
    isRecording: appData.isRecording,
    sessionId: appData.session?.id,
    transcriptCount: appData.transcriptEntries.length
  })

  const stateMachineManagerRef = useRef<StateMachineManager | null>(null);

  // ç¢ºä¿ç‹€æ…‹æ©Ÿç®¡ç†å™¨åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œé¿å… React StrictMode é‡è¤‡åˆå§‹åŒ–
  if (!stateMachineManagerRef.current) {
    console.log('ğŸ”„ [useAppStateNew] åˆå§‹åŒ–ç‹€æ…‹æ©Ÿç®¡ç†å™¨');

    const smManager = new StateMachineManager({
      currentState: appData.state,
      isRecording: appData.isRecording,
      transcriptCount: appData.transcriptEntries.length,
      session: appData.session || null,
      error: error,
    });

    // ç«‹å³è¨»å†Šå‰¯ä½œç”¨è™•ç†å™¨
    smManager.registerSideEffectHandler('CREATE_SESSION', {
      handleSideEffect: async (effect) => {
        console.log('ğŸ—ï¸ [å‰¯ä½œç”¨] CREATE_SESSION: å»ºç«‹æœƒè©±', effect);
        // å¾ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡ç²å–æ¨™é¡Œ
        const context = smManager.getStateMachine().getContext();
        const title = context.pendingSessionTitle || 'New Recording';
        const newSession = await session.createRecordingSession(title, appData.editorContent);
        if (newSession) {
          dispatch({ type: 'SET_SESSION', payload: newSession });
          // æ›´æ–°ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡
          smManager.getStateMachine().updateContext({
            currentState: appData.state,
            isRecording: appData.isRecording,
            transcriptCount: appData.transcriptEntries.length,
            session: newSession,
            error: error,
            pendingSessionTitle: undefined, // æ¸…é™¤å¾…å»ºç«‹æœƒè©±æ¨™é¡Œ
          });
          localStorage.removeItem('draft_note');
        } else {
          throw new Error('ç„¡æ³•å»ºç«‹éŒ„éŸ³æœƒè©±');
        }
      }
    });
    smManager.registerSideEffectHandler('START_RECORDING', {
      handleSideEffect: async () => {
        // å¾ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡ç²å–æœ€æ–°çš„ session è³‡è¨Š
        const context = smManager.getStateMachine().getContext();
        if (context.session?.id) {
          console.log('ğŸ¤ [å‰¯ä½œç”¨] START_RECORDING: é–‹å§‹éŒ„éŸ³', context.session.id);
          await recording.startRecording(context.session.id);
        } else {
          console.error('ğŸ¤ [å‰¯ä½œç”¨] START_RECORDING: æ²’æœ‰å¯ç”¨çš„ session');
        }
      }
    });
    smManager.registerSideEffectHandler('STOP_RECORDING', {
      handleSideEffect: async () => {
        await stopRecording();
      }
    });
    smManager.registerSideEffectHandler('CONNECT_WEBSOCKET', {
      handleSideEffect: async () => {
        // å¾ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡ç²å–æœ€æ–°çš„ session è³‡è¨Š
        const context = smManager.getStateMachine().getContext();
        if (context.session?.id) {
          console.log('ğŸ”Œ [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: é€£æ¥ WebSocket', context.session.id);
          await transcript.connect(context.session.id);
        } else {
          console.error('ğŸ”Œ [å‰¯ä½œç”¨] CONNECT_WEBSOCKET: æ²’æœ‰å¯ç”¨çš„ session');
        }
      }
    });
    smManager.registerSideEffectHandler('DISCONNECT_WEBSOCKET', {
      handleSideEffect: () => {
        transcript.disconnect();
      }
    });
    smManager.registerSideEffectHandler('FINISH_SESSION', {
      handleSideEffect: async () => {
        await finishSession();
      }
    });

    stateMachineManagerRef.current = smManager;
  }

  const stateMachineManager = stateMachineManagerRef.current;

  useEffect(() => {
    stateMachineManager.getStateMachine().updateContext({
      currentState: appData.state,
      isRecording: appData.isRecording,
      transcriptCount: appData.transcriptEntries.length,
      session: appData.session,
      error: error,
    });
  }, [appData, error, stateMachineManager]);

  // å»ºç«‹ç´”ç­†è¨˜æœƒè©±
  const createNoteSession = useCallback(async (title?: string) => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      const newSession = await session.createNoteSession(title ?? undefined)
      if (newSession) {
        dispatch({ type: 'SET_SESSION', payload: newSession })

        // è¼‰å…¥ç­†è¨˜å…§å®¹
        if (newSession.id) {
          await notes.loadNote(newSession.id)
        }

        // æ¸…é™¤æœ¬åœ°è‰ç¨¿
        localStorage.removeItem('draft_note')

        console.log('âœ… [useAppStateNew] ç´”ç­†è¨˜æœƒè©±å»ºç«‹æˆåŠŸ')

        toast({
          title: 'ç­†è¨˜æœƒè©±å·²å»ºç«‹',
          description: `æœƒè©± "${title}" å»ºç«‹æˆåŠŸ`,
        })
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹ç­†è¨˜æœƒè©±å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] å»ºç«‹ç­†è¨˜æœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å»ºç«‹å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, notes, toast, dispatch])

  // å»ºç«‹éŒ„éŸ³æœƒè©±
  const createRecordingSession = useCallback(async (title?: string) => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      const newSession = await session.createRecordingSession(title, appData.editorContent)
      if (newSession) {
        dispatch({ type: 'SET_SESSION', payload: newSession })

        // è¼‰å…¥ç­†è¨˜å…§å®¹
        await notes.loadNote(newSession.id)

        // æ¸…é™¤æœ¬åœ°è‰ç¨¿
        localStorage.removeItem('draft_note')

        console.log('âœ… [useAppStateNew] éŒ„éŸ³æœƒè©±å»ºç«‹æˆåŠŸ')

        toast({
          title: 'éŒ„éŸ³æœƒè©±å·²å»ºç«‹',
          description: `æœƒè©± "${title}" å»ºç«‹æˆåŠŸ`,
        })
      }
    } catch (err) {
      // ç‰¹åˆ¥è™•ç†æœƒè©±è¡çªéŒ¯èª¤
      if (err instanceof Error && err.message.includes('æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çª')) {
        const conflictMsg = 'åµæ¸¬åˆ°æœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
        dispatch({ type: 'SET_ERROR', payload: conflictMsg })

        toast({
          title: 'æœƒè©±è¡çª',
          description: 'ç›®å‰å·²æœ‰æ´»èºæœƒè©±ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ï¼Œæˆ–ç­‰å¾…ç•¶å‰æœƒè©±çµæŸ',
          variant: 'destructive'
        })
        return
      }

      const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] å»ºç«‹éŒ„éŸ³æœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å»ºç«‹å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, notes, toast, dispatch, appData.editorContent])

  // é–‹å§‹éŒ„éŸ³ - å®Œå…¨å§”è¨—çµ¦ç‹€æ…‹æ©Ÿ
  const startRecording = useCallback(async (title?: string) => {
    console.log("ğŸ¤ [useAppStateNew] startRecording: è§¸ç™¼ç‹€æ…‹æ©Ÿ")

    // æª¢æŸ¥ç‹€æ…‹æ©Ÿæ˜¯å¦å·²åˆå§‹åŒ–
    if (!stateMachineManager) {
      console.error("ğŸ¤ [useAppStateNew] ç‹€æ…‹æ©Ÿå°šæœªåˆå§‹åŒ–")
      toast({ title: 'ç³»çµ±åˆå§‹åŒ–ä¸­', description: 'è«‹ç¨å¾Œå†è©¦', variant: 'destructive' })
      return
    }

    dispatch({ type: 'SET_LOADING', payload: true })

    try {
      // å¦‚æœç•¶å‰ç‹€æ…‹ä¸æ˜¯ defaultï¼Œå…ˆé‡ç½®ç‹€æ…‹
      if (appData.state !== 'default') {
        console.log("ğŸ”„ [useAppStateNew] ç•¶å‰ç‹€æ…‹é defaultï¼Œå…ˆé‡ç½®ç‹€æ…‹:", appData.state)
        dispatch({ type: 'RESET_STATE' })
        // æ¸…é™¤ç›¸é—œç‹€æ…‹
        recording.clearTranscripts()
        transcript.clearTranscripts()
        // æ›´æ–°ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡
        stateMachineManager.getStateMachine().updateContext({
          currentState: 'default',
          isRecording: false,
          transcriptCount: 0,
          session: null,
          error: null,
        });
      }

      // æª¢æŸ¥æ˜¯å¦æœ‰ç¾æœ‰æœƒè©±éœ€è¦è™•ç†
      const latestActiveSession = await session.checkActiveSession()
      const currentSession = latestActiveSession || session.currentSession

      // æ›´æ–°ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡ï¼ŒåŒ…å«å¾…å»ºç«‹æœƒè©±çš„æ¨™é¡Œ
      stateMachineManager.getStateMachine().updateContext({
        currentState: 'default', // ç¢ºä¿å¾ default ç‹€æ…‹é–‹å§‹
        isRecording: appData.isRecording,
        transcriptCount: appData.transcriptEntries.length,
        session: currentSession,
        error: error,
        pendingSessionTitle: title,  // å‚³éæ¨™é¡Œçµ¦ç‹€æ…‹æ©Ÿ
      });

      if (currentSession?.type === 'note_only') {
        // å‡ç´šç¾æœ‰æœƒè©±
        console.log("ğŸ¤ [useAppStateNew] å‡ç´šç¾æœ‰æœƒè©±ç‚ºéŒ„éŸ³æ¨¡å¼")
        const upgradedSession = await session.upgradeToRecording()
        if (upgradedSession) {
          dispatch({ type: 'SET_SESSION', payload: upgradedSession })
          // å†æ¬¡æ›´æ–°ç‹€æ…‹æ©Ÿä¸Šä¸‹æ–‡
          stateMachineManager.getStateMachine().updateContext({
            currentState: 'default', // ç¢ºä¿å¾ default ç‹€æ…‹é–‹å§‹
            isRecording: appData.isRecording,
            transcriptCount: appData.transcriptEntries.length,
            session: upgradedSession,
            error: error,
            pendingSessionTitle: title,
          });
        }
      }

      // è§¸ç™¼ç‹€æ…‹è½‰æ› - è®“ç‹€æ…‹æ©Ÿè™•ç†æ‰€æœ‰é‚è¼¯
      console.log("ğŸ¤ [useAppStateNew] æº–å‚™è§¸ç™¼ç‹€æ…‹è½‰æ› USER_START_RECORDING")
      const result = transition('USER_START_RECORDING');
      console.log("ğŸ¤ [useAppStateNew] ç‹€æ…‹è½‰æ›çµæœ:", result)

      if (!result?.success) {
        throw new Error(result?.error || 'ç‹€æ…‹è½‰æ›å¤±æ•—');
      }

      console.log("ğŸ¤ [useAppStateNew] ç‹€æ…‹æ©Ÿè™•ç†å®Œæˆ")
      toast({ title: 'éŒ„éŸ³é–‹å§‹' })

    } catch (err) {
      const msg = err instanceof Error ? err.message : 'é–‹å§‹éŒ„éŸ³å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: msg })

      console.error("ğŸ¤ [useAppStateNew] éŒ„éŸ³å¤±æ•—:", msg)
      toast({ title: 'éŒ„éŸ³å¤±æ•—', description: msg, variant: 'destructive' })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, toast, dispatch, transition, stateMachineManager, appData.state, appData.isRecording, appData.transcriptEntries, error, recording, transcript])

  // å‡ç´šæœƒè©±ç‚ºéŒ„éŸ³æ¨¡å¼
  const upgradeToRecording = useCallback(async () => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      const updatedSession = await session.upgradeToRecording()
      if (updatedSession) {
        dispatch({ type: 'SET_SESSION', payload: updatedSession })

        console.log('âœ… [useAppStateNew] æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼æˆåŠŸ')

        toast({
          title: 'å‡ç´šæˆåŠŸ',
          description: 'æœƒè©±å·²å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼',
        })
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å‡ç´šæœƒè©±å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] å‡ç´šæœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å‡ç´šå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, toast, dispatch])

  // åœæ­¢éŒ„éŸ³
  const stopRecording = useCallback(async () => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      await recording.stopRecording()
      transcript.disconnect()

      // è§¸ç™¼ç‹€æ…‹è½‰æ›
      transition('USER_STOP_RECORDING');

      console.log('âœ… [useAppStateNew] éŒ„éŸ³åœæ­¢ï¼Œé–‹å§‹è™•ç†é€å­—ç¨¿')

      toast({
        title: 'è™•ç†ä¸­',
        description: 'æ­£åœ¨è™•ç†éŒ„éŸ³å…§å®¹ï¼Œè«‹ç¨å€™...',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'åœæ­¢éŒ„éŸ³å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] åœæ­¢éŒ„éŸ³å¤±æ•—:', err)

      toast({
        title: 'åœæ­¢å¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [recording, transcript, toast, dispatch, transition])

  // å®Œæˆæœƒè©±
  const finishSession = useCallback(async () => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      await session.finishSession()
      // åœ¨é€™è£¡ä¸éœ€è¦è§¸ç™¼ç‹€æ…‹è½‰æ›ï¼Œå› ç‚º stopRecording å·²ç¶“è™•ç†äº†
      // dispatch({ type: 'SET_APP_STATE', payload: 'finished' })

      console.log('âœ… [useAppStateNew] æœƒè©±å®Œæˆ')

      toast({
        title: 'æœƒè©±å®Œæˆ',
        description: 'æ‚¨å¯ä»¥åŒ¯å‡ºç­†è¨˜æˆ–é–‹å§‹æ–°çš„ç­†è¨˜',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'å®Œæˆæœƒè©±å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] å®Œæˆæœƒè©±å¤±æ•—:', err)

      toast({
        title: 'å®Œæˆå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, toast, dispatch])

  // é–‹æ–°ç­†è¨˜
  const newNote = useCallback(async () => {
    dispatch({ type: 'SET_LOADING', payload: true })
    dispatch({ type: 'CLEAR_ERROR' })

    try {
      // å¦‚æœæœ‰æ´»èºæœƒè©±ï¼Œå…ˆåˆªé™¤å®ƒ
      if (session.currentSession) {
        console.log('ğŸ—‘ï¸ [useAppStateNew] åˆªé™¤ç•¶å‰æ´»èºæœƒè©±:', session.currentSession.id)
        await session.deleteSession()
      }

      // è§¸ç™¼ç‹€æ…‹è½‰æ›
      transition('USER_NEW_NOTE');

      // é‡ç½®æ‰€æœ‰ç‹€æ…‹
      dispatch({ type: 'RESET_STATE' })

      // æ¸…é™¤ç›¸é—œç‹€æ…‹
      recording.clearTranscripts()
      transcript.clearTranscripts()
      notes.clearNote()

      // æ¸…é™¤æœ¬åœ°è‰ç¨¿
      localStorage.removeItem('draft_note')

      console.log('ğŸ”„ [useAppStateNew] å·²é–‹å§‹æ–°ç­†è¨˜')

      toast({
        title: 'æ–°ç­†è¨˜',
        description: 'å·²æ¸…ç©ºå…§å®¹ï¼Œå¯ä»¥é–‹å§‹æ–°çš„ç­†è¨˜',
      })
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'é–‹å§‹æ–°ç­†è¨˜å¤±æ•—'
      dispatch({ type: 'SET_ERROR', payload: errorMessage })

      console.error('âŒ [useAppStateNew] é–‹å§‹æ–°ç­†è¨˜å¤±æ•—:', err)

      toast({
        title: 'æ“ä½œå¤±æ•—',
        description: errorMessage,
        variant: 'destructive',
      })
    } finally {
      dispatch({ type: 'SET_LOADING', payload: false })
    }
  }, [session, recording, transcript, notes, toast, dispatch, transition])

  // è‡ªå‹•å„²å­˜ç­†è¨˜å…§å®¹åˆ°æœ¬åœ°è‰ç¨¿
  const saveLocalDraft = useCallback((content: string) => {
    if (!session.currentSession && content.trim()) {
      localStorage.setItem('draft_note', content)
    }
    dispatch({ type: 'SET_EDITOR_CONTENT', payload: content })
  }, [session.currentSession, dispatch])

  // ä½¿ç”¨ useCallback ä¾†è¨˜æ†¶å‡½æ•¸
  const createRecordingSessionCallback = useCallback(createRecordingSession, [session, notes, toast, dispatch, appData.editorContent]);
  const startRecordingCallback = useCallback(startRecording, [session, recording, toast, dispatch, appData.editorContent, transition]);
  const stopRecordingCallback = useCallback(stopRecording, [recording, transcript, toast, dispatch, transition]);
  const finishSessionCallback = useCallback(finishSession, [session, toast, dispatch]);
  const connectTranscriptCallback = useCallback(transcript.connect, [transcript]);
  const disconnectTranscriptCallback = useCallback(transcript.disconnect, [transcript]);

  return {
    // æ‡‰ç”¨ç‹€æ…‹ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
    appData,
    isLoading,
    error,

    // æœƒè©±ç®¡ç†
    createNoteSession,
    createRecordingSession,
    upgradeToRecording,
    finishSession,
    newNote,

    // éŒ„éŸ³æ§åˆ¶
    startRecording,
    stopRecording,

    // æœ¬åœ°è‰ç¨¿
    saveLocalDraft,

    // å¤–éƒ¨ç‹€æ…‹ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
    session: session.currentSession,
    sessionLoading: session.isLoading,
    sessionError: session.error,

    // éŒ„éŸ³ç‹€æ…‹
    recordingError: recording.error,

    // é€å­—ç¨¿ç‹€æ…‹
    transcriptConnected: transcript.isConnected,
    transcriptError: transcript.error,
    transcriptAutoScroll: transcript.autoScrollEnabled,
    enableAutoScroll: transcript.enableAutoScroll,
    disableAutoScroll: transcript.disableAutoScroll,
    scrollToLatest: transcript.scrollToLatest,
  }
}


# END FILE CONTENTS


# File: app/services/azure_openai_v2.py

#!/usr/bin/env python3
"""
éŸ³è¨Šè½‰éŒ„æœå‹™ v2
ä½¿ç”¨å¤§åˆ‡ç‰‡ï¼ˆ10-15ç§’ï¼‰+ ç›´æ¥è½‰æ›çš„æ¶æ§‹ï¼Œé¿å…è¤‡é›œçš„ WebM åˆä½µ
"""

import asyncio
import logging
import subprocess
import tempfile
import time
from datetime import datetime
from pathlib import Path
from typing import Dict, Optional, Any, Set
from uuid import UUID
import json
import os
from asyncio import PriorityQueue, Semaphore

from openai import AsyncAzureOpenAI, RateLimitError
from httpx import Timeout

# Task 5: Prometheus ç›£æ§ä¾è³´
try:
    import prometheus_client as prom
    PROMETHEUS_AVAILABLE = True
except ImportError:
    PROMETHEUS_AVAILABLE = False
    logger.warning("prometheus-client æœªå®‰è£ï¼Œç›£æ§æŒ‡æ¨™å°‡è¢«åœç”¨")

from ..db.database import get_supabase_client
from app.core.config import settings
from app.core.ffmpeg import detect_audio_format
from app.core.webm_header_repairer import WebMHeaderRepairer
from app.ws.transcript_feed import manager as transcript_manager
from app.services.r2_client import R2Client

logger = logging.getLogger(__name__)

# Task 5: Prometheus ç›£æ§æŒ‡æ¨™
if PROMETHEUS_AVAILABLE:
    # è½‰éŒ„è«‹æ±‚è¨ˆæ•¸å™¨
    WHISPER_REQ_TOTAL = prom.Counter(
        "whisper_requests_total",
        "Total Whisper API requests",
        ["status", "deployment"]
    )

    # è½‰éŒ„å»¶é²æŒ‡æ¨™
    WHISPER_LATENCY_SECONDS = prom.Summary(
        "whisper_latency_seconds",
        "Whisper API latency",
        ["deployment"]
    )

    # éšŠåˆ—ç©å£“æŒ‡æ¨™
    WHISPER_BACKLOG_GAUGE = prom.Gauge(
        "whisper_backlog_size",
        "Current queue backlog size"
    )

    # éšŠåˆ—è™•ç†çµ±è¨ˆ
    QUEUE_PROCESSED_TOTAL = prom.Counter(
        "queue_processed_total",
        "Total processed jobs",
        ["status"]
    )

    # éšŠåˆ—ç­‰å¾…æ™‚é–“
    QUEUE_WAIT_SECONDS = prom.Summary(
        "queue_wait_seconds",
        "Time jobs spend waiting in queue"
    )

    # ä½µç™¼è™•ç†æ•¸é‡
    CONCURRENT_JOBS_GAUGE = prom.Gauge(
        "concurrent_transcription_jobs",
        "Current number of concurrent transcription jobs"
    )

    # æ»‘å‹•è¦–çª—å°ˆç”¨æŒ‡æ¨™
    SLIDING_WINDOW_PERMITS = prom.Gauge(
        "sliding_window_available_permits",
        "Available permits in sliding window rate limiter"
    )

    SLIDING_WINDOW_ACTIVE_REQUESTS = prom.Gauge(
        "sliding_window_active_requests",
        "Current active requests in sliding window"
    )

    SLIDING_WINDOW_QUEUE_TIME = prom.Summary(
        "sliding_window_queue_seconds",
        "Time spent waiting for sliding window permit"
    )

    API_QUOTA_UTILIZATION = prom.Gauge(
        "azure_api_quota_utilization_percent",
        "Azure API quota utilization percentage"
    )

    RATE_LIMITER_TYPE = prom.Gauge(
        "rate_limiter_type",
        "Type of rate limiter in use (0=traditional, 1=sliding_window)",
        ["limiter_type"]
    )

    # æ®µè½éæ¿¾æŒ‡æ¨™
    WHISPER_SEGMENTS_FILTERED = prom.Counter(
        "whisper_segments_filtered_total",
        "Total number of segments filtered by quality checks",
        ["reason", "deployment"]
    )

    logger.info("ğŸ“Š [Metrics] Prometheus ç›£æ§æŒ‡æ¨™å·²åˆå§‹åŒ–")
else:
    # å¦‚æœ Prometheus ä¸å¯ç”¨ï¼Œå‰µå»ºç©ºçš„ä½”ä½ç¬¦
    class NoOpMetric:
        def inc(self, *args, **kwargs): pass
        def set(self, *args, **kwargs): pass
        def time(self): return self
        def __enter__(self): return self
        def __exit__(self, *args): pass
        def labels(self, *args, **kwargs): return self

    WHISPER_REQ_TOTAL = NoOpMetric()
    WHISPER_LATENCY_SECONDS = NoOpMetric()
    WHISPER_BACKLOG_GAUGE = NoOpMetric()
    QUEUE_PROCESSED_TOTAL = NoOpMetric()
    QUEUE_WAIT_SECONDS = NoOpMetric()
    CONCURRENT_JOBS_GAUGE = NoOpMetric()
    SLIDING_WINDOW_PERMITS = NoOpMetric()
    SLIDING_WINDOW_ACTIVE_REQUESTS = NoOpMetric()
    SLIDING_WINDOW_QUEUE_TIME = NoOpMetric()
    API_QUOTA_UTILIZATION = NoOpMetric()
    RATE_LIMITER_TYPE = NoOpMetric()
    WHISPER_SEGMENTS_FILTERED = NoOpMetric()

# å…¨åŸŸæ•ˆèƒ½ç›£æ§é–‹é—œ
ENABLE_PERFORMANCE_LOGGING = os.getenv("ENABLE_PERFORMANCE_LOGGING", "true").lower() == "true"

# Task 1: å„ªåŒ–çš„ timeout é…ç½®
TIMEOUT = Timeout(connect=5, read=55, write=30, pool=5)

# Task 3: ä½µç™¼æ§åˆ¶èˆ‡ä»»å‹™å„ªå…ˆç´šé…ç½®ï¼ˆä½¿ç”¨settingsé…ç½®å€¼ï¼‰
# æ”¹ç‚ºå¾ settings å‹•æ…‹è®€å–ï¼Œæ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®
QUEUE_HIGH_PRIORITY = 0  # é‡è©¦ä»»å‹™é«˜å„ªå…ˆç´š
QUEUE_NORMAL_PRIORITY = 1  # æ­£å¸¸ä»»å‹™

# Task 4: éŸ³è¨Šæ®µè½é…ç½® - ç§»é™¤ç¡¬ç·¨ç¢¼ï¼Œä½¿ç”¨é…ç½®å€¼
# CHUNK_DURATION ç¾åœ¨åœ¨ç¬¬ 751 è¡Œå¾ settings.AUDIO_CHUNK_DURATION_SEC è®€å–
PROCESSING_TIMEOUT = 60  # è™•ç†è¶…æ™‚æ™‚é–“ï¼ˆç§’ï¼‰

class PerformanceTimer:
    """æ•ˆèƒ½è¨ˆæ™‚å™¨"""

    def __init__(self, operation_name: str):
        self.operation_name = operation_name
        self.start_time = None
        self.end_time = None

    def __enter__(self):
        self.start_time = time.time()
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.end_time = time.time()
        duration = self.get_duration()

        if ENABLE_PERFORMANCE_LOGGING:
            if duration > 1.0:  # è¨˜éŒ„è¶…é1ç§’çš„æ“ä½œ
                logger.warning(f"âš ï¸  {self.operation_name} took {duration:.2f}s (slow)")
            else:
                logger.info(f"â±ï¸  {self.operation_name} completed in {duration:.2f}s")

    def get_duration(self) -> float:
        if self.start_time and self.end_time:
            return self.end_time - self.start_time
        return 0.0

# Task 2: æ™ºèƒ½é »ç‡é™åˆ¶è™•ç†å™¨
class RateLimitHandler:
    """æ™ºèƒ½é »ç‡é™åˆ¶è™•ç†å™¨ - é¿å…éé•·ç­‰å¾…"""

    def __init__(self):
        self._delay = 0
        logger.info("ğŸš¦ [RateLimitHandler] é »ç‡é™åˆ¶è™•ç†å™¨å·²åˆå§‹åŒ–")

    async def wait(self):
        """ç­‰å¾…ç•¶å‰å»¶é²æ™‚é–“"""
        if self._delay:
            logger.info(f"â³ [RateLimitHandler] ç­‰å¾… {self._delay}s é¿å…é »ç‡é™åˆ¶")
            await asyncio.sleep(self._delay)

    def backoff(self):
        """å¢åŠ é€€é¿å»¶é²ï¼ˆæŒ‡æ•¸é€€é¿ï¼Œæœ€å¤§ 60 ç§’ï¼‰"""
        previous_delay = self._delay
        self._delay = min((self._delay or 5) * 2, 60)  # æœ€å¤§ 60 ç§’
        logger.warning(f"ğŸ“ˆ [RateLimitHandler] é€€é¿å»¶é²ï¼š{previous_delay}s â†’ {self._delay}s")

    def reset(self):
        """é‡ç½®å»¶é²ï¼ˆAPI å‘¼å«æˆåŠŸæ™‚ï¼‰"""
        if self._delay > 0:
            logger.info(f"âœ… [RateLimitHandler] é‡ç½®å»¶é²ï¼š{self._delay}s â†’ 0s")
            self._delay = 0

# æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶è™•ç†å™¨
class SlidingWindowRateLimiter:
    """æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶è™•ç†å™¨ - ç²¾ç¢ºæ§åˆ¶ API é…é¡ä½¿ç”¨"""

    def __init__(self, max_requests: int = 3, window_seconds: int = 60):
        """
        åˆå§‹åŒ–æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶å™¨

        Args:
            max_requests: æ»‘å‹•è¦–çª—å…§æœ€å¤§è«‹æ±‚æ•¸ï¼ˆé è¨­ 3ï¼‰
            window_seconds: æ»‘å‹•è¦–çª—æ™‚é–“é•·åº¦ï¼ˆé è¨­ 60 ç§’ï¼‰
        """
        self.max_requests = max_requests
        self.window_seconds = window_seconds
        self.semaphore = Semaphore(max_requests)
        self.active_requests = 0
        self.total_acquired = 0
        self.total_released = 0
        self._lock = asyncio.Lock()  # ä¿è­·çµ±è¨ˆæ•¸æ“šçš„ä¸€è‡´æ€§

        logger.info(f"ğŸªŸ [SlidingWindow] åˆå§‹åŒ–å®Œæˆï¼š{max_requests} requests/{window_seconds}s")

    async def acquire(self) -> None:
        """
        å–å¾— API å‘¼å«è¨±å¯

        ä½¿ç”¨ semaphore æ§åˆ¶ä½µç™¼æ•¸ï¼Œä¸¦é€šé call_later å¯¦ç¾æ»‘å‹•è¦–çª—è‡ªå‹•é‡‹æ”¾
        """
        logger.debug(f"ğŸ« [SlidingWindow] è«‹æ±‚è¨±å¯ï¼Œç•¶å‰æ´»èº: {self.active_requests}/{self.max_requests}")

        # è¨˜éŒ„ç­‰å¾…é–‹å§‹æ™‚é–“ï¼ˆç”¨æ–¼ Prometheus æŒ‡æ¨™ï¼‰
        wait_start_time = time.time()

        # ç­‰å¾… semaphore è¨±å¯
        await self.semaphore.acquire()

        # è¨ˆç®—ç­‰å¾…æ™‚é–“ä¸¦æ›´æ–° Prometheus æŒ‡æ¨™
        wait_duration = time.time() - wait_start_time
        SLIDING_WINDOW_QUEUE_TIME.observe(wait_duration)

        # æ›´æ–°çµ±è¨ˆæ•¸æ“šï¼ˆä½¿ç”¨é–ä¿è­·ï¼‰
        async with self._lock:
            self.active_requests += 1
            self.total_acquired += 1

        # æ›´æ–° Prometheus æŒ‡æ¨™
        SLIDING_WINDOW_ACTIVE_REQUESTS.set(self.active_requests)
        SLIDING_WINDOW_PERMITS.set(self.max_requests - self.active_requests)

        # æ›´æ–°é…é¡åˆ©ç”¨ç‡æŒ‡æ¨™
        utilization = (self.active_requests / self.max_requests) * 100
        API_QUOTA_UTILIZATION.set(utilization)

        # å®‰æ’ window_seconds å¾Œè‡ªå‹•é‡‹æ”¾è¨±å¯
        try:
            loop = asyncio.get_event_loop()
            loop.call_later(self.window_seconds, self._release_permit)
            logger.debug(f"âœ… [SlidingWindow] è¨±å¯å·²å–å¾—ï¼Œæ´»èºè«‹æ±‚: {self.active_requests}, å°‡åœ¨ {self.window_seconds}s å¾Œè‡ªå‹•é‡‹æ”¾")
        except Exception as e:
            # å¦‚æœ call_later å¤±æ•—ï¼Œç«‹å³é‡‹æ”¾è¨±å¯é¿å…æ­»é–
            logger.error(f"âŒ [SlidingWindow] call_later è¨­å®šå¤±æ•—: {e}")
            self.semaphore.release()
            async with self._lock:
                self.active_requests = max(0, self.active_requests - 1)
            # å›æ»¾ Prometheus æŒ‡æ¨™
            SLIDING_WINDOW_ACTIVE_REQUESTS.set(self.active_requests)
            SLIDING_WINDOW_PERMITS.set(self.max_requests - self.active_requests)
            utilization = (self.active_requests / self.max_requests) * 100
            API_QUOTA_UTILIZATION.set(utilization)
            raise

    def _release_permit(self) -> None:
        """
        é‡‹æ”¾è¨±å¯ï¼ˆç§æœ‰æ–¹æ³•ï¼Œç”± call_later èª¿ç”¨ï¼‰

        æ³¨æ„ï¼šæ­¤æ–¹æ³•åœ¨äº‹ä»¶å¾ªç’°çš„å›èª¿ä¸­åŸ·è¡Œï¼Œå¿…é ˆæ˜¯åŒæ­¥çš„
        """
        try:
            self.semaphore.release()

            # æ›´æ–°çµ±è¨ˆæ•¸æ“šï¼ˆæ³¨æ„ï¼šæ­¤è™•ç„¡æ³•ä½¿ç”¨ async lockï¼‰
            # ä½¿ç”¨åŸå­æ“ä½œç¢ºä¿ä¸€è‡´æ€§
            self.active_requests = max(0, self.active_requests - 1)
            self.total_released += 1

            # æ›´æ–° Prometheus æŒ‡æ¨™
            SLIDING_WINDOW_ACTIVE_REQUESTS.set(self.active_requests)
            SLIDING_WINDOW_PERMITS.set(self.max_requests - self.active_requests)

            # æ›´æ–°é…é¡åˆ©ç”¨ç‡æŒ‡æ¨™
            utilization = (self.active_requests / self.max_requests) * 100
            API_QUOTA_UTILIZATION.set(utilization)

            logger.debug(f"ğŸ« [SlidingWindow] è¨±å¯å·²è‡ªå‹•é‡‹æ”¾ï¼Œæ´»èºè«‹æ±‚: {self.active_requests}")
        except Exception as e:
            logger.error(f"âŒ [SlidingWindow] é‡‹æ”¾è¨±å¯æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")

    async def wait(self) -> None:
        """
        ç­‰å¾…è¨±å¯ï¼ˆç›¸å®¹æ–¼ RateLimitHandler ä»‹é¢ï¼‰

        æ­¤æ–¹æ³•æä¾›èˆ‡ç¾æœ‰ RateLimitHandler.wait() ç›¸åŒçš„ä»‹é¢
        """
        await self.acquire()

    def get_stats(self) -> dict:
        """
        ç²å–æ»‘å‹•è¦–çª—çµ±è¨ˆè³‡è¨Š

        Returns:
            dict: åŒ…å«ç•¶å‰ç‹€æ…‹çš„çµ±è¨ˆè³‡è¨Š
        """
        return {
            'type': 'sliding_window',
            'max_requests': self.max_requests,
            'window_seconds': self.window_seconds,
            'active_requests': self.active_requests,
            'available_permits': self.max_requests - self.active_requests,
            'total_acquired': self.total_acquired,
            'total_released': self.total_released,
            'utilization_percent': (self.active_requests / self.max_requests) * 100 if self.max_requests > 0 else 0,
            'is_at_capacity': self.active_requests >= self.max_requests
        }

    def reset(self) -> None:
        """
        é‡ç½®çµ±è¨ˆæ•¸æ“šï¼ˆä¿æŒèˆ‡ RateLimitHandler ä»‹é¢ä¸€è‡´ï¼‰

        æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸æœƒå½±éŸ¿ç•¶å‰çš„ semaphore ç‹€æ…‹æˆ–æ´»èºè«‹æ±‚
        """
        logger.info(f"ğŸ”„ [SlidingWindow] é‡ç½®çµ±è¨ˆæ•¸æ“š")
        self.total_acquired = 0
        self.total_released = 0

    def backoff(self) -> None:
        """
        é€€é¿è™•ç†ï¼ˆç›¸å®¹æ–¼ RateLimitHandler ä»‹é¢ï¼‰

        å°æ–¼æ»‘å‹•è¦–çª— Rate Limiterï¼Œé€€é¿å¯¦éš›ä¸Šæ˜¯ç”±è‡ªå‹•æ’éšŠæ©Ÿåˆ¶è™•ç†ï¼Œ
        æ­¤æ–¹æ³•ä¸»è¦ç”¨æ–¼è¨˜éŒ„å’Œçµ±è¨ˆç›®çš„
        """
        logger.warning(f"ğŸš¦ [SlidingWindow] é‡åˆ° 429 éŒ¯èª¤ï¼Œæ»‘å‹•è¦–çª—å°‡è‡ªå‹•è™•ç†é€€é¿")

    @property
    def _delay(self) -> int:
        """
        æ¨¡æ“¬å»¶é²å±¬æ€§ï¼ˆç›¸å®¹æ–¼ RateLimitHandler ä»‹é¢ï¼‰

        å°æ–¼æ»‘å‹•è¦–çª—ï¼Œ"å»¶é²"æ¦‚å¿µæ˜¯åŸºæ–¼å¯ç”¨è¨±å¯æ•¸é‡è¨ˆç®—çš„é ä¼°ç­‰å¾…æ™‚é–“
        """
        if self.active_requests >= self.max_requests:
            # å¦‚æœå·²é”å®¹é‡ä¸Šé™ï¼Œä¼°ç®—éœ€è¦ç­‰å¾…çš„æ™‚é–“
            return max(1, self.window_seconds // 4)  # ä¼°ç®—ç­‰å¾…æ™‚é–“
        return 0

    def __str__(self) -> str:
        """å­—ä¸²è¡¨ç¤º"""
        return f"SlidingWindowRateLimiter({self.max_requests}/{self.window_seconds}s, active={self.active_requests})"

    def __repr__(self) -> str:
        """è©³ç´°å­—ä¸²è¡¨ç¤º"""
        return f"SlidingWindowRateLimiter(max_requests={self.max_requests}, window_seconds={self.window_seconds}, active_requests={self.active_requests})"

# Task 3: è½‰éŒ„ä»»å‹™ä½‡åˆ—ç®¡ç†å™¨
class TranscriptionQueueManager:
    """å„ªå…ˆç´šéšŠåˆ—ç®¡ç†å™¨ - ç¢ºä¿é †åºè™•ç†ä¸¦é¿å…ç©å£“"""

    def __init__(self):
        # å„ªå…ˆç´šéšŠåˆ— (priority, timestamp, job_data)
        self.queue: PriorityQueue = PriorityQueue(maxsize=settings.MAX_QUEUE_SIZE)
        # ä½µç™¼æ§åˆ¶ä¿¡è™Ÿé‡ï¼ˆä½¿ç”¨é…ç½®å€¼ï¼‰
        self.semaphore = Semaphore(settings.MAX_CONCURRENT_TRANSCRIPTIONS)
        # Worker ä»»å‹™
        self.workers: list[asyncio.Task] = []
        # Task 4: ç©å£“ç›£æ§ä»»å‹™
        self.backlog_monitor_task: Optional[asyncio.Task] = None
        # çµ±è¨ˆæ•¸æ“š
        self.total_processed = 0
        self.total_failed = 0
        self.total_retries = 0
        # Task 4: ç©å£“é–¾å€¼å’Œç›£æ§é–“éš”ï¼ˆä½¿ç”¨é…ç½®å€¼ï¼‰
        self.backlog_threshold = settings.QUEUE_BACKLOG_THRESHOLD
        self.monitor_interval = settings.QUEUE_MONITOR_INTERVAL
        self.last_backlog_alert = 0  # ä¸Šæ¬¡ç©å£“è­¦å ±æ™‚é–“
        self.backlog_alert_cooldown = settings.QUEUE_ALERT_COOLDOWN
        # é‹è¡Œç‹€æ…‹
        self.is_running = False

        logger.info(f"ğŸ¯ [QueueManager] åˆå§‹åŒ–å®Œæˆï¼šmax_concurrent={settings.MAX_CONCURRENT_TRANSCRIPTIONS}, max_queue={settings.MAX_QUEUE_SIZE}")

    async def start_workers(self, num_workers: int = None):
        """å•Ÿå‹• Worker ä»»å‹™"""
        if self.is_running:
            logger.warning("âš ï¸ [QueueManager] Workers already running")
            return

        # ä½¿ç”¨é…ç½®å€¼ä½œç‚ºé»˜èªå€¼
        if num_workers is None:
            num_workers = settings.TRANSCRIPTION_WORKERS_COUNT

        self.is_running = True
        logger.info(f"ğŸš€ [QueueManager] å•Ÿå‹• {num_workers} å€‹ Workersï¼ˆé…ç½®å€¼ï¼š{settings.TRANSCRIPTION_WORKERS_COUNT}ï¼‰")

        # å•Ÿå‹•å·¥ä½œç·šç¨‹
        for i in range(num_workers):
            worker_task = asyncio.create_task(self._worker(f"Worker-{i+1}"))
            self.workers.append(worker_task)

        # Task 4: å•Ÿå‹•ç©å£“ç›£æ§
        self.backlog_monitor_task = asyncio.create_task(self._backlog_monitor())
        logger.info("ğŸ“Š [QueueManager] ç©å£“ç›£æ§å·²å•Ÿå‹•")

    async def stop_workers(self):
        """åœæ­¢æ‰€æœ‰ Workers"""
        if not self.is_running:
            return

        logger.info("â¹ï¸ [QueueManager] åœæ­¢æ‰€æœ‰ Workers")
        self.is_running = False

        # Task 4: åœæ­¢ç©å£“ç›£æ§
        if self.backlog_monitor_task:
            self.backlog_monitor_task.cancel()
            try:
                await self.backlog_monitor_task
            except asyncio.CancelledError:
                pass

        # å–æ¶ˆæ‰€æœ‰ worker ä»»å‹™
        for worker in self.workers:
            worker.cancel()

        # ç­‰å¾…æ‰€æœ‰ä»»å‹™å®Œæˆ
        await asyncio.gather(*self.workers, return_exceptions=True)
        self.workers.clear()

    async def enqueue_job(self, session_id: UUID, chunk_sequence: int, webm_data: bytes, priority: int = QUEUE_NORMAL_PRIORITY):
        """å°‡è½‰éŒ„ä»»å‹™åŠ å…¥éšŠåˆ—"""
        timestamp = time.time()
        job_data = {
            'session_id': session_id,
            'chunk_sequence': chunk_sequence,
            'webm_data': webm_data,
            'timestamp': timestamp,
            'retry_count': 0
        }

        try:
            # ä½¿ç”¨ put_nowait é¿å…é˜»å¡ï¼Œå¦‚æœéšŠåˆ—æ»¿äº†æœƒæ‹‹å‡ºç•°å¸¸
            self.queue.put_nowait((priority, timestamp, job_data))

            # Task 5: æ›´æ–°éšŠåˆ—å¤§å°æŒ‡æ¨™
            queue_size = self.queue.qsize()
            WHISPER_BACKLOG_GAUGE.set(queue_size)

            priority_name = "HIGH" if priority == QUEUE_HIGH_PRIORITY else "NORMAL"
            logger.info(f"ğŸ“¥ [QueueManager] ä»»å‹™å·²å…¥éšŠï¼šsession={session_id}, chunk={chunk_sequence}, priority={priority_name}, queue_size={queue_size}")

        except asyncio.QueueFull:
            logger.error(f"âŒ [QueueManager] éšŠåˆ—å·²æ»¿ ({settings.MAX_QUEUE_SIZE})ï¼Œä¸Ÿæ£„ä»»å‹™ï¼šsession={session_id}, chunk={chunk_sequence}")
            # å¯ä»¥è€ƒæ…®å»£æ’­éšŠåˆ—æ»¿çš„éŒ¯èª¤åˆ°å‰ç«¯
            await self._broadcast_queue_full_error(session_id, chunk_sequence)
            raise Exception(f"Transcription queue is full ({settings.MAX_QUEUE_SIZE}), please try again later")

    async def _worker(self, worker_name: str):
        """Worker å”ç¨‹ - è™•ç†éšŠåˆ—ä¸­çš„ä»»å‹™"""
        logger.info(f"ğŸ‘· [QueueManager] {worker_name} é–‹å§‹å·¥ä½œ")

        while self.is_running:
            try:
                # ç­‰å¾…ä»»å‹™
                try:
                    priority, timestamp, job_data = await asyncio.wait_for(
                        self.queue.get(),
                        timeout=1.0  # 1ç§’è¶…æ™‚ï¼Œè®“ worker èƒ½å®šæœŸæª¢æŸ¥é‹è¡Œç‹€æ…‹
                    )
                except asyncio.TimeoutError:
                    continue  # è¶…æ™‚å¾Œç¹¼çºŒæª¢æŸ¥é‹è¡Œç‹€æ…‹

                # æª¢æŸ¥ä»»å‹™æ˜¯å¦éæœŸ
                age = time.time() - timestamp
                if age > settings.QUEUE_TIMEOUT_SECONDS:
                    logger.warning(f"â° [QueueManager] {worker_name} ä¸Ÿæ£„éæœŸä»»å‹™ï¼šage={age:.1f}s, session={job_data['session_id']}, chunk={job_data['chunk_sequence']}")
                    self.queue.task_done()
                    continue

                # Task 5: è¨˜éŒ„éšŠåˆ—ç­‰å¾…æ™‚é–“
                wait_time = time.time() - timestamp
                QUEUE_WAIT_SECONDS.observe(wait_time)

                # ç²å–ä½µç™¼æ§åˆ¶æ¬Š
                async with self.semaphore:
                    session_id = job_data['session_id']
                    chunk_sequence = job_data['chunk_sequence']

                    logger.info(f"ğŸ”§ [QueueManager] {worker_name} è™•ç†ä»»å‹™ï¼šsession={session_id}, chunk={chunk_sequence}, age={age:.1f}s, wait={wait_time:.1f}s")

                    try:
                        # åŸ·è¡Œè½‰éŒ„
                        result = await self._process_transcription_job(job_data)

                        if result is True:
                            self.total_processed += 1
                            # Task 5: è¨˜éŒ„æˆåŠŸè™•ç†çš„ä»»å‹™
                            QUEUE_PROCESSED_TOTAL.labels(status="success").inc()
                            logger.info(f"âœ… [QueueManager] {worker_name} ä»»å‹™å®Œæˆï¼šsession={session_id}, chunk={chunk_sequence}")
                        elif result == "filtered":
                            self.total_processed += 1
                            # Task 5: è¨˜éŒ„è¢«éæ¿¾çš„ä»»å‹™
                            QUEUE_PROCESSED_TOTAL.labels(status="filtered").inc()
                            logger.info(f"ğŸ”‡ [QueueManager] {worker_name} ä»»å‹™è¢«éæ¿¾ï¼ˆéœéŸ³ï¼‰ï¼Œè·³éé‡è©¦ï¼šsession={session_id}, chunk={chunk_sequence}")
                        else:
                            # è™•ç†å¤±æ•—ï¼Œæ±ºå®šæ˜¯å¦é‡è©¦
                            # Task 5: è¨˜éŒ„å¤±æ•—è™•ç†çš„ä»»å‹™
                            QUEUE_PROCESSED_TOTAL.labels(status="failed").inc()
                            await self._handle_job_failure(job_data, worker_name)

                    except Exception as e:
                        logger.error(f"ğŸ’¥ [QueueManager] {worker_name} ä»»å‹™ç•°å¸¸ï¼šsession={session_id}, chunk={chunk_sequence}, error={e}")
                        # Task 5: è¨˜éŒ„ç•°å¸¸è™•ç†çš„ä»»å‹™
                        QUEUE_PROCESSED_TOTAL.labels(status="exception").inc()
                        await self._handle_job_failure(job_data, worker_name)

                # æ¨™è¨˜ä»»å‹™å®Œæˆ
                self.queue.task_done()

            except Exception as e:
                logger.error(f"ğŸ’¥ [QueueManager] {worker_name} Worker ç•°å¸¸ï¼š{e}")
                await asyncio.sleep(1)  # çŸ­æš«ä¼‘æ¯å¾Œç¹¼çºŒ

        logger.info(f"ğŸ‘· [QueueManager] {worker_name} åœæ­¢å·¥ä½œ")

    async def _process_transcription_job(self, job_data: dict) -> bool:
        """è™•ç†å–®å€‹è½‰éŒ„ä»»å‹™"""
        session_id = job_data['session_id']
        chunk_sequence = job_data['chunk_sequence']
        webm_data = job_data['webm_data']

        try:
            # ç²å–è½‰éŒ„æœå‹™
            service = await initialize_transcription_service_v2()
            if not service:
                logger.error(f"âŒ [QueueManager] è½‰éŒ„æœå‹™ä¸å¯ç”¨ï¼šsession={session_id}, chunk={chunk_sequence}")
                return False

            # åŸ·è¡Œè½‰éŒ„
            result = await service._transcribe_audio(webm_data, session_id, chunk_sequence)
            if result:
                # æª¢æŸ¥æ˜¯å¦ç‚ºè¢«éæ¿¾çš„çµæœ
                if isinstance(result, dict) and result.get("filtered"):
                    logger.info(f"ğŸ”‡ [QueueManager] Chunk {chunk_sequence} è¢«éœéŸ³éæ¿¾ï¼Œè·³éé‡è©¦ï¼šsession={session_id}")
                    return "filtered"  # è¿”å›ç‰¹æ®Šæ¨™è¨˜ï¼Œè¡¨ç¤ºä¸éœ€è¦é‡è©¦
                else:
                    # å„²å­˜ä¸¦å»£æ’­æ­£å¸¸çµæœ
                    await service._save_and_push_result(session_id, chunk_sequence, result)
                    return True
            else:
                logger.warning(f"âš ï¸ [QueueManager] è½‰éŒ„ç„¡çµæœï¼šsession={session_id}, chunk={chunk_sequence}")
                return False

        except RateLimitError as e:
            logger.warning(f"ğŸš¦ [é »ç‡é™åˆ¶] Chunk {chunk_sequence} é‡åˆ° 429 éŒ¯èª¤ï¼š{str(e)}")
            # æ³¨æ„ï¼šé€™è£¡ä¸èª¿ç”¨ rate_limit.backoff()ï¼Œå› ç‚ºå®ƒæ˜¯åœ¨è½‰éŒ„æœå‹™ä¸­è™•ç†çš„
            return False
        except Exception as e:
            logger.error(f"âŒ [QueueManager] è½‰éŒ„å¤±æ•—ï¼šsession={session_id}, chunk={chunk_sequence}, error={e}")
            return False

    async def _handle_job_failure(self, job_data: dict, worker_name: str):
        """è™•ç†ä»»å‹™å¤±æ•—ï¼ˆæš«æ™‚ä¸ Retryï¼‰"""
        session_id = job_data['session_id']
        chunk_sequence = job_data['chunk_sequence']
        # retry_count = job_data.get('retry_count', 0)

        # ç›´æ¥è¨˜éŒ„å¤±æ•—ï¼Œä¸å†é‡è©¦
        self.total_failed += 1
        logger.error(f"âŒ [QueueManager] {worker_name} ä»»å‹™æœ€çµ‚å¤±æ•—ï¼šsession={session_id}, chunk={chunk_sequence}, no_retry")

        # å»£æ’­æœ€çµ‚å¤±æ•—é€šçŸ¥
        await self._broadcast_final_failure(session_id, chunk_sequence)

    async def _broadcast_queue_full_error(self, session_id: UUID, chunk_sequence: int):
        """å»£æ’­éšŠåˆ—æ»¿éŒ¯èª¤"""
        try:
            error_data = {
                "type": "transcription_error",
                "error_type": "queue_full",
                "message": f"è½‰éŒ„éšŠåˆ—å·²æ»¿ ({settings.MAX_QUEUE_SIZE})ï¼Œè«‹ç¨å¾Œé‡è©¦",
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "timestamp": datetime.utcnow().isoformat()
            }
            await transcript_manager.broadcast(
                json.dumps(error_data),
                str(session_id)
            )
        except Exception as e:
            logger.error(f"Failed to broadcast queue full error: {e}")

    async def _broadcast_final_failure(self, session_id: UUID, chunk_sequence: int):
        """å»£æ’­æœ€çµ‚å¤±æ•—é€šçŸ¥"""
        try:
            error_data = {
                "type": "transcription_error",
                "error_type": "final_failure",
                "message": f"æ®µè½ {chunk_sequence} è½‰éŒ„æœ€çµ‚å¤±æ•—ï¼Œå·²é”æœ€å¤§é‡è©¦æ¬¡æ•¸",
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "timestamp": datetime.utcnow().isoformat()
            }
            await transcript_manager.broadcast(
                json.dumps(error_data),
                str(session_id)
            )
        except Exception as e:
            logger.error(f"Failed to broadcast final failure: {e}")

    # Task 4: ç©å£“ç›£æ§å™¨
    async def _backlog_monitor(self):
        """ç©å£“ç›£æ§å”ç¨‹ - å®šæœŸæª¢æŸ¥éšŠåˆ—ç©å£“ä¸¦é€šçŸ¥å‰ç«¯"""
        logger.info("ğŸ“Š [BacklogMonitor] ç©å£“ç›£æ§é–‹å§‹")

        while self.is_running:
            try:
                queue_size = self.queue.qsize()
                current_time = time.time()

                # æª¢æŸ¥æ˜¯å¦è¶…éç©å£“é–¾å€¼
                if queue_size > self.backlog_threshold:
                    # æª¢æŸ¥å†·å»æ™‚é–“ï¼Œé¿å…é »ç¹é€šçŸ¥
                    if current_time - self.last_backlog_alert > self.backlog_alert_cooldown:
                        await self._broadcast_backlog_alert(queue_size)
                        self.last_backlog_alert = current_time
                        logger.warning(f"âš ï¸ [BacklogMonitor] éšŠåˆ—ç©å£“è­¦å ±ï¼šqueue_size={queue_size}, threshold={self.backlog_threshold}")

                # è¨˜éŒ„éšŠåˆ—ç‹€æ…‹ï¼ˆèª¿è©¦ç”¨ï¼‰
                if queue_size > 0:
                    logger.debug(f"ğŸ“Š [BacklogMonitor] éšŠåˆ—ç‹€æ…‹ï¼šsize={queue_size}, processed={self.total_processed}, failed={self.total_failed}")

                # ç­‰å¾…ä¸‹æ¬¡æª¢æŸ¥
                await asyncio.sleep(self.monitor_interval)

            except Exception as e:
                logger.error(f"ğŸ’¥ [BacklogMonitor] ç›£æ§ç•°å¸¸ï¼š{e}")
                await asyncio.sleep(self.monitor_interval)

        logger.info("ğŸ“Š [BacklogMonitor] ç©å£“ç›£æ§åœæ­¢")

    async def _broadcast_backlog_alert(self, queue_size: int):
        """å»£æ’­ç©å£“è­¦å ±åˆ°æ‰€æœ‰æ´»èºæœƒè©±"""
        try:
            # è¨ˆç®—é ä¼°ç­‰å¾…æ™‚é–“
            estimated_wait_minutes = (queue_size * 12) // 60  # å‡è¨­æ¯å€‹ä»»å‹™å¹³å‡ 12 ç§’

            alert_data = {
                "event": "stt_backlog",
                "type": "backlog_alert",
                "queue_size": queue_size,
                "threshold": self.backlog_threshold,
                "estimated_wait_minutes": estimated_wait_minutes,
                "message": f"è½‰éŒ„éšŠåˆ—ç©å£“ï¼š{queue_size} å€‹ä»»å‹™ç­‰å¾…è™•ç†ï¼Œé ä¼°å»¶é² {estimated_wait_minutes} åˆ†é˜",
                "timestamp": datetime.utcnow().isoformat(),
                "level": "warning" if queue_size < self.backlog_threshold * 2 else "critical"
            }

            # å»£æ’­åˆ°æ‰€æœ‰æ´»èºé€£æ¥
            active_connections = getattr(transcript_manager, 'active_connections', {})
            if active_connections:
                broadcast_message = json.dumps(alert_data)

                # å»£æ’­åˆ°æ‰€æœ‰æœƒè©±
                for session_id in list(active_connections.keys()):
                    try:
                        await transcript_manager.broadcast(broadcast_message, session_id)
                    except Exception as e:
                        logger.warning(f"Failed to broadcast backlog alert to session {session_id}: {e}")

                logger.info(f"ğŸ“¢ [BacklogMonitor] ç©å£“è­¦å ±å·²å»£æ’­åˆ° {len(active_connections)} å€‹æœƒè©±")
            else:
                logger.debug("ğŸ“¢ [BacklogMonitor] ç„¡æ´»èºæœƒè©±ï¼Œè·³éç©å£“è­¦å ±å»£æ’­")

        except Exception as e:
            logger.error(f"Failed to broadcast backlog alert: {e}")

    async def _broadcast_queue_recovery(self, queue_size: int):
        """å»£æ’­éšŠåˆ—æ¢å¾©æ­£å¸¸é€šçŸ¥"""
        try:
            recovery_data = {
                "event": "stt_recovery",
                "type": "queue_recovery",
                "queue_size": queue_size,
                "message": f"è½‰éŒ„éšŠåˆ—å·²æ¢å¾©æ­£å¸¸ï¼šç•¶å‰ {queue_size} å€‹ä»»å‹™",
                "timestamp": datetime.utcnow().isoformat(),
                "level": "info"
            }

            # å»£æ’­åˆ°æ‰€æœ‰æ´»èºé€£æ¥
            active_connections = getattr(transcript_manager, 'active_connections', {})
            if active_connections:
                broadcast_message = json.dumps(recovery_data)

                for session_id in list(active_connections.keys()):
                    try:
                        await transcript_manager.broadcast(broadcast_message, session_id)
                    except Exception as e:
                        logger.warning(f"Failed to broadcast recovery to session {session_id}: {e}")

                logger.info(f"ğŸ“¢ [BacklogMonitor] æ¢å¾©é€šçŸ¥å·²å»£æ’­åˆ° {len(active_connections)} å€‹æœƒè©±")

        except Exception as e:
            logger.error(f"Failed to broadcast queue recovery: {e}")

    def get_stats(self) -> dict:
        """ç²å–éšŠåˆ—çµ±è¨ˆä¿¡æ¯"""
        queue_size = self.queue.qsize()
        return {
            'queue_size': queue_size,
            'max_queue_size': settings.MAX_QUEUE_SIZE,
            'total_processed': self.total_processed,
            'total_failed': self.total_failed,
            'total_retries': self.total_retries,
            'workers_count': len(self.workers),
            'is_running': self.is_running,
            # Task 4: ç©å£“ç›£æ§çµ±è¨ˆ
            'backlog_threshold': self.backlog_threshold,
            'is_backlogged': queue_size > self.backlog_threshold,
            'monitor_interval': self.monitor_interval,
            'last_backlog_alert': self.last_backlog_alert,
            'estimated_wait_seconds': queue_size * 12 if queue_size > 0 else 0
        }

# é…ç½®å¸¸æ•¸
CHUNK_DURATION = settings.AUDIO_CHUNK_DURATION_SEC  # å¾é…ç½®è®€å–åˆ‡ç‰‡æ™‚é•·
PROCESSING_TIMEOUT = 30  # è™•ç†è¶…æ™‚ï¼ˆç§’ï¼‰
MAX_RETRIES = 3  # æœ€å¤§é‡è©¦æ¬¡æ•¸

# å…¨åŸŸé›†åˆè¿½è¹¤å·²å»£æ’­ active ç›¸ä½çš„ session
_active_phase_sent: Set[str] = set()

# Rate Limiter å·¥å» å‡½æ•¸
def get_rate_limiter():
    """
    Rate Limiter å·¥å» å‡½æ•¸ - æ ¹æ“šé…ç½®é¸æ“‡é©ç•¶çš„é »ç‡é™åˆ¶ç­–ç•¥

    Returns:
        RateLimitHandler æˆ– SlidingWindowRateLimiter å¯¦ä¾‹
    """
    if settings.USE_SLIDING_WINDOW_RATE_LIMIT:
        logger.info(f"ğŸªŸ [é…ç½®] ä½¿ç”¨æ»‘å‹•è¦–çª—é »ç‡é™åˆ¶ï¼š{settings.SLIDING_WINDOW_MAX_REQUESTS} requests/{settings.SLIDING_WINDOW_SECONDS}s")

        # æ›´æ–° Rate Limiter é¡å‹æŒ‡æ¨™
        RATE_LIMITER_TYPE.labels(limiter_type="sliding_window").set(1)
        RATE_LIMITER_TYPE.labels(limiter_type="traditional").set(0)

        return SlidingWindowRateLimiter(
            max_requests=settings.SLIDING_WINDOW_MAX_REQUESTS,
            window_seconds=settings.SLIDING_WINDOW_SECONDS
        )
    else:
        logger.info("ğŸš¦ [é…ç½®] ä½¿ç”¨å‚³çµ±æŒ‡æ•¸é€€é¿é »ç‡é™åˆ¶")

        # æ›´æ–° Rate Limiter é¡å‹æŒ‡æ¨™
        RATE_LIMITER_TYPE.labels(limiter_type="traditional").set(1)
        RATE_LIMITER_TYPE.labels(limiter_type="sliding_window").set(0)

        return RateLimitHandler()

# å…¨åŸŸé »ç‡é™åˆ¶è™•ç†å™¨ï¼ˆå‹•æ…‹é¸æ“‡ï¼‰
rate_limit = get_rate_limiter()

# Task 3: å…¨åŸŸéšŠåˆ—ç®¡ç†å™¨
queue_manager = TranscriptionQueueManager()

class SimpleAudioTranscriptionService:
    """ç°¡åŒ–çš„éŸ³è¨Šè½‰éŒ„æœå‹™"""

    def __init__(self, azure_client: AsyncAzureOpenAI, deployment_name: str):
        self.client = azure_client
        self.deployment_name = deployment_name
        self.processing_tasks: Dict[str, asyncio.Task] = {}

    def _keep(self, segment: dict) -> bool:
        """
        æ ¹æ“š Whisper verbose_json å›æ‡‰åˆ¤æ–·æ˜¯å¦ä¿ç•™è½‰éŒ„æ®µè½

        ä½¿ç”¨ no_speech_probã€avg_logprobã€compression_ratio ç­‰æŒ‡æ¨™éæ¿¾å¹»è¦ºå…§å®¹

        Args:
            segment: Whisper verbose_json æ ¼å¼çš„æ®µè½è³‡æ–™

        Returns:
            bool: True è¡¨ç¤ºä¿ç•™æ®µè½ï¼ŒFalse è¡¨ç¤ºéæ¿¾æ‰
        """
        try:
            # æª¢æŸ¥å¿…è¦æ¬„ä½æ˜¯å¦å­˜åœ¨
            required_fields = ['no_speech_prob', 'avg_logprob', 'compression_ratio']
            for field in required_fields:
                if field not in segment:
                    logger.warning(f"ğŸ” [æ®µè½éæ¿¾] æ®µè½ç¼ºå°‘å¿…è¦æ¬„ä½ '{field}'ï¼Œéæ¿¾æ‰")
                    WHISPER_SEGMENTS_FILTERED.labels(
                        reason="missing_field",
                        deployment=self.deployment_name
                    ).inc()
                    return False

            # æå–éæ¿¾æŒ‡æ¨™
            no_speech_prob = segment['no_speech_prob']
            avg_logprob = segment['avg_logprob']
            compression_ratio = segment['compression_ratio']

            # éæ¿¾æ¢ä»¶ 1: éœéŸ³æª¢æ¸¬ - no_speech_prob éé«˜
            if no_speech_prob >= settings.FILTER_NO_SPEECH:
                logger.debug(f"ğŸ”‡ [æ®µè½éæ¿¾] éœéŸ³æ©Ÿç‡éé«˜: {no_speech_prob:.3f} >= {settings.FILTER_NO_SPEECH}")
                WHISPER_SEGMENTS_FILTERED.labels(
                    reason="no_speech",
                    deployment=self.deployment_name
                ).inc()
                return False

            # éæ¿¾æ¢ä»¶ 2: ç½®ä¿¡åº¦æª¢æ¸¬ - avg_logprob éä½
            if avg_logprob < settings.FILTER_LOGPROB:
                logger.debug(f"ğŸ“‰ [æ®µè½éæ¿¾] ç½®ä¿¡åº¦éä½: {avg_logprob:.3f} < {settings.FILTER_LOGPROB}")
                WHISPER_SEGMENTS_FILTERED.labels(
                    reason="low_confidence",
                    deployment=self.deployment_name
                ).inc()
                return False

            # éæ¿¾æ¢ä»¶ 3: é‡è¤‡å…§å®¹æª¢æ¸¬ - compression_ratio éé«˜
            if compression_ratio > settings.FILTER_COMPRESSION:
                logger.debug(f"ğŸ”„ [æ®µè½éæ¿¾] é‡è¤‡æ¯”ç‡éé«˜: {compression_ratio:.3f} > {settings.FILTER_COMPRESSION}")
                WHISPER_SEGMENTS_FILTERED.labels(
                    reason="high_compression",
                    deployment=self.deployment_name
                ).inc()
                return False

            # æ‰€æœ‰æª¢æŸ¥é€šéï¼Œä¿ç•™æ®µè½
            logger.debug(f"âœ… [æ®µè½éæ¿¾] æ®µè½å“è³ªè‰¯å¥½ï¼Œä¿ç•™")
            logger.debug(f"   - éœéŸ³æ©Ÿç‡: {no_speech_prob:.3f} < {settings.FILTER_NO_SPEECH}")
            logger.debug(f"   - ç½®ä¿¡åº¦: {avg_logprob:.3f} >= {settings.FILTER_LOGPROB}")
            logger.debug(f"   - é‡è¤‡æ¯”ç‡: {compression_ratio:.3f} <= {settings.FILTER_COMPRESSION}")
            return True

        except Exception as e:
            logger.error(f"âŒ [æ®µè½éæ¿¾] éæ¿¾é‚è¼¯ç•°å¸¸: {e}")
            # ç•°å¸¸æƒ…æ³ä¸‹é è¨­éæ¿¾æ‰ï¼Œé¿å…ç”¢å‡ºéŒ¯èª¤å…§å®¹
            WHISPER_SEGMENTS_FILTERED.labels(
                reason="filter_error",
                deployment=self.deployment_name
            ).inc()
            return False

    # def _get_header_repairer(self) -> WebMHeaderRepairer:
    #     """å»¶é²åˆå§‹åŒ– WebM æª”é ­ä¿®å¾©å™¨ - å·²åœç”¨ï¼Œä¸å†éœ€è¦æª”é ­ä¿®å¾©"""
    #     if self._header_repairer is None:
    #         self._header_repairer = WebMHeaderRepairer()
    #     return self._header_repairer

    # def _extract_and_cache_header(self, session_id: str, chunk_0_data: bytes) -> bool:
    #     """æª”é ­æå–å’Œç·©å­˜ - å·²åœç”¨ï¼Œæ¯å€‹ chunk éƒ½æœ‰å®Œæ•´æª”é ­"""
    #     # ä¸å†éœ€è¦ï¼Œæ¯å€‹ chunk éƒ½åŒ…å«å®Œæ•´ WebM Header
    #     return True

    # def _get_cached_header(self, session_id: str) -> Optional[bytes]:
    #     """ç²å–ç·©å­˜æª”é ­ - å·²åœç”¨ï¼Œä¸å†éœ€è¦æª”é ­ç·©å­˜"""
    #     # ä¸å†éœ€è¦ï¼Œæ¯å€‹ chunk éƒ½åŒ…å«å®Œæ•´ WebM Header
    #     return None

    # def _clear_session_cache(self, session_id: str) -> None:
    #     """æ¸…ç†æœƒè©±ç·©å­˜ - å·²åœç”¨"""
    #     # ä¸å†éœ€è¦ç·©å­˜
    #     pass

    # def _cleanup_expired_cache(self) -> None:
    #     """æ¸…ç†éæœŸç·©å­˜ - å·²åœç”¨"""
    #     # ä¸å†éœ€è¦ç·©å­˜ç®¡ç†
    #     pass

    async def process_audio_chunk(self, session_id: UUID, chunk_sequence: int, webm_data: bytes) -> bool:
        """
        è™•ç†å–®ä¸€éŸ³è¨Šåˆ‡ç‰‡ - Task 3: ä½¿ç”¨éšŠåˆ—ç³»çµ±

        Args:
            session_id: æœƒè©± ID
            chunk_sequence: åˆ‡ç‰‡åºè™Ÿ
            webm_data: WebM éŸ³è¨Šæ•¸æ“š

        Returns:
            bool: è™•ç†æ˜¯å¦æˆåŠŸï¼ˆå…¥éšŠæˆåŠŸå³è¦–ç‚ºæˆåŠŸï¼‰
        """
        try:
            logger.info(f"ğŸš€ [TranscriptionService] æäº¤è½‰éŒ„ä»»å‹™ï¼šsession={session_id}, chunk={chunk_sequence}, size={len(webm_data)} bytes")

            # Task 3: å°‡ä»»å‹™æäº¤åˆ°éšŠåˆ—è€Œéç›´æ¥è™•ç†
            await queue_manager.enqueue_job(session_id, chunk_sequence, webm_data)

            # è¿”å› True è¡¨ç¤ºæˆåŠŸæäº¤åˆ°éšŠåˆ—
            return True

        except Exception as e:
            logger.error(f"âŒ [TranscriptionService] æäº¤ä»»å‹™å¤±æ•—ï¼šsession={session_id}, chunk={chunk_sequence}, error={e}")
            return False

    async def _process_chunk_async(self, session_id: UUID, chunk_sequence: int, webm_data: bytes):
        """éåŒæ­¥è™•ç†éŸ³è¨Šåˆ‡ç‰‡ (WebM ç›´æ¥è½‰éŒ„æ¶æ§‹ v2 + æª”é ­ä¿®å¾©)"""
        try:
            with PerformanceTimer(f"Process chunk {chunk_sequence} for session {session_id}"):
                session_id_str = str(session_id)
                logger.info(f"ï¿½ï¿½ [WebM ç›´æ¥è½‰éŒ„] é–‹å§‹è™•ç†éŸ³è¨Šåˆ‡ç‰‡ {chunk_sequence} (session: {session_id}, size: {len(webm_data)} bytes)")

                # æ­¥é©Ÿ 1: é©—è­‰å’Œä¿®å¾© WebM æ•¸æ“šï¼ˆæ•´åˆæª”é ­ä¿®å¾©é‚è¼¯ï¼‰
                processed_webm_data = await self._validate_and_repair_webm_data(session_id, chunk_sequence, webm_data)
                if processed_webm_data is None:
                    logger.error(f"âŒ [é©—è­‰å¤±æ•—] Chunk {chunk_sequence} é©—è­‰å¤±æ•—ï¼Œè·³éè™•ç†")
                    return

                # æ­¥é©Ÿ 3: WebM ç›´æ¥è½‰éŒ„ (ä½¿ç”¨ä¿®å¾©å¾Œçš„æ•¸æ“š)
                logger.info(f"âš¡ [æ¶æ§‹å„ªåŒ–] è·³é FFmpeg è½‰æ›ï¼Œç›´æ¥è½‰éŒ„ WebM (chunk {chunk_sequence})")
                transcript_result = await self._transcribe_audio(processed_webm_data, session_id, chunk_sequence)
                if not transcript_result:
                    logger.error(f"Failed to transcribe WebM chunk {chunk_sequence}")
                    return

                # æ­¥é©Ÿ 4: å„²å­˜ä¸¦æ¨é€çµæœ
                await self._save_and_push_result(session_id, chunk_sequence, transcript_result)

                logger.info(f"âœ… æˆåŠŸè™•ç†éŸ³è¨Šåˆ‡ç‰‡ {chunk_sequence}: '{transcript_result.get('text', '')[:50]}...'")

        except Exception as e:
            logger.error(f"Error processing chunk {chunk_sequence} for session {session_id}: {e}", exc_info=True)

    async def _validate_and_repair_webm_data(self, session_id: UUID, chunk_sequence: int, webm_data: bytes) -> Optional[bytes]:
        """
        ç°¡åŒ–çš„ WebM æ•¸æ“šé©—è­‰ï¼ˆå„ªåŒ–å¾Œæ¶æ§‹ï¼‰

        ç”±æ–¼ SegmentedAudioRecorder æ¯å€‹ chunk éƒ½åŒ…å«å®Œæ•´ WebM Headerï¼Œ
        ä¸å†éœ€è¦è¤‡é›œçš„æª”é ­ä¿®å¾©é‚è¼¯ï¼Œåªéœ€åŸºæœ¬é©—è­‰å³å¯ã€‚

        Args:
            session_id: æœƒè©± ID
            chunk_sequence: åˆ‡ç‰‡åºè™Ÿ
            webm_data: åŸå§‹ WebM éŸ³è¨Šæ•¸æ“š

        Returns:
            Optional[bytes]: é©—è­‰å¾Œçš„ WebM æ•¸æ“šï¼Œé©—è­‰å¤±æ•—æ™‚è¿”å› None
        """
        start_time = time.time()

        try:
            # æ­¥é©Ÿ 1: åŸºæœ¬æ•¸æ“šé©—è­‰
            if not webm_data or len(webm_data) < 50:
                logger.warning(f"WebM chunk {chunk_sequence} too small: {len(webm_data) if webm_data else 0} bytes")
                return None

            # æ­¥é©Ÿ 2: ç°¡åŒ–é©—è­‰ - æ¯å€‹ chunk éƒ½æ‡‰è©²æœ‰å®Œæ•´æª”é ­
            logger.debug(f"ğŸ¯ [ç°¡åŒ–é©—è­‰] Chunk {chunk_sequence} æ•¸æ“šå¤§å°: {len(webm_data)} bytes (session: {session_id})")

            # æª¢æŸ¥æ˜¯å¦ç‚º WebM æ ¼å¼ï¼ˆç°¡å–®æª¢æŸ¥ EBML headerï¼‰
            if webm_data[:4] == b'\x1A\x45\xDF\xA3':
                logger.debug(f"âœ… [æª”é ­æª¢æŸ¥] Chunk {chunk_sequence} åŒ…å«å®Œæ•´ WebM EBML header")
            else:
                logger.warning(f"âš ï¸ [æª”é ­æª¢æŸ¥] Chunk {chunk_sequence} å¯èƒ½ä¸æ˜¯æ¨™æº– WebM æ ¼å¼ï¼Œä½†ç¹¼çºŒè™•ç†")

            # æ­¥é©Ÿ 3: æ•ˆèƒ½çµ±è¨ˆ
            total_time = (time.time() - start_time) * 1000  # ms
            logger.debug(f"ğŸ“Š [ç°¡åŒ–è™•ç†] Chunk {chunk_sequence} é©—è­‰å®Œæˆ - ç¸½è¨ˆ: {total_time:.1f}ms")

            # æ•ˆèƒ½è­¦å‘Šï¼ˆæ‡‰è©²å¾ˆå¿«ï¼‰
            if total_time > 10:  # è¶…é10msè­¦å‘Šï¼ˆç°¡åŒ–å¾Œæ‡‰è©²æ›´å¿«ï¼‰
                logger.warning(f"âš ï¸ [æ•ˆèƒ½è­¦å‘Š] Chunk {chunk_sequence} ç°¡åŒ–é©—è­‰æ™‚é–“éé•·: {total_time:.1f}ms")

            return webm_data  # ç›´æ¥è¿”å›åŸå§‹æ•¸æ“š

        except Exception as e:
            logger.error(f"âŒ [ç°¡åŒ–é©—è­‰] Chunk {chunk_sequence} è™•ç†ç•°å¸¸: {e}")
            return webm_data  # é™ç´šä½¿ç”¨åŸå§‹æ•¸æ“š

    async def _convert_webm_to_wav(self, webm_data: bytes, chunk_sequence: int, session_id: UUID) -> Optional[bytes]:
        """
        å°‡ WebM / fMP4 è½‰æ›ç‚º WAV (ä¿ç•™ç”¨æ–¼æœ€çµ‚ä¸‹è¼‰æª”æ¡ˆ)

        æ³¨æ„ï¼šåœ¨ WebM ç›´æ¥è½‰éŒ„æ¶æ§‹ v2 ä¸­ï¼Œæ­¤æ–¹æ³•ä¸å†ç”¨æ–¼å³æ™‚è½‰éŒ„æµç¨‹ï¼Œ
        è€Œæ˜¯ä¿ç•™ä½œç‚ºæœ€çµ‚åŒ¯å‡ºæ™‚ç”Ÿæˆ WAV æª”æ¡ˆçš„å‚™é¸æ–¹æ¡ˆã€‚
        """

        async def _broadcast_error(error_type: str, error_message: str, details: str = None):
            """é€é WebSocket å»£æ’­éŒ¯èª¤è¨Šæ¯åˆ°å‰ç«¯"""
            try:
                from app.ws.transcript_feed import manager as transcript_manager

                # ç”ŸæˆéŸ³æª”è¨ºæ–·è³‡è¨Š
                hex_header = webm_data[:32].hex(' ', 8).upper() if webm_data else "ç„¡æ•¸æ“š"
                audio_format = detect_audio_format(webm_data)

                # æ ¹æ“šæª¢æ¸¬åˆ°çš„æ ¼å¼æä¾›å»ºè­°
                def get_format_suggestion(audio_format: str) -> str:
                    suggestions = {
                        'fmp4': 'å»ºè­°æª¢æŸ¥ç€è¦½å™¨éŒ„éŸ³è¨­å®šï¼Œæˆ–å˜—è©¦ä½¿ç”¨ WebM æ ¼å¼',
                        'mp4': 'å»ºè­°ç¢ºèªéŸ³æª”å®Œæ•´æ€§ï¼Œæˆ–å˜—è©¦ä½¿ç”¨ WebM æ ¼å¼',
                        'webm': 'å»ºè­°æª¢æŸ¥ WebM ç·¨ç¢¼å™¨è¨­å®š',
                        'unknown': 'å»ºè­°æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´éŸ³è¨ŠéŒ„è£½ï¼Œæˆ–å˜—è©¦é‡æ–°æ•´ç†é é¢'
                    }
                    return suggestions.get(audio_format, 'å»ºè­°æª¢æŸ¥éŸ³æª”æ ¼å¼æ˜¯å¦æ”¯æ´')

                error_data = {
                    "type": "conversion_error",
                    "error_type": error_type,
                    "message": error_message,
                    "details": details,
                    "session_id": str(session_id),
                    "chunk_sequence": chunk_sequence,
                    "timestamp": datetime.utcnow().isoformat(),
                    "diagnostics": {
                        "detected_format": audio_format,
                        "file_size": len(webm_data) if webm_data else 0,
                        "header_hex": hex_header,
                        "suggestion": get_format_suggestion(audio_format)
                    }
                }
                await transcript_manager.broadcast(
                    json.dumps(error_data),
                    str(session_id)
                )
                logger.info(f"ğŸš¨ [éŒ¯èª¤å»£æ’­] å·²é€šçŸ¥å‰ç«¯è½‰æ›éŒ¯èª¤: {error_type}")
                logger.debug(f"   - æ ¼å¼è¨ºæ–·: {audio_format}, å¤§å°: {len(webm_data) if webm_data else 0} bytes")
                logger.debug(f"   - é ­éƒ¨æ•¸æ“š: {hex_header}")
            except Exception as e:
                logger.error(f"Failed to broadcast error message: {e}")

        try:
            audio_format = detect_audio_format(webm_data)
            logger.info(f"ğŸµ [æ ¼å¼æª¢æ¸¬] æª¢æ¸¬åˆ°éŸ³æª”æ ¼å¼: {audio_format} (chunk {chunk_sequence}, å¤§å°: {len(webm_data)} bytes)")

            with PerformanceTimer(f"{audio_format.upper()} to WAV conversion for chunk {chunk_sequence}"):

                # åŸºæœ¬ FFmpeg åƒæ•¸
                cmd = ['ffmpeg']

                # ä¾ä¾†æºæ ¼å¼æ±ºå®šè¼¸å…¥åƒæ•¸
                if audio_format == 'mp4':
                    # Safari ç”¢å‡ºçš„ fragmented MP4 - è®“ FFmpeg è‡ªå‹•æª¢æ¸¬æ ¼å¼
                    # ä¸æŒ‡å®š -f åƒæ•¸ï¼Œèƒ½æ›´å¥½è™•ç†å„ç¨® MP4 è®Šé«”
                    pass
                elif audio_format == 'webm':
                    cmd += ['-f', 'webm']
                elif audio_format == 'ogg':
                    cmd += ['-f', 'ogg']
                elif audio_format == 'wav':
                    cmd += ['-f', 'wav']

                # é€šç”¨æ——æ¨™ï¼šç”Ÿæˆæ™‚é–“æˆ³è™•ç†ä¸å®Œæ•´æµ
                cmd += ['-fflags', '+genpts', '-i', 'pipe:0', '-ac', '1', '-ar', '16000', '-f', 'wav', '-y', 'pipe:1']

                logger.debug(f"ğŸ”§ [FFmpeg] åŸ·è¡Œå‘½ä»¤: {' '.join(cmd)}")

                process = await asyncio.create_subprocess_exec(
                    *cmd,
                    stdin=asyncio.subprocess.PIPE,
                    stdout=asyncio.subprocess.PIPE,
                    stderr=asyncio.subprocess.PIPE
                )

                stdout, stderr = await asyncio.wait_for(
                    process.communicate(input=webm_data),
                    timeout=PROCESSING_TIMEOUT
                )

                if process.returncode != 0:
                    error_msg = stderr.decode('utf-8', errors='ignore') if stderr else "Unknown error"
                    logger.error(f"âŒ [FFmpeg éŒ¯èª¤] è½‰æ›å¤±æ•— chunk {chunk_sequence}")
                    logger.error(f"   - æ ¼å¼: {audio_format}")
                    logger.error(f"   - è¿”å›ç¢¼: {process.returncode}")
                    logger.error(f"   - éŒ¯èª¤è¨Šæ¯: {error_msg}")
                    logger.error(f"   - è¼¸å…¥å¤§å°: {len(webm_data)} bytes")

                    # å¢å¼·éŒ¯èª¤åˆ†æï¼Œç‰¹åˆ¥é‡å° fragmented MP4 éŒ¯èª¤
                    if "could not find corresponding trex" in error_msg.lower():
                        error_reason = "Fragmented MP4 æ ¼å¼éŒ¯èª¤ï¼šç¼ºå°‘ Track Extends (trex) ç›’ï¼Œéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„ movflags åƒæ•¸"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. æª¢æ¸¬åˆ° fragmented MP4 æ ¼å¼ï¼Œå»ºè­°é‡æ–°æ•´ç†é é¢\n"
                            "2. å¦‚æœå•é¡ŒæŒçºŒï¼Œè«‹å˜—è©¦ä½¿ç”¨ä¸åŒç€è¦½å™¨\n"
                            "3. Safari ç”¨æˆ¶å»ºè­°åˆ‡æ›è‡³ Chrome æˆ– Firefox"
                        )
                    elif "trun track id unknown" in error_msg.lower():
                        error_reason = "Fragmented MP4 è¿½è¹¤ ID éŒ¯èª¤ï¼šTrack Run (trun) ç›’ä¸­çš„è»Œé“ ID ç„¡æ³•è­˜åˆ¥"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. é€™æ˜¯ fragmented MP4 ç‰¹æœ‰éŒ¯èª¤\n"
                            "2. å»ºè­°é‡æ–°éŒ„éŸ³æˆ–é‡å•Ÿç€è¦½å™¨\n"
                            "3. è€ƒæ…®é™ä½éŒ„éŸ³å“è³ªè¨­å®š"
                        )
                    elif "Invalid data found when processing input" in error_msg:
                        error_reason = f"éŸ³æª”æ ¼å¼ {audio_format} èˆ‡ FFmpeg ä¸å…¼å®¹ï¼Œå¯èƒ½æ˜¯ç·¨ç¢¼å•é¡Œ"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. æª¢æŸ¥éŸ³æª”æ˜¯å¦å®Œæ•´ä¸‹è¼‰\n"
                            "2. ç¢ºèªç€è¦½å™¨éŒ„éŸ³æ ¼å¼è¨­å®š\n"
                            "3. å˜—è©¦é‡æ–°é–‹å§‹éŒ„éŸ³"
                        )
                    elif "No such file or directory" in error_msg:
                        error_reason = "FFmpeg ç¨‹å¼æœªæ‰¾åˆ°æˆ–é…ç½®éŒ¯èª¤"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. è«‹è¯ç¹«æŠ€è¡“æ”¯æ´\n"
                            "2. é€™æ˜¯ä¼ºæœå™¨é…ç½®å•é¡Œ"
                        )
                    elif "Permission denied" in error_msg:
                        error_reason = "FFmpeg æ¬Šé™ä¸è¶³"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. è«‹è¯ç¹«æŠ€è¡“æ”¯æ´\n"
                            "2. é€™æ˜¯ä¼ºæœå™¨æ¬Šé™å•é¡Œ"
                        )
                    else:
                        error_reason = f"FFmpeg è™•ç† {audio_format} æ ¼å¼æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤"
                        detailed_suggestion = (
                            "ğŸ”§ è§£æ±ºæ–¹æ¡ˆï¼š\n"
                            "1. å˜—è©¦é‡æ–°éŒ„éŸ³\n"
                            "2. æª¢æŸ¥ç¶²è·¯é€£ç·šæ˜¯å¦ç©©å®š\n"
                            "3. å¦‚æœå•é¡ŒæŒçºŒï¼Œè«‹è¯ç¹«æŠ€è¡“æ”¯æ´"
                        )

                    # è¨˜éŒ„è©³ç´°è¨ºæ–·è³‡è¨Š
                    logger.error(f"   - è¨ºæ–·çµæœ: {error_reason}")
                    logger.error(f"   - å»ºè­°æ–¹æ¡ˆ: {detailed_suggestion}")

                    await _broadcast_error("ffmpeg_conversion_failed", error_reason, detailed_suggestion)
                    return None

                if not stdout or len(stdout) < 100:
                    error_msg = f"FFmpeg ç”¢ç”Ÿçš„ WAV æ•¸æ“šä¸è¶³: {len(stdout) if stdout else 0} bytes"
                    logger.error(f"âŒ [FFmpeg è­¦å‘Š] {error_msg}")
                    await _broadcast_error("insufficient_output", "è½‰æ›å¾Œçš„éŸ³æª”æ•¸æ“šä¸è¶³ï¼Œå¯èƒ½æ˜¯éœéŸ³æˆ–æå£", error_msg)
                    return None

                logger.info(f"âœ… [FFmpeg æˆåŠŸ] {audio_format.upper()} ({len(webm_data)} bytes) â†’ WAV ({len(stdout)} bytes)")
                return stdout

        except asyncio.TimeoutError:
            error_msg = f"FFmpeg è½‰æ›è¶…æ™‚ (>{PROCESSING_TIMEOUT}ç§’)"
            logger.error(f"â° [FFmpeg è¶…æ™‚] {error_msg}")
            await _broadcast_error("conversion_timeout", "éŸ³æª”è½‰æ›è™•ç†æ™‚é–“éé•·", error_msg)
            return None
        except Exception as e:
            error_msg = f"FFmpeg è½‰æ›ç•°å¸¸: {str(e)}"
            logger.error(f"ğŸ’¥ [FFmpeg ç•°å¸¸] {error_msg}")
            await _broadcast_error("conversion_exception", "éŸ³æª”è½‰æ›éç¨‹ä¸­ç™¼ç”Ÿç•°å¸¸éŒ¯èª¤", error_msg)
            return None

    async def _transcribe_audio(self, webm_data: bytes, session_id: UUID, chunk_sequence: int) -> Optional[Dict[str, Any]]:
        """ä½¿ç”¨ Azure OpenAI Whisper ç›´æ¥è½‰éŒ„ WebM éŸ³è¨Š (ç°¡åŒ–: åªè™•ç† text)"""
        from app.services.stt.factory import get_provider
        alt_provider = get_provider(session_id)
        if alt_provider and alt_provider.name() != "whisper":
            return await alt_provider.transcribe(webm_data, session_id, chunk_sequence)

        await rate_limit.wait()
        CONCURRENT_JOBS_GAUGE.inc()

        try:
            with WHISPER_LATENCY_SECONDS.labels(deployment=self.deployment_name).time():
                with PerformanceTimer(f"Whisper WebM transcription for chunk {chunk_sequence}"):
                    with tempfile.NamedTemporaryFile(suffix='.webm', delete=False) as temp_file:
                        temp_file.write(webm_data)
                        temp_file.flush()
                        try:
                            with open(temp_file.name, 'rb') as audio_file:
                                transcript = await self.client.audio.transcriptions.create(
                                    model=self.deployment_name,
                                    file=audio_file,
                                    language=getattr(settings, 'WHISPER_LANGUAGE', 'zh'),
                                    response_format="json",
                                    temperature=0
                                )
                            Path(temp_file.name).unlink(missing_ok=True)

                            # åªè™•ç† {"text": ...} çµæœ
                            text = getattr(transcript, "text", None) or (transcript.get("text") if isinstance(transcript, dict) else None)
                            if not text or not text.strip():
                                WHISPER_REQ_TOTAL.labels(status="empty", deployment=self.deployment_name).inc()
                                return None
                            combined_text = text.strip()

                            # API å‘¼å«æˆåŠŸï¼Œé‡ç½®é »ç‡é™åˆ¶å»¶é²
                            rate_limit.reset()
                            WHISPER_REQ_TOTAL.labels(status="success", deployment=self.deployment_name).inc()

                            return {
                                "text": combined_text,
                                "chunk_sequence": chunk_sequence,
                                "session_id": str(session_id),
                                "timestamp": datetime.utcnow().isoformat(),
                                "language": getattr(settings, 'WHISPER_LANGUAGE', 'zh-TW'),
                                "start_offset": 0.0,
                                "end_offset": settings.AUDIO_CHUNK_DURATION_SEC
                            }
                        finally:
                            Path(temp_file.name).unlink(missing_ok=True)
        except RateLimitError as e:
            logger.warning(f"ğŸš¦ [é »ç‡é™åˆ¶] Chunk {chunk_sequence} é‡åˆ° 429 éŒ¯èª¤ï¼š{str(e)}")
            rate_limit.backoff()
            WHISPER_REQ_TOTAL.labels(status="rate_limit", deployment=self.deployment_name).inc()
            if isinstance(rate_limit, SlidingWindowRateLimiter):
                stats = rate_limit.get_stats()
                if stats['is_at_capacity']:
                    error_msg = f"API é…é¡å·²æ»¿ï¼ˆ{stats['active_requests']}/{stats['max_requests']}ï¼‰ï¼Œè«‹ç­‰å¾…ç´„ {rate_limit._delay}s"
                else:
                    error_msg = f"API é »ç‡é™åˆ¶ï¼Œæ»‘å‹•è¦–çª—æ’éšŠè™•ç†ä¸­ï¼ˆ{stats['available_permits']} å€‹è¨±å¯å¯ç”¨ï¼‰"
            else:
                error_msg = f"API é »ç‡é™åˆ¶ï¼Œå°‡åœ¨ {rate_limit._delay}s å¾Œé‡è©¦"
            await self._broadcast_transcription_error(
                session_id,
                chunk_sequence,
                "rate_limit_error",
                error_msg
            )
            return None
        except Exception as e:
            logger.error(f"WebM direct transcription failed for chunk {chunk_sequence}: {e}")
            WHISPER_REQ_TOTAL.labels(status="error", deployment=self.deployment_name).inc()
            await self._broadcast_transcription_error(session_id, chunk_sequence, "whisper_api_error", f"Azure OpenAI Whisper WebM è½‰éŒ„å¤±æ•—: {str(e)}")
            return None
        finally:
            CONCURRENT_JOBS_GAUGE.dec()

    async def _save_and_push_result(self, session_id: UUID, chunk_sequence: int, transcript_result: Dict[str, Any]):
        """å„²å­˜è½‰éŒ„çµæœä¸¦æ¨é€åˆ°å‰ç«¯"""
        try:
            supabase = get_supabase_client()
            session_response = supabase.table("sessions").select("started_at").eq("id", str(session_id)).limit(1).execute()
            started_at = None
            if session_response.data and session_response.data[0].get('started_at'):
                started_at = session_response.data[0]['started_at']
            chunk_start_seconds = chunk_sequence * settings.AUDIO_CHUNK_DURATION_SEC
            start_time = chunk_start_seconds + transcript_result.get('start_offset', 0)
            end_time = chunk_start_seconds + transcript_result.get('end_offset', settings.AUDIO_CHUNK_DURATION_SEC)
            if started_at:
                logger.info(
                    f"ğŸ• [æ™‚é–“è¨ˆç®— v2] ç²¾ç¢ºé–‹å§‹æ™‚é–“: {started_at}, "
                    f"chunk={chunk_sequence}, chunk_start={chunk_start_seconds}s, "
                    f"offset=({transcript_result.get('start_offset', 0)}s-{transcript_result.get('end_offset', 0)}s) â†’ "
                    f"absolute=({start_time}s-{end_time}s)"
                )
            else:
                logger.info(
                    f"ğŸ• [æ™‚é–“è¨ˆç®— v2] æœªæª¢æ¸¬åˆ° started_atï¼Œä½¿ç”¨ fallback ç›¸å°æ™‚é–“ã€‚" \
                    f"chunk={chunk_sequence}, chunk_start={chunk_start_seconds}s, " \
                    f"offset=({transcript_result.get('start_offset', 0)}s-{transcript_result.get('end_offset', 0)}s) â†’ " \
                    f"relative=({start_time}s-{end_time}s)"
                )
            segment_data = {
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "text": transcript_result['text'],
                "start_time": start_time,
                "end_time": end_time,
                "confidence": 1.0,
                "lang_code": transcript_result.get('language', 'zh-TW'),
                "created_at": transcript_result['timestamp']
            }
            response = supabase.table("transcript_segments").insert(segment_data).execute()
            if response.data:
                segment_id = response.data[0]['id']
                logger.debug(f"Saved transcript segment {segment_id} for chunk {chunk_sequence}")
                if str(session_id) not in _active_phase_sent:
                    logger.info(f"ğŸš€ [è½‰éŒ„æ¨é€] é¦–æ¬¡å»£æ’­ active ç›¸ä½åˆ° session {session_id}")
                    await transcript_manager.broadcast(
                        json.dumps({"phase": "active"}),
                        str(session_id)
                    )
                    _active_phase_sent.add(str(session_id))
                    logger.info(f"âœ… [è½‰éŒ„æ¨é€] Active ç›¸ä½å»£æ’­å®Œæˆ for session {session_id}")
                transcript_message = {
                    "type": "transcript_segment",
                    "session_id": str(session_id),
                    "segment_id": segment_id,
                    "text": transcript_result['text'],
                    "chunk_sequence": chunk_sequence,
                    "start_sequence": chunk_sequence,
                    "start_time": segment_data['start_time'],
                    "end_time": segment_data['end_time'],
                    "confidence": segment_data['confidence'],
                    "timestamp": segment_data['created_at']
                }
                logger.info(f"ğŸ“¡ [è½‰éŒ„æ¨é€] å»£æ’­é€å­—ç¨¿ç‰‡æ®µåˆ° session {session_id}:")
                logger.info(f"   - æ–‡å­—: '{transcript_result['text'][:50]}{'...' if len(transcript_result['text']) > 50 else ''}'")
                logger.info(f"   - åºè™Ÿ: {chunk_sequence}")
                logger.info(f"   - æ™‚é–“: {segment_data['start_time']}s - {segment_data['end_time']}s")
                await transcript_manager.broadcast(
                    json.dumps(transcript_message),
                    str(session_id)
                )
                logger.info(f"âœ… [è½‰éŒ„æ¨é€] é€å­—ç¨¿ç‰‡æ®µå»£æ’­å®Œæˆ for session {session_id}")
                logger.info(f"å»£æ’­è½‰éŒ„å®Œæˆè¨Šæ¯åˆ° session {session_id}")
                await transcript_manager.broadcast(
                    json.dumps({
                        "type": "transcript_complete",
                        "session_id": str(session_id),
                        "message": "Transcription completed for the batch."
                    }),
                    str(session_id)
                )
                logger.info(f"è½‰éŒ„ä»»å‹™å®Œæˆ for session: {session_id}, chunk: {chunk_sequence}")
        except Exception as e:
            logger.error(f"Failed to save/push transcript for chunk {chunk_sequence}: {e}")
            await self._broadcast_transcription_error(session_id, chunk_sequence, "database_error", f"è³‡æ–™åº«æ“ä½œå¤±æ•—: {str(e)}")

    async def _broadcast_transcription_error(self, session_id: UUID, chunk_sequence: int, error_type: str, error_message: str):
        """å»£æ’­è½‰éŒ„éŒ¯èª¤åˆ°å‰ç«¯"""
        try:
            from app.ws.transcript_feed import manager as transcript_manager
            error_data = {
                "type": "transcription_error",
                "error_type": error_type,
                "message": error_message,
                "session_id": str(session_id),
                "chunk_sequence": chunk_sequence,
                "timestamp": datetime.utcnow().isoformat()
            }
            await transcript_manager.broadcast(
                json.dumps(error_data),
                str(session_id)
            )
            logger.info(f"ğŸš¨ [è½‰éŒ„éŒ¯èª¤å»£æ’­] å·²é€šçŸ¥å‰ç«¯è½‰éŒ„éŒ¯èª¤: {error_type}")
        except Exception as e:
            logger.error(f"Failed to broadcast transcription error: {e}")

    # TODO: åœ¨æ­¤è™•å¯¦ç¾æ›´å„ªé›…çš„é—œé–‰é‚è¼¯
    logger.info("Transcription service is shutting down...")

# ----------------------
# å…¼å®¹èˆŠæ¸¬è©¦çš„å·¥å» å‡½å¼èˆ‡å…¨åŸŸè®Šæ•¸
# ----------------------

_transcription_service_v2: Optional[SimpleAudioTranscriptionService] = None


def get_azure_openai_client() -> Optional[AsyncAzureOpenAI]:
    """Task 1: å»ºç«‹ç•°æ­¥ AzureOpenAI ç”¨æˆ¶ç«¯ï¼ŒåŒ…å«å„ªåŒ–çš„ timeout å’Œé‡è©¦é…ç½®"""
    api_key = os.getenv("AZURE_OPENAI_API_KEY")
    endpoint = os.getenv("AZURE_OPENAI_ENDPOINT")
    if not api_key or not endpoint:
        logger.warning("âš ï¸ [å®¢æˆ¶ç«¯åˆå§‹åŒ–] Azure OpenAI ç’°å¢ƒè®Šæ•¸ç¼ºå¤±")
        return None

    # Task 1: å‰µå»ºç•°æ­¥å®¢æˆ¶ç«¯ï¼ŒåŒ…å« timeout å’Œæ¸›å°‘é‡è©¦æ¬¡æ•¸
    client = AsyncAzureOpenAI(
        api_key=api_key,
        azure_endpoint=endpoint,
        api_version="2024-06-01",
        timeout=TIMEOUT,
        max_retries=2,  # ç”± 5 æ¬¡é™åˆ° 2 æ¬¡ï¼Œé¿å…ç©å£“
    )

    logger.info("âœ… [å®¢æˆ¶ç«¯åˆå§‹åŒ–] AsyncAzureOpenAI å®¢æˆ¶ç«¯å·²å‰µå»º")
    logger.info(f"   - Timeout: connect={TIMEOUT.connect}s, read={TIMEOUT.read}s")
    logger.info(f"   - Max retries: 2 (å„ªåŒ–å¾Œ)")

    return client


def get_whisper_deployment_name() -> Optional[str]:
    """å–å¾— Whisper éƒ¨ç½²åç¨±ï¼Œç’°å¢ƒè®Šæ•¸ç¼ºå€¼æ™‚å›å‚³ Noneã€‚"""
    return os.getenv("WHISPER_DEPLOYMENT_NAME")


async def initialize_transcription_service_v2() -> Optional[SimpleAudioTranscriptionService]:
    """åˆå§‹åŒ–ä¸¦å¿«å– SimpleAudioTranscriptionService å¯¦ä¾‹ã€‚è‹¥è¨­å®šä¸è¶³å‰‡å›å‚³ Noneã€‚"""
    global _transcription_service_v2
    if _transcription_service_v2 is not None:
        return _transcription_service_v2

    client = get_azure_openai_client()
    deployment = get_whisper_deployment_name()
    if not client or not deployment:
        logger.warning("Azure OpenAI è¨­å®šä¸è¶³ï¼Œç„¡æ³•åˆå§‹åŒ–è½‰éŒ„æœå‹™ v2")
        return None

    _transcription_service_v2 = SimpleAudioTranscriptionService(client, deployment)
    logger.info("âœ… Transcription service v2 initialized with async client")
    return _transcription_service_v2


def cleanup_transcription_service_v2():
    """æ¸…ç†å…¨åŸŸè½‰éŒ„æœå‹™å¯¦ä¾‹ã€‚"""
    global _transcription_service_v2
    _transcription_service_v2 = None


# END FILE CONTENTS


# File: docs/auto-retry-upload-spec.md

# è‡ªå‹•è£œå‚³èˆ‡ WebSocket ç·šä¸Šæ¢å¾©åŠŸèƒ½è¦æ ¼

## ç›®æ¨™
ç•¶ä½¿ç”¨è€…è£ç½®åœ¨éŒ„éŸ³éç¨‹ä¸­é›¢ç·šï¼Œç³»çµ±æ‡‰èƒ½åœ¨åµæ¸¬åˆ°é‡æ–°é€£ç·šï¼ˆ`window.online`ï¼‰å¾Œï¼š
1. è‡ªå‹•è£œå‚³é›¢ç·šæœŸé–“å¿«å–æ–¼ IndexedDB çš„ WebM éŸ³æª”åˆ‡ç‰‡ã€‚
2. é‡æ–°å»ºç«‹ Transcript WebSocket é€£ç·šï¼ŒæŒçºŒå³æ™‚é¡¯ç¤ºé€å­—ç¨¿ã€‚
3. å…¨ç¨‹ç„¡éœ€ä½¿ç”¨è€…æ‰‹å‹•ä»‹å…¥ï¼Œç¢ºä¿è³‡æ–™å®Œæ•´ä¸”å³æ™‚é«”é©—ä¸€è‡´ã€‚

---

## åŠŸèƒ½éœ€æ±‚
### FR-1 è‡ªå‹•è£œå‚³
- ç›£è½ `window` çš„ `online` äº‹ä»¶ï¼›è§¸ç™¼æ™‚èª¿ç”¨ `restAudioUploader.retryFailedSegments()`ã€‚
- å‘¼å«å®Œæˆå¾Œï¼Œè‹¥è£œå‚³æˆåŠŸï¼Œæ‡‰æ›´æ–° `UploadStatusIndicator` çš„çµ±è¨ˆï¼ˆuploaded/failed/cachedï¼‰ã€‚
- è‹¥è£œå‚³éç¨‹å†æ¬¡å¤±æ•—ï¼Œéœ€ä¿ç•™æ–¼ IndexedDBï¼Œä¸¦ä»¥ toast æˆ– UI badge æç¤ºä½¿ç”¨è€…ã€‚

### FR-2 é‡æ–°é€£ç·š Transcript WebSocket
- åœ¨ `online` äº‹ä»¶åŒä¸€æµç¨‹ä¸­ï¼š
  - æª¢æŸ¥ç›®å‰ SessionIdï¼ˆå¯ç”± `SimpleRecordingService` æˆ– AppState å–å¾—ï¼‰ã€‚
  - è‹¥ `transcriptManager.isConnected(sessionId)` ç‚º `false`ï¼Œå‘¼å« `transcriptManager.connect(sessionId)` é‡æ–°é€£ç·šã€‚
- é‡æ–°é€£ç·šæ‡‰é‡è¨­ `TranscriptManager` çš„é‡é€£è¨ˆæ•¸ï¼Œé¿å…å…ˆå‰é”ä¸Šé™å¾Œä¸å†é‡è©¦ã€‚

### FR-3 èˆ‡æ—¢æœ‰æ©Ÿåˆ¶å”åŒ
- ä¿ç•™ `TranscriptManager` ç¾æœ‰çš„æŒ‡æ•¸é€€é¿é‡é€£é‚è¼¯ï¼›`online` äº‹ä»¶åƒ…ä½œã€Œå¼·åˆ¶ç«‹å³é‡é€£ã€ã€‚
- ä¿ç•™ `RestAudioUploader` æ—¢æœ‰çš„è‡ªå‹•é‡è©¦ä¸‰æ¬¡ + æš«å­˜æµç¨‹ã€‚

### FR-4 UX èˆ‡å¯è¦–åŒ–
- `UploadStatusIndicator` åœ¨è‡ªå‹•è£œå‚³æœŸé–“é¡¯ç¤º loading spinnerï¼ˆreuse `retrying` stateï¼‰ã€‚
- æˆåŠŸå¾Œ toastï¼š`æš«å­˜æ®µè½å·²å…¨éƒ¨ä¸Šå‚³å®Œæˆ`ã€‚
- è‹¥ä»æœ‰æœªæˆåŠŸé …ç›®ï¼Œtoastï¼š`ä»æœ‰ {count} æ®µè½å¾…ä¸Šå‚³ï¼Œå°‡æ–¼ç·šä¸Šæ™‚è‡ªå‹•é‡è©¦`ã€‚

---

## éåŠŸèƒ½éœ€æ±‚
| é¡åˆ¥       | éœ€æ±‚                                                        |
| ---------- | ----------------------------------------------------------- |
| **å¯é æ€§** | ä¸Šç·šå¾Œ 2 ç§’å…§å®Œæˆç¬¬ä¸€æ³¢è£œå‚³èˆ‡é‡é€£ï¼›è£œå‚³å¤±æ•—ä¸å½±éŸ¿å¾ŒçºŒé‡è©¦ã€‚ |
| **æ•ˆèƒ½**   | å–®æ¬¡è£œå‚³æ‰¹æ¬¡æœ€å¤š 20 å€‹åˆ‡ç‰‡ï¼Œè¶…éå‰‡åˆ†æ‰¹ï¼ˆé¿å…é˜»å¡ UIï¼‰ã€‚     |
| **ç¶­è­·æ€§** | ç›¸é—œé‚è¼¯é›†ä¸­æ–¼å–®ä¸€ Hook / Serviceï¼Œä¸¦å…·å‚™å–®å…ƒæ¸¬è©¦è¦†è“‹ã€‚     |

---

## å¾…è¾¦äº‹é …ï¼ˆTask Breakdownï¼‰

| #    | æè¿°                                                                                                                                         | é¡å‹       | ä¾è³´ |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------- | ---------- | ---- |
| T-01 | å»ºç«‹ `useNetworkRestorer` Hookï¼šç›£è½ `online` äº‹ä»¶ä¸¦ç™¼å¸ƒ custom event `network:restored`                                                     | Structural | â€”    |
| T-02 | åœ¨ `UploadStatusIndicator` ä¸­è¨»å†Š `network:restored`ï¼Œå‘¼å« `restAudioUploader.retryFailedSegments()` ä¸¦è™•ç† UI state                         | Behavioral | T-01 |
| T-03 | åœ¨ `SimpleRecordingService`ï¼ˆæˆ– TranscriptServiceï¼‰ä¸­è¨»å†Š `network:restored`ï¼Œæª¢æŸ¥ `sessionId` ä¸¦å‘¼å« `transcriptManager.connect(sessionId)` | Behavioral | T-01 |
| T-04 | é‡æ§‹ `TranscriptManager`ï¼šæä¾› `resetReconnectAttempts(sessionId)` å…¬é–‹æ–¹æ³•                                                                  | Structural | â€”    |
| T-05 | å–®å…ƒæ¸¬è©¦ï¼š                                                                                                                                   |
  - æ¨¡æ“¬ offline â†’ online æµç¨‹ï¼Œé©—è­‰ `retryFailedSegments`ã€`connect` è¢«å‘¼å«
  - é©—è­‰ UI æŒ‡ç¤ºæ›´æ–° | Test | T-02, T-03 |
| T-06 | E2E æ¸¬è©¦ï¼ˆPlaywrightï¼‰ï¼šæ¨¡æ“¬æ–·ç¶² 30s å¾Œæ¢å¾©ï¼Œç¢ºèªé€å­—ç¨¿å®Œæ•´ & ç„¡ç¼ºç‰‡ | Test | T-02, T-03 |
| T-07 | æ–‡ä»¶æ›´æ–°ï¼šREADMEã€SPEC.mdã€é–‹ç™¼è€…æŒ‡å—åŠ å…¥é›¢ç·šè¡Œç‚ºèªªæ˜ | Doc | T-02â€“T-06 |

> **TDD æç¤º**ï¼šæ¯å€‹ Behavioral Task å…ˆå¯«å¤±æ•—æ¸¬è©¦ï¼Œå†å¯¦ä½œï¼›Structural Task ç¢ºèªç¾æœ‰æ¸¬è©¦ä»å…¨éƒ¨é€šéã€‚

---

## é¢¨éšªèˆ‡å‚™è¨»
- **è¡Œå‹•è£ç½®çœé›»ç­–ç•¥** å¯èƒ½å»¶é² `online` äº‹ä»¶è§¸ç™¼ï¼›éœ€åœ¨ resume App æ™‚è£œå……æª¢æŸ¥ IndexedDBã€‚ 
- **IndexedDB å®¹é‡**ï¼šå¤šæ¬¡é•·æ™‚é–“é›¢ç·šå¯èƒ½ç´¯ç©å¤§é‡åˆ‡ç‰‡ï¼Œéœ€è€ƒæ…®æ¸…ç†ç­–ç•¥ï¼ˆæœªç´å…¥æœ¬æ¬¡å·¥ä½œï¼‰ã€‚

---

*æœ€å¾Œæ›´æ–°ï¼š{{DATE_NOW}}* 


# END FILE CONTENTS


# File: frontend/components/ui/use-toast.ts

"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }


# END FILE CONTENTS


# File: frontend/components/ui/ExportButton.tsx

"use client"

import { useState } from 'react'
import { downloadZip } from '@/utils/export'
import { sessionAPI, notesAPI } from '@/lib/api'
import { toast } from '@/hooks/use-toast'
import { useSession } from '@/hooks/use-session'

interface Props {
    sid: string
    editorContent: string
}

export default function ExportButton({ sid, editorContent }: Props) {
    const [busy, setBusy] = useState(false)
    const { waitUntilCompleted } = useSession()

    const handleExport = async () => {
        if (busy) return
        setBusy(true)

        try {
            // 1ï¸âƒ£ ç­‰å¾… completed
            const ok = await waitUntilCompleted(sid, 30_000)
            if (!ok) {
                toast({ title: 'å¾Œç«¯ä»åœ¨è™•ç†é€å­—ç¨¿ï¼Œè«‹ç¨å€™å†è©¦' })
                return
            }

            // 2ï¸âƒ£ å„²å­˜ç­†è¨˜
            await notesAPI.updateNote(sid, { content: editorContent })

            // 3ï¸âƒ£ ä¸‹è¼‰ ZIP
            await downloadZip(sid)
        } catch (err) {
            console.error(err)
            toast({ title: 'åŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦', variant: 'destructive' })
        } finally {
            setBusy(false)
        }
    }

    return (
        <button
            className="btn btn-primary flex items-center gap-2"
            disabled={busy}
            onClick={handleExport}
        >
            {busy && (
                <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24">
                    <circle
                        className="opacity-25"
                        cx="12" cy="12" r="10"
                        stroke="currentColor"
                        strokeWidth="4"
                        fill="none"
                    />
                    <path
                        className="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8v4l3-3-3-3v4A8 8 8 0 104 12z"
                    />
                </svg>
            )}
            Export&nbsp;ZIP
        </button>
    )
}


# END FILE CONTENTS


# File: app/api/export.py

from fastapi import APIRouter, HTTPException, status
from fastapi.responses import StreamingResponse
from uuid import UUID
import io, zipfile
from app.db.database import get_supabase_client

router = APIRouter(prefix="/api/export", tags=["export"])

def _sec_to_ts(sec: float) -> str:
    h = int(sec // 3600)
    m = int((sec % 3600) // 60)
    s = int(sec % 60)
    return f"[{h:02d}:{m:02d}:{s:02d}]"

@router.get("/{sid}", response_class=StreamingResponse)
async def export_resource(sid: UUID, type: str = "zip"):
    try:
        if type != "zip":
            raise HTTPException(status.HTTP_400_BAD_REQUEST, "unsupported type")

        sb = get_supabase_client()

        # 1. session å¿…é ˆ completed
        session = (
            sb.table("sessions")
            .select("status")
            .eq("id", str(sid))
            .limit(1)
            .execute()
            .data
        )
        if not session:
            raise HTTPException(status.HTTP_404_NOT_FOUND, "session not found")
        if session[0]["status"] != "completed":
            raise HTTPException(status.HTTP_202_ACCEPTED, "session not finished")

        # 2. è®€ noteï¼šæ¬„ä½åç¨±å¯èƒ½æ˜¯ markdown / body / content
        note_row = (
            sb.table("notes")
            .select("content, markdown, body")
            .eq("session_id", str(sid))
            .limit(1)
            .execute()
            .data
        )
        if not note_row:
            raise HTTPException(status.HTTP_404_NOT_FOUND, "note not found")
        note = note_row[0]
        note_md = note.get("content") or note.get("markdown") or note.get("body") or ""

        # 3. é€å­—ç¨¿ï¼šå„ªå…ˆç”¨æœ‰æ™‚é–“æˆ³çš„ segmentsï¼Œæ²’æœ‰å°±é€€å› full_text
        seg_rows = (
            sb.table("transcript_segments")
            .select("text, start_time")
            .eq("session_id", str(sid))
            .order("chunk_sequence")
            .execute()
            .data
        )

        if seg_rows:
            transcript_txt = "\n".join(
                f"{_sec_to_ts(seg.get('start_time', 0))} {seg.get('text', '').strip()}"
                for seg in seg_rows
            )
        else:
            # fallback è®€ transcripts.full_text
            full = (
                sb.table("transcripts")
                .select("full_text")
                .eq("session_id", str(sid))
                .limit(1)
                .execute()
                .data
            )
            transcript_txt = (full[0]["full_text"] if full else "").strip()

        # 4. æ‰“åŒ… ZIP
        buf = io.BytesIO()
        with zipfile.ZipFile(buf, "w", zipfile.ZIP_DEFLATED) as zf:
            zf.writestr("note.md", note_md.strip())
            zf.writestr("transcript.txt", transcript_txt)
        buf.seek(0)

        headers = {
            "Content-Disposition": f'attachment; filename="{sid}.zip"'
        }
        return StreamingResponse(buf, media_type="application/zip", headers=headers)
    except HTTPException as e:
        # FastAPI HTTPException ç›´æ¥ä¸Ÿå‡º
        raise e
    except Exception as e:
        import traceback
        print(f"[EXPORT ERROR] {e}")
        print(traceback.format_exc())
        raise HTTPException(status.HTTP_500_INTERNAL_SERVER_ERROR, detail=f"Export failed: {e}")


# END FILE CONTENTS


# File: frontend/components/ui/dialog.tsx

"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}


# END FILE CONTENTS


# File: frontend/components/ui/toggle.tsx

"use client"

import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3 min-w-10",
        sm: "h-9 px-2.5 min-w-9",
        lg: "h-11 px-5 min-w-11",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }


# END FILE CONTENTS


# File: frontend/hooks/use-transcript.ts

"use client"

import { useState, useCallback, useRef, useEffect } from 'react'
import { transcriptManager, TranscriptMessage } from '../lib/transcript-manager'

interface UseTranscriptReturn {
    transcripts: TranscriptMessage[]
    isConnected: boolean
    isCompleted: boolean
    error: string | null
    connect: (sessionId: string) => Promise<void>
    disconnect: () => void
    clearTranscripts: () => void
    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    autoScrollEnabled: boolean
    enableAutoScroll: () => void
    disableAutoScroll: () => void
    scrollToLatest: () => void
    setScrollContainer: (element: HTMLElement | null) => void
}

export function useTranscript(): UseTranscriptReturn {
    const [transcripts, setTranscripts] = useState<TranscriptMessage[]>([])
    const [isConnected, setIsConnected] = useState(false)
    const [isCompleted, setIsCompleted] = useState(false)
    const [error, setError] = useState<string | null>(null)
    const [autoScrollEnabled, setAutoScrollEnabled] = useState(true)

    const containerRef = useRef<HTMLElement | null>(null)
    const currentSessionIdRef = useRef<string | null>(null)

    // è™•ç†é€å­—ç¨¿æ¥æ”¶èˆ‡åˆä½µé‚è¼¯
    const handleTranscript = useCallback((transcript: TranscriptMessage) => {
        console.log('ğŸ“ [useTranscript] æ”¶åˆ°é€å­—ç¨¿è¨Šæ¯:', {
            type: transcript.type,
            text: transcript.text,
            textLength: transcript.text?.length || 0,
            start_time: transcript.start_time,
            end_time: transcript.end_time,
            confidence: transcript.confidence,
            sessionId: currentSessionIdRef.current,
            currentTranscriptCount: transcripts.length,
            timestamp: new Date().toISOString()
        })

        // è™•ç†è½‰éŒ„å®Œæˆé€šçŸ¥
        if (transcript.type === 'transcript_complete' || transcript.message === 'transcription_complete') {
            console.log('âœ… [useTranscript] é€å­—ç¨¿è½‰éŒ„å®Œæˆï¼Œè¨­å®š isCompleted=true')
            setIsCompleted(true)
            return
        }

        // è™•ç†è½‰éŒ„éŒ¯èª¤ (éœ€è¦é¡å‹è½‰æ›å› ç‚º TranscriptMessage ä¸åŒ…å«éŒ¯èª¤é¡å‹)
        const anyMessage = transcript as any
        if (anyMessage.type === 'error' || anyMessage.type === 'transcription_error') {
            console.error('ğŸš¨ [useTranscript] æ”¶åˆ°è½‰éŒ„éŒ¯èª¤:', transcript)
            const errorMessage = anyMessage.error_message || anyMessage.details || 'è½‰éŒ„éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤'
            setError(errorMessage)
            return
        }

        // åªè™•ç†é€å­—ç¨¿ç‰‡æ®µé¡å‹çš„è¨Šæ¯
        if (transcript.type !== 'transcript_segment') {
            console.log('âš ï¸ [useTranscript] è·³ééé€å­—ç¨¿ç‰‡æ®µè¨Šæ¯:', transcript.type)
            return
        }

        if (!transcript.text) {
            console.log('âš ï¸ [useTranscript] è·³éç©ºæ–‡å­—é€å­—ç¨¿')
            return
        }

        console.log('ğŸ”„ [useTranscript] é–‹å§‹è™•ç†é€å­—ç¨¿ç‰‡æ®µ...')

        setTranscripts((prev) => {
            console.log('ğŸ“Š [useTranscript] åˆä½µå‰ç‹€æ…‹:', {
                existingCount: prev.length,
                newSegmentText: transcript.text,
                newSegmentTime: transcript.start_time
            })

            const newTranscripts = mergeSegments(prev, transcript)

            console.log('ğŸ“Š [useTranscript] åˆä½µå¾Œç‹€æ…‹:', {
                newCount: newTranscripts.length,
                countChange: newTranscripts.length - prev.length,
                lastSegmentText: newTranscripts[newTranscripts.length - 1]?.text?.substring(0, 50) + '...'
            })

            console.log(`âœ… [useTranscript] é€å­—ç¨¿æ›´æ–°å®Œæˆ: ${prev.length} â†’ ${newTranscripts.length} å€‹ç‰‡æ®µ`)
            return newTranscripts
        })
    }, [transcripts.length])

    // é€å­—ç¨¿ç‰‡æ®µåˆä½µé‚è¼¯ - ç¦ç”¨åˆä½µï¼Œç¢ºä¿æ¯å¥è©±éƒ½æœ‰ç¨ç«‹æ™‚é–“æˆ³
    const mergeSegments = useCallback((
        existingSegments: TranscriptMessage[],
        newSegment: TranscriptMessage
    ): TranscriptMessage[] => {
        // ç¦ç”¨åˆä½µé‚è¼¯ï¼Œç›´æ¥æ·»åŠ æ–°ç‰‡æ®µ
        // ç”¨æˆ¶è¦æ±‚ï¼šã€Œä¸€å¥è©±ä¸€å€‹æ™‚é–“æˆ³ã€ï¼Œä¸è¦å°‡é€å­—ç¨¿åˆä½µ
        return [...existingSegments, newSegment]
    }, [])

    // è‡ªå‹•æ²å‹•åŠŸèƒ½
    const scrollToLatest = useCallback(() => {
        if (containerRef.current && autoScrollEnabled) {
            containerRef.current.scrollTop = containerRef.current.scrollHeight
        }
    }, [autoScrollEnabled])

    // æª¢æ¸¬ä½¿ç”¨è€…æ»¾å‹• - é›¢åº•éƒ¨ >60px æ™‚ç¦ç”¨è‡ªå‹•æ²å‹•
    const handleScroll = useCallback((event: Event) => {
        const container = event.target as HTMLElement
        if (!container) return

        const { scrollTop, scrollHeight, clientHeight } = container
        const distanceFromBottom = scrollHeight - scrollTop - clientHeight

        if (distanceFromBottom > 60) {
            setAutoScrollEnabled(false)
        } else if (distanceFromBottom <= 10) {
            setAutoScrollEnabled(true)
        }
    }, [])

    // è¨­å®šè‡ªå‹•æ²å‹•å®¹å™¨
    const setScrollContainer = useCallback((element: HTMLElement | null) => {
        if (containerRef.current) {
            containerRef.current.removeEventListener('scroll', handleScroll)
        }

        containerRef.current = element

        if (element) {
            element.addEventListener('scroll', handleScroll)
        }
    }, [handleScroll])

    // å•Ÿç”¨è‡ªå‹•æ²å‹•
    const enableAutoScroll = useCallback(() => {
        setAutoScrollEnabled(true)
        scrollToLatest()
    }, [scrollToLatest])

    // ç¦ç”¨è‡ªå‹•æ²å‹•
    const disableAutoScroll = useCallback(() => {
        setAutoScrollEnabled(false)
    }, [])

    // é€£æ¥ TranscriptManager
    const connect = useCallback(async (sessionId: string): Promise<void> => {
        try {
            setError(null)
            setIsCompleted(false)

            // ç§»é™¤èˆŠçš„ç›£è½å™¨
            if (currentSessionIdRef.current) {
                transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
            }

            // é€£æ¥åˆ°æ–°çš„ session
            await transcriptManager.connect(sessionId)
            transcriptManager.addListener(sessionId, handleTranscript)

            currentSessionIdRef.current = sessionId
            setIsConnected(transcriptManager.isConnected(sessionId))

            console.log('âœ… use-transcript é€£æ¥æˆåŠŸï¼ŒSession ID:', sessionId)

        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'é€£æ¥é€å­—ç¨¿æœå‹™å¤±æ•—'
            setError(errorMessage)
            setIsConnected(false)
            console.error('âŒ use-transcript é€£æ¥å¤±æ•—:', err)
        }
    }, [handleTranscript])

    // æ–·é–‹é€£æ¥
    const disconnect = useCallback(() => {
        if (currentSessionIdRef.current) {
            transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
            // æ³¨æ„ï¼šä¸å‘¼å« transcriptManager.disconnectï¼Œå› ç‚ºå…¶ä»–çµ„ä»¶å¯èƒ½é‚„åœ¨ä½¿ç”¨
            currentSessionIdRef.current = null
        }

        setIsConnected(false)
        console.log('ğŸ”Œ use-transcript æ–·é–‹é€£æ¥')
    }, [handleTranscript])

    // æ¸…ç©ºé€å­—ç¨¿
    const clearTranscripts = useCallback(() => {
        setTranscripts([])
        setIsCompleted(false)
        console.log('ğŸ”„ use-transcript é€å­—ç¨¿å·²æ¸…é™¤')
    }, [])

    // è‡ªå‹•æ²å‹•æ•ˆæœ
    useEffect(() => {
        if (transcripts.length > 0) {
            scrollToLatest()
        }
    }, [transcripts, scrollToLatest])

    // æ¸…ç†è³‡æº
    useEffect(() => {
        return () => {
            if (currentSessionIdRef.current) {
                transcriptManager.removeListener(currentSessionIdRef.current, handleTranscript)
            }

            if (containerRef.current) {
                containerRef.current.removeEventListener('scroll', handleScroll)
            }
        }
    }, [handleTranscript, handleScroll])

    return {
        transcripts,
        isConnected,
        isCompleted,
        error,
        connect,
        disconnect,
        clearTranscripts,
        autoScrollEnabled,
        enableAutoScroll,
        disableAutoScroll,
        scrollToLatest,
        setScrollContainer,
    }
}


# END FILE CONTENTS


# File: app/services/stt/factory.py

# app/services/stt/factory.py
from __future__ import annotations

import logging
from typing import Dict, Type
from uuid import UUID

from app.db.database import get_supabase_client
from app.services.stt.interfaces import ISTTProvider
from app.services.stt.whisper_provider import WhisperProvider
from app.services.stt.gpt4o_provider import GPT4oProvider
from app.services.stt.gemini_provider import GeminiProvider
from app.core.config import get_settings

logger = logging.getLogger(__name__)

settings = get_settings()
# ------------------------------------------------------------------
# 1. provider singleton cache
# ------------------------------------------------------------------
_provider_cache: Dict[str, ISTTProvider] = {}


def _instance(cls: Type[ISTTProvider]) -> ISTTProvider:
    """
    lazy singleton per provider class
    Provider é¡åˆ¥å¿…é ˆæœ‰ `name` class å±¬æ€§ (str)
    """
    if cls.name not in _provider_cache:
        _provider_cache[cls.name] = cls()
    return _provider_cache[cls.name]


# ------------------------------------------------------------------
# 2. public API
# ------------------------------------------------------------------
def get_provider(session_id: UUID) -> ISTTProvider:
    """
    æ ¹æ“š sessions.stt_provider æ¬„ä½ï¼Œå›å‚³å°æ‡‰ ISTTProvider ç‰©ä»¶ã€‚
    é è¨­ whisperã€‚
    """
    supa = get_supabase_client()
    row = (
        supa.table("sessions")
        .select("stt_provider")
        .eq("id", str(session_id))
        .single()
        .execute()
    )

    provider_code: str = (
    row.data or {}
).get("stt_provider", settings.STT_PROVIDER_DEFAULT).lower()

    match provider_code:
        case "gpt4o" | "gpt-4o":
            return _instance(GPT4oProvider)
        case "gemini" | "google_gemini":
            return _instance(GeminiProvider)
        case "whisper" | _:
            # åŒ…å« None / ç©ºå­—ä¸² â†’ whisper
            return _instance(WhisperProvider)


# END FILE CONTENTS


# File: frontend/components/ui/sidebar.tsx

"use client"

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar:state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}


# END FILE CONTENTS


# File: frontend/components/ui/aspect-ratio.tsx

"use client"

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }


# END FILE CONTENTS


# File: frontend/components/ui/slider.tsx

"use client"

import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }


# END FILE CONTENTS


# File: frontend/components/ui/form.tsx

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}


# END FILE CONTENTS


# File: frontend/lib/utils.ts

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}


# END FILE CONTENTS


# File: frontend/utils/time.ts

export const formatTime = (sec: number): string => {
    const minutes = Math.floor(sec / 60)
    const seconds = Math.floor(sec % 60)
    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
}


# END FILE CONTENTS


# File: frontend/study-scriber.tsx

"use client"

import dynamic from "next/dynamic"
import "easymde/dist/easymde.min.css"
import { useMemo, useEffect } from "react"
import { Button } from "@/components/ui/button"
import { RotateCcw, Download } from "lucide-react"


// å‹•æ…‹åŒ¯å…¥ SimpleMDE ä»¥é¿å… SSR å•é¡Œ
// é€é .then(mod => mod.default) æ˜ç¢ºå–ç”¨ default exportï¼Œ
// ä»¥é¿å… Next.js åœ¨è™•ç† CommonJS èˆ‡ ESM æ··ç”¨æ™‚ï¼Œ
// å¯èƒ½å°‡æ•´å€‹ module ç‰©ä»¶ç•¶ä½œ React å…ƒä»¶è€Œå°è‡´ç„¡æ³•å®Œæˆè¼‰å…¥ã€‚
const SimpleMDE = dynamic(() => import("react-simplemde-editor").then(mod => mod.default), {
  ssr: false,
  loading: () => (
    <div className="h-full flex items-center justify-center text-muted-foreground">
      è¼‰å…¥ç·¨è¼¯å™¨ä¸­...
    </div>
  ),
})

import { useAppStore } from "./lib/app-store-zustand"
import { DefaultState } from "./components/default-state"
import { RecordingState } from "./components/recording-state"
import { WaitingState } from "./components/waiting-state"
import { FinishState } from "./components/finish-state"
import { ProviderContextMenu } from "./components/provider-context-menu"

export default function Component() {
  // ä½¿ç”¨ Zustand store
  const appState = useAppStore(state => state.appState)
  const isLoading = useAppStore(state => state.isLoading)
  const error = useAppStore(state => state.error)
  const session = useAppStore(state => state.session)
  const isRecording = useAppStore(state => state.isRecording)
  const recordingTime = useAppStore(state => state.recordingTime)
  const transcriptEntries = useAppStore(state => state.transcriptEntries)
  const editorContent = useAppStore(state => state.editorContent)
  const sttProvider = useAppStore(state => state.sttProvider)

  // Actions
  const startRecording = useAppStore(state => state.startRecording)
  const stopRecording = useAppStore(state => state.stopRecording)
  const updateEditorContent = useAppStore(state => state.updateEditorContent)
  const resetState = useAppStore(state => state.resetState)
  const setSttProvider = useAppStore(state => state.setSttProvider)
  // âœ… ç§»é™¤ draftTitle ç‹€æ…‹ - æ¨™é¡Œä¸å†å¿…å¡«

  // é å…ˆè¼‰å…¥ SimpleMDEï¼Œé¿å…ç¬¬ä¸€æ¬¡è¼‰å…¥æ™‚å¡åœ¨ loading
  useEffect(() => {
    if (typeof (SimpleMDE as any).preload === 'function') {
      (SimpleMDE as any).preload()
    }
  }, [])

  // ä½¿ç”¨ Zustand store - æ‰€æœ‰ç‹€æ…‹å·²åœ¨ä¸Šæ–¹å®£å‘Š

  // æª¢æŸ¥ä¸¦æ¸…ç†ç•°å¸¸çš„ localStorage ç‹€æ…‹
  useEffect(() => {
    if (typeof window !== 'undefined') {
      const appStateData = localStorage.getItem('app_state_v1')
      if (appStateData) {
        try {
          const parsedState = JSON.parse(appStateData)
          console.log("ğŸ” [StudyScriber] æª¢æŸ¥ localStorage ç‹€æ…‹:", parsedState)

          // å¦‚æœç‹€æ…‹æ˜¯ç•°å¸¸çš„éŒ„éŸ³ç‹€æ…‹ï¼Œæ¸…é™¤å®ƒ
          if (parsedState.state && ['recording_waiting', 'recording_active', 'processing'].includes(parsedState.state)) {
            console.log("ğŸ§¹ [StudyScriber] æ¸…é™¤ç•°å¸¸çš„ localStorage ç‹€æ…‹")
            localStorage.removeItem('app_state_v1')
            localStorage.removeItem('last_session')
            // åˆ·æ–°é é¢ä»¥é‡æ–°åˆå§‹åŒ–
            window.location.reload()
            return
          }
        } catch (error) {
          console.error("âŒ [StudyScriber] è§£æ localStorage å¤±æ•—:", error)
          localStorage.removeItem('app_state_v1')
          localStorage.removeItem('last_session')
        }
      }
    }
  }, [])

  // è¿½è¹¤ç‹€æ…‹æµè½‰
  console.log("[DEBUG] appState:", appState)
  console.log("[DEBUG] isRecording:", isRecording)
  if (session) {
    console.log("[DEBUG] session.status:", session.status, "session.type:", session.type)
  } else {
    console.log("[DEBUG] session: null")
  }

  // æ·»åŠ èª¿è©¦åŠŸèƒ½åˆ° window
  if (typeof window !== 'undefined') {
    // æš´éœ²å®Œæ•´ç‹€æ…‹åˆ° window.appData ä»¥ä¾¿è¨ºæ–·
    (window as any).appData = {
      state: appState,
      isRecording,
      recordingTime,
      transcriptEntries,
      editorContent,
      session,
      isLoading,
      error
    }
  }

  // æš´éœ²éŒ„éŸ³ç‹€æ…‹åˆ° window ä»¥ä¾¿èª¿è©¦
  if (typeof window !== 'undefined') {
    (window as any).recordingHook = { isRecording, recordingTime }
  }

  // æš´éœ² session åˆ° window ä»¥ä¾¿èª¿è©¦
  if (typeof window !== 'undefined') {
    (window as any).sessionHook = {
      currentSession: session,
      isLoading: isLoading,
      error: error
    }
  }

  useEffect(() => {
    console.log("ğŸ“± StudyScriber: state æ›´æ–°:", {
      state: appState,
      isRecording: isRecording,
      recordingTime: recordingTime,
      transcriptEntries: transcriptEntries,
      editorContent: editorContent,
      session: session,
      isLoading: isLoading,
      error: error,
    })
  }, [appState, isRecording, recordingTime, transcriptEntries, editorContent, session, isLoading, error])

  const editorOptions = useMemo(() => {
    return {
      spellChecker: false,
      placeholder: "Start writing your notes...",
      status: false,
      toolbar: [
        "bold",
        "italic",
        "strikethrough",
        "|",
        "heading-1",
        "heading-2",
        "heading-3",
        "|",
        "quote",
        "unordered-list",
        "ordered-list",
        "|",
        "link",
        "image",
        "table",
        "|",
        "preview",
        "side-by-side",
        "fullscreen",
      ] as const,
      autofocus: true,
      tabSize: 2,
    }
  }, [])

  const renderRightPanel = () => {
    // ç‹€æ…‹ç•°å¸¸æª¢æŸ¥ï¼šå¦‚æœæ˜¯ recording_waiting ä½†æ²’æœ‰ sessionï¼Œæ‡‰è©²é¡¯ç¤º default ç‹€æ…‹
    if (appState === "recording_waiting" && !session) {
      console.log("âš ï¸ [StudyScriber] æª¢æ¸¬åˆ°ç‹€æ…‹ç•°å¸¸: recording_waiting ä½†æ²’æœ‰ sessionï¼Œé¡¯ç¤º DefaultState")
      return <DefaultState
        onStartRecording={() => {
          console.log("ğŸ“± StudyScriber: æº–å‚™èª¿ç”¨ startRecordingï¼ˆç‹€æ…‹ä¿®å¾©ï¼‰")
          startRecording()
        }}
      />
    }

    switch (appState) {
      case "default":
        console.log("ğŸ”„ [StudyScriber] æ¸²æŸ“ DefaultStateï¼ŒstartRecording å‡½æ•¸:", typeof startRecording)
        return <DefaultState
          onStartRecording={() => {
            console.log("ğŸ“± StudyScriber: æº–å‚™èª¿ç”¨ startRecording")
            console.log("ğŸ“± StudyScriber: startRecording å‡½æ•¸é¡å‹:", typeof startRecording)
            startRecording()
          }}
        />
      case "recording_active":
        return (
          <RecordingState
            transcriptEntries={transcriptEntries}
            recordingTime={recordingTime}
            onStopRecording={stopRecording}
            error={error}
          />
        )
      case "recording_waiting":
        return (
          <RecordingState
            transcriptEntries={transcriptEntries}
            recordingTime={recordingTime}
            onStopRecording={stopRecording}
            error={error}
          />
        )
      case "processing":
        return <WaitingState />
      case "finished":
        return (
          <FinishState
            transcriptEntries={transcriptEntries}
            onExport={() => {
              // TODO: å¯¦ç¾åŒ¯å‡ºåŠŸèƒ½
              console.log('Export functionality not implemented yet')
            }}
            onToLatest={() => {
              // TODO: å¯¦ç¾æ²å‹•åˆ°æœ€æ–°åŠŸèƒ½
              console.log('To Latest functionality not implemented yet')
            }}
          />
        )
      default:
        return <DefaultState
          onStartRecording={() => {
            console.log("ğŸ“± StudyScriber: æº–å‚™èª¿ç”¨ startRecording (default)")
            startRecording()
          }}
        />
    }
  }

  return (
    <div className="h-screen bg-background flex flex-col" suppressHydrationWarning={true}>
      {/* Full Width Header - Fixed height of 80px */}
      <div className="bg-background border-b border-border px-6 flex-shrink-0 w-full h-20 flex justify-between items-center">
        <h1 className="text-2xl font-semibold text-foreground">Study Scriber</h1>

        {/* Header action buttons */}
        <div className="flex items-center gap-2">
          {/* New note æŒ‰éˆ• - åœ¨æœ‰æ´»èºæœƒè©±æˆ–éœ€è¦çš„ç‹€æ…‹ä¸‹é¡¯ç¤º */}
          {((appState === "default" && !!session) ||
            appState === "recording_waiting" ||
            appState === "recording_active" ||
            appState === "finished") && (
              <Button variant="outline" onClick={resetState} size="sm" className="px-4 h-8 flex items-center gap-2">
                <RotateCcw className="w-4 h-4" />
                New note
              </Button>
            )}

          {/* Export æŒ‰éˆ• - åªåœ¨ finished ç‹€æ…‹é¡¯ç¤º */}
          {appState === "finished" && (
            <Button onClick={() => console.log('Export functionality')} size="sm" className="px-4 h-8 flex items-center gap-2">
              <Download className="w-4 h-4" />
              Export
            </Button>
          )}

          <ProviderContextMenu
            currentProvider={sttProvider}
            onProviderChange={setSttProvider}
            disabled={appState === 'recording_active' || appState === 'processing' || appState === 'recording_waiting'}
          />
        </div>
      </div>

      {/* Main Content Area */}
      <div className="flex-1 flex overflow-hidden">
        {/* Left Panel (Editor) */}
        <div className="flex-1 border-r border-border h-full">
          <SimpleMDE
            value={editorContent}
            onChange={updateEditorContent}
            options={editorOptions}
            className="h-full"
          />
        </div>

        {/* Right Panel (Recording/Transcription) */}
        <div className="w-1/3 min-w-[400px] max-w-[500px] flex-shrink-0 h-full overflow-y-auto">
          {renderRightPanel()}
        </div>
      </div>
    </div>
  )
}


# END FILE CONTENTS


# File: frontend/lib/services/session-service.ts

"use client"

import { BaseService } from './base-service'
import { ISessionService } from './interfaces'
import { sessionAPI, type SessionCreateRequest, type SessionResponse } from '../api'
import axios from 'axios'

/**
 * SessionService - æœƒè©±ç®¡ç†æœå‹™
 *
 * é‡æ§‹ç¾æœ‰çš„ sessionAPI é‚è¼¯åˆ°æœå‹™å±¤ï¼Œæä¾›ï¼š
 * - æœƒè©±å‰µå»ºï¼ˆç´”ç­†è¨˜ã€éŒ„éŸ³æ¨¡å¼ï¼‰
 * - æœƒè©±å‡ç´šï¼ˆç´”ç­†è¨˜ â†’ éŒ„éŸ³æ¨¡å¼ï¼‰
 * - æœƒè©±ç‹€æ…‹ç®¡ç†
 * - çµ±ä¸€éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
 */
import { STTProvider } from '../api'

export class SessionService extends BaseService implements ISessionService {
    protected readonly serviceName = 'SessionService'

    /**
     * æœå‹™åˆå§‹åŒ–
     * é‡ç”¨ç¾æœ‰çš„ sessionAPI é…ç½®å’Œæ””æˆªå™¨
     */
    async initialize(): Promise<void> {
        this.logInfo('æœå‹™åˆå§‹åŒ–é–‹å§‹')

        // æª¢æŸ¥ sessionAPI å¯ç”¨æ€§
        try {
            // ç°¡å–®çš„å¥åº·æª¢æŸ¥ - å˜—è©¦ç²å–æ´»èºæœƒè©±
            await this.checkActiveSession()
            this.logSuccess('API é€£æ¥æª¢æŸ¥', 'å¾Œç«¯ API é€£æ¥æ­£å¸¸')
        } catch (error) {
            // ç¶²è·¯éŒ¯èª¤ä¸å½±éŸ¿åˆå§‹åŒ–ï¼Œè¨˜éŒ„è­¦å‘Šå³å¯
            if (axios.isAxiosError(error) && error.code === 'ERR_NETWORK') {
                this.logWarning('API é€£æ¥æª¢æŸ¥å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿æœå‹™åˆå§‹åŒ–', error.message)
            } else {
                this.logWarning('åˆå§‹åŒ–å¥åº·æª¢æŸ¥å¤±æ•—', error)
            }
        }

        this.logSuccess('åˆå§‹åŒ–å®Œæˆ')
    }

    /**
     * æœå‹™æ¸…ç†
     */
    async cleanup(): Promise<void> {
        this.logInfo('æœå‹™æ¸…ç†é–‹å§‹')
        // SessionService ä¸»è¦æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œç„¡éœ€ç‰¹æ®Šæ¸…ç†
        this.logSuccess('æ¸…ç†å®Œæˆ')
    }

    /**
     * ç¢ºä¿éŒ„éŸ³æœƒè©±å­˜åœ¨ - å„ªé›…è™•ç†æœƒè©±è¡çª
     *
     * ç­–ç•¥ï¼š
     * 1. å„ªå…ˆå˜—è©¦å‰µå»ºæ–°çš„éŒ„éŸ³æœƒè©±
     * 2. è‹¥é‡åˆ° 409 è¡çªï¼Œæ”¹ç‚ºç²å–ç¾æœ‰æ´»èºæœƒè©±
     * 3. ç¢ºä¿è¿”å›å¯ç”¨çš„éŒ„éŸ³æœƒè©±
     */
    async ensureRecordingSession(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse> {
        this.logInfo('ç¢ºä¿éŒ„éŸ³æœƒè©±å­˜åœ¨ - å¼·åˆ¶æ–°å»ºç­–ç•¥', { title, hasContent: !!content, hasStartTs: !!startTs, sttProvider })

        try {
            // 1. æª¢æŸ¥ä¸¦å®Œæˆä»»ä½•ç¾æœ‰æ´»èºæœƒè©±
            const existingSession = await this.checkActiveSession()
            if (existingSession) {
                this.logInfo('æª¢æ¸¬åˆ°ç¾æœ‰æ´»èºæœƒè©±ï¼Œæº–å‚™å®Œæˆ', {
                    sessionId: existingSession.id,
                    type: existingSession.type,
                    status: existingSession.status
                })

                await this.finishSession(existingSession.id)
                this.logSuccess('ç¾æœ‰æœƒè©±å·²å®Œæˆ', { sessionId: existingSession.id })
            } else {
                this.logInfo('æ²’æœ‰ç¾æœ‰æ´»èºæœƒè©±')
            }

            // 2. å¼·åˆ¶å‰µå»ºæ–°æœƒè©±
            const newSession = await this.createRecordingSession(
                title,
                content,
                startTs,
                sttProvider
            )

            this.logSuccess('å¼·åˆ¶æ–°å»ºç­–ç•¥å®Œæˆ', {
                newSessionId: newSession.id,
                type: newSession.type,
                status: newSession.status,
                sttProvider
            })

            return newSession

        } catch (error) {
            if (error instanceof Error && error.message.includes('409')) {
                // é‡åˆ°è¡çªï¼Œç²å–ç¾æœ‰æ´»èºæœƒè©±
                this.logWarning('æœƒè©±è¡çªï¼Œå˜—è©¦ç²å–ç¾æœ‰æ´»èºæœƒè©±')
                const activeSession = await this.checkActiveSession()
                if (activeSession) {
                    return activeSession
                }
            }
            this.handleError('ç¢ºä¿éŒ„éŸ³æœƒè©±å­˜åœ¨ - å¼·åˆ¶æ–°å»ºç­–ç•¥', error as Error)
        }
    }

    /**
     * å‰µå»ºéŒ„éŸ³æœƒè©±
     * é‡ç”¨ sessionAPI.createSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async createRecordingSession(title?: string, content?: string, startTs?: number, sttProvider?: STTProvider): Promise<SessionResponse> {
        this.logInfo('å‰µå»ºéŒ„éŸ³æœƒè©±', { title, hasContent: !!content, hasStartTs: !!startTs, sttProvider })

        try {
            const sessionData: SessionCreateRequest = {
                title,
                type: 'recording',
                content,
                start_ts: startTs,
                stt_provider: sttProvider
            }

            const session = await sessionAPI.createSession(sessionData)

            this.logSuccess('éŒ„éŸ³æœƒè©±å‰µå»ºæˆåŠŸ', {
                sessionId: session.id,
                type: session.type,
                status: session.status,
                withStartTs: !!startTs,
                sttProvider
            })

            return session
        } catch (error) {
            // ä¸åœ¨é€™è£¡è™•ç† 409 éŒ¯èª¤ï¼Œäº¤ç”± ensureRecordingSession è™•ç†
            this.handleError('å‰µå»ºéŒ„éŸ³æœƒè©±', error)
        }
    }

    /**
     * å‰µå»ºç´”ç­†è¨˜æœƒè©±
     * é‡ç”¨ sessionAPI.createSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async createNoteSession(title?: string, content?: string): Promise<SessionResponse> {
        this.logInfo('å‰µå»ºç´”ç­†è¨˜æœƒè©±', { title, hasContent: !!content })

        try {
            const sessionData: SessionCreateRequest = {
                title,
                type: 'note_only',
                content,
            }

            const session = await sessionAPI.createSession(sessionData)

            this.logSuccess('ç´”ç­†è¨˜æœƒè©±å‰µå»ºæˆåŠŸ', {
                sessionId: session.id,
                type: session.type,
                status: session.status
            })

            return session
        } catch (error) {
            // è™•ç†æœƒè©±è¡çªéŒ¯èª¤ï¼ˆ409ï¼‰
            if (axios.isAxiosError(error) && error.response?.status === 409) {
                const conflictMessage = 'æª¢æ¸¬åˆ°æ´»èºæœƒè©±è¡çªï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦'
                this.logWarning('æœƒè©±è¡çªéŒ¯èª¤ (409)', {
                    detail: error.response?.data?.detail,
                    message: error.message
                })
                this.handleError('å‰µå»ºç´”ç­†è¨˜æœƒè©±', new Error(conflictMessage))
            }

            this.handleError('å‰µå»ºç´”ç­†è¨˜æœƒè©±', error)
        }
    }

    /**
     * å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼
     * é‡ç”¨ sessionAPI.upgradeToRecording çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async upgradeToRecording(sessionId: string): Promise<SessionResponse> {
        this.logInfo('å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼', { sessionId })

        try {
            // å…ˆæª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨å’Œç‹€æ…‹
            const currentSession = await this.checkActiveSession()

            if (!currentSession) {
                this.handleError('å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼', new Error('æ²’æœ‰æ´»èºçš„æœƒè©±å¯ä»¥å‡ç´š'))
            }

            if (currentSession!.id !== sessionId) {
                this.handleError('å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼',
                    new Error(`æœƒè©± ID ä¸åŒ¹é…ï¼šè¦æ±‚å‡ç´š ${sessionId}ï¼Œä½†æ´»èºæœƒè©±ç‚º ${currentSession!.id}`))
            }

            if (currentSession!.type === 'recording') {
                this.logInfo('æœƒè©±å·²ç¶“æ˜¯éŒ„éŸ³æ¨¡å¼ï¼Œè¿”å›ç¾æœ‰æœƒè©±', { sessionId })
                return currentSession!
            }

            const updatedSession = await sessionAPI.upgradeToRecording(sessionId)

            this.logSuccess('æœƒè©±å‡ç´šæˆåŠŸ', {
                sessionId: updatedSession.id,
                oldType: currentSession!.type,
                newType: updatedSession.type,
                status: updatedSession.status
            })

            return updatedSession
        } catch (error) {
            this.handleError('å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼', error)
        }
    }

    /**
     * å®Œæˆæœƒè©±
     * é‡ç”¨ sessionAPI.finishSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async finishSession(sessionId: string): Promise<void> {
        this.logInfo('å®Œæˆæœƒè©±', { sessionId })

        try {
            await sessionAPI.finishSession(sessionId)

            this.logSuccess('æœƒè©±å®ŒæˆæˆåŠŸ', { sessionId })
        } catch (error) {
            this.handleError('å®Œæˆæœƒè©±', error)
        }
    }

    /**
     * æª¢æŸ¥æ´»èºæœƒè©±
     * é‡ç”¨ sessionAPI.getActiveSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async checkActiveSession(): Promise<SessionResponse | null> {
        this.logInfo('æª¢æŸ¥æ´»èºæœƒè©±')

        try {
            const activeSession = await sessionAPI.getActiveSession()

            if (activeSession) {
                this.logSuccess('æ´»èºæœƒè©±æª¢æŸ¥', {
                    sessionId: activeSession.id,
                    type: activeSession.type,
                    status: activeSession.status
                })
                return activeSession
            } else {
                this.logInfo('æ²’æœ‰æ´»èºæœƒè©±')
                return null
            }
        } catch (error) {
            // ç¶²è·¯éŒ¯èª¤ä¸æ‡‰è©²æ‹‹å‡ºï¼Œåªè¨˜éŒ„è­¦å‘Š
            if (axios.isAxiosError(error) && error.code === 'ERR_NETWORK') {
                this.logWarning('Backend API é€£ç·šæš«æ™‚å¤±æ•—ï¼Œå°‡åœ¨å¾ŒçºŒé‡è©¦', error.message)
                return null
            }

            this.handleError('æª¢æŸ¥æ´»èºæœƒè©±', error)
        }
    }

    /**
     * ç­‰å¾…æœƒè©±åœ¨è³‡æ–™åº«ä¸­å®Œå…¨å¯è¦‹
     * ç”¨æ–¼è§£æ±ºæœƒè©±å‰µå»ºå¾Œç«‹å³æŸ¥è©¢å¯èƒ½å¤±æ•—çš„æ™‚åºå•é¡Œ
     */
    async waitForSessionReady(sessionId: string, maxWaitTime: number = 5000): Promise<boolean> {
        this.logInfo('ç­‰å¾…æœƒè©±æº–å‚™å°±ç·’', { sessionId, maxWaitTime })

        const startTime = Date.now()
        const checkInterval = 200 // æ¯ 200ms æª¢æŸ¥ä¸€æ¬¡

        while (Date.now() - startTime < maxWaitTime) {
            try {
                const activeSession = await this.checkActiveSession()

                if (activeSession && activeSession.id === sessionId) {
                    // é€²ä¸€æ­¥é©—è­‰æœƒè©±ç‹€æ…‹
                    if (activeSession.status === 'active' && activeSession.type === 'recording') {
                        this.logSuccess('æœƒè©±å·²æº–å‚™å°±ç·’', {
                            sessionId,
                            status: activeSession.status,
                            type: activeSession.type,
                            waitTime: Date.now() - startTime
                        })
                        return true
                    }
                }
            } catch (error) {
                // æª¢æŸ¥å¤±æ•—æ™‚ç¹¼çºŒç­‰å¾…ï¼Œä¸æ‹‹å‡ºéŒ¯èª¤
                this.logWarning('æœƒè©±ç‹€æ…‹æª¢æŸ¥å¤±æ•—ï¼Œç¹¼çºŒç­‰å¾…', {
                    sessionId,
                    error: error instanceof Error ? error.message : String(error)
                })
            }

            // ç­‰å¾…ä¸‹æ¬¡æª¢æŸ¥
            await new Promise(resolve => setTimeout(resolve, checkInterval))
        }

        this.logWarning('ç­‰å¾…æœƒè©±æº–å‚™å°±ç·’è¶…æ™‚', {
            sessionId,
            maxWaitTime,
            actualWaitTime: Date.now() - startTime
        })

        return false
    }

    /**
     * åˆªé™¤æœƒè©±
     * é‡ç”¨ sessionAPI.deleteSession çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†
     */
    async deleteSession(sessionId: string): Promise<void> {
        this.logInfo('åˆªé™¤æœƒè©±', { sessionId })

        try {
            const result = await sessionAPI.deleteSession(sessionId)

            this.logSuccess('æœƒè©±åˆªé™¤æˆåŠŸ', {
                sessionId,
                result
            })
        } catch (error) {
            this.handleError('åˆªé™¤æœƒè©±', error)
        }
    }

    /**
     * ç²å–æœå‹™ç‹€æ…‹æ‘˜è¦
     * æ“´å±•åŸºç¤ç‹€æ…‹ä¿¡æ¯ï¼ŒåŒ…å« API é€£æ¥ç‹€æ…‹
     */
    async getServiceStatus(): Promise<SessionServiceStatus> {
        const baseStatus = this.getStatus()

        // æª¢æŸ¥ API é€£æ¥ç‹€æ…‹
        let apiConnected = false
        let lastApiCheck: string | null = null

        try {
            await this.checkActiveSession()
            apiConnected = true
            lastApiCheck = new Date().toISOString()
        } catch {
            apiConnected = false
            lastApiCheck = new Date().toISOString()
        }

        return {
            ...baseStatus,
            apiConnected,
            lastApiCheck
        }
    }
}

/**
 * SessionService ç‹€æ…‹ä»‹é¢
 * æ“´å±•åŸºç¤æœå‹™ç‹€æ…‹ï¼ŒåŒ…å« API ç‰¹å®šä¿¡æ¯
 */
export interface SessionServiceStatus {
    serviceName: string
    isInitialized: boolean
    isRunning: boolean
    timestamp: string
    apiConnected: boolean
    lastApiCheck: string | null
}


# END FILE CONTENTS


# File: app/db/supabase_init.sql

/* -----------------------------------------------
StudyScriber â€“ Supabase Database Bootstrap v2025-07-13
------------------------------------------------- */

-- ---------- ENUM TYPES ----------
DO $$ BEGIN
    CREATE TYPE session_type AS ENUM ('note_only', 'recording');
EXCEPTION WHEN duplicate_object THEN NULL; END $$;

DO $$ BEGIN
    CREATE TYPE session_status AS ENUM ('active', 'completed', 'error');
EXCEPTION WHEN duplicate_object THEN NULL; END $$;

DO $$ BEGIN
    CREATE TYPE lang_code AS ENUM ('zh-TW', 'en-US');
EXCEPTION WHEN duplicate_object THEN NULL; END $$;

COMMENT ON TYPE lang_code IS 'èªè¨€ä»£ç¢¼ï¼šzh-TW=ç¹é«”ä¸­æ–‡ï¼›en-US=ç¾å¼è‹±æ–‡';

-- ---------- TABLE: sessions ----------
CREATE TABLE IF NOT EXISTS sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    type session_type NOT NULL DEFAULT 'note_only',
    status session_status NOT NULL DEFAULT 'active',
    title VARCHAR(255) DEFAULT 'æœªå‘½åç­†è¨˜',
    lang_code lang_code NOT NULL DEFAULT 'zh-TW', -- â˜… æ”¹å
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    started_at TIMESTAMPTZ,
    stt_provider TEXT,
    completed_at TIMESTAMPTZ
);

-- ---------- TABLE: notes ----------
CREATE TABLE IF NOT EXISTS notes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    session_id UUID NOT NULL REFERENCES sessions (id) ON DELETE CASCADE,
    content TEXT NOT NULL DEFAULT '',
    client_ts TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (session_id) -- æ¯å€‹ session åƒ…ä¸€æ¢ note
);

-- ---------- TABLE: audio_files ----------
CREATE TABLE IF NOT EXISTS audio_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    session_id UUID NOT NULL REFERENCES sessions (id) ON DELETE CASCADE,
    chunk_sequence INTEGER NOT NULL,
    r2_key TEXT NOT NULL,
    r2_bucket TEXT NOT NULL,
    file_size INTEGER NOT NULL,
    duration_seconds DECIMAL(10, 3),
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (session_id, chunk_sequence)
);

-- ---------- TABLE: transcript_segments ----------
CREATE TABLE IF NOT EXISTS transcript_segments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    session_id UUID NOT NULL REFERENCES sessions (id) ON DELETE CASCADE,
    chunk_sequence INTEGER NOT NULL,
    start_time DECIMAL(10, 3) NOT NULL,
    end_time DECIMAL(10, 3) NOT NULL,
    text TEXT NOT NULL,
    confidence DECIMAL(5, 4) DEFAULT 0.0,
    lang_code lang_code DEFAULT 'zh-TW', -- â˜… æ”¹å
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

-- ---------- TABLE: transcripts ----------
CREATE TABLE IF NOT EXISTS transcripts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    session_id UUID NOT NULL REFERENCES sessions (id) ON DELETE CASCADE,
    full_text TEXT NOT NULL DEFAULT '',
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (session_id) -- æ¯å€‹ session åƒ…ä¸€æ¢å®Œæ•´é€å­—ç¨¿
);

-- ---------- INDEXES ----------
CREATE INDEX IF NOT EXISTS idx_sessions_status ON sessions (status);

CREATE INDEX IF NOT EXISTS idx_sessions_created_at ON sessions (created_at);

CREATE INDEX IF NOT EXISTS idx_notes_session_id ON notes (session_id);

CREATE INDEX IF NOT EXISTS idx_audio_files_session_id ON audio_files (session_id);

CREATE INDEX IF NOT EXISTS idx_audio_files_sequence ON audio_files (session_id, chunk_sequence);

CREATE INDEX IF NOT EXISTS idx_transcript_segments_session_id ON transcript_segments (session_id);

CREATE INDEX IF NOT EXISTS idx_transcript_segments_sequence ON transcript_segments (session_id, chunk_sequence);

CREATE INDEX IF NOT EXISTS idx_transcripts_session_id ON transcripts (session_id);

-- ---------- TRIGGER: update updated_at ----------
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS trigger LANGUAGE plpgsql AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END $$;

DROP TRIGGER IF EXISTS update_sessions_updated_at ON sessions;

DROP TRIGGER IF EXISTS update_notes_updated_at ON notes;

DROP TRIGGER IF EXISTS update_transcripts_updated_at ON transcripts;

CREATE TRIGGER update_sessions_updated_at
    BEFORE UPDATE ON sessions
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_notes_updated_at
    BEFORE UPDATE ON notes
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_transcripts_updated_at
    BEFORE UPDATE ON transcripts
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- ---------- TRIGGER: single active session ----------
CREATE OR REPLACE FUNCTION check_single_active_session()
RETURNS trigger LANGUAGE plpgsql AS $$
BEGIN
    IF NEW.status = 'active' THEN
        UPDATE sessions
           SET status      = 'completed',
               completed_at = CURRENT_TIMESTAMP
         WHERE status = 'active'
           AND id      <> NEW.id;
    END IF;
    RETURN NEW;
END $$;

DROP TRIGGER IF EXISTS ensure_single_active_session ON sessions;

CREATE TRIGGER ensure_single_active_session
    BEFORE INSERT OR UPDATE ON sessions
    FOR EACH ROW EXECUTE FUNCTION check_single_active_session();

-- ---------- DONE ----------
SELECT 'StudyScriber è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆï¼' AS message;


# END FILE CONTENTS


# File: frontend/components/ui/tooltip.tsx

"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }


# END FILE CONTENTS


# File: frontend/components/ui/dropdown-menu.tsx

"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}


# END FILE CONTENTS


# File: app/ws/transcript_feed.py

import asyncio
import logging
import json
from fastapi import APIRouter, WebSocket, WebSocketDisconnect
from typing import Dict, List

logger = logging.getLogger(__name__)
router = APIRouter()

class ConnectionManager:
    def __init__(self):
        # å°‡æ´»èºé€£æ¥å„²å­˜åœ¨å­—å…¸ä¸­ï¼Œä»¥ session_id ç‚ºéµ
        self.active_connections: Dict[str, List[WebSocket]] = {}
        logger.info("ConnectionManager (In-Memory) å·²åˆå§‹åŒ–")

    async def connect(self, websocket: WebSocket, session_id: str):
        await websocket.accept()
        if session_id not in self.active_connections:
            self.active_connections[session_id] = []
        self.active_connections[session_id].append(websocket)
        logger.info(f"WebSocket å®¢æˆ¶ç«¯å·²é€£æ¥åˆ° session_id: {session_id}ã€‚ç›®å‰è©² session æœ‰ {len(self.active_connections[session_id])} å€‹é€£æ¥ã€‚")

    def disconnect(self, websocket: WebSocket, session_id: str):
        if session_id in self.active_connections:
            try:
                self.active_connections[session_id].remove(websocket)
                logger.info(f"WebSocket å®¢æˆ¶ç«¯å·²å¾ session_id: {session_id} æ–·é–‹ã€‚")
                if not self.active_connections[session_id]:
                    del self.active_connections[session_id]
                    logger.info(f"Session_id: {session_id} å·²ç„¡é€£æ¥ï¼Œå¾ç®¡ç†å™¨ä¸­ç§»é™¤ã€‚")
            except ValueError:
                logger.warning(f"å˜—è©¦æ–·é–‹ä¸€å€‹ä¸å­˜åœ¨æ–¼ session_id: {session_id} çš„ WebSocket é€£æ¥ã€‚")
        else:
            logger.warning(f"å˜—è©¦å¾ä¸€å€‹ä¸å­˜åœ¨çš„ session_id: {session_id} æ–·é–‹é€£æ¥ã€‚")

    async def broadcast(self, message: str, session_id: str):
        if session_id in self.active_connections and self.active_connections[session_id]:
            client_count = len(self.active_connections[session_id])
            logger.info(f"ğŸ“¡ [ConnectionManager] æ­£åœ¨å‘ session_id: {session_id} çš„ {client_count} å€‹å®¢æˆ¶ç«¯å»£æ’­è¨Šæ¯")

            # è¨˜éŒ„è¨Šæ¯å…§å®¹ï¼ˆç°¡åŒ–ç‰ˆï¼‰
            try:
                import json
                parsed_msg = json.loads(message)
                msg_type = parsed_msg.get('type', parsed_msg.get('phase', 'unknown'))
                logger.info(f"ğŸ“¡ [ConnectionManager] è¨Šæ¯é¡å‹: {msg_type}")
                if 'text' in parsed_msg:
                    text_preview = parsed_msg['text'][:30] + ('...' if len(parsed_msg['text']) > 30 else '')
                    logger.info(f"ğŸ“¡ [ConnectionManager] æ–‡å­—é è¦½: '{text_preview}'")
            except:
                logger.info(f"ğŸ“¡ [ConnectionManager] åŸå§‹è¨Šæ¯: {message[:100]}...")

            # å»ºç«‹ä¸€å€‹ä»»å‹™åˆ—è¡¨ä»¥ä½µç™¼ç™¼é€
            tasks = [connection.send_text(message) for connection in self.active_connections[session_id]]
            results = await asyncio.gather(*tasks, return_exceptions=True)

            # æª¢æŸ¥ç™¼é€çµæœ
            success_count = sum(1 for r in results if not isinstance(r, Exception))
            error_count = len(results) - success_count

            if error_count > 0:
                logger.warning(f"ğŸ“¡ [ConnectionManager] å»£æ’­çµæœ: {success_count} æˆåŠŸ, {error_count} å¤±æ•—")
                for i, result in enumerate(results):
                    if isinstance(result, Exception):
                        logger.error(f"ğŸ“¡ [ConnectionManager] å®¢æˆ¶ç«¯ {i} ç™¼é€å¤±æ•—: {result}")
            else:
                logger.info(f"âœ… [ConnectionManager] å»£æ’­æˆåŠŸ: æ‰€æœ‰ {client_count} å€‹å®¢æˆ¶ç«¯éƒ½æ”¶åˆ°è¨Šæ¯")
        else:
            logger.warning(f"âš ï¸ [ConnectionManager] å»£æ’­å¤±æ•—ï¼šæ‰¾ä¸åˆ° session_id: {session_id} çš„æ´»èºé€£æ¥")
            logger.info(f"ğŸ“Š [ConnectionManager] ç›®å‰æ´»èº sessions: {list(self.active_connections.keys())}")

# å»ºç«‹ä¸€å€‹å…¨åŸŸçš„ ConnectionManager å¯¦ä¾‹
manager = ConnectionManager()

@router.websocket("/ws/transcript_feed/{session_id}")
async def websocket_endpoint(websocket: WebSocket, session_id: str):
    """
    ç”¨æ–¼æ¥æ”¶å³æ™‚é€å­—ç¨¿çš„ WebSocket ç«¯é»ã€‚

    - æ¯ä¸ª session_id å»ºç«‹ä¸€å€‹ç¨ç«‹çš„å»£æ’­é »é“ã€‚
    - å®¢æˆ¶ç«¯é€£æ¥å¾Œï¼ŒæœƒåŠ å…¥å°æ‡‰ session_id çš„é »é“ä¸¦ç›£è½è¨Šæ¯ã€‚
    - å¾Œç«¯è½‰éŒ„æœå‹™å®Œæˆå¾Œï¼Œæœƒå°‡çµæœç™¼å¸ƒåˆ°æ­¤é »é“ã€‚
    """
    await manager.connect(websocket, session_id)
    # æ–°å¢ï¼šå‘ŠçŸ¥å‰ç«¯ç­‰å¾…éšæ®µ
    await websocket.send_text(json.dumps({"phase": "waiting"}))
    try:
        # ä¿æŒé€£ç·šé–‹å•Ÿä»¥æ¥æ”¶å»£æ’­
        while True:
            # é€™å€‹è¿´åœˆä¸»è¦æ˜¯ç‚ºäº†ç¶­æŒé€£ç·šç‹€æ…‹ï¼Œ
            # receive_text() æœƒç­‰å¾…å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯ã€‚
            # æˆ‘å€‘å¯ä»¥è¨­å®šä¸€å€‹ timeout ä¾†å®šæœŸæª¢æŸ¥é€£ç·šæˆ–é€²è¡Œæ¸…ç†ã€‚
            await websocket.receive_text()

    except WebSocketDisconnect:
        logger.info(f"WebSocket for session {session_id} ä¸»å‹•æ–·é–‹é€£æ¥ã€‚")
        manager.disconnect(websocket, session_id)
    except Exception as e:
        logger.error(f"WebSocket for session {session_id} ç™¼ç”Ÿæ„å¤–éŒ¯èª¤: {e}")
        manager.disconnect(websocket, session_id)


# END FILE CONTENTS


# File: frontend/constants/providers.ts

export const PROVIDERS = [
  { code: 'whisper', label: 'Azure Whisper' },
  { code: 'gpt4o', label: 'Azure GPT-4o-transcribe' },
];


# END FILE CONTENTS


# File: frontend/app/globals.css

@tailwind base;
@tailwind components;
@tailwind utilities;
@import "easymde/dist/easymde.min.css";

@theme {
  --color-background: oklch(1 0 0);
  --color-foreground: oklch(0.145 0 0);
  --color-muted: oklch(0.898 0 0);
  --color-muted-foreground: oklch(0.478 0 0);
  --color-border: oklch(0.898 0 0);
  --color-primary: oklch(0.205 0 0);
  --color-primary-foreground: oklch(0.985 0 0);
}

:root {
  --border: 210, 12%, 83%;
}

/* Custom SimpleMDE styling to match design system */
.CodeMirror {
  font-family: ui-sans-serif, system-ui, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: oklch(0.145 0 0);
  background-color: oklch(1 0 0);
  border: none;
  padding: 16px;
}

.editor-toolbar {
  border: none;
  background-color: oklch(1 0 0);
  padding: 16px;
  border-bottom: 1px solid oklch(0.898 0 0);
}

.editor-toolbar a {
  color: oklch(0.478 0 0) !important;
  border: none !important;
  padding: 8px !important;
  margin: 0 4px !important;
}

.editor-toolbar a:hover {
  background-color: oklch(0.898 0 0) !important;
  color: oklch(0.145 0 0) !important;
}

.editor-toolbar.fullscreen {
  background-color: oklch(1 0 0);
}

.CodeMirror-fullscreen {
  background-color: oklch(1 0 0);
}

/* Make SimpleMDE container fill full height */
.editor-container .react-simplemde-editor {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.editor-container .editor-toolbar {
  flex-shrink: 0;
}

.editor-container .CodeMirror {
  flex: 1;
  height: auto !important;
}

.editor-container .CodeMirror-scroll {
  min-height: 100%;
}

.EasyMDEContainer .editor-toolbar {
  border: 0px solid transparent !important;
}

.EasyMDEContainer .CodeMirror-wrap {
  border-width: 1px 0px 0px 0px !important;
}

# END FILE CONTENTS


# File: frontend/lib/stream/audio-uploader.ts

"use client"

/**
 * AudioUploader - éŸ³è¨Šä¸Šå‚³ WebSocket é¡åˆ¥
 *
 * è² è²¬å»ºç«‹ /ws/upload_audio/{sessionId} WebSocket é€£æ¥
 * ä¸¦ç™¼é€éŸ³è¨Šåˆ‡ç‰‡åˆ°å¾Œç«¯é€²è¡ŒèªéŸ³è¾¨è­˜
 */
export class AudioUploader {
    private ws: WebSocket | null = null
    private sessionId: string | null = null
    private sequenceNumber = 0  // éŸ³è¨Šåˆ‡ç‰‡åºè™Ÿ
    private reconnectAttempts = 0  // é‡é€£å˜—è©¦æ¬¡æ•¸
    private maxReconnectAttempts = 5  // æœ€å¤§é‡é€£æ¬¡æ•¸
    private reconnectDelay = 1000  // é‡é€£å»¶é²ï¼ˆæ¯«ç§’ï¼‰
    private pendingChunks: Map<number, Blob> = new Map()  // å¾…é‡ç™¼çš„éŸ³è¨Šåˆ‡ç‰‡

    /**
     * é€£æ¥éŸ³è¨Šä¸Šå‚³ WebSocket
     */
    async connect(sessionId: string): Promise<void> {
        this.sessionId = sessionId
        this.sequenceNumber = 0  // é‡ç½®åºè™Ÿ
        this.reconnectAttempts = 0  // é‡ç½®é‡é€£è¨ˆæ•¸
        this.pendingChunks.clear()  // æ¸…ç©ºå¾…è™•ç†åˆ‡ç‰‡

        const wsBaseUrl = process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000'
        const wsUrl = `${wsBaseUrl}/ws/upload_audio/${sessionId}`

        console.log('ğŸ”Œ [AudioUploader] æ­£åœ¨é€£æ¥:', wsUrl)

        this.ws = new WebSocket(wsUrl)

        return new Promise((resolve, reject) => {
            if (!this.ws) return reject(new Error('WebSocket å‰µå»ºå¤±æ•—'))

            this.ws.onopen = () => {
                console.log('âœ… [AudioUploader] WebSocket é€£æ¥æˆåŠŸ:', sessionId)
                resolve()
            }

            this.ws.onerror = (error) => {
                console.error('âŒ [AudioUploader] WebSocket éŒ¯èª¤:', error)
                reject(new Error('AudioUploader WebSocket é€£æ¥å¤±æ•—'))
            }

            this.ws.onclose = (event) => {
                console.log('ğŸ”Œ [AudioUploader] WebSocket é€£æ¥å·²é—œé–‰:', {
                    code: event.code,
                    reason: event.reason,
                    sessionId: this.sessionId,
                    wasClean: event.wasClean
                })

                // å¦‚æœä¸æ˜¯æ‰‹å‹•é—œé–‰ï¼Œå˜—è©¦é‡é€£
                if (!event.wasClean && this.sessionId && this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.attemptReconnect()
                }
            }

            this.ws.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data)
                    this.handleServerMessage(message)
                } catch (error) {
                    console.log('ğŸ“¥ [AudioUploader] æ”¶åˆ°é JSON æ¶ˆæ¯:', event.data)
                }
            }
        })
    }

    /**
     * è™•ç†ä¼ºæœå™¨æ¶ˆæ¯
     */
    private handleServerMessage(message: any): void {
        console.log('ğŸ“¥ [AudioUploader] æ”¶åˆ°ä¼ºæœå™¨æ¶ˆæ¯:', message)

        switch (message.type) {
            case 'ack':
                console.log(`âœ… [AudioUploader] éŸ³è¨Šåˆ‡ç‰‡ #${message.chunk_sequence} ç¢ºèªæ”¶åˆ°`)
                break
            case 'upload_error':
                console.error(`âŒ [AudioUploader] ä¸Šå‚³éŒ¯èª¤ #${message.chunk_sequence}:`, message.error)
                break
            case 'connection_established':
                console.log('âœ… [AudioUploader] é€£æ¥å·²å»ºç«‹')
                break
            default:
                console.log('ğŸ“¥ [AudioUploader] æœªçŸ¥æ¶ˆæ¯é¡å‹:', message.type)
        }
    }

    /**
     * ç™¼é€éŸ³è¨Šåˆ‡ç‰‡ï¼ˆä¿®æ­£çš„ 4-byte sequence + Blob æ ¼å¼ï¼‰
     * åˆä½µåºè™Ÿå’ŒéŸ³æª”æ•¸æ“šç‚ºä¸€å€‹äºŒé€²åˆ¶æ¶ˆæ¯ï¼Œä½¿ç”¨å°ç«¯åºèˆ‡å¾Œç«¯åŒ¹é…
     */
    async send(blob: Blob, sequence?: number): Promise<void> {
        if (this.ws?.readyState !== WebSocket.OPEN) {
            console.warn('âš ï¸ [AudioUploader] WebSocket æœªé€£æ¥ï¼Œç„¡æ³•ç™¼é€éŸ³è¨Šæ•¸æ“š', {
                readyState: this.ws?.readyState,
                expectedState: WebSocket.OPEN,
                sessionId: this.sessionId,
                sequence: sequence ?? this.sequenceNumber
            })
            return
        }

        // ä½¿ç”¨å‚³å…¥çš„åºè™Ÿæˆ–å…§éƒ¨åºè™Ÿ
        const currentSequence = sequence ?? this.sequenceNumber

        console.log(`ğŸ“¤ [AudioUploader] æº–å‚™ç™¼é€éŸ³è¨Šåˆ‡ç‰‡ #${currentSequence}`, {
            blobSize: blob.size,
            mimeType: blob.type,
            sessionId: this.sessionId,
            timestamp: new Date().toISOString()
        })

        try {
            // ä¿®æ­£ï¼šå°‡åºè™Ÿå’ŒéŸ³æª”æ•¸æ“šåˆä½µç‚ºä¸€å€‹äºŒé€²åˆ¶æ¶ˆæ¯
            // 4-byte sequence (å°ç«¯åº) + Blob æ•¸æ“š
            const sequenceBuffer = new ArrayBuffer(4)
            const sequenceView = new DataView(sequenceBuffer)
            sequenceView.setUint32(0, currentSequence, true) // true = å°ç«¯åºï¼Œèˆ‡å¾Œç«¯åŒ¹é…

            // å°‡åºè™Ÿå’ŒéŸ³æª”æ•¸æ“šåˆä½µ
            const blobArrayBuffer = await blob.arrayBuffer()
            const combinedBuffer = new ArrayBuffer(4 + blobArrayBuffer.byteLength)
            const combinedView = new Uint8Array(combinedBuffer)

            // è¤‡è£½åºè™Ÿåˆ°åˆä½µç·©è¡å€
            combinedView.set(new Uint8Array(sequenceBuffer), 0)
            // è¤‡è£½éŸ³æª”æ•¸æ“šåˆ°åˆä½µç·©è¡å€
            combinedView.set(new Uint8Array(blobArrayBuffer), 4)

            // ä¸€æ¬¡æ€§ç™¼é€åˆä½µçš„äºŒé€²åˆ¶æ•¸æ“š
            this.ws.send(combinedBuffer)

            console.log(`âœ… [AudioUploader] éŸ³è¨Šåˆ‡ç‰‡ #${currentSequence} ç™¼é€æˆåŠŸ: ${blob.size} bytes (ç¸½è¨ˆ: ${combinedBuffer.byteLength} bytes)`)

            // DEV æ¨¡å¼è¨ºæ–·è¨ˆæ•¸
            if (process.env.NODE_ENV === 'development') {
                this.updateDevDiagnostics(currentSequence, blob.size)
            }

            // åªæœ‰ä½¿ç”¨å…§éƒ¨åºè™Ÿæ™‚æ‰éå¢
            if (sequence === undefined) {
                this.sequenceNumber++
            }

        } catch (error) {
            console.error(`âŒ [AudioUploader] ç™¼é€éŸ³è¨Šåˆ‡ç‰‡ #${currentSequence} å¤±æ•—:`, error)
            this.handleSendError(currentSequence, error)
        }
    }

    /**
     * è™•ç†ç™¼é€éŒ¯èª¤çš„é‡è©¦æ©Ÿåˆ¶
     */
    private handleSendError(sequence: number, error: any): void {
        console.error(`âŒ [AudioUploader] åºè™Ÿ #${sequence} ç™¼é€éŒ¯èª¤:`, error)
        // å¯ä»¥åœ¨é€™è£¡å¯¦ä½œé‡è©¦é‚è¼¯
        // ä¾‹å¦‚ï¼šå°‡å¤±æ•—çš„åºè™ŸåŠ å…¥é‡è©¦ä½‡åˆ—
    }

    /**
     * å˜—è©¦é‡æ–°é€£æ¥ WebSocket
     */
    private async attemptReconnect(): Promise<void> {
        this.reconnectAttempts++

        console.log(`ğŸ”„ [AudioUploader] å˜—è©¦é‡é€£ (#${this.reconnectAttempts}/${this.maxReconnectAttempts})`)

        // æ¼¸é€²å¼å»¶é²é‡é€£
        const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts - 1)

        setTimeout(async () => {
            try {
                if (this.sessionId) {
                    await this.connect(this.sessionId)
                    console.log('âœ… [AudioUploader] é‡é€£æˆåŠŸ')
                    this.reconnectAttempts = 0 // é‡ç½®é‡é€£è¨ˆæ•¸

                    // é‡æ–°ç™¼é€å¾…è™•ç†çš„éŸ³è¨Šåˆ‡ç‰‡
                    this.resendPendingChunks()
                }
            } catch (error) {
                console.error(`âŒ [AudioUploader] é‡é€£å¤±æ•— (#${this.reconnectAttempts}):`, error)

                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.attemptReconnect()
                } else {
                    console.error('âŒ [AudioUploader] å·²é”é‡é€£æœ€å¤§æ¬¡æ•¸ï¼Œåœæ­¢å˜—è©¦')
                }
            }
        }, delay)
    }

    /**
     * é‡æ–°ç™¼é€å¾…è™•ç†çš„éŸ³è¨Šåˆ‡ç‰‡
     */
    private resendPendingChunks(): void {
        if (this.pendingChunks.size === 0) return

        console.log(`ğŸ”„ [AudioUploader] é‡æ–°ç™¼é€ ${this.pendingChunks.size} å€‹å¾…è™•ç†åˆ‡ç‰‡`)

        for (const [sequence, blob] of this.pendingChunks.entries()) {
            this.send(blob, sequence)
        }

        // æ¸…ç©ºå¾…è™•ç†åˆ‡ç‰‡
        this.pendingChunks.clear()
    }

    /**
     * æ›´æ–°é–‹ç™¼æ¨¡å¼è¨ºæ–·ä¿¡æ¯
     */
    private updateDevDiagnostics(sequence: number, blobSize: number): void {
        if (!(window as any).__rec) {
            (window as any).__rec = {
                chunksSent: 0,
                totalBytes: 0,
                isRecording: false,
                sessionId: null,
                lastSequence: -1,
                errors: 0
            }
        }

        const rec = (window as any).__rec
        rec.chunksSent++
        rec.totalBytes += blobSize
        rec.sessionId = this.sessionId
        rec.isRecording = true
        rec.lastSequence = sequence

        console.log(`ğŸ” [AudioUploader] DEV è¨ºæ–·:`, {
            chunksSent: rec.chunksSent,
            totalBytes: rec.totalBytes,
            lastSequence: sequence,
            sessionId: this.sessionId
        })
    }

    /**
     * é‡ç½®åºè™Ÿï¼ˆé‡æ–°é–‹å§‹éŒ„éŸ³æ™‚ä½¿ç”¨ï¼‰
     */
    resetSequence(): void {
        this.sequenceNumber = 0
        console.log('ğŸ”„ [AudioUploader] åºè™Ÿå·²é‡ç½®')
    }

    /**
     * é—œé–‰ WebSocket é€£æ¥
     */
    close(): void {
        if (this.ws) {
            this.ws.close()
            this.ws = null
        }

        this.sessionId = null
        this.sequenceNumber = 0
        this.reconnectAttempts = 0
        this.pendingChunks.clear()

        // æ›´æ–° DEV æ¨¡å¼è¨ºæ–·ç‹€æ…‹
        if (process.env.NODE_ENV === 'development' && (window as any).__rec) {
            (window as any).__rec.isRecording = false
        }

        console.log('ğŸ”Œ [AudioUploader] WebSocket å·²é—œé–‰')
    }

    /**
     * æª¢æŸ¥é€£æ¥ç‹€æ…‹
     */
    get isConnected(): boolean {
        return this.ws?.readyState === WebSocket.OPEN
    }

    /**
     * ç²å–ç•¶å‰æœƒè©± ID
     */
    get currentSessionId(): string | null {
        return this.sessionId
    }

    /**
     * ç²å–ç•¶å‰åºè™Ÿ
     */
    get currentSequence(): number {
        return this.sequenceNumber
    }

    /**
     * ç²å– WebSocket ç‹€æ…‹
     */
    get connectionState(): string {
        if (!this.ws) return 'NOT_CREATED'

        switch (this.ws.readyState) {
            case WebSocket.CONNECTING: return 'CONNECTING'
            case WebSocket.OPEN: return 'OPEN'
            case WebSocket.CLOSING: return 'CLOSING'
            case WebSocket.CLOSED: return 'CLOSED'
            default: return 'UNKNOWN'
        }
    }
}

/**
 * é»˜èªçš„éŸ³è¨Šä¸Šå‚³å™¨å¯¦ä¾‹
 * å¯åœ¨æ•´å€‹æ‡‰ç”¨ä¸­å…±ç”¨
 */
export const audioUploader = new AudioUploader()


# END FILE CONTENTS


# File: frontend/components/ui/label.tsx

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }


# END FILE CONTENTS


# File: app/api/sessions.py

"""
StudyScriber Session ç®¡ç† API ç«¯é»

ä½¿ç”¨ Supabase Client å¯¦ä½œæœƒè©±å»ºç«‹ã€å®Œæˆå’Œå‡ç´šåŠŸèƒ½
"""

from uuid import UUID
from typing import Dict, Any
from datetime import datetime
from fastapi import APIRouter, Depends, HTTPException, status
from supabase import Client
from app.core.config import get_settings

from app.db.database import get_supabase_client
from app.schemas.session import (
    SessionCreateRequest, SessionOut, SessionUpgradeRequest,
    SessionFinishRequest, SessionStatusResponse, SessionStatus, SessionType, LanguageCode,
    SessionProviderUpdateRequest
)

# å»ºç«‹è·¯ç”±å™¨
router = APIRouter(prefix="/api", tags=["æœƒè©±ç®¡ç†"])


@router.post("/session", response_model=SessionOut, status_code=status.HTTP_201_CREATED)
async def create_session(
    request: SessionCreateRequest,
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    å»ºç«‹æ–°æœƒè©± (B-001)

    - æ”¯æ´å…©ç¨®æ¨¡å¼ï¼šç´”ç­†è¨˜ (note_only) æˆ–éŒ„éŸ³æ¨¡å¼ (recording)
    - ç¢ºä¿åŒæ™‚åªæœ‰ä¸€å€‹æ´»èºæœƒè©±
    - è‡ªå‹•å»ºç«‹å°æ‡‰çš„ç©ºç™½ç­†è¨˜è¨˜éŒ„
    - æ”¯æ´ç²¾ç¢ºçš„éŒ„éŸ³é–‹å§‹æ™‚é–“æˆ³
    """
    try:
        # æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ´»èºæœƒè©±
        active_session_response = supabase.table("sessions").select("id").eq("status", "active").limit(1).execute()
        if active_session_response.data:
            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail="å·²æœ‰ä¸€å€‹æ´»èºçš„æœƒè©±ï¼Œç„¡æ³•å»ºç«‹æ–°æœƒè©±ã€‚"
            )

        session_data = {
            "title": request.title,
            "type": request.type.value,
            "language": request.language.value,
            "status": SessionStatus.ACTIVE.value,
            "stt_provider": request.stt_provider or get_settings().STT_PROVIDER_DEFAULT
        }

        # å¦‚æœæœ‰æä¾› start_tsï¼Œè½‰æ›ç‚º PostgreSQL æ™‚é–“æˆ³æ ¼å¼
        if request.start_ts is not None:
            started_at = datetime.fromtimestamp(request.start_ts / 1000).isoformat()
            session_data["started_at"] = started_at
            print(f"ğŸ• [SessionAPI] è¨­å®šéŒ„éŸ³é–‹å§‹æ™‚é–“: {started_at} (åŸå§‹æ™‚é–“æˆ³: {request.start_ts})")

        # è‹¥ç‚ºéŒ„éŸ³æ¨¡å¼ä¸”ä»æœªè¨­å®š started_atï¼Œå‰‡é è¨­ç‚ºç›®å‰æ™‚é–“ (UTC)
        if request.type == SessionType.RECORDING and "started_at" not in session_data:
            session_data["started_at"] = datetime.utcnow().isoformat()

        response = supabase.table("sessions").insert(session_data, returning="representation").execute()

        if not response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•å»ºç«‹æœƒè©±")

        new_session = response.data[0]
        session_id = new_session['id']

        note_data = {"session_id": session_id, "content": request.content or ""}
        supabase.table("notes").insert(note_data).execute()

        return SessionOut.model_validate(new_session)

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=500,
            detail={"error": "internal_error", "message": f"å»ºç«‹æœƒè©±æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.patch("/session/{session_id}/finish", response_model=SessionStatusResponse)
async def finish_session(
    session_id: UUID,
    supabase: Client = Depends(get_supabase_client)
) -> SessionStatusResponse:
    """
    å®Œæˆæœƒè©± (B-002)

    - å°‡æ´»èºæœƒè©±æ¨™è¨˜ç‚ºå®Œæˆ
    - è¨­å®šå®Œæˆæ™‚é–“
    - é‡‹æ”¾æœƒè©±é–å®šï¼Œå…è¨±å»ºç«‹æ–°æœƒè©±
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨ä¸”æ´»èº
        session_response = supabase.table("sessions").select("*").eq("id", str(session_id)).eq("status", "active").limit(1).execute()
        if not session_response.data:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="æ‰¾ä¸åˆ°æ´»èºçš„æœƒè©±æˆ–æœƒè©±å·²è¢«å®Œæˆã€‚"
            )

        # æº–å‚™æ›´æ–°æ•¸æ“š
        update_data = {
            "status": SessionStatus.COMPLETED.value,
            "completed_at": datetime.utcnow().isoformat()
        }

        # æ›´æ–°æœƒè©±ç‹€æ…‹
        response = supabase.table("sessions").update(update_data).eq("id", str(session_id)).execute()

        if not response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•æ›´æ–°æœƒè©±ç‹€æ…‹")

        updated_session = response.data[0]

        return SessionStatusResponse(
            success=True,
            message=f"æœƒè©± '{updated_session.get('title') or session_id}' å·²æˆåŠŸå®Œæˆ",
            session=SessionOut.model_validate(updated_session)
        )

    except HTTPException:
        # é‡æ–°æ‹‹å‡ºå·²è™•ç†çš„ HTTP ç•°å¸¸
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"å®Œæˆæœƒè©±æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.delete("/session/{session_id}", response_model=SessionStatusResponse)
async def delete_session(
    session_id: UUID,
    supabase: Client = Depends(get_supabase_client)
) -> SessionStatusResponse:
    """
    åˆªé™¤æœƒè©±åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“š (B-020)

    - åˆªé™¤æŒ‡å®šçš„æœƒè©±åŠå…¶æ‰€æœ‰é—œè¯æ•¸æ“šï¼ˆç­†è¨˜ã€éŸ³æª”ã€é€å­—ç¨¿ç­‰ï¼‰
    - ç”±æ–¼è³‡æ–™åº«æœ‰ CASCADE DELETE ç´„æŸï¼Œæœƒè‡ªå‹•æ¸…ç†æ‰€æœ‰ç›¸é—œè¡¨æ ¼çš„æ•¸æ“š
    - æ­¤æ“ä½œä¸å¯é€†ï¼Œè«‹è¬¹æ…ä½¿ç”¨
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨
        session_response = supabase.table("sessions").select("*").eq("id", str(session_id)).limit(1).execute()
        if not session_response.data:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="æ‰¾ä¸åˆ°æŒ‡å®šçš„æœƒè©±ã€‚"
            )

        session_data = session_response.data[0]
        session_title = session_data.get('title', 'æœªå‘½åç­†è¨˜')

        # åˆªé™¤æœƒè©±ï¼ˆæœƒè‡ªå‹•ç´šè¯åˆªé™¤æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼‰
        delete_response = supabase.table("sessions").delete().eq("id", str(session_id)).execute()

        if not delete_response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•åˆªé™¤æœƒè©±")

        return SessionStatusResponse(
            success=True,
            message=f"æœƒè©± '{session_title}' ({session_id}) åŠå…¶æ‰€æœ‰ç›¸é—œæ•¸æ“šå·²æˆåŠŸåˆªé™¤",
            session=None
        )

    except HTTPException:
        # é‡æ–°æ‹‹å‡ºå·²è™•ç†çš„ HTTP ç•°å¸¸
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"åˆªé™¤æœƒè©±æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.patch("/session/{session_id}/upgrade", response_model=SessionOut)
async def upgrade_session_to_recording(
    session_id: UUID,
    request: SessionUpgradeRequest,
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    å‡ç´šæœƒè©±è‡³éŒ„éŸ³æ¨¡å¼ (B-015)

    - å°‡ç´”ç­†è¨˜æœƒè©±å‡ç´šç‚ºéŒ„éŸ³æ¨¡å¼
    - åªæœ‰ active ç‹€æ…‹çš„ note_only æœƒè©±å¯ä»¥å‡ç´š
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å¯ä»¥å‡ç´š
        session_response = supabase.table("sessions").select("*").eq("id", str(session_id)).eq("status", "active").eq("type", "note_only").limit(1).execute()
        if not session_response.data:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="åªæœ‰æ´»èºçš„ç´”ç­†è¨˜æœƒè©±æ‰èƒ½å‡ç´šã€‚"
            )

        # æº–å‚™æ›´æ–°æ•¸æ“š
        update_data = {
            "type": SessionType.RECORDING.value,
            "language": request.language.value,
            "started_at": datetime.utcnow().isoformat(),
        }

        # åŸ·è¡Œå‡ç´š
        response = supabase.table("sessions").update(update_data).eq("id", str(session_id)).execute()

        if not response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•å‡ç´šæœƒè©±")

        updated_session = response.data[0]

        return SessionOut.model_validate(updated_session)

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"å‡ç´šæœƒè©±æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


@router.get("/session/active", response_model=SessionOut, status_code=status.HTTP_200_OK)
async def get_active_session(
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    å–å¾—ç›®å‰æ´»èºçš„æœƒè©±

    - ç”¨æ–¼å‰ç«¯æª¢æŸ¥æ˜¯å¦æœ‰é€²è¡Œä¸­çš„æœƒè©±
    - å¦‚æœæ²’æœ‰æ´»èºæœƒè©±å‰‡è¿”å› 404
    """
    response = supabase.table("sessions").select("*").eq("status", "active").limit(1).execute()
    if not response.data:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail={"error": "no_active_session", "message": "ç›®å‰æ²’æœ‰æ´»èºçš„æœƒè©±"}
        )

    return SessionOut.model_validate(response.data[0])


@router.get("/session/{session_id}", response_model=SessionOut)
async def get_session(
    session_id: UUID,
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    å–å¾—æŒ‡å®šæœƒè©±çš„è©³ç´°è³‡è¨Š

    - ç”¨æ–¼æª¢è¦–æœƒè©±ç‹€æ…‹å’Œè³‡è¨Š
    """
    response = supabase.table("sessions").select("*").eq("id", str(session_id)).limit(1).execute()

    if not response.data:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail={"error": "session_not_found", "message": "æ‰¾ä¸åˆ°æŒ‡å®šçš„æœƒè©±"}
        )

    return SessionOut.model_validate(response.data[0])


@router.patch("/session/{session_id}/provider", response_model=SessionOut)
async def update_session_provider(
    session_id: UUID,
    request: SessionProviderUpdateRequest,
    supabase: Client = Depends(get_supabase_client)
) -> SessionOut:
    """
    æ›´æ–°æœƒè©± STT Provider (B-016)

    - åƒ…åœ¨å°šæœªä¸Šå‚³éŸ³æª”æ™‚å…è¨±åˆ‡æ›
    - æ”¯æ´ whisper å’Œ gemini ä¹‹é–“çš„åˆ‡æ›
    - é©—è­‰ Provider çš„æœ‰æ•ˆæ€§
    """
    try:
        # æª¢æŸ¥æœƒè©±æ˜¯å¦å­˜åœ¨ä¸”ç‚ºæ´»èºç‹€æ…‹
        session_response = supabase.table("sessions").select("*").eq("id", str(session_id)).eq("status", "active").limit(1).execute()
        if not session_response.data:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="æ‰¾ä¸åˆ°æ´»èºçš„æœƒè©±ã€‚"
            )

        # æª¢æŸ¥æ˜¯å¦å·²æœ‰éŸ³æª”ä¸Šå‚³ï¼ˆé€é audio_files è¡¨ï¼‰
        audio_files_response = supabase.table("audio_files").select("id").eq("session_id", str(session_id)).limit(1).execute()
        if audio_files_response.data:
            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail="å·²é–‹å§‹éŒ„éŸ³ï¼Œç„¡æ³•æ›´æ”¹ STT Providerã€‚"
            )

        # é©—è­‰ Provider æœ‰æ•ˆæ€§
        valid_providers = ["whisper", "gemini"]
        if request.stt_provider not in valid_providers:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=f"ç„¡æ•ˆçš„ STT Providerã€‚æ”¯æ´çš„é¸é …ï¼š{', '.join(valid_providers)}"
            )

        # æ›´æ–° Provider
        update_data = {
            "stt_provider": request.stt_provider,
            "updated_at": datetime.utcnow().isoformat()
        }

        response = supabase.table("sessions").update(update_data).eq("id", str(session_id)).execute()

        if not response.data:
            raise HTTPException(status_code=500, detail="ç„¡æ³•æ›´æ–° STT Provider")

        updated_session = response.data[0]

        logger.info(f"âœ… [SessionAPI] æˆåŠŸæ›´æ–° session {session_id} STT Provider: {request.stt_provider}")
        return SessionOut.model_validate(updated_session)

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={"error": "internal_error", "message": f"æ›´æ–° STT Provider æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}"}
        )


# END FILE CONTENTS


# File: package.json

{
	"devDependencies": {
		"@playwright/test": "^1.54.1",
		"jszip": "^3.10.1"
	},
	"packageManager": "pnpm@10.7.0+sha1.66453f13fbf9078d3db193718206a8d738afdbdb"
}


# END FILE CONTENTS


# File: frontend/components/recording-active-state.tsx

"use client"

import { useEffect, useRef, useState, useCallback } from "react"
import { ScrollArea } from "@/components/ui/scroll-area"
import { Button } from "@/components/ui/button"
import { Square, Clock } from "lucide-react"
import type { TranscriptEntry } from "../types/app-state"

interface RecordingActiveStateProps {
    transcriptEntries: TranscriptEntry[]
    recordingTime: number
    onStopRecording: () => void
}

// æ ¼å¼åŒ–éŒ„éŸ³æ™‚é–“ç‚º HH:MM:SS æ ¼å¼
function formatRecordingTime(seconds: number): string {
    const hours = Math.floor(seconds / 3600)
    const minutes = Math.floor((seconds % 3600) / 60)
    const secs = seconds % 60

    if (hours > 0) {
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
    }
    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
}

export function RecordingActiveState({ transcriptEntries, recordingTime, onStopRecording }: RecordingActiveStateProps) {
    const scrollAreaRef = useRef<HTMLDivElement>(null)
    const [isAutoScrollLocked, setIsAutoScrollLocked] = useState(true)
    const [userScrollTimeout, setUserScrollTimeout] = useState<NodeJS.Timeout | null>(null)

    // è‡ªå‹•æ²å‹•åˆ°åº•éƒ¨
    const autoScroll = useCallback(() => {
        if (isAutoScrollLocked && scrollAreaRef.current) {
            const scrollContainer = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]')
            if (scrollContainer) {
                scrollContainer.scrollTop = scrollContainer.scrollHeight
            }
        }
    }, [isAutoScrollLocked])

    // æª¢æ¸¬ä½¿ç”¨è€…æ²å‹•è¡Œç‚º
    const unlockOnScroll = useCallback(
        (event: Event) => {
            const target = event.target as HTMLElement
            if (target) {
                const { scrollTop, scrollHeight, clientHeight } = target
                const isAtBottom = Math.abs(scrollHeight - clientHeight - scrollTop) < 10

                if (!isAtBottom && isAutoScrollLocked) {
                    setIsAutoScrollLocked(false)
                } else if (isAtBottom && !isAutoScrollLocked) {
                    setIsAutoScrollLocked(true)
                }

                if (userScrollTimeout) clearTimeout(userScrollTimeout)

                const timeout = setTimeout(() => {
                    if (!isAutoScrollLocked) setIsAutoScrollLocked(true)
                }, 3000)

                setUserScrollTimeout(timeout)
            }
        },
        [isAutoScrollLocked, userScrollTimeout]
    )

    // æ‰‹å‹•åˆ‡æ›è‡ªå‹•æ²å‹•é–å®šç‹€æ…‹ï¼ˆä¿æŒåŠŸèƒ½ä½†ä¸é¡¯ç¤ºæŒ‰éˆ•ï¼‰
    const toggleAutoScrollLock = useCallback(() => setIsAutoScrollLocked(prev => !prev), [])

    // ç¦ç”¨åˆä½µæ®µè½é‚è¼¯ - ç”¨æˆ¶è¦æ±‚ä¸€å¥è©±ä¸€å€‹æ™‚é–“æˆ³
    const mergeSegments = useCallback((entries: TranscriptEntry[]): TranscriptEntry[] => {
        // ç›´æ¥è¿”å›åŸå§‹æ¢ç›®ï¼Œä¸é€²è¡Œä»»ä½•åˆä½µ
        return entries
    }, [])

    // è‡ªå‹•æ²å‹•
    useEffect(() => {
        autoScroll()
    }, [transcriptEntries, autoScroll])

    // ç›£è½æ²å‹•
    useEffect(() => {
        const scrollContainer = scrollAreaRef.current?.querySelector('[data-radix-scroll-area-viewport]')
        if (scrollContainer) {
            scrollContainer.addEventListener("scroll", unlockOnScroll)
            return () => scrollContainer.removeEventListener("scroll", unlockOnScroll)
        }
    }, [unlockOnScroll])

    // æ¸…ç†è¨ˆæ™‚å™¨
    useEffect(() => {
        return () => {
            if (userScrollTimeout) {
                clearTimeout(userScrollTimeout)
            }
        }
    }, [userScrollTimeout])

    const mergedEntries = mergeSegments(transcriptEntries)

    return (
        <div className="h-full flex flex-col">
            <ScrollArea className="flex-1" ref={scrollAreaRef}>
                <div className="p-6 space-y-4">
                    {mergedEntries.map((entry, index) => (
                        <div key={index} className="flex gap-4 text-sm">
                            <span className="text-muted-foreground font-mono text-xs mt-1 min-w-[40px] flex-shrink-0">
                                {entry.time}
                            </span>
                            <span className="text-foreground leading-relaxed flex-1">{entry.text}</span>
                        </div>
                    ))}
                </div>
            </ScrollArea>

            <div className="p-4 border-t border-border flex justify-between items-center">
                <div className="flex items-center gap-2 text-muted-foreground">
                    <Clock className="w-4 h-4" />
                    <span className="font-mono text-sm">
                        {formatRecordingTime(recordingTime)}
                    </span>
                </div>

                <Button onClick={onStopRecording} variant="destructive" size="sm" className="flex items-center gap-2">
                    <Square className="w-4 h-4" />
                    Stop
                </Button>
            </div>
        </div>
    )
}


# END FILE CONTENTS


# File: frontend/hooks/useNetworkRestorer.ts

"use client"
import { useEffect } from 'react'
import { emit } from '@/utils/event-bus'

export function useNetworkRestorer() {
    useEffect(() => {
        const handler = () => emit('network:restored')
        window.addEventListener('online', handler)
        return () => window.removeEventListener('online', handler)
    }, [])
}


# END FILE CONTENTS


# File: app/utils/validators.py

"""
æª”æ¡ˆé©—è­‰å·¥å…·

å¯¦ä½œå„ç¨®æª”æ¡ˆæ ¼å¼çš„åŸºæœ¬é©—è­‰åŠŸèƒ½
"""

import logging

logger = logging.getLogger(__name__)


def valid_webm(head: bytes) -> bool:
    """
    é©—è­‰ WebM æª”æ¡ˆæ ¼å¼

    æª¢æŸ¥ EBML header é­”è¡“æ•¸å­— 0x1A45DFA3
    WebM æ˜¯åŸºæ–¼ Matroska å®¹å™¨æ ¼å¼ï¼Œä½¿ç”¨ EBML ç·¨ç¢¼

    Args:
        head: æª”æ¡ˆé–‹é ­çš„ä½å…ƒçµ„è³‡æ–™ï¼ˆè‡³å°‘éœ€è¦ 4 bytesï¼‰

    Returns:
        bool: å¦‚æœæ˜¯æœ‰æ•ˆçš„ WebM æª”æ¡ˆå‰‡è¿”å› True
    """
    if len(head) < 4:
        logger.warning("æª”æ¡ˆéå°ï¼Œç„¡æ³•é€²è¡Œ WebM æ ¼å¼é©—è­‰")
        return False

    # EBML header é­”è¡“æ•¸å­—: 0x1A45DFA3
    ebml_header = b"\x1A\x45\xDF\xA3"

    is_valid = head.startswith(ebml_header)

    if is_valid:
        logger.debug("âœ… WebM æª”æ¡ˆæ ¼å¼é©—è­‰é€šé")
    else:
        logger.warning(f"âŒ WebM æª”æ¡ˆæ ¼å¼é©—è­‰å¤±æ•—: æœŸæœ› {ebml_header.hex()}, å¯¦éš› {head[:4].hex()}")

    return is_valid


def valid_audio_size(size_bytes: int, max_size: int = 5 * 1024 * 1024) -> bool:
    """
    é©—è­‰éŸ³æª”å¤§å°

    Args:
        size_bytes: æª”æ¡ˆå¤§å°ï¼ˆä½å…ƒçµ„ï¼‰
        max_size: æœ€å¤§å…è¨±å¤§å°ï¼ˆé è¨­ 5MBï¼‰

    Returns:
        bool: å¦‚æœæª”æ¡ˆå¤§å°åœ¨å…è¨±ç¯„åœå…§å‰‡è¿”å› True
    """
    is_valid = 0 < size_bytes <= max_size

    if is_valid:
        logger.debug(f"âœ… éŸ³æª”å¤§å°é©—è­‰é€šé: {size_bytes} bytes")
    else:
        logger.warning(f"âŒ éŸ³æª”å¤§å°é©—è­‰å¤±æ•—: {size_bytes} bytes (é™åˆ¶: {max_size} bytes)")

    return is_valid


def valid_sequence_number(seq: int, min_seq: int = 0, max_seq: int = 9999) -> bool:
    """
    é©—è­‰åºè™Ÿç¯„åœ

    Args:
        seq: åºè™Ÿ
        min_seq: æœ€å°åºè™Ÿï¼ˆé è¨­ 0ï¼‰
        max_seq: æœ€å¤§åºè™Ÿï¼ˆé è¨­ 9999ï¼‰

    Returns:
        bool: å¦‚æœåºè™Ÿåœ¨æœ‰æ•ˆç¯„åœå…§å‰‡è¿”å› True
    """
    is_valid = min_seq <= seq <= max_seq

    if is_valid:
        logger.debug(f"âœ… åºè™Ÿé©—è­‰é€šé: {seq}")
    else:
        logger.warning(f"âŒ åºè™Ÿé©—è­‰å¤±æ•—: {seq} (ç¯„åœ: {min_seq}-{max_seq})")

    return is_valid


# END FILE CONTENTS


# File: frontend/lib/__tests__/advanced-audio-recorder.test.ts

import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { AdvancedAudioRecorder, checkAdvancedAudioRecordingSupport } from '../advanced-audio-recorder'

// Track created instances
let mockInstances: any[] = []

const MockMediaRecorder = vi.fn().mockImplementation((stream: any, options: any) => {
    // Create individual mock functions for each instance
    const instanceStart = vi.fn()
    const instanceStop = vi.fn()
    const instanceRequestData = vi.fn()

    const instance = {
        start: instanceStart,
        stop: instanceStop,
        requestData: instanceRequestData,
        state: 'inactive',
        ondataavailable: null,
        onerror: null,
        mimeType: options.mimeType,
        audioBitsPerSecond: options.audioBitsPerSecond,
        stream,
        options
    }
    mockInstances.push(instance)
    return instance
}) as any

MockMediaRecorder.isTypeSupported = vi.fn().mockReturnValue(true)

// Mock getUserMedia
const mockGetUserMedia = vi.fn()

describe('AdvancedAudioRecorder', () => {
    let recorder: AdvancedAudioRecorder
    let mockStream: any

    beforeEach(() => {
        // Reset mocks
        vi.clearAllMocks()
        mockInstances = [] // Reset instances array

        // Setup global mocks
        global.MediaRecorder = MockMediaRecorder as any

        // Reset and setup isTypeSupported mock
        MockMediaRecorder.isTypeSupported.mockClear()
        MockMediaRecorder.isTypeSupported.mockReturnValue(true)

        global.navigator = {
            mediaDevices: {
                getUserMedia: mockGetUserMedia
            }
        } as any

        // Mock stream
        mockStream = {
            getTracks: vi.fn().mockReturnValue([
                { stop: vi.fn() }
            ])
        }
        mockGetUserMedia.mockResolvedValue(mockStream)

        // Create recorder instance
        recorder = new AdvancedAudioRecorder({
            segmentDuration: 10000,
            mimeType: 'audio/webm;codecs=opus',
            audioBitsPerSecond: 128000
        })
    })

    afterEach(() => {
        recorder.cleanup()
    })

    describe('checkAdvancedAudioRecordingSupport', () => {
        it('should return supported when all APIs are available', async () => {
            const result = await checkAdvancedAudioRecordingSupport()
            expect(result.isSupported).toBe(true)
        })

        it('should return unsupported when MediaDevices is not available', async () => {
            global.navigator = {} as any
            const result = await checkAdvancedAudioRecordingSupport()
            expect(result.isSupported).toBe(false)
            expect(result.error).toContain('MediaDevices API')
        })

        it('should return unsupported when MediaRecorder is not available', async () => {
            delete (global as any).MediaRecorder
            const result = await checkAdvancedAudioRecordingSupport()
            expect(result.isSupported).toBe(false)
            expect(result.error).toContain('MediaRecorder API')
        })

        it('should return unsupported when mime type is not supported', async () => {
            MockMediaRecorder.isTypeSupported.mockReturnValue(false)
            const result = await checkAdvancedAudioRecordingSupport()
            expect(result.isSupported).toBe(false)
            expect(result.error).toContain('éŸ³è¨Šæ ¼å¼')
        })
    })

    describe('AdvancedAudioRecorder', () => {
        it('should initialize with default config', () => {
            expect(recorder.currentConfig).toEqual({
                segmentDuration: 10000,
                mimeType: 'audio/webm;codecs=opus',
                audioBitsPerSecond: 128000
            })
        })

        it('should accept custom config', () => {
            const customRecorder = new AdvancedAudioRecorder({
                segmentDuration: 5000,
                audioBitsPerSecond: 64000
            })
            expect(customRecorder.currentConfig.segmentDuration).toBe(5000)
            expect(customRecorder.currentConfig.audioBitsPerSecond).toBe(64000)
        })

        it('should initialize media stream', async () => {
            await recorder.initialize()
            expect(mockGetUserMedia).toHaveBeenCalledWith({ audio: true })
        })

        it('should not reinitialize if already initialized', async () => {
            await recorder.initialize()
            await recorder.initialize()
            expect(mockGetUserMedia).toHaveBeenCalledTimes(1)
        })

        it('should start recording with dual MediaRecorder strategy', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            expect(recorder.recording).toBe(true)
            expect(mockInstances[0].start).toHaveBeenCalledTimes(1) // Current recorder started
        })

        it('should create MediaRecorder with correct options', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            // Check if MediaRecorder was created with correct options
            expect(MockMediaRecorder).toHaveBeenCalledWith(
                mockStream,
                {
                    mimeType: 'audio/webm;codecs=opus',
                    audioBitsPerSecond: 128000
                }
            )
        })

        it('should handle segment data available', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            // Get the first MediaRecorder instance created
            const mockRecorderInstance = mockInstances[0]

            // Simulate data available event
            const mockBlob = new Blob(['test data'], { type: 'audio/webm' })
            const mockEvent = { data: mockBlob }

            if (mockRecorderInstance.ondataavailable) {
                mockRecorderInstance.ondataavailable(mockEvent)
            }

            expect(onSegmentCallback).toHaveBeenCalledWith({
                blob: mockBlob,
                timestamp: expect.any(Number),
                duration: 10000,
                sequence: 0
            })
        })

        it('should increment sequence number for each segment', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            const mockRecorderInstance = mockInstances[0]
            const mockBlob = new Blob(['test data'], { type: 'audio/webm' })
            const mockEvent = { data: mockBlob }

            // First segment
            if (mockRecorderInstance.ondataavailable) {
                mockRecorderInstance.ondataavailable(mockEvent)
            }
            expect(onSegmentCallback).toHaveBeenLastCalledWith(
                expect.objectContaining({ sequence: 0 })
            )

            // Second segment
            if (mockRecorderInstance.ondataavailable) {
                mockRecorderInstance.ondataavailable(mockEvent)
            }
            expect(onSegmentCallback).toHaveBeenLastCalledWith(
                expect.objectContaining({ sequence: 1 })
            )
        })

        it('should stop recording and cleanup', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            expect(recorder.recording).toBe(true)

            recorder.stop()

            expect(recorder.recording).toBe(false)
            // Verify that at least 2 MediaRecorder instances were created (dual strategy)
            expect(mockInstances.length).toBeGreaterThanOrEqual(2)
        })

        it('should prevent starting when already recording', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            await expect(recorder.start(onSegmentCallback)).rejects.toThrow('éŒ„è£½å·²åœ¨é€²è¡Œä¸­')
        })

        it('should handle MediaRecorder errors', async () => {
            const onSegmentCallback = vi.fn()
            const onErrorCallback = vi.fn()
            recorder.onError(onErrorCallback)

            await recorder.start(onSegmentCallback)

            const mockRecorderInstance = mockInstances[0]
            const mockError = new Error('MediaRecorder error')

            if (mockRecorderInstance.onerror) {
                mockRecorderInstance.onerror(mockError)
            }

            expect(onErrorCallback).toHaveBeenCalledWith(expect.any(Error))
            expect(recorder.recording).toBe(false)
        })

        it('should cleanup resources properly', async () => {
            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            recorder.cleanup()

            expect(recorder.recording).toBe(false)
            expect(mockStream.getTracks()[0].stop).toHaveBeenCalled()
        })

        it('should schedule recorder swap after segment duration', async () => {
            vi.useFakeTimers()

            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            // Initially should have 2 recorders (current + next)
            expect(mockInstances.length).toBe(2)

            // Fast-forward time to trigger swap
            vi.advanceTimersByTime(10000)

            // After swap, should have created additional recorders
            expect(mockInstances.length).toBeGreaterThan(2)

            // Verify recorder is still recording
            expect(recorder.recording).toBe(true)

            vi.useRealTimers()
        })

        it('should not swap recorders after stop is called', async () => {
            vi.useFakeTimers()

            const onSegmentCallback = vi.fn()
            await recorder.start(onSegmentCallback)

            recorder.stop()

            // Fast-forward time
            vi.advanceTimersByTime(10000)

            // Should not start additional recorders after stop
            expect(mockInstances[0].start).toHaveBeenCalledTimes(1)

            vi.useRealTimers()
        })
    })
})


# END FILE CONTENTS


# File: frontend/__tests__/integration/state-transitions.test.tsx

import { beforeEach, describe, expect, test, vi } from 'vitest'
import { renderHook, act } from '@testing-library/react'
import { createElement } from 'react'
import { AppStateProvider } from '../../hooks/use-app-state-context'
import { StateMachine } from '../../lib/state-machine'
import { featureFlagManager } from '../../lib/feature-flags'
import type { ReactNode } from 'react'
import type { AppState } from '../../types/app-state'

// Mock localStorage
const localStorageMock = {
    getItem: vi.fn(),
    setItem: vi.fn(),
    removeItem: vi.fn(),
    clear: vi.fn(),
}

Object.defineProperty(window, 'localStorage', {
    value: localStorageMock
})

function TestWrapper({ children }: { children: ReactNode }) {
    return createElement(AppStateProvider, null, children)
}

describe('ç‹€æ…‹è½‰æ›æ¸¬è©¦', () => {
    beforeEach(() => {
        vi.clearAllMocks()
        featureFlagManager.reset()
        featureFlagManager.enable('useNewStateManagement')
        localStorageMock.getItem.mockReturnValue(null)
    })

    describe('åŸºæœ¬ç‹€æ…‹è½‰æ›', () => {
        test('æ‡‰è©²æ”¯æ´ default â†’ recording_waiting è½‰æ›', () => {
            const stateMachine = new StateMachine('default')

            const canTransition = stateMachine.canTransition('START_RECORDING')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('START_RECORDING')
            expect(newState).toBe('recording_waiting')
        })

        test('æ‡‰è©²æ”¯æ´ recording_waiting â†’ recording_active è½‰æ›', () => {
            const stateMachine = new StateMachine('recording_waiting')

            const canTransition = stateMachine.canTransition('RECORDING_STARTED')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('RECORDING_STARTED')
            expect(newState).toBe('recording_active')
        })

        test('æ‡‰è©²æ”¯æ´ recording_active â†’ processing è½‰æ›', () => {
            const stateMachine = new StateMachine('recording_active')

            const canTransition = stateMachine.canTransition('STOP_RECORDING')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('STOP_RECORDING')
            expect(newState).toBe('processing')
        })

        test('æ‡‰è©²æ”¯æ´ processing â†’ finished è½‰æ›', () => {
            const stateMachine = new StateMachine('processing')

            const canTransition = stateMachine.canTransition('PROCESSING_COMPLETE')
            expect(canTransition).toBe(true)

            const newState = stateMachine.transition('PROCESSING_COMPLETE')
            expect(newState).toBe('finished')
        })
    })

    describe('ç‹€æ…‹è½‰æ›é™åˆ¶', () => {
        test('ä¸æ‡‰è©²å…è¨±ç„¡æ•ˆçš„ç‹€æ…‹è½‰æ›', () => {
            const stateMachine = new StateMachine('default')

            // ä¸èƒ½ç›´æ¥å¾ default è·³åˆ° recording_active
            const canTransition = stateMachine.canTransition('RECORDING_STARTED')
            expect(canTransition).toBe(false)

            // å˜—è©¦ç„¡æ•ˆè½‰æ›æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
            expect(() => {
                stateMachine.transition('RECORDING_STARTED')
            }).toThrow()
        })

        test('finished ç‹€æ…‹æ‡‰è©²åªèƒ½é‡ç½®åˆ° default', () => {
            const stateMachine = new StateMachine('finished')

            // åªèƒ½é‡ç½®
            expect(stateMachine.canTransition('RESET')).toBe(true)
            expect(stateMachine.canTransition('START_RECORDING')).toBe(false)
            expect(stateMachine.canTransition('STOP_RECORDING')).toBe(false)

            const newState = stateMachine.transition('RESET')
            expect(newState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´å¾ä»»ä½•ç‹€æ…‹é‡ç½®åˆ° default', () => {
            const states: AppState[] = ['default', 'recording_waiting', 'recording_active', 'processing', 'finished']

            states.forEach(state => {
                const stateMachine = new StateMachine(state)
                expect(stateMachine.canTransition('RESET')).toBe(true)
                expect(stateMachine.transition('RESET')).toBe('default')
            })
        })
    })

    describe('å®Œæ•´ç‹€æ…‹æµç¨‹', () => {
        test('æ‡‰è©²æ”¯æ´å®Œæ•´çš„éŒ„éŸ³æµç¨‹', () => {
            const stateMachine = new StateMachine('default')

            // å®Œæ•´æµç¨‹ï¼šdefault â†’ recording_waiting â†’ recording_active â†’ processing â†’ finished
            expect(stateMachine.getCurrentState()).toBe('default')

            // é–‹å§‹éŒ„éŸ³
            const waitingState = stateMachine.transition('START_RECORDING')
            expect(waitingState).toBe('recording_waiting')

            // éŒ„éŸ³é–‹å§‹
            const activeState = stateMachine.transition('RECORDING_STARTED')
            expect(activeState).toBe('recording_active')

            // åœæ­¢éŒ„éŸ³
            const processingState = stateMachine.transition('STOP_RECORDING')
            expect(processingState).toBe('processing')

            // è™•ç†å®Œæˆ
            const finishedState = stateMachine.transition('PROCESSING_COMPLETE')
            expect(finishedState).toBe('finished')

            // é‡ç½®
            const resetState = stateMachine.transition('RESET')
            expect(resetState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´ç­†è¨˜æ¨¡å¼æµç¨‹', () => {
            const stateMachine = new StateMachine('default')

            // ç­†è¨˜æ¨¡å¼ï¼šdefault â†’ finished (ç›´æ¥å®Œæˆ)
            expect(stateMachine.getCurrentState()).toBe('default')

            const finishedState = stateMachine.transition('FINISH_SESSION')
            expect(finishedState).toBe('finished')
        })
    })

    describe('éŒ¯èª¤æ¢å¾©', () => {
        test('æ‡‰è©²æ”¯æ´éŒ¯èª¤ç‹€æ…‹æ¢å¾©', () => {
            const stateMachine = new StateMachine('recording_active')

            // å¾éŒ„éŸ³ä¸­ç™¼ç”ŸéŒ¯èª¤
            const errorState = stateMachine.transition('ERROR')
            expect(errorState).toBe('default')
        })

        test('æ‡‰è©²æ”¯æ´æœƒè©±å‡ç´š', () => {
            const stateMachine = new StateMachine('default')

            // å‡ç´šåˆ°éŒ„éŸ³æ¨¡å¼
            const upgradedState = stateMachine.transition('UPGRADE_TO_RECORDING')
            expect(upgradedState).toBe('recording_waiting')
        })
    })

    describe('ä¸¦ç™¼ç‹€æ…‹è®Šæ›´', () => {
        test('ç‹€æ…‹æ©Ÿæ‡‰è©²æ˜¯ç·šç¨‹å®‰å…¨çš„', () => {
            const stateMachine = new StateMachine('default')
            const results: AppState[] = []

            // æ¨¡æ“¬ä¸¦ç™¼è½‰æ›
            const transitions = [
                'START_RECORDING',
                'RESET',
                'START_RECORDING',
                'RESET'
            ]

            transitions.forEach(trigger => {
                try {
                    const newState = stateMachine.transition(trigger as any)
                    results.push(newState)
                } catch (error) {
                    // æŸäº›è½‰æ›å¯èƒ½å¤±æ•—ï¼Œé€™æ˜¯é æœŸçš„
                }
            })

            // æœ€å¾Œç‹€æ…‹æ‡‰è©²æ˜¯æœ‰æ•ˆçš„
            const finalState = stateMachine.getCurrentState()
            const validStates: AppState[] = ['default', 'recording_waiting', 'recording_active', 'processing', 'finished']
            expect(validStates).toContain(finalState)
        })
    })

    describe('ç‹€æ…‹æ­·å²', () => {
        test('æ‡‰è©²è¨˜éŒ„ç‹€æ…‹è½‰æ›æ­·å²', () => {
            const stateMachine = new StateMachine('default')

            stateMachine.transition('START_RECORDING')
            stateMachine.transition('RECORDING_STARTED')
            stateMachine.transition('STOP_RECORDING')

            const history = stateMachine.getHistory()
            expect(history).toHaveLength(4) // åŒ…å«åˆå§‹ç‹€æ…‹
            expect(history[0]).toBe('default')
            expect(history[1]).toBe('recording_waiting')
            expect(history[2]).toBe('recording_active')
            expect(history[3]).toBe('processing')
        })

        test('æ‡‰è©²æ”¯æ´å›åˆ°ä¸Šä¸€å€‹ç‹€æ…‹', () => {
            const stateMachine = new StateMachine('default')

            stateMachine.transition('START_RECORDING')
            stateMachine.transition('RECORDING_STARTED')

            const canGoBack = stateMachine.canGoBack()
            expect(canGoBack).toBe(true)

            const previousState = stateMachine.goBack()
            expect(previousState).toBe('recording_waiting')
            expect(stateMachine.getCurrentState()).toBe('recording_waiting')
        })
    })
})


# END FILE CONTENTS


# File: frontend/types/websocket-messages.ts

/* ============================================================
 * å‹åˆ¥å®‰å…¨ï¼šæ‰€æœ‰ WS è¨Šæ¯çš„ Discriminated Union
 * ============================================================
 */

/** å…±ç”¨æ¬„ä½ï¼ˆå¯è¦–éœ€æ±‚å¢åˆªï¼‰ */
interface BaseMessage {
    /** ä¾†æºä¼ºæœå™¨æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰ */
    timestamp: number
}

/** é€å­—ç¨¿ç‰‡æ®µ */
export interface TranscriptSegmentMessage extends BaseMessage {
    type: 'transcript_segment'
    text: string
    start_time: number
    end_time: number
    confidence: number
}

/** é€£ç·šå»ºç«‹æˆåŠŸ */
export interface ConnectionEstablishedMessage extends BaseMessage {
    type: 'connection_established'
    message: string
}

/** æ•´æ®µé€å­—ç¨¿å®Œæˆ */
export interface TranscriptCompleteMessage extends BaseMessage {
    type: 'transcript_complete'
    message: string
}

/** å¿ƒè·³å›è¦† */
export interface HeartbeatAckMessage extends BaseMessage {
    type: 'heartbeat_ack'
}

/** Pong å›è¦† */
export interface PongMessage extends BaseMessage {
    type: 'pong'
}

/** ä¸€èˆ¬éŒ¯èª¤ */
export interface ErrorMessage extends BaseMessage {
    type: 'error'
    error_type: string
    error_message: string
    details?: unknown
}

/** è½‰éŒ„æœå‹™éŒ¯èª¤ */
export interface TranscriptionErrorMessage extends BaseMessage {
    type: 'transcription_error'
    error_type: string
    error_message: string
}

/** å¾Œç«¯ç‹€æ…‹åˆ‡æ›ï¼ˆç„¡ type æ¬„ä½ï¼Œå¦æ‹†ï¼‰ */
export interface PhaseMessage {
    phase: 'waiting' | 'active'
}

/** â†’ æœ€çµ‚ Union */
export type WSMessage =
    | TranscriptSegmentMessage
    | ConnectionEstablishedMessage
    | TranscriptCompleteMessage
    | HeartbeatAckMessage
    | PongMessage
    | ErrorMessage
    | TranscriptionErrorMessage
    | PhaseMessage


# END FILE CONTENTS
